/**
 * 由 CoCo 源代码计划解包器解包
 *
 * 模块 ID：2636__part-86
 */

import * as React from "react"

import { r, o, i, a, s, c, l, u, d, p } from "../../../../../unrestored/shared/1571/2636/index__part-0"
import { Cp } from "../../../../../unrestored/shared/1571/2636/index__part-38"
import { Lp } from "../../../../../unrestored/shared/1571/2636/index__part-40"
import { Kp } from "../../../../../unrestored/shared/1571/2636/index__part-43"
import { tf } from "../../../../../unrestored/shared/1571/2636/index__part-44"
import { uf } from "../../../../../unrestored/shared/1571/2636/index__part-46"
import { _f } from "../../../../../unrestored/shared/1571/2636/index__part-48"
import { Tf } from "../../../../../unrestored/shared/1571/2636/index__part-50"
import { xf } from "../../../../../unrestored/shared/1571/2636/index__part-53"
import { Wf } from "../../../../../unrestored/shared/1571/2636/index__part-55"
import { Jf } from "../../../../../unrestored/shared/1571/2636/index__part-58"
import { ah } from "../../../../../unrestored/shared/1571/2636/index__part-60"
import { wh } from "../../../../../unrestored/shared/1571/2636/index__part-64"
import { xh } from "../../../../../unrestored/shared/1571/2636/index__part-66"
import { zh, Xh } from "../../../../../unrestored/shared/1571/2636/index__part-68"
import { nm, im, cm } from "../../../../../unrestored/shared/1571/2636/index__part-70"
import { hm } from "../../../../../unrestored/shared/1571/2636/index__part-72"
import { ym, wm, Sm } from "../../../widget/built-in/http-client-and-timer"
import { Pm, zm, qm, eg } from "../../../../../unrestored/shared/1571/2636/index__part-75"
import { cg } from "../../../../../unrestored/shared/1571/2636/index__part-76"
import { gg } from "../../../../../unrestored/shared/1571/2636/index__part-77"
import { Og } from "../../../../../unrestored/shared/1571/2636/index__part-78"
import { c_ } from "../../../../../unrestored/shared/1571/2636/index__part-80"
import { __ } from "../../../../../unrestored/shared/1571/2636/index__part-81"
import { tv } from "../../../../../unrestored/shared/1571/2636/index__part-85"
var ev
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_682 from "../../../../../unrestored/shared/1571/2636/682"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_681 from "../../../../../unrestored/shared/1571/2636/681"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_680 from "../../../../../unrestored/shared/1571/2636/680"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_679 from "../../../../../unrestored/shared/1571/2636/679"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_688 from "../../../../../unrestored/shared/1571/2636/688"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_687 from "../../../../../unrestored/shared/1571/2636/687"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_678 from "../../../../../unrestored/shared/1571/2636/678"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_686 from "../../../../../unrestored/shared/1571/2636/686"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_685_index from "../../../../../unrestored/shared/1571/2636/685/index"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_684_index from "../../../../../unrestored/shared/1571/2636/684/index"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_683 from "../../../../../unrestored/shared/1571/2636/683"
import styles from "../../../../../unrestored/shared/1571/2636/196"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_53 from "../../../../../unrestored/shared/1571/2636/53"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_238 from "../../../../../unrestored/shared/1571/2636/238"
import * as BuiltInWidgetTypes from "../../../widget/built-in/types"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_shared_widget_custom_type from "../../../../shared/widget/custom/type"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9 from "../../../../../unrestored/shared/1571/2636/9"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_shared_widget_custom_load from "../../../../shared/widget/custom/load"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_15 from "../../../../../unrestored/shared/1571/2636/15"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_1213 from "../../../../../unrestored/shared/1571/2636/1213"
import * as Actions from "../../../redux/common/actions"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_11 from "../../../../../unrestored/shared/1571/2636/11"
import /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_8 from "../../../../../unrestored/shared/1571/2636/8"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_710 from "../../../../../unrestored/shared/1571/2636/710"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_10_index from "../../../../../unrestored/shared/1571/2636/10/index"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_shared_ui_language from "../../../../shared/ui/language"
import { useDispatch, useSelector } from "react-redux"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_94_index from "../../../../../unrestored/shared/1571/2636/94/index"
import * as WidgetShop from "../../../../shared/widget/custom/shop"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_$$_unrestored_shared_1571_2636_542 from "../../../../../unrestored/shared/1571/2636/542"
var iv = [require("../../../../../unrestored/shared/1571/2636/543").a, $$_$$_$$_$$_$$_unrestored_shared_1571_2636_542.a, "UNSAFE_EXTENSION_KANO_WAND_WIDGET"]

const ConfigItem = React.memo(({
  icon, title, type, isMallExtensionWidget, isInvisibleWidget, widgetServerId
}: {
  icon: string
  title: string
  type: string
  isMallExtensionWidget: boolean
  isInvisibleWidget: boolean
  widgetServerId?: number
}) => {
  const currentScreen = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_238.d()
  const dispatch = useDispatch()
  const { formatMessage } = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_710.a()
  const [menuVisible, setMenuVisible] = React.useState(false)
  const [bigImageVisible, setBigImageVisible] = React.useState(false)
  const [isMouseIn, setIsMouseIn] = React.useState(false)
  var R = React.useState(true)
  var x = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_10_index.a(R, 2)
  var D = x[0]
  var M = x[1]
  const globalWidgetIds = useSelector((state) => state.project.globalWidgetIds)
  const language = useSelector((state) => state.common.language)
  React.useEffect(function () {
    function listener() {
      setMenuVisible(false)
      setBigImageVisible(false)
      document.removeEventListener("click", listener, true)
      document.removeEventListener("contextmenu", listener, true)
      document.removeEventListener("dragstart", listener, true)
    }
    if (menuVisible || bigImageVisible) {
      document.addEventListener("click", listener, true)
      document.addEventListener("contextmenu", listener, true)
      document.addEventListener("dragstart", listener, true)
    }
  }, [menuVisible, bigImageVisible])
  React.useEffect(function () {
    if (iv.includes(type)) {
      var e = globalWidgetIds.some((id) => id.includes(type))
      M(!e)
    }
  }, [type, globalWidgetIds])
  let hasCanvasWidget = true
  if (!(type !== BuiltInWidgetTypes.ACTOR_WIDGET && type !== BuiltInWidgetTypes.BRUSH_WIDGET || !currentScreen)) {
    hasCanvasWidget = currentScreen.widgetIds.some((id) => $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Bb(id)?.type === BuiltInWidgetTypes.CANVAS_WIDGET)
  }
  const removeShopWidget = async () => {
    if (widgetServerId) {
      if (await WidgetShop.remove([widgetServerId])) {
        dispatch(Actions.showCommonToastInfoAction({
          message: formatMessage({
            id: "WidgetMall.removeSuccess"
          }),
          type: "success"
        }))
        dispatch(Actions.Kh([type]))
      } else {
        dispatch(Actions.showCommonToastInfoAction({
          message: formatMessage({
            id: "WidgetMall.removeFailure"
          })
        }))
      }
    } else {
      console.error("removeWidget error: widgetServerId is null")
    }
  }
  return (
    <$$_$$_$$_$$_$$_unrestored_shared_1571_2636_1213.a
      placement="rightTop"
      trigger="hover"
      onVisibleChange={(e) => {
        if (e) {
          setMenuVisible(false)
          setBigImageVisible(false)
        }
      }}
      visible={menuVisible || bigImageVisible}
      content={() =>
        menuVisible ? (
          <div className={styles.menuWrapper} onMouseDown={removeShopWidget}>
            {formatMessage({ id: "Widget.removeWidget" })}
          </div>
        ) : bigImageVisible && isMouseIn ? (
          <div className={styles.imgWrapper}>
            <div className={styles.widgetImgBig} style={{ backgroundImage: `url("${icon}")` }} />
          </div>
        ) : undefined
      }
    >
      <div
        className={$$_$$_$$_$$_$$_unrestored_shared_1571_2636_8(styles.widgetItem, $$_$$_$$_$$_$$_unrestored_shared_1571_2636_11.a({}, styles.disabled, !hasCanvasWidget || !D))}
        draggable
        onMouseEnter={() => {
          if (isMallExtensionWidget && !isInvisibleWidget) {
            if (!menuVisible) {
              setIsMouseIn(true)
              ev = window.setTimeout(() => {
                setBigImageVisible(true)
              }, 2000)
            }
          }
        }}
        onMouseLeave={() => {
          if (isMallExtensionWidget && !isInvisibleWidget) {
            if (ev) {
              clearTimeout(ev)
            }
            setIsMouseIn(false)
            setBigImageVisible(false)
          }
        }}
        onContextMenu={(e) => {
          e.preventDefault()
          if (isMallExtensionWidget) {
            setIsMouseIn(false)
            setBigImageVisible(false)
            setMenuVisible(true)
          }
        }}
        onDragStart={(e) => {
          if (!hasCanvasWidget || !D) {
            var t = ""
            if (D) {
              t = formatMessage({
                id: "StageToast.addCanvasWidgetTips"
              })
            } else {
              var n
              var o = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Db(type)
              if (!o) {
                return
              }
              var i = null === (n = $$_$$_$$_$$_shared_ui_language.c(language, o.title)) || undefined === n ? undefined : n.toString()
              t = formatMessage({
                id: "StageToast.addLimitedWidgetTips"
              }, {
                widgetTitle: i
              })
            }
            dispatch(Actions.xj(t))
            return void e.preventDefault()
          }
          if (!(type !== BuiltInWidgetTypes.a && type !== BuiltInWidgetTypes.c)) {
            dispatch(Actions.Yh(true))
          }
          var /* [auto-meaningful-name] */e$target = e.target
          var s = null === e$target || undefined === e$target ? undefined : e$target.getClientRects()[0]
          if (e$target && e$target.dataset.widgetType && s) {
            var u = e.clientX - s.x
            var d = e.clientY - s.y
            e.dataTransfer.setData("widget/dragging-offset-x", u + "")
            e.dataTransfer.setData("widget/dragging-offset-y", d + "")
            e.dataTransfer.dropEffect = "copy"
            e.dataTransfer.setData("widget/type", e$target.dataset.widgetType)
            e.dataTransfer.setData("widget/action", BuiltInWidgetTypes.r.CREATE)
          }
        }}
        onDragEnd={() => {
          if (!(type !== BuiltInWidgetTypes.a && type !== BuiltInWidgetTypes.c)) {
            dispatch(Actions.Yh(false))
          }
        }}
        data-widget-type={type}
      >
        {$$_$$_$$_$$_$$_unrestored_shared_1571_2636_15.X(icon) ? (
          isInvisibleWidget ? (
            <img className={styles.icon} src={icon} alt={title} draggable={false} />
          ) : (
            <div
              className={styles.widgetImgSmall}
              style={{ backgroundImage: `url("${icon}")` }}
            />
          )
        ) : (
          <span className={styles.icon}>
            <$$_$$_$$_$$_$$_unrestored_shared_1571_2636_94_index.a type={icon} />
          </span>
        )}
        <span className={styles.title}>{title}</span>
      </div>
    </$$_$$_$$_$$_$$_unrestored_shared_1571_2636_1213.a>
  )
})

interface ConfigItem {
  type: string
  icon: string
  previewAreaWidgetTitle: string
  title: string
  isInvisibleWidget: boolean
  widgetServerId?: number
}

export const WidgetCategoryItem = React.memo<{
  configList: ConfigItem[]
  title: string
  defaultExpanded: boolean
}>(({ configList, title, defaultExpanded }) => {
  const { formatMessage } = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_710.a()
  var i = useSelector((state) => state.common.userInfo?.id)
  var a = React.useState(undefined === defaultExpanded || defaultExpanded)
  var s = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_10_index.a(a, 2)
  var c = s[0]
  var l = s[1]
  var u = "newWidgetCategory_".concat($$_$$_$$_$$_$$_unrestored_shared_1571_2636_53.f, "_").concat(i)
  var d = m()
  var p = !i || !d[title]
  function m() {
    var e = localStorage.getItem(u)
    return e ? JSON.parse(e) : {}
  }
  return configList.length ? (
    <div className={$$_$$_$$_$$_$$_unrestored_shared_1571_2636_8(styles.categoryItem, $$_$$_$$_$$_$$_unrestored_shared_1571_2636_11.a({}, styles.expanded, c))}>
      <div
        className={$$_$$_$$_$$_$$_unrestored_shared_1571_2636_8(styles.categoryHeader, window.innerWidth <= 1300 && styles.categoryMinHeader)}
        onClick={() => {
          l(!c)
          if ($$_$$_$$_$$_$$_unrestored_shared_1571_2636_53.k.includes(title) && i && !d[title]) {
            var e = m()
            e[title] = 1
            localStorage.setItem(u, JSON.stringify(e))
          }
        }}
      >
        <div className={styles.categoryTitleBox}>
          <h3 className={$$_$$_$$_$$_$$_unrestored_shared_1571_2636_8(styles.categoryTitle)}>
            {formatMessage({ id: title })}
          </h3>
          {$$_$$_$$_$$_$$_unrestored_shared_1571_2636_53.k.includes(title) && p && <div className={styles.newTips}>New</div>}
        </div>
        <span className={styles.icon}>
          <$$_$$_$$_$$_$$_unrestored_shared_1571_2636_94_index.a type="icon-fold" />
        </span>
      </div>
      {c && (
        <div className={styles.categoryBody}>
          {configList.map((widget) => {
            const { type, icon, previewAreaWidgetTitle, title, isInvisibleWidget, widgetServerId } = widget
            return (
              !widget.isDiscard && (
                <ConfigItem
                  key={type}
                  icon={icon}
                  title={
                    previewAreaWidgetTitle
                      ? formatMessage({ id: previewAreaWidgetTitle })
                      : title
                  }
                  type={type}
                  widgetServerId={widgetServerId}
                  isMallExtensionWidget={$$_$$_$$_$$_shared_widget_custom_type.isSafeExtensions(type)}
                  isInvisibleWidget={isInvisibleWidget}
                />
              )
            )
          })}
        </div>
      )}
    </div>
  ) : null
})

$$_$$_$$_$$_shared_widget_custom_load.s(r)
$$_$$_$$_$$_shared_widget_custom_load.s(o)
$$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_680)
$$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_682)
$$_$$_$$_$$_shared_widget_custom_load.s(a)
$$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_681)
$$_$$_$$_$$_shared_widget_custom_load.s(i)
$$_$$_$$_$$_shared_widget_custom_load.s(s)
$$_$$_$$_$$_shared_widget_custom_load.s(c)
$$_$$_$$_$$_shared_widget_custom_load.s(l)
$$_$$_$$_$$_shared_widget_custom_load.s(u)
$$_$$_$$_$$_shared_widget_custom_load.s(d)
$$_$$_$$_$$_shared_widget_custom_load.s(p)
var cv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_679, tv)
var lv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_686)
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.UI, [Cp, Lp, cv, Kp, tf, uf, _f, Tf, xf, Wf, Jf, ah, lv])
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.STAGE, [wh, xh, zh])
var uv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_678)
var dv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_688)
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.MEDIA, [Xh, nm, uv, dv])
var pv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_687)
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.SENSOR, [im, cm, pv])
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.DATE, [hm, ym, wm])
var fv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_683)
var hv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_684_index)
var mv = $$_$$_$$_$$_shared_widget_custom_load.s($$_$$_$$_$$_$$_unrestored_shared_1571_2636_685_index)
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.NETWORK, [Sm, Pm, fv, hv, mv])
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.LOCAL_STORAGE, [qm, eg, gg])
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.CLOUD_STORAGE, [Og, zm])
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.CLOUD_SPACE, [c_, __])
$$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Nb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.DATABASE, [cg])
export const BuiltInWidgetList = React.memo(() => {
  var t = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.UI)
  var n = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.STAGE)
  var r = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.MEDIA)
  var o = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.DATE)
  var i = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.SENSOR)
  var a = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.LOCAL_STORAGE)
  var s = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.CLOUD_SPACE)
  var c = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.NETWORK)
  var l = $$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.Eb($$_$$_$$_$$_$$_unrestored_shared_1571_2636_9.j.SOCIAL)
  return (
    <div className={styles.scrollBasic}>
      <WidgetCategoryItem
        configList={t}
        title="WidgetList.category.ui"
        defaultExpanded
      />
      <WidgetCategoryItem
        configList={n}
        title="WidgetList.category.stage"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={r}
        title="WidgetList.category.media"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={o}
        title="WidgetList.category.dateTime"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={i}
        title="WidgetList.category.sensor"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={a}
        title="WidgetList.category.localStorage"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={s}
        title="WidgetList.category.cloudSpace"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={c}
        title="WidgetList.category.network"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={l}
        title="WidgetList.category.social"
        defaultExpanded={false}
      />
    </div>
  )
})
