/**
 * 由 CoCo 源代码计划解包器解包
 *
 * 模块 ID：2636__part-86
 */

import * as React from "react"

import { r, o, i, a, s, c, l, u, d, p } from "../../../../../unrestored/shared/1571/2636/index__part-0"
import { Cp } from "../../../../../unrestored/shared/1571/2636/index__part-38"
import { Lp } from "../../../../../unrestored/shared/1571/2636/index__part-40"
import { Kp } from "../../../../../unrestored/shared/1571/2636/index__part-43"
import { tf } from "../../../../../unrestored/shared/1571/2636/index__part-44"
import { uf } from "../../../../../unrestored/shared/1571/2636/index__part-46"
import { _f } from "../../../../../unrestored/shared/1571/2636/index__part-48"
import { Tf } from "../../../../../unrestored/shared/1571/2636/index__part-50"
import { xf } from "../../../../../unrestored/shared/1571/2636/index__part-53"
import { Wf } from "../../../../../unrestored/shared/1571/2636/index__part-55"
import { Jf } from "../../../../../unrestored/shared/1571/2636/index__part-58"
import { ah } from "../../../../../unrestored/shared/1571/2636/index__part-60"
import { wh } from "../../../../../unrestored/shared/1571/2636/index__part-64"
import { xh } from "../../../../../unrestored/shared/1571/2636/index__part-66"
import { zh, Xh } from "../../../../../unrestored/shared/1571/2636/index__part-68"
import { nm, im, cm } from "../../../../../unrestored/shared/1571/2636/index__part-70"
import { hm } from "../../../../../unrestored/shared/1571/2636/index__part-72"
import { ym, wm, Sm } from "../../../widget/built-in/http-client-and-timer"
import { Pm, zm, qm, eg } from "../../../../../unrestored/shared/1571/2636/index__part-75"
import { cg } from "../../../../../unrestored/shared/1571/2636/index__part-76"
import { gg } from "../../../../../unrestored/shared/1571/2636/index__part-77"
import { Og } from "../../../../../unrestored/shared/1571/2636/index__part-78"
import { c_ } from "../../../../../unrestored/shared/1571/2636/index__part-80"
import { __ } from "../../../../../unrestored/shared/1571/2636/index__part-81"
import { tv } from "../../../../../unrestored/shared/1571/2636/index__part-85"
var ev
import * as /* [auto-meaningful-name] */$_682 from "../../../../../unrestored/shared/1571/2636/682"
import * as /* [auto-meaningful-name] */$_681 from "../../../../../unrestored/shared/1571/2636/681"
import * as /* [auto-meaningful-name] */$_680 from "../../../../../unrestored/shared/1571/2636/680"
import * as /* [auto-meaningful-name] */$_679 from "../../../../../unrestored/shared/1571/2636/679"
import * as /* [auto-meaningful-name] */$_688 from "../../../../../unrestored/shared/1571/2636/688"
import * as /* [auto-meaningful-name] */$_687 from "../../../../../unrestored/shared/1571/2636/687"
import * as /* [auto-meaningful-name] */$_678 from "../../../../../unrestored/shared/1571/2636/678"
import * as /* [auto-meaningful-name] */$_686 from "../../../../../unrestored/shared/1571/2636/686"
import * as /* [auto-meaningful-name] */$_685_index from "../../../../../unrestored/shared/1571/2636/685/index"
import * as /* [auto-meaningful-name] */$_684_index from "../../../../../unrestored/shared/1571/2636/684/index"
import * as /* [auto-meaningful-name] */$_683 from "../../../../../unrestored/shared/1571/2636/683"
import /* [auto-meaningful-name] */$_196 from "../../../../../unrestored/shared/1571/2636/196"
import * as Yr from "../../../../../unrestored/shared/1571/2636/53"
import * as /* [auto-meaningful-name] */$_238 from "../../../../../unrestored/shared/1571/2636/238"
import * as An from "../../../widget/built-in/types"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_src_shared_widget_custom_type from "../../../../shared/widget/custom/type"
import * as Et from "../../../../../unrestored/shared/1571/2636/9"
import * as /* [auto-meaningful-name] */loadCustomWidget from "../../../../shared/widget/custom/load"
import * as te from "../../../../../unrestored/shared/1571/2636/15"
import * as /* [auto-meaningful-name] */$_1213 from "../../../../../unrestored/shared/1571/2636/1213"
import * as /* [auto-meaningful-name] */Message from "../../../events/main/messages-wrapper"
import * as k from "../../../../../unrestored/shared/1571/2636/11"
import N from "../../../../../unrestored/shared/1571/2636/8"
import * as /* [auto-meaningful-name] */$_710_index from "../../../../../unrestored/shared/1571/2636/710/index"
import * as /* [auto-meaningful-name] */$_10_index from "../../../../../unrestored/shared/1571/2636/10/index"
import * as /* [auto-meaningful-name] */$$_$$_$$_$$_src_shared_ui_language from "../../../../shared/ui/language"
import * as O from "../../../../../unrestored/shared/1571/2636/7"
import /* [auto-meaningful-name] */RegeneratorRuntime from "regenerator-runtime"
import * as /* [auto-meaningful-name] */$_16_index from "../../../../../unrestored/shared/1571/2636/16/index"
import * as /* [auto-meaningful-name] */$_94_index from "../../../../../unrestored/shared/1571/2636/94/index"
import * as /* [auto-meaningful-name] */WidgetShop from "../../../../shared/widget/custom/shop"
import * as /* [auto-meaningful-name] */$_542 from "../../../../../unrestored/shared/1571/2636/542"
var iv = [require("../../../../../unrestored/shared/1571/2636/543").a, $_542.a, "UNSAFE_EXTENSION_KANO_WAND_WIDGET"]

const WidgetItem = React.memo(({
  icon, title, type, isMallExtensionWidget, isInvisibleWidget, widgetServerId
}: {
  icon: string
  title: string
  type: string
  isMallExtensionWidget: boolean
  isInvisibleWidget: boolean
  widgetServerId: number
}) => {
  var s = $_238.d()
  const dispatch = $_16_index.d()
  const { formatMessage } = $_710_index.a()
  var u = React.useState(false)
  var d = $_10_index.a(u, 2)
  var p = d[0]
  var m = d[1]
  var g = React.useState(false)
  var v = $_10_index.a(g, 2)
  var b = v[0]
  var y = v[1]
  var w = React.useState(false)
  var C = $_10_index.a(w, 2)
  var A = C[0]
  var j = C[1]
  var R = React.useState(true)
  var x = $_10_index.a(R, 2)
  var D = x[0]
  var M = x[1]
  const globalWidgetIds = $_16_index.e(function (e) {
    return e.project.globalWidgetIds
  })
  const language = $_16_index.e(function (e) {
    return e.common.language
  })
  React.useEffect(function () {
    var e = function e() {
      m(false)
      y(false)
      document.removeEventListener("click", e, true)
      document.removeEventListener("contextmenu", e, true)
      document.removeEventListener("dragstart", e, true)
    }
    if (p || b) {
      document.addEventListener("click", e, true)
      document.addEventListener("contextmenu", e, true)
      document.addEventListener("dragstart", e, true)
    }
  }, [p, b])
  React.useEffect(function () {
    if (iv.includes(type)) {
      var e = globalWidgetIds.some((id) => id.includes(type))
      M(!e)
    }
  }, [type, globalWidgetIds])
  var B = true
  if (!(type !== An.a && type !== An.c || !s)) {
    B = s.widgetIds.some(function (e) {
      var t
      return (null === (t = Et.Bb(e)) || undefined === t ? undefined : t.type) === An.f
    })
  }
  const removeWidget = async () => {
    if (widgetServerId) {
      if (await WidgetShop.remove([widgetServerId])) {
        dispatch(Message.wrapShowCommonToastInfo({
          message: formatMessage({
            id: "WidgetMall.removeSuccess"
          }),
          type: "success"
        }))
        dispatch(Message.Kh([type]))
      } else {
        dispatch(Message.wrapShowCommonToastInfo({
          message: formatMessage({
            id: "WidgetMall.removeFailure"
          })
        }))
      }
    } else {
      console.error("removeWidget error: widgetServerId is null")
    }
  }
  return (
    <$_1213.a
      placement="rightTop"
      trigger="hover"
      onVisibleChange={(e) => {
        if (e) {
          m(false)
          y(false)
        }
      }}
      visible={p || b}
      content={() =>
        p ? (
          <div className={$_196.menuWrapper} onMouseDown={removeWidget}>
            {formatMessage({ id: "Widget.removeWidget" })}
          </div>
        ) : b && A ? (
          <div className={$_196.imgWrapper}>
            <div
              className={$_196.widgetImgBig}
              style={{ backgroundImage: `url("${icon}")` }}
            />
          </div>
        ) : undefined
      }
    >
      <div
        className={N($_196.widgetItem, k.a({}, $_196.disabled, !B || !D))}
        draggable
        onMouseEnter={() => {
          if (isMallExtensionWidget && !isInvisibleWidget) {
            if (!p) {
              j(true)
              ev = window.setTimeout(() => {
                y(true)
              }, 2e3)
            }
          }
        }}
        onMouseLeave={() => {
          if (isMallExtensionWidget && !isInvisibleWidget) {
            if (ev) {
              clearTimeout(ev)
            }
            j(false)
            y(false)
          }
        }}
        onContextMenu={(e) => {
          e.preventDefault()
          if (isMallExtensionWidget) {
            j(false)
            y(false)
            m(true)
          }
        }}
        onDragStart={(e) => {
          if (!B || !D) {
            var t = ""
            if (D) {
              t = formatMessage({
                id: "StageToast.addCanvasWidgetTips"
              })
            } else {
              var n
              var o = Et.Db(type)
              if (!o) {
                return
              }
              var i = null === (n = $$_$$_$$_$$_src_shared_ui_language.c(language, o.title)) || undefined === n ? undefined : n.toString()
              t = formatMessage({
                id: "StageToast.addLimitedWidgetTips"
              }, {
                widgetTitle: i
              })
            }
            dispatch(Message.xj(t))
            return void e.preventDefault()
          }
          if (!(type !== An.a && type !== An.c)) {
            dispatch(Message.Yh(true))
          }
          var /* [auto-meaningful-name] */e$target = e.target
          var s = null === e$target || undefined === e$target ? undefined : e$target.getClientRects()[0]
          if (e$target && e$target.dataset.widgetType && s) {
            var u = e.clientX - s.x
            var d = e.clientY - s.y
            e.dataTransfer.setData("widget/dragging-offset-x", u + "")
            e.dataTransfer.setData("widget/dragging-offset-y", d + "")
            e.dataTransfer.dropEffect = "copy"
            e.dataTransfer.setData("widget/type", e$target.dataset.widgetType)
            e.dataTransfer.setData("widget/action", An.r.CREATE)
          }
        }}
        onDragEnd={() => {
          if (!(type !== An.a && type !== An.c)) {
            dispatch(Message.Yh(false))
          }
        }}
        data-widget-type={type}
      >
        {te.X(icon) ? (
          isInvisibleWidget ? (
            <img className={$_196.icon} src={icon} alt={title} draggable={false} />
          ) : (
            <div
              className={$_196.widgetImgSmall}
              style={{ backgroundImage: `url("${icon}")` }}
            />
          )
        ) : (
          <span className={$_196.icon}>
            <$_94_index.a type={icon} />
          </span>
        )}
        <span className={$_196.title}>{title}</span>
      </div>
    </$_1213.a>
  )
})

export const WidgetCategoryItem = React.memo(function (e) {
  var /* [auto-meaningful-name] */e$configList = e.configList
  var /* [auto-meaningful-name] */e$title = e.title
  var /* [auto-meaningful-name] */e$defaultExpanded = e.defaultExpanded
  const { formatMessage } = $_710_index.a()
  var i = $_16_index.e(function (e) {
    var /* [auto-meaningful-name] */e$common$userInfo
    return null === (e$common$userInfo = e.common.userInfo) || undefined === e$common$userInfo ? undefined : e$common$userInfo.id
  })
  var a = React.useState(undefined === e$defaultExpanded || e$defaultExpanded)
  var s = $_10_index.a(a, 2)
  var c = s[0]
  var l = s[1]
  var u = "newWidgetCategory_".concat(Yr.f, "_").concat(i)
  var d = m()
  var p = !i || !d[e$title]
  function m() {
    var e = localStorage.getItem(u)
    return e ? JSON.parse(e) : {}
  }
  return e$configList.length ? (
    <div className={N($_196.categoryItem, k.a({}, $_196.expanded, c))}>
      <div
        className={N($_196.categoryHeader, window.innerWidth <= 1300 && $_196.categoryMinHeader)}
        onClick={() => {
          l(!c)
          if (Yr.k.includes(e$title) && i && !d[e$title]) {
            var e = m()
            e[e$title] = 1
            localStorage.setItem(u, JSON.stringify(e))
          }
        }}
      >
        <div className={$_196.categoryTitleBox}>
          <h3 className={N($_196.categoryTitle)}>
            {formatMessage({ id: e$title })}
          </h3>
          {Yr.k.includes(e$title) && p && <div className={$_196.newTips}>New</div>}
        </div>
        <span className={$_196.icon}>
          <$_94_index.a type="icon-fold" />
        </span>
      </div>
      {c && (
        <div className={$_196.categoryBody}>
          {e$configList.map((e) => {
            var /* [auto-meaningful-name] */e$type = e.type
            var /* [auto-meaningful-name] */e$icon = e.icon
            var /* [auto-meaningful-name] */e$previewAreaWidgetTitle = e.previewAreaWidgetTitle
            var /* [auto-meaningful-name] */_e$title = e.title
            var /* [auto-meaningful-name] */e$isInvisibleWidget = e.isInvisibleWidget
            var /* [auto-meaningful-name] */e$widgetServerId = e.widgetServerId
            return (
              !e.isDiscard && (
                <WidgetItem
                  key={e$type}
                  icon={e$icon}
                  title={
                    e$previewAreaWidgetTitle
                      ? formatMessage({ id: e$previewAreaWidgetTitle })
                      : _e$title
                  }
                  type={e$type}
                  widgetServerId={e$widgetServerId}
                  isMallExtensionWidget={$$_$$_$$_$$_src_shared_widget_custom_type.e(e$type)}
                  isInvisibleWidget={e$isInvisibleWidget}
                />
              )
            )
          })}
        </div>
      )}
    </div>
  ) : null
})

loadCustomWidget.s(r)
loadCustomWidget.s(o)
loadCustomWidget.s($_680)
loadCustomWidget.s($_682)
loadCustomWidget.s(a)
loadCustomWidget.s($_681)
loadCustomWidget.s(i)
loadCustomWidget.s(s)
loadCustomWidget.s(c)
loadCustomWidget.s(l)
loadCustomWidget.s(u)
loadCustomWidget.s(d)
loadCustomWidget.s(p)
var cv = loadCustomWidget.s($_679, tv)
var lv = loadCustomWidget.s($_686)
Et.Nb(Et.j.UI, [Cp, Lp, cv, Kp, tf, uf, _f, Tf, xf, Wf, Jf, ah, lv])
Et.Nb(Et.j.STAGE, [wh, xh, zh])
var uv = loadCustomWidget.s($_678)
var dv = loadCustomWidget.s($_688)
Et.Nb(Et.j.MEDIA, [Xh, nm, uv, dv])
var pv = loadCustomWidget.s($_687)
Et.Nb(Et.j.SENSOR, [im, cm, pv])
Et.Nb(Et.j.DATE, [hm, ym, wm])
var fv = loadCustomWidget.s($_683)
var hv = loadCustomWidget.s($_684_index)
var mv = loadCustomWidget.s($_685_index)
Et.Nb(Et.j.NETWORK, [Sm, Pm, fv, hv, mv])
Et.Nb(Et.j.LOCAL_STORAGE, [qm, eg, gg])
Et.Nb(Et.j.CLOUD_STORAGE, [Og, zm])
Et.Nb(Et.j.CLOUD_SPACE, [c_, __])
Et.Nb(Et.j.DATABASE, [cg])
export const BuiltInWidgetList = React.memo(() => {
  var t = Et.Eb(Et.j.UI)
  var n = Et.Eb(Et.j.STAGE)
  var r = Et.Eb(Et.j.MEDIA)
  var o = Et.Eb(Et.j.DATE)
  var i = Et.Eb(Et.j.SENSOR)
  var a = Et.Eb(Et.j.LOCAL_STORAGE)
  var s = Et.Eb(Et.j.CLOUD_SPACE)
  var c = Et.Eb(Et.j.NETWORK)
  var l = Et.Eb(Et.j.SOCIAL)
  return (
    <div className={$_196.scrollBasic}>
      <WidgetCategoryItem
        configList={t}
        title="WidgetList.category.ui"
        defaultExpanded
      />
      <WidgetCategoryItem
        configList={n}
        title="WidgetList.category.stage"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={r}
        title="WidgetList.category.media"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={o}
        title="WidgetList.category.dateTime"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={i}
        title="WidgetList.category.sensor"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={a}
        title="WidgetList.category.localStorage"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={s}
        title="WidgetList.category.cloudSpace"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={c}
        title="WidgetList.category.network"
        defaultExpanded={false}
      />
      <WidgetCategoryItem
        configList={l}
        title="WidgetList.category.social"
        defaultExpanded={false}
      />
    </div>
  )
})
