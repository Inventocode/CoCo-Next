<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=360,user-scalable=no"/>
        <!-- [CoCo Next] 添加 CoCo Next -->
        <meta name="description" content="CoCo Next"/>
        <title></title>
        <link rel="icon" href="/favicon.svg"/>
    </head>
    <body>
        <script>
            try {
                var url = new URL(window.location.href)
                  , title = url.searchParams.get("title");
                title && (document.title = title)
            } catch (t) {
                console.error("Set title error", t)
            }
        </script>
        <div id="loading">
            <style>
                #loading {
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                    align-items: center;
                    position: fixed;
                    left: 0;
                    top: 0;
                    right: 0;
                    bottom: 0;
                    z-index: -100;
                }
                #loading .logo {
                    width: 128px;
                }
                #loading .process-bar--wrapper {
                    border: 4px solid #6e4ff4;
                    border-radius: 100px;
                }
                #loading .process-bar--fill--wrapper {
                    width: 256px;
                    margin: 4px;
                }
                #loading .process--fill {
                    width: 0%;
                    height: 8px;
                    border-radius: 4px;
                    background-color: #6e4ff4;
                    transition: width 100ms;
                }
                #loading .text {
                    margin: 4px;
                }
                #loading .percentage {
                    float: right;
                }
            </style>
            <img class="logo" src="/favicon.svg" alt="logo.svg">
            <div class="info">
                <div class="process-bar--wrapper">
                    <div class="process-bar--fill--wrapper">
                        <div class="process--fill"></div>
                    </div>
                </div>
                <div class="text"><span class="prompt">努力加载中……</span>(<span class="ratio">0/0</span>)<span class="percentage">0%</span></div>
            </div>
            <script>

                const processFillElement = document.querySelector("#loading .process--fill")
                const promptElement = document.querySelector("#loading .prompt")
                const ratioElement = document.querySelector("#loading .ratio")
                const percentageElement = document.querySelector("#loading .percentage")

                let total = 0, loaded = 0, hasError = false

                function increaseProcess() {
                    loaded++
                    updateProcessBar()
                }

                function updateProcessBar() {
                    const process = loaded / total * 100
                    processFillElement.style.width = `${process}%`
                    ratioElement.innerText = `${loaded}/${total}`
                    percentageElement.innerText = `${Math.round(process)}%`
                }

                function handleError() {
                    if (!hasError) {
                        promptElement.innerText = "❌ 加载失败"
                        hasError = true
                    }
                }

                for (const element of document.querySelectorAll("script[src], link[rel=stylesheet]")) {
                    total++
                    element.addEventListener("load", increaseProcess)
                    element.addEventListener("error", handleError)
                }

                updateProcessBar()

                addEventListener("load", () => {
                    if (!hasError) {
                        document.getElementById("loading").remove()
                    }
                })
            </script>
        </div>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div id="root"></div>
    </body>
</html>
