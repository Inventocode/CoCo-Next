"use strict";(self.webpackChunkcoco_next=self.webpackChunkcoco_next||[]).push([[1861],{2180:(t,e,i)=>{i.r(e),i.d(e,{a:()=>a,default:()=>c});const o=i(57309);var n,r,s=(r=(n=o)&&n.__esModule?function(){return n.default}:function(){return n},Object.defineProperty(r,"a",{enumerable:!0,get:r}),r);function a(t){return t instanceof HTMLElement?t:s.a.findDOMNode(t)}const c=a},7467:(t,e,i)=>{i.r(e),i.d(e,{a:()=>a,default:()=>c});const o=i(57309);var n,r,s=(r=(n=o)&&n.__esModule?function(){return n.default}:function(){return n},Object.defineProperty(r,"a",{enumerable:!0,get:r}),r);function a(t,e,i,o){var n=s.a.unstable_batchedUpdates?function(t){s.a.unstable_batchedUpdates(i,t)}:i;return t.addEventListener&&t.addEventListener(e,n,o),{remove:function(){t.removeEventListener&&t.removeEventListener(e,n)}}}const c=a},15692:t=>{var e,i,o,n=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(t){if(e===setTimeout)return setTimeout(t,0);if((e===r||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(i){try{return e.call(null,t,0)}catch(i){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:r}catch(t){e=r}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(t){i=s}}();var c=[],_=!1,h=-1;function l(){_&&o&&(_=!1,o.length?c=o.concat(c):h=-1,c.length&&p())}function p(){if(!_){var t=a(l);_=!0;for(var e=c.length;e;){for(o=c,c=[];++h<e;)o&&o[h].run();h=-1,e=c.length}o=null,_=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function u(t,e){this.fun=t,this.array=e}function d(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];c.push(new u(t,e)),1!==c.length||_||a(p)},u.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=d,n.addListener=d,n.once=d,n.off=d,n.removeListener=d,n.removeAllListeners=d,n.emit=d,n.prependListener=d,n.prependOnceListener=d,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},21536:(t,e,i)=>{i.r(e),i.d(e,{a:()=>q,default:()=>J});const o=i(4264),n=i(30275),r=i(41460),s=i(11903),a=i(96540),c=i(64740),_=i(16229),h=i(19238),l=i(13505),p=i(77071),u=i(57309);var d,f,g=(f=(d=u)&&d.__esModule?function(){return d.default}:function(){return d},Object.defineProperty(f,"a",{enumerable:!0,get:f}),f);const y=i(53604);function v(t,e){return!!t&&t.contains(e)}const b=i(2180),m=i(91743),x=i(7467),w=i(68130);var T=a.forwardRef(function(t,e){var i=t.didUpdate,o=t.getContainer,n=t.children,r=a.useRef();a.useImperativeHandle(e,function(){return{}});var s=a.useRef(!1);return!s.current&&w.a()&&(r.current=o(),s.current=!0),a.useEffect(function(){null!=i&&i(t)}),a.useEffect(function(){return function(){var t,e;null!==(t=r.current)&&void 0!==t&&null!==(e=t.parentNode)&&void 0!==e&&e.removeChild(r.current)}},[]),r.current?g.a.createPortal(n,r.current):null}),k=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return Object.defineProperty(e,"a",{enumerable:!0,get:e}),e}(i(11412));function O(t,e,i){return i?t[0]===e[0]:t[0]===e[0]&&t[1]===e[1]}const A=i(89843),E=i(41139);function C(t){var e=t.prefixCls,i=t.motion,o=t.animation,n=t.transitionName;return i||(o?{motionName:"".concat(e,"-").concat(o)}:n?{motionName:n}:null)}function I(t){var e=t.prefixCls,i=t.visible,n=t.zIndex,s=t.mask,c=t.maskMotion,_=t.maskAnimation,h=t.maskTransitionName;if(!s)return null;var l={};return(c||h||_)&&(l=r.a({motionAppear:!0},C({motion:c,prefixCls:e,transitionName:h,animation:_}))),a.createElement(E.a,o.a({},l,{visible:i,removeOnLeave:!0}),function(t){var i=t.className;return a.createElement("div",{style:{zIndex:n},className:k()("".concat(e,"-mask"),i)})})}const P=i(641);var M=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return Object.defineProperty(e,"a",{enumerable:!0,get:e}),e}(i(47602));const S=i(42483);var L=["measure","align",null,"motion"],R=a.forwardRef(function(t,e){var i=t.visible,n=t.prefixCls,s=t.className,c=t.style,_=t.children,h=t.zIndex,l=t.stretch,p=t.destroyPopupOnHide,u=t.forceRender,d=t.align,f=t.point,g=t.getRootDomNode,v=t.getClassNameFromAlign,b=t.onAlign,m=t.onMouseEnter,x=t.onMouseLeave,w=t.onMouseDown,T=t.onTouchStart,O=a.useRef(),I=a.useRef(),R=a.useState(),N=A.a(R,2),D=N[0],G=N[1],j=function(t){var e=a.useState({width:0,height:0}),i=A.a(e,2),o=i[0],n=i[1];return[a.useMemo(function(){var e={};if(t){var i=o.width,n=o.height;-1!==t.indexOf("height")&&n?e.height=n:-1!==t.indexOf("minHeight")&&n&&(e.minHeight=n),-1!==t.indexOf("width")&&i?e.width=i:-1!==t.indexOf("minWidth")&&i&&(e.minWidth=i)}return e},[t,o]),function(t){n({width:t.offsetWidth,height:t.offsetHeight})}]}(l),F=A.a(j,2),z=F[0],B=F[1],H=function(t){var e=a.useState(null),i=A.a(e,2),o=i[0],n=i[1],r=a.useRef(),s=a.useRef(!1);function c(t){s.current||n(t)}function _(){y.a.cancel(r.current)}return a.useEffect(function(){c("measure")},[t]),a.useEffect(function(){"measure"===o&&l&&B(g()),o&&(r.current=y.a(S.a(M.a.mark(function t(){var e,i;return M.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=L.indexOf(o),(i=L[e+1])&&-1!==e&&c(i);case 3:case"end":return t.stop()}},t)}))))},[o]),a.useEffect(function(){return function(){s.current=!0,_()}},[]),[o,function(t){_(),r.current=y.a(function(){c(function(t){switch(o){case"align":return"motion";case"motion":return"stable"}return t}),null!=t&&t()})}]}(i),V=A.a(H,2),U=V[0],W=V[1],X=a.useRef();function Y(){var t;null!==(t=O.current)&&void 0!==t&&t.forceAlign()}function K(t,e){var i=v(e);D!==i&&G(i),"align"===U&&(D!==i?Promise.resolve().then(function(){Y()}):W(function(){var t;null!==(t=X.current)&&void 0!==t&&t.call(X)}),null!=b&&b(t,e))}var q=r.a({},C(t));function J(){return new Promise(function(t){X.current=t})}["onAppearEnd","onEnterEnd","onLeaveEnd"].forEach(function(t){var e=q[t];q[t]=function(t,i){return W(),null==e?void 0:e(t,i)}}),a.useEffect(function(){q.motionName||"motion"!==U||W()},[q.motionName,U]),a.useImperativeHandle(e,function(){return{forceAlign:Y,getElement:function(){return I.current}}});var Q=r.a(r.a({},z),{},{zIndex:h,opacity:"motion"!==U&&"stable"!==U&&i?0:void 0,pointerEvents:"stable"===U?void 0:"none"},c),Z=!0;!(null==d?void 0:d.points)||"align"!==U&&"stable"!==U||(Z=!1);var $=_;return a.Children.count(_)>1&&($=a.createElement("div",{className:"".concat(n,"-content")},_)),a.createElement(E.a,o.a({visible:i,ref:I,leavedClassName:"".concat(n,"-hidden")},q,{onAppearPrepare:J,onEnterPrepare:J,removeOnLeave:p,forceRender:u}),function(t,e){var i=t.className,o=t.style,c=k()(n,s,D,i);return a.createElement(P.a,{target:f||g,key:"popup",ref:O,monitorWindowResize:!0,disabled:Z,align:d,onAlign:K},a.createElement("div",{ref:e,className:c,onMouseEnter:m,onMouseLeave:x,onMouseDownCapture:w,onTouchStartCapture:T,style:r.a(r.a({},o),Q)},$))})});R.displayName="PopupInner";var N=R,D=a.forwardRef(function(t,e){var i=t.prefixCls,n=t.visible,s=t.zIndex,c=t.children,_=t.mobile,h=(_=void 0===_?{}:_).popupClassName,l=_.popupStyle,p=_.popupMotion,u=void 0===p?{}:p,d=_.popupRender,f=a.useRef();a.useImperativeHandle(e,function(){return{forceAlign:function(){},getElement:function(){return f.current}}});var g=r.a({zIndex:s},l),y=c;return a.Children.count(c)>1&&(y=a.createElement("div",{className:"".concat(i,"-content")},c)),d&&(y=d(y)),a.createElement(E.a,o.a({visible:n,ref:f,removeOnLeave:!0},u),function(t,e){var o=t.className,n=t.style,s=k()(i,h,o);return a.createElement("div",{ref:e,className:s,style:r.a(r.a({},n),g)},y)})});D.displayName="MobilePopupInner";var G=D,j=["visible","mobile"],F=a.forwardRef(function(t,e){var i=t.visible,n=t.mobile,c=s.a(t,j),_=a.useState(i),h=A.a(_,2),l=h[0],p=h[1],u=a.useState(!1),d=A.a(u,2),f=d[0],g=d[1],y=r.a(r.a({},c),{},{visible:l});a.useEffect(function(){p(i),i&&n&&g(function(){if("undefined"==typeof navigator||"undefined"==typeof window)return!1;var t=navigator.userAgent||navigator.vendor||window.opera;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(null==t?void 0:t.substr(0,4)))}())},[i,n]);var v=f?a.createElement(G,o.a({},y,{mobile:n,ref:e})):a.createElement(N,o.a({},y,{ref:e}));return a.createElement("div",null,a.createElement(I,y),v)});F.displayName="Popup";var z=F,B=a.createContext(null);function H(){}var V,U,W=["onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur","onContextMenu"],X=(V=T,U=function(t){l.a(i,t);var e=p.a(i);function i(t){var n,r;return c.a(this,i),(n=e.call(this,t)).popupRef=a.createRef(),n.triggerRef=a.createRef(),n.attachId=void 0,n.clickOutsideHandler=void 0,n.touchOutsideHandler=void 0,n.contextMenuOutsideHandler1=void 0,n.contextMenuOutsideHandler2=void 0,n.mouseDownTimeout=void 0,n.focusTime=void 0,n.preClickTime=void 0,n.preTouchTime=void 0,n.delayTimer=void 0,n.hasPopupMouseDown=void 0,n.onMouseEnter=function(t){var e=n.props.mouseEnterDelay;n.fireEvents("onMouseEnter",t),n.delaySetPopupVisible(!0,e,e?null:t)},n.onMouseMove=function(t){n.fireEvents("onMouseMove",t),n.setPoint(t)},n.onMouseLeave=function(t){n.fireEvents("onMouseLeave",t),n.delaySetPopupVisible(!1,n.props.mouseLeaveDelay)},n.onPopupMouseEnter=function(){n.clearDelayTimer()},n.onPopupMouseLeave=function(t){var e;t.relatedTarget&&!t.relatedTarget.setTimeout&&v(null===(e=n.popupRef.current)||void 0===e?void 0:e.getElement(),t.relatedTarget)||n.delaySetPopupVisible(!1,n.props.mouseLeaveDelay)},n.onFocus=function(t){n.fireEvents("onFocus",t),n.clearDelayTimer(),n.isFocusToShow()&&(n.focusTime=Date.now(),n.delaySetPopupVisible(!0,n.props.focusDelay))},n.onMouseDown=function(t){n.fireEvents("onMouseDown",t),n.preClickTime=Date.now()},n.onTouchStart=function(t){n.fireEvents("onTouchStart",t),n.preTouchTime=Date.now()},n.onBlur=function(t){n.fireEvents("onBlur",t),n.clearDelayTimer(),n.isBlurToHide()&&n.delaySetPopupVisible(!1,n.props.blurDelay)},n.onContextMenu=function(t){t.preventDefault(),n.fireEvents("onContextMenu",t),n.setPopupVisible(!0,t)},n.onContextMenuClose=function(){n.isContextMenuToShow()&&n.close()},n.onClick=function(t){if(n.fireEvents("onClick",t),n.focusTime){var e;if(n.preClickTime&&n.preTouchTime?e=Math.min(n.preClickTime,n.preTouchTime):n.preClickTime?e=n.preClickTime:n.preTouchTime&&(e=n.preTouchTime),Math.abs(e-n.focusTime)<20)return;n.focusTime=0}n.preClickTime=0,n.preTouchTime=0,n.isClickToShow()&&(n.isClickToHide()||n.isBlurToHide())&&t&&t.preventDefault&&t.preventDefault();var i=!n.state.popupVisible;(n.isClickToHide()&&!i||i&&n.isClickToShow())&&n.setPopupVisible(!n.state.popupVisible,t)},n.onPopupMouseDown=function(){var t;n.hasPopupMouseDown=!0,clearTimeout(n.mouseDownTimeout),n.mouseDownTimeout=window.setTimeout(function(){n.hasPopupMouseDown=!1},0),n.context&&(t=n.context).onPopupMouseDown.apply(t,arguments)},n.onDocumentClick=function(t){if(!n.props.mask||n.props.maskClosable){var e=t.target,i=n.getRootDomNode(),o=n.getPopupDomNode();v(i,e)&&!n.isContextMenuOnly()||v(o,e)||n.hasPopupMouseDown||n.close()}},n.getRootDomNode=function(){var t=n.props.getTriggerDOMNode;if(t)return t(n.triggerRef.current);try{var e=b.a(n.triggerRef.current);if(e)return e}catch(t){}return g.a.findDOMNode(h.a(n))},n.getPopupClassNameFromAlign=function(t){var e=[],i=n.props,o=i.popupPlacement,r=i.builtinPlacements,s=i.prefixCls,a=i.alignPoint,c=i.getPopupClassNameFromAlign;return o&&r&&e.push(function(t,e,i,o){for(var n=i.points,r=Object.keys(t),s=0;s<r.length;s+=1){var a=r[s];if(O(t[a].points,n,o))return"".concat(e,"-placement-").concat(a)}return""}(r,s,t,a)),c&&e.push(c(t)),e.join(" ")},n.getComponent=function(){var t=n.props,e=t.prefixCls,i=t.destroyPopupOnHide,r=t.popupClassName,s=t.onPopupAlign,c=t.popupMotion,_=t.popupAnimation,h=t.popupTransitionName,l=t.popupStyle,p=t.mask,u=t.maskAnimation,d=t.maskTransitionName,f=t.maskMotion,g=t.zIndex,y=t.popup,v=t.stretch,b=t.alignPoint,m=t.mobile,x=t.forceRender,w=n.state,T=w.popupVisible,k=w.point,O=n.getPopupAlign(),A={};return n.isMouseEnterToShow()&&(A.onMouseEnter=n.onPopupMouseEnter),n.isMouseLeaveToHide()&&(A.onMouseLeave=n.onPopupMouseLeave),A.onMouseDown=n.onPopupMouseDown,A.onTouchStart=n.onPopupMouseDown,a.createElement(z,o.a({prefixCls:e,destroyPopupOnHide:i,visible:T,point:b&&k,className:r,align:O,onAlign:s,animation:_,getClassNameFromAlign:n.getPopupClassNameFromAlign},A,{stretch:v,getRootDomNode:n.getRootDomNode,style:l,mask:p,zIndex:g,transitionName:h,maskAnimation:u,maskTransitionName:d,maskMotion:f,ref:n.popupRef,motion:c,mobile:m,forceRender:x}),"function"==typeof y?y():y)},n.attachParent=function(t){var e;y.a.cancel(n.attachId);var i=n.props,o=i.getPopupContainer,r=i.getDocument,s=n.getRootDomNode();o?(s||0===o.length)&&(e=o(s)):e=r(n.getRootDomNode()).body,e?e.appendChild(t):n.attachId=y.a(function(){n.attachParent(t)})},n.getContainer=function(){var t=(0,n.props.getDocument)(n.getRootDomNode()).createElement("div");return t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",n.attachParent(t),t},n.setPoint=function(t){n.props.alignPoint&&t&&n.setState({point:{pageX:t.pageX,pageY:t.pageY}})},n.handlePortalUpdate=function(){n.state.prevPopupVisible!==n.state.popupVisible&&n.props.afterPopupVisibleChange(n.state.popupVisible)},n.triggerContextValue={onPopupMouseDown:n.onPopupMouseDown},r="popupVisible"in t?!!t.popupVisible:!!t.defaultPopupVisible,n.state={prevPopupVisible:r,popupVisible:r},W.forEach(function(t){n["fire".concat(t)]=function(e){n.fireEvents(t,e)}}),n}return _.a(i,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var t,e=this.props;if(this.state.popupVisible)return this.clickOutsideHandler||!this.isClickToHide()&&!this.isContextMenuToShow()||(t=e.getDocument(this.getRootDomNode()),this.clickOutsideHandler=x.a(t,"mousedown",this.onDocumentClick)),this.touchOutsideHandler||(t=t||e.getDocument(this.getRootDomNode()),this.touchOutsideHandler=x.a(t,"touchstart",this.onDocumentClick)),!this.contextMenuOutsideHandler1&&this.isContextMenuToShow()&&(t=t||e.getDocument(this.getRootDomNode()),this.contextMenuOutsideHandler1=x.a(t,"scroll",this.onContextMenuClose)),void(!this.contextMenuOutsideHandler2&&this.isContextMenuToShow()&&(this.contextMenuOutsideHandler2=x.a(window,"blur",this.onContextMenuClose)));this.clearOutsideHandler()}},{key:"componentWillUnmount",value:function(){this.clearDelayTimer(),this.clearOutsideHandler(),clearTimeout(this.mouseDownTimeout),y.a.cancel(this.attachId)}},{key:"getPopupDomNode",value:function(){var t;return(null===(t=this.popupRef.current)||void 0===t?void 0:t.getElement())||null}},{key:"getPopupAlign",value:function(){var t=this.props,e=t.popupPlacement,i=t.popupAlign,o=t.builtinPlacements;return e&&o?function(t,e,i){var o=t[e]||{};return r.a(r.a({},o),i)}(o,e,i):i}},{key:"setPopupVisible",value:function(t,e){var i=this.props.alignPoint,o=this.state.popupVisible;this.clearDelayTimer(),o!==t&&("popupVisible"in this.props||this.setState({popupVisible:t,prevPopupVisible:o}),this.props.onPopupVisibleChange(t)),i&&e&&t&&this.setPoint(e)}},{key:"delaySetPopupVisible",value:function(t,e,i){var o=this,n=1e3*e;if(this.clearDelayTimer(),n){var r=i?{pageX:i.pageX,pageY:i.pageY}:null;this.delayTimer=window.setTimeout(function(){o.setPopupVisible(t,r),o.clearDelayTimer()},n)}else this.setPopupVisible(t,i)}},{key:"clearDelayTimer",value:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)}},{key:"clearOutsideHandler",value:function(){this.clickOutsideHandler&&(this.clickOutsideHandler.remove(),this.clickOutsideHandler=null),this.contextMenuOutsideHandler1&&(this.contextMenuOutsideHandler1.remove(),this.contextMenuOutsideHandler1=null),this.contextMenuOutsideHandler2&&(this.contextMenuOutsideHandler2.remove(),this.contextMenuOutsideHandler2=null),this.touchOutsideHandler&&(this.touchOutsideHandler.remove(),this.touchOutsideHandler=null)}},{key:"createTwoChains",value:function(t){var e=this.props.children.props,i=this.props;return e[t]&&i[t]?this["fire".concat(t)]:e[t]||i[t]}},{key:"isClickToShow",value:function(){var t=this.props,e=t.action,i=t.showAction;return-1!==e.indexOf("click")||-1!==i.indexOf("click")}},{key:"isContextMenuOnly",value:function(){var t=this.props.action;return"contextMenu"===t||1===t.length&&"contextMenu"===t[0]}},{key:"isContextMenuToShow",value:function(){var t=this.props,e=t.action,i=t.showAction;return-1!==e.indexOf("contextMenu")||-1!==i.indexOf("contextMenu")}},{key:"isClickToHide",value:function(){var t=this.props,e=t.action,i=t.hideAction;return-1!==e.indexOf("click")||-1!==i.indexOf("click")}},{key:"isMouseEnterToShow",value:function(){var t=this.props,e=t.action,i=t.showAction;return-1!==e.indexOf("hover")||-1!==i.indexOf("mouseEnter")}},{key:"isMouseLeaveToHide",value:function(){var t=this.props,e=t.action,i=t.hideAction;return-1!==e.indexOf("hover")||-1!==i.indexOf("mouseLeave")}},{key:"isFocusToShow",value:function(){var t=this.props,e=t.action,i=t.showAction;return-1!==e.indexOf("focus")||-1!==i.indexOf("focus")}},{key:"isBlurToHide",value:function(){var t=this.props,e=t.action,i=t.hideAction;return-1!==e.indexOf("focus")||-1!==i.indexOf("blur")}},{key:"forcePopupAlign",value:function(){var t;this.state.popupVisible&&null!==(t=this.popupRef.current)&&void 0!==t&&t.forceAlign()}},{key:"fireEvents",value:function(t,e){var i=this.props.children.props[t];i&&i(e);var o=this.props[t];o&&o(e)}},{key:"close",value:function(){this.setPopupVisible(!1)}},{key:"render",value:function(){var t=this.state.popupVisible,e=this.props,i=e.children,o=e.forceRender,n=e.alignPoint,s=e.className,c=e.autoDestroy,_=a.Children.only(i),h={key:"trigger"};this.isContextMenuToShow()?h.onContextMenu=this.onContextMenu:h.onContextMenu=this.createTwoChains("onContextMenu"),this.isClickToHide()||this.isClickToShow()?(h.onClick=this.onClick,h.onMouseDown=this.onMouseDown,h.onTouchStart=this.onTouchStart):(h.onClick=this.createTwoChains("onClick"),h.onMouseDown=this.createTwoChains("onMouseDown"),h.onTouchStart=this.createTwoChains("onTouchStart")),this.isMouseEnterToShow()?(h.onMouseEnter=this.onMouseEnter,n&&(h.onMouseMove=this.onMouseMove)):h.onMouseEnter=this.createTwoChains("onMouseEnter"),this.isMouseLeaveToHide()?h.onMouseLeave=this.onMouseLeave:h.onMouseLeave=this.createTwoChains("onMouseLeave"),this.isFocusToShow()||this.isBlurToHide()?(h.onFocus=this.onFocus,h.onBlur=this.onBlur):(h.onFocus=this.createTwoChains("onFocus"),h.onBlur=this.createTwoChains("onBlur"));var l=k()(_&&_.props&&_.props.className,s);l&&(h.className=l);var p,u=r.a({},h);m.c(_)&&(u.ref=m.a(this.triggerRef,_.ref));var d=a.cloneElement(_,u);return(t||this.popupRef.current||o)&&(p=a.createElement(V,{key:"portal",getContainer:this.getContainer,didUpdate:this.handlePortalUpdate},this.getComponent())),!t&&c&&(p=null),a.createElement(B.Provider,{value:this.triggerContextValue},d,p)}}],[{key:"getDerivedStateFromProps",value:function(t,e){var i=t.popupVisible,o={};return void 0!==i&&e.popupVisible!==i&&(o.popupVisible=i,o.prevPopupVisible=e.popupVisible),o}}]),i}(a.Component),U.contextType=B,U.defaultProps={prefixCls:"rc-trigger-popup",getPopupClassNameFromAlign:function(){return""},getDocument:function(t){return t?t.ownerDocument:window.document},onPopupVisibleChange:H,afterPopupVisibleChange:H,onPopupAlign:H,popupClassName:"",mouseEnterDelay:0,mouseLeaveDelay:.1,focusDelay:0,blurDelay:.15,popupStyle:{},destroyPopupOnHide:!1,popupAlign:{},defaultPopupVisible:!1,mask:!1,maskClosable:!0,action:[],showAction:[],hideAction:[],autoDestroy:!1},U);const Y=i(98844);var K=function(t){var e=t.overlay,i=t.prefixCls,o=t.id,n=t.overlayInnerStyle;return a.createElement("div",{className:"".concat(i,"-inner"),id:o,role:"tooltip",style:n},"function"==typeof e?e():e)},q=a.forwardRef(function(t,e){var i=t.overlayClassName,c=t.trigger,_=void 0===c?["hover"]:c,h=t.mouseEnterDelay,l=void 0===h?0:h,p=t.mouseLeaveDelay,u=void 0===p?.1:p,d=t.overlayStyle,f=t.prefixCls,g=void 0===f?"rc-tooltip":f,y=t.children,v=t.onVisibleChange,b=t.afterVisibleChange,m=t.transitionName,x=t.animation,w=t.motion,T=t.placement,k=void 0===T?"right":T,O=t.align,A=void 0===O?{}:O,E=t.destroyTooltipOnHide,C=void 0!==E&&E,I=t.defaultVisible,P=t.getTooltipContainer,M=t.overlayInnerStyle,S=s.a(t,["overlayClassName","trigger","mouseEnterDelay","mouseLeaveDelay","overlayStyle","prefixCls","children","onVisibleChange","afterVisibleChange","transitionName","animation","motion","placement","align","destroyTooltipOnHide","defaultVisible","getTooltipContainer","overlayInnerStyle"]),L=a.useRef(null);a.useImperativeHandle(e,function(){return L.current});var R=r.a({},S);"visible"in t&&(R.popupVisible=t.visible);var N=!1,D=!1;if("boolean"==typeof C)N=C;else if(C&&"object"===n.a(C)){var G=C.keepParent;N=!0===G,D=!1===G}return a.createElement(X,o.a({popupClassName:i,prefixCls:g,popup:function(){var e=t.arrowContent,i=void 0===e?null:e,o=t.overlay,n=t.id;return[a.createElement("div",{className:"".concat(g,"-arrow"),key:"arrow"},i),a.createElement(K,{key:"content",prefixCls:g,id:n,overlay:o,overlayInnerStyle:M})]},action:_,builtinPlacements:Y.a,popupPlacement:k,ref:L,popupAlign:A,getPopupContainer:P,onPopupVisibleChange:v,afterPopupVisibleChange:b,popupTransitionName:m,popupAnimation:x,popupMotion:w,defaultPopupVisible:I,destroyPopupOnHide:N,autoDestroy:D,mouseLeaveDelay:u,popupStyle:d,mouseEnterDelay:l},R),y)});const J=q},28312:(t,e,i)=>{var o;i.r(e),i.d(e,{a:()=>Ri,default:()=>Ni});const n=i(63116),r=i(47168),s=i(93361);var a={App:Symbol("App"),Data:Symbol("Data"),Events:Symbol("Events"),Textures:Symbol("Textures"),Scenes:Symbol("Scenes"),Scene:Symbol("Scene"),Transition:Symbol("Transition"),Actors:Symbol("Actors"),Actor:Symbol("Actor"),Stage:Symbol("Stage"),StageAnimation:Symbol("StageAnimation"),Physics:Symbol("Physics")};const c=i(98111),_=i(70667);var h=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},l=function(t,e){return function(i,o){e(i,o,t)}},p=function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,a)}c((o=o.apply(t,e||[])).next())})},u=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},d=function(){function t(t){var e=this;this.mouse_down_time=0,this.cancel_multi_touch=!1,this.on_stage_swipe=function(t){var i=e.get_app().stage;i.name&&e.events.fire("stage:swipe",{target_id:i.name,data:t})},this.events=t}return t.prototype.init=function(t){var e=this;this.app?console.warn("Application cannot be reinitialized."):(this.app=new s.b(t.renderer),this.app.stage.name=t.id?t.id:"stage",this.cancel_multi_touch=void 0!==t.cancel_multi_touch&&t.cancel_multi_touch,this.app.stage.pivot.set(-this.app.renderer.width/2,-this.app.renderer.height/2),this.app.stage.interactive=!0,this.app.stage.hitArea=new s.q(-this.app.renderer.width/2,-this.app.renderer.height/2,this.app.renderer.width,this.app.renderer.height),this.app.ticker.autoStart=!1,this.app.ticker.stop(),this.scene_container=new s.f,this.scene_container.name="scenes",this.scene_container.interactive=!0,this.app.stage.addChild(this.scene_container),new r.Manager(this.app.view,{recognizers:[[r.Swipe,{direction:r.DIRECTION_ALL}]]}).on("swipe",this.on_stage_swipe),this.app.stage.addListener("mousedown",function(t){return e.emit_mouse_event(t,"stage:mousedown")}),this.app.stage.addListener("mousemove",function(t){return e.emit_mouse_event(t,"stage:mousemove")}),this.app.stage.addListener("mouseup",function(t){return e.emit_mouse_event(t,"stage:mouseup")}),this.app.stage.addListener("mouseupoutside",function(t){return e.emit_mouse_event(t,"stage:mouseupoutside")}),this.app.stage.addListener("touchstart",function(t){return e.emit_mouse_event(t,"stage:touchstart")}),this.app.stage.addListener("touchmove",function(t){return e.emit_mouse_event(t,"stage:touchmove")}),this.app.stage.addListener("touchend",function(t){return e.emit_mouse_event(t,"stage:touchend")}),this.app.stage.addListener("touchendoutside",function(t){return e.emit_mouse_event(t,"stage:touchendoutside")}),this.app.stage.addListener("rightclick",function(t){return e.emit_mouse_event(t,"stage:rightclick")}),t.development&&_.a.set_log_enabled(!0))},t.prototype.get_app=function(){if(!this.app)throw new Error("Application needs init before using.");return this.app},t.prototype.get_app_view_size=function(){var t=this.get_app_view_resolution(),e=this.get_app().view,i=e.width,o=e.height;return{width:i/=t,height:o/=t}},t.prototype.get_app_view_resolution=function(){return this.get_app().renderer.resolution},t.prototype.get_scene_container=function(){if(!this.scene_container)throw new Error("Scene container needs init before using.");return this.scene_container},t.prototype.render=function(){this.get_app().ticker.started||this.get_app().render()},t.prototype.get_renderer_type=function(){return this.get_app().renderer.type},t.prototype.get_interaction_manager=function(){return this.get_app().renderer.plugins.interaction},t.prototype.get_extract_module=function(){return this.get_app().renderer.plugins.extract},t.prototype.screenshot=function(t){return p(this,void 0,void 0,function(){var e,i,o,n,r,s,a,c,_,h,l;return u(this,function(p){return e=t&&void 0!==t.scale?t.scale:.5,i=t&&t.type,o=t&&void 0!==t.quality?t.quality:1,n=this.get_app().view,r=n.width,s=n.height,a=document.createElement("canvas"),c=a.getContext("2d"),_=r*e,h=s*e,a.width=_,a.height=h,(l=new Image).src=this.get_app().view.toDataURL(i,o),[2,new Promise(function(e,n){l.onload=function(){if(c){c.drawImage(l,0,0,_,h),t&&t.handstand&&(c.clearRect(0,0,_,h),c.translate(_/2,h/2),c.rotate(Math.PI),c.translate(-_/2,-h/2),c.scale(-1,1),c.drawImage(l,0,0,-_,h));var n=a.toDataURL(i,o);e(n)}},l.onerror=function(t){n(t)}})]})})},t.prototype.get_screenshot=function(t){return p(this,void 0,void 0,function(){var e,i=this;return u(this,function(o){return e=this.get_app().renderer,[2,new Promise(function(o,n){e.once("postrender",function(){i.screenshot(t).then(function(t){return o(t)}).catch(function(t){return n(t)})}),e.render(i.get_app().stage)})]})})},t.prototype.resize=function(t,e){var i=this.get_app(),o=i.stage,n=i.renderer;o.pivot.set(-t/2,-e/2),o.hitArea=new s.q(-t/2,-e/2,t,e),n.resize(t,e),o.name&&this.events.fire("stage:resize",{target_id:o.name,data:{width:t,height:e}})},t.prototype.destroy=function(){this.get_app().destroy(!0,!0),this.app=void 0},t.prototype.emit_mouse_event=function(t,e){var i=this.get_app().stage,o=t.data.getLocalPosition(i),n=o.x,r=o.y;switch(e){case"stage:mousedown":case"stage:touchstart":this.mouse_down_time=(new Date).getTime();break;case"stage:mouseup":case"stage:touchend":(new Date).getTime()-this.mouse_down_time<1e3&&i.name&&this.events.fire("stage:click",{target_id:i.name,data:{position:{x:n,y:-r}}})}if(i.name&&this.events.fire(e,{target_id:i.name,data:{position:{x:n,y:-r}}}),this.cancel_multi_touch){var s=t.data.originalEvent;c.o(s)&&s.touches.length>1&&this.events.emit_break_event()}},function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}([n.injectable(),l(0,n.inject(a.Events)),h("design:paramtypes",[Object])],t)}();const f=i(95210);var g,y=function(t,e){var i,o,n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},v=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(y(arguments[e]));return t};function b(t,e,i,n){n=n||{mode:"vertex"};for(var r,a,c,_,h,l=[],p=-1,u=o.SKIP,d=0,f=t.length,g=3;g<f;g++)if(t[g]>>>24>0){p=g;break}if(p>=0){r=c=p%e|0,a=_=p/e|0;do{switch((h=b(r,a))===o.MOVE_UP?a--:h===o.MOVE_DOWN?a++:h===o.MOVE_LEFT?r--:h===o.MOVE_RIGHT&&r++,n.mode){case"vertex":h!==u&&l.push(new s.m(r,a));break;case"step":d%n.step===0&&l.push(new s.m(r,a));break;case"mixed":h!==u?(l.push(new s.m(r,a)),d=0):d%n.step===0&&l.push(new s.m(r,a))}u=h,d++}while(r!==c||a!==_);n.tolerance&&(l=function t(e,i,o){var n=e.length-1;if(n<2)return e;for(var r=e[0],a=e[n],c=i*i,_=-1,h=0,l=1;l<n;l++){var p=m(e[l],r,a);p>h&&(h=p,_=l)}if(h<=c){if(!o)return[r,a];var u=Math.floor(Math.sqrt(x(r,a))/o),d=[];for(l=1;l<u;l++)d.push(new s.m(r.x+(a.x-r.x)*l/u,r.y+(a.y-r.y)*l/u));return v([r],d,[a])}var f=e.slice(0,_+1),g=e.slice(_),y=t(f,i,o),b=t(g,i,o);return y.slice(0,y.length-1).concat(b)}(l,n.tolerance,n.step))}function y(o,n){return o>=0&&n>=0&&o<e&&n<i&&t[n*e+o]>>>24>0}function b(t,e){var i,n=0;return y(t-1,e-1)&&(n|=1),y(t,e-1)&&(n|=2),y(t-1,e)&&(n|=4),y(t,e)&&(n|=8),6===n?u===o.MOVE_UP?o.MOVE_LEFT:o.MOVE_RIGHT:9===n?u===o.MOVE_RIGHT?o.MOVE_UP:o.MOVE_DOWN:1===(i=n)||5===i||13===i?o.MOVE_UP:8===i||10===i||11===i?o.MOVE_DOWN:4===i||12===i||14===i?o.MOVE_LEFT:2===i||3===i||7===i?o.MOVE_RIGHT:o.SKIP}return l}function m(t,e,i){var o=x(e,i);if(!o)return 0;var n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return x(t,n<0?e:n>1?i:new s.m(e.x+n*(i.x-e.x),e.y+n*(i.y-e.y)))}function x(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o}(g=o||(o={}))[g.MOVE_UP=0]="MOVE_UP",g[g.MOVE_DOWN=1]="MOVE_DOWN",g[g.MOVE_LEFT=2]="MOVE_LEFT",g[g.MOVE_RIGHT=3]="MOVE_RIGHT",g[g.SKIP=4]="SKIP";const w=i(2613);function T(t,e){var i=function(t){for(var e=[],i=0,o=0,n=0,r=0;r<t.length;r++)if(0===r){var s=t[t.length-1];o=i=s.x===t[0].x?1/0:(s.y-t[0].y)/(s.x-t[0].x),e.push(s)}else{var a;if(i===(a=t[r-1].x===t[r].x?1/0:(t[r-1].y-t[r].y)/(t[r-1].x-t[r].x))||Math.abs(i-a)<.001)continue;i=a,r===t.length-1&&(n=a),e.push(t[r-1])}return(o===n||Math.abs(o-n)<.001)&&e.shift(),e}(t);if(i.length){for(var o=i.length,n=function t(e){for(var i=0,o=0,n=0;n<e.length;n++){var r=O(n+1,e.length),s=O(n+2,e.length);S(e[n],e[r],e[s])===I?i++:o++}if(o===i){var a=w.a(e);return a.pop(),t(a)}return o>i}(i),r=void 0,s=-1,a=0;a<o;a++){var c=i[a],_=O(a+1,o),h=O(a+2,o),l=S(c,i[_],i[h]);if(n&&l===I){r=i[_],s=_;break}if(!n&&l===P){r=i[_],s=_;break}}if(r){var p=s,u=O(p+1,o),d=O(p-1,o),f=E(i[d],i[p],i[u]),g=(2*Math.PI-f)/2,y=100,v=0;for(a=0;a<o;a++)if(a!==p&&a!==d&&a!==u){var b=S(i[d],i[p],i[a]);if((n&&b===P||!n&&b===I||b===M)&&!k(i,d,p,u,a)){var m=E(i[d],i[p],i[a]),x=Math.abs(m-g);x<y&&(y=x,v=a)}}var A=function(t,e,i){var o=Math.min(e,i),n=Math.max(e,i),r=t[o],s=t[n],a=o+1,c=Math.abs(e-i)-1,_=[],h=a+c-t.length;if(h>0)for(var l=0;l<h;l++){var p=t.shift();t.push(p),a--}return(_=t.splice(a,c)).push(s,r),[_,t]}(i,p,v);T(A[0],e),T(A[1],e)}else e.push(i)}}function k(t,e,i,o,n){for(var r=[e,i,o],s=[O(n-1,t.length),n,O(n+1,t.length)],a=0;a<t.length;a++){var c=(a+1)%t.length;if(!(r.indexOf(a)>=0&&r.indexOf(c)>=0)&&!(s.indexOf(a)>=0&&s.indexOf(c)>=0)&&R(t[a],t[c],t[i],t[n]))return!0}return!1}function O(t,e){return t>=e?t%e:t<0?e+t%e:t}function A(t,e){var i=function(t,e){return Math.hypot(e.x-t.x,e.y-t.y)}(t,e),o=(e.x-t.x)/i;return e.y>=t.y?Math.acos(o):2*Math.PI-Math.acos(o)}function E(t,e,i){var o=A(e,t),n=A(e,i),r=Math.abs(o-n);return r>Math.PI?2*Math.PI-r:r}var C,I=1,P=2,M=4;function S(t,e,i){var o=A(t,e),n=A(t,i);return Math.abs(o-n)<.001||Math.abs(o-n-Math.PI)<.001?L(i.x,t.x,e.x)&&L(i.y,t.y,e.y)?3:M:o<=Math.PI?n<o||n-o>Math.PI?I:P:n>o||o-n>Math.PI?P:I}function L(t,e,i){return t>=e&&t<=i||t>=i&&t<=e}function R(t,e,i,o){if(N(t,i)||N(t,o)||N(e,i)||N(e,o))return!0;var n=function(t,e,i,o){var n=e.y-t.y,r=t.x-e.x,a=e.x*t.y-t.x*e.y,c=o.y-i.y,_=i.x-o.x,h=o.x*i.y-i.x*o.y,l=c*r-n*_;if(0!==l){var p=(_*a-r*h)/l,u=(n*h-c*a)/l;return new s.o(p,u)}}(t,e,i,o);return n?L(n.x,t.x,e.x)&&L(n.x,i.x,o.x)&&L(n.y,t.y,e.y)&&L(n.y,i.y,o.y):3===S(t,e,i)||3===S(t,e,o)}function N(t,e){return t.x===e.x&&t.y===e.y}var D=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},G=function(){function t(t){this.scenes_cache=new Map,this.actors_cache=new Map,this.textures_points_color_data=new Map,this.textures_bounds_points=new Map,this.textures_internal_points=new Map,this.textures_convex_groups=new Map,this.sprite_sheets=new Map,this.app=t}return t.prototype.get_texture=function(t){var e=s.B.TextureCache[t];if(e instanceof s.y)return e},t.prototype.get_texture_points_color_data=function(t){var e=this.textures_points_color_data.get(t);if(e)return e;var i=this.get_texture(t);return i?this.set_points_data(t,i):void 0},t.prototype.get_texture_points_position=function(t){var e=this.get_texture_internal_points(t),i=this.get_texture_bounds_points(t);if(e&&i)return e.concat(i)},t.prototype.get_texture_internal_points=function(t){var e=this.textures_internal_points.get(t);if(e)return e;var i=this.get_texture(t),o=this.get_texture_points_color_data(t);if(i&&o){var n=c.f({width:i.width,height:i.height}),r=function(t,e,i,o,n){var r,a,c,_;void 0===o&&(o=12),void 0===n&&(n=0);var h=[],l=function(o,n){return o>=0&&n>=0&&o<e&&n<i&&t[n*e+o]>>>24>0};for(r=0,a=0;a<i;r+=o)if(r>e&&(r=0,a+=o),!(a>i)){var p=n?(Math.random()-.5)*n+r:r,u=n?(Math.random()-.5)*n+a:a;l((c=p)-1,(_=u)-1)&&l(c,_-1)&&l(c-1,_)&&l(c,_)&&h.push(new s.m(p,u))}return h}(o,n.width,n.height);if(r)return this.textures_internal_points.set(t,r),r}},t.prototype.get_texture_bounds_points=function(t){var e=this.textures_bounds_points.get(t);if(e)return e;var i=this.get_texture(t),o=this.get_texture_points_color_data(t);if(i&&o){var n=c.f({width:i.width,height:i.height}),r=b(o,n.width,n.height,{mode:"step",step:5});if(r)return this.textures_bounds_points.set(t,r),r}},t.prototype.get_texture_convex_groups=function(t){var e=this.textures_convex_groups.get(t);if(e)return e;var i=this.collect_texture_convex_groups(t);return i?(this.textures_convex_groups.set(t,i),i):void 0},t.prototype.collect_texture_convex_groups=function(t){var e=this.get_texture(t),i=this.get_texture_points_color_data(t);if(e&&i){var o=c.f({width:e.width,height:e.height}),n=b(i,o.width,o.height,{mode:"vertex",tolerance:5});if(n){var r=[];return T(n,r),r}}},t.prototype.set_points_data=function(t,e){var i=e.baseTexture.getDrawableSource&&e.baseTexture.getDrawableSource(),o=document.createElement("canvas"),n=o.getContext("2d");if(n&&i){var r=c.f({width:e.width,height:e.height});o.width=r.width||1,o.height=r.height||1,n.drawImage(i,0,0,o.width,o.height);var s=new Uint32Array(n.getImageData(0,0,o.width,o.height).data.buffer);return this.textures_points_color_data.set(t,s),s}},t.prototype.get_internal_scene=function(t){var e=this.scenes_cache.get(t);if(e)return e;for(var i=this.app.get_scene_container().children,o=0;o<i.length;o++){var n=i[o];if(c.m(n)&&n.id===t)return this.scenes_cache.set(t,n),n}},t.prototype.get_internal_actor=function(t,e){var i,o,n,r,s=this.actors_cache.get(t),a=function(t){return!e||f.a(t.get_id(),e)};if(s)return!e||a(s.get_parent_scene())?s:void 0;var _=this.app.get_scene_container().children;try{for(var h=D(_),l=h.next();!l.done;l=h.next()){var p=l.value;if(c.m(p)&&a(p)){var u=p.get_actor_container().children;try{for(n=void 0,g=(d=D(u)).next();!g.done;g=d.next()){var d,g,y=g.value;if(c.k(y)&&y.id===t){var v=y.get_actor();return this.actors_cache.set(t,v),v}}}catch(t){n={error:t}}finally{try{g&&!g.done&&(r=d.return)&&r.call(d)}finally{if(n)throw n.error}}}}}catch(t){i={error:t}}finally{try{l&&!l.done&&(o=h.return)&&o.call(h)}finally{if(i)throw i.error}}},t.prototype.get_target=function(t){return this.get_internal_scene(t)||this.get_internal_actor(t)},t.prototype.clear_scene_cache=function(t){this.scenes_cache.get(t)&&this.scenes_cache.delete(t)},t.prototype.clear_actor_cache=function(t){this.actors_cache.get(t)&&this.actors_cache.delete(t)},t.prototype.clear_texture_points_cache=function(t){this.textures_points_color_data.get(t)&&this.textures_points_color_data.delete(t),this.textures_bounds_points.get(t)&&this.textures_bounds_points.delete(t),this.textures_internal_points.get(t)&&this.textures_internal_points.delete(t),this.textures_convex_groups.get(t)&&this.textures_convex_groups.delete(t)},t.prototype.clear_all_scenes_cache=function(){this.scenes_cache.clear()},t.prototype.clear_all_actors_cache=function(){this.actors_cache.clear()},t.prototype.clear_all_textures_points_cache=function(){this.textures_points_color_data.clear(),this.textures_bounds_points.clear(),this.textures_internal_points.clear(),this.textures_convex_groups.clear()},t.prototype.get_sprite_sheet_data=function(t){return this.sprite_sheets.get(t)},t.prototype.parse_and_cache_sprite_sheet_data=function(t,e,i){var o=this;return new Promise(function(n,r){var a=o.sprite_sheets.get(t);a&&n(a);var c=o.get_texture(e);if(c){var _=new s.u(c,i);_.parse(function(){if(_.textures){var i={origin_texture_id:e,texture_ids:Object.keys(_.textures)};o.sprite_sheets.set(t,i),n(i)}else n(void 0)})}else n(void 0)})},t.prototype.clear_sprite_sheet_cache=function(t){return this.sprite_sheets.delete(t)},t.prototype.clear_all_sprite_sheet_cache=function(){this.sprite_sheets.clear()},t.prototype.is_texture_in_sprite_sheet=function(t){var e,i,o=this.sprite_sheets.values();try{for(var n=D(o),r=n.next();!r.done;r=n.next()){var s=r.value;if(f.a(t,s.texture_ids))return!0}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return!1},t}(),j=function(){function t(){this.event_emitter=new s.B.EventEmitter,this.disabled=0,this.fire_queue=[]}return t.prototype.disable=function(){this.disabled++},t.prototype.enable=function(){if(this.disabled<=0)return this.disabled=0,new _.a("Do not use enable more than once");this.disabled--},t.prototype.is_enabled=function(){return 0===this.disabled},t.prototype.add_listener=function(t,e){this.event_emitter.addListener(t,e)},t.prototype.remove_listener=function(t,e){this.event_emitter.removeListener(t,e)},t.prototype.fire=function(t,e){this.is_enabled()&&(this.fire_queue.push([t,e]),this.release())},t.prototype.emit_break_event=function(t){this.event_emitter.emit("break",t)},t.prototype.release=function(){var t=this.fire_queue.shift();t&&(this.emit(t[0],t[1]),this.release())},t.prototype.emit=function(t,e){this.event_emitter.emit(t,e)},function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}([n.injectable()],t)}();const F=i(72505);var z,B,H,V=(B=(z=F)&&z.__esModule?function(){return z.default}:function(){return z},Object.defineProperty(B,"a",{enumerable:!0,get:B}),B),U=function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,a)}c((o=o.apply(t,e||[])).next())})},W=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}},X="Cannot load the image of sprite sheet",Y=function(){function t(t){this.data=t,this.loading_urls=new Set}return t.prototype.load_texture=function(t,e){return U(this,void 0,void 0,function(){var i;return W(this,function(o){return this.data.get_texture(t)?[2,new _.a("Texture "+t+" already exists. Please use new texture id")]:(i=s.y.from(e),s.y.addToCache(i,t),i.valid?[2,new _.a("This texture "+t+" is already available in pixi")]:[2,new Promise(function(t,e){i.baseTexture.on("loaded",function(){t()}),i.baseTexture.on("update",function(){t()}),i.baseTexture.on("error",function(t){i.destroy(!0),e(t)})})])})})},t.prototype.get_texture_img_url=function(t){var e=this.data.get_texture(t);if(!e)return _.b.error("Cannot find texture "+t);var i=e.baseTexture.getDrawableSource&&e.baseTexture.getDrawableSource();return i&&i instanceof HTMLImageElement?_.b.success(i.src):_.b.error("Cannot get url because source is not ImageElement")},t.prototype.destroy_texture=function(t){var e=this.data.get_texture(t);return e?this.data.is_texture_in_sprite_sheet(t)?new _.a("Texture "+t+" is part of sprite sheet. Cannot destroy it alone"):(e.destroy(!0),void this.data.clear_texture_points_cache(t)):new _.a("Cannot find texture "+t)},t.prototype.clear_texture_cache=function(t){if(!this.data.get_texture(t))return new _.a("Cannot find texture "+t);delete s.B.TextureCache[t],this.data.clear_texture_points_cache(t)},t.prototype.clear_all_textures_cache=function(){this.data.clear_all_textures_points_cache()},t.prototype.destroy_all_textures=function(){s.B.destroyTextureCache(),s.B.clearTextureCache(),this.data.clear_all_textures_points_cache(),this.data.clear_all_sprite_sheet_cache()},t.prototype.load_sprite_sheet=function(t){return U(this,void 0,void 0,function(){var e,i,o,n,r,a,c,h,l=this;return W(this,function(p){switch(p.label){case 0:if(e=this.data.get_sprite_sheet_data(t))return new _.a("Sprite sheet already exists."),[2,e.texture_ids];if(this.loading_urls.has(t))return[2,new _.a("Sprite sheet is being loaded.")];this.loading_urls.add(t),i=function(){return l.loading_urls.delete(t)},p.label=1;case 1:return p.trys.push([1,3,,4]),[4,V.a.get(t)];case 2:return n=p.sent(),o=n.data,[3,4];case 3:return r=p.sent(),i(),[2,new _.a(r)];case 4:a=s.B.url.resolve(t,o.meta.image),c="SPRITE_SHEET_"+t,p.label=5;case 5:return p.trys.push([5,7,,8]),[4,this.load_texture(c,a)];case 6:return p.sent(),h=this.data.get_texture(c),[3,8];case 7:return p.sent(),i(),[2,new _.a(X)];case 8:return h?[4,this.data.parse_and_cache_sprite_sheet_data(t,c,o)]:(i(),[2,new _.a(X)]);case 9:return(e=p.sent())?(i(),[2,e.texture_ids]):(i(),[2,new _.a("Cannot parse sprite sheet textures.")])}})})},t.prototype.destroy_sprite_sheet=function(t){var e=this,i=this.data.get_sprite_sheet_data(t);if(!i)return new _.a("Cannot find sprite sheet "+t);i.texture_ids.forEach(function(t){var i=e.data.get_texture(t);i&&i.destroy()});var o=this.data.get_texture(i.origin_texture_id);o&&o.destroy(!0),this.data.clear_sprite_sheet_cache(t)},t.prototype.get_sprite_sheet_texture_ids=function(t){var e=this.data.get_sprite_sheet_data(t);if(e)return e.texture_ids},t}();!function(t){t[t.QUAD=0]="QUAD",t[t.BOUNCE=1]="BOUNCE"}(C||(C={}));var K=function(t){return 1-(1-t)*(1-t)},q=function(t){var e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375};!function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.ALPHA=2]="ALPHA",t[t.ANGLE=3]="ANGLE"}(H||(H={}));var J=function(){function t(t){this.handler_cache=new Set,this.app=t}return t.prototype.update_attributes=function(t,e,i){var o,n;if(!(t instanceof s.A))switch(i){case H.X:return n=e-t.x,o=t.x,function(e){t.position.set(o+n*e,t.position.y)};case H.Y:return n=e-t.y,o=t.y,function(e){t.position.set(t.position.x,o+n*e)};case H.ALPHA:return n=e-t.alpha,o=t.alpha,function(e){t.alpha=o+n*e}}if(i===H.ANGLE)return n=e-t.angle,o=t.angle,function(e){t.angle=o+n*e}},t.prototype.create_tween=function(t){var e,i,o=this,n=t.target,r=1e3*t.duration,a=performance.now(),c=(null===(e=t.to_options)||void 0===e?void 0:e.ease)||C.QUAD,_=t.to_options,h=t.delay?1e3*t.delay:0;switch(c){case C.QUAD:i=K;break;case C.BOUNCE:i=q}var l={};n instanceof s.A||(void 0!==_.x&&_.x-n.position.x!==0&&(l.update_x=this.update_attributes(n,_.x,H.X)),void 0!==_.y&&_.y-n.position.y!==0&&(l.update_y=this.update_attributes(n,_.y,H.Y)),void 0!==_.visible&&(n.visible=_.visible),void 0!==_.alpha&&(l.update_alpha=this.update_attributes(n,_.alpha,H.ALPHA))),void 0!==_.angle&&(l.update_angle=this.update_attributes(n,_.angle,H.ANGLE));var p=function t(){var e=performance.now();if(!(h>0&&a+h>e)){var n=(e-a-h)/r,s=i(n);if(n>1)return o.update_target(l,s),void o.remove_ticker(t);o.update_target(l,s)}};this.handler_cache.add(p),this.app.get_app().ticker.add(p)},t.prototype.update_target=function(t,e){t.update_x&&t.update_x(e),t.update_y&&t.update_y(e),t.update_alpha&&t.update_alpha(e),t.update_angle&&t.update_angle(e)},t.prototype.to=function(t,e,i,o){return this.create_tween({target:t,duration:e,to_options:i,delay:o}),this},t.prototype.from=function(t,e,i,o){var n={angle:t.angle};return t instanceof s.A||(n.x=t.position.x,n.y=t.position.x,n.visible=t.visible,n.alpha=t.alpha),this.set_target_initial_state(t,i),this.create_tween({target:t,duration:e,to_options:n,delay:o}),this},t.prototype.from_to=function(t,e,i,o,n){return this.set_target_initial_state(t,i),this.create_tween({target:t,duration:e,to_options:o,delay:n}),this},t.prototype.set_target_initial_state=function(t,e){t instanceof s.A||(void 0!==e.x&&(t.position.x=e.x),void 0!==e.y&&(t.position.y=e.y),void 0!==e.alpha&&(t.alpha=e.alpha),void 0!==e.visible&&(t.visible=e.visible)),void 0!==e.angle&&(t.angle=e.angle)},t.prototype.set_complete_handler=function(t){this.on_complete=t},t.prototype.get_cache_size=function(){return this.handler_cache.size},t.prototype.clear=function(){var t=this;this.handler_cache.forEach(function(e){t.app.get_app().ticker.remove(e)}),this.handler_cache.clear(),this.on_complete=void 0},t.prototype.remove_ticker=function(t){this.app.get_app().ticker.remove(t),this.handler_cache.delete(t),0===this.handler_cache.size&&(this.on_complete&&this.on_complete(),this.on_complete=void 0)},t}(),Q=function(){function t(t){this.app=t,this.tl=new J(this.app)}return t.prototype.on_complete=function(){},t.prototype.set_transition=function(t,e,i,o){var n=this;if(this.clear_tl(e,i),this.on_complete=function(){n.reset_scenes(e,i),o&&o()},"none"!==t)switch(this.tl.set_complete_handler(this.on_complete),this.scene_destroy_handler=function(){n.clear_tl(e,i),n.scene_destroy_handler=void 0},e.add_listener("destroy",this.scene_destroy_handler),i.add_listener("destroy",this.scene_destroy_handler),t){case"slide_up":case"slide_left":case"slide_down":case"slide_right":return void this.set_slide_transition(e,i,t);case"bounce_up":case"bounce_down":case"bounce_left":case"bounce_right":return void this.set_bounce_transition(i,t);case"fade_in_out":return void this.set_fade_transition(e,i);case"distort":return void this.set_distort_transition(e,i)}else o&&o()},t.prototype.set_slide_transition=function(t,e,i){var o=this.app.get_app().view,n=o.width,r=o.height;e.visible=!0;var s=0,a=0;switch(i){case"slide_down":e.position.y=-r,a=r;break;case"slide_up":e.position.y=r,a=-r;break;case"slide_left":e.position.x=n,s=-n;break;case"slide_right":e.position.x=-n,s=n}this.tl.to(t,.5,{x:s,y:a,ease:C.QUAD}).to(e,.5,{x:0,y:0,ease:C.QUAD})},t.prototype.set_bounce_transition=function(t,e){var i=this.app.get_app(),o=this.app.get_scene_container(),n=i.view,r=n.width,s=n.height;switch(this.in_scene_origin_z_index=o.getChildIndex(t),o.setChildIndex(t,o.children.length-1),t.visible=!0,e){case"bounce_down":t.position.y=-s;break;case"bounce_up":t.position.y=s;break;case"bounce_left":t.position.x=r;break;case"bounce_right":t.position.x=-r}this.tl.to(t,1,{x:0,y:0,ease:C.BOUNCE})},t.prototype.set_fade_transition=function(t,e){e.visible=!0,e.alpha=0,this.tl.to(t,.5,{alpha:0,ease:C.QUAD}).from_to(e,.5,{alpha:0},{alpha:1,ease:C.QUAD})},t.prototype.set_distort_transition=function(t,e){var i=this.app.get_app(),o=i.view,n=o.width,r=o.height,a=new s.r(new s.d({width:n,height:r})),_=new s.r(new s.d({width:n,height:r}));t.visible=!0,e.visible=!1,i.renderer.render(i.stage,{renderTexture:a}),t.visible=!1,e.visible=!0,i.renderer.render(i.stage,{renderTexture:_}),this.out_sprite=s.t.from(a),this.out_sprite.anchor.set(.5),this.in_sprite=s.t.from(_),this.in_sprite.anchor.set(.5);var h=Math.min(n,r),l=new s.o(n/2,r/2),p=new s.A({radius:h,angle:0,padding:10});p.offset=l;var u=new s.A({radius:h,angle:c.b(189),padding:10});u.offset=l,this.out_sprite.filters=[p],this.in_sprite.filters=[u],i.stage.addChild(this.out_sprite,this.in_sprite),this.tl.from_to(this.out_sprite,.5,{alpha:1},{alpha:0}).from_to(p,.5,{angle:0},{angle:c.b(-227.8)}).from_to(this.in_sprite,.5,{visible:!0,alpha:0},{visible:!0,alpha:1},.1).to(u,.5,{angle:0},.1)},t.prototype.clear_tl=function(t,e){this.tl.get_cache_size()&&(this.reset_scenes(t,e),this.tl.clear())},t.prototype.reset_scenes=function(t,e){t.x=0,t.y=0,t.alpha=1,e.x=0,e.y=0,e.alpha=1,this.scene_destroy_handler&&(t.remove_listener("destroy",this.scene_destroy_handler),e.remove_listener("destroy",this.scene_destroy_handler),this.scene_destroy_handler=void 0),void 0!==this.in_scene_origin_z_index&&(this.app.get_scene_container().setChildIndex(e,this.in_scene_origin_z_index),this.in_scene_origin_z_index=void 0),this.out_sprite&&(this.out_sprite.destroy({children:!0,texture:!0,baseTexture:!0}),this.out_sprite=void 0),this.in_sprite&&(this.in_sprite.destroy({children:!0,texture:!0,baseTexture:!0}),this.in_sprite=void 0)},t}();const Z=i(35162),$=i(15349);var tt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),et=function(t){function e(e,i,o,n,r,s,a,c,_){var h=t.call(this,e,o,n)||this;return h.type=Z.d.Background,h.rotation_type=Z.e.ALL,h.rotation_value=0,h.is_horizontal_flipped=!1,h.is_vertical_flipped=!1,h.is_rotation_flipped=!1,h.transform_offset={pivot:{x:0,y:0},position:{x:0,y:0}},h.custom_pivot={x:0,y:0},h.adaptive_scale={x:1,y:1},h.transform_position={x:0,y:0},h.on_resize=function(t){t.target_id===h.app.get_app().stage.name&&(h.width=t.data.width,h.height=t.data.height)},h.id=_,h.name=_,h.texture_id=i,h.anchor.set(.5),h.interactive=!0,h.emit_scene_event=r,h.app=s,h.data=a,h.events=c,h.events.add_listener("stage:resize",h.on_resize),h}return tt(e,t),e.prototype.set_position=function(t,e){this.update_pixi_position(t,e),this.emit_scene_event("change",{position:this.transform_position})},e.prototype.set_position_x=function(t){var e=this.get_position().y;this.set_position(t,e)},e.prototype.set_position_y=function(t){var e=this.get_position().x;this.set_position(e,t)},e.prototype.move_forward=function(t){var e=this.get_position(),i=this.get_rotation(),o=e.x+Math.cos(i)*t,n=e.y+Math.sin(i)*t;this.set_position(o,n)},e.prototype.get_position=function(){var t=this.transform_offset.position;return{x:this.transform_position.x-t.x,y:-this.transform_position.y+t.y}},e.prototype.set_scale=function(t,e){var i=t;void 0!==i&&(i=Math.max(0,i),i=this.is_rotation_flipped!==this.is_vertical_flipped?-1*i:i);var o=void 0===e?t:e;void 0!==o&&(o=Math.max(0,o),o=this.is_horizontal_flipped?-1*o:o),this.set_pixi_scale(i,o)},e.prototype.get_scale=function(){var t=this.get_pixi_scale(),e=t.x,i=t.y;return{x:Math.abs(e),y:Math.abs(i)}},e.prototype.set_rotation=function(t){var e=c.s(t);this.rotation_value=e;var i=!1;switch(this.rotation_type){case Z.e.ALL:this.set_pixi_rotation(-this.rotation_value),i=this.is_rotation_flipped;break;case Z.e.LEFT_RIGHT:this.set_pixi_rotation(0),i=(this.rotation_value>=Math.PI/2||this.rotation_value<-Math.PI/2)!==this.is_rotation_flipped;break;case Z.e.NONE:this.set_pixi_rotation(0),i=this.is_rotation_flipped}if(i){var o=this.get_pixi_scale(),n=o.x,r=o.y;this.is_rotation_flipped=!this.is_rotation_flipped,this.set_pixi_scale(-1*n,r)}},e.prototype.set_flipped=function(t){var e=this.get_pixi_scale(),i=e.x,o=e.y;switch(t){case"vertical":return this.set_pixi_scale(-1*i,o),void(this.is_vertical_flipped=!this.is_vertical_flipped);case"horizontal":return this.set_pixi_scale(i,-1*o),void(this.is_horizontal_flipped=!this.is_horizontal_flipped)}},e.prototype.set_rotation_type=function(t){this.rotation_type=t,this.set_rotation(this.rotation_value)},e.prototype.set_visible=function(t){this.visible=t,this.emit_scene_event("change",{visible:this.visible})},e.prototype.set_alpha=function(t){this.alpha=t,this.emit_scene_event("change",{alpha:this.alpha})},e.prototype.get_rotation=function(){return this.rotation_value},e.prototype.get_rotation_type=function(){return this.rotation_type},e.prototype.get_visible=function(){return this.visible},e.prototype.get_alpha=function(){return this.alpha},e.prototype.get_texture_id=function(){return this.texture_id},e.prototype.get_vertical_flipped=function(){return this.is_vertical_flipped},e.prototype.get_horizontal_flipped=function(){return this.is_horizontal_flipped},e.prototype.set_texture=function(t,e){var i=this.data.get_texture(t);if(!i)return new _.a("Cannot find texture "+t+". Please load texture first");this.texture=i,this.texture_id=t,e&&(e.pivot&&(this.custom_pivot=e.pivot),void 0!==e.adaption&&(this.adaption=e.adaption)),this.on_texture_updated()},e.prototype.update_adaptive_scale=function(){if(this.adaption){var t=this.app.get_app_view_size(),e=t.width,i=t.height,o=e/this.texture.width,n=i/this.texture.height,r=void 0;switch(this.adaption){case Z.a.CONTAIN:r=Math.min(o,n),this.adaptive_scale={x:r,y:r},this.width=this.texture.width*this.adaptive_scale.x,this.height=this.texture.height*this.adaptive_scale.y,this.transform_offset.position={x:this.width/2,y:this.height/2};break;case Z.a.COVER:r=Math.max(o,n),this.adaptive_scale={x:r,y:r},this.width=e,this.height=i,this.transform_offset.position={x:e/2,y:i/2};break;case Z.a.STRETCH:this.adaptive_scale={x:o,y:n},this.width=e,this.height=i,this.transform_offset.position={x:e/2,y:i/2};break;default:return}}else this.adaptive_scale={x:1,y:1};this.update_pixi_position(),this.tileTransform.scale.set(this.adaptive_scale.x,this.adaptive_scale.y)},e.prototype.set_adaption_mode=function(t){this.adaption!==t&&this.data.get_texture(this.texture_id)&&(this.adaption=t,this.on_texture_updated())},e.prototype.update_pixi_position=function(t,e){var i=this.transform_offset.position;this.transform_position={x:t?t+i.x:i.x,y:e?-e+i.y:i.y},this.tileTransform.position.set(this.transform_position.x%(this.texture.width*this.adaptive_scale.x),this.transform_position.y%(this.texture.height*this.adaptive_scale.y))},e.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.on_resize),t.prototype.destroy.call(this)},e}(s.z),it=function(t){function e(e,i,o,n,r,s,a,c,_){var h=t.call(this,e,i,o,n,r,s,a,c,_)||this;h.update_transform=function(t){h.transform_offset.position={x:t.width/2,y:t.height/2},h.update_pixi_position(),h.update_transform_pivot(),h.update_adaptive_scale()},h.on_stage_resize=function(t){t.target_id===h.app.get_app().stage.name&&h.update_transform(t.data)};var l=s.get_app().view,p=l.width,u=l.height;return h.update_transform({width:p,height:u}),h.events.add_listener("stage:resize",h.on_stage_resize),h}return tt(e,t),e.prototype.set_pixi_rotation=function(t){this.tileTransform.rotation=t,this.emit_scene_event("change",{rotation:this.get_pixi_rotation()})},e.prototype.get_pixi_rotation=function(){return this.tileTransform.rotation},e.prototype.set_pixi_scale=function(t,e){this.tileTransform.scale.set(void 0===t?void 0:t*this.adaptive_scale.x,void 0===e?void 0:e*this.adaptive_scale.y),this.emit_scene_event("change",{scale:this.tileTransform.scale})},e.prototype.get_pixi_scale=function(){var t=this.tileTransform.scale,e=t.x,i=t.y;return{x:e/this.adaptive_scale.x,y:i/this.adaptive_scale.y}},e.prototype.on_texture_updated=function(){this.update_transform_pivot(),this.update_adaptive_scale()},e.prototype.update_transform_pivot=function(){var t=this.texture,e=t.width,i=t.height;this.transform_offset.pivot={x:e/2+this.custom_pivot.x,y:i/2+this.custom_pivot.y},this.tileTransform.pivot.set(this.transform_offset.pivot.x,this.transform_offset.pivot.y)},e.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.on_stage_resize),t.prototype.destroy.call(this)},e}(et);!function(t){function e(e,i,o,n,r,s,a,c,_){var h=t.call(this,e,i,o,n,r,s,a,c,_)||this;return h.update_transform=function(t){t.target_id===h.app.get_app().stage.name&&h.on_texture_updated()},h.update_transform_position(0,0),h.events.add_listener("stage:resize",h.update_transform),h}tt(e,t),e.prototype.set_pixi_rotation=function(t){this.rotation=t,this.emit_scene_event("change",{rotation:this.get_pixi_rotation()})},e.prototype.get_pixi_rotation=function(){return this.rotation},e.prototype.set_pixi_scale=function(t,e){this.scale.set(t,e),this.emit_scene_event("change",{scale:this.get_pixi_scale()})},e.prototype.get_pixi_scale=function(){var t=this.scale;return{x:t.x,y:t.y}},e.prototype.on_texture_updated=function(){this.update_adaptive_scale();var t=this.tileTransform.position,e=t.x,i=t.y,o=e-this.transform_offset.position.x,n=i-this.transform_offset.position.y;this.update_transform_position(o,n)},e.prototype.update_transform_position=function(t,e){var i=this.app.get_app_view_size(),o=i.width,n=i.height,r=this.texture,s=r.width,a=r.height,c=(s*this.adaptive_scale.x-o)/-2-this.custom_pivot.x,_=(a*this.adaptive_scale.y-n)/-2-this.custom_pivot.y;this.transform_offset.position={x:c,y:_},this.tileTransform.position.set(this.transform_offset.position.x+t,this.transform_offset.position.y+e)},e.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.update_transform),t.prototype.destroy.call(this)}}(et);var ot=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),nt=function(t){function e(e,i,o,n,r,a){var c=t.call(this)||this;c.type=Z.d.Scene,c.brush_canvas=document.createElement("canvas"),c.brush_ctx=c.brush_canvas.getContext("2d"),c.should_update_brush_texture=!1,c.mouse_down_time=0,c.on_resize=function(t){if(t.target_id===c.app.get_app().stage.name){var e=c.app.get_app().view,i=e.width,o=e.height;c.brush_canvas.width=i,c.brush_canvas.height=o}},c.on_tick=function(){c.should_update_brush_texture&&(c.should_update_brush_texture=!1,c.update_brush())},c.data=n,c.app=r,c.events=a,c.id=e,c.name=e;var _=c.app.get_app().view,h=_.width,l=_.height,p=c.app.get_app_view_resolution();c.visible=!1,c.interactive=!0;var u=c.app.get_renderer_type()===s.p.WEBGL,d=c.emit_event.bind(c);return c.background=new it(i,o,h,l,d,r,n,a,e),c.addChildAt(c.background,0),c.brush_canvas.width=h,c.brush_canvas.height=l,c.brush_sprite=s.t.from(c.brush_canvas),c.brush_sprite.anchor.set(.5),c.brush_sprite.position.set(0,0),c.brush_sprite.scale.set(1/p),c.addChildAt(c.brush_sprite,1),c.actor_container=new s.f,c.actor_container.name="actor_container",c.addChildAt(c.actor_container,2),c.background.addListener("mousedown",function(){return c.emit_mouse_event("scene:mousedown")}),c.background.addListener("mousemove",function(){return c.emit_mouse_event("scene:mousemove")}),c.background.addListener("mouseup",function(){return c.emit_mouse_event("scene:mouseup")}),c.background.addListener("mouseupoutside",function(){return c.emit_mouse_event("scene:mouseupoutside")}),c.background.addListener("touchstart",function(){return c.emit_mouse_event("scene:touchstart")}),c.background.addListener("touchmove",function(){return c.emit_mouse_event("scene:touchmove")}),c.background.addListener("touchend",function(){return c.emit_mouse_event("scene:touchend")}),c.background.addListener("touchendoutside",function(){return c.emit_mouse_event("scene:touchendoutside")}),c.events.add_listener("stage:resize",c.on_resize),c.app.get_app().ticker.add(c.on_tick),u&&(c.effects=new $.a(c.app,c)),c}return ot(e,t),e.prototype.emit_event=function(t,e){this.emit(t,e)},e.prototype.add_listener=function(t,e){this.on(t,e)},e.prototype.remove_listener=function(t,e){this.off(t,e)},e.prototype.destroy=function(){this.emit_event("destroy",void 0),this.app.get_app().ticker.remove(this.on_tick),this.events.remove_listener("stage:resize",this.on_resize),this.brush_sprite.destroy({children:!0,texture:!0,baseTexture:!0}),t.prototype.destroy.call(this,{children:!0}),this.data.clear_scene_cache(this.id)},e.prototype.get_background=function(){return this.background},e.prototype.get_id=function(){return this.id},e.prototype.get_actor_ids=function(t){var e=[],i=t?function(i){return i.group===t&&e.push(i.id)}:function(t){return e.push(t.id)};return this.actor_container.children.forEach(function(t){c.k(t)&&i(t.get_actor())}),e},e.prototype.get_brush_ctx=function(){return this.brush_ctx},e.prototype.should_update_brush=function(){this.should_update_brush_texture=!0},e.prototype.update_brush=function(){this.brush_sprite.texture.update()},e.prototype.get_actor_container=function(){return this.actor_container},e.prototype.emit_mouse_event=function(t){switch(t){case"scene:mousedown":case"scene:touchstart":this.mouse_down_time=(new Date).getTime(),this.events.fire("scene:selected",{target_id:this.id});break;case"scene:mouseup":case"scene:touchend":(new Date).getTime()-this.mouse_down_time<1e3&&this.events.fire("scene:click",{target_id:this.id})}this.events.fire(t,{target_id:this.id})},e.prototype.get_effects=function(){return this.effects?_.b.success(this.effects):_.b.error("Effect not available. It needs support of WebGL.")},e.prototype.set_brush_target=function(t){var e=this,i=this.data.get_internal_actor(t,[this.get_id()]);if(!i)return new _.a("Cannot find actor "+t+" in scene "+this.id);i.wrapper.addChild(this.brush_sprite),this.brush_unset_listener=function(){e.unset_brush_target()},i.add_listener("destroy",this.brush_unset_listener)},e.prototype.get_brush_target=function(){if(c.k(this.brush_sprite.parent))return this.brush_sprite.parent.get_actor()},e.prototype.unset_brush_target=function(){var t=this.brush_sprite.parent;c.k(t)&&(this.addChildAt(this.brush_sprite,1),this.brush_unset_listener&&(t.get_actor().remove_listener("destroy",this.brush_unset_listener),this.brush_unset_listener=void 0))},e}(s.f),rt=function(){function t(t,e,i,o,n){this.transition_type="none",this.app=t,this.data=e,this.transition=i(t),this.scene=o,this.events=n}return t.prototype.load_scene=function(t,e){if(this.data.get_internal_scene(t))return _.b.error("Scene "+t+" already exists. Please use new scene id");var i=e?this.data.get_texture(e):s.y.EMPTY;if(!i)return _.b.error("Cannot find texture "+e+". Please load texture first");var o=this.scene(t,i,e||"",this.data,this.app);return this.app.get_scene_container().addChild(o),_.b.success(o)},t.prototype.set_current_scene=function(t,e){var i=this,o=this.data.get_internal_scene(t);if(!o)return new _.a("Cannot find scene "+t);if(this.current_scene!==t){if(!this.current_scene)return this.current_scene=t,this.set_one_scene_visible(t),void(e&&e());var n=this.data.get_internal_scene(this.current_scene);if(!n)return new _.a("Cannot find out scene "+this.current_scene);this.current_scene=t,this.transition.set_transition(this.transition_type,n,o,function(){i.set_one_scene_visible(o.id),e&&e()})}},t.prototype.get_current_scene=function(){return this.current_scene},t.prototype.destroy_scene=function(t){var e=this.data.get_internal_scene(t);if(!e)return _.b.error("Cannot find scene "+t);e.destroy(),this.current_scene===t&&(this.current_scene=void 0);var i=this.app.get_scene_container().children,o=[];return i.forEach(function(t){c.m(t)&&o.push(t.id)}),_.b.success({scene_ids:o})},t.prototype.dispose_actors_by_scene=function(t){var e=this,i=this.data.get_internal_scene(t);if(!i)return new _.a("Cannot find scene "+t);i.get_actor_container().removeChildren().forEach(function(t){if(c.k(t)){var i=t.get_actor();i.destroy(),e.data.clear_actor_cache(i.get_id())}})},t.prototype.destroy_all_scenes=function(){var t=this;this.get_scene_ids().forEach(function(e){var i=t.data.get_internal_scene(e);i&&i.destroy()}),this.current_scene=void 0,this.data.clear_all_scenes_cache()},t.prototype.get_scene_ids=function(){var t=[];return this.app.get_scene_container().children.forEach(function(e){c.m(e)&&t.push(e.id)}),t},t.prototype.set_one_scene_visible=function(t){this.app.get_scene_container().children.forEach(function(e){c.m(e)&&(e.id===t?e.visible=!0:e.visible=!1)}),this.events.fire("scene:current_scene_changed",t)},t.prototype.set_transition_type=function(t){if("distort"===t&&this.app.get_renderer_type()!==s.p.WEBGL)return new _.a("Only WEBGL support distort transition");this.transition_type=t},t.prototype.get_scene=function(t){var e=this.data.get_internal_scene(t);return e?_.b.success(e):_.b.error("Cannot find scene "+t)},t}();const st=i(5579);var at=function(){function t(t,e,i){this.app=t,this.data=e,this.actor=i}return t.prototype.load_actor=function(t){var e=t.actor_id,i=t.parent_scene_id,o=t.position,n=t.scale,r=t.rotation_type,s=t.rotation,a=t.visible,c=t.group;if(this.data.get_internal_actor(e))return _.b.error("Actor "+e+" already exists. Please use new actor id");var h=this.data.get_internal_scene(i);if(!h)return _.b.error("Scene "+i+" should be loaded before loading actor "+e);var l=this.actor({actor_id:e,parent_scene:h,app:this.app,data:this.data});return o&&(l.set_position_x(o.x),l.set_position_y(o.y)),n&&l.set_scale(n.x,n.y),void 0!==s&&l.set_rotation(s),void 0!==r&&l.set_rotation_type(r),void 0!==a&&l.set_visible(a),void 0!==c&&l.set_group(c),_.b.success(l)},t.prototype.destroy_actor=function(t){var e=this.data.get_internal_actor(t);if(!e)return new _.a("Cannot find actor "+t);e.destroy()},t.prototype.destroy_all_actors=function(){var t=this;this.app.get_scene_container().children.forEach(function(e){c.m(e)&&e.get_actor_ids().forEach(function(e){var i=t.data.get_internal_actor(e);i&&i.destroy()})}),this.data.clear_all_actors_cache()},t.prototype.get_actor_ids=function(t){var e=[];return this.app.get_scene_container().children.forEach(function(i){c.m(i)&&(e=e.concat(i.get_actor_ids(t)))}),e},t.prototype.get_actor=function(t){var e=this.data.get_internal_actor(t);return e?_.b.success(e):_.b.error("Cannot find actor "+t)},t}();const ct=i(84135);var _t=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ht=function(t,e){return function(i,o){e(i,o,t)}},lt=function(){function t(t,e,i,o,n,r,s,a){this.app=t,this.data=e(t),this.textures=i(this.data),this.scenes=o(t,this.data),this.actors=n(t,this.data),this.stage_animation=r(this.data),this.physics=s(t,this.data),this.events=a}return t.prototype.init=function(t){this.app.init(t)},t.prototype.render=function(){this.app.render()},t.prototype.start_rendering=function(){this.app.get_app().ticker.start()},t.prototype.stop_rendering=function(){this.app.get_app().ticker.stop()},t.prototype.get_view=function(){return this.app.get_app().view},t.prototype.get_view_size=function(){return this.app.get_app_view_size()},t.prototype.get_screenshot=function(t){return function(t,e,i,o){return new(i||(i=Promise))(function(e,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function s(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(t){t(o)})).then(r,s)}a((o=o.apply(t,[])).next())})}(this,0,void 0,function(){var e=this;return function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,function(i){return[2,new Promise(function(i,o){e.app.get_screenshot(t).then(i).catch(o)})]})})},t.prototype.extract_pixels=function(t,e,i,o){var n=this.get_view(),r=n.width,a=n.height,c=new s.r(new s.d({width:r,height:a}));if(this.app.get_app().renderer.render(this.app.get_app().stage,{renderTexture:c}),this.app.get_renderer_type()===s.p.WEBGL)return c.frame=this.get_render_texture_frame(t,e,i,o),this.app.get_extract_module().pixels(c);var _=this.app.get_extract_module().canvas(c).getContext("2d");return _?_.getImageData(t,e,i,o).data:void 0},t.prototype.extract_canvas=function(t,e,i,o){var n=this.get_view(),r=n.width,a=n.height,c=new s.r(new s.d({width:r,height:a}));return this.app.get_app().renderer.render(this.app.get_app().stage,{renderTexture:c}),c.frame=this.get_render_texture_frame(t,e,i,o),this.app.get_extract_module().canvas(c)},t.prototype.get_render_texture_frame=function(t,e,i,o){var n=this.get_view(),r=n.width,a=n.height;return t=ct.a(0,r-1,t),i=ct.a(1,r-t,i),e=ct.a(0,a-1,e),o=ct.a(1,a-e,o),new s.q(t,e,i,o)},t.prototype.resize=function(t,e){this.app.resize(t,e)},t.prototype.set_background_color=function(t){this.app.get_app().renderer.backgroundColor=t},t.prototype.set_background_alpha=function(t){this.app.get_app().renderer.backgroundAlpha=t},t.prototype.add_rendering_update_listener=function(t){this.app.get_app().ticker.add(t)},t.prototype.remove_rendering_update_listener=function(t){this.app.get_app().ticker.remove(t)},t.prototype.destroy=function(){this.data.clear_all_actors_cache(),this.data.clear_all_scenes_cache(),this.data.clear_all_sprite_sheet_cache(),this.data.clear_all_textures_points_cache(),this.app.destroy()},function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}([n.injectable(),ht(0,n.inject(a.App)),ht(1,n.inject(a.Data)),ht(2,n.inject(a.Textures)),ht(3,n.inject(a.Scenes)),ht(4,n.inject(a.Actors)),ht(5,n.inject(a.StageAnimation)),ht(6,n.inject(a.Physics)),ht(7,n.inject(a.Events)),_t("design:paramtypes",[Object,Function,Function,Function,Function,Function,Function,Object])],t)}(),pt=function(){return(pt=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},ut=function(){function t(t){this.data=t}return t.prototype.init=function(){return function(t,e,i,o){return new(i||(i=Promise))(function(e,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function s(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(t){t(o)})).then(r,s)}a((o=o.apply(t,[])).next())})}(this,0,void 0,function(){var t,e;return function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,function(i){switch(i.label){case 0:return this.cmao_gsap?[3,2]:(t=this,[4,Promise.reject(new Error("module (key: 3278) not found!"))]);case 1:t.cmao_gsap=i.sent(),i.label=2;case 2:return this.cmao_custom_ease?[3,4]:(e=this,[4,Promise.reject(new Error("module (key: 3279) not found!"))]);case 3:e.cmao_custom_ease=i.sent(),i.label=4;case 4:return this.cmao_gsap&&this.cmao_custom_ease&&this.cmao_gsap.gsap.registerPlugin(this.cmao_custom_ease.CustomEase),[2]}})})},t.prototype.create_ease_function=function(t,e){if(this.cmao_custom_ease)return this.cmao_custom_ease.CustomEase.create(t,e)},t.prototype.compose_timeline=function(t,e,i){var o=this;if(this.cmao_gsap&&this.data.get_internal_actor(t)){var n,r,s;i&&(n=i.on_start,r=i.on_update,s=i.on_complete);var a=new this.cmao_gsap.TimelineLite({onStart:n,onUpdate:r,onComplete:s});return e.forEach(function(e){var i=e.tween_opt,n=e.timeline_pos,r=o.compose_tween(t,i);r&&a.add(r,n)}),a}},t.prototype.compose_tween=function(t,e){var i=this.data.get_internal_actor(t);if(this.cmao_gsap&&i){var o,n;switch(e.variation_type){case Z.f.TO:n=this.manufacture_tween_vars(i,[e.tween_vars]),o=this.cmao_gsap.TweenLite.to(n.target,n.vars[0]);break;case Z.f.FROM:n=this.manufacture_tween_vars(i,[e.tween_vars]),o=this.cmao_gsap.TweenLite.from(n.target,n.vars[0]);break;case Z.f.FROM_TO:n=this.manufacture_tween_vars(i,[e.tween_vars.from,e.tween_vars.to]),o=this.cmao_gsap.TweenLite.fromTo(n.target,n.vars[0],n.vars[1])}return i.on("destroy",function(){return o.kill()}),o}},t.prototype.manufacture_tween_vars=function(e,i){var o=this,n={},r=[],s=Object.keys(t.HOOK_FACTORY);return i.forEach(function(i){var a=i.on_start,c=i.on_update,_=i.on_complete,h=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i}(i,["on_start","on_update","on_complete"]),l=w.a(h),p=Math.random().toString();l.id=p;var u=!1;if(o.cmao_gsap){var d=o.cmao_gsap,g=[],y=[],v={},b=Object.keys(h);s.forEach(function(i){if(f.a(i,b)){void 0===n[i]&&(n[i]=0);var o=function(t,e){var i,o,n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s}(t.HOOK_FACTORY[i](e,n),3),r=o[0],s=o[1],a=o[2];g.push(r),y.push(s),a&&(v[i]=a)}}),g.push(function(){u=!0;var t=d.gsap.getById(p);t&&t.invalidate()}),a&&g.push(a),c&&y.push(c),r.push(pt(pt({},l),{modifiers:v,onStart:function(){g.forEach(function(t){return t()})},onUpdate:function(){u&&y.forEach(function(t){return t()})},onComplete:_}))}}),{target:n,vars:r}},t.HOOK_FACTORY={position_x:function(t,e){return[function(){e.position_x=t.position.x},function(){var i=t.position.y;t.set_pixi_position(e.position_x,i)}]},position_y:function(t,e){return[function(){e.position_y=-t.position.y},function(){var i=t.position.x;t.set_pixi_position(i,-e.position_y)}]},scale_x:function(t,e){return[function(){e.scale_x=t.scale.x},function(){var i=t.scale.y;t.set_pixi_scale(e.scale_x,i)}]},scale_y:function(t,e){return[function(){e.scale_y=t.scale.y},function(){var i=t.scale.x;t.set_pixi_scale(i,e.scale_y)}]},rotation:function(t,e){return[function(){e.rotation=t.rotation_value},function(){t.set_rotation(e.rotation)},function(t){return c.s(t)}]},pixi_rotation:function(t,e){return[function(){e.pixi_rotation=t.rotation},function(){t.set_pixi_rotation(e.pixi_rotation)},function(t){return c.s(t)}]},alpha:function(t,e){return[function(){e.alpha=t.alpha},function(){t.set_alpha(e.alpha)}]}},t}();const dt=i(6492),ft=i(859),gt=i(65636);var yt,vt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),bt=function(){function t(t,e,i,o,n,r){if(this.app=t,this.data=e,this.box2d=i,this.scene_world=o,this.actor=n,this.get_strength=r,this.type=dt.a.ELASTIC,this.position_cache=new this.box2d.Vec2,this.particle_system=this.scene_world.world.m_particleSystemList,this.start_rotation=this.actor.rotation,!this.particle_system)throw Error("Trying to init elastic body before particle system initialized. ")}return t.get_max_anchors=function(){if(this._max_anchors)return this._max_anchors;var t=document.createElement("canvas").getContext("webgl");if(!t)throw Error("[Elastic Body]: WebGL not supported");var e=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),i=Math.floor(e/5);return this._max_anchors=Math.floor((i-1)/2),this._max_anchors},t.prototype.set_enabled=function(t){var e;if(t&&!this.particle_group){var i=c.d(this.actor,this.actor.position);this.init({x:ft.o(i.x),y:ft.o(i.y)},null===(e=this.actor.current_style)||void 0===e?void 0:e.texture_id)}else!t&&this.particle_group&&this.clear()},t.prototype.set_dynamic=function(){},t.prototype.set_fixed_rotation=function(t){},t.prototype.set_sensor=function(t){},t.prototype.set_mass=function(t){},t.prototype.get_linear_velocity=function(){if(this.particle_group){var t=this.particle_group.GetLinearVelocity();return new this.box2d.Vec2(t.x,-t.y)}return this.box2d.Vec2_zero},t.prototype.set_linear_velocity=function(t,e){if(this.particle_group)for(var i=this.particle_group.m_firstIndex;i<this.particle_group.m_lastIndex;i++)this.particle_system.m_velocityBuffer.data[i].Set(t,-e)},t.prototype.get_particle_group_rotation=function(){if(!this.particle_group)return 0;if(!this.particle_group_start_rotation)return this.particle_group.GetAngle();var t=this.particle_system.m_positionBuffer.data[this.particle_group.m_firstIndex],e=this.particle_group.GetAnchorPosition(),i=new this.box2d.Vec2;return this.box2d.Vec2.SubVV(t,e,i),i.SelfNormalize(),this.box2d.Atan2(i.y,i.x)-this.box2d.Atan2(this.particle_group_start_rotation.y,this.particle_group_start_rotation.x)},t.prototype.get_rotation=function(){return this.particle_group?this.start_rotation+this.get_particle_group_rotation():this.start_rotation},t.prototype.set_rotation=function(t){if(this.particle_group)for(var e=t-this.get_rotation(),i=this.get_position(),o=this.particle_group.m_firstIndex;o<this.particle_group.m_lastIndex;o++){var n=c.p(this.particle_system.m_positionBuffer.data[o],i,e);this.particle_system.m_positionBuffer.data[o]=new this.box2d.Vec2(n.x,n.y)}else this.start_rotation=t},t.prototype.get_position=function(){if(!this.particle_group||!this.particle_group_anchor_offset)return this.position_cache;var t=this.particle_group.GetAnchorPosition(),e=this.get_particle_group_rotation(),i=c.p(this.particle_group_anchor_offset,{x:0,y:0},e);return new this.box2d.Vec2(t.x-i.x,t.y-i.y)},t.prototype.set_position=function(t){if(this.particle_group)for(var e=this.get_position(),i=t.x-e.x,o=t.y-e.y,n=this.particle_group.m_firstIndex;n<this.particle_group.m_lastIndex;n++)this.particle_system.m_positionBuffer.data[n].SelfAddXY(i,o)},t.prototype.scale_points=function(t,e,i){if(!i){for(var o=1/0,n=1/0,r=-1/0,s=-1/0,a=0;a<t.length;a++)o=Math.min(o,t[a].x),n=Math.min(n,t[a].y),r=Math.max(r,t[a].x),s=Math.max(s,t[a].y);i={x:(r+o)/2,y:(s+n)/2}}var c=[];for(a=0;a<t.length;a++){var _={x:t[a].x,y:t[a].y},h=_.x-i.x;_.x=h>0?Math.ceil(h*e+i.x)+1:Math.floor(h*e+i.x)-1;var l=_.y-i.y;_.y=l>0?Math.ceil(l*e+i.y)+1:Math.floor(l*e+i.y)-1,c.push(_)}return c},t.prototype.init=function(t,e){if(e){var i=this.generate_position_data(e);if(i){this.clear();var o=i.points,n=i.triangles,r=new this.box2d.ParticleGroupDef;r.positionData=o,r.flags=this.box2d.ParticleFlag.b2_elasticParticle|this.box2d.ParticleFlag.b2_waterParticle|this.box2d.ParticleFlag.b2_particleContactListenerParticle|this.box2d.ParticleFlag.b2_particleContactFilterParticle|this.box2d.ParticleFlag.b2_fixtureContactListenerParticle|this.box2d.ParticleFlag.b2_fixtureContactFilterParticle,r.groupFlags=this.box2d.ParticleGroupFlag.b2_solidParticleGroup,r.color.SetRGBA(255,255,255,.5),r.strength=this.get_strength(),r.position.Set(t.x,t.y),r.angle=this.actor.rotation,r.id=this.actor.id,this.particle_group=this.particle_system.CreateParticleGroup(r),this.start_rotation=this.actor.rotation;var s=this.particle_group.GetAnchorPosition();this.particle_group_anchor_offset=new this.box2d.Vec2,this.box2d.Vec2.SubVV(s,t,this.particle_group_anchor_offset);var a=this.particle_system.m_positionBuffer.data[this.particle_group.m_firstIndex];this.particle_group_start_rotation=new this.box2d.Vec2,this.box2d.Vec2.SubVV(a,s,this.particle_group_start_rotation),this.particle_group_start_rotation.SelfNormalize();var c=this.particle_group.GetParticleCount(),_=this.particle_group.m_firstIndex;if(!n.length)for(var h=0;h<this.particle_system.GetTriadCount();h++){var l=this.particle_system.GetTriads()[h],p=l.indexA,u=l.indexB,d=l.indexC;this.particle_group.ContainsParticle(p)&&this.particle_group.ContainsParticle(u)&&this.particle_group.ContainsParticle(d)&&n.push([p-_,d-_,u-_])}this.soft_filter=new gt.a({max_num_anchors:c,triangles:n}),this.soft_filter.enabled=!0,this.filters_cache=this.actor.filters,this.actor.filters=[this.soft_filter]}}},t.prototype.clear=function(){this.position_cache=this.get_position(),this.particle_group&&(this.particle_group.DestroyParticles(!1),this.particle_system.DestroyParticleGroup(this.particle_group),this.particle_group=void 0,this.particle_group_anchor_offset=void 0,this.particle_group_start_rotation=void 0,this.soft_filter=void 0,this.actor.filters=this.filters_cache||[],this.filters_cache=void 0)},t.prototype.destroy=function(){this.clear()},t.prototype.on_tick=function(){if(this.soft_filter&&this.particle_group){for(var t=this.get_particle_group_rotation(),e=[],i=this.particle_group.GetAnchorPosition(),o=0;o<this.particle_group.GetParticleCount();o++){var n=this.particle_group.relativePositions[o],r={x:i.x+n.x,y:i.y+n.y};r=c.p(r,i,t);var s=this.particle_system.m_positionBuffer.data[o+this.particle_group.m_firstIndex];e.push([this.map_physics_coord_to_pixi(r),this.map_physics_coord_to_pixi(s)])}var a=this.app.get_app().view,_=a.width,h=a.height;this.soft_filter.set_anchors(e,_,h)}},t.prototype.apply_force=function(t){var e;null!==(e=this.particle_group)&&void 0!==e&&e.ApplyForce(t)},t.prototype.generate_position_data=function(e){var i=this,o=this.data.get_texture(e),n=this.data.get_texture_bounds_points(e);if(n&&o){var r=this.actor.get_scale(),a=this.particle_system.GetRadius()*Math.SQRT2,_=ft.o(o.width*r.x),h=ft.o(o.height*r.y),l=Math.sqrt(Math.pow(_+a,2)+Math.pow(h+a,2))/Math.sqrt(Math.pow(_,2)+Math.pow(h,2)),p=this.scale_points(n,l).map(function(t){var e=c.c(new s.o(t.x,t.y));return new s.o(ft.o((e.x-o.width/2)*i.actor.scale.x),ft.o((e.y-o.height/2)*i.actor.scale.y))}),u=[];p&&T(p,u);var d=new this.box2d.ParticleSystem_CompositeShape(u.map(function(t){var e=new i.box2d.PolygonShape;return e.Set(t),e})),f=[],g=new Set,y=this.particle_system.GetParticleStride(),v=_*h,b=.5*t.get_max_anchors(),m=Math.max(Math.ceil(Math.sqrt(v/b)/y),1),x=this.box2d.Transform.IDENTITY,w=new this.box2d.AABB;for(d.ComputeAABB(w,x,0);!g.size;){for(var k=0,O=Math.floor(w.lowerBound.y/y)*y;O<w.upperBound.y;O+=y){g.size>0&&k++;for(var A=k%m===0||O+y>=w.upperBound.y,E=!1,C=Math.floor(w.lowerBound.x/y)*y,I=0;C<w.upperBound.x;){E&&I++;var P=I%m===0,M=new this.box2d.Vec2(C,O),S=f.length;d.TestPoint(x,M)&&(E||(C+=y/2,M.Set(C,O)),A&&P&&g.add(S),f.push(M),E=!0),E?C+=y:C++}A&&E&&g.add(f.length-1)}g.size>b&&(m++,f.length=0,g.clear())}for(var L=f.length,R=t.get_max_anchors()-b,N=Math.floor(p.length/R),D=new Set;g.size<t.get_max_anchors();){for(var G=function(t){var e=p[t];f.every(function(t){return i.box2d.Vec2.DistanceVV(t,e)>=i.particle_system.GetRadius()})&&(D.add(f.length),f.push(new j.box2d.Vec2(e.x,e.y)))},j=this,F=0;F<p.length;F+=N)G(F);if(g.size+D.size<=t.get_max_anchors())break;f.length=L,D.clear(),N++}if(g.size===f.length)return{points:f,triangles:[]};var z=[],B=new this.box2d.VoronoiDiagram(g.size+D.size);return g.forEach(function(t){B.AddGenerator(f[t],t,!0)}),D.forEach(function(t){B.AddGenerator(f[t],t,!0)}),B.Generate(y/2,2*y),B.GetNodes(function(t,e,i){z.push([t,e,i])}),{points:f,triangles:z}}},t.prototype.map_physics_coord_to_pixi=function(t){var e=ft.n(t.x),i=ft.n(t.y),o=this.app.get_app().view;return{x:e+o.width/2,y:i+o.height/2}},t.prototype.get_dragged_body=function(t){var e=this,i=new this.box2d.CircleShape;i.m_p.Copy(t),i.m_radius=2*this.particle_system.GetRadius();var o=new this.box2d.BodyDef;o.type=this.box2d.BodyType.b2_dynamicBody,o.position.Copy(t),o.id="ParticleJoint",o.fixedRotation=!1;var n=this.scene_world.world.CreateBody(o),r=new this.box2d.MassData,s=[],a=new this.box2d.AABB;i.ComputeAABB(a,this.box2d.Transform.IDENTITY,0);var c=function(t){function e(e){var i=t.call(this)||this;return i.ReportParticle=e,i}return vt(e,t),e.prototype.ReportFixture=function(t){return!1},e}(this.box2d.QueryCallback);this.scene_world.world.QueryAABB(new c(function(i,o){return s.push({index:o,offset:e.box2d.Vec2.SubVV(i.m_positionBuffer.data[o],t,new e.box2d.Vec2)}),!0}),a);for(var _=0;_<s.length;_++)r.mass=this.particle_system.m_groupBuffer[s[_].index].GetMass();return n.SetMassData(r),this.update_callback&&this.scene_world.update_callbacks.has(this.update_callback)&&this.scene_world.update_callbacks.delete(this.update_callback),this.update_callback=function(){var t=n.GetLinearVelocity(),i=n.GetPosition();s.forEach(function(o){var n=o.index,r=o.offset;e.particle_system.GetVelocityBuffer()[n].Copy(t);var s=e.box2d.Vec2.AddVV(i,r,new e.box2d.Vec2);e.particle_system.m_positionConstraintBuffer[n]=[s,s]})},this.scene_world.update_callbacks.add(this.update_callback),n},t.prototype.on_end_drag=function(){this.update_callback&&(this.scene_world.update_callbacks.delete(this.update_callback),this.update_callback=void 0)},t.prototype.refilter=function(){},t}(),mt=function(){function t(t,e,i,o,n,r,s){this.data=t,this.box2d=e,this.scene_world=i,this.actor=o,this.type=dt.a.NORMAL;var a=new this.box2d.BodyDef;a.type=this.box2d.BodyType.b2_staticBody,a.enabled=!1,a.fixedRotation=!0,a.id=this.actor.id,this.body=this.scene_world.world.CreateBody(a),this.fixture_def=new this.box2d.FixtureDef,this.fixture_def.density=n||ft.b,this.fixture_def.friction=r||ft.c,this.fixture_def.restitution=s||ft.e}return t.prototype.set_enabled=function(t){this.body.SetEnabled(t)},t.prototype.set_dynamic=function(t){this.body.SetType(t?this.box2d.BodyType.b2_dynamicBody:this.box2d.BodyType.b2_staticBody)},t.prototype.set_fixed_rotation=function(t){this.body.SetFixedRotation(t)},t.prototype.set_sensor=function(t){var e=this.body.GetFixtureList();if(t!==(null==e?void 0:e.IsSensor()))for(;e;)e.SetSensor(t),e=e.m_next},t.prototype.set_mass=function(t){var e=this.get_mass();0===e&&(e=1),this.set_density(this.get_density()*t/e)},t.prototype.get_mass=function(){return this.body.GetMass()},t.prototype.set_density=function(t){this.set_physics_property(0,t),this.body.ResetMassData(),this.fixture_def.density=t},t.prototype.get_density=function(){var t=this.body.GetFixtureList();return t?t.GetDensity():0},t.prototype.set_friction=function(t){this.set_physics_property(1,t)},t.prototype.get_friction=function(){var t=this.body.GetFixtureList();return t?t.GetFriction():0},t.prototype.set_restitution=function(t){this.set_physics_property(2,t)},t.prototype.get_restitution=function(){var t=this.body.GetFixtureList();return t?t.GetRestitution():0},t.prototype.get_linear_velocity=function(){var t=this.body.GetLinearVelocity(),e=t.x,i=t.y;return new this.box2d.Vec2(e,-i)},t.prototype.set_linear_velocity=function(t,e){this.body.SetLinearVelocity(new this.box2d.Vec2(t,-e))},t.prototype.get_rotation=function(){return this.body.GetAngle()},t.prototype.set_rotation=function(t){this.body.SetAngle(t),this.body.SetAwake(!0)},t.prototype.get_position=function(){return this.body.GetPosition()},t.prototype.set_position=function(t){this.body.SetPosition(t),this.body.SetAwake(!0)},t.prototype.init=function(t,e){for(var i=this.body.GetFixtureList();i;)this.body.DestroyFixture(i),i=this.body.GetFixtureList();this.body.SetPositionXY(t.x,t.y),this.body.SetAngle(this.actor.rotation),e&&this.create_fixture(e)},t.prototype.destroy=function(){this.scene_world.world.DestroyBody(this.body)},t.prototype.on_tick=function(){},t.prototype.apply_force=function(t){this.body.ApplyForceToCenter(t,!0)},t.prototype.create_fixture=function(t){var e=this;if(this.body&&t){var i=this.data.get_texture_convex_groups(t),o=this.data.get_texture(t);i&&o&&i.forEach(function(t){var i,n=new e.box2d.PolygonShape,r=[];t.forEach(function(t){var i=c.c(t);r.push(new e.box2d.Vec2(ft.o(i.x-o.width/2)*e.actor.scale.x,ft.o(i.y-o.height/2)*e.actor.scale.y))}),n.Set(r),e.fixture_def.shape=n,null!==(i=e.body)&&void 0!==i&&i.CreateFixture(e.fixture_def)})}},t.prototype.set_physics_property=function(t,e){for(var i=this.body.GetFixtureList();i;){switch(t){case 0:i.SetDensity(e);break;case 1:i.SetFriction(e);break;case 2:i.SetRestitution(e);break;default:return}i=i.m_next}},t.prototype.refilter=function(){for(var t=this.body.GetFixtureList();t;)t.Refilter(),t=t.m_next},t.prototype.get_dragged_body=function(){return this.body},t.prototype.on_end_drag=function(){},t}(),xt=function(){function t(t,e,i,o,n){var r,a=this;this.app=t,this.data=e,this.box2d=i,this.scene_world=o,this.force_handler_cache=new Set,this.collision_filter=new Set,this.bodies_cache=[],this.should_recreate_body=!1,this.on_actor_change=function(t){var e;if(t.texture||t.scale||t.pivot){if(!a.is_enabled())return void(a.should_recreate_body=!0);a.physics_body.init(a.convert_pixi_to_physics_position(a.actor.position),null===(e=a.actor.get_current_style())||void 0===e?void 0:e.texture_id)}},this.on_actor_destroy=function(){return a.destroy()},this.set_strength=function(t){a.group_strength=t;var e=a.bodies_cache[dt.a.ELASTIC];(null==e?void 0:e.particle_group)&&(e.particle_group.m_strength=a.group_strength)},this.get_strength=function(){return a.group_strength},this.physics_set_pixi_position=function(t,e){if(!a.actor.is_dragging()||!a.is_enabled()){var i=a.convert_pixi_to_physics_position(new s.o(t,e));a.bodies_cache.forEach(function(t){return t.set_position(i)}),a.fork_set_pixi_position(t,e)}},this.physics_set_pixi_rotation=function(t){a.bodies_cache.forEach(function(e){return e.set_rotation(t)}),a.fork_set_pixi_rotation(t)},this.handler=function(){if(a.is_enabled()){var t=a.physics_body.get_rotation(),e=a.physics_body.get_position(),i=e.x,o=e.y,n=a.convert_physics_to_pixi_position(i,o,t);a.fork_set_pixi_rotation(t),a.fork_set_pixi_position(n.x,n.y),a.actor.set_rotation_value(a.convert_to_rotation_value(t))}a.update_body_state(),a.physics_body.on_tick(),a.force_handler_cache.size&&a.force_handler_cache.forEach(function(t){return t()})},this.drag_start=function(t){if((a.collidable||a.forceable)&&a.actor.get_draggable()){a.mouse_joint&&a.scene_world.world.DestroyJoint(a.mouse_joint);var e=t.data.getLocalPosition(a.actor.parent),i={x:ft.o(e.x),y:ft.o(e.y)},o=a.physics_body.get_dragged_body(i),n=new a.box2d.MouseJointDef;n.bodyA=a.mouse_joint_dummy_body,n.bodyB=o,n.target.Set(i.x,i.y),n.maxForce=ft.i*o.m_mass,n.stiffness=ft.k,n.damping=ft.a,a.mouse_joint=a.scene_world.world.CreateJoint(n),o.SetAwake(!0)}},this.drag_move=c.w(function(t){if((a.collidable||a.forceable)&&a.actor.is_dragging()&&a.mouse_joint){var e=a.app.get_app().view,i=e.width,o=e.height,n=t.data.getLocalPosition(a.actor.parent);if(c.n(n,{width:i,height:o})){var r={x:ft.o(n.x),y:ft.o(n.y)};a.mouse_joint.GetTarget().Set(r.x,r.y),a.mouse_joint.GetBodyB().SetAwake(!0)}}},c.a),this.drag_end=function(){(a.collidable||a.forceable)&&a.mouse_joint&&(a.scene_world.world.DestroyJoint(a.mouse_joint),a.mouse_joint=void 0,a.physics_body.on_end_drag())},this.on_destroy=n.on_destroy,this.actor=n.actor,this.actor_id=n.actor.id,this.mouse_joint_dummy_body=n.mouse_joint_dummy_body,this.collidable=n.collidable,this.forceable=n.forceable,this.elastic=n.elastic,this.group_strength=n.strength||1;var _=n.density,h=n.friction,l=n.restitution;this.physics_body=this.get_normal_body(_,h,l),this.elastic&&(this.physics_body=this.get_elastic_body());var p=null===(r=this.actor.get_current_style())||void 0===r?void 0:r.texture_id,u=this.convert_pixi_to_physics_position(this.actor.position);this.bodies_cache.forEach(function(t){return t.init(u,p)}),this.update_body_state(),this.app.get_app().ticker.add(this.handler),this.fork_set_pixi_position=this.actor.set_pixi_position.bind(this.actor),this.actor.set_pixi_position=this.physics_set_pixi_position.bind(this),this.fork_set_pixi_rotation=this.actor.set_pixi_rotation.bind(this.actor),this.actor.set_pixi_rotation=this.physics_set_pixi_rotation.bind(this),this.actor.add_listener("change",this.on_actor_change),this.actor.add_listener("destroy",this.on_actor_destroy),this.actor.addListener("mousedown",this.drag_start),this.actor.addListener("mousemove",this.drag_move),this.actor.addListener("mouseup",this.drag_end),this.actor.addListener("mouseupoutside",this.drag_end),this.actor.addListener("touchstart",this.drag_start),this.actor.addListener("touchmove",this.drag_move),this.actor.addListener("touchend",this.drag_end),this.actor.addListener("touchendoutside",this.drag_end)}return t.prototype.update_body_state=function(){var t,e=this.is_enabled();if(this.physics_body.set_enabled(e),e){this.should_recreate_body&&(this.physics_body.init(this.convert_pixi_to_physics_position(this.actor.position),null===(t=this.actor.get_current_style())||void 0===t?void 0:t.texture_id),this.should_recreate_body=!1),this.physics_body.set_dynamic(this.forceable);var i=this.forceable&&!this.collidable;this.physics_body.set_sensor(i)}},t.prototype.get_elastic_body=function(){if(this.bodies_cache[dt.a.ELASTIC])return this.bodies_cache[dt.a.ELASTIC];var t=new bt(this.app,this.data,this.box2d,this.scene_world,this.actor,this.get_strength);return this.bodies_cache[dt.a.ELASTIC]=t,t},t.prototype.get_normal_body=function(t,e,i){if(this.bodies_cache[dt.a.NORMAL])return this.bodies_cache[dt.a.NORMAL];var o=new mt(this.data,this.box2d,this.scene_world,this.actor,t,e,i);return this.bodies_cache[dt.a.NORMAL]=o,o},t.prototype.convert_pixi_to_physics_position=function(t){var e=c.d(this.actor,t);return{x:ft.o(e.x),y:ft.o(e.y)}},t.prototype.convert_physics_to_pixi_position=function(t,e,i){var o={x:ft.n(t),y:ft.n(e)},n={x:o.x+this.actor.pivot.x*this.actor.scale.x,y:o.y+this.actor.pivot.y*this.actor.scale.y};return c.p(n,o,i)},t.prototype.add_ids_to_collision_filter=function(t){var e=this;if(0!==t.length){var i=!1;t.forEach(function(t){e.collision_filter.has(t)||(e.collision_filter.add(t),i||(i=!0))}),i&&this.physics_body.refilter()}},t.prototype.remove_ids_from_collision_filter=function(t){var e=this;t.forEach(function(t){e.collision_filter.has(t)&&e.collision_filter.delete(t)})},t.prototype.prevent_collision_with_actors=function(t){this.add_ids_to_collision_filter(t)},t.prototype.prevent_collision_with_edges=function(t){var e=[];t.forEach(function(t){e.push(t.toString())}),this.add_ids_to_collision_filter(e)},t.prototype.enable_collision_with_actors=function(t){this.remove_ids_from_collision_filter(t)},t.prototype.enable_collision_with_edges=function(t){var e=[];t.forEach(function(t){e.push(t.toString())}),this.remove_ids_from_collision_filter(e)},t.prototype.set_collidable=function(t){this.collidable=t},t.prototype.set_forceable=function(t){this.forceable=t},t.prototype.is_enabled=function(){return this.actor.visible&&(this.collidable||this.forceable)},t.prototype.is_dynamic=function(){return this.forceable},t.prototype.set_fixed_rotation=function(t){this.bodies_cache.forEach(function(e){return e.set_fixed_rotation(t)})},t.prototype.get_collision_filter=function(){return this.collision_filter},t.prototype.set_mass=function(t){this.get_normal_body().set_mass(t)},t.prototype.get_mass=function(){return this.get_normal_body().get_mass()},t.prototype.set_density=function(t){this.get_normal_body().set_density(t)},t.prototype.get_density=function(){return this.get_normal_body().get_density()},t.prototype.set_friction=function(t){this.get_normal_body().set_friction(t)},t.prototype.get_friction=function(){return this.get_normal_body().get_friction()},t.prototype.set_restitution=function(t){this.get_normal_body().set_restitution(t)},t.prototype.get_restitution=function(){return this.get_normal_body().get_restitution()},t.prototype.set_elastic=function(t){var e;if(t!==this.elastic){var i=this.physics_body.get_rotation(),o=this.physics_body.get_position(),n=this.physics_body.get_linear_velocity(),r=this.is_enabled();this.physics_body.set_enabled(!1),this.physics_body=t?this.get_elastic_body():this.get_normal_body(),this.physics_body.type===dt.a.NORMAL&&this.physics_body.init(this.convert_pixi_to_physics_position(this.actor.position),null===(e=this.actor.get_current_style())||void 0===e?void 0:e.texture_id),this.physics_body.set_enabled(r),this.physics_body.set_rotation(i),this.physics_body.set_position(o),this.physics_body.set_linear_velocity(n.x,n.y),this.elastic=t}},t.prototype.get_linear_velocity=function(){return this.physics_body.get_linear_velocity()},t.prototype.set_linear_velocity=function(t,e){this.physics_body.set_linear_velocity(t,e)},t.prototype.apply_force=function(t,e){var i=new this.box2d.Vec2(t,-e);this.physics_body.apply_force(i)},t.prototype.apply_force_in_time=function(t){var e=this,i=t.time,o=t.x,n=t.y,r=t.on_complete,s=Math.round(i/ft.f),a=1;this.force_handler_cache.add(function t(){if(a>s)return e.force_handler_cache.delete(t),void r();e.apply_force(o,n),a++})},t.prototype.destroy=function(){this.app.get_app().ticker.remove(this.handler),this.actor.removeListener("mousedown",this.drag_start),this.actor.removeListener("mousemove",this.drag_move),this.actor.removeListener("mouseup",this.drag_end),this.actor.removeListener("mouseupoutside",this.drag_end),this.actor.removeListener("touchstart",this.drag_start),this.actor.removeListener("touchmove",this.drag_move),this.actor.removeListener("touchend",this.drag_end),this.actor.removeListener("touchendoutside",this.drag_end),this.actor.remove_listener("change",this.on_actor_change),this.actor.remove_listener("destroy",this.on_actor_destroy),this.mouse_joint&&this.scene_world.world.DestroyJoint(this.mouse_joint),this.bodies_cache.forEach(function(t){return t.destroy()}),this.actor.set_pixi_position=this.fork_set_pixi_position,this.actor.set_pixi_rotation=this.fork_set_pixi_rotation,this.on_destroy()},t.prototype.convert_to_rotation_value=function(t){var e=c.s(-t);return this.actor.is_rotation_flipped?c.s(e+Math.PI):e},t.prototype.get_velocity_direction=function(){var t=this.physics_body.get_linear_velocity();return c.v(Math.atan2(t.y,t.x))},t.prototype.get_current_physics_body=function(){return this.physics_body},t}(),wt=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Tt=function(){function t(t,e,i,o,n){var r=this;this.app=t,this.data=e,this.scene=i,this.box2d=o,this.body_list=new Map,this.collision_list=new Set,this.edge_list=new Map,this.update_callbacks=new Set,this.update=function(){r.world.Step(ft.f,ft.l,ft.j),r.update_callbacks.forEach(function(t){return t()})},this.on_scene_destroy=function(){return r.destroy()},this.world=new o.World(new o.Vec2(0,n||ft.d));var s=new this.box2d.ParticleSystemDef;s.radius=1.2,this.world.CreateParticleSystem(s);var a=new o.ContactListener,c=function(t,e){if(t&&e&&t!==e){var i=ft.m(t,e),o=ft.m(e,t);r.collision_list.add(i),r.collision_list.add(o)}};a.BeginContact=function(t){return c(t.GetFixtureA().GetBody().GetId(),t.GetFixtureB().GetBody().GetId())},a.BeginContactBodyParticleGroup=function(t,e){var i;return c(e.body.GetId(),(null===(i=t.m_groupBuffer[e.index])||void 0===i?void 0:i.id)||"")},a.BeginContactParticleGroupParticleGroup=function(t,e){var i,o;return c((null===(i=t.m_groupBuffer[e.GetIndexA()])||void 0===i?void 0:i.id)||"",(null===(o=t.m_groupBuffer[e.GetIndexB()])||void 0===o?void 0:o.id)||"")};var _=function(t,e){if(t&&e&&t!==e){var i=ft.m(t,e),o=ft.m(e,t);r.collision_list.delete(i),r.collision_list.delete(o)}};a.EndContact=function(t){return _(t.GetFixtureA().GetBody().GetId(),t.GetFixtureB().GetBody().GetId())},a.EndContactBodyParticleGroup=function(t,e){var i;return _(e.body.GetId(),(null===(i=t.m_groupBuffer[e.index])||void 0===i?void 0:i.id)||"")},a.EndContactParticleGroupParticleGroup=function(t,e){var i,o;return _((null===(i=t.m_groupBuffer[e.GetIndexA()])||void 0===i?void 0:i.id)||"",(null===(o=t.m_groupBuffer[e.GetIndexB()])||void 0===o?void 0:o.id)||"")};var h=function(t,e){var i=r.body_list.get(t),o=r.body_list.get(e);return!(null==i?void 0:i.get_collision_filter().has(e))&&!(null==o?void 0:o.get_collision_filter().has(t))},l=new o.ContactFilter;l.ShouldCollide=function(t,e){return h(t.GetBody().GetId(),e.GetBody().GetId())},l.ShouldCollideFixtureParticle=function(t,e,i){var o;return h(t.GetBody().GetId(),(null===(o=e.m_groupBuffer[i])||void 0===o?void 0:o.id)||"")},l.ShouldCollideParticleParticle=function(t,e,i){var o,n;return h((null===(o=t.m_groupBuffer[e])||void 0===o?void 0:o.id)||"",(null===(n=t.m_groupBuffer[i])||void 0===n?void 0:n.id)||"")},this.world.SetContactListener(a),this.world.SetContactFilter(l),this.scene.add_listener("destroy",this.on_scene_destroy),this.mouse_joint_dummy_body=this.world.CreateBody(),this.app.get_app().ticker.add(this.update)}return t.prototype.create_body=function(t){var e=this,i=this.data.get_internal_actor(t.actor_id);if(i){var o=t.density,n=t.friction,r=t.restitution,s=t.strength,a=new xt(this.app,this.data,this.box2d,this,{on_destroy:function(){e.body_list.delete(t.actor_id)},actor:i,mouse_joint_dummy_body:this.mouse_joint_dummy_body,collidable:!!t.collidable,forceable:!!t.forceable,elastic:!!t.elastic,density:o,friction:n,restitution:r,strength:s});return this.body_list.set(t.actor_id,a),a}},t.prototype.create_edges=function(t){var e,i;if(0!==t.length){var o=this.app.get_app().view,n=o.width,r=o.height,s=ft.o(n)/2,a=ft.o(r)/2;try{for(var c=wt(t),_=c.next();!_.done;_=c.next()){var h=_.value;if(!this.edge_list.get(h)){var l=0,p=0;switch(h){case Z.b.TOP:p=-a-ft.h;break;case Z.b.BOTTOM:p=a+ft.h;break;case Z.b.LEFT:l=-s-ft.h;break;case Z.b.RIGHT:l=s+ft.h;break;default:return}var u=this.world.CreateBody({id:h.toString()}),d=new this.box2d.PolygonShape;d.SetAsBox(ft.h,ft.h),u.CreateFixture(d,ft.g),u.SetPositionXY(l,p),this.edge_list.set(h,u)}}}catch(t){e={error:t}}finally{try{_&&!_.done&&(i=c.return)&&i.call(c)}finally{if(e)throw e.error}}}},t.prototype.destroy_edges=function(t){var e,i;if(0!==t.length&&0!==this.edge_list.size)try{for(var o=wt(t),n=o.next();!n.done;n=o.next()){var r=n.value,s=this.edge_list.get(r);s&&(s.GetWorld().DestroyBody(s),this.edge_list.delete(r))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}},t.prototype.destroy_body=function(t){var e=this.body_list.get(t);e&&e.destroy()},t.prototype.destroy=function(){this.app.get_app().ticker.remove(this.update),this.scene.remove_listener("destroy",this.on_scene_destroy),this.body_list.forEach(function(t){t.destroy()}),this.edge_list.forEach(function(t){t.GetWorld().DestroyBody(t)}),this.body_list.clear(),this.edge_list.clear(),this.collision_list.clear()},t.prototype.get_body=function(t){return this.body_list.get(t)},t.prototype.set_gravity=function(t,e){this.world.SetGravity(new this.box2d.Vec2(t,-e))},t.prototype.check_bumped=function(t,e){var i=this.data.get_internal_actor(t),o=this.data.get_internal_actor(e);if(!i||i.has_left_stage()||!o||o.has_left_stage())return!1;var n=this.get_body(t),r=this.get_body(e);if(!(n&&n.is_enabled()&&r&&r.is_enabled()))return!1;var s=ft.m(t,e),a=ft.m(e,t);return this.collision_list.has(s)||this.collision_list.has(a)},t.prototype.check_collision_with_edge=function(t,e){var i,o,n=this.data.get_internal_actor(t);if(!n||n.has_left_stage())return!1;var r=this.get_body(t);if(!r||!r.is_enabled())return!1;var s=e?[e]:[Z.b.TOP,Z.b.BOTTOM,Z.b.LEFT,Z.b.RIGHT];try{for(var a=wt(s),c=a.next();!c.done;c=a.next()){var _=c.value,h=this.edge_list.get(_);if(h){var l=h.GetId(),p=ft.m(t,l),u=ft.m(l,t);if(this.collision_list.has(p)||this.collision_list.has(u))return!0}}}catch(t){i={error:t}}finally{try{c&&!c.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return!1},t}(),kt=function(){function t(t,e){this.app=t,this.data=e,this.world_list=new Map}return t.prototype.init=function(t){var e;return function(t,e,i,o){return new(i||(i=Promise))(function(e,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function s(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(t){t(o)})).then(r,s)}a((o=o.apply(t,[])).next())})}(this,0,void 0,function(){var i,o,n,r,s,a,c=this;return function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,function(_){switch(_.label){case 0:return this.box2d?[3,2]:(i=this,[4,Promise.reject(new Error("module (key: 3271) not found!"))]);case 1:i.box2d=_.sent(),_.label=2;case 2:return!t||this.debug_draw?[3,4]:(o=this.app.get_app().view).parentElement?((n=document.createElement("canvas")).width=o.width,n.height=o.height,n.style.width=o.style.width,n.style.height=o.style.height,n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.pointerEvents="none",o.parentElement.appendChild(n),[4,Promise.reject(new Error("module (key: 3273) not found!"))]):[2];case 3:r=_.sent().DebugDraw,this.debug_draw=new r(n),s=this.box2d.DrawFlags,a=s.e_none,a|=s.e_shapeBit,a|=s.e_particleBit,null!==(e=this.debug_draw)&&void 0!==e&&e.SetFlags(a),this.draw_handler=function(t){var e,i,o;null!==(i=null===(e=c.debug_draw)||void 0===e?void 0:e.m_ctx)&&void 0!==i&&i.clearRect(0,0,n.width,n.height),t&&null!==(o=c.latest_world)&&void 0!==o&&o.world.DebugDraw()},_.label=4;case 4:return[2]}})})},t.prototype.create_world=function(t,e){var i=this.data.get_internal_scene(t);if(this.box2d&&i){var o=new Tt(this.app,this.data,i,this.box2d,e);return this.debug_draw&&(o.world.SetDebugDraw(this.debug_draw),0===this.world_list.size&&this.draw_handler&&this.app.get_app().ticker.add(this.draw_handler)),this.world_list.set(t,o),this.latest_world=o,o}},t.prototype.destroy_world=function(t){var e,i=this.world_list.get(t);if(!i)return new _.a("Can not find world with id "+t);this.world_list.delete(t),i.destroy(),this.latest_world===i&&(this.latest_world=void 0),this.draw_handler&&0===this.world_list.size&&(this.app.get_app().ticker.remove(this.draw_handler),null!==(e=this.draw_handler)&&void 0!==e&&e.call(this,0))},t.prototype.destroy_all_worlds=function(){var t,e;try{for(var i=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.world_list.keys()),o=i.next();!o.done;o=i.next()){var n=o.value;this.destroy_world(n)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},t.prototype.get_world=function(t){var e=this.world_list.get(t);return this.latest_world=e||this.latest_world,e},t}(),Ot=new n.Container;Ot.bind(a.Events).to(j).inSingletonScope(),Ot.bind(a.App).to(d),Ot.bind(a.Data).toFactory(function(){return function(t){return new G(t)}}),Ot.bind(a.Textures).toFactory(function(){return function(t){return new Y(t)}}),Ot.bind(a.Transition).toFactory(function(){return function(t){return new Q(t)}}),Ot.bind(a.StageAnimation).toFactory(function(){return function(t){return new ut(t)}}),Ot.bind(a.Physics).toFactory(function(){return function(t,e){return new kt(t,e)}}),Ot.bind(a.Scene).toFactory(function(t){var e=t.container.get(a.Events);return function(t,i,o,n,r){return new nt(t,i,o,n,r,e)}}),Ot.bind(a.Scenes).toFactory(function(t){var e=t.container.get(a.Events),i=t.container.get(a.Transition),o=t.container.get(a.Scene);return function(t,n){return new rt(t,n,i,o,e)}}),Ot.bind(a.Actor).toFactory(function(t){return function(e){var i=t.container.get(a.Events),o=Object.assign({},e,{events:i});return new st.a(o)}}),Ot.bind(a.Actors).toFactory(function(t){var e=t.container.get(a.Actor);return function(t,i){return new at(t,i,e)}}),Ot.bind(a.Stage).to(lt);var At=function(){function t(){this.loader=s.k.shared,this.tasks=[],this.is_loading=!1}return t.prototype.add=function(t){this.tasks.push(t),this.is_loading||this.execute()},t.prototype.get_resources=function(){return this.loader.resources},t.prototype.execute=function(){var t=this;this.is_loading=!0;var e=this.tasks.shift();if(e){var i=this.loader.resources[e.url];if(i)return e.on_success&&e.on_success(i),void this.execute();this.loader.add(e.url).load(function(i,o){var n=o[e.url];if(!n||n.error){var r=n?n.error:new Error("No available resource.");e.on_error&&e.on_error(r),n&&delete o[e.url]}n&&!n.error&&e.on_success&&e.on_success(n),t.execute()})}else this.is_loading=!1},t}();const Et=i(83509);!function(){function t(t,e){this.actor_dialogs=new Map,this.dialog_containers=new Map,this.actor_destroy_handlers=new Map,this.app=t,this.data=e}t.prototype.load_dialog=function(t,e){var i=t.parent_scene,o=this.get_dialog_container(i);this.actor_dialogs.set(t.get_id(),e),o.addChild(e.get_graphics())},t.prototype.destroy_actor_dialog=function(t){var e=this.actor_dialogs.get(t);if(!e)return new _.a("Actor dialog "+t+" has not been found");var i=this.data.get_internal_actor(t),o=this.actor_destroy_handlers.get(t);i&&o&&(i.remove_listener("destroy",o),this.actor_destroy_handlers.delete(t)),this.actor_dialogs.delete(t),e.destroy()},t.prototype.destroy_all_actor_dialogs=function(){var t=this;this.dialog_containers.forEach(function(e){t.destroy_dialog_container(e)})},t.prototype.set_container_z_index=function(){console.warn("Method deprecated. It will not change anything.")},t.prototype.destroy=function(){this.destroy_all_actor_dialogs()},t.prototype.get_dialog_container=function(t){var e=this,i=t.get_id(),o=this.dialog_containers.get(i);return o||(o=new s.f,t.addChild(o),this.dialog_containers.set(i,o),t.add_listener("destroy",function(){var t=e.dialog_containers.get(i);t&&e.destroy_dialog_container(t)})),o},t.prototype.destroy_dialog_container=function(t){var e=this,i=t.parent;c.m(i)&&(this.dialog_containers.delete(i.get_id()),t.removeChildren().forEach(function(t){t.name&&e.actor_dialogs.delete(t.name),t.destroy()})),t.destroy()}}();var Ct,It,Pt=function(){function t(t,e,i){var o=this;this.actor_dialog=new s.j,this.text=new s.v(""),this.content_width=0,this.content_height=0,this.on_change=function(t){o.update_on_change(t)},this.update_on_change=function(t){(t.position||t.scale||t.rotation)&&o.update_dialog_position(),void 0!==t.alpha&&o.update_dialog_alpha(),(t.position||t.scale||t.rotation||void 0!==t.visible)&&o.update_dialog_visible()},this.actor_dialog.name=t.id,this.text.name="text",this.actor=t,this.STAGE_WIDTH=e,this.STAGE_HEIGHT=i,this.actor_dialog.addChild(this.text),this.actor.add_listener("change",this.on_change)}return t.prototype.update_dialog_alpha=function(){this.actor_dialog.alpha=this.actor.get_alpha()},t.prototype.update_dialog_visible=function(){var t=this.actor.get_visible()&&0!==this.actor.get_scale().x;this.actor_dialog.visible=t},t.prototype.update_dialog_position=function(){var t=c.d(this.actor,this.actor.position);this.actor_dialog.position.set(t.x,t.y-this.actor.height/2-this.actor_dialog.height),this.actor_dialog.scale.x=1,this.text.scale.x=1;var e=this.content_width===this.DIALOG_MIN_WIDTH?(this.content_width-this.text.width)/2:this.TEXT_PADDING;this.text.position.x=e,this.text.position.y=this.TEXT_PADDING,this.calibrate_edge_detection(this.actor_dialog.getBounds(),t)},t.prototype.calibrate_edge_detection=function(t,e){var i=this.STAGE_WIDTH/2,o=this.STAGE_HEIGHT/2,n=t.x+t.width>this.STAGE_WIDTH,r=t.x<0,s=t.y<0,a=t.y+t.height>this.STAGE_HEIGHT;n&&this.actor_dialog.scale.x>0&&(this.actor_dialog.scale.x=-1,this.text.scale.x=-1,this.text.position.x=this.content_width-this.text.position.x,e.x>i&&(this.actor_dialog.position.x=i)),r&&(this.actor_dialog.position.x=-i),s&&(this.actor_dialog.position.y=-o),a&&(this.actor_dialog.position.y=o-this.actor_dialog.height)},t.prototype.actor_is_in_stage=function(){var t=this.actor.getBounds();return t.x<this.STAGE_WIDTH&&t.x>-t.width&&t.y<this.STAGE_HEIGHT&&t.y>-t.height},t.prototype.destroy=function(){this.actor.remove_listener("change",this.on_change),this.actor_dialog.destroy({children:!0,texture:!0})},t.prototype.get_graphics=function(){return this.actor_dialog},t}(),Mt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),St={fontSize:"26px",fontFamily:["PingFangSC-Medium","Microsoft YaHei"],fill:"#666666",wordWrap:!0,wordWrapWidth:208,breakWords:!0,lineHeight:36},Lt=function(){function t(t,e){this.dialog_cache=new Map,this.app=t,this.data=e}return t.prototype.load_actor_dialog=function(t,e,i){var o=this,n=this.data.get_internal_actor(t);if(!n)return new _.a("Actor "+t+" has not been found");var r=this.dialog_cache.get(t);if(!r){var a=this.app.get_app_view_size(),c=a.width,h=a.height;(r=new Rt(n,i,c,h,this.app.get_renderer_type()===s.p.WEBGL)).get_graphics().setParent(n.wrapper),this.dialog_cache.set(t,r),n.add_listener("destroy",function(){o.destroy_actor_dialog(t)})}r.update(e,i)},t.prototype.destroy_actor_dialog=function(t){var e=this.dialog_cache.get(t);if(!e)return new _.a("Actor dialog "+t+" has not been found");this.dialog_cache.delete(t),e.destroy()},t.prototype.destroy_all_actor_dialogs=function(){this.dialog_cache.forEach(function(t){t.destroy()}),this.dialog_cache.clear()},t.prototype.destroy=function(){this.destroy_all_actor_dialogs()},t}(),Rt=function(t){function e(e,i,o,n,r){var a=t.call(this,e,o,n)||this;return a.DIALOG_MIN_WIDTH=108,a.DIALOG_MAX_WIDTH=248,a.TEXT_PADDING=20,a.bubbles=new s.j,a.update_on_change=function(t){(t.position||t.scale||t.rotation)&&a.update_dialog_position()},a.type=i,a.actor=e,a.text.style=St,a.bubbles.name="bubbles",a.actor_dialog.addChild(a.bubbles),a.update_dialog_style(),r&&(a.actor_dialog.filters=[new s.h({rotation:45,distance:3,alpha:.15,color:0,blur:0})]),a}return Mt(e,t),e.prototype.update=function(t,e){t===this.text.text&&e===this.type||(this.text.text=t,this.type=e,this.update_dialog_style()),this.update_dialog_position()},e.prototype.update_dialog_style=function(){var t,e,i=this.text.width+2*this.TEXT_PADDING;this.content_height=this.text.height+30,this.content_width=ct.a(this.DIALOG_MIN_WIDTH,this.DIALOG_MAX_WIDTH,i);var o={start_x:.1*this.DIALOG_MAX_WIDTH,center_x:.1*this.DIALOG_MAX_WIDTH-5},n={x:25,y:this.content_height+20},r={x:5,y:this.content_height+40},a=this.content_height>80?40:this.content_height/2,c=(null===(e=null===(t=this.actor)||void 0===t?void 0:t.app)||void 0===e?void 0:e.get_app().renderer.type)===s.p.CANVAS;switch(this.actor_dialog.clear(),this.bubbles.clear(),this.type){case Et.a.SAYING:c&&(this.actor_dialog.beginFill(0,.3),this.actor_dialog.drawRoundedRect(0,0,this.content_width+1,this.content_height+1,16),this.actor_dialog.moveTo(o.start_x,this.content_height),this.actor_dialog.lineTo(o.center_x+1,this.content_height+25+1),this.actor_dialog.lineTo(o.start_x+1+25,this.content_height+1),this.actor_dialog.endFill()),this.actor_dialog.beginFill(16777215),this.actor_dialog.drawRoundedRect(0,0,this.content_width,this.content_height,16),this.actor_dialog.moveTo(o.start_x,this.content_height),this.actor_dialog.lineTo(o.center_x,this.content_height+25),this.actor_dialog.lineTo(o.start_x+25,this.content_height),this.actor_dialog.endFill(),this.bubbles.visible=!1;break;case Et.a.THINKING:c&&(this.bubbles.beginFill(0,.3),this.bubbles.drawEllipse(n.x+1,n.y+1,13,10),this.bubbles.drawEllipse(r.x+1,r.y+1,8,6),this.bubbles.endFill(),this.bubbles.visible=!0,this.actor_dialog.beginFill(0,.3),this.actor_dialog.drawRoundedRect(0,0,this.content_width+1,this.content_height+1,a),this.actor_dialog.endFill()),this.bubbles.beginFill(16777215),this.bubbles.drawEllipse(n.x,n.y,13,10),this.bubbles.drawEllipse(r.x,r.y,8,6),this.bubbles.endFill(),this.bubbles.visible=!0,this.actor_dialog.beginFill(16777215),this.actor_dialog.drawRoundedRect(0,0,this.content_width,this.content_height,a),this.actor_dialog.endFill()}},e}(Pt);!function(t){t[t.RECORDING=0]="RECORDING",t[t.RECOGNITION=1]="RECOGNITION"}(yt||(yt={}));var Nt={distance:2,color:0,alpha:.5,rotation:45,blur:0},Dt={alpha:.22,rotation:90,distance:3},Gt={fontFamily:["PingFangSC","Microsoft YaHei"],fontSize:20,fontWeight:"500",align:"center"},jt={fontFamily:["PingFangSC","Microsoft YaHei"],fontSize:20,fontWeight:"400",lineHeight:26,align:"left",fill:"#000000",wordWrap:!0,wordWrapWidth:550,breakWords:!0},Ft={width:7,gap:15,max_height:65,min_height:10,num_per_side:8,color:16729173},zt={width:3,gap:8,max_height:23,min_height:5,num_per_side:14,color:1952135},Bt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Ht=function(t){function e(e,i){var o=t.call(this)||this;return o.is_touching=!1,o.on_default_mouse_down=function(){o.is_touching=!0},o.on_default_mouse_up=function(){o.is_touching&&(o.is_touching=!1,o.type&&o.events.fire("voice_dialog_btn:click",{type:o.type}))},o.on_default_mouse_out=function(){o.is_touching=!1},o.app=e,o.events=i,o.interactive=!0,o.addListener("mousedown",o.on_default_mouse_down).addListener("mouseup",o.on_default_mouse_up).addListener("mouseout",o.on_default_mouse_out).addListener("touchstart",o.on_default_mouse_down).addListener("touchend",o.on_default_mouse_up).addListener("touchendoutside",o.on_default_mouse_out),o}return Bt(e,t),e}(s.j),Vt=function(t){function e(e,i,o,n){void 0===o&&(o=1);var r=t.call(this,e,i)||this;return r.icon=new s.t,r.default_alpha=o,r.active_alpha=void 0===n?o:n,r.icon.anchor.set(.5),r.set_icon_alpha(r.default_alpha),r.default_alpha!==r.active_alpha&&r.addListener("mouseover",function(){r.set_icon_alpha(r.active_alpha)}).addListener("mouseout",function(){r.set_icon_alpha(r.default_alpha)}),r.addChild(r.icon),r}return Bt(e,t),e.prototype.set_icon_texture=function(t){this.icon.texture=t},e.prototype.set_icon_alpha=function(t){this.icon.alpha=t,this.app.render()},e}(Ht),Ut=function(t){function e(e,i){var o=t.call(this,e,i,.4,.3)||this;return o.scale.set(.16),o.type="close_btn",o}return Bt(e,t),e}(Vt),Wt=function(t){function e(e,i){var o=t.call(this,e,i,1,.7)||this;return o.scale.set(.56),o.app.get_renderer_type()===s.p.WEBGL&&(o.drop_shadow_filter=new s.h(Dt),o.filters=[o.drop_shadow_filter]),o}return Bt(e,t),e.prototype.set_textures=function(t){this.textures=t},e.prototype.draw_btn=function(t){if(this.textures&&this.type!==t&&(this.type=t,this.set_icon_texture(this.textures[this.type]),this.drop_shadow_filter)){switch(t){case"recorder_btn":this.drop_shadow_filter.color=16729173,this.drop_shadow_filter.blur=5;break;case"terminate_btn":this.drop_shadow_filter.color=15753312,this.drop_shadow_filter.blur=5;break;case"play_btn":case"stop_btn":this.drop_shadow_filter.color=1298827,this.drop_shadow_filter.blur=7;break;case"recognize_btn":return void(this.filters=[])}this.filters=[this.drop_shadow_filter]}},e}(Vt),Xt=function(t){function e(e,i,o,n,r){void 0===n&&(n=1);var a=t.call(this,e,i)||this;return a.text=new s.v("",Gt),a.default_alpha=n,a.active_alpha=void 0===r?n:r,a.type=o,a.cursor="pointer",a.text.anchor.set(.5),a.default_alpha!==a.active_alpha&&a.addListener("mouseover",function(){a.set_text_alpha(a.active_alpha)}).addListener("mouseout",function(){a.set_text_alpha(a.default_alpha)}),a.addChild(a.text),a}return Bt(e,t),e.prototype.set_text=function(t){this.text.text=t},e.prototype.set_text_color=function(t){this.text.style.fill=t},e.prototype.set_text_alpha=function(t){this.text.alpha=t,this.app.render()},e}(Ht),Yt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Kt=function(t){function e(e){var i=e.gap,o=e.num_per_side,n=e.width,r=e.max_height,a=e.min_height,c=e.color,_=t.call(this)||this;_.animation_interval=120,_.current_central_gap=0,_.max_item_height=r,_.min_item_height=a,_.item_num_per_side=o,_.item_gap=i;for(var h=n/2,l=0;l<2*_.item_num_per_side;l++){var p=new s.j;p.beginFill(c).drawRoundedRect(0,0,n,_.max_item_height,h).endFill(),p.position.x=l*i,_.addChild(p)}return _}return Yt(e,t),e.prototype.set_item_height=function(t,e){t instanceof s.j&&(t.height=e,t.position.y=(this.max_item_height-e)/2)},e.prototype.animate=function(){var t=this;this.animation_timer&&window.clearInterval(this.animation_timer);var e=this.max_item_height-this.min_item_height;this.animation_timer=window.setInterval(function(){for(var i=0;i<t.item_num_per_side;i++){var o=Math.random()*e+t.min_item_height,n=t.children[i],r=t.children[t.children.length-i-1];t.set_item_height(n,o),t.set_item_height(r,o)}},this.animation_interval)},e.prototype.terminate=function(){this.animation_timer&&window.clearInterval(this.animation_timer)},e.prototype.set_central_gap=function(t){if(this.current_central_gap!==t){this.current_central_gap=t;for(var e=0;e<2*this.item_num_per_side;e++){var i=this.children[e],o=e<this.item_num_per_side?e*this.item_gap:e*this.item_gap+t;i.position.x=o}}},e}(s.j),qt=function(){function t(t,e){this.start_time=0,this.volume_bar=new Kt(t),this.timer=new s.v("00:00",jt),this.parent_graphics=e}return t.prototype.set_text=function(t){this.timer.text=t},t.prototype.start_counting=function(){var t=this;0===this.start_time&&(this.start_time=Date.now(),this.timer.text="00:00"),this.counting_timer=window.setInterval(function(){var e=Date.now()-t.start_time,i=Math.round(e/1e3),o=Math.floor(i/60);i-=60*o;var n=o<10?"0"+o:o.toString(),r=i<10?"0"+i:i.toString();t.timer.text=n+":"+r},1e3)},t.prototype.stop_counting=function(){this.timer.text="00:00",this.start_time=0,this.counting_timer&&clearInterval(this.counting_timer)},t.prototype.start_animation=function(){this.volume_bar.animate()},t.prototype.stop_animation=function(){this.volume_bar.terminate()},t.prototype.get_volume_bar=function(){return this.volume_bar},t.prototype.get_timer=function(){return this.timer},t}(),Jt=function(t){function e(e,i,o,n){var r=t.call(this,Ft,e)||this;r.get_text_record=o,r.events=n;var s=i.max_duration,a=i.thresholds,c=r.get_text_record(),_=c.countdown_prefix,h=c.countdown_suffix;return r.countdown_prefix=_,r.countdown_suffix=h,r.countdown_opt={max_duration:s,thresholds:Math.min(s,a)},r.timer.anchor.set(.5),r.parent_graphics.addChild(r.volume_bar,r.timer),r}return Yt(e,t),e.prototype.set_visible=function(t){this.timer.visible=t,this.volume_bar.visible=t},e.prototype.start_counting=function(){var t=this;0===this.start_time&&(this.start_time=Date.now()-1e3,this.timer.text="00:01"),this.counting_timer=window.setInterval(function(){var e=Date.now()-t.start_time,i=Math.round(e/1e3);if(i<t.countdown_opt.thresholds){var o=Math.floor(i/60);i-=60*o;var n=o<10?"0"+o:o.toString(),r=i<10?"0"+i:i.toString();t.timer.text=n+":"+r}else{var s=t.countdown_opt.max_duration-i;s>0?t.timer.text=""+t.countdown_prefix+s+t.countdown_suffix:(clearInterval(t.counting_timer),t.events.fire("voice_dialog:recorder_time_up",void 0))}},1e3)},e.prototype.stop_counting=function(){this.timer.text="00:00",this.start_time=0,this.counting_timer&&clearInterval(this.counting_timer)},e.prototype.set_countdown_warning_text=function(t,e){this.countdown_prefix=t,this.countdown_suffix=e},e.prototype.destroy=function(){this.timer.destroy({texture:!0}),this.volume_bar.destroy({children:!0})},e}(qt),Qt=function(t){function e(e){var i=t.call(this,zt,e)||this;i.graphics=new s.j,i.graphics.lineStyle(2,1161338).beginFill(2940568).drawRoundedRect(0,0,400,50,6).endFill(),i.timer.position.set((400-i.timer.width)/2,(50-i.timer.height)/2),i.timer.style.fill=16777215,i.volume_bar.set_central_gap(i.timer.width+40),i.volume_bar.position.set((400-i.volume_bar.width)/2,(50-i.volume_bar.height)/2);var o=i.draw_point(),n=i.draw_point();return o.position.set(i.volume_bar.position.x-8,(50-o.height)/2),n.position.set(i.volume_bar.position.x+i.volume_bar.width+8,(50-n.height)/2),i.graphics.addChild(i.volume_bar,i.timer,o,n),i.parent_graphics.addChild(i.graphics),i}return Yt(e,t),e.prototype.get_graphic=function(){return this.graphics},e.prototype.set_visible=function(t){this.graphics.visible=t},e.prototype.destroy=function(){this.timer.destroy({texture:!0}),this.volume_bar.destroy({children:!0}),this.graphics.destroy({children:!0})},e.prototype.draw_point=function(){var t=new s.j;return t.beginFill(16777215).drawCircle(0,0,2).endFill(),t},e}(qt),Zt=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),$t=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i},te=function(){function t(t){var e=t.close_btn,i=t.central_btn,o=t.confirm_btn,n=t.cancel_btn,r=t.content,s=t.recorder_volume_panel,a=t.get_text_record,c=t.set_content;this.close_btn=e,this.central_btn=i,this.confirm_btn=o,this.cancel_btn=n,this.content=r,this.recorder_volume_panel=s,this.get_text_record=a,this.set_content=c}return t.prototype.mount=function(){this.close_btn.visible=!0,this.central_btn.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.content.visible=!0,this.recorder_volume_panel.set_visible(!1),this.central_btn.draw_btn("recorder_btn")},t.prototype.dismount=function(){this.recorder_volume_panel.stop_counting(),this.recorder_volume_panel.stop_animation(),this.recorder_animation_start_timer&&clearTimeout(this.recorder_animation_start_timer)},t}(),ee=function(t){function e(e){var i=e.player_volume_panel,o=$t(e,["player_volume_panel"]),n=t.call(this,o)||this;return n.type=yt.RECORDING,n.player_volume_panel=i,n}return Zt(e,t),e.prototype.mount=function(){t.prototype.mount.call(this),this.player_volume_panel.set_visible(!1);var e=this.get_text_record(),i=e.start_recording,o=e.recorder_confirm,n=e.recorder_cancel;this.set_content(i),this.confirm_btn.set_text(o),this.cancel_btn.set_text(n),this.central_btn.draw_btn("recorder_btn")},e.prototype.dismount=function(){t.prototype.dismount.call(this),this.player_volume_panel.set_visible(!1),this.player_volume_panel.stop_counting(),this.player_volume_panel.stop_animation()},e.prototype.set_state=function(t){var e=this;switch(this.dismount(),t){case"init":this.mount();break;case"recording":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.central_btn.visible=!0,this.central_btn.draw_btn("terminate_btn"),this.set_content(this.get_text_record().recording),this.recorder_volume_panel.set_text(""),this.recorder_volume_panel.set_visible(!0),this.recorder_volume_panel.start_animation(),this.recorder_animation_start_timer=window.setTimeout(function(){e.recorder_volume_panel.start_counting(),e.content.visible=!1},1e3);break;case"done":this.content.visible=!1,this.confirm_btn.visible=!0,this.cancel_btn.visible=!0,this.central_btn.draw_btn("play_btn"),this.recorder_volume_panel.set_visible(!1),this.player_volume_panel.set_visible(!0);break;case"playing":this.content.visible=!1,this.confirm_btn.visible=!0,this.cancel_btn.visible=!0,this.central_btn.draw_btn("stop_btn"),this.recorder_volume_panel.set_visible(!1),this.player_volume_panel.set_visible(!0),this.player_volume_panel.start_counting(),this.player_volume_panel.start_animation()}},e}(te),ie=function(t){function e(e){var i=e.loading_icon,o=e.start_loading_animation,n=e.stop_loading_animation,r=$t(e,["loading_icon","start_loading_animation","stop_loading_animation"]),s=t.call(this,r)||this;return s.type=yt.RECOGNITION,s.loading_icon=i,s.start_loading_animation=o,s.stop_loading_animation=n,s}return Zt(e,t),e.prototype.mount=function(){t.prototype.mount.call(this),this.loading_icon.visible=!1;var e=this.get_text_record(),i=e.start_speaking,o=e.recognition_confirm,n=e.recognition_cancel;this.set_content(i),this.confirm_btn.set_text(o),this.cancel_btn.set_text(n)},e.prototype.dismount=function(){t.prototype.dismount.call(this),this.loading_icon.visible=!1,this.stop_loading_animation()},e.prototype.set_state=function(t){var e=this;switch(this.dismount(),t){case"init":this.mount();break;case"recording":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.loading_icon.visible=!1,this.central_btn.visible=!0,this.central_btn.draw_btn("terminate_btn"),this.set_content(this.get_text_record().recording),this.recorder_volume_panel.set_text(""),this.recorder_volume_panel.set_visible(!0),this.recorder_volume_panel.start_animation(),this.recorder_animation_start_timer=window.setTimeout(function(){e.recorder_volume_panel.start_counting(),e.content.visible=!1},1e3);break;case"recognizing":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.central_btn.visible=!0,this.central_btn.draw_btn("recognize_btn"),this.recorder_volume_panel.set_visible(!1),this.set_content(this.get_text_record().recognizing),this.loading_icon.visible=!0,this.start_loading_animation();break;case"success":this.content.visible=!0,this.confirm_btn.visible=!0,this.cancel_btn.visible=!0,this.central_btn.draw_btn("recorder_btn"),this.recorder_volume_panel.set_visible(!1),this.loading_icon.visible=!1;break;case"failure":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.central_btn.draw_btn("recorder_btn"),this.set_content(this.get_text_record().recognition_failure),this.recorder_volume_panel.set_visible(!1),this.loading_icon.visible=!1}},e}(te),oe=function(){return(oe=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},ne=function(){function t(t,e,i,o){var n=this,r=t.url,a=t.texture_name,c=t.text_record,_=t.countdown_opt;this.graphics=new s.j,this.voice_type=yt.RECOGNITION,this.dialog_width=0,this.dialog_height=0,this.set_content=function(t){n.content.text=t;var e=n.dialog_width-68;n.content.style.wordWrapWidth=e;var i=n.get_byte_length(n.content.text),o=Math.ceil(10*(i-2*e/10)/e*26);o=o>0?o:0,n.draw_background(0,o),n.update_central_btn_position(),n.update_side_btns_position(o),n.update_content_position(),n.loading_icon.visible&&n.update_loading_icon_position()},this.start_loading_animation=function(){n.stop_loading_animation(),n.update_loading_icon_position(),n.loading_animation_timer=window.setInterval(function(){n.loading_icon.rotation+=.05},20)},this.stop_loading_animation=function(){n.loading_animation_timer&&window.clearInterval(n.loading_animation_timer)},this.get_text_record=function(){return n.text_record},this.set_parent=function(t){n.graphics.setParent(t)},this.on_stage_resize=function(t){t.target_id===n.app.get_app().stage.name&&(n.stage_width=t.data.width,n.stage_height=t.data.height,n.draw_background(),n.update_close_btn_position(),n.update_central_btn_position(),n.update_side_btns_position(),n.update_content_position(),n.update_recorder_volume_panel_position(),n.update_player_volume_panel_position(),n.update_loading_icon_position(),n.graphics.hitArea=new s.q(0,-n.stage_height+n.dialog_height,n.stage_width,n.stage_height))},this.app=e,this.events=o,this.loader=i,this.text_record=c,this.state="init";var h=this.app.get_app().view,l=h.width,p=h.height;this.stage_width=l,this.stage_height=p,this.graphics.name="voice_dialog",this.graphics.interactive=!0,this.graphics.visible=!1,this.draw_background(),this.close_btn=new Ut(this.app,this.events),this.update_close_btn_position(),this.graphics.addChild(this.close_btn),this.central_btn=new Wt(this.app,this.events),this.update_central_btn_position(),this.graphics.addChild(this.central_btn),this.confirm_btn=new Xt(this.app,this.events,"confirm_btn",1,.7),this.confirm_btn.set_text(c.recorder_confirm),this.confirm_btn.set_text_color("0x297EFF"),this.cancel_btn=new Xt(this.app,this.events,"cancel_btn",1,.7),this.cancel_btn.set_text(c.recorder_cancel),this.update_side_btns_position(),this.graphics.addChild(this.confirm_btn,this.cancel_btn),this.content=new s.v("",jt),this.content.anchor.set(.5),this.update_content_position(),this.graphics.addChild(this.content),this.recorder_volume_panel=new Jt(this.graphics,_,this.get_text_record,this.events),this.update_recorder_volume_panel_position(),this.player_volume_panel=new Qt(this.graphics),this.update_player_volume_panel_position(),this.player_volume_panel.set_visible(!1),this.loading_icon=new s.t,this.loading_icon.anchor.set(.5),this.loading_icon.scale.set(.15),this.loading_icon.visible=!1,this.update_loading_icon_position(),this.graphics.addChild(this.loading_icon),this.app.get_renderer_type()===s.p.WEBGL&&(this.graphics.filters=[new s.h(Nt)]);var u=function(){n.update_loading_icon_position()};this.loader.add({url:r,on_success:function(t){var e=t.textures;if(e){var i=a.close_btn,o=a.recorder_btn,r=a.terminate_btn,s=a.recognize_btn,c=a.play_btn,_=a.stop_btn,h=a.loading_icon;n.close_btn.set_icon_texture(e[i]);var l={recorder_btn:e[o],terminate_btn:e[r],recognize_btn:e[s],play_btn:e[c],stop_btn:e[_]};n.central_btn.set_textures(l),n.central_btn.draw_btn("recorder_btn"),n.loading_icon.texture=e[h],n.update_side_btns_position(),n.update_recorder_volume_panel_position(),u()}},on_error:u}),this.events.add_listener("stage:resize",this.on_stage_resize)}return t.prototype.set_state=function(t){var e;null!==(e=this.painter)&&void 0!==e&&e.set_state(t),this.state=t},t.prototype.get_state=function(){return this.state},t.prototype.get_visible=function(){return this.graphics.visible},t.prototype.set_voice_record_duration=function(t){var e=t%60,i=Math.floor(t/60),o=e<10?"0"+e:""+e,n=i<10?"0"+i:""+i;this.player_volume_panel.set_text(n+":"+o)},t.prototype.set_recorder_countdown_warning_text=function(t,e){this.recorder_volume_panel.set_countdown_warning_text(t,e)},t.prototype.draw_background=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.graphics.clear(),this.graphics.beginFill(16777215);var i=this.stage_width/2,o=this.stage_height/2;this.dialog_width=this.stage_width-32,this.dialog_height=254+t+e,this.graphics.drawRoundedRect(0,0,this.dialog_width,this.dialog_height,6),this.graphics.endFill(),this.graphics.position.set(16-i,o-270-t-e),this.graphics.hitArea=new s.q(0,-this.stage_height+this.dialog_height,this.stage_width,this.stage_height)},t.prototype.show=function(t){this.graphics.visible=!0,this.voice_type!==t&&this.painter&&this.painter.dismount(),this.voice_type=t,this.get_painter().mount()},t.prototype.hide=function(){this.graphics.visible=!1,this.get_painter().dismount()},t.prototype.get_byte_length=function(t){for(var e=0,i=0;i<t.length;i++)t.charCodeAt(i)>127||94===t.charCodeAt(i)?e+=2:e++;return e},t.prototype.set_text_record=function(t){this.text_record=t;var e=this.voice_type===yt.RECOGNITION;switch(this.state){case"init":this.set_content(e?t.start_speaking:t.start_recording);break;case"recording":this.set_content(t.recording),this.set_recorder_countdown_warning_text(t.countdown_prefix,t.countdown_suffix);break;case"recognizing":this.set_content(t.recognizing);break;case"failure":this.set_content(t.recognition_failure)}e?(this.cancel_btn.set_text(t.recognition_cancel),this.confirm_btn.set_text(t.recognition_confirm)):(this.cancel_btn.set_text(t.recorder_cancel),this.confirm_btn.set_text(t.recorder_confirm))},t.prototype.update_content_position=function(){this.content.position.set(this.dialog_width/2,47+this.content.height/2)},t.prototype.update_close_btn_position=function(){this.close_btn.position.set(this.dialog_width-32,30)},t.prototype.update_central_btn_position=function(){this.central_btn.position.set(this.dialog_width/2,this.dialog_height-94)},t.prototype.update_side_btns_position=function(t){void 0===t&&(t=0);var e=this.central_btn,i=e.position,o=e.width/2;this.cancel_btn.position.set(i.x-o-46-this.cancel_btn.width,i.y+t),this.confirm_btn.position.set(i.x+o+46+this.confirm_btn.width,i.y+t)},t.prototype.update_recorder_volume_panel_position=function(){var t=this.recorder_volume_panel.get_volume_bar(),e=this.recorder_volume_panel.get_timer();t.set_central_gap(this.central_btn.width+40),t.position.set(this.central_btn.position.x-t.width/2,this.central_btn.position.y-t.height/2),e.position.set(this.dialog_width/2,47+e.height/2)},t.prototype.update_player_volume_panel_position=function(){var t=this.player_volume_panel.get_graphic();t.position.set(this.central_btn.position.x-t.width/2,33)},t.prototype.update_loading_icon_position=function(){this.loading_icon.position.set(this.content.position.x-this.content.width/2-10-this.loading_icon.width/2,this.content.position.y)},t.prototype.get_painter=function(){if(!this.painter||this.painter.type!==this.voice_type){var t={close_btn:this.close_btn,central_btn:this.central_btn,confirm_btn:this.confirm_btn,cancel_btn:this.cancel_btn,content:this.content,recorder_volume_panel:this.recorder_volume_panel,get_text_record:this.get_text_record,set_content:this.set_content};this.voice_type===yt.RECORDING?this.painter=new ee(oe(oe({},t),{player_volume_panel:this.player_volume_panel})):this.painter=new ie(oe(oe({},t),{loading_icon:this.loading_icon,start_loading_animation:this.start_loading_animation,stop_loading_animation:this.stop_loading_animation}))}return this.painter},t.prototype.destroy=function(){this.hide(),this.events.remove_listener("stage:resize",this.on_stage_resize),this.confirm_btn.destroy({children:!0,texture:!0}),this.cancel_btn.destroy({children:!0,texture:!0}),this.content.destroy({texture:!0}),this.recorder_volume_panel.destroy(),this.player_volume_panel.destroy(),this.graphics.destroy({children:!0})},t}(),re=function(){function t(t){var e=this;this.is_running=!1,this.tasks=[],this.on_tick=function(){if(e.cur_task)if(e.cur_task.printer.text.length>=e.cur_task.content.length)e.stop();else{var t=e.cur_task.content.substring(0,Math.min(Math.ceil(e.index),e.cur_task.content.length));e.cur_task.printer.text=t,e.index+=e.app.get_app().ticker.elapsedMS/50,e.cur_task.on_update&&e.cur_task.on_update()}},this.app=t,this.index=1}return t.prototype.add_task=function(t){if(!this.is_running)return this.cur_task=t,void this.execute();this.tasks.push(t)},t.prototype.release=function(){this.is_running=!1,this.cur_task=this.tasks.shift(),this.cur_task&&this.execute()},t.prototype.clear=function(){this.tasks=[],this.cur_task=void 0,this.is_running=!1},t.prototype.execute=function(){this.is_running=!0,this.index=1,this.cur_task&&(this.app.get_app().ticker.add(this.on_tick),this.cur_task.on_start&&this.cur_task.on_start())},t.prototype.stop=function(){this.cur_task&&(this.app.get_app().ticker.remove(this.on_tick),this.cur_task.on_complete&&this.cur_task.on_complete())},t.prototype.finish=function(){this.cur_task&&(this.cur_task.printer.text=this.cur_task.content,this.stop())},t}(),se=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ae={fontSize:"21px",fontFamily:"Microsoft YaHei",fill:"#498AD9"},ce={fontSize:"22px",fontFamily:"Microsoft YaHei",fill:"#333333"},_e={fontSize:"21px",fontFamily:"Microsoft YaHei",fill:"#AEAEAE"},he=function(t){function e(e,i,o,n,r){var a=t.call(this)||this;return a.bg_line_width=0,a.actor_line_width=0,a.is_printing=!1,a.on_complete_cb=void 0,a.set_parent=function(t){a.setParent(t)},a.on_stage_resize=function(t){t.target_id===a.app.get_app().stage.name&&a.draw_dialog_basis()},a.app=e,a.data=i,a.events=r,a.loader=o,a.name="stage_dialog",a.preview=new s.t,a.target_name=new s.v("",ae),a.content=new s.v("",ce),a.next_text=new s.v("点击继续",_e),a.next_text.name="next_text",a.next_icon=new s.t,a.next_icon.name="next_icon",a.print=new re(a.app),a.addListener("mouseup",a.on_mouse_up.bind(a)),a.addListener("touchend",a.on_mouse_up.bind(a)),a.loader.add({url:n.url,on_success:function(t){var e=t.textures;e&&(a.next_icon.texture=e[n.next_icon],a.app.render())}}),a.draw_dialog_basis(),a.interactive=!0,a.visible=!1,a.addChild(a.next_icon,a.next_text,a.preview,a.target_name,a.content),a.events.add_listener("stage:resize",a.on_stage_resize),a}return se(e,t),e.prototype.draw_dialog_basis=function(){var t=this.app.get_app().view,e=t.width,i=t.height,o=e-24;this.clear(),this.lineStyle(2,14276302,1),this.beginFill(16777215,1),this.drawRoundedRect(0,0,o,180,4),this.hitArea=new s.q(0,0,o,180),this.y=i/2-180-12,this.x=-e/2+12,this.endFill(),this.next_icon.x=o-10-20,this.next_icon.y=150,this.update_next_text_position(),this.bg_line_width=Math.floor(e-24-30-12-20),this.actor_line_width=Math.floor(e-24-20-100-12-20)},e.prototype.update_next_text_position=function(){this.next_text.x=this.next_icon.x-this.next_text.width-7,this.next_text.y=this.next_icon.y-5},e.prototype.set_component_size_and_position=function(t){var e=100;if(t===Z.d.Scene)e=30,this.preview.x=0;else{var i=this.preview.texture.width/this.preview.texture.height;this.preview.width=i>1?e:e*i,this.preview.height=i>1?e/i:e,this.preview.position.set(20,(180-this.preview.height)/2)}this.target_name.position.x=this.preview.position.x+e+12,this.target_name.position.y=20,this.content.position.x=this.target_name.position.x,this.content.position.y=this.target_name.position.y+this.target_name.height+6},e.prototype.show_stage_dialog=function(t,e,i,o,n){var r=this,a=this.data.get_target(t);if(!a)return new _.a("Cannot find target "+t);this.visible=!0,this.preview.texture=c.l(a)?new s.y(a.texture.baseTexture):s.y.EMPTY,this.set_component_size_and_position(a.type),this.target_name.text=e;var h=o?void 0:n;this.print.add_task({id:t,content:i,printer:this.content,on_start:function(){r.is_printing=!0},on_complete:function(){r.is_printing=!1,r.on_complete_cb=h}})},e.prototype.on_mouse_up=function(){this.is_printing?this.print.finish():(this.content.text="",this.print.release(),this.on_complete_cb&&this.on_complete_cb())},e.prototype.get_max_content_width=function(t){return t===Z.d.Actor?this.actor_line_width:this.bg_line_width},e.prototype.set_next_text=function(t){this.next_text.text=t,this.update_next_text_position()},e.prototype.hide=function(){this.visible=!1,this.content.text="",this.target_name.text="",this.print.clear()},e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0,texture:!0}),this.events.remove_listener("stage:resize",this.on_stage_resize)},e}(s.j),le={width:2,color:14211288,alpha:.7},pe={width:2,color:15132390,alpha:.4},ue={width:2,color:15132390,alpha:.15},de={fontWeight:"bold",fontSize:"16px",fontFamily:"STHeitiSC-Medium",fill:"#000000"},fe={fontWeight:"bold",fontSize:"16px",fontFamily:"STHeitiSC-Medium",fill:"#ffffff"},ge=function(){function t(t,e){var i=this;this.grid=new s.j,this.axis_arrow=new s.j,this.x_label=new s.v("X",de),this.y_label=new s.v("Y",de),this.x_label_shadow=new s.v("X",fe),this.y_label_shadow=new s.v("Y",fe),this.set_parent=function(t){i.grid.setParent(t)},this.on_stage_resize=function(t){t.target_id===i.app.get_app().stage.name&&(i.stage_width=t.data.width,i.stage_height=t.data.height,i.grid.removeChildren(),i.draw_grid_lines(20,100),i.label_axis_numbers(100),i.draw_axis_arrows(),i.set_xy_label_position())},this.app=t,this.events=e;var o=this.app.get_app().view,n=o.width,r=o.height;this.stage_width=n,this.stage_height=r,this.init_grid(),this.grid.visible=!1,e.add_listener("stage:resize",this.on_stage_resize)}return t.prototype.init_grid=function(){this.draw_grid_lines(20,100),this.label_axis_numbers(100),this.draw_axis_arrows(),this.init_xy_label()},t.prototype.draw_grid_lines=function(t,e){this.grid.clear();for(var i,o=this.stage_height/2,n=this.stage_width/2,r=0,s=0,a=0;a<o;)i=0===a?le:a%e===0?pe:ue,this.grid.lineStyle(i.width,i.color,i.alpha),this.grid.moveTo(-n,a),this.grid.lineTo(n,a),this.grid.moveTo(-n,-a),this.grid.lineTo(n,-a),a=++r*t;for(r=0;s<n;)i=0===s?le:s%e===0?pe:ue,this.grid.lineStyle(i.width,i.color,i.alpha),this.grid.moveTo(s,-o),this.grid.lineTo(s,o),this.grid.moveTo(-s,-o),this.grid.lineTo(-s,o),s=++r*t},t.prototype.draw_axis_arrows=function(){this.axis_arrow.clear();var t=this.stage_width/2,e=this.stage_height/2;this.axis_arrow.beginFill(14211288),this.axis_arrow.drawPolygon([t-10,5,t,0,t-10,-5]),this.axis_arrow.endFill(),this.axis_arrow.beginFill(14211288),this.axis_arrow.drawPolygon([-5,10-e,0,-e,5,10-e]),this.axis_arrow.endFill(),this.grid.addChild(this.axis_arrow)},t.prototype.label_axis_numbers=function(t){for(var e=0,i=0;i<this.stage_height/2;){var o=i.toString(),n=(-i).toString();(a=new s.v(o,de)).x=5,a.y=5-i,a.alpha=.8,(c=new s.v(n,de)).x=5,c.y=i+5,c.alpha=.8,(_=new s.v(o,fe)).x=5,_.y=5-i+1,_.alpha=.8,(h=new s.v(n,fe)).x=5,h.y=i+5+1,h.alpha=.8,this.grid.addChild(a,c,_,h),i=++e*t}e=1;for(var r=t;r<this.stage_width/2;){var a,c,_,h,l=r.toString(),p=(-r).toString();(a=new s.v(l,de)).x=r+5,a.y=5,a.alpha=.8,(c=new s.v(p,de)).x=5-r,c.y=5,c.alpha=.8,(_=new s.v(l,fe)).x=r+5,_.y=6,_.alpha=.8,(h=new s.v(p,fe)).x=5-r,h.y=6,h.alpha=.8,this.grid.addChild(a,c,_,h),r=++e*t}},t.prototype.init_xy_label=function(){this.x_label.alpha=.8,this.y_label.alpha=.8,this.x_label_shadow.alpha=.8,this.y_label_shadow.alpha=.8,this.set_xy_label_position()},t.prototype.set_xy_label_position=function(){var t={x:this.stage_width/2-10-8,y:-26},e={x:10,y:10-this.stage_height/2};this.x_label.position.set(t.x,t.y),this.y_label.position.set(e.x,e.y),this.x_label_shadow.position.set(t.x,t.y+1),this.y_label_shadow.position.set(e.x,e.y+1),this.grid.addChild(this.x_label,this.y_label,this.x_label_shadow,this.y_label_shadow)},t.prototype.set_visible=function(t){this.grid.visible=t},t.prototype.set_z_index=function(t){var e=this.grid.parent;t=Math.min(t,e.children.length-1),t=Math.max(1,t),e.setChildIndex(this.grid,t)},t.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.on_stage_resize),this.grid.destroy({children:!0})},t}(),ye=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ve={fontSize:22,fontFamily:"Microsoft YaHei"},be=function(t){function e(e,i){var o=t.call(this)||this;o.selections=[],o.is_landscape=!1,o.on_complete_cb=void 0,o.stage_height=0,o.stage_width=0,o.dialog_height=0,o.dialog_width=0,o.selection_width=0,o.selection_height=0,o.distance=0,o.MARGIN=10,o.RECT_RADIUS=9,o.pop_selection=function(){if(o.distance>0){var t=Math.ceil(o.distance/4);o.position.y-=t,o.distance-=t}else o.app.get_app().ticker.remove(o.pop_selection)},o.set_parent=function(t){o.setParent(t)},o.on_stage_resize=function(t){t.target_id===o.app.get_app().stage.name&&(o.stage_width=t.data.width,o.stage_height=t.data.height,o.is_landscape=o.stage_width>o.stage_height,o.dialog_width=o.stage_width-2*o.MARGIN,o.selection_width=o.is_landscape?o.dialog_width/2:o.dialog_width,o.selection_height=.0888*o.stage_height,o.redraw_selections())},o.app=e,o.events=i,o.visible=!1,o.selection_container=new s.j,o.selection_header=new s.j;var n=o.app.get_app().view,r=n.width,a=n.height;return o.stage_width=r,o.stage_height=a,o.dialog_width=o.stage_width-2*o.MARGIN,o.selection_width=o.dialog_width,o.selection_height=.0888*o.stage_height,o.init_selections(),o.draw_header(),o.app.get_renderer_type()===s.p.WEBGL&&(o.filters=[new s.h({rotation:45,distance:3,alpha:.15,color:0,blur:0})]),o.addChild(o.selection_container,o.selection_header),o.events.add_listener("stage:resize",o.on_stage_resize),o}return ye(e,t),e.prototype.init_selections=function(){for(var t=0;t<4;t++){var e=new s.f,i=new s.j,o=new s.j,n=new s.v("",ve);n.anchor.set(.5),n.visible=!0,i.clear(),i.lineStyle(2,14211288,1),i.beginFill(16777215,1),i.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),i.endFill(),o.clear(),o.beginFill(2719487,1),o.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),o.endFill(),e.addChild(i,o,n),e.visible=!1,e.buttonMode=!0,e.interactive=!0,e.on("touchstart",function(t){t.stopPropagation()}),e.on("mousedown",function(t){t.stopPropagation()}),e.on("touchend",this.select_item.bind(this,t)),e.on("mouseup",this.select_item.bind(this,t)),e.on("touchstart",this.on_pointer_over.bind(this,t)),e.on("mouseover",this.on_pointer_over.bind(this,t)),e.on("mouseout",this.on_pointer_out.bind(this,t)),this.selection_container.addChild(e)}},e.prototype.show_selections=function(){var t=this;this.selection_container.visible=!0,this.selections.forEach(function(e,i){var o=t.selection_container.children[i];if(o instanceof s.f){var n=o.children[0],r=o.children[1],a=o.children[2];a instanceof s.v&&(a.text=e,a.style.fill="black"),o.visible=!0,n.visible=!0,r.visible=!1,t.is_landscape?(o.position.x=i%2?t.selection_width:0,o.position.y=Math.floor(i/2)*t.selection_height):(o.position.x=0,o.position.y=i*t.selection_height),a.position.x=t.selection_width/2,a.position.y=t.selection_height/2}})},e.prototype.hide_selections=function(){this.selection_container.children.forEach(function(t){t.visible=!1})},e.prototype.select_item=function(t,e){e.stopPropagation(),this.on_complete_cb&&this.on_complete_cb(t),this.position.y=this.stage_height/2},e.prototype.on_pointer_over=function(t){var e=this.selection_container.children[t];if(e instanceof s.f){e.children[0].visible=!1,e.children[1].visible=!0;var i=e.children[2];i instanceof s.v&&(i.style.fill="white")}},e.prototype.on_pointer_out=function(t){var e=this.selection_container.children[t];if(e instanceof s.f){e.children[0].visible=!0,e.children[1].visible=!1;var i=e.children[2];i instanceof s.v&&(i.style.fill="black")}},e.prototype.draw_header=function(){this.selection_header.beginFill(16777215,1),this.selection_header.drawRoundedRect(0,0,this.dialog_width,this.selection_height,6),this.selection_header.endFill();var t=new s.v("",ve);t.anchor.set(0,.5),t.position.x=16,this.selection_header.visible=!1,this.selection_header.position.x=0,this.selection_header.addChild(t)},e.prototype.show_header=function(t){var e=this.selection_header.children[0];e.text=t,e.position.y=this.selection_height/2,this.selection_header.position.y=-this.selection_height,this.selection_header.visible=!0},e.prototype.hide_header=function(){this.selection_header.visible=!1},e.prototype.show=function(t,e,i){this.visible=!0,this.selections=t,this.is_landscape?this.dialog_height=Math.ceil(t.length/2)*this.selection_height:this.dialog_height=t.length*this.selection_height,this.draw_selection_container(),this.show_selections(),this.on_complete_cb=i,""!==e&&this.show_header(e),this.position.y=this.stage_height/2,this.position.x=-this.stage_width/2+this.MARGIN,this.distance=this.dialog_height+this.MARGIN,this.app.get_app().ticker.remove(this.pop_selection),this.app.get_app().ticker.add(this.pop_selection)},e.prototype.get_width=function(){return this.dialog_width},e.prototype.hide=function(){this.visible=!1,this.hide_selections(),this.hide_header()},e.prototype.destroy=function(){this.app.get_app().ticker.remove(this.pop_selection),this.events.remove_listener("stage:resize",this.on_stage_resize),t.prototype.destroy.call(this,{children:!0})},e.prototype.draw_selection_container=function(){this.selection_container.clear(),this.selection_container.lineStyle(2,14211288,1),this.selection_container.beginFill(16777215,1),this.selection_container.drawRoundedRect(0,0,this.dialog_width,this.dialog_height,this.RECT_RADIUS),this.selection_container.endFill()},e.prototype.redraw_selections=function(){for(var t=0;t<this.selection_container.children.length;t++){var e=this.selection_container.children[t];if(!(e instanceof s.f))return;var i=e.children[0],o=e.children[1];if(!(i instanceof s.j&&o instanceof s.j))return;i.clear(),i.lineStyle(2,14211288,1),i.beginFill(16777215,1),i.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),i.endFill(),o.clear(),o.beginFill(2719487,1),o.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),o.endFill()}},e}(s.j);const me=i(84830);var xe,we=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Te=function(t){function e(e,i,o,n){var r=t.call(this,e,i,o,n)||this;return r.is_resizing=!1,r.drag_start_scale_btn=function(t){t.stopPropagation(),r.is_resizing=!0},r.drag_end_scale_btn=function(){r.is_resizing&&(r.is_resizing=!1,r.resizable_part&&r.emit_resizable_event("scale_btn_drag_end",r.resizable_part.scale.x))},r.on_resizable_break=function(t){t&&t!==r.id||(r.is_resizing=!1)},r.scale_btn=new s.j,r.draw_scale_btn(),r.scale_btn.addListener("mousedown",r.drag_start_scale_btn),r.scale_btn.addListener("mouseup",r.drag_end_scale_btn),r.scale_btn.addListener("mouseupoutside",r.drag_end_scale_btn),r.scale_btn.addListener("touchstart",r.drag_start_scale_btn),r.scale_btn.addListener("touchend",r.drag_end_scale_btn),r.scale_btn.addListener("touchendoutside",r.drag_end_scale_btn),r.events.event_emitter.addListener("break",r.on_resizable_break),r}return we(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0}),this.events.event_emitter.removeListener("break",this.on_resizable_break)},e.prototype.get_is_resizing=function(){return this.is_resizing},e.prototype.draw_scale_btn=function(){this.scale_btn.clear(),this.scale_btn.interactive=!0,this.scale_btn.buttonMode=!0,this.scale_btn.hitArea=new s.q(0,0,18,18);var t=Math.sqrt(2)/2;this.scale_btn.beginFill(0).arcTo(12,12,10.8,12,1.2).arcTo(0,12,1.2*t,12-1.2*t,1.2).arcTo(12,0,12,1.2,1.2).endFill()},e.prototype.get_scale_btn_position=function(){if(void 0!==this.resizable_part){var t=this.resizable_part.scale.x;return{x:this.resizable_part.width-6*t,y:this.resizable_part.height-6*t}}},e.prototype.set_scale_btn_position=function(){var t=this.get_scale_btn_position();void 0!==t&&this.scale_btn.position.set(t.x,t.y)},e.prototype.set_resizable_part=function(t){this.resizable_part=t},e.prototype.is_mouse_out_of_stage=function(t){var e=t.data.getLocalPosition(this.app.get_app().stage),i=this.app.get_app().view,o=i.width/2,n=i.height/2;return e.x<-o||e.x>o||e.y<-n||e.y>n},e.prototype.emit_resizable_event=function(t,e){this.emit(t,e)},e.prototype.add_resizable_event_listener=function(t,e){this.addListener(t,e)},e}(me.a),ke=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Oe=new s.x({fontFamily:["NotoSansCJKsc-Medium","NotoSansCJKsc"],fill:"#6B3C3C",fontWeight:"900"}),Ae=function(t){function e(e,i,o){var n=t.call(this,"timer",e,i,o)||this;if(n.drag_move_scale_btn=function(t){var e=n.background.scale.x;if(n.is_resizing&&!n.is_mouse_out_of_stage(t)&&0!==e){var i=t.data.getLocalPosition(n),o=Math.hypot(n.background.height/e,n.background.width/e),r=Math.hypot(i.x,i.y)/o;n.background.scale.set(r),n.set_scale_btn_position(),n.app.render()}},n.time=new s.v("0.00"),n.unit=new s.v("秒"),n.time.style=Object.assign({},Oe,{fontSize:30}),n.unit.style=Object.assign({},Oe,{fontSize:18}),n.background=new s.j,n.draw_background(),n.set_resizable_part(n.background),n.set_scale_btn_position(),n.scale_btn.addListener("mousemove",c.w(n.drag_move_scale_btn,c.a)),n.scale_btn.addListener("touchmove",c.w(n.drag_move_scale_btn,c.a)),n.add_resizable_event_listener("scale_btn_drag_end",function(t){n.events.fire("timer_scale_btn:drag_end",t)}),n.add_listener("drag_end",function(){n.events.fire("timer:drag_end",{position:{x:n.get_position().x,y:n.get_position().y}})}),n.app.get_renderer_type()===s.p.WEBGL){var r=new s.h({rotation:0,distance:1,alpha:.15,color:0,blur:1});n.background.filters=[r]}return n.addChild(n.background,n.scale_btn),n.set_visible(!1),n}return ke(e,t),e.prototype.draw_background=function(){this.background.clear();var t=this.time.width+this.unit.width,e=t+16+16,i=this.time.height+26;this.time.x=16,this.time.y=13,this.unit.x=this.time.x+this.time.width+3,this.unit.y=21;var o=e+4,n=i+4;this.background.beginFill(16777215),this.background.drawRoundedRect(-2,-2,o,n,20);var r=e+2,s=i+2;this.background.beginFill(16363339),this.background.drawRoundedRect(-1,-1,r,s,20),this.background.beginFill(16502616),this.background.drawRoundedRect(0,0,e,i,20);var a={x:e/2-35,y:-3};this.background.beginFill(16363339),this.background.drawRoundedRect(a.x,a.y,70,2,1);var c=e/2-40,_=e/2+15,h=i+1;this.background.beginFill(5908263),this.background.drawRoundedRect(c,h,25,2,1),this.background.drawRoundedRect(_,h,25,2,1),this.background.beginFill(16739167),this.background.drawRect(0,24,e,3),this.background.drawRect(0,30,e,3),this.background.drawRect(0,36,e,3);var l={x:this.time.x-8,y:this.time.y-5},p=t+16,u=this.time.height+10;this.background.beginFill(16777215),this.background.drawRoundedRect(l.x,l.y,p,u,11),this.background.endFill(),this.background.addChild(this.time,this.unit)},e.prototype.redraw_background=function(){this.background.clear(),this.draw_background(),this.set_scale_btn_position()},e.prototype.set_unit=function(t){var e=this.unit.width;this.unit.text=t,this.unit.width!==e&&this.redraw_background()},e.prototype.set_time=function(t){var e=this.time.width;this.time.text=t.length>500?t.substr(0,500).concat("..."):t,this.time.width!==e&&this.redraw_background()},e.prototype.set_position_x=function(t){this.position.set(t,this.position.y)},e.prototype.set_position_y=function(t){this.position.set(this.position.x,-t)},e.prototype.get_position=function(){return{x:this.position.x,y:-this.position.y}},e.prototype.set_scale_btn_visible=function(t){this.scale_btn.visible=t},e.prototype.set_scale=function(t){this.background.scale.set(t),this.set_scale_btn_position()},e}(Te);!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DEFAULT_WITH_ICON=1]="DEFAULT_WITH_ICON",t[t.ICON=2]="ICON",t[t.PLAIN_TEXT=3]="PLAIN_TEXT"}(Ct||(Ct={})),function(t){t.VARIABLE="variable",t.LIST="list"}(It||(It={}));var Ee,Ce={fontFamily:["NotoSansCJKsc-Medium","NotoSansCJKsc"],fontSize:"18px"},Ie={PADDING:10,BORDER_RADIUS:11,ICON_MARGIN_LEFT:10,ICON_MARGIN_TOP:7,ICON_MARGIN_RIGHT:5,ICON_SIZE:20,VALUE_MARGIN:10,VALUE_MARGIN_TOP:5,VARIABLE_NAME_MARGIN_LEFT:10,VALUE_TEXT_STYLE:Object.assign({},Ce,{fill:0}),NAME_TEXT_STYLE:Object.assign({},Ce,{fill:16777215}),PREFIX_TEXT_STYLE:Object.assign({},Ce,{fill:5388601}),SCALE_BTN_MARGIN:6},Pe={ICON_SIZE:63,VALUE_TEXT_STYLE:Object.assign({},Ce,{fill:16777215,stroke:16777215}),VALUE_MARGIN:10,SCALE_BTN_MARGIN_RIGHT:8,SCALE_BTN_MARGIN_BOTTOM:15},Me={TEXT_STYLE:{fontFamily:["NotoSansCJKsc-Black","NotoSansCJKsc"],fontSize:"45px",fill:"#000000",stroke:"#ffffff",strokeThickness:3,dropShadow:!0,dropShadowColor:"#333333",dropShadowBlur:2,dropShadowAngle:Math.PI/6,dropShadowDistance:2},SCALE_BTN_MARGIN_RIGHT:8,SCALE_BTN_MARGIN_BOTTOM:15};!function(t){t[t.BLANK=0]="BLANK",t[t.NON_BLANK=1]="NON_BLANK"}(xe||(xe={}));var Se,Le=170,Re=180,Ne={fontFamily:["STHeitiSC-Medium","Microsoft YaHei"],fontSize:"16px",fontWeight:"bold",align:"center"},De={fontFamily:["PingFangSC-Medium","PingFang SC"],fontSize:"20px",fontWeight:"500",align:"center"},Ge={fontFamily:["STHeitiSC-Medium","Microsoft YaHei"],fontSize:"17.5px",fontWeight:"bold",align:"center",fill:"#43372E"};!function(t){t.LIGHT="list_item_light",t.DEEP="list_item_deep"}(Ee||(Ee={}));var je,Fe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ze=function(t){function e(e,i,o,n,r,a){var _=a.theme_opt,h=a.value,l=a.variable_name,p=a.prefix,u=a.position,d=a.scale,f=t.call(this,e,i,o,n)||this;return f.type=It.VARIABLE,f.variable_name=new s.v("",Ie.NAME_TEXT_STYLE),f.value=new s.v(""),f.prefix=new s.v("",Ie.PREFIX_TEXT_STYLE),f.icon=new s.t,f.background=new s.j,f.on_position_change=function(){f.events.fire("variable:drag_end",{target_id:f.id,data:{position:f.get_position()}})},f.on_scale_change=function(){f.events.fire("variable_scale_btn:drag_end",{target_id:f.id,data:{scale:{x:f.background.scale.x,y:f.background.scale.y}}})},f.drag_move_scale_btn=function(t){var e=f.background.scale.x;if(f.is_resizing&&!f.is_mouse_out_of_stage(t)&&0!==e){var i=t.data.getLocalPosition(f),o=Math.hypot(f.background.height/e,f.background.width/e),n=Math.hypot(i.x,i.y)/o;f.background.scale.set(n),f.get_painter().update_scale_btn_position(),f.app.render()}},f.data=r,f.value.text=h,f.variable_name.text=l,p&&(f.prefix.text=p),f.background.addChild(f.value,f.variable_name,f.prefix,f.icon,f.scale_btn),f.addChild(f.background,f.scale_btn),f.set_resizable_part(f.background),f.scale_btn.addListener("mousemove",c.w(f.drag_move_scale_btn,c.a)).addListener("touchmove",c.w(f.drag_move_scale_btn,c.a)),f.add_listener("drag_end",f.on_position_change),f.add_resizable_event_listener("scale_btn_drag_end",f.on_scale_change),f.position.set(u.x,-u.y),d&&f.background.scale.set(d.x,d.y),f.set_theme(_),f.theme=_.theme,f}return Fe(e,t),e.prototype.get_painter=function(){if(!this.painter||this.painter.theme!==this.theme)switch(this.theme){case Ct.DEFAULT_WITH_ICON:this.icon.visible=!0,this.painter=new He(this.prefix,this.variable_name,this.value,this.background,this.scale_btn,this.icon);break;case Ct.ICON:this.prefix.visible=!1,this.variable_name.visible=!1,this.painter=new Ve(this.value,this.background,this.scale_btn,this.icon);break;case Ct.PLAIN_TEXT:this.prefix.visible=!1,this.variable_name.visible=!1,this.icon.visible=!1,this.painter=new Ue(this.value,this.background,this.scale_btn);break;default:this.icon.visible=!1,this.painter=new Be(this.prefix,this.variable_name,this.value,this.background,this.scale_btn)}return this.painter},e.prototype.set_theme=function(t){t.theme!==this.theme&&(this.theme=t.theme,t.theme!==Ct.DEFAULT_WITH_ICON&&t.theme!==Ct.ICON||this.set_icon_texture(t.icon_texture_id),this.get_painter().repaint())},e.prototype.get_theme=function(){return this.theme},e.prototype.set_icon_texture=function(t){var e=this.data.get_texture(t);e&&(this.icon.texture=e)},e.prototype.set_value=function(t){if(this.value.text!==t){var e=this.value.width;this.value.text=t,this.value.width!==e&&this.get_painter().repaint()}},e.prototype.set_scale_btn_visible=function(t){this.scale_btn.visible=t},e.prototype.get_value=function(){return this.value.text},e.prototype.set_variable_name=function(t){if(this.variable_name.text!==t){var e=this.variable_name.width;this.variable_name.text=t,this.variable_name.width!==e&&this.get_painter().repaint()}},e.prototype.get_variable_name=function(){return this.variable_name.text},e.prototype.set_prefix=function(t){if(this.prefix.text!==t){var e=this.prefix.width,i=this.prefix.visible;this.prefix.visible=!!t,this.prefix.text=t,this.prefix.visible===i&&this.prefix.width===e||this.get_painter().repaint()}},e.prototype.get_prefix=function(){return this.prefix.text},e.prototype.destroy=function(){var e={children:!0,texture:!0,baseTexture:!0};this.value.destroy(e),this.prefix.destroy(e),this.variable_name.destroy(e),t.prototype.destroy.call(this)},e.prototype.get_position=function(){return{x:this.position.x,y:-this.position.y}},e.prototype.set_position=function(t,e){this.position.set(t,-e)},e.prototype.set_scale=function(t){this.background.scale.set(t),this.get_painter().update_scale_btn_position()},e}(Te),Be=function(){function t(t,e,i,o,n){this.theme=Ct.DEFAULT;var r=Ie.PADDING,s=Ie.VALUE_MARGIN_TOP,a=Ie.VALUE_TEXT_STYLE;this.prefix=t,this.prefix.visible=!!this.prefix.text,this.variable_name=e,this.variable_name.visible=!0,this.value=i,this.value.style=a,this.background=o,this.scale_btn=n;var c=r+s;this.prefix.position.set(r,c),this.variable_name.position.y=c,this.value.position.y=c}return t.prototype.repaint=function(){this.update_variable_name_position(),this.update_value_position(),this.draw_background(),this.update_scale_btn_position()},t.prototype.draw_background=function(){var t=Ie.PADDING,e=Ie.VALUE_MARGIN,i=Ie.VALUE_MARGIN_TOP,o=Ie.BORDER_RADIUS,n=this.value.width+2*e,r=this.value.height+2*i,s=this.value.position.x+n,a=2*t+r;this.background.clear().beginFill(16756040).drawRoundedRect(0,0,s,a,o).beginFill(16777215).drawRoundedRect(this.value.position.x-e,this.value.position.y-i,n,r,o).endFill()},t.prototype.update_scale_btn_position=function(){var t=this.background.scale,e=t.x,i=t.y;if(0!==e&&0!==i){var o=Ie.SCALE_BTN_MARGIN;this.scale_btn.position.set(this.background.width-o*e,this.background.height-o*i)}},t.prototype.update_variable_name_position=function(){this.variable_name.position.x=this.prefix.visible?this.prefix.position.x+this.prefix.width:Ie.VARIABLE_NAME_MARGIN_LEFT},t.prototype.update_value_position=function(){var t=this.variable_name.position.x+this.variable_name.width;this.value.position.x=t+2*Ie.VALUE_MARGIN},t}(),He=function(t){function e(e,i,o,n,r,s){var a=t.call(this,e,i,o,n,r)||this;a.theme=Ct.DEFAULT_WITH_ICON,a.icon_area_width=0,a.icon=s;var c=Ie.PADDING,_=Ie.ICON_SIZE,h=Ie.ICON_MARGIN_LEFT,l=Ie.ICON_MARGIN_TOP,p=Ie.ICON_MARGIN_RIGHT;return a.icon.position.set(h,c+l),a.icon.width=_,a.icon.height=_,a.icon.visible=!0,a.icon_area_width=h+_+p,a}return Fe(e,t),e.prototype.repaint=function(){this.update_prefix_position(),this.update_variable_name_position(),this.update_value_position(),this.draw_background(),this.update_scale_btn_position()},e.prototype.update_prefix_position=function(){this.prefix.visible&&(this.prefix.position.x=this.icon_area_width+Ie.PADDING)},e.prototype.update_variable_name_position=function(){this.variable_name.position.x=this.prefix.visible?this.prefix.position.x+this.prefix.width:this.icon_area_width},e}(Be),Ve=function(){function t(t,e,i,o){this.theme=Ct.ICON;var n=Pe.VALUE_MARGIN,r=Pe.VALUE_TEXT_STYLE,s=Pe.ICON_SIZE;this.value=t,this.value.style=r,this.value.position.set(s+n,(s-this.value.height)/2),this.background=e,this.scale_btn=i,this.icon=o,this.icon.visible=!0,this.icon.width=s,this.icon.height=s}return t.prototype.repaint=function(){this.draw_background(),this.update_scale_btn_position()},t.prototype.draw_background=function(){var t=Pe.ICON_SIZE,e=t/2,i=t/4,o=e+t+this.value.width,n=i+t/2,r=t/4;this.background.clear().lineStyle(2,16777215).beginFill(0,.3).moveTo(e+r,i).arcTo(o,i,o,i+r,r).arcTo(o,n,e+r,n,r).arcTo(e,n,e,i+r,r).arcTo(e,i,e+r,i,r).endFill()},t.prototype.update_scale_btn_position=function(){var t=this.background.scale,e=t.x,i=t.y;if(0!==e&&0!==i){var o=Pe.SCALE_BTN_MARGIN_RIGHT,n=Pe.SCALE_BTN_MARGIN_BOTTOM;this.scale_btn.position.set(this.background.width-o*e,this.background.height-n*i)}},t}(),Ue=function(){function t(t,e,i){this.theme=Ct.PLAIN_TEXT,this.background=e,this.background.clear(),this.value=t,this.value.style=Me.TEXT_STYLE,this.value.position.set(0,0),this.scale_btn=i}return t.prototype.repaint=function(){this.update_scale_btn_position()},t.prototype.update_scale_btn_position=function(){var t=this.background.scale,e=t.x,i=t.y;if(0!==e&&0!==i){var o=Me.SCALE_BTN_MARGIN_RIGHT,n=Me.SCALE_BTN_MARGIN_BOTTOM;this.scale_btn.position.set(this.background.width-o*e,this.background.height-n*i)}},t}(),We=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Xe=function(t){function e(e,i,o){var n=t.call(this,"",i)||this;return n.content_string="",n.is_wrapped=!1,n.content_string=e.toString(),n.word_wrap_width=o,n.update_wrap(),n}return We(e,t),e.prototype.update_wrap=function(){if(this.text=this.content_string,void 0!==this.word_wrap_width)if(this.width<=this.word_wrap_width)this.is_wrapped=!1;else{this.text="...";var t=this.width,e="";this.text="";for(var i=0;i<this.content_string.length;i++){if(this.text+=this.content_string[i],this.width+t>this.word_wrap_width){this.is_wrapped=!0,this.text=e+"...";break}e=this.text}}else this.is_wrapped=!1},e.prototype.update_content=function(t){var e=t.text,i=t.wrap_width,o=!1;return void 0!==e&&e!==this.content_string&&(this.content_string=e.toString(),o=!0),void 0!==i&&i!==this.word_wrap_width&&(this.word_wrap_width=i,o=!0),o&&this.update_wrap(),o},e.prototype.get_is_wrapped=function(){return this.is_wrapped},e.prototype.get_full_text=function(){return this.content_string},e}(s.v),Ye=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Ke=function(){return(Ke=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},qe=function(t){function e(e){var i=e.bg_texture,o=e.width,n=e.value,r=e.order,a=e.order_width,c=t.call(this)||this;c.background_width=0,c.prev_order_width=0,c.prev_width=0,c.background=new s.t(i),c.background_width=o,c.background.width=o,c.order=new s.v(r,Ke(Ke({},Ge),{fill:"#0000007f"})),c.order_width=void 0!==a?a:c.order.width,c.value=new Xe(n,Ge,c.get_value_max_width(o));var _=(45-c.value.height)/2;return c.order.position.set(5,_),c.value.position.y=_,c.update_value_position(),c.addChild(c.background,c.order,c.value),c}return Ye(e,t),e.prototype.update_content=function(t){var e=t.order,i=t.value,o=t.order_width,n=t.width;void 0!==e&&(this.order.text=e.toString()),void 0!==o&&(this.order_width=o),void 0!==n&&(this.background_width=n),this.repaint(i)},e.prototype.repaint=function(t){var e=!1,i=!1;this.prev_width!==this.background_width&&(e=!0,i=!0),this.prev_order_width!==this.order_width&&(i=!0,this.update_value_position()),e&&(this.background.width=this.background_width),(i||void 0!==t)&&this.value.update_content({text:t,wrap_width:this.get_value_max_width(this.background_width)}),this.prev_width=this.background_width,this.prev_order_width=this.order_width},e.prototype.set_text_visible=function(t){this.value.visible=t,this.order.visible=t},e.prototype.get_value_max_width=function(t){return t-10-45-this.order_width},e.prototype.update_value_position=function(){this.value.position.x=20+this.order_width},e.prototype.get_text_visible=function(){return this.value.visible},e.prototype.destroy=function(){var e={children:!0,texture:!0,baseTexture:!0};this.background.destroy({children:!0}),this.order.destroy(e),this.value.destroy(e),t.prototype.destroy.call(this,e)},e}(s.f);function Je(t){return Se||(Se=new s.x(Ge)),s.w.measureText(t,Se)}var Qe=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Ze=function(){function t(t,e){this.body=t,this.scale_btn=e}return t.prototype.draw_body=function(t,e){var i;this.body.clear().beginFill(16777215).drawRoundedRect(0,0,t,e,10).endFill(),this.body.mask instanceof s.j?i=this.body.mask:((i=new s.j).setParent(this.body),this.body.mask=i),i.clear().beginFill(16777215).drawRoundedRect(0,0,t,e,10).endFill()},t}(),$e=function(t){function e(e,i,o){var n=t.call(this,e,i)||this;return n.type=xe.BLANK,n.blank_text=o,n}return Qe(e,t),e.prototype.repaint=function(t,e,i,o){(i||o)&&this.draw_body(t,e),i&&this.update_blank_text_position(t)},e.prototype.update_blank_text_position=function(t){this.blank_text.position.x=t/2},e.prototype.calculate_body_size=function(t,e){return{width:Le+t,height:Re+e}},e.prototype.mount=function(){this.blank_text.visible=!0},e.prototype.dismount=function(){this.blank_text.visible=!1},e.init_blank_text=function(){var t=new s.v("空",Ne);return t.anchor.set(.5,0),t.position.y=10,t},e}(Ze),ti=function(t){function e(e,i,o,n,r,a,c){var _=t.call(this,i,o)||this;return _.type=xe.NON_BLANK,_.available_item_num=0,_.value_idx=0,_.latest_order_width=0,_.value_length=0,_.scrollbar=new s.j,_.scroll_range=0,_.scroll_step=0,_.on_scrollbar_drag_start=function(t){_.available_item_num>=_.value_length||(t.stopPropagation(),_.scrollbar_drag_y=t.data.getLocalPosition(_.body).y)},_.on_scrollbar_drag_move=function(t){if(void 0!==_.scrollbar_drag_y){t.stopPropagation();var e=t.data.getLocalPosition(_.body).y,i=e-_.scrollbar_drag_y;_.scrollbar_drag_y=e;var o=ct.a(0,_.scroll_range,_.scrollbar.position.y+i);_.scrollbar.position.y=o;var n=ct.a(0,_.value_length-1,Math.round(o/_.scroll_step));_.value_idx!==n&&(_.value_idx=n,_.update_item_values(_.get_values()),_.render())}},_.on_scrollbar_drag_end=function(t){void 0!==_.scrollbar_drag_y&&(t.stopPropagation(),_.scrollbar_drag_y=void 0)},_.on_body_drag_start=function(t){_.available_item_num>=_.value_length||(t.stopPropagation(),_.body_drag_y=t.data.getLocalPosition(_.body).y)},_.on_body_drag_move=function(t){if(void 0!==_.body_drag_y){t.stopPropagation();var e=t.data.getLocalPosition(_.body).y,i=e-_.body_drag_y,o=i>0?Math.floor(i/45):Math.ceil(i/45);if(!(Math.abs(o)<=0)){var n=ct.a(0,_.value_length-1,_.value_idx-o);_.value_idx!==n&&(_.body_drag_y=e,_.value_idx=n,_.scrollbar.position.y=ct.a(0,_.scroll_range,_.value_idx*_.scroll_step),_.update_item_values(_.get_values()),_.render())}}},_.on_body_drag_end=function(t){void 0!==_.body_drag_y&&(t.stopPropagation(),_.body_drag_y=void 0)},_.app=e,_.items_container=n,_.data=r,_.get_values=a,_.render=c,_.draw_scrollbar(),_.body.addChild(_.scrollbar),_.body.interactive=!0,_.body.addListener("mousedown",_.on_body_drag_start).addListener("touchstart",_.on_body_drag_start).addListener("mousemove",_.on_body_drag_move).addListener("touchmove",_.on_body_drag_move).addListener("mouseup",_.on_body_drag_end).addListener("touchend",_.on_body_drag_end).addListener("mouseupoutside",_.on_body_drag_end).addListener("touchendoutside",_.on_body_drag_end),_.scrollbar.interactive=!0,_.scrollbar.addListener("mousedown",_.on_scrollbar_drag_start).addListener("touchstart",_.on_scrollbar_drag_start).addListener("mousemove",_.on_scrollbar_drag_move).addListener("touchmove",_.on_scrollbar_drag_move).addListener("mouseup",_.on_scrollbar_drag_end).addListener("touchend",_.on_scrollbar_drag_end).addListener("mouseupoutside",_.on_scrollbar_drag_end).addListener("touchendoutside",_.on_scrollbar_drag_end),_}return Qe(e,t),e.prototype.repaint=function(t,e,i,o,n){if((i||o)&&this.draw_body(t,e),i&&(this.update_cur_items_width(t),this.update_scrollbar_position_x(t)),o){this.scroll_range=e-112-38;var r=this.scroll_range/(this.value_length-this.available_item_num);this.scroll_step=Number.isNaN(r)?0:Math.max(0,r),this.paint_items(t,n||this.get_values())}},e.prototype.calculate_body_size=function(t,e){return this.available_item_num=4+Math.floor(e/45),{width:170+t,height:45*this.available_item_num}},e.prototype.generate_item_texture=function(t){var e=this.data.get_texture(t);if(e)return e;var i=t===Ee.LIGHT?16777215:16053751,o=new s.j;o.beginFill(i).drawRect(0,0,Le,45).endFill();var n=this.app.get_app().renderer.generateTexture(o,s.s.LINEAR,1);return s.y.addToCache(n,t),n},e.prototype.update_cur_items_width=function(t){var e=this;this.items_container.children.forEach(function(i){e.is_item(i)&&i.update_content({width:t})})},e.prototype.update_cur_items_order_width=function(t){var e=this;this.latest_order_width!==t&&(this.latest_order_width=t,this.items_container.children.forEach(function(t){e.is_item(t)&&t.update_content({order_width:e.latest_order_width})}))},e.prototype.update_item_values=function(t){var e=this,i=t.length,o=this.items_container.children.length,n=i-this.value_idx;this.value_length=t.length,this.scroll_step=this.scroll_range/(this.value_length-this.available_item_num),n<o&&(this.value_idx=Math.max(0,i-o));var r=Math.min(this.value_idx+o,i);this.latest_order_width=Je(r.toString()).width,this.items_container.children.forEach(function(i,o){if(e.is_item(i)){var n=t[e.value_idx+o],r=e.value_idx+o+1;i.update_content({order:r,value:n,order_width:e.latest_order_width}),i.set_text_visible(void 0!==n)}}),this.update_scrollbar_visible()},e.prototype.paint_items=function(t,e){var i,o=this,n=this.items_container.children,r=n.length,s=this.available_item_num-r;if(0!==s){if(s>0){var a=this.value_length-this.value_idx-this.available_item_num;if(0!==this.value_idx&&a<0){this.value_idx=Math.max(0,this.value_idx+a);var c=e.slice(this.value_idx,this.value_idx+r);n.forEach(function(t,e){o.is_item(t)&&t.update_content({order:o.value_idx+e+1,value:c[e]})})}for(var _=this.value_idx+r,h=this.value_idx+this.available_item_num,l=e.slice(_,h),p=_;p<h;p++){var u=l[p-_],d=this.create_item(p,t,u);d.position.y=45*(p-this.value_idx),this.items_container.addChild(d),void 0!==u&&(i=p+1)}}if(s<0){var f=this.items_container.removeChildren(this.available_item_num,r),g=this.value_idx+r;f.forEach(function(t,e){o.is_item(t)&&t.get_text_visible()&&(i=g-e-1),t.destroy()})}void 0!==i&&this.update_cur_items_order_width(Je(i.toString()).width),this.update_scrollbar_visible(),this.scrollbar.visible&&(this.scrollbar.position.y=this.value_idx*this.scroll_step)}},e.prototype.is_item=function(t){return!!t&&t instanceof qe},e.prototype.mount=function(){this.items_container.visible=!0},e.prototype.dismount=function(){this.items_container.visible=!1,this.scrollbar.visible=!1},e.prototype.create_item=function(t,e,i){var o=t%2?Ee.DEEP:Ee.LIGHT,n=void 0===i?"":i,r=new qe({bg_texture:this.generate_item_texture(o),width:e,value:n,order:(t+1).toString(),order_width:this.latest_order_width});return r.set_text_visible(void 0!==i),r},e.destroy_background_texture=function(t){[t.get_texture(Ee.LIGHT),t.get_texture(Ee.DEEP)].forEach(function(t){t&&t.destroy(!0)})},e.prototype.update_scrollbar_visible=function(){this.scrollbar.visible=this.value_idx>0||this.value_length>this.available_item_num},e.prototype.update_scrollbar_position_x=function(t){this.scrollbar.position.x=t-10},e.prototype.draw_scrollbar=function(){this.scrollbar.beginFill(10727103,.3).drawRoundedRect(0,10,5,112,2.5).endFill()},e}(Ze),ei=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ii=function(){return(ii=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},oi=function(t){function e(e){var i=e.title,o=e.prefix,n=e.text_max_width,r=e.icon_texture,s=t.call(this)||this;return s.text_offset_x=0,s.text_max_width=n,s.title=new Xe(i,ii(ii({},De),{fill:"#FFFFFF"}),s.text_max_width),s.addChild(s.title),r&&s.set_icon_texture(r),o?s.set_prefix(o):s.wrap_prefix_and_title(),s}return ei(e,t),e.prototype.set_title=function(t){return!!this.title.update_content({text:t})&&(this.wrap_prefix_and_title(),!0)},e.prototype.set_prefix=function(t){return this.prefix?!!this.prefix.update_content({text:t})&&(this.wrap_prefix_and_title(),!0):(this.prefix=new Xe(t,ii(ii({},De),{fill:"#523939"}),this.text_max_width),this.prefix.position.x=this.text_offset_x,this.addChild(this.prefix),this.wrap_prefix_and_title(),!0)},e.prototype.set_text_max_width=function(t){this.text_max_width+this.text_offset_x!==t&&(this.text_max_width=t-this.text_offset_x,this.wrap_prefix_and_title())},e.prototype.wrap_prefix_and_title=function(){var t=this.text_max_width,e=this.text_offset_x;this.prefix&&(this.prefix.get_full_text()?(this.prefix.update_content({wrap_width:t}),e=this.prefix.position.x+this.prefix.width,t=this.prefix.get_is_wrapped()?0:this.text_max_width-e,this.prefix.visible=!0):this.prefix.visible=!1),0!==t?(this.title.update_content({wrap_width:t}),this.title.position.x=e,this.title.visible=!0):this.title.visible=!1},e.prototype.destroy=function(){var e,i={children:!0,texture:!0,baseTexture:!0};this.title.destroy(i),null!==(e=this.prefix)&&void 0!==e&&e.destroy(i),t.prototype.destroy.call(this,{children:!0})},e.prototype.set_icon_texture=function(t){return this.icon?(this.icon.texture=t,!1):(this.icon=new s.t(t),this.icon.width=20,this.icon.height=20,this.icon.position.set(-2,5),this.addChild(this.icon),this.text_offset_x=25,!0)},e}(s.f),ni=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ri=function(t){function e(e,i,o,n,r,a){var _,h=t.call(this,e,i,o,n)||this;return h.type=It.LIST,h.background=new s.j,h.body=new s.j,h.items_container=new s.f,h.blank_text=$e.init_blank_text(),h.bg_color=16756040,h.body_size={width:Le,height:Re},h.prev_size={width:0,height:0},h.offset={x:0,y:0},h.status=xe.BLANK,h.on_position_change=function(){h.events.fire("list:drag_end",{target_id:h.id,data:{position:h.get_position()}})},h.on_offset_change=function(){h.events.fire("list_scale_btn:drag_end",{target_id:h.id,data:{offset:h.offset}})},h.drag_move_scale_btn=function(t){if(h.is_resizing){var e=t.data.getLocalPosition(h),i=e.x,o=e.y;h.offset.x=Math.max(0,i-163),h.offset.y=Math.max(0,o-215),h.body_size=h.get_current_painter().calculate_body_size(h.offset.x,h.offset.y),h.repaint(),h.app.render()}},h.data=r,h.get_values=a.get_values,a.title_icon_texture_id&&(_=h.data.get_texture(a.title_icon_texture_id)),h.header=new oi({title:a.title,text_max_width:138,prefix:a.prefix,icon_texture:_}),h.header.position.y=12,h.body.addChild(h.items_container,h.blank_text),h.body.position.set(8,58),h.addChild(h.background,h.body,h.header,h.scale_btn),a.export_icon_texture_id&&h.set_export_icon(a.export_icon_texture_id),h.blank_painter=new $e(h.body,h.scale_btn,h.blank_text),h.non_blank_painter=new ti(h.app,h.body,h.scale_btn,h.items_container,h.data,h.get_values,function(){return h.app.render()}),a.position&&h.position.set(a.position.x,-a.position.y),a.bg_color&&(h.bg_color=a.bg_color),a.offset&&(h.offset=a.offset),h.body_size=h.get_current_painter().calculate_body_size(h.offset.x,h.offset.y),h.setParent(h.parent),h.set_resizable_part(h.background),h.scale_btn.addListener("mousemove",c.w(h.drag_move_scale_btn,50)).addListener("touchmove",c.w(h.drag_move_scale_btn,50)),h.add_listener("drag_end",h.on_position_change),h.add_resizable_event_listener("scale_btn_drag_end",h.on_offset_change),h.update_values(),h.status===xe.BLANK&&h.repaint(),h}return ni(e,t),e.prototype.set_title=function(t){this.header.set_title(t)&&this.update_header_style()},e.prototype.set_title_prefix=function(t){this.header.set_prefix(t)&&this.update_header_style()},e.prototype.set_title_icon=function(t){var e=this.data.get_texture(t);e&&this.header.set_icon_texture(e)&&this.update_header_style()},e.prototype.update_values=function(t){var e=t||this.get_values(),i=e.length?xe.NON_BLANK:xe.BLANK;if(this.status!==i){if(this.status=i,this.prev_size={width:0,height:0},this.status===xe.BLANK)this.blank_painter.mount(),this.non_blank_painter.dismount();else{this.blank_painter.dismount(),this.non_blank_painter.mount();var o=this.body_size,n=o.width,r=o.height;this.body_size=this.non_blank_painter.calculate_body_size(n-Le,r-Re),this.non_blank_painter.update_item_values(e)}this.repaint(t)}else{if(this.status===xe.BLANK)return;this.non_blank_painter.update_item_values(e)}},e.prototype.set_blank_text=function(t){if(this.blank_text.text!==t){var e=this.blank_text.width;this.blank_text.text=t,this.status===xe.BLANK&&this.blank_text.width!==e&&this.blank_painter.update_blank_text_position(this.body_size.width)}},e.prototype.set_bg_color=function(t){this.bg_color=t,this.draw_background()},e.prototype.set_export_icon=function(t){var e=this,i=this.data.get_texture(t);if(i)return this.export_icon?void(this.export_icon.texture=i):(this.export_icon=new s.t(i),this.export_icon.width=24,this.export_icon.height=24,this.export_icon.position.set(this.body_size.width-14,12),this.export_icon.interactive=!0,this.export_icon.buttonMode=!0,this.addChild(this.export_icon),this.export_icon.addListener("mouseup",function(){e.events.fire("list_export_icon:selected",{target_id:e.id})}),void this.export_icon.addListener("touchend",function(){e.events.fire("list_export_icon:selected",{target_id:e.id})}))},e.prototype.set_export_icon_visible=function(t){this.export_icon&&(this.export_icon.visible=t)},e.prototype.destroy=function(){this.blank_text.destroy({children:!0,texture:!0,baseTexture:!0}),t.prototype.destroy.call(this)},e.prototype.get_position=function(){return{x:this.position.x,y:-this.position.y}},e.prototype.set_position=function(t,e){this.position.set(t,-e)},e.prototype.set_offset=function(t){this.offset=t,this.body_size=this.get_current_painter().calculate_body_size(this.offset.x,this.offset.y),this.repaint()},e.prototype.repaint=function(t){var e=this.body_size,i=e.width,o=e.height,n=this.prev_size.width!==i,r=this.prev_size.height!==o;(n||r)&&(this.draw_background(),this.update_scale_btn_position()),n&&(this.update_header_style(),this.update_export_icon_position()),this.get_current_painter().repaint(i,o,n,r,t),this.prev_size={width:i,height:o}},e.prototype.draw_background=function(){this.background.clear().beginFill(this.bg_color).lineStyle(2,13421772).drawRoundedRect(0,0,this.body_size.width+16,this.body_size.height+16+50,20).endFill()},e.prototype.get_current_painter=function(){switch(this.status){case xe.BLANK:return this.blank_painter;case xe.NON_BLANK:return this.non_blank_painter}},e.prototype.update_scale_btn_position=function(){this.offset.x=this.body_size.width-Le,this.offset.y=this.body_size.height-Re,this.scale_btn.position.set(163+this.offset.x,215+this.offset.y)},e.prototype.update_header_style=function(){this.header.set_text_max_width(this.body_size.width-32),this.header.position.x=(this.body_size.width+16-this.header.width)/2},e.prototype.update_export_icon_position=function(){this.export_icon&&(this.export_icon.position.x=this.body_size.width-14)},e}(Te),si=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ai=function(t){function e(e,i,o){var n=t.call(this)||this;return n.set_parent=function(t){n.setParent(t)},n.app=e,n.events=i,n.data=o,n.timer_container=new s.f,n.data_widget_container=new s.f,n.variables=new Map,n.lists=new Map,n.addChild(n.data_widget_container,n.timer_container),n}return si(e,t),e.prototype.get_timer=function(){return this.timer||(this.timer=new Ae(this.timer_container,this.app,this.events)),this.timer},e.prototype.remove_timer=function(){this.timer&&(this.timer.destroy(),this.timer=void 0)},e.prototype.set_visible=function(t){this.visible=t},e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0,texture:!0}),ti.destroy_background_texture(this.data)},e.prototype.load_variable=function(t,e){var i=this.get_variable(t);return i||(i=new ze(t,this.data_widget_container,this.app,this.events,this.data,e),this.variables.set(t,i),i)},e.prototype.get_variable=function(t){var e=this.variables.get(t);if(e)return e;var i=this.get_data_widget_child(t,It.VARIABLE);return i?(this.variables.set(t,i),i):void 0},e.prototype.destroy_variable=function(t){var e=this.get_variable(t);if(!e)return new _.a("Cannot find variable "+t+".");e.destroy(),this.variables.delete(t)},e.prototype.is_variable=function(t){return!!t&&t.type===It.VARIABLE},e.prototype.is_list=function(t){return!!t&&t.type===It.LIST},e.prototype.set_all_widgets_draggable=function(t){var e=this;this.data_widget_container.children.forEach(function(i){(e.is_variable(i)||e.is_list(i))&&i.set_draggable(t)})},e.prototype.destroy_all_widgets=function(){var t=this;this.data_widget_container.removeChildren().forEach(function(e,i){(t.is_variable(e)||t.is_list(e))&&e.destroy()}),this.variables.clear(),this.lists.clear()},e.prototype.set_z_index=function(t){var e=this.parent;t=Math.min(t,e.children.length-1),t=Math.max(1,t),e.setChildIndex(this,t)},e.prototype.load_list=function(t,e){var i=this.get_list(t);return i?(new _.a("List "+t+" already exists."),i):(i=new ri(t,this.data_widget_container,this.app,this.events,this.data,e),this.lists.set(t,i),i)},e.prototype.get_list=function(t){var e=this.lists.get(t);if(e)return e;var i=this.get_data_widget_child(t,It.LIST);return i?(this.lists.set(t,i),i):void 0},e.prototype.destroy_list=function(t){var e=this.lists.get(t);if(!e)return new _.a("Cannot find list "+t+".");e.destroy(),this.lists.delete(t)},e.prototype.get_data_widget_child=function(t,e){var i,o,n=e===It.VARIABLE?this.is_variable:this.is_list;try{for(var r=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(this.data_widget_container.children),s=r.next();!s.done;s=r.next()){var a=s.value;if(a.name===t&&n(a))return a}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}},e.prototype.get_latest_data_widget=function(){var t=this.data_widget_container.children,e=t[t.length-1];if(this.is_list(e)||this.is_variable(e))return e},e}(s.f),ci=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),_i=function(t){function e(){var e=t.call(this)||this;return e.start_pos=0,e.max_size=0,e.scroll_bar_width=0,e.is_dragging=!1,e.scrollbar_y=0,e.SCROLL_BAR_MARGIN=6,e.scroll_drag_start=function(t){t.stopPropagation(),e.is_dragging=!0,e.scrollbar_y=t.data.getLocalPosition(e).y},e.scroll_drag_move=function(t){if(e.text_area&&e.is_dragging){t.stopPropagation();var i=t.data.getLocalPosition(e).y,o=i-e.scrollbar_y;e.scrollbar_y=i;var n=e.scrollbar_btn.position.y+o,r=e.max_size*(1-e.max_size/e.text_area.height);n=ct.a(0,r,n),e.scrollbar_btn.position.y=n,e.text_area.position.y=-e.scrollbar_btn.y/(e.height-e.scrollbar_btn.height)*(e.text_area.height-e.max_size)+e.start_pos}},e.scroll_drag_end=function(){e.is_dragging=!1},e.name="scrollbar",e.scrollbar_btn=new s.j,e.scrollbar_btn.on("mousedown",e.scroll_drag_start).on("mousemove",e.scroll_drag_move).on("mouseup",e.scroll_drag_end).on("mouseupoutside",e.scroll_drag_end).on("touchstart",e.scroll_drag_start).on("touchmove",e.scroll_drag_move).on("touchendoutside",e.scroll_drag_end).on("touchend",e.scroll_drag_end),e.addChild(e.scrollbar_btn),e}return ci(e,t),e.prototype.draw_scroll_bar=function(t,e,i,o){this.start_pos=e,this.text_area=t,this.max_size=i,this.scroll_bar_width=o,this.is_dragging=!1,this.draw_scroll_area(),this.draw_scroll_btn(),t.parent.addChild(this)},e.prototype.draw_scroll_area=function(){this.text_area&&(this.clear(),this.beginFill(14737632,1),this.drawRoundedRect(this.text_area.position.x+this.text_area.width+this.SCROLL_BAR_MARGIN,this.text_area.position.y,this.scroll_bar_width,this.max_size,this.scroll_bar_width/2))},e.prototype.draw_scroll_btn=function(){if(this.text_area){this.scrollbar_btn.interactive=!0;var t=this.max_size/this.text_area.height*this.max_size;this.clear(),this.scrollbar_btn.beginFill(13487565,1),this.scrollbar_btn.drawRoundedRect(this.text_area.position.x+this.text_area.width+this.SCROLL_BAR_MARGIN,this.text_area.position.y,this.scroll_bar_width,t,this.scroll_bar_width/2),this.scrollbar_btn.endFill()}},e}(s.j),hi={fontSize:"20px",fontFamily:["PingFangSC-Regular","Microsoft YaHei"],fill:"#808080"},li={fontSize:"28px",fontFamily:["PingFangSC-Regular","Microsoft YaHei"],wordWrap:!0,breakWords:!0,fill:"#000000"};!function(t){t[t.origin=0]="origin",t[t.translation=1]="translation"}(je||(je={}));var pi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ui=function(t){function e(e,i,o,n){var r=t.call(this)||this;r.is_play=!1,r.TEXT_PADDING=10,r.TEXT_TITLE_PADDING=15,r.DIALOG_MARGIN=12,r.DIALOG_PADDING=20,r.BACKGROUND_PADDING=5,r.BACKGROUND_RADIUS=10,r.TITLE_TEXT_MARGIN=10,r.FROM_TO_MARGIN=130,r.SCROLLBAR_WIDTH=12,r.PLAY_ICON_MARGIN=12,r.STATIC_HEIGHT=2*(r.DIALOG_MARGIN+r.DIALOG_PADDING)+r.FROM_TO_MARGIN,r.close_dialog=function(){r.on_complete_cb&&r.on_complete_cb(),r.hide()},r.play_translation=function(){r.events.fire("translate_dialog_btn:click",{text:r.translation_text.text,is_play:r.is_play}),r.set_play_state(!r.is_play)},r.set_parent=function(t){r.setParent(t)},r.app=e,r.loader=i,r.events=o,r.origin_title=new s.v("",hi),r.origin_title.x=r.DIALOG_PADDING,r.origin_text=new s.v("",li),r.origin_text.x=r.DIALOG_PADDING,r.origin_title_background=new s.j,r.separate_line=new s.j,r.translation_title=new s.v("",hi),r.translation_title.x=r.DIALOG_PADDING,r.translation_text=new s.v("",li),r.translation_text.x=r.DIALOG_PADDING,r.translation_title_background=new s.j,r.translation_text_mask=new s.j,r.translation_text_mask.name="text_mask",r.scrollbar=new _i,r.close_icon=new s.t,r.close_icon.scale.set(.17),r.close_icon.interactive=!0,r.close_icon.buttonMode=!0,r.close_icon.alpha=.5,r.close_icon.on("mouseup",r.close_dialog),r.close_icon.on("touchend",r.close_dialog),r.play_idle_icon=new s.t,r.play_idle_icon.scale.set(.15),r.playing_icon=new s.t,r.playing_icon.scale.set(.15),r.set_play_state(!1),r.play_container=new s.f,r.play_container.addChild(r.play_idle_icon,r.playing_icon),r.play_container.interactive=!0,r.play_container.buttonMode=!0,r.play_container.on("mousedown",r.play_translation),r.play_container.on("touchstart",r.play_translation),r.app.get_renderer_type()===s.p.WEBGL&&(r.filters=[new s.h({rotation:45,distance:3,alpha:.15,color:0,blur:0})]),r.loader.add({url:n.url,on_success:function(t){var e=t.textures;e&&(r.close_icon.texture=e[n.texture_name.close_icon],r.playing_icon.texture=e[n.texture_name.playing_icon],r.play_idle_icon.texture=e[n.texture_name.play_idle_icon],r.app.render())}}),r.addChild(r.origin_title_background,r.origin_title,r.origin_text,r.separate_line,r.translation_title_background,r.translation_title,r.translation_text,r.close_icon,r.play_container),r.visible=!1,r.interactive=!0;var a=function(t){t.stopPropagation()};return r.on("mouseup",a),r.on("mousedown",a),r.on("touchstart",a),r.on("touchend",a),r}return pi(e,t),e.prototype.draw_background=function(t,e){var i=this.app.get_app().view,o=i.width,n=i.height;this.clear(),this.lineStyle(2,14276302,1),this.beginFill(16777215,1),this.drawRoundedRect(0,0,t,e,this.BACKGROUND_RADIUS),this.position.y=n/2-e-this.DIALOG_MARGIN,this.position.x=-o/2+this.DIALOG_MARGIN,this.endFill()},e.prototype.hide_scrollbar=function(){this.removeChild(this.scrollbar),this.removeChild(this.translation_text_mask)},e.prototype.draw_content=function(t,e,i,o,n){var r=this.get_object_by_type(t),s=r.content_title,a=r.content_text,c=r.title_background,_=this.app.get_app().view.height,h=n-2*(this.DIALOG_PADDING+this.TEXT_PADDING);s.text=e,s.position.y=o,c.clear(),c.beginFill(14869218).drawRoundedRect(s.position.x-this.BACKGROUND_PADDING,s.position.y-this.BACKGROUND_PADDING,s.width+2*this.BACKGROUND_PADDING,s.height+2*this.BACKGROUND_PADDING,1.6).endFill();var l=s.height+this.TITLE_TEXT_MARGIN,p=(_-this.STATIC_HEIGHT)/2-l;a.position.y=o+l,a.text=i,a.style.wordWrapWidth=h;var u=Math.min(a.height,p);return a.height>p&&t===je.translation&&this.draw_scroll_box(u,h),l+u},e.prototype.draw_separate_line=function(t,e){this.separate_line.clear(),this.separate_line.lineStyle(2,0,.1).moveTo(0,t).lineTo(e,t).endFill()},e.prototype.set_icon_position=function(t){var e=this.close_icon,i=this.play_container,o=this.translation_title,n=t-e.width-this.DIALOG_PADDING,r=this.DIALOG_PADDING;e.position.x=n,e.position.y=r;var s=o.position.x+o.width+this.PLAY_ICON_MARGIN,a=o.position.y+(o.height-this.play_container.height)/2;i.position.x=s,i.position.y=a},e.prototype.draw_scroll_box=function(t,e){this.translation_text.style.wordWrapWidth=e-this.SCROLLBAR_WIDTH,this.addChild(this.translation_text_mask),this.clear(),this.translation_text_mask.beginFill(10026905,1),this.translation_text_mask.drawRect(this.translation_text.position.x,this.translation_text.position.y,e-this.SCROLLBAR_WIDTH,t),this.translation_text_mask.endFill(),this.translation_text.mask=this.translation_text_mask,this.scrollbar.draw_scroll_bar(this.translation_text,this.translation_text.position.y,this.translation_text_mask.height,this.SCROLLBAR_WIDTH)},e.prototype.get_object_by_type=function(t){return t===je.origin?{content_title:this.origin_title,content_text:this.origin_text,title_background:this.origin_title_background}:{content_title:this.translation_title,content_text:this.translation_text,title_background:this.translation_title_background}},e.prototype.show=function(t,e,i,o){this.hide_scrollbar(),this.on_complete_cb=o,this.visible=!0;var n=this.app.get_app().view.width-2*this.DIALOG_MARGIN,r=t.src,s=t.dst,a=this.draw_content(je.origin,e,r,this.TEXT_TITLE_PADDING,n),c=a+this.DIALOG_PADDING+this.FROM_TO_MARGIN/2;this.draw_separate_line(c,n);var _=this.draw_content(je.translation,i,s,c+this.DIALOG_PADDING,n),h=2*this.DIALOG_PADDING+a+this.FROM_TO_MARGIN+_;this.draw_background(n,h),this.set_icon_position(n)},e.prototype.set_play_state=function(t){this.is_play=t,this.playing_icon.visible=t,this.play_idle_icon.visible=!t},e.prototype.set_play_icon_visible=function(t){this.play_container.visible=t},e.prototype.hide=function(){this.visible=!1,this.set_play_state(!1)},e.prototype.destroy=function(){this.origin_title.destroy({texture:!0}),this.origin_text.destroy({texture:!0}),this.translation_title.destroy({texture:!0}),this.translation_text.destroy({texture:!0}),t.prototype.destroy.call(this,{children:!0})},e}(s.j);const di=i(35963);var fi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),gi=function(t){function e(e,i){var o=t.call(this)||this;return o.app=e,o.on_destroy=i,o.video=document.createElement("video"),o.canvas=document.createElement("canvas"),o.camera_status=Et.d.TURN_OFF,o.set_parent=function(t){o.setParent(t)},o.anchor.set(.5),o.texture=s.y.from(o.video),o.visible=!1,o}return fi(e,t),e.prototype.turn_on=function(t){var e=this;return this.camera_status===Et.d.IS_TURNED_ON?Promise.resolve():this.camera_status===Et.d.TURNING_ON&&this.turning_on_lock?this.turning_on_lock:(this.camera_status=Et.d.TURNING_ON,this.turning_on_lock=new Promise(function(i,o){navigator.mediaDevices.getUserMedia(t).then(function(t){if(e.camera_status!==Et.d.TURN_OFF){e.stream=t;try{e.video.srcObject=t}catch(i){e.video.src=window.URL.createObjectURL(t)}e.video.onloadedmetadata=function(t){e.camera_status!==Et.d.TURN_OFF?(e.adjust_stage_scale(),e.camera_status=Et.d.IS_TURNED_ON,e.turning_on_lock=void 0,e.visible=!0,e.video.play(),i()):i()}}else i()}).catch(o)}))},e.prototype.adjust_stage_scale=function(){var t=this.app.get_app().view,e=t.width,i=t.height,o=this.video,n=o.videoWidth,r=o.videoHeight;if(0!==n&&0!==r){var s=Math.max(i/r,e/n);this.scale.set(-s,s)}},e.prototype.turn_off=function(){var t;this.camera_status!==Et.d.TURN_OFF&&(this.camera_status=Et.d.TURN_OFF,null!==(t=this.stream)&&void 0!==t&&t.getVideoTracks().forEach(function(t){return t.stop()}),this.stream=void 0,this.turning_on_lock=void 0,this.visible=!1)},e.prototype.get_image_data=function(t){var e=this.canvas.getContext("2d");if(this.camera_status===Et.d.IS_TURNED_ON&&e)return t?(this.canvas.width=t.width,this.canvas.height=t.height):(this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight),e.resetTransform(),e.scale(-1,1),e.translate(-1*this.canvas.width,0),e.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,0,0,this.canvas.width,this.canvas.height),e.getImageData(0,0,this.canvas.width,this.canvas.height)},e.prototype.set_alpha=function(t){this.alpha=t},e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0,texture:!0,baseTexture:!0}),this.on_destroy()},e}(s.t);const yi=i(89088);var vi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),bi=new s.x({fontFamily:["sans-serif","Microsoft YaHei"],fontSize:"24px",fill:"#ffffff"}),mi=function(t){function e(e,i,o){var n=t.call(this)||this;return n.is_cached=!1,n.loader_animation=function(t){n.loading_icon.rotation-=.1*t},n.app=e,n.loader=i,n.url=o,n.loading_icon=new s.t,n.name_text=new s.v(""),n}return vi(e,t),e.prototype.load_texture=function(){var t=this;this.loader.add({url:this.url,on_success:function(e){var i=e.textures;i&&(t.loading_icon.texture=i["wood_banner_loading.png"])},on_error:function(t){return console.error("wood texture load fail",t)}})},e.prototype.draw=function(){this.clear();var t=this.app.get_app().view,e=t.width,i=t.height;this.name_text.visible=!0,this.loading_icon.visible=!0,this.name_text.style=bi,this.name_text.anchor.set(0,.5),this.loading_icon.anchor.set(.5);var o=e;this.loading_icon.x=60-o/2,this.loading_icon.y=40-i/2,this.name_text.x=100-o/2,this.name_text.y=40-i/2,this.beginFill(0,.8),this.drawRect(-o/2,-i/2,o,80),this.endFill()},e.prototype.show=function(t){t&&(this.name_text.text=t),this.is_cached||(this.load_texture(),this.addChild(this.name_text,this.loading_icon),this.draw(),this.interactive=!0,this.setParent(this.app.get_app().stage),this.is_cached=!0),this.visible=!0,this.app.get_app().ticker.add(this.loader_animation)},e.prototype.hide=function(){this.name_text.text="",this.visible=!1,this.app.get_app().ticker.remove(this.loader_animation)},e.prototype.destroy=function(){this.app.get_app().ticker.remove(this.loader_animation),t.prototype.destroy.call(this,{children:!0,texture:!0})},e}(s.j),xi=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),wi=function(t){function e(e,i){var o=t.call(this)||this;o.LINE_WIDTH=1.5,o.LINE_COLOR=16777215,o.LINE_ALPHA=1,o.draw_border_box=function(t){o.update_transform(t),o.clear(),o.lineStyle(o.LINE_WIDTH,o.LINE_COLOR,o.LINE_ALPHA),o.drawRect(-t.width/2,-t.height/2,t.width,t.height),o.endFill()},o.on_target_change=function(t){o.target&&c.l(o.target)&&(void 0!==t.visible&&(o.visible=t.visible),t.scale||t.texture?o.draw_border_box(o.target):(t.position||t.pivot||t.rotation)&&o.update_transform(o.target))},o.on_target_destroy=function(){o.hide()},o.set_parent=function(t){o.setParent(t)},o.app=e,o.data=i;var n=new s.h({rotation:0,distance:0,alpha:.3,color:2171686,blur:.5});return o.filters=[n],o.visible=!1,o}return xi(e,t),e.prototype.set_target_actor=function(t){var e=this.data.get_internal_actor(t);if(!e)return new _.a("Cannot find actor "+t);this.target!==e&&(this.target=e,this.visible=this.target.get_visible(),this.draw_border_box(this.target),this.target.add_listener("change",this.on_target_change),this.target.add_listener("destroy",this.on_target_destroy),this.app.render())},e.prototype.get_target_actor=function(){var t;return null===(t=this.target)||void 0===t?void 0:t.id},e.prototype.destroy=function(){c.l(this.target)&&this.target.remove_listener("destroy",this.on_target_destroy),t.prototype.destroy.call(this,!0)},e.prototype.update_transform=function(t){this.position.set(t.position.x,t.position.y),this.pivot.set(t.pivot.x*t.scale.x,t.pivot.y*t.scale.y),this.rotation=t.rotation},e.prototype.hide=function(){this.target&&(this.target.removeListener("change",this.on_target_change),this.target.removeListener("destroy",this.on_target_destroy),this.target=void 0,this.visible=!1,this.app.render())},e}(s.j),Ti=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),ki=function(t){function e(e,i,o){var n=t.call(this)||this;return n.cache=new Map,n.set_parent=function(t){n.setParent(t)},n.theme=e,n.app=i,n.data=o,n}return Ti(e,t),e.prototype.load_actor_box=function(t){var e=this.data.get_internal_actor(t);if(e)return this.load_box(e)},e.prototype.load_video_box=function(t){if(di.b(t))return this.load_box(t)},e.prototype.load_box=function(t){var e=this.cache.get(t.get_id());if(e)return e;var i=new Oi(this.app,t,this.theme,this.cache);return this.addChild(i),this.cache.set(t.get_id(),i),i},e.prototype.get_box=function(t){return this.cache.get(t)},e.prototype.set_theme=function(t){this.theme=t,this.cache.forEach(function(e){e.update_theme(t)})},e.prototype.hide_all_boxes=function(){this.cache.forEach(function(t){t.set_visible(!1)})},e.prototype.destroy_all_boxes=function(){this.cache.forEach(function(t){t.destroy()}),this.cache.clear()},e}(s.f),Oi=function(t){function e(e,i,o,n){var r=t.call(this)||this;return r.app=e,r.target=i,r.theme=o,r.cache=n,r.box_visible=!0,r.LINE_WIDTH=2,r.ICON_HEIGHT=5,r.ICON_WIDTH=43,r.MIN_BOX=54,r.RADUIS=4,r.on_target_destroy=function(){return r.destroy()},r.on_actor_update=function(t){c.l(r.target)&&(void 0!==t.visible&&(r.visible=t.visible&&r.box_visible),t.scale||t.texture?r.draw(r.target):(t.position||t.pivot||void 0!==t.rotation)&&r.update_transform(r.target))},r.on_video_update=function(t){di.b(r.target)&&(void 0!==t.visible&&(r.visible=t.visible&&r.box_visible),t.scale?r.draw(r.target):t.position&&r.update_transform(r.target))},r.target=i,r.id=i.id,r.visible=i.visible&&r.box_visible,r.icon=new s.t,r.icon.width=r.ICON_WIDTH,r.icon.height=r.ICON_HEIGHT,r.load_texture(r.theme.icon_url).then(function(t){r.icon.texture=t,r.app.render()}).catch(function(t){return console.warn(t)}),r.addChild(r.icon),r.draw(r.target),c.l(r.target)?(r.target.add_listener("change",r.on_actor_update),r.target.add_listener("destroy",r.on_target_destroy)):(r.target.add_listener("change",r.on_video_update),r.target.add_listener("destroy",r.on_target_destroy)),r}return Ti(e,t),e.prototype.load_texture=function(t){return function(t,e,i,o){return new(i||(i=Promise))(function(e,n){function r(t){try{a(o.next(t))}catch(t){n(t)}}function s(t){try{a(o.throw(t))}catch(t){n(t)}}function a(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i(function(t){t(o)})).then(r,s)}a((o=o.apply(t,[])).next())})}(this,0,void 0,function(){var e;return function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&r[0]?o.return:r[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,r[1])).done)return n;switch(o=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{i=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}(this,function(i){return t&&s.B.TextureCache[t]?[2,s.B.TextureCache[t]]:t&&s.B.BaseTextureCache[t]?[2,new s.y(s.B.BaseTextureCache[t])]:(e=t?s.y.from(t):s.y.EMPTY).valid?[2,e]:[2,new Promise(function(t,i){e.baseTexture.on("loaded",function(){t(e)}),e.baseTexture.on("update",function(){t(e)}),e.baseTexture.on("error",function(t){e.destroy(!0),i(t)})})]})})},e.prototype.draw=function(t){this.update_transform(t);var e=Math.max(t.width,this.MIN_BOX),i=Math.max(t.height,this.MIN_BOX);this.clear(),this.lineStyle(this.LINE_WIDTH,this.theme.color),this.drawRoundedRect(-e/2,-i/2,e,i,this.RADUIS),this.endFill(),this.icon.position.set(-e/2,-i/2-this.ICON_HEIGHT)},e.prototype.update_theme=function(t){var e=this;this.theme=t,this.draw(this.target),this.load_texture(this.theme.icon_url).then(function(t){e.icon.texture=t,e.app.render()}).catch(function(t){return console.warn(t)})},e.prototype.update_transform=function(t){this.position.set(t.position.x,t.position.y),this.pivot.set(t.pivot.x*t.scale.x,t.pivot.y*t.scale.y),this.rotation=t.rotation},e.prototype.set_visible=function(t){this.box_visible=t,this.visible=this.target.visible&&this.box_visible},e.prototype.destroy=function(){c.l(this.target)?(this.target.remove_listener("change",this.on_actor_update),this.target.remove_listener("destroy",this.on_target_destroy)):(this.target.remove_listener("change",this.on_video_update),this.target.remove_listener("destroy",this.on_target_destroy)),this.cache.delete(this.id),t.prototype.destroy.call(this,{children:!0})},e}(s.j),Ai=function(){function t(t,e,i){var o=this;this.destroy_scene_children_container=function(){o.scene_children_container&&0===o.scene_children_container.children.length&&(o.remove_scene_container_parent_scene_listener(),o.scene_children_container.destroy(),o.events.remove_listener("scene:current_scene_changed",o.on_parent_scene_change),o.scene_children_container=void 0)},this.on_parent_scene_change=function(t){var e=o.data.get_internal_scene(t);e&&(o.remove_scene_container_parent_scene_listener(),o.on_parent_scene_destroy=function(){e.removeChild(o.get_scene_children_container()),o.on_parent_scene_destroy&&e.remove_listener("destroy",o.on_parent_scene_destroy)},e.addChildAt(o.get_scene_children_container(),Et.h),e.add_listener("destroy",o.on_parent_scene_destroy))},this.app=t,this.data=e,this.events=i,this.loader=new At,this.components_z_index_array=[void 0],this.scene_children_container_children_z_index_array=[]}return t.prototype.init=function(t){var e,i=this;!this.editor&&t.editor&&(this.editor=new yi.a(t.editor,this.app,this.data,this.events,this.loader),this.components_z_index_array[Et.c.EDITOR]=this.editor.set_parent),!this.grid&&t.grid&&(this.grid=new ge(this.app,this.events),this.components_z_index_array[Et.c.GRID]=this.grid.set_parent),!this.draggable_container&&t.draggable_container&&(this.draggable_container=new ai(this.app,this.events,this.data),this.components_z_index_array[Et.c.DRAGGABLE_CONTAINER]=this.draggable_container.set_parent),!this.voice_dialog&&t.voice_dialog&&(this.voice_dialog=new ne(t.voice_dialog,this.app,this.loader,this.events),this.components_z_index_array[Et.c.VOICE_DIALOG]=this.voice_dialog.set_parent),!this.stage_dialog&&t.stage_dialog&&(this.stage_dialog=new he(this.app,this.data,this.loader,t.stage_dialog,this.events),this.components_z_index_array[Et.c.STAGE_DIALOG]=this.stage_dialog.set_parent),!this.selection_dialog&&t.selection_dialog&&(this.selection_dialog=new be(this.app,this.events),this.components_z_index_array[Et.c.SELECTION_DIALOG]=this.selection_dialog.set_parent),!this.translate_dialog&&t.translate_dialog&&(this.translate_dialog=new ui(this.app,this.loader,this.events,t.translate_dialog),this.components_z_index_array[Et.c.TRANSLATE_DIALOG]=this.translate_dialog.set_parent),!this.playable_manager&&t.playable_manager&&(this.playable_manager=new di.a(this.app,this.data,this.events,this.destroy_scene_children_container),this.scene_children_container_children_z_index_array[Et.g.PLAYABLE_CONTAINER]=this.playable_manager.set_video_container_parent,(e=t.playable_manager.parent_scene_id)&&this.on_parent_scene_change(e)),!this.camera&&t.camera&&(this.camera=new gi(this.app,this.destroy_scene_children_container),this.scene_children_container_children_z_index_array[Et.g.CAMERA]=this.camera.set_parent,(e=t.camera.parent_scene_id)&&this.on_parent_scene_change(e)),!this.actor_dialog_manager&&t.actor_dialog_manager&&(this.actor_dialog_manager=new Lt(this.app,this.data)),!this.wood_loader&&t.wood_loader&&(this.wood_loader=new mi(this.app,this.loader,t.wood_loader.url)),!this.border_box&&t.border_box&&(this.border_box=new wi(this.app,this.data),this.components_z_index_array[Et.c.BORDER_BOX]=this.border_box.set_parent),!this.cooperation_box_container&&t.cooperation_box_container&&(this.cooperation_box_container=new ki(t.cooperation_box_container,this.app,this.data),this.components_z_index_array[Et.c.COOPERATION_CONTAINER]=this.cooperation_box_container.set_parent);var o=this.app.get_app().stage;this.components_z_index_array.forEach(function(t){t&&t(o)}),this.scene_children_container_children_z_index_array.forEach(function(t){t&&t(i.get_scene_children_container())})},t.prototype.get_scene_children_container=function(){return this.scene_children_container||(this.scene_children_container=new s.f,this.events.add_listener("scene:current_scene_changed",this.on_parent_scene_change)),this.scene_children_container},t.prototype.remove_scene_container_parent_scene_listener=function(){var t=this.get_scene_children_container().parent;c.m(t)&&this.on_parent_scene_destroy&&(t.remove_listener("destroy",this.on_parent_scene_destroy),this.on_parent_scene_destroy=void 0)},t.prototype.destroy=function(t){this.editor&&t.editor&&(this.editor.destroy(),this.editor=void 0,this.components_z_index_array[Et.c.EDITOR]=void 0),this.actor_dialog_manager&&t.actor_dialog_manager&&(this.actor_dialog_manager.destroy(),this.actor_dialog_manager=void 0),this.stage_dialog&&t.stage_dialog&&(this.stage_dialog.destroy(),this.stage_dialog=void 0,this.components_z_index_array[Et.c.STAGE_DIALOG]=void 0),this.grid&&t.grid&&(this.grid.destroy(),this.grid=void 0,this.components_z_index_array[Et.c.GRID]=void 0),this.selection_dialog&&t.selection_dialog&&(this.selection_dialog.destroy(),this.selection_dialog=void 0,this.components_z_index_array[Et.c.SELECTION_DIALOG]=void 0),this.translate_dialog&&t.translate_dialog&&(this.translate_dialog.destroy(),this.translate_dialog=void 0,this.components_z_index_array[Et.c.TRANSLATE_DIALOG]=void 0),this.draggable_container&&t.draggable_container&&(this.draggable_container.destroy(),this.draggable_container=void 0,this.components_z_index_array[Et.c.DRAGGABLE_CONTAINER]=void 0),this.camera&&t.camera&&(this.camera.destroy(),this.camera=void 0,this.scene_children_container_children_z_index_array[Et.g.CAMERA]=void 0),this.playable_manager&&t.playable_manager&&(this.playable_manager.destroy(),this.playable_manager=void 0,this.scene_children_container_children_z_index_array[Et.g.PLAYABLE_CONTAINER]=void 0),this.wood_loader&&t.wood_loader&&(this.wood_loader.destroy(),this.wood_loader=void 0),this.voice_dialog&&t.voice_dialog&&(this.voice_dialog.destroy(),this.voice_dialog=void 0,this.components_z_index_array[Et.c.VOICE_DIALOG]=void 0),this.border_box&&t.border_box&&(this.border_box.destroy(),this.border_box=void 0,this.components_z_index_array[Et.c.BORDER_BOX]=void 0)},t.prototype.get_editor=function(){return this.editor},t.prototype.get_actor_dialog_manager=function(){return this.actor_dialog_manager},t.prototype.get_voice_dialog=function(){return this.voice_dialog},t.prototype.get_stage_dialog=function(){return this.stage_dialog},t.prototype.get_grid=function(){return this.grid},t.prototype.get_selection_dialog=function(){return this.selection_dialog},t.prototype.get_translate_dialog=function(){return this.translate_dialog},t.prototype.get_draggable_container=function(){return this.draggable_container},t.prototype.get_playable_manager=function(){return this.playable_manager},t.prototype.get_camera=function(){return this.camera},t.prototype.get_wood_loader=function(){return this.wood_loader},t.prototype.get_border_box=function(){return this.border_box},t.prototype.get_cooperation_container=function(){return this.cooperation_box_container},t}(),Ei={Components:Symbol("Components"),KittenStage:Symbol("KittenStage")},Ci=function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(e,i)};return function(e,i){function o(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(o.prototype=i.prototype,new o)}}(),Ii=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pi=function(t,e){return function(i,o){e(i,o,t)}},Mi=function(t){function e(e,i,o,n,r,s,a,c,_){var h=t.call(this,e,o,n,r,s,a,c,i)||this;return h.events=i,h.components=_(e,h.data),h}return Ci(e,t),function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s}([n.injectable(),Pi(0,n.inject(a.App)),Pi(1,n.inject(a.Events)),Pi(2,n.inject(a.Data)),Pi(3,n.inject(a.Textures)),Pi(4,n.inject(a.Scenes)),Pi(5,n.inject(a.Actors)),Pi(6,n.inject(a.StageAnimation)),Pi(7,n.inject(a.Physics)),Pi(8,n.inject(Ei.Components)),Ii("design:paramtypes",[Object,Object,Function,Function,Function,Function,Function,Function,Function])],e)}(lt),Si=Ot;Si.bind(Ei.Components).toFactory(function(t){var e=t.container.get(a.Events);return function(t,i){return new Ai(t,i,e)}}),Si.bind(Ei.KittenStage).to(Mi);var Li=i(96001).version;function Ri(){return function(t){return Si.get(t)}(Ei.KittenStage)}console.log("%cWelcome to ❤ Codemao Stage - v"+Li+" ❤ for Kitten o(*￣▽￣*)ブ","\n  color: #BC2424;\n  text-shadow: 0 1px 0 #8D1B1B;");const Ni=Ri},41108:(t,e,i)=>{i.r(e),i.d(e,{press:()=>n});const o=i(22776);function n(t){return[o.default({targets:"#".concat(t),scale:[{value:.9,duration:100},{value:1,duration:200}]})]}},64330:(t,e,i)=>{i.r(e),i.d(e,{a:()=>T,default:()=>k});const o=i(42155),n=i(89843),r=i(4264),s=i(96540),a=i(21536),c=i(11412);var _,h,l=(h=(_=c)&&_.__esModule?function(){return _.default}:function(){return _},Object.defineProperty(h,"a",{enumerable:!0,get:h}),h);const p=i(98844);var u={adjustX:1,adjustY:1},d={adjustX:0,adjustY:0},f=[0,0];function g(t){return"boolean"==typeof t?t?u:d:r.a(r.a({},d),t)}const y=i(9296),v=i(47898),b=i(37627);b.a("success","processing","error","default","warning");var m=b.a("pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime");const x=i(33684);var w=new RegExp("^(".concat(m.join("|"),")(-inverse)?$")),T=s.forwardRef(function(t,e){var i,c,_=s.useContext(v.b),h=_.getPopupContainer,u=_.getPrefixCls,d=_.direction,b=function(t,e){var i=e||{},o=i.defaultValue,r=i.value,a=i.onChange,c=i.postState,_=s.useState(function(){return void 0!==r?r:void 0!==o&&("function"==typeof o?o():o)}),h=n.a(_,2),l=h[0],p=h[1],u=void 0!==r?r:l;c&&(u=c(u));var d=s.useRef(!0);return s.useEffect(function(){d.current?d.current=!1:void 0===r&&p(r)},[r]),[u,function(t){p(t),u!==t&&a&&a(t,u)}]}(0,{value:t.visible,defaultValue:t.defaultVisible}),m=n.a(b,2),T=m[0],k=m[1],O=function(){var e=t.title,i=t.overlay;return!e&&!i&&0!==e},A=function(){var e=t.builtinPlacements,i=t.arrowPointAtCenter,o=t.autoAdjustOverflow;return e||function(t){var e=t.arrowWidth,i=void 0===e?4:e,o=t.horizontalArrowShift,n=void 0===o?16:o,s=t.verticalArrowShift,a=void 0===s?8:s,c=t.autoAdjustOverflow,_={left:{points:["cr","cl"],offset:[-4,0]},right:{points:["cl","cr"],offset:[4,0]},top:{points:["bc","tc"],offset:[0,-4]},bottom:{points:["tc","bc"],offset:[0,4]},topLeft:{points:["bl","tc"],offset:[-(n+i),-4]},leftTop:{points:["tr","cl"],offset:[-4,-(a+i)]},topRight:{points:["br","tc"],offset:[n+i,-4]},rightTop:{points:["tl","cr"],offset:[4,-(a+i)]},bottomRight:{points:["tr","bc"],offset:[n+i,4]},rightBottom:{points:["bl","cr"],offset:[4,a+i]},bottomLeft:{points:["tl","bc"],offset:[-(n+i),4]},leftBottom:{points:["br","cl"],offset:[-4,a+i]}};return Object.keys(_).forEach(function(e){_[e]=t.arrowPointAtCenter?r.a(r.a({},_[e]),{overflow:g(c),targetOffset:f}):r.a(r.a({},p.a[e]),{overflow:g(c)}),_[e].ignoreShake=!0}),_}({arrowPointAtCenter:i,autoAdjustOverflow:o})},E=t.getPopupContainer,C=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i}(t,["getPopupContainer"]),I=t.prefixCls,P=t.openClassName,M=t.getTooltipContainer,S=t.overlayClassName,L=t.color,R=t.overlayInnerStyle,N=t.children,D=u("tooltip",I),G=u(),j=T;!("visible"in t)&&O()&&(j=!1);var F=function(t,e){var i=t.type;if((!0===i.__ANT_BUTTON||!0===i.__ANT_SWITCH||!0===i.__ANT_CHECKBOX||"button"===t.type)&&t.props.disabled){var o=function(t){var e={},i=r.a({},t);return["position","left","right","top","bottom","float","display","zIndex"].forEach(function(o){t&&o in t&&(e[o]=t[o],delete i[o])}),{picked:e,omitted:i}}(t.props.style),n=o.picked,a=o.omitted,c=r.a(r.a({display:"inline-block"},n),{cursor:"not-allowed",width:t.props.block?"100%":null}),_=r.a(r.a({},a),{pointerEvents:"none"}),h=y.a(t,{style:_,className:null});return s.createElement("span",{style:c,className:l()(t.props.className,"".concat(e,"-disabled-compatible-wrapper"))},h)}return t}(y.b(N)?N:s.createElement("span",null,N),D),z=F.props,B=l()(z.className,o.a({},P||"".concat(D,"-open"),!0)),H=l()(S,(i={},o.a(i,"".concat(D,"-rtl"),"rtl"===d),o.a(i,"".concat(D,"-").concat(L),L&&w.test(L)),i)),V=R;return L&&!w.test(L)&&(V=r.a(r.a({},R),{background:L}),c={background:L}),s.createElement(a.a,r.a({},C,{prefixCls:D,overlayClassName:H,getTooltipContainer:E||M||h,ref:e,builtinPlacements:A(),overlay:function(){var e=t.title,i=t.overlay;return 0===e?e:i||e||""}(),visible:j,onVisibleChange:function(e){var i;k(!O()&&e),O()||null===(i=t.onVisibleChange)||void 0===i||i.call(t,e)},onPopupAlign:function(t,e){var i=A(),o=Object.keys(i).filter(function(t){return i[t].points[0]===e.points[0]&&i[t].points[1]===e.points[1]})[0];if(o){var n=t.getBoundingClientRect(),r={top:"50%",left:"50%"};o.indexOf("top")>=0||o.indexOf("Bottom")>=0?r.top="".concat(n.height-e.offset[1],"px"):(o.indexOf("Top")>=0||o.indexOf("bottom")>=0)&&(r.top="".concat(-e.offset[1],"px")),o.indexOf("left")>=0||o.indexOf("Right")>=0?r.left="".concat(n.width-e.offset[0],"px"):(o.indexOf("right")>=0||o.indexOf("Left")>=0)&&(r.left="".concat(-e.offset[0],"px")),t.style.transformOrigin="".concat(r.left," ").concat(r.top)}},overlayInnerStyle:V,arrowContent:s.createElement("span",{className:"".concat(D,"-arrow-content"),style:c}),motion:{motionName:x.b(G,"zoom-big-fast",t.transitionName),motionDeadline:1e3}}),j?y.a(F,{className:B}):F)});T.displayName="Tooltip",T.defaultProps={placement:"top",mouseEnterDelay:.1,mouseLeaveDelay:.1,arrowPointAtCenter:!1,autoAdjustOverflow:!0};const k=T},69475:t=>{var e;e=function(){return this}();try{e=e||new Function("return this")()}catch(t){"object"==typeof window&&(e=window)}t.exports=e},98844:(t,e,i)=>{i.r(e),i.d(e,{a:()=>r,default:()=>s});var o={adjustX:1,adjustY:1},n=[0,0],r={left:{points:["cr","cl"],overflow:o,offset:[-4,0],targetOffset:n},right:{points:["cl","cr"],overflow:o,offset:[4,0],targetOffset:n},top:{points:["bc","tc"],overflow:o,offset:[0,-4],targetOffset:n},bottom:{points:["tc","bc"],overflow:o,offset:[0,4],targetOffset:n},topLeft:{points:["bl","tl"],overflow:o,offset:[0,-4],targetOffset:n},leftTop:{points:["tr","tl"],overflow:o,offset:[-4,0],targetOffset:n},topRight:{points:["br","tr"],overflow:o,offset:[0,-4],targetOffset:n},rightTop:{points:["tl","tr"],overflow:o,offset:[4,0],targetOffset:n},bottomRight:{points:["tr","br"],overflow:o,offset:[0,4],targetOffset:n},rightBottom:{points:["bl","br"],overflow:o,offset:[4,0],targetOffset:n},bottomLeft:{points:["tl","bl"],overflow:o,offset:[0,4],targetOffset:n},leftBottom:{points:["br","bl"],overflow:o,offset:[-4,0],targetOffset:n}};const s=r}}]);