(self.webpackChunkcoco_next=self.webpackChunkcoco_next||[]).push([["377"],{46155(e){e.exports="https://creation.codemao.cn/coco/home/dist/asset/empty_17253.png"},24571(e){e.exports="https://creation.codemao.cn/coco/home/dist/asset/search_0e148.png"},25976(e,t,o){"use strict";o.r(t),o.d(t,{default:()=>W});var r=o(19040),n=o(95766),i=o(16979),s=o(30494),l=o(99407),a=o(50467),c=o(44693),d=o(31635),h=o(74848),p=o(11188),k=o(82695),m=o(35616),u=o(80409),f=o(20866),v=o(26469),y=o(46942),_=o.n(y),g=o(72407),C=o.n(g),L=function(e){function t(e){var o;return(0,s._)(this,t),o=(0,i._)(this,t,[e]),(0,a._)(o,"isCompositionEnd",void 0),(0,a._)(o,"keywordRef",void 0),(0,a._)(o,"templateListRef",void 0),o.isCompositionEnd=!0,o.state={workType:v.L.CREATE,recoverVisible:!1,keyword:"",isScrolled:!1},o.handleScroll=o.handleScroll.bind(o),o.handleLogin=o.handleLogin.bind(o),o.handleCreateScroll=o.handleCreateScroll.bind(o),o.handleCollScroll=o.handleCollScroll.bind(o),o.handleDeleteScroll=o.handleDeleteScroll.bind(o),o.handleSwitchWorkType=o.handleSwitchWorkType.bind(o),o.handleCompositionStart=o.handleCompositionStart.bind(o),o.handleCompositionEnd=o.handleCompositionEnd.bind(o),o.handleInputChange=o.handleInputChange.bind(o),o.handleClearInput=o.handleClearInput.bind(o),o.handleToggleRecoverVisible=o.handleToggleRecoverVisible.bind(o),o.handleClearDeletedWork=o.handleClearDeletedWork.bind(o),o}return(0,c._)(t,e),(0,l._)(t,[{key:"componentDidMount",value:function(){var e=this.state.keyword,t=this.props.userInfo;t&&!t.isNewUser&&(this.props.getCreateWorkListAction({name:e,offset:0}),this.props.getCollWorkListAction({name:e,offset:1})),addEventListener("scroll",this.handleScroll),addEventListener("resize",this.handleScroll)}},{key:"componentWillUnmount",value:function(){removeEventListener("scroll",this.handleScroll),removeEventListener("resize",this.handleScroll)}},{key:"componentDidUpdate",value:function(e,t){}},{key:"handleScroll",value:function(){var e=this.state,t=e.recoverVisible,o=e.workType;t?this.handleDeleteScroll():o===v.L.CREATE?this.handleCreateScroll():o===v.L.COLL&&this.handleCollScroll(),this.setState({isScrolled:document.documentElement.scrollTop>0})}},{key:"handleLogin",value:function(){this.props.setSignDialogVisibleAction(!0)}},{key:"handleSwitchWorkType",value:function(e){var t=this.props.userInfo,o=this.state.keyword;this.setState({workType:e}),t&&!t.isNewUser&&(this.props.getCreateWorkListAction({name:o,offset:0}),this.props.getCollWorkListAction({name:o,offset:1}))}},{key:"handleInputChange",value:function(e){var t=this.props.userInfo;this.setState({keyword:e}),this.isCompositionEnd&&t&&!t.isNewUser&&(this.state.workType===v.L.CREATE?this.props.getCreateWorkListAction({name:e,offset:0}):this.props.getCollWorkListAction({name:e,offset:1}))}},{key:"handleClearInput",value:function(){this.handleInputChange("")}},{key:"handleCompositionStart",value:function(){this.isCompositionEnd=!1}},{key:"handleCompositionEnd",value:function(){this.isCompositionEnd=!0,this.handleInputChange(this.state.keyword)}},{key:"handleToggleRecoverVisible",value:function(e){e&&this.props.getDeleteWorkListAction({offset:0}),this.setState({recoverVisible:e,isScrolled:!1})}},{key:"handleNavToCocoEditor",value:function(){var e=(0,p.$)().cocoEditorUrl;window.open(e,Date.now().toString())}},{key:"handleClearDeletedWork",value:function(){0!==this.props.deleteWorkList.length&&this.props.setConfirmDialogInfoAction({visible:!0,isDangerous:!0,content:"清空回收站所有作品，删除后无法恢复。",onConfirm:this.props.clearDeletedWorkAction})}},{key:"prevTemplate",value:function(){this.templateListRef.scrollBy({left:-960,behavior:"smooth"})}},{key:"nextTemplate",value:function(){this.templateListRef.scrollBy({left:960,behavior:"smooth"})}},{key:"handleCreateScroll",value:function(){var e=this,t=this.props,o=t.createWorkOffset,r=t.createWorkIsLoaded,n=this.state.keyword;if(!r){this.scroll_clock&&clearTimeout(this.scroll_clock);var i=document.documentElement;this.scroll_clock=setTimeout(function(){var t=i.clientHeight;800>Math.abs(i.scrollHeight-i.scrollTop-t)&&this.props.createWorkList.length&&e.props.getCreateWorkListAction({name:n,offset:o+1})},100)}}},{key:"handleCollScroll",value:function(){var e=this,t=this.props,o=t.collWorkOffset,r=t.collWorkIsLoaded,n=this.state.keyword;if(!r){this.scroll_clock&&clearTimeout(this.scroll_clock);var i=document.documentElement;this.scroll_clock=setTimeout(function(){var t=i.clientHeight;800>Math.abs(i.scrollHeight-i.scrollTop-t)&&this.props.collWorkList.length&&e.props.getCollWorkListAction({name:n,offset:o+1})},100)}}},{key:"handleDeleteScroll",value:function(){var e=this,t=this.props,o=t.deleteWorkOffset;if(!t.deleteWorkIsLoaded){this.scroll_clock&&clearTimeout(this.scroll_clock);var r=document.documentElement;this.scroll_clock=setTimeout(function(){var t=r.clientHeight;800>Math.abs(r.scrollHeight-r.scrollTop-t)&&this.props.deleteWorkList.length&&e.props.getDeleteWorkListAction({offset:o+1})},100)}}},{key:"renderWorkFilter",value:function(){var e=this,t=this.state,o=t.workType,r=t.keyword;return(0,h.jsxs)("div",{styleName:_()("workCategory",this.state.isScrolled&&"shadow"),children:[(0,h.jsxs)("div",{styleName:"workType",children:[(0,h.jsx)("div",{onClick:function(){return e.handleSwitchWorkType(v.L.CREATE)},styleName:_()("typeItem",o===v.L.CREATE&&"active"),children:"我创建的"}),(0,h.jsx)("div",{onClick:function(){return e.handleSwitchWorkType(v.L.COLL)},styleName:_()("typeItem",o===v.L.COLL&&"active"),children:"我参与的"})]}),(0,h.jsxs)("div",{styleName:"searchBox",children:[o===v.L.CREATE&&(0,h.jsx)(k.A,{value:r,ref:function(t){return e.keywordRef=t},onClearCallback:this.handleClearInput,styleName:"searchInput",placeholder:"搜索作品",onChange:this.handleInputChange,onCompositionStart:this.handleCompositionStart,onCompositionEnd:this.handleCompositionEnd,clearButtonVisible:!!r,before:(0,h.jsx)(m.A,{type:"icon-search"})}),(0,h.jsxs)("div",{styleName:"recoverBtn",onClick:function(){return e.handleToggleRecoverVisible(!0)},children:[(0,h.jsx)(m.A,{type:"icon-deleted",styleName:"icon"}),"回收站"]})]})]})}},{key:"renderTemplate",value:function(){var e=this,t=this.props,o=t.templateList,r=t.userInfo;return(0,h.jsxs)("div",{styleName:_()("templateBox",!r&&"notLogin"),children:[(0,h.jsxs)("div",{styleName:"titleBox",children:[(0,h.jsxs)("div",{styleName:"templateTitle",children:[(0,h.jsx)(m.A,{type:"icon-template",styleName:"titleIcon"}),(0,h.jsx)("h2",{styleName:"title",children:"从模版开始探索"})]}),(0,h.jsxs)("div",{styleName:"pageBtn",children:[(0,h.jsx)("div",{styleName:_()("btnItem"),onClick:function(){return e.prevTemplate()},children:(0,h.jsx)(m.A,{type:"icon-next",styleName:"prev"})}),(0,h.jsx)("div",{styleName:"btnItem",onClick:function(){return e.nextTemplate()},children:(0,h.jsx)(m.A,{type:"icon-next"})})]})]}),(0,h.jsx)("div",{styleName:"templateList",ref:function(t){return e.templateListRef=t},children:o.map(function(e){return(0,h.jsx)(u.A,{item:e},e.id)})})]})}},{key:"renderUserContent",value:function(){var e=this,t=this.state,r=t.workType,n=t.keyword,i=this.props,s=i.createWorkList,l=i.collWorkList,a=i.userInfo;return s.forEach(function(e){return e.role=1}),l.forEach(function(e){return e.role=2}),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{styleName:"userWorkBox",children:[this.renderWorkFilter(),r===v.L.CREATE&&(0,h.jsxs)(h.Fragment,{children:[s.length>0&&(0,h.jsx)("div",{styleName:"workList",children:s.map(function(t){return(0,h.jsx)(f.A,{ref:e.handleScroll,item:t,workType:v.L.CREATE,callback:function(){return e.props.getCreateWorkListAction(n)}},t.work_id)})}),0==s.length&&(0,h.jsxs)("div",{styleName:_()("noData",a&&!a.isNewUser&&"oldUser"),children:[n&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("img",{src:o(24571),alt:""}),(0,h.jsx)("span",{styleName:"searchTips",children:"没有找到作品，换个姿势再搜索一次吧～"})]}),!n&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("img",{src:o(46155),styleName:"image",alt:""}),(0,h.jsx)("span",{styleName:"noWorkTips",children:"你还未创作任何作品"}),(0,h.jsxs)("div",{styleName:"createBtn",onClick:this.handleNavToCocoEditor,children:["去创作",(0,h.jsx)(m.A,{type:"icon-button-arrow",styleName:"icon"})]})]})]})]}),r===v.L.COLL&&(0,h.jsxs)(h.Fragment,{children:[l.length>0&&(0,h.jsx)("div",{styleName:"workList",children:l.map(function(t){return(0,h.jsx)(f.A,{ref:e.handleScroll,item:t,workType:v.L.COLL,callback:function(){return e.props.getCollWorkListAction(n)}},t.work_id)})}),0==l.length&&(0,h.jsxs)("div",{styleName:_()("noData",a&&!a.isNewUser&&"oldUser"),children:[n&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("img",{src:o(24571),alt:""}),(0,h.jsx)("span",{styleName:"searchTips",children:"没有找到作品，换个姿势再搜索一次吧～"})]}),!n&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("img",{src:o(46155),styleName:"image",alt:""}),(0,h.jsx)("span",{styleName:"noWorkTips",children:"你还没有任何协作作品"})]})]})]})]}),a&&a.isNewUser&&this.renderTemplate()]})}},{key:"renderRecover",value:function(){var e=this,t=this.state,o=t.workType,r=t.keyword,n=this.props.deleteWorkList;return(0,h.jsxs)("div",{styleName:"content",children:[(0,h.jsxs)("div",{styleName:_()("recoverHeader",this.state.isScrolled&&"shadow"),children:[(0,h.jsxs)("div",{styleName:"backBox",children:[(0,h.jsxs)("div",{styleName:"back",onClick:function(){return e.handleToggleRecoverVisible(!1)},children:[(0,h.jsx)(m.A,{type:"icon-next",styleName:"icon"}),"返回"]}),(0,h.jsx)("div",{styleName:"title",children:"回收站"})]}),(0,h.jsxs)("div",{styleName:_()("clearRecoverBtn",0===n.length&&"disabled"),onClick:this.handleClearDeletedWork,children:[(0,h.jsx)(m.A,{type:"icon-clear",styleName:"icon"}),"清空当前回收站"]})]}),0===n.length&&(0,h.jsx)("div",{styleName:"recoverNoData",children:"空空如也～"}),n.length>0&&(0,h.jsx)("div",{styleName:"recoverList",children:n.map(function(t){return(0,h.jsx)(f.A,{ref:e.handleScroll,item:t,workType:v.L.DELETE,callback:function(){o===v.L.CREATE?e.props.getCreateWorkListAction({name:r,offset:0}):e.props.getCollWorkListAction({name:r,offset:1})}},t.work_id)})})]})}},{key:"render",value:function(){var e=this.state.recoverVisible,t=this.props,r=t.userInfo;return t.userInfoFetchDone?e?(0,h.jsx)("div",{styleName:"work",children:this.renderRecover()}):(0,h.jsxs)("div",{styleName:"work",children:[!r&&(0,h.jsxs)(h.Fragment,{children:[(0,h.jsxs)("div",{styleName:"loginBox",children:[(0,h.jsx)("img",{src:o(46155),styleName:"image",alt:""}),(0,h.jsx)("span",{styleName:"loginTips",children:"你还未登录账号"}),(0,h.jsx)("div",{styleName:"loginBtn",onClick:this.handleLogin,children:"去登录"})]}),this.renderTemplate()]}),r&&(0,h.jsx)("div",{styleName:"workContent",children:this.renderUserContent()})]}):null}}]),t}(o(41594).Component);L=(0,d.__decorate)([C()({work:"work__e55e5",content:"content__ed84e",workContent:"workContent__b8ad0",loginBox:"loginBox__c8233",image:"image__f263b",loginTips:"loginTips__bbb14",loginBtn:"loginBtn__c7c38",userWorkBox:"userWorkBox__ca93f",workList:"workList__c7532",noData:"noData__b4e2c",oldUser:"oldUser__ba632",noWorkTips:"noWorkTips__aa1bd",searchTips:"searchTips__ccdab",createBtn:"createBtn__c4770",icon:"icon__c74cd",workCategory:"workCategory__f0852",shadow:"shadow__d36a4",workType:"workType__fa3ca",typeItem:"typeItem__a0068",active:"active__fcca4",searchBox:"searchBox__ddfa1",searchInput:"searchInput__b0af8",recoverBtn:"recoverBtn__de10c",disabled:"disabled__a8c59",templateBox:"templateBox__fa692",notLogin:"notLogin__ecadd",titleBox:"titleBox__fd2a7",templateTitle:"templateTitle__e2508",title:"title__c88f7",titleIcon:"titleIcon__d5e4d",pageBtn:"pageBtn__e5111",btnItem:"btnItem__d736a",prev:"prev__f2af5",templateList:"templateList__d5860",recoverHeader:"recoverHeader__e3478",backBox:"backBox__b8b76",back:"back__e7bca",clearRecoverBtn:"clearRecoverBtn__b2714",recoverNoData:"recoverNoData__f2a65",recoverList:"recoverList__dd994"},{allowMultiple:!0})],L);var x=o(35609),w=o(81599);let W=r.connect(function(e){return{userInfo:e.main_reducer.userInfo,userInfoFetchDone:e.main_reducer.userInfoFetchDone,templateList:e.home_reducer.templateList,createWorkOffset:e.work_reducer.createWorkOffset,createWorkIsLoaded:e.work_reducer.createWorkIsLoaded,createWorkList:e.work_reducer.createWorkList,collWorkOffset:e.work_reducer.collWorkOffset,collWorkIsLoaded:e.work_reducer.createWorkIsLoaded,collWorkList:e.work_reducer.collWorkList,deleteWorkOffset:e.work_reducer.deleteWorkOffset,deleteWorkIsLoaded:e.work_reducer.deleteWorkIsLoaded,deleteWorkList:e.work_reducer.deleteWorkList}},function(e){return n.bindActionCreators({getCreateWorkListAction:x.Q$,getCollWorkListAction:x._X,getDeleteWorkListAction:x.lV,clearDeletedWorkAction:x.eW,setSignDialogVisibleAction:w.e$,setConfirmDialogInfoAction:w.fo},e)})(L)}}]);
//# sourceMappingURL=377.89418f3b8d8c7545.js.map