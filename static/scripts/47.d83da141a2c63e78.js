(self.webpackChunkcoco_next=self.webpackChunkcoco_next||[]).push([["47"],{73615(t,e,o){"use strict";o.d(e,{A:()=>w,B:()=>I,C:()=>A,D:()=>h,E:()=>z,F:()=>V,G:()=>r,H:()=>L,I:()=>q,J:()=>H,K:()=>Q,L:()=>b,M:()=>T,N:()=>N,O:()=>R,P:()=>a,Q:()=>c,R:()=>B,S:()=>Y,T:()=>G,U:()=>p,V:()=>y,a:()=>f,b:()=>k,c:()=>x,d:()=>C,e:()=>l,f:()=>F,g:()=>W,h:()=>i,i:()=>S,j:()=>K,k:()=>j,l:()=>J,m:()=>d,n:()=>U,o:()=>v,p:()=>E,q:()=>O,r:()=>D,s:()=>s,t:()=>_,u:()=>M,v:()=>X,w:()=>P,x:()=>u,y:()=>m,z:()=>g});var i="ASYNC_INITIAL_CLOUD_SPACE_DATA",r=function(){return{type:i,payload:void 0}},s="UPDATE_CLOUD_SPACE_DICT_LIST",a=function(t){return{payload:t,type:s}},_="UPDATE_CLOUD_SPACE_TABLE_LIST",c=function(t){return{payload:t,type:_}},l="ASYNC_FETCH_CLOUD_SPACE_LIST",h=function(){return{payload:void 0,type:l}},d="INIT_CLOUD_SPACE_REF_IDS",u="UPDATE_INITIAL_REF_DICT_IDS",p=function(t){return{payload:t,type:u}},f="APPEND_INITIAL_REF_DICT_IDS",g=function(t){return{payload:t,type:f}},v="REMOVE_INITIAL_REF_DICT_IDS",b=function(t){return{payload:t,type:v}},m="UPDATE_INITIAL_REF_TABLE_IDS",y=function(t){return{payload:t,type:m}},k="APPEND_INITIAL_REF_TABLE_IDS",w=function(t){return{payload:t,type:k}},E="REMOVE_INITIAL_REF_TABLE_IDS",T=function(t){return{payload:t,type:E}},x="ASYNC_CHECK_WIDGET_DATA_SOURCES_VALID",I=function(t){return{payload:t,type:x}},O="UPDATE_CHECKED_TIMESTAMP",N=function(t){return{payload:t,type:O}},C="ASYNC_FETCH_CLOUD_DICT_KEYS_DETAIL",A=function(t,e){return{payload:{id:t,showToast:e},type:C}},S="ASYNC_UPDATE_CLOUD_DICT_KEYS_DETAIL",L=function(t,e,o){return{payload:{id:t,data:e,isEmitOT:o},type:S}},D="UPDATE_CLOUD_DICT_KEYS_DETAIL",R=function(t,e){return{payload:{id:t,data:e},type:D}},M="UPDATE_CLOUD_TABLE_COLUMN_LIST",B=function(t,e){return{payload:{id:t,columns:e},type:M}},P="UPDATE_CLOUD_TABLE_LIST_COLUMNS",G=function(t,e){return{payload:{id:t,columns:e},type:P}},U="REMOVE_CLOUD_TABLE_COLUMN_LIST",F="ASYNC_FETCH_CLOUD_TABLE_COLUMNS_DETAIL",z=function(t,e){return{payload:{id:t,showToast:e},type:F}},j="ASYNC_UPDATE_CLOUD_TABLE_COLUMNS_DETAIL",H=function(t,e,o){return{payload:{id:t,columns:e,isEmitOT:o},type:j}},W="ASYNC_FETCH_CLOUD_TABLE_DATA",V=function(t){return{payload:{id:t},type:W}},X="UPDATE_CLOUD_TABLE_DATA",Y=function(t,e){return{payload:{id:t,data:e},type:X}},K="ASYNC_UPDATE_CLOUD_DICT_LIST",q=function(t,e){return{payload:{list:t,isEmitOT:e},type:K}},J="ASYNC_UPDATE_CLOUD_TABLE_LIST",Q=function(t,e){return{payload:{list:t,isEmitOT:e},type:J}}},76224(t,e,o){"use strict";var i,r,s,a,_,c;o.d(e,{a:()=>r,b:()=>s,c:()=>i}),(a=i||(i={})).DEFAULT="DEFAULT",a.PRIMARY="PRIMARY",(_=r||(r={})).TEMPLATE="TEMPLATE",_.IMAGE="IMAGE",(c=s||(s={})).CONTAIN="contain",c.STRETCH="stretch"},32061(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDragger=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963);e.WorkspaceDragger=function(){function t(t){this.start_scroll_xy_=s.vec2.create(),this.workspace_=t,this.start_drag_metrics_=t.get_metrics(),s.vec2.copy(this.start_scroll_xy_,t.scroll_xy)}return t.prototype.dispose=function(){this.workspace_=void 0},t.prototype.start_drag=function(){this.runtime_data&&this.runtime_data.selected&&this.runtime_data.selected.unselect(),void 0!=this.workspace_&&this.workspace_.setup_drag_surface()},t.prototype.end_drag=function(t){this.drag(t),void 0!=this.workspace_&&this.workspace_.reset_drag_surface(),this.dispose()},t.prototype.drag=function(t){var e=this.start_drag_metrics_,o=s.vec2.add(s.vec2.create(),this.start_scroll_xy_,t);s.vec2.min(o,o,[-e.contentLeft,-e.contentTop]),s.vec2.max(o,o,[e.viewWidth-e.contentLeft-e.contentWidth,e.viewHeight-e.contentTop-e.contentHeight]),s.vec2.scaleAndAdd(o,[-e.contentLeft,-e.contentTop],o,-1),this.update_scroll(o)},t.prototype.update_scroll=function(t){void 0!=this.workspace_&&this.workspace_.get_scrollbar().set(t[0],t[1])},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},20439(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockSvg=void 0;var i=o(31635),r=o(77276),s=o(36963),a=o(35009),_=o(78194),c=o(99469),l=o(89221),h=o(25507),d=o(86295),u=o(37747),p=o(84728),f=o(443),g=o(82267),v=o(71288);e.BlockSvg=function(t){function e(e){var o,i=t.call(this,e.workspace)||this;i.element_type="block",i.type="",i.tooltip="",i.inputList=[],i.width=0,i.svg_path_width=0,i.first_row_width=0,i.first_row_height=0,i.event_initialized=!1,i.warning=void 0,i.output_connection=void 0,i.previous_connection=void 0,i.next_connection=void 0,i.is_shadow_=!1,i.child_blocks=[],i.collapsed_=!1,i.collapsed_dirty=!1,i._is_insertion_marker=!1,i.getInput=i.get_input,i.get_inherited_disabled=function(){for(var t=i.get_surround_parent();t;){if(t.disabled)return!0;t=t.get_surround_parent()}return!1},i.get_root_block=i.get_top_parent,i.getFieldValue=i.get_field_value,i.jsonInit=function(t){var e=(0,d.clone_deep)(t),o=e.type?'Block "'+e.type+'": ':"";(0,c.assert)(void 0==e.output||void 0==e.previousStatement,o+"Must not have both an output and a previousStatement."),void 0!=e.colour&&i.set_colour_from_json(e);for(var r=0,s=e["message"+r];void 0!=s;){var a=e["args"+r],_=e["lastDummyAlign"+r];i.interpolate_(s,a||[],_),s=e["message"+ ++r]}if(void 0!=e.inputsInline&&(i.inputs_inline=e.inputsInline),void 0!==e.output){var l=!0===e.output?void 0:e.output;i.set_output(!0,l,e.required_context)}if(void 0!==e.previousStatement&&i.set_previous_statement(!0),void 0!==e.nextStatement&&i.set_next_statement(!0),void 0!=e.enableContextMenu){var h=e.enableContextMenu;i.enable_context_menu=!!h}if(void 0!=e.helpUrl){h=e.helpUrl;var u=i.utils.replace_message_references(h);i.set_help_url(u)}if((0,d.is_string)(e.extensions)&&console.error('\n        JSON attribute "extensions" should be an array of strings.\n        Found raw string in JSON for "'+e.type+'" block.\n      '),void 0!=e.tooltip&&(h=e.tooltip,u=i.utils.replace_message_references(h),i.set_tooltip(u)),void 0!=e.mutator&&i.extensions.apply_mutator(e.mutator,i),Array.isArray(e.extensions))for(var p=e.extensions,f=0;f<p.length;++f)i.extensions.apply(p[f],i);void 0!=e.outputShape&&i.set_output_shape(e.outputShape),void 0!=e.category&&i.set_category(e.category),e.context_menu&&(i.context_menu_options_setting=e.context_menu)},i.appendDummyInput=i.append_dummy_input,i.context_menu_options_setting=i.workspace.options.context_menu.block,i.prevent_disable_style_change=!1,i.is_glowing_stack=!1,i.is_flashing=!1,i.removeInput=i.remove_input,i.visibility_=a.BlockVisibility.VISIBLE,i.visibility_for_undo=void 0,i.connectable_=!0,i.opacity=1,i.category_=void 0,i.output_shape=void 0,i.help_url="",i.colour_=i.theme.block_color.DEFAULT.fill,i.border_colour=i.theme.block_color.DEFAULT.border;var r=e.workspace,s=e.prototype_name;if(s&&null!=(o=i.svg_group)&&o.classList.add(s),i.id=e.id&&!r.get_block_by_id(e.id)?e.id:(0,l.gen_uid)(),i._is_insertion_marker=!!e.is_insertion_marker,i.enable_context_menu=!0,s){i.type=s;var _=i.Blink.Blocks[s];if(void 0==_)throw Error("Error: Unknown block type "+s+".");Object.assign(i,_)}i.inputs_inline_default=i.inputs_inline,r.blockDB_.set(i.id,i),r.add_top_block(i);var u=void 0;return i.events.is_enabled()&&(u=i.create_event_factory({block:i})),i.svg_path=(0,h.create_svg_element)("path",{class:"blocklyPath"},i.svg_group),i.rendered=!1,i.Blink.mainWorkspace.options.tooltip&&(i.svg_path.tooltip=function(){return(0,d.is_func)(i.tooltip)?i.tooltip():i.tooltip},i.Blink.tooltip.bind_mouse_event(i.svg_path)),(0,d.is_func)(i.init)&&i.init(),(0,d.is_func)(i.onchange)&&i.set_on_change(i.onchange),u&&i.events.fire(u),i}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"onchange",{get:function(){return this._onchange},set:function(t){this._onchange=null==t?void 0:t.bind(this)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){console.warn("\n      why: opt_bubble "+t+"\n    ")},e.prototype.set_warning_text=function(t,e){console.error("Warning is deprecated "+t+" "+e)},e.prototype.get_previous_block=function(){return this.previous_connection&&this.previous_connection.targetBlock()},e.prototype.is_starting_block=function(){return void 0==this.output_connection&&void 0==this.previous_connection&&"factory_base"!==this.type},e.prototype.is_ending_block=function(){return void 0==this.next_connection&&void 0==this.output_connection&&void 0!=this.previous_connection},e.prototype.is_output_block=function(){return!this.previous_connection&&!this.next_connection&&!this.is_shadow()&&!!this.output_connection},e.prototype.is_include_special_input=function(){var t=this;return _.SPECIAL_CONNECTION_INPUT_NAME.some(function(e){return!!t.get_input(e)})},e.prototype.is_wrap_shape=function(){return!this.is_starting_block()&&this.inputList.some(function(t){return t.type===a.InputType.STATEMENT})},e.prototype.set_shadow=function(t){this.is_shadow_=t},e.prototype.is_shadow=function(){return this.is_shadow_},e.prototype.is_deletable=function(){return this.deletable_&&!this.is_shadow_&&!(this.workspace&&this.workspace.get_options().readOnly)},e.prototype.is_movable=function(){return this.movable_&&!this.is_shadow_},e.prototype.get_children=function(t){if(!t)return this.child_blocks;for(var e=[],o=0;o<this.inputList.length;o++){var i=this.inputList[o];if(i.connection){var r=i.connection.targetBlock();r&&e.push(r)}}var s=this.get_next_block();return s&&e.push(s),e},e.prototype.is_collapsed=function(){return this.collapsed_},e.prototype.set_collapsed=function(t,e){void 0===e&&(e=!1);var o=this.is_collapsed();if(o!=t||e)if(this.collapsed_dirty=!0,this.collapsed_=t,this.events.is_enabled()&&o!==t&&this.events.fire(this.change_event_factory("collapsed",{block:this,old_value:o,new_value:t})),e)for(var i=this.get_top_parent().get_descendants(!0,!0),r=i.length-1;r>=0;r--)i[r].update_collapsed(e);else this.rendered&&this.update_collapsed()},e.prototype.hide_into_group=function(t,e){var o,i,r=this;void 0===e&&(e={}),this.events.disable();var s=(null==(i=null==(o=this.workspace.options.block_group)?void 0:o.get_default_name)?void 0:i.bind(this,this))||this.to_string.bind(this),a=this.block_group_factory({workspace:this.workspace,origin_block:this,group_name:t||s(),id:e.id,on_release:function(){(0,c.assert)(r.parent_group),r.events.fire(r.change_event_factory("group_block",{block:r,old_value:[r.parent_group.id,r.parent_group.group_name,r.parent_group.group_stop_at||""],new_value:void 0})),r.parent_group=void 0},origin_xy:e.origin_xy,group_stop_at:e.group_stop_at});a.init_svg(),a.render(),this.parent_group=a,this.events.enable(),this.events.is_enabled()&&this.events.fire(this.change_event_factory("group_block",{block:this,old_value:void 0,new_value:[this.parent_group.id,this.parent_group.group_name,this.parent_group.group_stop_at||""]}))},e.prototype.update_collapsed=function(t){if(void 0===t&&(t=!1),this.collapsed_dirty||t){var e=this.rendered;this.rendered=!1;for(var o=0;o<this.inputList.length;o++)this.inputList[o].set_visible(!this.collapsed_);if(_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&this.next_connection){this.collapsed_?this.next_connection.hide_all():this.next_connection.unhide_all();var i=this.next_connection.targetBlock();i&&i.set_visible_as_child(!this.collapsed_)}if(this.comment&&this.set_comment_visible(!this.collapsed_),this.collapsed_){this.warning&&this.warning.set_expanded(!1),t&&this.remove_input(_.COLLAPSED_INPUT_NAME,!0);var r=this.to_string(this.theme.blink_params.COLLAPSE_CHARS);this.append_dummy_input(_.COLLAPSED_INPUT_NAME).append_field(r).init()}else this.remove_input(_.COLLAPSED_INPUT_NAME,!0);this.rendered=e,(e||t)&&this.render(),this.collapsed_dirty=!1}},e.prototype.set_comment_visible=function(t){this.comment&&(t&&!this.is_collapsed()?(this.comment.get_svg_root().style.display="block",this.comment.reposition(),this.comment.bring_to_front()):this.comment.get_svg_root().style.display="none")},e.prototype.set_visible_as_child=function(t){this.rendered=t,this.get_svg_root().style.display=t?"block":"none",this.get_descendants(!1,!0).forEach(function(e){var o=t&&!e.is_collapsed()&&!e.get_collapsed_surround_parent();e.set_comment_visible(o)})},e.prototype.get_collapsed_surround_parent=function(){var t=this.get_surround_parent();if(t)return t.is_collapsed()?t:t.get_collapsed_surround_parent();for(var e=this.get_parent();e&&(!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(e.type)||!e.is_collapsed());)e=e.get_parent();return e},e.prototype.is_insertion_marker=function(){return this._is_insertion_marker},e.prototype.set_on_change=function(t){this.onchange&&this.workspace&&this.workspace.remove_change_listener(this.onchange),this.onchange=t,this.workspace.add_change_listener(this.onchange)},e.prototype.set_on_block_change=function(t){var e=this;this.is_in_flyout||this.is_insertion_marker()||this.workspace.add_change_listener(function(o){(o.type===a.BlockEventType.CREATE||o.type===a.BlockEventType.CHANGE||o.type===a.BlockEventType.DELETE)&&e.id===o.get_block_id()&&t.call(e,o)})},e.prototype.append_block_input=function(t,e){var o=this.generate_block(t),i=e.connection;if(i){var r=o.output_connection||o.previous_connection;r&&r.connect(i),i.set_hidden(!0)}return o},e.prototype.generate_block=function(t){var e=this.utils.string_to_dom(t);return this.xml.dom_to_block(e,this.workspace)},e.prototype.interpolate_=function(t,e,o){for(var i=this.utils.tokenize_interpolation(t),r=[],s=0,a=[],_=0;_<i.length;_++){var c=i[_];if("number"==typeof c){if(c<=0||c>e.length)throw Error('Block "'+this.type+'": Message index %'+c+" out of range.");if(r[c])throw Error('Block "'+this.type+'": Message index %'+c+" duplicated.");r[c]=!0,s++,a.push(e[c-1])}else(c=c.trim())&&a.push(c)}if(s!=e.length)throw Error('Block "'+this.type+'": Message does not reference all '+e.length+" arg(s). Massage: "+t);var l=a[a.length-1];if(a.length&&("string"==typeof l||l.type.startsWith("field_"))){var h={type:"input_dummy",name:""};o&&Object.assign(h,{align:o}),a.push(h)}var d=[];for(_=0;_<a.length;_++){var u=a[_];if("string"!=typeof u){var p=void 0,f=void 0;if("string"!=typeof u)if(u.custom)p=this.init_custom_field(u),d.push([p,u.name]);else{switch(u.type){case"input_shadow":f=this.append_shadow_input_json(u.name,u.field_type,u.default_text);break;case"input_value":f=this.append_value_input(u.name,void 0,void 0,u.default_shadow);break;case"input_statement":f=this.append_statement_input(u.name,void 0,u.provided_context);break;case"input_dummy":f=this.append_dummy_input(u.name);break;case"field_label":p=this.field_label_factory({text:this.utils.replace_message_references(u.text),opt_class:u.class});break;case"field_label_serializable":p=this.field_label_serializable_factory({text:this.utils.replace_message_references(u.text),opt_class:u.class});break;case"field_input":p=this.new_field_text_input_from_json(u);break;case"field_colour":p=this.field_colour_factory({colour:u.colour,opt_validator:u.validator});break;case"field_dropdown":p=this.field_dropdown_factory({menu_generator:u.options,opt_onchange:u.onchange,selected_index:u.selected_index,opt_validator:u.validator});break;case"field_dropdown_advanced":p=this.field_dropdown_factory({menu_generator:[],opt_onchange:u.onchange,selected_index:u.selected_index,opt_validator:u.validator,menu_generator_advanced:u.advanced_options});break;case"field_image":case"field_button":var g=this.parse_field_image_param_from_json(u),v=g.src,b=g.width,m=g.height,y=g.alt,k=g.callback,w=g.circle;p="field_image"===u.type?this.field_image_factory({src:v,width:b,height:m,opt_alt:y}):this.field_button_factory({src:v,width:b,height:m,opt_alt:y,opt_callback:k,has_circle:w});break;case"field_icon":if(!u.is_head)break;p=this.field_icon_factory({src:u.src,opt_alt:u.alt,opt_is_head:u.is_head});break;case"mutation_add_button":p=this.mutation_add_factory(void 0);break;case"mutation_remove_button":p=this.mutation_remove_factory(void 0);break;case"field_number":p=this.field_number_factory({opt_value:u.value,opt_min:u.min,opt_max:u.max,opt_precision:u.precision,opt_controller:u.controller});break;case"field_textdropdown":p=this.field_text_dropdown_factory(u.options);break;case"field_multiline_input":p=this.field_multiline_input(u);break;case"field_default_value":p=this.field_default_value(u);break;default:p=this.init_custom_field(u)}if(p)void 0!==u.margin_left&&(p.margin_left=u.margin_left),d.push([p,u.name]);else if(f){u.check&&f.set_check(u.check),void 0!==u.margin_left&&(f.margin_left=u.margin_left);for(var E=0;E<d.length;E++)f.append_field(d[E][0],d[E][1]);d.length=0}}else p=this.field_label_factory({text:u})}else d.push([u,void 0])}},e.prototype.init_custom_field=function(t){var e=this.registry.field.from_json(t);if(e)return e;var o=t.type;if(o){var i=o.split("_").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("");window.Blockly[i]&&(e=new window.Blockly[i](t))}if(!e)throw ReferenceError("Trying to init an undefined type of field");return e},e.prototype.get_input=function(t){for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(o.name==t)return o}},e.prototype.set_disabled=function(t){var e=void 0;this.disabled!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("disabled",{block:this,old_value:this.disabled,new_value:t})),this.disabled=t),this.is_rendered()&&this.update_disabled(),e&&this.events.fire(e)},e.prototype.set_editable=function(t){this.editable_=t;for(var e=0;e<this.inputList.length;e++)for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++)o.fieldRow[i].update_editable()},e.prototype.set_connections_hidden=function(t){if(!t&&this.is_collapsed())this.output_connection&&this.output_connection.set_hidden(t),this.previous_connection&&this.previous_connection.set_hidden(t),this.next_connection&&!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&(this.next_connection.set_hidden(t),(i=this.next_connection.targetBlock())&&i.set_connections_hidden(t));else for(var e=this.get_connections(!0),o=0;o<e.length;o++){var i,r=e[o];r.set_hidden(t),r.is_superior()&&(i=r.targetBlock())&&i.set_connections_hidden(t)}},e.prototype.get_surround_parent=function(){var t,e=this;do if(t=e,!(e=e.get_parent()||e.parent_group))return;while(e.get_next_block()==t);return e},e.prototype.get_top_group=function(){for(var t=this,e=void 0;t;)t.parent_group&&(t=e=t.parent_group),t=t.get_parent();return e},e.prototype.get_top_parent=function(){for(var t=this;t.parent_block;)t=t.parent_block;return t},e.prototype.get_connections=function(t){var e=[];if((t||this.rendered)&&(this.output_connection&&e.push(this.output_connection),this.previous_connection&&e.push(this.previous_connection),this.next_connection&&e.push(this.next_connection),t||!this.is_collapsed()))for(var o=0;o<this.inputList.length;o++){var i=this.inputList[o];i.connection&&e.push(i.connection)}return e},e.prototype.get_full_next_connection=function(){if(this.next_connection)return this.next_connection;if(this.is_starting_block())for(var t=0;t<this.inputList.length;t++){var e=this.inputList[t];if(e.type===a.InputType.STATEMENT)return e.connection}},e.prototype.last_connection_in_stack=function(){for(var t=this.get_full_next_connection();t;){var e=t.targetBlock();if(!e)return t;t=e.next_connection}},e.prototype.get_input_with_connection=function(t){for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(o.connection==t)return o}},e.prototype.get_first_statement_connection=function(){for(var t=0;t<this.inputList.length;t++){var e=this.inputList[t];if(e.connection&&e.connection.type==a.CONNECTION_TYPE.NEXT_STATEMENT)return e.connection}},e.prototype.get_matching_connection=function(t,e){var o=this.get_connections(!0),i=t.get_connections(!0);if(!this.is_insertion_marker()&&o.length!=i.length)throw Error("Connection lists did not match in length.");for(var r=0;r<i.length;r++)if(i[r]==e)return o[r]},e.prototype.unplug=function(t){if(this.output_connection)this.output_connection.is_connected()&&this.output_connection.disconnect();else if(this.previous_connection){var e=void 0;this.previous_connection.is_connected()&&(e=this.previous_connection.get_targe_connection(),this.previous_connection.disconnect());var o=this.get_next_block();if(t&&o){var i=this.next_connection;if(!i)return;var r=i.get_targe_connection();if(!r)return;r.disconnect(),e&&e.check_type(r)&&e.connect(r)}}},e.prototype.get_input_with_block=function(t){for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(o.connection&&o.connection.targetBlock()==t)return o}},e.prototype.get_input_target_block=function(t){var e=this.get_input(t);return e&&e.connection&&e.connection.targetBlock()},e.prototype.get_field_value=function(t){var e=this.get_field(t);if(e)return e.get_value()},e.prototype.get_shadow_field=function(t,e){void 0===e&&(e="NUM");var o=this.get_input(t);if(o&&o.connection){var i=o.connection.target_connection;if(i)return i.source_block.get_field(e)}},e.prototype.get_shadow_field_value=function(t,e){void 0===e&&(e="NUM");var o=this.get_shadow_field(t,e);if(o)return o.get_value()},e.prototype.set_field_value=function(t,e){var o=this.get_field(e);if(!o)throw ReferenceError("Field "+e+" not found.");o.set_value(t)},e.prototype.get_input_with_field=function(t){for(var e=0;e<this.inputList.length;e++)for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++)if(o.fieldRow[i].name===t)return o},e.prototype.set_next_statement=function(t,e){t?(void 0==e&&(e=void 0),this.next_connection||(this.next_connection=this.make_connection(a.CONNECTION_TYPE.NEXT_STATEMENT)),this.next_connection.set_check(e)):this.next_connection&&((0,c.assert)(!this.next_connection.is_connected(),"Must disconnect next statement before removing connection."),this.next_connection.dispose(),this.next_connection=void 0)},e.prototype.set_previous_statement=function(t,e){t?(void 0==e&&(e=void 0),this.previous_connection||((0,c.assert)(!this.output_connection,"Remove output connection prior to adding previous connection."),this.previous_connection=this.make_connection(a.CONNECTION_TYPE.PREVIOUS_STATEMENT)),this.previous_connection.set_check(e)):this.previous_connection&&((0,c.assert)(!this.previous_connection.is_connected(),"Must disconnect previous statement before removing connection."),this.previous_connection.dispose(),this.previous_connection=void 0)},e.prototype.set_output=function(t,e,o){if(t){if(!this.output_connection){if(void 0!=this.previous_connection)throw Error("Remove previous connection prior to adding output connection.");this.output_connection=this.make_connection(a.CONNECTION_TYPE.OUTPUT_VALUE,o)}var i=(0,d.is_array)(e)&&e.indexOf("Any")>-1||"Any"===e;e&&!i&&this.output_connection.set_check(e)}else if(this.output_connection){if(this.output_connection.is_connected())throw Error("Must disconnect output value before removing connection.");this.output_connection.dispose(),this.output_connection=void 0}},e.prototype.append_value_input=function(t,e,o,i){var r=this.append_input(a.InputType.VALUE,t,e,o);return"string"==typeof i?r.connection.set_shadow_from_string(i):r.connection.set_shadow_dom(i),r},e.prototype.respawn_all_shadows=function(){var t,e;null!=(t=this.previous_connection)&&t.respawn_shadow(),null!=(e=this.next_connection)&&e.respawn_shadow(),this.inputList.forEach(function(t){var e;null!=(e=t.connection)&&e.respawn_shadow()})},e.prototype.append_statement_input=function(t,e,o){return this.append_input(a.InputType.STATEMENT,t,e,o)},e.prototype.append_dummy_input=function(t,e){return this.append_input(a.InputType.DUMMY,t||"",e)},e.prototype.append_shadow_input=function(t,e,o){return this.append_shadow(a.InputType.VALUE,t,e,(0,l.gen_uid)(),o)},e.prototype.append_math_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.math,e)},e.prototype.append_logic_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.logic,e)},e.prototype.append_text_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.text,e)},e.prototype.append_multiline_text_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.multiline_text,e)},e.prototype.append_default_value_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.default_value,e)},e.prototype.append_shadow_input_json=function(t,e,o,i){var r={text:'<shadow type="text"><field name="TEXT">'+(o=void 0==o?"":o)+"</field></shadow>",math:'<shadow type="math_number"><field name="NUM">'+o+"</field></shadow>",bool:'<empty type="logic_empty"><field name="BOOL"></field></empty>'};return this.append_shadow(a.InputType.VALUE,t,r[e],void 0,i)},e.prototype.append_input=function(t,e,o,i){var r=t===a.InputType.DUMMY?void 0:this.make_connection(t,i),s=this.input_factory({type:t,name:e,block:this,connection:r});return void 0===o?this.inputList.push(s):(o="number"==typeof o?o:this.get_input_index(o),this.inputList.splice(o,0,s)),s},e.prototype.get_descendants=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);for(var o=[this],i=this.get_children(t),r=0;r<i.length;r++){var s=i[r];e&&s.is_shadow()||o.push.apply(o,s.get_descendants(t,e))}return o},e.prototype.get_descendant_ids=function(){for(var t=[this.id],e=this.get_descendants(),o=0;o<e.length;o++){var i=e[o];t[o]=i.id}return t},e.prototype.get_nested_block=function(){for(var t=[],e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(!(o.name in _.SPECIAL_CONNECTION_INPUT_NAME)&&o.connection&&o.connection.type===a.CONNECTION_TYPE.INPUT_VALUE){var i=o.connection.targetBlock();i&&t.push(i)}}return t},e.prototype.get_all_nested_blocks=function(){for(var t=[this],e=this.get_nested_block(),o=0;o<e.length;o++){var i=e[o];t.push.apply(t,i.get_all_nested_blocks())}return t},e.prototype.get_next_block=function(){return this.next_connection&&this.next_connection.targetBlock()},e.prototype.get_full_next_block=function(){var t=this.get_full_next_connection();return t&&t.targetBlock()},e.prototype.get_field=function(t){for(var e=0;e<this.inputList.length;e++)for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++){var r=o.fieldRow[i];if(r.name===t)return r}},e.prototype.get_field_icon=function(){for(var t=0;t<this.inputList.length;t++)for(var e=this.inputList[t],o=0;o<e.fieldRow.length;o++){var i=e.fieldRow[o];if("FieldIcon"===i.field_type)return i}},e.prototype.set_tooltip=function(t){this.tooltip=t},e.prototype.new_field_text_input_from_json=function(t){var e=this.utils.replace_message_references(t.text||""),o=this.field_text_input_factory({text:e,opt_validator:t.validator});return"boolean"==typeof t.spellcheck&&o.set_spell_check(t.spellcheck),o},e.prototype.parse_field_image_param_from_json=function(t){return{src:this.utils.replace_message_references(t.src),width:Number(this.utils.replace_message_references(""+t.width)),height:Number(this.utils.replace_message_references(""+t.height)),alt:this.utils.replace_message_references(t.alt||""),callback:"field_button"===t.type?t.callback:void 0,circle:"field_button"===t.type?t.circle:void 0}},e.prototype.mixin=function(t,e){if(!e){var o=[];for(var i in t)void 0!=this[i]&&o.push(i);if(o.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(o))}Object.assign(this,t)},e.prototype.move_input_before=function(t,e){if(t!=e){for(var o=-1,i=e?-1:this.inputList.length,r=0;r<this.inputList.length;r++){var s=this.inputList[r];if(s.name==t){if(o=r,-1!=i)break}else if(e&&s.name==e&&(i=r,-1!=o))break}-1==o&&console.warn("Named input "+t+" not found."),-1==i&&console.warn("Reference input "+i+" not found."),this.move_numbered_input_before(o,i)}},e.prototype.to_string=function(t,e){void 0===e&&(e="...");var o=[],i=this.get_input(_.COLLAPSED_INPUT_NAME);if(i&&this.collapsed_)return i.fieldRow[0].get_text();for(var r=0;r<this.inputList.length;r++){for(var s,a=this.inputList[r],c=0;c<a.fieldRow.length;c++){var l=a.fieldRow[c];(0,d.is_field_dropdown)(l)&&!l.get_value()?o.push(e):o.push(l.get_text())}a.connection&&((s=a.connection.targetBlock())?o.push(s.to_string(void 0,e)):o.push(e))}"start_on_click"===this.type&&(s=this.get_next_block())&&o.push(s.to_string(void 0,e));var h=o.join(" ").trim()||" ";return t&&(h=""+h.substring(0,t-3)+e),h},Object.defineProperty(e.prototype,"use_drag_surface",{get:function(){var t=this.workspace.current_gesture_;return!(t&&t.is_start_from_flyout())&&this.workspace.degrade_translate?this.workspace.blockDB_.size<this.workspace.degrade_translate:!!this.workspace.get_block_drag_surface()},enumerable:!1,configurable:!0}),e.prototype.move_by=function(t){this.events.is_enabled()&&!this.is_shadow()&&(e=this.move_event_factory({block:this}));var e,o=r.vec2.create();this.is_shadow()||(o=this.get_relative_to_surface_xy()),this.translate(r.vec2.add(o,o,t)),this.move_connections(t),e&&e.record_new(),this.rendered&&this.workspace.resize_contents(),e&&this.events.fire(e)},e.prototype.append_shadow=function(t,e,o,i,r){this.rendered,this.events.disable();var s=this.make_connection(t),a=this.input_factory({type:t,name:e,block:this,connection:s}),_=this.utils.string_to_dom(o);s.set_shadow_dom(_);var l=this.xml.dom_to_block_headless(_,this.workspace,i);if(l.output_connection?s.connect(l.output_connection):l.previous_connection?s.connect(l.previous_connection):(0,c.fail)("Child block does not have output or previous statement."),void 0===r?this.inputList.push(a):(r="number"==typeof r?r:this.get_input_index(r),this.inputList.splice(r,0,a)),!this.is_insertion_marker()&&this.rendered)for(var h=this.get_descendants(),d=0;d<h.length;d++)h[d].is_insertion_marker()||(h[d].init_svg(),h[d].render(!1));return this.update_disabled(),this.workspace.resize_contents(),this.events.enable(),a},e.prototype.move_connections=function(t){for(var e=this.get_connections(!0),o=0;o<e.length;o++)e[o].move_by(t);var i=this.get_icons();for(o=0;o<i.length;o++)i[o].reposition();for(o=0;o<this.child_blocks.length;o++)this.child_blocks[o].move_connections(t)},e.prototype.dispose=function(t,e){if(null!=(o=this.parent_group)&&o.dispose(),this.workspace){this.utils.start_text_cache();var o,i,r,s=this.workspace;this.runtime_data.selected===this&&(this.unselect(),this.workspace.cancel_current_gesture()),this.context_menu.current_block==this&&this.context_menu.hide(),e&&this.rendered&&(this.unplug(t),this.block_animations.dispose_ui_effect(this)),this.rendered=!1,this.onchange&&this.workspace.remove_change_listener(this.onchange),this.unplug(t),this.events.is_enabled()&&(r=this.delete_event_factory({block:this})),this.events.disable();try{for(var a=this.get_icons(),_=0;_<a.length;_++)a[_].dispose()}finally{this.events.enable()}this.events.disable();try{for(this.workspace&&(this.workspace.remove_top_block(this),this.workspace.blockDB_.delete(this.id),this.workspace=void 0),this.runtime_data.selected==this&&(this.runtime_data.selected=void 0),_=this.child_blocks.length-1;_>=0;_--)this.child_blocks[_].dispose(!1);for(_=0;_<this.inputList.length;_++)this.inputList[_].dispose();this.inputList.length=0;var c=this.get_connections(!0);for(_=0;_<c.length;_++){var l=c[_];l.is_connected()&&l.disconnect(),c[_].dispose()}}finally{this.events.enable()}(null==(i=this.Blink.tooltip)?void 0:i.get_element())===this.svg_path&&this.Blink.tooltip.hide(),this.is_shadow()||this.is_insertion_marker()||s.resize_contents(),(0,h.remove_children)(this.svg_group),delete this.svg_path,(0,h.remove_node)(this.svg_group),this.utils.stop_text_cache(),r&&this.events.fire(r)}},e.prototype.detach=function(){if(!this.workspace)throw Error("Trying to detach a block without workspace.");this.events.disable();try{for(var t=this.get_icons(),e=0;e<t.length;e++)t[e].dispose();for(this.onchange&&this.workspace.remove_change_listener(this.onchange),this.workspace.blockDB_.delete(this.id),this.workspace.get_top_blocks(!1).includes(this)&&(this.workspace.remove_top_block(this),this.workspace=void 0,this.svg_group&&(0,h.remove_node)(this.svg_group)),e=this.child_blocks.length-1;e>=0;e--)this.child_blocks[e].detach()}finally{this.events.enable()}},e.prototype.retach=function(t){t.add_top_block(this),this.set_workspace(t),this.init_svg();for(var e=this.get_descendants(),o=e.length-1;o>=0;o--){t.blockDB_.set(e[o].id,e[o]);var i=e[o].get_relative_to_surface_xy();e[o].move_by(r.vec2.negate(i,i))}},e.prototype.make_connection=function(t,e){return this.connection_factory({source:this,type:t,context:e})},e.prototype.show_context_menu=function(t){var e=this;if(!this.workspace.get_options().readOnly&&this.context_menu&&this.is_deletable()&&this.is_movable()&&!this.is_in_flyout){var o=[];this.context_menu_options_setting.forEach(function(t){if("number"==typeof t)switch(t){case a.BlockOptionType.COPY:return e.options_add_copy(o);case a.BlockOptionType.COPY_AND_PASTE:return e.options_add_duplicate(o);case a.BlockOptionType.ADD_COMMENT:return e.options_add_comments(o);case a.BlockOptionType.COLLAPSE:return e.options_add_collapse(o);case a.BlockOptionType.DELETE:return e.options_add_delete_blocks(o);case a.BlockOptionType.SET_GROUP:return void(e.workspace.options.block_group&&e.options_add_set_blocks_group(o));case a.BlockOptionType.VISIBILITY_CHANGE:return e.add_visibility_change_option(o);default:return console.warn("Undefined block menu option: "+t)}var i=t(e);i&&o.push(i)}),this.context_menu.current_block=this,this.context_menu.show(t,{source:"block",options:o},this.RTL)}},e.prototype.options_add_copy=function(t){var e=this,o={text:this.Msg.DUPLICATE_BLOCK,name:"copy",area:"block",enabled:!0,callback:function(){e.runtime_data.clipboard.copy(e)}};this.get_descendants().length>this.workspace.remaining_capacity()&&(o.enabled=!1),t.push(o)},e.prototype.options_add_duplicate=function(t){var e=this;t.push({text:this.Msg.COPY_AND_PASTE,name:"copy_and_paste",enabled:!0,callback:function(){e.runtime_data.clipboard.duplicate(e)}})},e.prototype.options_add_comments=function(t){var e,o=this;this.is_editable()&&!this.is_collapsed()&&this.workspace.get_options().comments&&"block_group"!==this.element_type&&(e=this.comment?{enabled:!p.is.ie(),text:this.Msg.REMOVE_COMMENT,name:"remove_comment",callback:function(){o.comment&&o.set_comment_text(void 0)}}:{enabled:!p.is.ie(),text:this.Msg.ADD_COMMENT,name:"add_comment",callback:function(){return(0,i.__awaiter)(o,void 0,void 0,function(){var t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return"simplified"!==this.workspace.get_options().comment_type?[3,2]:[4,this.workspace.show_external_comment_editor("")];case 1:return void 0!=(t=e.sent())&&(this.set_comment_text(t),(0,c.assert)(this.comment),this.comment.init_svg(),this.comment.set_expanded(!0)),[2];case 2:return this.set_comment_text(""),(0,c.assert)(this.comment),this.comment.init_svg(),this.comment.focus(),[2]}})})}},t.push(e))},e.prototype.options_add_collapse=function(t){var e=this;if(this.workspace.get_options().collapse)if(this.is_collapsed()){var o={text:this.Msg.EXPAND_BLOCK,name:"expand",enabled:!0,callback:function(){e.set_collapsed(!1)}};t.push(o)}else{var i={enabled:!0,text:this.Msg.COLLAPSE_BLOCK,name:"collapse",callback:function(){e.set_collapsed(!0)}};t.push(i)}},e.prototype.options_add_delete_blocks=function(t){var e=this,o={text:this.Msg.DELETE_BLOCK,name:"delete",area:"block",enabled:!0,callback:function(){var t=e.events.get_group();e.events.set_group(t||!0),e.dispose(!0,!0),e.events.set_group(t)}};t.push(o)},e.prototype.options_add_set_blocks_group=function(t){var e=this,o={text:this.utils.replace_message_references("%{BKY_BLOCK_GROUP}"),name:"block_group",area:"block",enabled:!0,callback:function(){e.hide_into_group()}};t.push(o)},e.prototype.add_visibility_change_option=function(t){var e=this,o=this.get_root_block().get_visibility()===a.BlockVisibility.VISIBLE;t.push({text:this.utils.replace_message_references("%{BKY_"+(o?"HIDE":"SHOW")+"_BLOCK_STACK}"),name:"change_visibility",enabled:!0,callback:function(){e.set_chunk_visibility(o?a.BlockVisibility.TRANSLUCENT:a.BlockVisibility.VISIBLE),e.update_chunk_visibility()}})},e.prototype.set_comment_text=function(t,e,o){(0,d.is_string)(t)&&(this.comment||(this.comment=this.workspace_comment_factory({workspace:this.workspace,type:this.workspace.options.comment_type,parent_block:this,opt_id:e,position:o})),this.comment.set_text(t)),!(0,d.is_string)(t)&&this.comment&&(this.comment.dispose(),this.comment=void 0)},e.prototype.get_comment_text=function(){if(this.comment){var t=this.comment.get_text();return(0,g.string_trim)(t)}return""},e.prototype.add_hover=function(){this.svg_group.setAttribute("filter","url(#"+v.FILTER.DRAG_SHADOW+")")},e.prototype.remove_hover=function(){this.svg_group.removeAttribute("filter")},e.prototype.unselect=function(){this.runtime_data.selected==this&&(this.runtime_data.selected=void 0,this.remove_select(),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.SELECTED,workspace_id:this.workspace.id,block_id:this.id})))},e.prototype.init_svg=function(){if(void 0==this.svg_group)throw ReferenceError("Cannot init svg to block without svg group.");if(!this._is_insertion_marker){for(var t=0;t<this.inputList.length;t++)this.inputList[t].init();this.warning&&this.warning.create_icon()}this.update_colour(),this.update_movable(),this.init_events();var e=this.get_svg_root(),o=this.workspace.get_canvas();if((void 0==e||void 0==e.parentNode)&&void 0!=o){if(this.is_insertion_marker()&&this.output_connection)return;o.appendChild(this.svg_group)}},e.prototype.init_events=function(){var e=this;if(t.prototype.init_events.call(this),this.svg_path){this.is_in_flyout||this.is_shadow()||!this.is_output_block()||(this.svg_group.addEventListener("mouseover",function(t){var o;t.stopPropagation(),!(0,h.is_inside_shadow)(t.relatedTarget)&&(null==(o=e.output_connection)?void 0:o.is_connected())&&e.svg_group.classList.add("output-block-hover")}),this.svg_group.addEventListener("mouseout",function(t){t.stopPropagation(),(0,h.is_inside_shadow)(t.relatedTarget)||e.svg_group.classList.remove("output-block-hover")})),!this.is_in_flyout&&(this.is_wrap_shape()||this.is_shadow())&&(this.svg_path.addEventListener("mouseover",function(t){t.stopPropagation(),o(!0)}),this.svg_path.addEventListener("mouseout",function(t){t.stopPropagation(),o(!1)}));var o=function(t){var o=e.is_shadow()?e.parent_block:e;if(o&&o.is_wrap_shape()&&o.svg_path){var i=o.get_surround_parent(),r=i&&!i.is_starting_block(),s=o.svg_group.querySelector(".blocklySurroundShadow");if(t&&!s&&!o.workspace.is_dragging()){var a=(0,h.clone_node)(o.svg_path);a.classList.add("blocklySurroundShadow"),o.svg_group.appendChild(a),r||o.svg_path.setAttribute("filter","url(#"+v.FILTER.SURROUND_SHADOW+")")}!t&&s&&(o.svg_group.removeChild(s),o.svg_path.removeAttribute("filter"))}}}},e.prototype.clear_hover_effect=function(){(0,h.remove_class_if_necessary)(this.svg_group,"output-block-hover");var t,e=this.svg_group.querySelector(".blocklySurroundShadow");e&&(0,h.remove_node)(e),null!=(t=this.svg_path)&&t.removeAttribute("filter")},e.prototype.update_movable=function(){t.prototype.update_movable.call(this),this.is_shadow()&&"param_color"!==this.element_type&&(this.svg_group.classList.remove("blocklyDraggable"),this.svg_group.classList.add("blocklyShadow"))},e.prototype.update_disabled=function(){if(!this.svg_group||!this.svg_path)throw ReferenceError("Cannot update disable to block without init.");if(!this.is_insertion_marker()&&!this.prevent_disable_style_change){if(this.disabled||this.get_inherited_disabled())(0,h.add_class_if_necessary)(this.svg_group,"blocklyDisabled"),this.is_shadow()||this.svg_path.setAttribute("fill","url(#"+this.workspace.get_options().disabledPatternId+")"),this.is_starting_block()&&(t=this.get_field_icon())&&t.image_element&&t.image_element.setAttribute("filter","url(#"+v.FILTER.DISABLED_HEAD_ICON+")");else if(this.svg_group.classList.contains("blocklyDisabled")){var t;this.svg_group.classList.remove("blocklyDisabled"),this.is_starting_block()&&(t=this.get_field_icon())&&t.image_element&&t.image_element.removeAttribute("filter"),this.update_colour()}}for(var e=this.get_children(),o=0;o<e.length;o++)e[o].update_disabled()},e.prototype.get_output_shape=function(){return void 0!=this.output_connection&&this.output_connection.get_output_shape()},e.prototype.is_text_shadow=function(){if(!this.is_shadow())return!1;for(var t=0;t<this.inputList.length;t++)for(var e=this.inputList[t],o=0;o<e.fieldRow.length;o++){var i=e.fieldRow[o];if((0,d.is_field_number)(i)||(0,d.is_field_text_input)(i)||"FieldTextDropdown"===i.field_type||"FieldMultilineInput"===i.field_type||"FieldDefaultValue"===i.field_type)return!0}return!1},e.prototype.get_relative_to_surface_xy=function(){var t,e,o=this.use_drag_surface?null==(t=this.workspace.get_block_drag_surface())?void 0:t.get_group():void 0,i=this.get_svg_root();if(void 0==i)return r.vec2.create();var s=r.vec2.create();do{if(r.vec2.add(s,s,this.utils.get_relative_xy(i)),this.use_drag_surface&&(null==(e=this.workspace.get_block_drag_surface())?void 0:e.get_current_block())==i){var a=this.workspace.get_block_drag_surface().get_surface_translation();r.vec2.add(s,s,[a[0],a[1]])}i=i.parentNode}while(i&&i!=this.workspace.get_canvas()&&i!=o);return s},e.prototype.get_relative_to_injection_div_xy=function(){var t=this.get_svg_root();return this.utils.get_injection_div_xy(t)},e.prototype.get_icons=function(){var t=[];return this.comment&&t.push(this.comment),this.warning&&t.push(this.warning),t},e.prototype.set_dragging=function(t){if(void 0!=this.svg_group){var e=this.svg_group;t?(e.translate_="",e.skew_="",this.runtime_data.dragging_connections=this.runtime_data.dragging_connections.concat(this.get_connections(!0)),(0,h.add_class)(e,"blocklyDragging")):(this.runtime_data.dragging_connections=[],(0,h.remove_class)(e,"blocklyDragging"));for(var o=0;o<this.child_blocks.length;o++)this.child_blocks[o].set_dragging(t)}else console.warn("Cannot set delete style for block without init.")},e.prototype.snap_to_grid=function(){if(this.workspace&&!(this.workspace.is_dragging()||this.workspace.current_gesture_&&this.workspace.current_gesture_.has_started)&&!this.get_parent()&&!this.is_in_flyout){var t=this.workspace.get_grid();if(t&&"string"!=typeof t&&t.should_snap()){var e=t.get_spacing(),o=e/2,i=this.get_relative_to_surface_xy();r.vec2.round(i,[Math.round((i[0]-o)/e)*e+o-i[0],Math.round((i[1]-o)/e)*e+o-i[1]]),(0!=i[0]||0!=i[1])&&this.move_by(i)}}},e.prototype.schedule_snap_and_bump=function(){var t=this,e=this,o=this.events.get_group();window.setTimeout(function(){t.events.get_group()&&t.events.get_group()!==o||(t.events.set_group(o),e.snap_to_grid(),t.events.set_group(!1))},this.theme.blink_params.BUMP_DELAY/2),window.setTimeout(function(){t.events.get_group()&&t.events.get_group()!==o||(t.events.set_group(o),e.bump_neighbours(),t.events.set_group(!1))},this.theme.blink_params.BUMP_DELAY)},e.prototype.set_insertion_marker=function(t){if(this._is_insertion_marker=t,this._is_insertion_marker){var e=this.workspace.get_options().connection_effect,o=e?e.color:this.theme.insertion_marker.COLOR;this.set_colour(o),this.set_opacity(this.theme.insertion_marker.OPACITY),void 0!=this.svg_group&&(0,h.add_class)(this.svg_group,"InsertionMarker")}this.update_colour()},e.prototype.highlight_for_replacement=function(t){if(void 0!=this.svg_path&&void 0!=this.svg_group){if(t){if((0,h.add_class)(this.svg_group,"blocklyReplaceable"),!this.is_shadow()||"param_color"===this.element_type)return this.svg_path.setAttribute("stroke","#ffffff"),void this.svg_path.setAttribute("stroke-width","3");if(this.get_stroke_width()!==this.theme.shadow_style.NO_BORDER){var e=this.parent_block.get_colour();return this.svg_path.setAttribute("stroke",e.toString()),this.svg_path.setAttribute("stroke-width","2"),void this.svg_path.setAttribute("filter","url(#"+v.FILTER.REPLACEMENT_GLOW+")")}return this.svg_path.setAttribute("stroke","#ffffff"),this.svg_path.setAttribute("stroke-width","3"),void(this.is_editable()&&!this.is_text_shadow()&&(this.svg_path.style.fillOpacity="0.1"))}(0,h.remove_class)(this.svg_group,"blocklyReplaceable"),this.svg_path.setAttribute("stroke",this.get_border_colour().toString()),this.svg_path.setAttribute("stroke-width",this.get_stroke_width()),this.svg_path.removeAttribute("filter"),this.svg_path.style.fillOpacity=""}else console.warn("Cannot highlight block without init.")},e.prototype.position_new_block=function(t,e,o){if(e.type==a.CONNECTION_TYPE.NEXT_STATEMENT){var i=r.vec2.create();r.vec2.sub(i,o.get_xy(),e.get_xy()),t.move_by(i)}},e.prototype.bring_to_front=function(){var t=this;if(this.workspace.svg_block_canvas_){var e=this;do{var o=e.get_svg_root();void 0!=o&&void 0!=o.parentNode&&o.parentNode.appendChild(o),e=e.get_parent()}while(e);var i=[];this.get_descendants().forEach(function(t){t.comment&&i.push(t.comment.get_svg_root())}),Array.from(this.workspace.svg_block_canvas_.children).forEach(function(e){i.includes(e)&&t.workspace.svg_block_canvas_.appendChild(e)})}},e.prototype.get_parent=function(){return this.parent_block},e.prototype.set_parent=function(t){if(this.workspace.svg_block_canvas_){var e=this.get_parent();if(t!==e){if(this.utils.start_text_cache(),this.parent_block){if((0,f.remove)(this.parent_block.child_blocks,this),this.previous_connection&&this.previous_connection.is_connected())throw Error("Still connected to previous block.");if(this.output_connection&&this.output_connection.is_connected())throw Error("Still connected to parent block.");this.parent_block=void 0}else this.workspace.remove_top_block(this);this.parent_block=t,t?t.child_blocks.push(this):this.workspace.add_top_block(this),this.utils.stop_text_cache();var o=this.get_svg_root();if(!this.workspace.is_clearing&&o){var i=this.get_relative_to_surface_xy();if(t){t.get_svg_root().appendChild(o);var s=this.get_relative_to_surface_xy();this.move_connections(r.vec2.subtract(s,s,i)),this.is_shadow()&&this.set_colour(this.get_colour(),this.get_border_colour())}else e&&!(this.runtime_data.selected===this&&this.workspace.is_dragging())&&(this.workspace.svg_block_canvas_.appendChild(o),this.translate(i))}}}},e.prototype.select=function(){if(this.is_shadow()&&this.get_parent()){var t=this.get_parent();void 0!=t&&t.select()}else if(this.runtime_data.selected!=this){var e=void 0;if(this.runtime_data.selected){e=this.runtime_data.selected.id,this.events.disable();try{this.runtime_data.selected.unselect()}catch(t){console.error(t)}finally{this.events.enable()}}if(this.runtime_data.selected=this,this.events.is_enabled()){var o=this.ui_event_factory({type:a.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:e,new_value:this.id});this.events.fire(o)}}},e.prototype.move_to_drag_surface=function(){this.clear_hover_effect(),"mobile"!==this.workspace.options.blockly_type&&this.svg_group.setAttribute("filter","url(#"+v.FILTER.DRAG_SHADOW+")"),t.prototype.move_to_drag_surface.call(this)},e.prototype.set_inputs_inline=function(t){var e;this.inputs_inline!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("inline",{block:this,old_value:!!this.inputs_inline,new_value:t})),this.inputs_inline=t),this.rendered&&this.render(),e&&this.events.fire(e)},e.prototype.get_inputs_inline=function(){return void 0==this.inputs_inline||this.inputs_inline},e.prototype.set_glow_stack=function(t){this.is_glowing_stack=t;var e=this.svg_group;if(void 0==e)throw Error("Block may not been init.");this.is_glowing_stack?(0,h.add_class_if_necessary)(e,"blocklyStackGlow"):(0,h.remove_class_if_necessary)(e,"blocklyStackGlow")},e.prototype.set_flash=function(t){this.is_flashing=t,this.block_animations.block_flash_effect(this,this.is_flashing)},e.prototype.add_select=function(){this.set_glow_stack(!0)},e.prototype.remove_select=function(){this.set_glow_stack(!1)},e.prototype.bump_neighbours=function(){if(this.workspace&&!(this.workspace.is_dragging()||this.workspace.current_gesture_&&this.workspace.current_gesture_.is_dragging()&&this.workspace.current_gesture_.has_started)&&this.events.is_record_undo()&&this.workspace.is_resizes_enabled()){var t=this.get_top_parent();if(!t.is_in_flyout&&(!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&!this.is_include_special_input()||!this.is_collapsed()))for(var e=this.get_connections(!1),o=0;o<e.length;o++){var i=e[o],r=i.targetBlock();void 0!=r&&i.is_connected()&&i.is_superior()&&r.bump_neighbours();for(var s=i.neighbours_(this.theme.blink_params.SNAP_RADIUS),a=0;a<s.length;a++){var c=s[a];if(!i.is_connected()||!c.is_connected()){var l=c.get_source_block().get_top_parent();"hidden"!==(null==l?void 0:l.get_visibility())&&l!=t&&(i.is_superior()?c.bump_away_from(i):i.bump_away_from(c))}}}}},e.prototype.get_height_width=function(){var t=this.height,e=this.width;this.is_wrap_shape()&&!this.is_collapsed()&&this.inputList.forEach(function(t){if(t.type===a.InputType.STATEMENT&&t.connection){var o=t.connection.targetBlock();o&&(e=Math.max(e,o.get_height_width().width))}});var o=this.get_full_next_block();if(this.is_collapsed()&&this.is_starting_block()&&(o=void 0),o){var i=o.get_height_width();t+=i.height,e=Math.max(e,i.width)}return{height:t,width:e}},e.prototype.get_blocks_svg_path_width=function(){var t=this.svg_path_width,e=this.get_next_block();return e&&(t=Math.max(t,e.get_blocks_svg_path_width())),t},e.prototype.tab=function(t,e){var o=this.create_tab_list(),i=t&&o.indexOf(t);("number"!=typeof i||-1===i)&&(i=e?-1:o.length);var r=o[e?i+1:i-1];if(r)(0,d.is_func)(r.tab)?r.tab(void 0,e):(0,d.is_func)(r.show_editor)&&r.show_editor();else{var s=this.output_connection&&this.output_connection.targetBlock();if(s)s.tab(this,e);else{var a=e?this.get_next_block():this.get_previous_block();a&&a.tab(this,e)}}},e.prototype.create_tab_list=function(){for(var t=[],e=0;e<this.inputList.length;e++){for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++){var r=o.fieldRow[i];r.show_editor&&t.push(r)}if(o.connection){var s=o.connection.targetBlock();s&&t.push(s)}}return t},e.prototype.remove_input=function(t,e){for(var o=0;o<this.inputList.length;o++){var i=this.inputList[o];if(i.name==t){if(i.connection&&i.connection.is_connected()){i.connection.set_shadow_dom(void 0);var r=i.connection.targetBlock();r.is_shadow()?(this.events.disable(),r.dispose(),this.events.enable()):r.unplug()}return i.dispose(),this.inputList.splice(o,1),void(this.rendered&&this.render())}}e||console.warn("Input "+t+" not found."),this.rendered&&this.render()},e.prototype.move_numbered_input_before=function(t,e){if(t==e)throw Error("Can't move input to itself.");if(t>=this.inputList.length)throw Error("Input index "+t+" out of bounds.");if(e>this.inputList.length)throw Error("Reference input "+e+" out of bounds.");var o=this.inputList[t];this.inputList.splice(t,1),t<e&&e--,this.inputList.splice(e,0,o),this.rendered&&this.render()},e.prototype.is_render_notch=function(){return this.workspace.options.notch},e.prototype.get_visibility=function(){return this.visibility_},e.prototype.set_visibility=function(t){this.visibility_=t},e.prototype.set_chunk_visibility=function(t){var e,o=this.get_top_parent();o.visibility_!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("visibility",{block:o,old_value:o.visibility_,new_value:t})),o.visibility_=t,e&&this.events.fire(e))},e.prototype.update_chunk_visibility=function(){if(!this.parent_block){this.events.disable();var t=this.get_top_parent(),e=t.get_descendants();(0,h.update_visibility_class)(t.svg_group,t.get_visibility());var o="hidden"!==t.get_visibility();t.set_connectable(o),t.comment&&t.comment.update_visibility(),e.forEach(function(e){e!==t&&e.visibility_!==a.BlockVisibility.VISIBLE&&(e.visibility_=a.BlockVisibility.VISIBLE,(0,h.update_visibility_class)(e.svg_group,a.BlockVisibility.VISIBLE),e.comment&&e.comment.update_visibility())}),this.events.enable()}},e.prototype.is_connectable=function(){return this.connectable_},e.prototype.set_connectable=function(t){this.connectable_=t},e.prototype.is_stack_connectable=function(){for(var t,e=this;e;){if(!e.is_connectable())return!1;e=null==(t=e.previous_connection)?void 0:t.targetBlock()}return!0},e.prototype.get_input_index=function(t){var e=this.get_input(t);return e?this.inputList.indexOf(e):-1},e.prototype.mutation_to_string=function(){if(!this.mutationToDom)return"";var t=this.mutationToDom();return t?this.xml.dom_to_text(t):""},e.prototype.string_to_mutation=function(t){if(this.domToMutation)if(t)this.domToMutation(this.xml.text_to_dom(t));else try{this.domToMutation(void 0)}catch(t){}},e.prototype.set_opacity=function(t){this.opacity=t,this.rendered&&this.update_colour()},e.prototype.to_dev_string=function(){var t=this.type?'"'+this.type+'" block':"Block";return this.id&&(t+=' (id="'+this.id+'")'),t},e.prototype.is_rendered=function(){return this.rendered},e.prototype.set_rendered=function(t){this.rendered=t},e.prototype.set_category=function(t){this.category_=t},e.prototype.set_output_shape=function(t){this.output_shape=t},e.prototype.set_help_url=function(t){this.help_url=t},e.prototype.options_add_help=function(t){var e=this,o={enabled:!!((0,d.is_func)(this.help_url)?this.help_url():this.help_url),name:"help",text:this.Msg.HELP,callback:function(){e.show_help()}};t.push(o)},e.prototype.show_help=function(){this.help_url&&window.open(this.help_url)},e.prototype.sort=function(t){var e=this.get_relative_to_surface_xy();this.move_by(r.vec2.sub(e,t,e)),this.snap_to_grid(),r.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])},e.prototype.for_each_descendant_element=function(t,e){var o;if(void 0===e&&(e=!1),t(this),this.comment&&t(this.comment),e){for(s=0;s<this.inputList.length;s++)(r=null==(o=this.inputList[s].connection)?void 0:o.targetBlock())&&r.for_each_descendant_element(t,!0);var i=this.get_next_block();i&&i.for_each_descendant_element(t,!0)}else for(var r,s=0;s<this.child_blocks.length;s++)(r=this.child_blocks[s]).for_each_descendant_element(t,!1)},e.prototype.get_original_colour=function(){return this.colour_},e.prototype.get_border_colour=function(){var t;return this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type?(null==(t=this.parent_block)?void 0:t.get_border_colour())||this.theme.block_color.DEFAULT.border:this.border_colour},e.prototype.get_stroke_width=function(){return this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type?this.is_editable()&&this.is_text_shadow()?this.theme.shadow_style.BORDER:this.theme.shadow_style.NO_BORDER:"1px"},e.prototype.get_colour=function(){if(this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type)return this.is_editable()?this.theme.shadow_style.SHADOW_COLOR:this.theme.shadow_style.EMPTY_COLOR;if((this.disabled||this.get_inherited_disabled())&&!this.prevent_disable_style_change)return this.theme.disabled_color.fill;if(this.layer_colour&&this.is_output_block()&&(null==(t=this.parent_block)?void 0:t.get_colour())===this.colour_)return this.layer_colour;if(!this.is_editable()){var t,e,o=(null==(e=this.get_parent())?void 0:e.get_colour())||this.colour_;return(0,u.darken)(o,.1)}return this.colour_},e.prototype.set_colour_by_key=function(t){var e=t&&this.theme.get_color(t);e&&this.set_colour(e.fill,e.border,e.layer)},e.prototype.set_colour_from_json=function(t){this.set_colour_by_key(t.colour)},e.prototype.set_colour=function(t,e,o){this.colour_="string"==typeof t?new u.Color(t):t,this.border_colour=void 0!=e?"string"==typeof e?new u.Color(e):e:(0,u.darken)(this.colour_,.1),this.layer_colour=void 0!=o?"string"==typeof o?new u.Color(o):o:void 0,this.rendered&&this.update_colour()},e.prototype.update_colour=function(){if(!this.svg_path)throw ReferenceError("Cannot update color without svg path.");this.svg_path.setAttribute("fill",this.get_colour().toString()),this.svg_path.setAttribute("stroke",this.get_border_colour().toString()),this.svg_path.setAttribute("stroke-opacity","1"),this.svg_path.setAttribute("stroke-width",this.get_stroke_width()),this.warning&&this.warning.update_colour()},e.prototype.update_layer_colour=function(){if(!this.disabled&&!this.get_inherited_disabled()&&this.is_output_block()&&this.svg_path){var t=this.get_colour().toString();this.svg_path.getAttribute("fill")!==t&&this.svg_path.setAttribute("fill",t);for(var e=0;e<this.child_blocks.length;e++)this.child_blocks[e].update_layer_colour()}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.context_menu)],e.prototype,"context_menu",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.extensions)],e.prototype,"extensions",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Msg)],e.prototype,"Msg",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.RenderedConnection)],e.prototype,"RenderedConnection",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.registry)],e.prototype,"registry",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldLabel)],e.prototype,"field_label_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldLabelSerializable)],e.prototype,"field_label_serializable_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldColour)],e.prototype,"field_colour_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldDropdown)],e.prototype,"field_dropdown_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldIcon)],e.prototype,"field_icon_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldButton)],e.prototype,"field_button_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.MutationAddButton)],e.prototype,"mutation_add_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.MutationRemoveButton)],e.prototype,"mutation_remove_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldNumber)],e.prototype,"field_number_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldTextDropdown)],e.prototype,"field_text_dropdown_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldTextInput)],e.prototype,"field_text_input_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldDefaultValue)],e.prototype,"field_default_value",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldImage)],e.prototype,"field_image_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldMultilineInput)],e.prototype,"field_multiline_input",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Input)],e.prototype,"input_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.RenderedConnection)],e.prototype,"connection_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.WorkspaceComment)],e.prototype,"workspace_comment_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.BlockGroup)],e.prototype,"block_group_factory",void 0),e}(o(31728).WorkspaceElement)},67517(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CreateEvent=void 0;var i=o(31635),r=o(71519),s=o(35009),a=(0,i.__importStar)(o(48264)),_=o(36963);e.CreateEvent=function(t){function e(e){var o=t.call(this,e.block)||this;o.type=s.BlockEventType.CREATE,o.ids=[],o.is_shadow=!1,o.source=e.source||"other";var i=e.block,r=i.get_workspace();if(void 0!=r&&r.rendered?o._xml=o.xml.workspace_element_to_dom_with_xy(i):o._xml=o.xml.workspace_element_to_dom(i),a.base.is_block_svg(i))o.ids=i.get_descendant_ids(),o.is_shadow=i.is_shadow(),o._element_json=o.json.block_to_json(i);else{if(!a.base.is_workspace_comment(i))throw Error("Trying to fire create event for unsupported workspace element.");o.ids=[i.id],o._element_json={blocks:{},comments:{},connections:{}},o._element_json.comments[i.id]=o.json.comment_to_json(i)}return o}return(0,i.__extends)(e,t),e.prototype.run=function(t){var e=this._get_event_workspace();if(t){var o=a.dom.create_dom("xml");return o.appendChild(this._xml),void this.xml.dom_to_workspace(o,e)}for(var i=0;i<this.ids.length;i++){var r=this.ids[i],s=e.get_element_from_db(r);s?s.dispose(!1,!1):r==this._block_id&&this.is_shadow}},e.prototype.get_element_json=function(){return this._element_json},e.prototype.serialize=function(){if(this._element_json)return{group:this._group,blocks:this._element_json.blocks,comments:this._element_json.comments,connections:this._element_json.connections}},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(13833).BlockEvent)},68546(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=void 0;var i=o(31635),r=o(71519),s=o(35009),a=o(86295);e.ChangeEvent=function(t){function e(e,o){var i=t.call(this,o.block)||this;if(i.type=s.BlockEventType.CHANGE,i.element=e,i._data={block:o.block,name:o.name,old_value:o.old_value,new_value:o.new_value},(0,a.is_block_svg)(o.block)){if(i.is("mutation",i._data)||i.is("change_procedure_param",i._data))return i._new_json=i.json.block_to_json(o.block),i;if(i.is("comment",i._data)&&"string"==typeof i._data.new_value){var r=i._get_event_workspace().workspace_comment_db.get(i._data.new_value);r&&(i._comment_json=i.json.comment_to_json(r))}}return i}return(0,i.__extends)(e,t),e.prototype.is=function(t,e){return this.element===t&&!!e},e.prototype.is_null=function(){return this._data.old_value==this._data.new_value},e.prototype.run=function(t){var e,o,i,r,s,_,c=this._get_event_workspace(),l=c.get_element_from_db(this._block_id);if(l){if((0,a.is_workspace_comment)(l))if(this.is("comment_text",this._data))l.set_text(t?this._data.new_value:this._data.old_value);else if(this.is("comment_color",this._data))l.set_color_theme(t?this._data.new_value:this._data.old_value);else if(this.is("comment_expand",this._data))l.set_expanded(t?this._data.new_value:this._data.old_value);else if(this.is("comment_resize",this._data)){var h=t?this._data.new_value:this._data.old_value;l.set_bubble_size(h[0],h[1])}else console.warn("Unknown change type: "+this.element);else if((0,a.is_block_svg)(l))if(this.is("field",this._data)){var d=this._data,u=d.name,p=d.new_value,f=d.old_value;h=t?p:f,void 0!=u&&(_=l.get_field(String(u)))&&(_.call_validator(h),_.set_value(h,!0))}else if(this.is("field_default_value",this._data)){var g=this._data,v=g.name;p=g.new_value,f=g.old_value,h=t?p:f,void 0!=v&&(_=l.get_field(String(v)))&&(0,a.is_field_default_value)(_)&&_.set_has_been_edited(h)}else if(this.is("comment",this._data)){var b=this._data;switch(p=b.new_value,f=b.old_value,typeof(h=t?p:f)){case"string":l.set_comment_text("",h),l.comment&&(l.comment.set_expanded(!0),l.comment.init_svg());break;case"undefined":l.set_comment_text(void 0);break;default:var m=void 0,y=parseFloat(h.getAttribute("relativeleft_")||""),k=parseFloat(h.getAttribute("relativetop_")||"");isNaN(y)||isNaN(k)||(m={x:y,y:k}),l.set_comment_text("",h.getAttribute("id")||void 0,m),this.xml.parse_comment_attributes(h,l.comment),l.comment&&l.comment.init_svg()}}else if(this.is("collapsed",this._data))l.set_collapsed(t?this._data.new_value:this._data.old_value,!0);else if(this.is("disabled",this._data))l.set_disabled(t?this._data.new_value:this._data.old_value);else if(this.is("inline",this._data))l.set_inputs_inline(t?this._data.new_value:this._data.old_value);else if(this.is("mutation",this._data))f=t?this._data.old_value:this._data.new_value,void 0!==(p=t?this._data.new_value:this._data.old_value)?null!=(e=l.addMutation)&&e.call(l,p,null==(o=this._data.name)?void 0:o.toString()):void 0!==f&&null!=(i=l.removeMutation)&&i.call(l,f,null==(r=this._data.name)?void 0:r.toString());else if(this.is("visibility",this._data))l.set_chunk_visibility(t?this._data.new_value:this._data.old_value),l.update_chunk_visibility();else if(this.is("group_block",this._data)){var w=this._data;if(p=w.new_value,f=w.old_value,h=t?p:f){var E=h[0],T=h[1],x=h[2];l.hide_into_group(T,{id:E,group_stop_at:x})}else null!=(s=l.parent_group)&&s.release()}else{var I=c.get_change_event(this.element);I?I.call(this,t):console.warn("Unknown change type: "+this.element)}}},e.prototype.get_name=function(){return this._data.name},e.prototype.get_new_value=function(){return this._data.new_value},e.prototype.get_old_value=function(){return this._data.old_value},e.prototype.update_new_value=function(t){this._data.new_value=t},e.prototype.serialize=function(){return{id:this._block_id,group:this._group,element:this.element,old_value:this._data.old_value,new_value:this._data.new_value,name:this._data.name}},e.prototype.get_new_comment=function(){return this._comment_json},e.prototype.get_new_json=function(){return this._new_json},(0,i.__decorate)([(0,r.injectable)()],e)}(o(13833).BlockEvent)},81504(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DeleteEvent=void 0;var i=o(31635),r=o(71519),s=o(35009),a=o(36963),_=(0,i.__importStar)(o(48264));e.DeleteEvent=function(t){function e(e){var o=t.call(this,e.block)||this;o.type=s.BlockEventType.DELETE,o.ids=[],o.is_shadow=!1;var i=e.block;if(_.base.is_block_svg(i)&&i.get_parent())return console.error("Connected blocks cannot be deleted."),o;var r=i.get_workspace();return void 0!=r&&r.rendered?o.old_xml=o.xml.workspace_element_to_dom_with_xy(i):o.old_xml=o.xml.workspace_element_to_dom(i),o.ids=[i.id],_.base.is_block_svg(i)&&(o.ids=i.get_descendant_ids(),o.is_shadow=i.is_shadow()),o}return(0,i.__extends)(e,t),e.prototype.run=function(t){var e=this._get_event_workspace();if(t)for(var o=0;o<this.ids.length;o++){var i=this.ids[o];(s=e.get_element_from_db(i))?s.dispose(!1,!1):i!==this._block_id||this.is_shadow||console.warn("Can't delete non-existent block: "+i)}else{var r=this.old_xml.getAttribute("id");if(r){void 0!=(s=e.get_element_from_db(r))&&s.dispose(!1,!1);var s,a=_.dom.create_dom("xml");a.appendChild(this.old_xml),this.xml.dom_to_workspace(a,e)}}},e.prototype.serialize=function(){return{id:this._block_id,all_ids:this.ids,group:this._group}},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(13833).BlockEvent)},20527(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DragAreaChangeEvent=void 0;var i=o(31635),r=o(71519),s=o(35009);e.DragAreaChangeEvent=function(t){function e(e){var o=t.call(this,e.block)||this;return o.type=s.BlockEventType.DRAG_AREA_CHANGE,o._record_undo=!1,o.block=e.block,o.area=e.area,o.is_in=e.is_in,o}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,r.injectable)()],e)}(o(13833).BlockEvent)},44010(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.EndDragEvent=void 0;var i=o(31635),r=o(71519),s=o(35009);e.EndDragEvent=function(t){function e(e){var o=t.call(this,e.block)||this;return o._record_undo=!1,o.type=s.BlockEventType.END_DRAG,o.block=e.block,o._is_outside=e.is_outside,o.mouse_position=e.mouse_position,o._is_from_flyout=e.is_from_flyout,o.redo_stack_before_drag=e.redo_stack_before_drag,o}return(0,i.__extends)(e,t),e.prototype.get_block_xml=function(){return this.xml.workspace_element_to_dom(this.block,!0)},e.prototype.delete_current=function(){this.block.dispose()},e.prototype.cancel_move=function(){var t=this._get_event_workspace();t.undo(),t.set_redo_stack(this.redo_stack_before_drag)},(0,i.__decorate)([(0,r.injectable)()],e)}(o(13833).BlockEvent)},29393(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MoveEvent=void 0;var i=o(31635),r=o(77276),s=o(71519),a=o(35009),_=o(86295);e.MoveEvent=function(t){function e(e){var o=t.call(this,e.block)||this;o.type=a.BlockEventType.MOVE;var i=o._current_location();return o.old_parent_id=i.parent_id,o.old_input_name=i.input_name,o.old_coordinate=i.coordinate,o}return(0,i.__extends)(e,t),e.prototype.get_new_loc=function(){return{parent_id:this.new_parent_id,input_name:this.new_input_name,coordinate:this.new_coordinate}},e.prototype._current_location=function(){var t=this.workspace_db.get(this._workspace_id);if(void 0==t)return console.error("Event has no workspace."),{};var e=t.get_element_from_db(this._block_id);if(void 0==e)return console.error("Event has no block."),{};var o={};if((0,_.is_block_svg)(e)){var i=e.get_parent();if(i){o.parent_id=i.id;var r=i.get_input_with_block(e);r&&(o.input_name=r.name)}else o.coordinate=e.get_relative_to_surface_xy()}else(0,_.is_workspace_comment)(e)&&(o.coordinate=(0,_.clone_deep)(e.get_relative_position()));return o},e.prototype.record_new=function(){var t=this._current_location();this.new_parent_id=t.parent_id,this.new_input_name=t.input_name,this.new_coordinate=t.coordinate},e.prototype.is_null=function(){return this.old_parent_id===this.new_parent_id&&this.old_input_name===this.new_input_name&&(void 0==this.old_coordinate&&void 0==this.new_coordinate||void 0!=this.old_coordinate&&void 0!=this.new_coordinate&&r.vec2.equals(this.old_coordinate,this.new_coordinate))},e.prototype.run=function(t){var e=this,o=this._get_event_workspace(),i=o.get_element_from_db(this._block_id);if(void 0!=i){!function(){if((0,_.is_block_svg)(i)){var r=t?e.new_parent_id:e.old_parent_id;if(r){var s,c=o.get_block_by_id(r);if(!c)throw Error("Trying to re-connect to non-existent block. Event: "+e);var l=i.output_connection||i.previous_connection;if(!l)throw Error("\uD83D\uDD28");var h=t?e.new_input_name:e.old_input_name;if(h){var d=c.get_input(h);s=d&&d.connection}else l.type===a.CONNECTION_TYPE.PREVIOUS_STATEMENT&&(s=c.next_connection);if(void 0!=s)return i.unplug(),l.connect(s,!0);console.warn("Can't connect to non-existent input: "+h+", so dispose this blockConnection"),l&&(e.events.disable(),l.source_block.dispose(),e.events.enable())}else i.unplug()}}();var s,c=t?(0,_.clone_deep)(e.new_coordinate):(0,_.clone_deep)(e.old_coordinate);if(c){var l=i.get_relative_to_surface_xy();if((0,_.is_workspace_comment)(i)){var h=null==(s=i.get_parent_block())?void 0:s.get_relative_to_surface_xy();h&&r.vec2.add(c,h,c)}i.move_by(r.vec2.sub(l,c,l))}}else t||console.warn("Can't move non-existent block: "+this._block_id)},e.prototype.set_old_coord=function(t){this.old_coordinate=t},e.prototype.get_old_loc=function(){return{parent_id:this.old_parent_id,input_name:this.old_input_name,coordinate:this.old_coordinate}},e.prototype.serialize=function(){var t=this.old_coordinate?[this.old_coordinate[0],this.old_coordinate[1]]:void 0,e=this.new_coordinate?[this.new_coordinate[0],this.new_coordinate[1]]:void 0;return{id:this._block_id,group:this._group,old_parent_id:this.old_parent_id,old_input_name:this.old_input_name,old_coordinate:t,new_parent_id:this.new_parent_id,new_input_name:this.new_input_name,new_coordinate:e}},e.prototype.deserialize=function(t){this._block_id=t.id,this.old_parent_id=t.old_parent_id,this.old_input_name=t.old_input_name,this.old_coordinate=t.old_coordinate&&r.vec2.fromValues(t.old_coordinate[0],t.old_coordinate[1]),this.new_parent_id=t.new_parent_id,this.new_input_name=t.new_input_name,this.new_coordinate=t.new_coordinate&&r.vec2.fromValues(t.new_coordinate[0],t.new_coordinate[1])},e.prototype.update_new_loc=function(t){this.new_parent_id=t.parent_id,this.new_input_name=t.input_name,this.new_coordinate=t.coordinate},(0,i.__decorate)([(0,s.injectable)()],e)}(o(13833).BlockEvent)},46796(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StartDragEvent=void 0;var i=o(31635),r=o(71519),s=o(35009);e.StartDragEvent=function(t){function e(e){var o=t.call(this,e.block)||this;return o.type=s.BlockEventType.START_DRAG,o._record_undo=!1,o.block=e.block,o._is_from_flyout=e.is_from_flyout,o}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,r.injectable)()],e)}(o(13833).BlockEvent)},13833(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockEvent=void 0;var i=o(31635);e.BlockEvent=function(t){function e(e){var o=t.call(this)||this,i=e.get_workspace();return o._block_id=e.id,void 0==i?console.error("Event block workspace not found."):o._workspace_id=i.id,o}return(0,i.__extends)(e,t),e.prototype.get_block_id=function(){return this._block_id},e}(o(96171).BaseEvent)},36074(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.StartDragEvent=e.MoveEvent=e.EndDragEvent=e.DragAreaChangeEvent=e.DeleteEvent=e.ChangeEvent=e.CreateEvent=e.BlockEvent=void 0;var i=o(13833);Object.defineProperty(e,"BlockEvent",{enumerable:!0,get:function(){return i.BlockEvent}});var r=o(67517);Object.defineProperty(e,"CreateEvent",{enumerable:!0,get:function(){return r.CreateEvent}});var s=o(68546);Object.defineProperty(e,"ChangeEvent",{enumerable:!0,get:function(){return s.ChangeEvent}});var a=o(81504);Object.defineProperty(e,"DeleteEvent",{enumerable:!0,get:function(){return a.DeleteEvent}});var _=o(20527);Object.defineProperty(e,"DragAreaChangeEvent",{enumerable:!0,get:function(){return _.DragAreaChangeEvent}});var c=o(44010);Object.defineProperty(e,"EndDragEvent",{enumerable:!0,get:function(){return c.EndDragEvent}});var l=o(29393);Object.defineProperty(e,"MoveEvent",{enumerable:!0,get:function(){return l.MoveEvent}});var h=o(46796);Object.defineProperty(e,"StartDragEvent",{enumerable:!0,get:function(){return h.StartDragEvent}})},31035(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UIEvent=void 0;var i=o(31635),r=o(71519);e.UIEvent=function(t){function e(e){var o=t.call(this)||this;return o._record_undo=!1,o.type=e.type,o._workspace_id=e.workspace_id,o._old_value=e.old_value,o._new_value=e.new_value,o._block_id=e.block_id,o}return(0,i.__extends)(e,t),e.prototype.get_new_value=function(){return this._new_value},e.prototype.get_old_value=function(){return this._old_value},(0,i.__decorate)([(0,r.injectable)()],e)}(o(96171).BaseEvent)},91612(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenuOptionEvent=void 0;var i=o(31635),r=o(71519),s=o(35009);e.ContextMenuOptionEvent=function(t){function e(e){var o=t.call(this)||this;return o.type=s.BlockEventType.CONTEXT_MENU_OPTION,o._record_undo=!1,o._workspace_id=e.workspace_id,o._option_name=e.option_name,o._source=e.source,o}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,r.injectable)()],e)}(o(96171).BaseEvent)},21609(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEvent=void 0;var i=o(31635),r=o(71519),s=o(71262),a=o(36963),_=o(35009),c=o(44015);e.GroupEvent=function(t){function e(e){var o=t.call(this)||this;o._workspace_id=o.Blink.mainWorkspace.id||"",o._record_undo=!1;var i=e.type,r=e.group;if(o.type=i,o._group=r,i===_.GroupEventType.GroupEnd)for(var s=o._get_event_workspace().get_undo_stack().filter(function(t){return t._group===o._group}),a=s.length-1;a>=0;a--){var c=s[a];(c.type===_.BlockEventType.MOVE||c.type===_.BlockEventType.CREATE&&"other"===c.source||c.type===_.BlockEventType.CHANGE&&"change_procedure_param"===c.element)&&o.process_context_blocks(c)}return o}return(0,i.__extends)(e,t),e.prototype.process_context_blocks=function(t){var e=this,o=this._get_event_workspace().get_block_by_id(t.get_block_id());if(o){var i=new Set,r=new Set;o.get_descendants(!1,!0).forEach(function(t){if(t.type!==s.PROCEDURE_BLOCK_TYPES.CALL_NORETURN&&t.type!==s.PROCEDURE_BLOCK_TYPES.CALL_RETURN&&(0,c.has_context)(t)){var e=(0,c.is_valid_context)(t);e||t.disabled||i.add(t),e&&t.disabled&&r.add(t)}});var a=function(t,o){var i=e.events.is_record_undo();e.events.set_record_undo(!0),e.events.disable();var r=e.events.get_group();e.events.set_group(e._group),e.events.enable(),t.set_disabled(o),e.events.disable(),e.events.set_group(r),e.events.enable(),e.events.set_record_undo(i)};i.forEach(function(t){a(t,!0)}),r.forEach(function(t){a(t,!1)})}},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(96171).BaseEvent)},96171(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseEvent=void 0;var i=o(31635),r=o(36963);e.BaseEvent=function(){function t(){this._workspace_id="",this._group=this.events.get_group(),this._record_undo=this.events.is_record_undo()}return t.prototype.is_null=function(){return!1},t.prototype._get_event_workspace=function(){var t=this.workspace_db.get(this._workspace_id);if(void 0==t)throw Error("Workspace is undefined. Event must have been generated from real Blockly events.");return t},t.prototype.is_record_undo=function(){return this._record_undo},t.prototype.set_record_undo=function(t){this._record_undo=t},t.prototype.get_workspace_id=function(){return this._workspace_id},t.prototype.set_workspace_id=function(t){this._workspace_id=t},t.prototype.get_block_id=function(){return this._block_id},t.prototype.serialize=function(){},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.json)],t.prototype,"json",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),t}()},38509(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEvent=e.ContextMenuOptionEvent=e.BaseEvent=e.UIEvent=void 0;var i=o(31035);Object.defineProperty(e,"UIEvent",{enumerable:!0,get:function(){return i.UIEvent}});var r=o(96171);Object.defineProperty(e,"BaseEvent",{enumerable:!0,get:function(){return r.BaseEvent}});var s=o(91612);Object.defineProperty(e,"ContextMenuOptionEvent",{enumerable:!0,get:function(){return s.ContextMenuOptionEvent}});var a=o(21609);Object.defineProperty(e,"GroupEvent",{enumerable:!0,get:function(){return a.GroupEvent}})},22418(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlyoutButton=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(25507);e.FlyoutButton=function(){function t(t){var e=this;this.position_=s.vec2.fromValues(0,0),this.svg_group=void 0,this.width=0,this.width_ratio=void 0,this.height=0,this.margin_right=0,this.on_mouse_up=function(t){var o,i=null==(o=e.target_workspace)?void 0:o.get_gesture(t);i&&i.cancel(),e.callback_&&e.callback_(e,t)},this.workspace_=t.workspace,this.target_workspace=t.target_workspace,this.text_=t.xml.getAttribute("text")||"",this.position_=s.vec2.fromValues(0,0),this.is_label=t.is_label,this.flyout_padding_left=t.flyout_padding_left,this.flyout_padding_right=t.flyout_padding_right,this.callback_=void 0;var o=t.xml,i=t.target_workspace,r=o.getAttribute("callbackkey");this.is_label&&r&&console.warn("Labels should not have callbacks. Label text: "+this.text_),this.is_label||(r&&i.get_button_callback(r)?this.callback_=i.get_button_callback(r):console.warn("Buttons should have callbacks. Button text: "+this.text_)),this.relation=o.getAttribute("relation")||void 0,this.css_class=o.getAttribute("web-class")||void 0,this.default_display=o.getAttribute("display")||void 0,this.type=o.getAttribute("type")||void 0,this.height=parseInt(o.getAttribute("height")||"0")||this.height;var a=o.getAttribute("width");if(a){var _=a.match(/[0-9]+%/);_&&_[0]?this.width_ratio=parseInt(_[0])/100:this.width=parseInt(a)||0}"line"===this.type&&(this.width_ratio=this.width_ratio||1,this.height=this.height||11);var c=function(t){if("string"==typeof t){var e=parseFloat(t);return isNaN(e)?void 0:e}};this.position=o.getAttribute("position")||"relative",this.left=c(o.getAttribute("left")),this.top=c(o.getAttribute("top")),this.right=c(o.getAttribute("right")),this.bottom=c(o.getAttribute("bottom")),this.align=o.getAttribute("align")||void 0,this.inline=o.getAttribute("inline")||void 0,this.margin_right=c(o.getAttribute("margin_right"))||0,this.img_url=o.getAttribute("img_url")||void 0,this.img_width=c(o.getAttribute("img_width"))||0,this.img_height=c(o.getAttribute("img_height"))||0,this.img_margin_right=c(o.getAttribute("img_margin_right"))||0,this.vertical_padding=c(o.getAttribute("vertical_padding"))||0,this.option=o.getAttribute("option")||void 0,this.title=o.getAttribute("title")||void 0}return t.prototype.get_svg_group=function(){return this.svg_group},t.prototype.get_target_workspace=function(){return this.target_workspace},t.prototype.show=function(t){void 0===t&&(t=!0),this.svg_group&&(this.svg_group.setAttribute("display",t?"block":"none"),t&&this.update_callback&&this.update_callback(this))},t.prototype.move_to=function(t,e){if(this.workspace_){var o="fixed"===this.position?this.workspace_.get_scale():1;this.position_=s.vec2.fromValues(t*o,e*o),this.update_transform()}},t.prototype.update_transform=function(){if(this.svg_group&&this.workspace_){var t="fixed"===this.position?", scale("+this.workspace_.get_scale()+")":"";this.svg_group.setAttribute("transform","translate("+this.position_[0]+", "+this.position_[1]+")"+t)}},t.prototype.detach=function(){this.svg_group&&(0,_.remove_node)(this.svg_group),this.workspace_=void 0},t.prototype.retach=function(t){this.workspace_=t,this.svg_group&&this.workspace_.svg_block_canvas_&&this.workspace_.svg_block_canvas_.appendChild(this.svg_group)},t.prototype.dispose=function(){this.on_mouse_up_wrapper&&this.event.unbind_event(this.on_mouse_up_wrapper),this.svg_group&&((0,_.remove_node)(this.svg_group),this.svg_group=void 0),delete this.workspace_,delete this.target_workspace},t.prototype.create_dom=function(t){var e=this,o=function(){e.svg_group&&(e.is_label||e.svg_group.classList.add("blocklyFlyoutClickable"),e.update_transform(),e.on_mouse_up_wrapper=e.event.bind_event_with_checks(e.svg_group,"mouseup",e,e.on_mouse_up),(e.width<=0&&!e.width_ratio||e.height<=0)&&console.warn("[FlyoutButton] A button without width or height declaration may cause layout error. ","Please indicate both width and height in the xml of button type: ["+e.type+"]."))},i=null==(u=this.target_workspace)?void 0:u.get_custom_flyout_button(this.type||"");if(i){var r=i(t);if(r instanceof Element)this.svg_group=r;else{var s=r.svg_group,a=r.update_callback;this.svg_group=s,this.update_callback=a}return null!=(f=null==(p=this.workspace_)?void 0:p.svg_block_canvas_)&&f.appendChild(this.svg_group),this.svg_group.cachedWidth_&&(this.width=this.svg_group.cachedWidth_),this.svg_group.cachedHeight_&&(this.height=this.svg_group.cachedHeight_),o(),this.svg_group}if("line"===this.type){if("number"!=typeof t)throw Error("Flyout line should be draw when reflow. ");this.svg_group=(0,_.create_svg_element)("g",{class:"blocklyLine"}),null!=(v=null==(g=this.workspace_)?void 0:g.svg_block_canvas_)&&v.appendChild(this.svg_group);var c=(0,_.create_svg_element)("rect",{rx:0,ry:0,height:0,width:0},this.svg_group);this.width=t-this.flyout_padding_left-this.flyout_padding_right,c.setAttribute("y","5"),c.setAttribute("width",""+this.width),c.setAttribute("height","1")}else{"normal"!==this.type&&console.warn("Flyout button type ["+this.type+"] is not defined. ","Rendering "+this+" as a normal button. ");var l=this.height||32,h=this.vertical_padding;this.svg_group=(0,_.create_svg_element)("g",{class:this.css_class}),null!=(m=null==(b=this.workspace_)?void 0:b.svg_block_canvas_)&&m.appendChild(this.svg_group);var d=(0,_.create_svg_element)("rect",{class:"flyoutButtonNormalRect",rx:4,ry:4},this.svg_group);if(this.img_url&&((0,_.create_svg_element)("image",{class:"flyoutButtonNormalIcon",height:this.img_height,width:this.img_width,x:h,y:(l-this.img_height)/2},this.svg_group).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.img_url),h+=this.img_width+this.img_margin_right),this.text_){(y=(0,_.create_svg_element)("text",{class:"blocklyText","dominant-baseline":"middle",x:h,y:l/2+1},this.svg_group)).textContent=this.text_;var u,p,f,g,v,b,m,y,k=0;try{k=y.getComputedTextLength()}catch(t){k=8*this.text_.length}h+=k}h+=this.vertical_padding,d.setAttribute("width",""+h),d.setAttribute("height",""+l),this.width=h,this.height=l,this.option&&((y=(0,_.create_svg_element)("text",{class:"blocklyButtonTip","dominant-baseline":"middle",x:h+3,y:l/2+1},this.svg_group)).textContent="* "+this.option),this.title&&((0,_.create_svg_element)("title",{},this.svg_group).textContent=this.title)}return o(),this.svg_group},t.MARGIN=5,(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],t.prototype,"event",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},2189(t,e,o){"use strict";e.Flyout=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(35009),c=o(25507);e.Flyout=function(){function t(t){var e=this;this.listeners_=[],this.containerVisible_=!0,this.permanently_disabled_=[],this.reflow_wrapper=void 0,this.buttons_=[],this.cached_blocks=new Map,this.cached_buttons=new Map,this.default_button_gap=12,this.horizontalLayout_=!1,this.is_visible_=!1,this.width_=0,this.height_=0,this.event_wrappers_=[],this.drag_angle_range_=50,this.auto_close=!0,this.bind_transition_end_event=function(){e.svg_group&&e.targetWorkspace_&&(e.transition_end_wrapper=e.events.bind_event_with_checks(e.svg_group,"transitionend",e,function(t){if(e.targetWorkspace_&&"transform"===t.propertyName&&e.events.is_enabled()){var o=e.ui_event_factory({type:_.UIEventType.FLYOUT_SHOW,workspace_id:e.targetWorkspace_.id,old_value:!e.is_visible_,new_value:e.is_visible_});e.events.fire(o)}}))},t.get_metrics=this.get_metrics.bind(this),t.set_metrics=this.set_metrics.bind(this),t.has_categories=!1,t.in_flyout=!0,this.workspace_=this.workspace_factory(t),this.workspace_.set_scale(t.zoomOptions.startScale),this.RTL=!!t.RTL,this.toolboxPosition_=t.toolboxPosition,this.flyout_corner_radius=t.flyout.corner_radius||this.theme.renderer.FLYOUT_CORNER_RADIUS,this.padding_top=t.flyout.padding.top,this.padding_bottom=t.flyout.padding.bottom,this.padding_left=t.flyout.padding.left,this.padding_right=t.flyout.padding.right}return t.prototype.get_workspace=function(){return this.workspace_},t.prototype.get_buttons_=function(){return this.buttons_},t.prototype.set_corner_radius=function(t){this.flyout_corner_radius=t},t.prototype.filter_for_capacity=function(){if(this.targetWorkspace_)for(var t=this.targetWorkspace_.remaining_capacity(),e=this.workspace_.get_top_blocks(!1),o=0;o<e.length;o++){var i=e[o];if(-1==this.permanently_disabled_.indexOf(i)){var r=i.get_descendants();i.set_disabled(r.length>t)}}},t.prototype.reflow=function(){this.reflow_wrapper&&this.workspace_.remove_change_listener(this.reflow_wrapper);var t=this.workspace_.get_top_blocks(!1);this.reflow_internal(t),this.reflow_wrapper&&this.workspace_.add_change_listener(this.reflow_wrapper)},t.prototype.set_visible=function(t){var e=t!=this.is_visible_;this.is_visible_=t,e&&this.update_display()},t.prototype.update_display=function(){var t=this.is_visible();return this.scrollbar_&&this.scrollbar_.set_container_visible(t),t},t.prototype.block_mouse_down=function(t){var e=this,o=this;return function(i){if(e.targetWorkspace_){var r=e.targetWorkspace_.get_gesture(i);r&&(r.set_start_block(t),r.handle_flyout_start(i,o))}}},t.prototype.get_svg_root=function(){return this.svg_group},t.prototype.get_background=function(){return this.svg_background_},t.prototype.get_scrollbar=function(){return this.scrollbar_},t.prototype.is_scrollable=function(){return!!this.scrollbar_&&this.scrollbar_.is_visible()},t.prototype.is_horizontal=function(){return this.horizontalLayout_},t.prototype.is_visible=function(){return this.is_visible_&&this.containerVisible_},t.prototype.get_width=function(){return this.width_},t.prototype.get_height=function(){return this.height_},t.prototype.set_auto_close=function(t){t!==this.auto_close&&(this.auto_close=t,this.targetWorkspace_&&this.utils.svg_resize(this.targetWorkspace_),this.svg_group&&(t?((0,c.add_class_if_necessary)(this.svg_group,"blocklyFlyoutAutoClose"),(0,c.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutPinned")):((0,c.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutAutoClose"),(0,c.add_class_if_necessary)(this.svg_group,"blocklyFlyoutPinned"))))},t.prototype.is_auto_close=function(){return this.auto_close},t.prototype.create_dom=function(t){return this.svg_group=(0,c.create_svg_element)(t,{class:this.auto_close?"blocklyFlyout blocklyFlyoutHidden blocklyFlyoutAutoClose":"blocklyFlyout blocklyFlyoutHidden blocklyFlyoutPinned",width:0,height:0}),this.svg_background_=(0,c.create_svg_element)("path",{class:"blocklyFlyoutBackground"},this.svg_group),this.svg_background_.style.fill=this.theme.flyout.BACKGROUND_COLOR.toString(),this.svg_group.appendChild(this.create_workspace_with_padding_top(this.padding_top)),this.svg_group},t.prototype.create_workspace_with_padding_top=function(t){var e=this.workspace_.create_dom();return this.set_padding_top(t),e},t.prototype.set_padding_top=function(t){this.workspace_&&this.workspace_.svg_group&&("number"==typeof t?(this.workspace_.svg_group.style.transform="",this.workspace_.svg_group.setAttribute("transform","translate(0, "+t+")")):(this.workspace_.svg_group.removeAttribute("transform"),this.workspace_.svg_group.style.transform="translate(0, "+t+")"))},t.prototype.dispose=function(){this.hide(),this.unbind_scroll_events(),this.transition_end_wrapper&&(this.events.unbind_event(this.transition_end_wrapper),delete this.transition_end_wrapper),this.scrollbar_&&(this.scrollbar_.dispose(),delete this.scrollbar_),this.workspace_&&(this.workspace_.set_target_workspace(void 0),this.workspace_.dispose()),this.svg_group&&((0,c.remove_node)(this.svg_group),delete this.svg_group),delete this.svg_background_,delete this.targetWorkspace_,this.cached_blocks.forEach(function(t){return t.dispose()}),this.cached_blocks.clear(),this.cached_buttons.forEach(function(t){return t.dispose()}),this.cached_buttons.clear()},t.prototype.add_block_listeners=function(t,e){this.listeners_.push(this.events.bind_event_with_checks(t,"mousedown",void 0,this.block_mouse_down(e)))},t.prototype.xml_to_flyout_dom=function(t,e,o,i){if(void 0===i&&(i=this.workspace_),!this.targetWorkspace_)throw Error("Trying to construct flyout dom before setting target workspace. ");var r=t.tagName.toUpperCase();if(r)switch(r){case"BLOCK":var s=this.xml.dom_to_text(t),a=this.cached_blocks.get(s);a?a.retach(i):(a=this.xml.dom_to_block(t,i),this.check_if_cache_block(t)&&this.cached_blocks.set(s,a)),a.disabled&&this.permanently_disabled_.push(a),e.push({type:"block",block:a,inline:"true"===t.getAttribute("layout_inline")});var _=this.targetWorkspace_.options.flyout.blocks.default_gap;if(a.is_starting_block()&&o.length>0&&o[o.length-1]===_){var c=this.targetWorkspace_.options.flyout.blocks.head_block_offset[1];o[o.length-1]+=c}var l=t.getAttribute("gap");return void o.push(l?10>=parseInt(l)?_:parseInt(l):_);case"SEP":var h=t.getAttribute("gap");return void(h&&o.length>0&&(o[o.length-1]=parseInt(h,10)));case"BUTTON":case"LABEL":var d=new XMLSerializer().serializeToString(t),u=this.cached_buttons.get(d);return u?u.retach(i):(u=this.flyout_button_factory({workspace:i,target_workspace:this.targetWorkspace_,xml:t,is_label:"LABEL"===r,flyout_padding_left:this.padding_left,flyout_padding_right:this.padding_right}),this.cached_buttons.set(d,u)),e.push({type:"button",button:u}),void o.push(this.default_button_gap)}},t.prototype.show=function(t){var e,o=this;if(this.workspace_&&this.svg_group){if(this.events.disable(),this.workspace_.set_resizes_enabled(!1),this.hide(),this.clear_old_blocks(),"string"==typeof t){var i=this.workspace_.get_target_workspace();if(!i)return void console.error("Workspace has no target workspace.");var r=i.get_toolbox_category_callback(t);e=r?r(this.workspace_.get_target_workspace()):[]}else e=t;this.set_visible(!0),this.permanently_disabled_.length=0;for(var s=[],a=[],_=0;_<e.length;_++){var l=e[_];this.xml_to_flyout_dom(l,s,a)}this.layout_(s,a),this.svg_background_?this.listeners_.push(this.events.bind_event_with_checks(this.svg_background_,"mouseover",this,function(){for(var t=o.workspace_.get_top_blocks(!1),e=0;e<t.length;e++)t[e].remove_select()})):console.warn("Flyout background svg not found."),this.reset_size(),this.workspace_.set_resizes_enabled(!0),this.reflow(),this.filter_for_capacity(),this.position(),this.reflow_wrapper=this.reflow.bind(this),this.reflow_wrapper&&this.workspace_.add_change_listener(this.reflow_wrapper),!this.auto_close&&this.targetWorkspace_&&this.utils.svg_resize(this.targetWorkspace_),this.events.enable(),(0,c.add_class_if_necessary)(this.svg_group,"blocklyFlyoutVisible"),(0,c.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutHidden")}else console.error("Workspace has not been init.")},t.prototype.check_if_cache_block=function(t){return"true"!==t.getAttribute("uncache")},t.prototype.hide=function(){var t=this;this.is_visible()&&this.targetWorkspace_&&this.svg_group&&(this.set_visible(!1),this.listeners_.forEach(function(e){return t.events.unbind_event(e)}),this.listeners_.length=0,this.position(),this.reflow_wrapper&&(this.workspace_.remove_change_listener(this.reflow_wrapper),this.reflow_wrapper=void 0),this.auto_close||this.utils.svg_resize(this.targetWorkspace_),(0,c.add_class_if_necessary)(this.svg_group,"blocklyFlyoutHidden"),(0,c.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutVisible"))},t.prototype.clear_old_blocks=function(){if(this.workspace_){!function(t){for(var e=t.get_top_blocks(!1),o=0;o<e.length;o++){var i=e[o];i.get_workspace()==t&&i.detach()}}(this.workspace_);for(var t=0;t<this.buttons_.length;t++)this.buttons_[t].detach();this.buttons_.length=0}else console.error("Workspace has not been init.")},t.prototype.position_at=function(t,e,o,i){if(this.svg_group&&(this.svg_group.setAttribute("width",t.toString()),this.svg_group.setAttribute("height",e.toString()),this.utils.set_transform_style(this.svg_group,o,i)),this.scrollbar_){var r=s.vec2.fromValues(o,i);this.scrollbar_.set_origin(r),this.scrollbar_.resize()}},t.prototype.set_container_visible=function(t){if(this.svg_group){var e=t!=this.containerVisible_;if(this.containerVisible_=t,e){var o=this.update_display();this.svg_group.style.display=o?"block":"none"}}},t.prototype.scroll_to_start=function(){this.targetWorkspace_&&this.targetWorkspace_.options.flyout_scrollable&&(this.scrollbar_?this.scrollbar_.set(0):console.error("Cannot scroll flyout before scrollbar is initialized. ","Make sure Flyout.init() is called before trying to scroll. "))},t.prototype.create_block=function(t,e,o){var i;if(!this.targetWorkspace_)throw Error("Trying to create block from flyout before target workspace set. ");this.events.disable(),this.targetWorkspace_.set_resizes_enabled(!1);try{t.remove_hover(),i=this.place_new_block(t,o)}finally{this.events.enable(),this.utils.hide_chaff()}return this.events.is_enabled()&&(this.events.get_group()||this.events.set_group(!0),void 0!=i&&this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:i,source:e?"flyout:click":"flyout:drag"}))),this.auto_close&&this.hide(),i},t.prototype.init=function(t){if(this.targetWorkspace_=t,!this.workspace_)throw Error("this.workspace_ can not be undefined");this.workspace_.set_target_workspace(t),t.options.flyout_scrollable&&(this.scrollbar_=this.scrollbar_factory(this.workspace_,this.horizontalLayout_,!1,"blocklyFlyoutScrollbar",t.options.flyout_show_scrollbars),this.bind_scroll_events()),this.bind_transition_end_event(),this.hide(),this.auto_close||this.targetWorkspace_.add_change_listener(this.filter_for_capacity.bind(this)),this.workspace_.get_gesture=this.targetWorkspace_.get_gesture.bind(this.targetWorkspace_)},t.prototype.unbind_scroll_events=function(){var t=this;this.event_wrappers_.forEach(function(e){return t.events.unbind_event(e)}),this.event_wrappers_=[]},t.prototype.bind_scroll_events=function(){if(!this.svg_group||!this.svg_background_)throw Error("Trying to bind scroll event for flyout before svg init. ");this.event_wrappers_.push(this.events.bind_event_with_checks(this.svg_group,"wheel",this,this.wheel_)),this.event_wrappers_.push(this.events.bind_event_with_checks(this.svg_background_,"mousedown",this,this.on_mouse_down))},t.prototype.init_flyout_button=function(t,e,o,i){var r=t.get_svg_group()||t.create_dom(i);return"number"==typeof e&&"number"==typeof o&&t.move_to(e,o),t.show("none"!==t.default_display),this.listeners_.push(this.events.bind_event_with_checks(r,"mousedown",this,"fixed"!==t.position?this.on_mouse_down:function(){})),this.buttons_.push(t),r},t.prototype.on_mouse_down=function(t){if(this.is_visible()&&this.targetWorkspace_){var e=this.targetWorkspace_.get_gesture(t);e&&e.handle_flyout_start(t,this)}},t.prototype.clear_cached_blocks=function(){this.cached_blocks.clear()},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.FlyoutButton)],t.prototype,"flyout_button_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.WorkspaceSvg)],t.prototype,"workspace_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Scrollbar)],t.prototype,"scrollbar_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},22233(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.VerticalFlyout=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(35009),_=o(25507),c=o(86295),l=o(89221);e.VerticalFlyout=function(t){function e(e){var o=t.call(this,e)||this;return o.excute_after_next_reflow=[],o.content_height_=0,o.horizontalLayout_=!1,o.fixed_width=e.flyout.fixed_width,o.width_=o.fixed_width||0,o.set_auto_close(e.flyout.auto_close),o}return(0,i.__extends)(e,t),e.prototype.create_dom=function(e){var o=t.prototype.create_dom.call(this,e);return"number"==typeof this.fixed_width&&(o.addEventListener("mouseenter",function(){o.style.overflow="visible"}),o.addEventListener("mouseleave",function(){o.style.overflow="hidden"})),o},e.prototype.get_metrics=function(){if(this.is_visible()){var t,e=this.workspace_.get_canvas();if(!e)throw Error("Flyout ws has not been inited.");try{t=e.getBBox()}catch(e){t={height:0,y:0,width:0,x:0}}var o=this.workspace_.get_scale();return{viewHeight:this.height_,viewWidth:this.width_,contentHeight:t.height*o+this.padding_top+this.padding_bottom,contentWidth:t.width*o,viewTop:-this.workspace_.scroll_xy[1],viewLeft:-this.workspace_.scroll_xy[0],contentTop:0,contentLeft:t.x,absoluteTop:2,absoluteLeft:0}}},e.prototype.layout_=function(t,e){for(var o,i=this,r=s.vec2.fromValues(this.padding_left,0),a=0;a<t.length;a++){var _=t[a];if("block"==_.type&&_.block){var c=s.vec2.fromValues(r[0],r[1]);s.vec2.add(c,c,this.theme.renderer.BLOCK_LEFT_TOP),_.block.is_starting_block()&&s.vec2.add(c,c,[(null==(o=this.targetWorkspace_)?void 0:o.options.flyout.blocks.head_block_offset[0])||0,0]);var l=function(t){for(var e=t.get_descendants(),o=0;o<e.length;o++){var r=e[o];r.is_in_flyout=!0,r.render()}t.render();var s=t.get_svg_root();return i.add_block_listeners(s,t),t}(_.block);l.move_by(c);var h=l.get_height_width();if(_.inline){this.current_item_line={offset_left:r[0]+h.width,offset_right:this.padding_right,height:h.height};continue}r[1]+=h.height+e[a]}else"button"==_.type&&_.button&&this.button_layout(_.button,r,e[a])}this.content_height_=r[1]},e.prototype.button_layout=function(t,e,o){var i,r=this,s=e[0],a=e[1],_="absolute"!==t.position&&"fixed"!==t.position,c="center"===t.align||"right"===t.align,l=function(e){if(_&&!c)return{x:s,y:a};if("number"!=typeof e)return console.warn("Position of button "+t+" should be computed when reflow. "),{x:s,y:a};var o=0,i=e/r.workspace_.get_scale();if(void 0!==t.left?o=t.left:void 0!==t.right?o=i-t.right-t.width:"center"===t.align?o=(i-t.width)/2:"right"===t.align&&(o=i-r.padding_right-t.margin_right-t.width),_)return{x:o,y:a};var l=0;return void 0!==t.top?l=t.top:void 0!==t.bottom&&(l=("fixed"===t.position?r.height_/r.workspace_.get_scale():r.content_height_)-t.bottom-t.height),{x:o,y:l}};if(t.width_ratio)return this.excute_after_next_reflow.push(function(e){var o,i=e/r.workspace_.get_scale(),s=l(e),a=s.x,_=s.y,c=r.init_flyout_button(t,a,_,i*(t.width_ratio||1));"fixed"===t.position&&null!=(o=r.svg_group)&&o.appendChild(c)}),void(_&&(e[1]+=t.height+o));if(!_){var h=this.init_flyout_button(t);return this.excute_after_next_reflow.push(function(e){var o=l(e),i=o.x,r=o.y;t.move_to(i,r)}),void("fixed"===t.position&&(null==(i=this.svg_group)||i.appendChild(h)))}if(t.inline||this.current_item_line){if(r.current_item_line||(r.current_item_line={offset_left:s,offset_right:r.padding_right,height:t.height}),"center"===t.align)r.init_flyout_button(t),r.excute_after_next_reflow.push(function(e){var o=e/r.workspace_.get_scale();t.move_to((o-t.width)/2,a)});else if("right"===t.align){r.init_flyout_button(t);var d=r.current_item_line.offset_right,u=t.width+t.margin_right;r.excute_after_next_reflow.push(function(e){var o=e/r.workspace_.get_scale();t.move_to(o-d-u,a)}),r.current_item_line.offset_right+=u}else r.init_flyout_button(t,r.current_item_line.offset_left,a),r.current_item_line.offset_left+=t.width+t.margin_right;r.current_item_line.height=Math.max(r.current_item_line.height,t.height),t.inline||(e[1]+=r.current_item_line.height+o,r.current_item_line=void 0)}else"center"===t.align||"right"===t.align?(this.init_flyout_button(t),this.excute_after_next_reflow.push(function(e){var o=l(e),i=o.x,r=o.y;t.move_to(i,r)})):this.init_flyout_button(t,s,a),e[1]+=t.height+o},e.prototype.reflow_internal=function(t){var e=this;if(this.workspace_&&this.targetWorkspace_){var o=this.targetWorkspace_.options.flyout,i=o.max_width,r=o.min_width||0;if("number"==typeof this.fixed_width)r=this.fixed_width;else{for(var s=0;s<t.length;s++){var a=t[s],_=a.width;a.is_starting_block()&&(_+=this.targetWorkspace_.options.flyout.blocks.head_block_offset[0]),r=Math.max(r,_)}for(s=0;s<this.buttons_.length;s++){var c=this.buttons_[s];if("fixed"===c.position)break;r=Math.max(r,c.width)}var l=this.workspace_.get_scale();r+=this.padding_left+this.padding_right,r*=l,i&&(r=Math.min(r,i))}this.width_=r,this.excute_after_next_reflow.forEach(function(t){return t(e.width_)}),this.excute_after_next_reflow=[]}else console.error("Workspace has not been init.")},e.prototype.is_drag_toward_workspace=function(t){var e=t[0],o=Math.atan2(t[1],e)/Math.PI*180,i=this.drag_angle_range_;return o<i&&o>-i||o<-180+i||o>180-i},e.prototype.place_new_block=function(t,e){if(!this.targetWorkspace_)throw Error("Trying to place block before setting target workspace. ");var o=t.get_svg_root();if(!o)throw ReferenceError("Origin block should have root svg.");var i=this.utils.get_injection_div_xy(o),r=this.xml.block_to_dom(t),a=this.xml.dom_to_block(r,this.targetWorkspace_),c=a.get_svg_root();if(void 0==c)throw ReferenceError("Block should have svg root.");var l=this.utils.get_injection_div_xy(c);s.vec2.sub(l,i,l);var h=this.targetWorkspace_.get_scale();if(this.workspace_.get_scale()!==h&&e){var d=s.vec2.sub(e,e,(0,_.get_page_offset)(t.get_svg_root()));s.vec2.scale(d,d,this.workspace_.get_scale()-h),s.vec2.add(l,l,d)}return s.vec2.scale(l,l,1/h),a.move_by(l),a},e.prototype.wheel_=function(t){if(this.is_visible()){t.preventDefault(),t.stopPropagation();var e=t.deltaY;if(e&&this.scrollbar_){var o=this.get_metrics();if(o){var i=o.viewTop+e;this.scrollbar_.set(i)}else console.error("Cannot get metrics for wheel.")}}},e.prototype.set_metrics=function(t){if(void 0!=this.workspace_){var e=this.get_metrics();if(e){(0,c.is_number)(t.y)&&(this.workspace_.content_offset_by_view[1]=t.y,this.workspace_.scroll_xy[1]=-e.contentTop-t.y);var o=this.workspace_.scroll_xy[0],i=this.workspace_.scroll_xy[1];this.workspace_.translate(o,i)}}else console.error("Workspace not init.")},e.prototype.get_client_rect=function(){if(this.svg_group){var t=this.svg_group.getBoundingClientRect(),e=this.workspace_.get_options().delete_area_margin,o=t.left,i=t.top,r=t.width,s=t.height;return new l.Rect(o-e[3],i-e[0],r+e[1]+e[3],s+e[0]+e[2])}},e.prototype.reset_size=function(){this.width_=0},e.prototype.position=function(){if(void 0!=this.targetWorkspace_)if(this.svg_background_&&this.svg_group){var t=this.targetWorkspace_.get_metrics();if(t){if(this.height_=t.viewHeight,this.is_visible()){var e=this.compute_background_path(this.width_,this.height_);this.svg_background_.setAttribute("d",e)}else this.svg_group.style.overflow="hidden";var o=t.absoluteTop,i=t.absoluteLeft;this.toolboxPosition_===a.TOOLBOX_POSITION.RIGHT&&(i+=t.viewWidth,this.is_auto_close()&&this.is_visible()&&(i-=this.width_),i=Math.round(i+1)),this.toolboxPosition_===a.TOOLBOX_POSITION.LEFT&&(this.is_auto_close()&&this.is_visible()||(i-=this.width_),i=Math.round(i-1)),this.position_at(this.width_,this.height_,i,o)}}else console.error("Trying to position flyout before initialization. ");else console.error("Trying to position flyout before setting target workspace. ")},e.prototype.compute_background_path=function(t,e){var o=this.toolboxPosition_===a.TOOLBOX_POSITION.RIGHT,i=t-this.flyout_corner_radius,r=e-2*this.flyout_corner_radius,s=["M "+(o?t:0)+",0"];return s.push("h",o?""+-i:""+i),s.push("a",""+this.flyout_corner_radius,""+this.flyout_corner_radius,"0","0",o?"0":"1",o?""+-this.flyout_corner_radius:""+this.flyout_corner_radius,""+this.flyout_corner_radius),s.push("v",""+Math.max(0,r)),s.push("a",""+this.flyout_corner_radius,""+this.flyout_corner_radius,"0","0",o?"0":"1",o?""+this.flyout_corner_radius:""+-this.flyout_corner_radius,""+this.flyout_corner_radius),s.push("h",o?""+i:""+-i),s.push("z"),s.join(" ")},(0,i.__decorate)([(0,r.injectable)()],e)}(o(2189).Flyout)},62040(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockDragger=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963);e.BlockDragger=function(t){function e(e){var o=t.call(this,e.target,e.workspace)||this;o.type="block_dragger";var i=e.target,r=e.workspace.get_options().connection_effect;return o._dragged_connection_manager=r&&"default"===r.type?o.dragged_connection_manager:o.insertion_marker_manager,o._dragged_connection_manager.init(i),o._drag_icon_data=o.generate_icon_data(i),o}return(0,i.__extends)(e,t),e.prototype.generate_icon_data=function(t){for(var e=[],o=t.get_descendants(),i=0;i<o.length;i++)for(var r=o[i].get_icons(),s=0;s<r.length;s++){var a={location:r[s].get_location(),icon:r[s]};e.push(a)}return e},e.prototype.update_cursor_during_block_drag=function(t){void 0!=this._workspace&&void 0!=this._dragging_block?this._dragging_block.is_deletable()&&(this._would_delete_block=this._dragged_connection_manager.would_delete_block(),this._dragging_block.set_delete_style(this._would_delete_block),this._dragging_block.set_mouse_through_style(t)):console.error("Block dragger has been disposed.")},e.prototype.start_block_drag=function(e){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");this.redo_stack_before_drag=this._workspace.get_redo_stack().slice(),this.undo_stack_before_drag=this._workspace.get_undo_stack().slice(),this.events.get_group()||this.events.set_group(!0),this.parent_before_drag=this._dragging_block.get_parent(),this.parent_before_drag&&(this._dragging_block.get_root_block().svg_group.removeAttribute("filter"),this._dragging_block.unplug(),this.block_animations.disconnect_ui_effect(this._dragging_block)),t.prototype.start_block_drag.call(this,e)},e.prototype.drag_block=function(e,o){var i=t.prototype.drag_block.call(this,e,o);return this._dragged_connection_manager.update(i,this._delete_area),i},e.prototype.end_block_drag=function(t,e){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");this.drag_block(t,e),this._drag_icon_data=[],this.block_animations.disconnect_ui_effect_stop(this._dragging_block),this._dragging_block.set_mouse_through_style(!1);var o=this._workspace.get_toolbox();void 0!=o&&o.remove_delete_style();var i=void 0;if(this.events.is_enabled()){var r=this._workspace.current_gesture_;i=this.end_drag_event_factory({block:this._dragging_block,is_outside:this._was_outside,mouse_position:s.vec2.fromValues(t.clientX,t.clientY),is_from_flyout:(null==r?void 0:r.is_start_from_flyout())||!1,redo_stack_before_drag:this.redo_stack_before_drag})}var a=this.pixels_to_workspace_units(e),_=s.vec2.add(s.vec2.create(),this._start_xy,a);if(this._dragging_block.move_off_drag_surface(_),this._dragging_block.bring_to_front(),!this.maybe_delete_block()){if(this._dragging_block.move_connections(a),this._dragging_block.set_dragging(!1),this.events.is_enabled()){var c=this.move_event_factory({block:this._dragging_block});c.set_old_coord(this._start_xy),c.record_new(),this.events.fire(c)}this._dragged_connection_manager.apply_connections(),this._dragging_block.render(),this._dragging_block.schedule_snap_and_bump()}this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this.parent_before_drag=void 0;var l=this._workspace;this.dispose(),null!=l&&l.set_resizes_enabled(!0),this.events.fire(i),this.events.set_group(!1)},e.prototype.drag_related=function(){for(var t=0;t<this._drag_icon_data.length;t++)this._drag_icon_data[t].icon.reposition()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._drag_icon_data.length=0,this._dragged_connection_manager&&this._dragged_connection_manager.dispose()},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.insertion_marker_manager)],e.prototype,"insertion_marker_manager",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.dragged_connection_manager)],e.prototype,"dragged_connection_manager",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(1201).ElementDragger)},17959(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FlyoutDragger=void 0;var i=o(31635),r=o(71519);e.FlyoutDragger=function(t){function e(e){var o=t.call(this,e.get_workspace())||this;return o.horizontal_layout=!1,o.scrollbar_=e.get_scrollbar(),o.horizontal_layout=e.is_horizontal(),o}return(0,i.__extends)(e,t),e.prototype.update_scroll=function(t){this.horizontal_layout?this.scrollbar_.set(t[0]):this.scrollbar_.set(t[1])},(0,i.__decorate)([(0,r.injectable)()],e)}(o(32061).WorkspaceDragger)},2734(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Gesture=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(35009),_=o(36963),c=o(86295),l=o(82472),h=o(82267),d=o(84728);e.Gesture=function(){function t(t){this.mouse_down_xy=s.vec2.create(),this.current_drag_delta_xy=s.vec2.create(),this.start_field=void 0,this.start_block=void 0,this.target_block=void 0,this.start_workspace=void 0,this.has_exceeded_drag_radius=!1,this.is_dragging_workspace=!1,this.is_dragging_block=!1,this.is_mutation_click=!1,this.on_move_wrapper=void 0,this.on_up_wrapper=void 0,this.bubble_dragger=void 0,this.block_dragger=void 0,this.workspace_dragger=void 0,this.flyout_=void 0,this.called_update_is_dragging=!1,this.has_started_=!1,this.is_ending=!1,this.should_duplicate_on_drag=!1,this.body_width=document.body.clientWidth,this.body_height=document.body.clientHeight,this.PADDING=20,this.creator_workspace_=t.workspace,this.most_recent_event=t.event}return t.prototype.dispose=function(){this.touch_manager.clear_touch_identifier(),this.creator_workspace_.clear_gesture(),this.on_move_wrapper&&this.events.unbind_event(this.on_move_wrapper),this.on_up_wrapper&&this.events.unbind_event(this.on_up_wrapper),this.start_field=void 0,this.start_block=void 0,this.target_block=void 0,this.start_workspace=void 0,this.flyout_=void 0,this.block_dragger=void 0,this.workspace_dragger=void 0},t.prototype.update_from_event=function(t){var e=s.vec2.fromValues(t.clientX,t.clientY);this.update_drag_delta(e)&&(this.update_is_dragging(),this.touch_manager.long_stop()),this.most_recent_event=t},t.prototype.update_drag_delta=function(t){if(s.vec2.sub(this.current_drag_delta_xy,t,this.mouse_down_xy),!this.has_exceeded_drag_radius){var e=s.vec2.sqrLen(this.current_drag_delta_xy),o=this.flyout_?this.theme.blink_params.FLYOUT_DRAG_RADIUS:this.theme.blink_params.DRAG_RADIUS;return this.has_exceeded_drag_radius=e>o,this.has_exceeded_drag_radius}return!1},t.prototype.update_is_dragging_from_flyout=function(){return!(!this.target_block||this.target_block.disabled||!(0,c.is_block_svg)(this.target_block))&&!!(this.flyout_&&!this.flyout_.is_scrollable()||this.flyout_&&this.flyout_.is_drag_toward_workspace(this.current_drag_delta_xy))&&(this.start_workspace=this.flyout_.targetWorkspace_,void 0!=this.start_workspace&&this.start_workspace.update_screen_calculations_if_scrolled(),this.events.get_group()||this.events.set_group(!0),this.start_block=void 0,this.target_block=this.flyout_.create_block(this.target_block,!1,s.vec2.fromValues(this.mouse_down_xy[0],this.mouse_down_xy[1])),void 0!=this.target_block&&(this.target_block.select(),(0,c.is_block_svg)(this.target_block)&&this.target_block.set_connections_hidden(!1)),!0)},t.prototype.update_is_dragging_block=function(){return!!this.target_block&&(this.flyout_?this.is_dragging_block=this.update_is_dragging_from_flyout():(this.target_block.is_movable()||this.should_duplicate_on_drag)&&(this.is_dragging_block=!0),!!this.is_dragging_block&&(this.start_dragging_block(),!0))},t.prototype.update_is_dragging_workspace=function(){if(this.flyout_?this.flyout_.is_scrollable():this.start_workspace&&this.start_workspace.is_draggable()){if(this.flyout_)this.workspace_dragger=this.workspace_dragger_factory(this.flyout_);else{if(void 0==this.start_workspace)return;this.workspace_dragger=this.workspace_dragger_factory(this.start_workspace)}this.is_dragging_workspace=!0,this.workspace_dragger.start_drag()}},t.prototype.update_is_dragging=function(){!this.called_update_is_dragging&&(this.called_update_is_dragging=!0,this.update_is_dragging_block()||this.update_is_dragging_workspace())},t.prototype.update_is_mutation_click=function(t){this.is_mutation_click=t},t.prototype.start_dragging_block=function(){var t=this.events.get_group();this.events.set_group(t||!0),this.should_duplicate_on_drag&&this.duplicate_on_drag(),void 0!=this.target_block&&void 0!=this.start_workspace&&(this.block_dragger=this.element_dragger_factory({target:this.target_block,workspace:this.start_workspace}),this.block_dragger.start_block_drag(this.current_drag_delta_xy),this.block_dragger.drag_block(this.most_recent_event,this.current_drag_delta_xy))},t.prototype.do_start=function(t){(0,l.is_target_input)(t)?this.cancel():void 0!=this.start_workspace&&(this.start_workspace.is_gestures_enabled()||this.start_block?(this.has_started_=!0,this.start_workspace.update_screen_calculations_if_scrolled(),this.start_workspace.mark_focused(),this.most_recent_event=t,this.utils.hide_chaff(!!this.flyout_),this.target_block&&!this.is_mutation_click&&this.target_block.select(),(0,l.is_right_button)(t)?this.handle_right_click(t):((0,h.case_insensitive_equals)(t.type,"touchstart")&&this.touch_manager.long_start(t,this),this.mouse_down_xy=s.vec2.fromValues(t.clientX,t.clientY),this.bind_mouse_events(t))):this.touch_manager.clear_touch_identifier())},t.prototype.bind_mouse_events=function(t){this.on_move_wrapper=this.events.bind_event_with_checks(document,"mousemove",void 0,this.handle_move.bind(this)),this.on_up_wrapper=this.events.bind_event_with_checks(document,"mouseup",void 0,this.handle_up.bind(this)),t.preventDefault(),t.stopPropagation()},t.prototype.handle_move=function(t){if(d.is.mobile()){var e=t.clientX,o=t.clientY;if(e<=this.PADDING||e>=this.body_width-this.PADDING||o<=this.PADDING||o>=this.body_height-this.PADDING)return void this.handle_up(t)}if(this.update_from_event(t),this.is_dragging_workspace){if(void 0==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.workspace_dragger.drag(this.current_drag_delta_xy)}else if(this.is_dragging_block){if(void 0==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.block_dragger.drag_block(this.most_recent_event,this.current_drag_delta_xy)}t.preventDefault(),t.stopPropagation()},t.prototype.handle_up=function(t){if(!this.is_ending){this.is_ending=!0;try{if(this.update_from_event(t),this.touch_manager.long_stop(),this.is_dragging_block){if(void 0==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.is_dragging_block=!1,this.block_dragger.end_block_drag(t,this.current_drag_delta_xy)}else if(this.is_dragging_workspace){if(void 0==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.is_dragging_workspace=!1,this.workspace_dragger.end_drag(this.current_drag_delta_xy)}else this.is_field_click()?this.do_field_click(t):this.is_block_click()&&!this.is_mutation_click?this.do_block_click():this.is_workspace_click()&&this.do_workspace_click()}catch(t){console.error("Occurs error when handle mouseup: ",t)}finally{t.preventDefault(),t.stopPropagation(),this.dispose()}}},t.prototype.cancel=function(){if(!this.is_ending){this.is_ending=!0;try{if(this.touch_manager.long_stop(),this.is_dragging_block){if(void 0==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.block_dragger.end_block_drag(this.most_recent_event,this.current_drag_delta_xy)}else if(this.is_dragging_workspace){if(void 0==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.workspace_dragger.end_drag(this.current_drag_delta_xy)}}catch(t){console.error("Occurs error when cancel gesture: ",t)}finally{this.dispose()}}},t.prototype.handle_right_click=function(t){this.target_block?(this.bring_block_to_front(),this.utils.hide_chaff(!!this.flyout_),this.target_block.show_context_menu(t)):this.start_workspace&&!this.flyout_&&(this.utils.hide_chaff(),this.start_workspace.show_context_menu(t)),t.preventDefault(),t.stopPropagation(),this.dispose()},t.prototype.handle_ws_start=function(t,e){this.has_started_||(this.set_start_workspace(e),this.most_recent_event=t,this.do_start(t))},t.prototype.handle_flyout_start=function(t,e){if(!this.has_started_){var o=e.get_workspace();void 0!=o&&(this.set_start_flyout(e),this.handle_ws_start(t,o))}},t.prototype.handle_block_start=function(t,e){this.has_started_||(this.set_start_block(e),this.most_recent_event=t)},t.prototype.do_field_click=function(t){void 0!=this.start_field?(this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.CLICK,workspace_id:this.start_field.source_block.workspace.id})),this.start_field.focus(!0),this.start_field.show_editor(t),this.bring_block_to_front()):console.error("Click event without start field.")},t.prototype.do_block_click=function(){if((0,c.is_block_svg)(this.start_block)&&(0,c.is_block_svg)(this.target_block)){var t=this.events.get_group();if(this.flyout_&&this.flyout_.is_auto_close()){if(void 0!=this.target_block&&!this.target_block.disabled){this.events.set_group(t||!0);var e=this.flyout_.create_block(this.target_block,!0,s.vec2.fromValues(this.mouse_down_xy[0],this.mouse_down_xy[1]));e.select(),e.schedule_snap_and_bump(),e.workspace.set_resizes_enabled(!0)}}else if(!this.widget_div.is_visible()&&this.events.is_enabled()){var o=this.start_block.id,i=this.start_block.workspace.id,r=this.start_block.get_root_block().id;this.events.fire(this.ui_event_factory({type:a.UIEventType.CLICK,workspace_id:i,block_id:o})),this.events.fire(this.ui_event_factory({type:a.UIEventType.STACK_CLICK,workspace_id:i,block_id:r}))}this.bring_block_to_front(),this.events.set_group(t)}},t.prototype.do_workspace_click=function(){this.start_workspace&&(this.runtime_data.selected&&this.runtime_data.selected.unselect(),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.STACK_CLICK,workspace_id:this.start_workspace.id})))},t.prototype.bring_block_to_front=function(){this.target_block&&this.target_block.workspace&&!this.flyout_&&this.target_block.bring_to_front()},t.prototype.set_start_field=function(t){this.start_field||(this.start_field=t)},t.prototype.set_start_block=function(t){var e;this.start_block||((0,c.is_block_svg)(t)&&"param_color"===(null==(e=t.parent_block)?void 0:e.element_type)&&t.is_shadow()&&(t=t.parent_block),this.start_block=t,(0,c.is_block_svg)(t)&&t.is_in_flyout&&t!=t.get_root_block()?(this.should_duplicate_on_drag=!1,this.set_target_block(t.get_root_block())):((0,c.is_block_svg)(t)&&t.is_shadow()&&("param"===t.element_type||"param_color"===t.element_type)&&(this.should_duplicate_on_drag=!0),this.set_target_block(t)))},t.prototype.set_target_block=function(t){(0,c.is_block_svg)(t)&&t.is_shadow()&&!this.should_duplicate_on_drag?this.set_target_block(t.get_parent()):this.target_block=t},t.prototype.set_start_workspace=function(t){this.start_workspace||(this.start_workspace=t)},t.prototype.set_start_flyout=function(t){this.flyout_||(this.flyout_=t)},t.prototype.is_start_from_flyout=function(){return!!this.flyout_},t.prototype.is_block_click=function(){return!!this.start_block&&!this.has_exceeded_drag_radius&&!this.is_field_click()},t.prototype.is_field_click=function(){return!!this.start_field&&this.start_field.is_currently_editable()&&!this.has_exceeded_drag_radius},t.prototype.is_workspace_click=function(){return!this.start_block&&!this.start_field&&!this.has_exceeded_drag_radius},t.prototype.is_dragging=function(){return this.is_dragging_workspace||this.is_dragging_block},t.prototype.has_started=function(){return this.has_started_},t.prototype.force_start_block_drag=function(t,e){this.handle_block_start(t,e),this.handle_ws_start(t,e.get_workspace()),this.is_dragging_block=!0,this.has_exceeded_drag_radius=!0,this.start_dragging_block()},t.prototype.duplicate_on_drag=function(){var t=void 0;if(void 0!=this.start_workspace)if((0,c.is_block_svg)(this.target_block)){this.events.disable();try{this.start_workspace.set_resizes_enabled(!1);var e=this.xml.block_to_dom(this.target_block);"color_picker"===e.getAttribute("type")?(t=this.xml.dom_to_block(e,this.start_workspace)).set_connections_hidden(!1):t=this.xml.dom_to_block_headless(e,this.start_workspace),t.init_svg(),t.render();var o=this.target_block.get_relative_to_surface_xy();t.move_by(o),t.set_shadow(!1)}finally{this.events.enable()}t?(this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:t})),t.select(),this.target_block=t):console.error("Something went wrong while duplicating a block.")}else console.error("Try to drag without target block.");else console.error("Try to drag without start workspace.")},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.WorkspaceElementDragger)],t.prototype,"element_dragger_factory",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.WorkspaceDragger)],t.prototype,"workspace_dragger_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},1201(t,e,o){"use strict";e.ElementDragger=void 0;var i=o(31635),r=o(77276),s=o(36963),a=o(35009);e.ElementDragger=function(){function t(t,e){this.parent_before_drag=void 0,this._delete_area=a.DeleteArea.DELETE_AREA_NONE,this._would_delete_block=!1,this._was_outside=!1,this._was_workspace=!0,this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this._dragging_block=t,this._workspace=e,this._start_xy=t.get_relative_to_surface_xy()}return t.prototype.update_cursor_during_block_drag=function(t){void 0!=this._workspace&&void 0!=this._dragging_block?this._dragging_block.is_deletable()&&(this._would_delete_block=this._delete_area===a.DeleteArea.DELETE_AREA_TOOLBOX,this._dragging_block.set_delete_style(this._would_delete_block),this._dragging_block.set_mouse_through_style(t)):console.error("Block dragger has been disposed.")},t.prototype.start_block_drag=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");this.redo_stack_before_drag||this.undo_stack_before_drag||(this.redo_stack_before_drag=this._workspace.get_redo_stack().slice(),this.undo_stack_before_drag=this._workspace.get_undo_stack().slice()),this.events.get_group()||this.events.set_group(!0),this._workspace.set_resizes_enabled(!1),this.tooltip.hide();var e=this.pixels_to_workspace_units(t),o=r.vec2.create();if(r.vec2.add(o,this._start_xy,e),this._dragging_block.translate(o),this._dragging_block.set_dragging(!0),this._dragging_block.bring_to_front(),this._dragging_block.move_to_drag_surface(),this._dragging_block.is_deletable()){var i=this._workspace.get_toolbox();void 0!=i&&i.add_delete_style()}if(this.events.is_enabled()){var s=this._workspace.current_gesture_;this.events.fire(this.start_drag_event_factory({block:this._dragging_block,is_from_flyout:(null==s?void 0:s.is_start_from_flyout())||!1}))}},t.prototype.drag_block=function(t,e){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");var o=this.pixels_to_workspace_units(e),i=r.vec2.create();return r.vec2.add(i,this._start_xy,o),this._dragging_block.move_during_drag(i),this.drag_related(o),this.handle_dragging_around_delete_area(t),this.handle_dragging_around_blocks_area(t),this.handle_dragging_around_workspace(t),o},t.prototype.handle_dragging_around_delete_area=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");var e,o=this._workspace.is_delete_area(t);!!o!=!!this._delete_area&&this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:a.DragArea.DELETE_AREA,is_in:!!o})),this._delete_area=o,this.events.fire(e)},t.prototype.handle_dragging_around_blocks_area=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");var e,o=!this._workspace.is_inside_blocks_area(t);o!==this._was_outside&&(this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:a.DragArea.INJECTION_DIV,is_in:!o})),this._was_outside=o),this.update_cursor_during_block_drag(o),this.events.fire(e)},t.prototype.handle_dragging_around_workspace=function(t){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");var e,o=this._workspace.is_inside_workspace_area(t);o!==this._was_workspace&&(this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:a.DragArea.WORKSPACE,is_in:o})),this._was_workspace=o),this.events.fire(e)},t.prototype.maybe_delete_block=function(){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Block dragger has been disposed.");if(!this._dragging_block.is_deletable())return!1;if(this._would_delete_block){if(this.events.is_enabled()){var t=this.move_event_factory({block:this._dragging_block});t.set_old_coord(this._start_xy),t.record_new(),this.events.fire(t)}this._dragging_block.dispose(!1,!0)}return this._would_delete_block},t.prototype.pixels_to_workspace_units=function(t){var e=r.vec2.create();if(void 0==this._workspace)return console.error("Block dragger has been disposed."),r.vec2.create();var o=this._workspace.get_scale();return r.vec2.scale(e,t,1/o),e},t.prototype.dispose=function(){this._dragging_block=void 0,this._workspace=void 0},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.tooltip)],t.prototype,"tooltip",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.DragAreaChangeEvent)],t.prototype,"drag_area_change_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.EndDragEvent)],t.prototype,"end_drag_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.StartDragEvent)],t.prototype,"start_drag_event_factory",void 0),t}()},81374(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceCommentDragger=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(86295);e.WorkspaceCommentDragger=function(t){function e(e){var o=t.call(this,e.target,e.workspace)||this;return o.type="comment_dragger",o.start_relative_position=e.target.get_relative_position(),o}return(0,i.__extends)(e,t),e.prototype.drag_related=function(t){if((0,a.is_workspace_comment)(this._dragging_block)){var e=s.vec2.add(s.vec2.create(),this.start_relative_position,t);this._dragging_block.set_relative_position(e),this._dragging_block.draw_line()}},e.prototype.end_block_drag=function(t,e){if(void 0==this._workspace||void 0==this._dragging_block)throw Error("Comment dragger has been disposed.");this.drag_block(t,e),this.block_animations.disconnect_ui_effect_stop(this._dragging_block);var o=void 0;if(this.events.is_enabled()){var i=this._workspace.current_gesture_;o=this.end_drag_event_factory({block:this._dragging_block,is_outside:this._was_outside,mouse_position:s.vec2.fromValues(t.clientX,t.clientY),is_from_flyout:(null==i?void 0:i.is_start_from_flyout())||!1,redo_stack_before_drag:this.redo_stack_before_drag})}this._dragging_block.set_mouse_through_style(!1);var r=this.pixels_to_workspace_units(e),a=s.vec2.add(s.vec2.create(),this._start_xy,r);if(this._dragging_block.move_off_drag_surface(a),this._dragging_block.bring_to_front(),!this.maybe_delete_block()&&(this._dragging_block.set_dragging(!1),this.events.is_enabled())){var _=this.move_event_factory({block:this._dragging_block});_.set_old_coord(this.start_relative_position),_.record_new(),this.events.fire(_)}if(this._workspace.set_resizes_enabled(!0),this._dragging_block.is_deletable()){var c=this._workspace.get_toolbox();void 0!=c&&c.remove_delete_style()}this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this.dispose(),o&&this.events.fire(o),this.events.set_group(!1)},(0,i.__decorate)([(0,r.injectable)()],e)}(o(1201).ElementDragger)},87604(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TimerHandler=void 0,e.TimerHandler=function(){function t(){this.timers=[],this.override_timer()}return t.prototype.push=function(t){this.timers.push(t)},t.prototype.pop=function(t){var e=this.timers.findIndex(function(e){return e===t});e>=0&&this.timers.splice(e,1)},t.prototype.is_empty=function(){return 0===this.timers.length},t.prototype.override_timer=function(){var t=this,e=window.setTimeout.bind(window);window.setTimeout=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var r=e.apply(window,o),s=o[1];return o[2]||t.push(r),e(function(){t.pop(r)},s,!0),r};var o=window.clearTimeout.bind(window);window.clearTimeout=function(e){o(e),"number"==typeof e&&t.pop(e)}},t.prototype.show=function(){console.log(this.timers)},t}()},30086(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.onKeyDown_=e.Inject=void 0;var i=o(31635),r=o(77276),s=o(36963),a=o(35009),_=o(71288),c=o(91581),l=o(86295),h=(0,i.__importStar)(o(25507)),d=o(87604),u=o(48264),p=o(44015);e.Inject=function(t,e){if((0,l.is_string)(t)&&(t=document.getElementById(t)||document.querySelector(t)||void 0),(0,l.is_nil)(t)||!h.contains(document,t))throw ReferenceError("Error: container is not in current document.");var o=(0,s.get_instance)(),i=o.get(s.BINDING.Options)(e||{}),_=h.create_dom("div","injectionDiv");_.classList.add(i.theme),t.appendChild(_);var c=g.call(this,_,i),u=function(t,e,o,i,_){e.parentWorkspace=void 0;var c=(0,s.get_instance)(),l=c.get(s.BINDING.WorkspaceSvg)(e,o,i,_);if(void 0!=e.zoomOptions.startScale&&l.set_scale(e.zoomOptions.startScale),t.appendChild(l.create_dom("blocklyMainBackground")),!e.has_categories&&e.toolbox_config){var u=l.add_flyout("svg");if(void 0==u)throw Error("Add flyout failed.");h.insert_after(u,t)}var f=c.get(s.BINDING.Blink);return l.translate(0,0),f.mainWorkspace=l,e.readOnly||e.ws_scrollable||l.add_change_listener(function(t){var o=t.type===a.BlockEventType.MOVE||t.type===a.BlockEventType.CREATE&&"flyout:drag"!==t.source||t.type===a.UIEventType.FLYOUT_SHOW;if(!l.is_dragging()&&o){var i=l.get_metrics(),s=i.viewLeft+i.absoluteLeft-l.offset[0],_=i.viewTop+i.absoluteTop-l.offset[1],c=i.contentTop<_,h=i.contentLeft<(e.RTL?i.viewLeft:s),d=i.contentTop+i.contentHeight>i.viewHeight+_,u=i.contentLeft+i.contentWidth>(e.RTL?i.viewWidth:i.viewWidth+s);if(c||h||d||u)for(var p=l.get_top_elements(!1),f=0;f<p.length;f++){var g=p[f],v=g.get_relative_to_surface_xy(),b=g.get_height_width(),m=_-v[1];m>0&&g.move_by(r.vec2.fromValues(0,m+25));var y=_+i.viewHeight-v[1]-b.height;y<0&&g.move_by(r.vec2.fromValues(0,y));var k=s-v[0]-(e.RTL?b.width:0);k>0&&g.move_by(r.vec2.fromValues(k+25,0));var w=s+i.viewWidth-v[0]-(e.RTL?0:b.width);w<0&&g.move_by(r.vec2.fromValues(w,0))}}}),"simplified"===e.comment_type&&l.add_change_listener(function(t){if(t.type===a.BlockEventType.MOVE){var e,o=l.get_block_by_id(t.get_block_id());if(o){var i=t.get_old_loc(),r=t.get_new_loc();if(i.parent_id){var s=(0,p.get_nested_blocks_with_comment)(o)[0];s&&s.comment&&s.rendered&&s.comment.init_svg(!0);var _=l.get_block_by_id(i.parent_id);if(!_)return;var c=(0,p.get_outer_block)(_);(e=(0,p.get_nested_blocks_with_comment)(c)[0])&&e.comment&&e.rendered&&e.comment.init_svg(!0)}r.parent_id&&(c=(0,p.get_outer_block)(o),(e=(0,p.get_nested_blocks_with_comment)(c)[0])&&e.comment&&e.rendered&&e.comment.init_svg(!0))}}}),f.utils.svg_resize(l),f.widget_div.create_dom(),e.tooltip&&f.tooltip.create_dom(),e.pinch?f.runtime_data.register_finger_events():f.runtime_data.cancel_gesture_when_multi_touch(),e.degrade_translate&&(l.degrade_translate=e.degrade_translate),e.timer&&(f.timer=new d.TimerHandler),l}(c,i,o.get(s.BINDING.BlockDragSurfaceSvg)(_),o.get(s.BINDING.WorkspaceDragSurfaceSvg)(_,c),_);v.call(this,u),this.mainWorkspace=u;var b=o.get(s.BINDING.utils);return b.svg_resize(u),i.auto_resize&&f((0,l.debounce)(function(){return b.svg_resize(u)},i.auto_resize.delay),t),u};var f=function(t,e){return(0,i.__awaiter)(void 0,void 0,void 0,function(){return(0,i.__generator)(this,function(r){switch(r.label){case 0:return[4,Promise.resolve().then(function(){return(0,i.__importStar)(o(43591))})];case 1:return[4,r.sent().default];case 2:return new(r.sent())(t).observe(e),[2]}})})};function g(t,e){var o=(0,s.get_instance)();t.setAttribute("dir","LTR"),o.get(s.BINDING.css).inject(e.hasCss,e.pathToMedia);var i=h.create_svg_element("svg",{class:"blocklySvg"},t),r=h.create_svg_element("defs",{},i),a=String(Math.random()).substring(2);e.readOnly||(0,_.inject_extra_filters)(r),(0,_.inject_comment_filters)(r),(0,c.inject_icon_symbols)(r);var d=h.create_svg_element("filter",{id:"blur-1px"},r);h.create_svg_element("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1"},d);var u=h.create_svg_element("filter",{id:"hiblur","color-interpolation-filters":"sRGB"},r);h.create_svg_element("feColorMatrix",{type:"luminanceToAlpha",in:"SourceGraphic",result:"lumMap"},u);var p=h.create_svg_element("feComponentTransfer",{in:"lumMap",result:"highlightMask"},u);h.create_svg_element("feFuncA",{type:"discrete",tableValues:"0 0 0 0 0 0 0 1"},p),h.create_svg_element("feComposite",{operator:"in",in:"SourceGraphic",in2:"highlightMask",result:"highlights"},u),h.create_svg_element("feGaussianBlur",{in:"highlights",stdDeviation:"3",result:"highBlur"},u),h.create_svg_element("feComposite",{operator:"over",in:"highBlur",in2:"SourceGraphic",result:"final"},u);var f=h.create_svg_element("pattern",{id:"transparentPattern",x:0,y:0,width:12,height:12,patternUnits:"userSpaceOnUse"},r);h.create_svg_element("rect",{x:0,y:0,width:7,height:7,style:"fill:#FFFFFF"},f),h.create_svg_element("rect",{x:6,y:0,width:7,height:7,style:"fill:#EFEFEF"},f),h.create_svg_element("rect",{x:0,y:6,width:7,height:7,style:"fill:#EFEFEF"},f),h.create_svg_element("rect",{x:6,y:6,width:7,height:7,style:"fill:#FFFFFF"},f);var g=h.create_svg_element("filter",{id:"blocklyEmbossFilter"+a},r);h.create_svg_element("feGaussianBlur",{in:"SourceAlpha",stdDeviation:1,result:"blur"},g);var v=h.create_svg_element("feSpecularLighting",{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},g);h.create_svg_element("fePointLight",{x:-5e3,y:-1e4,z:2e4},v),h.create_svg_element("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},g),h.create_svg_element("feComposite",{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},g),e.embossFilterId=g.id;var b=h.create_svg_element("pattern",{id:"blocklyDisabledPattern"+a,patternUnits:"userSpaceOnUse",width:12,height:12},r);return h.create_svg_element("rect",{width:12,height:12,fill:this.theme.disabled_color.fill},b),e.disabledPatternId=b.id,e.svg_defs=r,e.svg_rnd=a,e.custom_svg_defs&&e.custom_svg_defs.forEach(function(t){r.appendChild((0,l.is_string)(t)?h.parse_to_SVG(t):t)}),i}function v(t){var e=(0,s.get_instance)(),o=e.get(s.BINDING.events),i=e.get(s.BINDING.utils),r=t.get_parent_svg();void 0!=r&&r.parentNode&&o.bind_event_with_checks(r.parentNode,"contextmenu",void 0,function(t){i.is_target_input(t)||t.preventDefault()});var _=o.bind_event_with_checks(window,"resize",void 0,function(){i.hide_chaff(!0),i.svg_resize(t)});t.set_resize_handler_wrapper(_),b.call(this);var c=t.get_options();if(void 0!=c.toolbox_config){var h=t.get_toolbox(),d=t.get_flyout();(0,l.is_nil)(h)?c.toolbox_config instanceof Element&&!(0,l.is_nil)(d)&&(d.init(t),d.show(c.toolbox_config.children),d.scroll_to_start(),t.scroll_xy[0]=d.get_width(),c.toolboxPosition==a.TOOLBOX_POSITION.RIGHT&&(t.scroll_xy[0]*=-1),t.translate(t.scroll_xy[0],0)):h.init()}if(c.ws_scrollable){var u=e.get(s.BINDING.ScrollbarPair)(t,c.ws_show_scrollbars);t.set_scrollbar(u),u.resize()}c.hasSounds&&function(t,e){var o=(0,s.get_instance)().get(s.BINDING.events),i=e.get_audio_manager();if(!i)throw ReferenceError("audioMgr is undefined");["click","disconnect","delete"].forEach(function(e){i.load([""+t+e+".mp3",""+t+e+".wav",""+t+e+".ogg"],e)});var r=[],a=function(){for(var t=r.pop();t;)o.unbind_event(t),t=r.pop();i.preload()};r.push(o.bind_event_with_checks(document,"mousemove",void 0,a,!0)),r.push(o.bind_event_with_checks(document,"touchstart",void 0,a,!0))}(c.pathToMedia,t)}function b(){var t=this;if(!this.runtime_data.document_events_bound){var e=(0,s.get_instance)(),o=e.get(s.BINDING.events),i=e.get(s.BINDING.touch_manager);o.bind_event_with_checks(document,"keydown",void 0,m.bind(this)),o.bind_event_with_checks(document,"touchend",void 0,i.long_stop.bind(i)),o.bind_event_with_checks(document,"touchcancel",void 0,i.long_stop.bind(i)),u.is.ipad()&&o.bind_event_with_checks(window,"orientationchange",document,function(){t.utils.svg_resize(t.mainWorkspace)})}this.runtime_data.document_events_bound=!0}function m(t){if(!this.mainWorkspace.get_options().readOnly&&!this.utils.is_target_input(t)&&this.mainWorkspace.get_hotkey_enable()){var e=!1;if(27==t.keyCode)this.utils.hide_chaff();else if(8==t.keyCode||46==t.keyCode){if(t.preventDefault(),this.mainWorkspace.is_dragging())return;this.runtime_data.selected&&this.runtime_data.selected.is_deletable()&&(e=!0)}else if(t.altKey||t.ctrlKey||t.metaKey){if(this.mainWorkspace.is_dragging())return;if(this.runtime_data.selected&&this.runtime_data.selected.is_deletable()&&this.runtime_data.selected.is_movable()&&(67==t.keyCode?(this.utils.hide_chaff(),this.runtime_data.clipboard.copy(this.runtime_data.selected)):88==t.keyCode&&(this.runtime_data.clipboard.copy(this.runtime_data.selected),e=!0)),86==t.keyCode){var o=this.runtime_data.clipboard.get_content();if(o){var i=this.events.get_group();this.events.set_group(i||!0),Array.isArray(o)?this.mainWorkspace.paste_extend(o,void 0,!0):this.mainWorkspace.paste(o,void 0,!0),this.events.set_group(i)}}else 90==t.keyCode&&(this.utils.hide_chaff(),this.mainWorkspace.undo(t.shiftKey))}e&&(i=this.events.get_group(),this.events.set_group(i||!0),this.utils.hide_chaff(),this.runtime_data.selected&&this.runtime_data.selected.dispose(!1,!0),this.events.set_group(i))}}e.onKeyDown_=m},26547(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Blink=void 0;var i=o(31635),r=o(71519),s=o(92386),a=o(82543),_=o(30086),c=o(62879),l=o(36963);e.Blink=function(){function t(){this.Blocks=Object.create(null),this.blocks_xml={},this.version=o(46249).rE,this.inject=_.Inject.bind(this),Object.assign(this.Msg,a.zh_hans),(0,s.init_shadows)(this)}return Object.defineProperty(t.prototype,"mainWorkspace",{get:function(){return this.workspace_db.current},set:function(t){this.workspace_db.current=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"di_container",{get:function(){return(0,c.get_instance)()},enumerable:!1,configurable:!0}),t.prototype.define_blocks_with_json_array=function(t){for(var e=0;e<t.length;e++){var o=t[e];if(o){var i=o.type;i?(this.Blocks[i]&&console.warn("Block definition #"+e+' in JSON array overwrites prior definition of "'+i+'".'),this.Blocks[i]={init:function(t){return function(){this.jsonInit(t)}}(o)}):console.warn("Block definition #"+e+" in JSON array is missing a type attribute. Skipping.")}else console.warn("Block definition #"+e+" in JSON array not exist. Skipping.")}},t.prototype.define_block_with_object=function(t,e){this.Blocks[t]&&console.warn('Block definition overwrites prior definition of "'+t+'".'),this.Blocks[t]=e},(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.context_menu)],t.prototype,"context_menu",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.extensions)],t.prototype,"extensions",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.registry)],t.prototype,"registry",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.tooltip)],t.prototype,"tooltip",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.json)],t.prototype,"json",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},71288(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject_comment_filters=e.inject_extra_filters=e.FILTER=void 0;var i=(0,o(31635).__importStar)(o(48264));e.FILTER={REPLACEMENT_GLOW:"blocklyReplacementGlowFilter",DRAG_SHADOW:"blocklyDragFilter",SURROUND_SHADOW:"blocklySurroundShadowFilter",SELECTED:"blocklySelectedFilter",BOXSHADOW:"blocklyBoxShadowFilter",SURROUND_SHADOW_DARK:"blocklySurroundShadowDarkFilter",DISABLED_HEAD_ICON:"blocklyDisabledHeadIconFilter",FOCUSED:"blocklyFocusedFilter"},e.inject_extra_filters=function(t){(o={})[e.FILTER.REPLACEMENT_GLOW]='\n      <filter id="'+e.FILTER.REPLACEMENT_GLOW+'" height="160%" width="180%" y="-30%" x="-40%">\n        <feGaussianBlur in="SourceGraphic" stdDeviation="1.5"></feGaussianBlur>\n        <feComponentTransfer result="outBlur">\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feFlood flood-color="#FFFFFF" flood-opacity="1" result="outColor"></feFlood>\n        <feComposite in="outColor" in2="outBlur" operator="in" result="outGlow"></feComposite>\n        <feComposite in="SourceGraphic" in2="outGlow" operator="over"></feComposite>\n      </filter>\n    ',o[e.FILTER.DRAG_SHADOW]='\n      <filter id="'+e.FILTER.DRAG_SHADOW+'" height="180%" width="160%" y="-40%" x="-30%">\n\n        <feGaussianBlur stdDeviation="1"></feGaussianBlur>\n        <feComponentTransfer result="outBlur">\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feFlood flood-color="#FFFFFF" flood-opacity="1" result="outColor"></feFlood>\n        <feComposite in="outColor" in2="outBlur" operator="in" result="outGlow"></feComposite>\n\n        <feGaussianBlur in="SourceAlpha" stdDeviation="6"></feGaussianBlur>\n        <feOffset dx="0" dy="2" />\n        <feComponentTransfer result="outShadow" >\n          <feFuncA type="linear" slope="0.4" />\n        </feComponentTransfer>\n\n        <feMerge>\n          <feMergeNode in="outShadow" />\n          <feMergeNode in="outGlow" />\n          <feMergeNode in="SourceGraphic" />\n        </feMerge>\n\n      </filter>\n    ',o[e.FILTER.SURROUND_SHADOW]='\n      <filter id="'+e.FILTER.SURROUND_SHADOW+'" height="180%" width="160%" y="-40%" x="-30%">\n        <feFlood flood-color="#000" flood-opacity="0.2" result="shadowColor"></feFlood>\n        <feComposite in="shadowColor" in2="SourceAlpha" operator="in" result="floodShape"/>\n        <feGaussianBlur in="floodShape" stdDeviation="6" result="outShadow"></feGaussianBlur>\n        <feOffset dx="0" dy="0" />\n\n        <feMerge>\n          <feMergeNode in="outShadow" />\n          <feMergeNode in="SourceGraphic" />\n        </feMerge>\n      </filter>\n    ',o[e.FILTER.SELECTED]='\n      <filter id="'+e.FILTER.SELECTED+'" height="160%" width="180%" y="-30%" x="-40%">\n        <feGaussianBlur stdDeviation="1" />\n        <feComponentTransfer result="outColor">\n          <feFuncR type="table" tableValues="1 1"></feFuncR>\n          <feFuncG type="table" tableValues="0.67 0.67"></feFuncG>\n          <feFuncB type="table" tableValues="0.21 0.21"></feFuncB>\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feGaussianBlur result="outShadow" in="outColor" stdDeviation="4" />\n        <feComposite in="SourceGraphic" in2="outShadow" operator="over" />\n      </filter>\n      ',o[e.FILTER.BOXSHADOW]='\n      <filter x="-47.9%" y="-43.8%" width="195.8%" height="195.8%" filterUnits="objectBoundingBox" id="'+e.FILTER.BOXSHADOW+'">\n        <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n        <feGaussianBlur stdDeviation="3" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n        <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.25 0" type="matrix" in="shadowBlurOuter1" result="outGlow"></feColorMatrix>\n        <feComposite in="SourceGraphic" in2="outGlow" operator="over"></feComposite>\n      </filter>\n      ',o[e.FILTER.SURROUND_SHADOW_DARK]='\n    <filter x="-21.1%" y="-23.1%" width="140.1%" height="142.5%" filterUnits="objectBoundingBox" id="'+e.FILTER.SURROUND_SHADOW_DARK+'">\n      <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n      <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n      <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.4 0" type="matrix" in="shadowBlurOuter1" result="outShadow"></feColorMatrix>\n      <feComposite in="SourceGraphic" in2="outShadow" operator="over"></feComposite>\n    </filter>\n    ',o[e.FILTER.DISABLED_HEAD_ICON]='\n      <filter id="'+e.FILTER.DISABLED_HEAD_ICON+'">\n        <feColorMatrix in="SourceGraphic" type="saturate" values="0" />\n      </filter>\n    ',o[e.FILTER.FOCUSED]="\n    <filter id="+e.FILTER.FOCUSED+' height="180%" width="160%" y="-40%" x="-30%">\n      <feGaussianBlur stdDeviation="1"></feGaussianBlur>\n      <feComponentTransfer result="outColor">\n        <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n      </feComponentTransfer>\n      <feGaussianBlur result="outShadow" in="outColor" stdDeviation="4"></feGaussianBlur>\n      <feComposite in="SourceGraphic" in2="outShadow" operator="over"></feComposite>\n    </filter>\n    ';var o,r=Array.prototype.map.call(t.children,function(t){return t.id});Object.keys(o).filter(function(t){return 0>r.indexOf(t)}).map(function(t){return i.dom.parse_to_SVG(o[t])}).forEach(function(e){t.appendChild(e)})},e.inject_comment_filters=function(t){var e={RED:["#FF838D","#F04E39"],BLUE:["#70C3FF","#3882FF"],GREEN:["#A1FF5C","#26E32D"],YELLOW:["#FFE06B","#FFB93A"]};Object.keys(e).forEach(function(o){if(i.base.is_comment_theme(o)){var r=i.dom.create_svg_element("linearGradient",{id:"CommentLinearGradient-"+o,x1:"50%",y1:"0%",x2:"50%",y2:"85.4676513%"},t);i.dom.create_svg_element("stop",{offset:"0%","stop-color":e[o][0]},r),i.dom.create_svg_element("stop",{offset:"100%","stop-color":e[o][1]},r)}})}},64138(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockAnimations=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(25507),c=o(37747),l=o(71288);e.BlockAnimations=function(){function t(){this.disconnectUiEffectTimeoutId=0}return t.prototype.dispose_ui_effect=function(t){var e=t.get_workspace(),o=t.get_svg_root(),i=e.get_injection_div();if(e.get_audio_manager().play("delete"),o&&i){var r=this.utils.get_injection_div_xy(o),s=e.get_scale(),a=(0,_.create_svg_element)("svg",{class:"blocklyBlockDisposeWrapper"});a.style.transformOrigin="left top",a.style.overflow="visible",this.utils.set_transform_style(a,r[0],r[1],s);var c=(0,_.clone_node)(o,!0);c.setAttribute("transform",""),a.appendChild(c),i.appendChild(a);var l=function t(){(0,_.remove_node)(a),c.removeEventListener("webkitAnimationEnd",t),c.removeEventListener("animationend",t),clearTimeout(h)};c.addEventListener("webkitAnimationEnd",l),c.addEventListener("animationend",l);var h=window.setTimeout(l,500),d=t.get_height_width();return c.setAttribute("transform-origin",(d.width/2-this.theme.renderer.BLOCK_LEFT_TOP[0])*s+"px "+(d.height/2-this.theme.renderer.BLOCK_LEFT_TOP[1])*s+"px"),c.classList.add("blocklyBlockDispose"),c}console.warn("UI effects cannot be played without svg group or injection div.")},t.prototype.connection_ui_effect=function(t){var e=t.get_svg_root();if(void 0==e)throw ReferenceError("Cannot connect ui effect to block without svg root.");var o=t.get_workspace();if(o.get_audio_manager().play("click"),!(1>o.get_scale())){var i=o.get_svg_xy(e);t.output_connection?s.vec2.add(i,i,[-3*o.get_scale(),13*o.get_scale()]):t.previous_connection&&s.vec2.add(i,i,[0*o.get_scale(),3*o.get_scale()]);var r=t.workspace.options.notch?t.workspace.get_scale()*(this.theme.renderer.NOTCH_WIDTH/2+this.theme.renderer.NTOCH_START_PADDING):0,a=(0,_.create_svg_element)("circle",{cx:i[0]+r,cy:i[1],r:0,fill:"#fff"},o.get_parent_svg());this.connection_ui_step(a,Date.now(),o.get_scale())}},t.prototype.connection_ui_step=function(t,e,o){var i=this,r=(Date.now()-e)/150;r>1?(0,_.remove_node)(t):(t.setAttribute("r",String(15*r*o)),t.style.opacity=String(1-r),window.setTimeout(function(){i.connection_ui_step(t,e,o)},10))},t.prototype.disconnect_ui_effect=function(t){t.workspace.get_audio_manager().play("disconnect"),!(1>t.workspace.get_scale())&&t.svg_group&&t.use_drag_surface&&(t.svg_group.classList.add("dd"),this.disconnectUiEffectTimeoutId=window.setTimeout(function(){t.svg_group.classList.remove("dd");var e=t.svg_group.getAttribute("transform");t.svg_group.setAttribute("transform",(void 0==e?"":e)+"skewX(0)")},100))},t.prototype.disconnect_ui_effect_stop=function(t){clearTimeout(this.disconnectUiEffectTimeoutId),t.svg_group.classList.remove("dd");var e=t.svg_group.getAttribute("transform");t.svg_group.setAttribute("transform",void 0==e?"":e)},t.prototype.toolbox_click_effect=function(){},t.prototype.block_flash_effect=function(t,e){if(e){var o,i,r,s,a,h,d,u,p=t.get_colour(),f=(0,c.rgb_to_hsv)(p.r,p.g,p.b),g=(0,c.hsv_to_rgb)({h:f.h,s:f.s+20,v:f.v-15}),v=new c.Color({r:g[0],g:g[1],b:g[2],a:p.a}),b=p.toString(),m=v.toString(),y=(0,_.create_svg_element)("animate",{id:"BlockFlashAnimation",attributeName:"fill",attributeType:"XML",values:b+" ; "+m+" ; "+b,dur:"1s",repeatCount:"indefinite",keyTimes:"0 ; 0.5; 1",calcMode:"spline",keySplines:"0.25,0.1,0.25,1;0.25,0.1,0.25,1"});return null!=(o=t.svg_path)&&o.removeAttribute("fill"),t.is_starting_block()&&(u=t.get_svg_root().querySelector(".blockly_head_icon_wrapper"))&&u.removeAttribute("fill"),t.is_output_block()&&t.parent_block?(null!=(i=t.svg_path)&&i.setAttribute("stroke","#FFFFFF"),null!=(r=t.svg_path)&&r.setAttribute("stroke-width","2px")):t.get_svg_root().setAttribute("filter","url(#"+l.FILTER.FOCUSED+")"),void t.get_svg_root().appendChild(y)}var k=t.svg_group.querySelector("#BlockFlashAnimation");k&&t.svg_group.removeChild(k),null!=(s=t.svg_path)&&s.removeAttribute("filter");var w=t.get_colour().toString();null!=(a=t.svg_path)&&a.setAttribute("fill",w),t.is_starting_block()&&(u=t.get_svg_root().querySelector(".blockly_head_icon_wrapper"))&&(u.setAttribute("fill",w),u.removeAttribute("filter")),null!=(h=t.svg_path)&&h.setAttribute("stroke",t.get_border_colour().toString()),null!=(d=t.svg_path)&&d.setAttribute("stroke-width",t.get_stroke_width())},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},21771(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(35009),_=o(25507),c=o(53137),l=o(82472);e.ContextMenu=function(){function t(){this.current_block=void 0,this.disabled=!1}return t.prototype.set_disabled=function(t){this.disabled=t},t.prototype.show=function(t,e,o){if(!this.disabled)if(this.widget_div.show(this,void 0),null!=(i=this.tooltip)&&i.hide(),Array.isArray(e)&&(e={source:"",options:e}),e.options.length){var i,r,s,_=this.populate_(e);this.position_(_,t,o),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.CONTEXT_MENU_OPEN,workspace_id:(null==(r=this.workspace_db.current)?void 0:r.id)||"",old_value:!1,new_value:!0,block_id:null==(s=this.current_block)?void 0:s.id})),window.setTimeout(function(){_.focus()},0)}else this.hide()},t.prototype.populate_=function(t){var e=this,o=document.createElement("div");o.setAttribute("tabindex","-1"),o.classList.add("menu-wrapper");for(var i=t.options,r=0;r<i.length;r++)!function(r){var s=i[r],a=document.createElement("div");if(a.classList.add("menu-item"),a.setAttribute("name",s.name),s.enabled||a.classList.add("menu_item_disable"),s.enabled&&a.classList.add("menu_item_enable"),s.icon){var c=void 0;if("string"==typeof s.icon)(c=new Image).src=s.icon,c.alt=s.text,c.style.verticalAlign="middle",c.draggable=!1;else{c=(0,_.create_svg_element)("svg",{width:16,height:16});var l=(0,_.clone_node)(s.icon,!0);c.appendChild(l)}c.style.marginRight="8px",a.appendChild(c)}var h=document.createElement("span");h.innerText=s.text,a.appendChild(h),s.selected&&a.classList.add("menu_item_selected"),s.attr&&s.attr.forEach(function(t){var e=t[0],o=t[1];"class"!==e?a.setAttribute(e,o):a.classList.add(o)}),o.appendChild(a),a.addEventListener("click",function(){var o;s.enabled&&(e.hide(),s.callback(),e.events.is_enabled()&&e.events.fire(e.contextmenu_option_event_factory({workspace_id:(null==(o=e.workspace_db.current)?void 0:o.id)||"",option_name:s.name,source:t.source})))})}(r);return o},t.prototype.position_=function(t,e,o){var i=(0,_.get_viewport_bbox)(),r={top:e.clientY,bottom:e.clientY,left:e.clientX,right:e.clientX};this.create_widget(t);var s=(0,c.get_size)(t);s.height=t.scrollHeight,o&&(0,c.adjust_bboxes_for_rtl)(i,r,s),this.widget_div.position_with_anchor(i,r,s,o),t.focus()},t.prototype.create_widget=function(t){this.widget_div.DIV.appendChild(t),t.classList.add("blocklyContextMenu"),this.events.bind_event_with_checks(t,"contextmenu",void 0,l.no_event)},t.prototype.hide=function(){var t,e;this.widget_div.hide_if_owner(this),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.CONTEXT_MENU_OPEN,workspace_id:(null==(t=this.workspace_db.current)?void 0:t.id)||"",old_value:!0,new_value:!1,block_id:null==(e=this.current_block)?void 0:e.id})),this.current_block=void 0},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.tooltip)],t.prototype,"tooltip",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.ContextMenuOptionEvent)],t.prototype,"contextmenu_option_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},76204(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Css=void 0;var i=o(31635),r=o(71519),s=o(36963);e.Css=function(){function t(){this.style_sheet=void 0,this.current_cursor="",this.media_path="",this.Cursor={OPEN:"handopen",CLOSED:"handclosed",DELETE:"handdelete"}}return t.prototype.inject=function(t,e){if(!this.style_sheet){var o=".blocklyDraggable {}\n";t&&(o+=this.CONTENT),this.media_path=e.replace(/[\\\/]$/,""),o=o.replace(/<<<PATH>>>/g,this.media_path);var i=document.createElement("style");if(document.head)document.head.insertBefore(i,document.head.firstChild);else{var r=document.createElement("head");r.insertBefore(i,r.firstChild),document.appendChild(r)}var s=document.createTextNode(o);i.appendChild(s),this.style_sheet=i.sheet}},t.prototype.set_cursor=function(t){if(this.current_cursor!=t){this.current_cursor=t;for(var e="url('"+this.media_path+"/"+t+".cur), auto",o=document.getElementsByClassName("blocklyToolboxDiv"),i=0;i<o.length;i++){var r=o[i];t==this.Cursor.DELETE?r.style.cursor=e:r.style.cursor=""}}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.css_content)],t.prototype,"CONTENT",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},85549(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DraggedConnectionManager=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(35009);e.DraggedConnectionManager=function(){function t(){this.top_block=void 0,this._workspace=void 0,this.local_connection=void 0,this.would_delete_block_=!1,this._available_connections=[],this.closest_connection=void 0,this.radius_connection=0}return t.prototype.would_delete_block=function(){return this.would_delete_block_},t.prototype.init=function(t){this.runtime_data.selected=t,this.top_block=t,this._workspace=t.get_workspace(),this._available_connections=this._init_available_connections(t)},t.prototype.dispose=function(){this.top_block=void 0,this._workspace=void 0,this._available_connections.length=0,this.closest_connection=void 0,this.local_connection=void 0},t.prototype.apply_connections=function(){if(this.closest_connection&&this.local_connection){if(this.local_connection.connect(this.closest_connection),this.top_block&&this.top_block.rendered){var t=this.local_connection.is_superior()?this.closest_connection:this.local_connection;this.block_animations.connection_ui_effect(t.get_source_block()),this.connection_effect()}this.remove_highlighting()}},t.prototype.connection_effect=function(){},t.prototype.disconnection_effect=function(){},t.prototype.update=function(t,e){var o=this.closest_connection,i=this.update_closest(t);i&&o&&o.unhighlight();var r=!!this.closest_connection&&e!=a.DeleteArea.DELETE_AREA_TOOLBOX;if(this.top_block){var s=!!e&&!this.top_block.get_parent()&&this.top_block.is_deletable();this.would_delete_block_=s&&!r}!this.would_delete_block_&&i&&this.closest_connection&&this.add_highlighting()},t.prototype.remove_highlighting=function(){this.closest_connection&&this.closest_connection.unhighlight()},t.prototype.add_highlighting=function(){this.closest_connection&&this.closest_connection.highlight()},t.prototype._init_available_connections=function(t){var e=t.get_connections(!1),o=t.last_connection_in_stack();return o&&o!=t.next_connection&&e.push(o),e.filter(function(t){return t.in_db})},t.prototype.update_closest=function(t){var e=this.closest_connection;this.closest_connection=void 0,this.local_connection=void 0,this.radius_connection=this.theme.blink_params.SNAP_RADIUS;for(var o=0;o<this._available_connections.length;o++){var i=this._available_connections[o],r=i.closest(this.radius_connection,t);r.connection&&(this.closest_connection=r.connection,this.local_connection=i,this.radius_connection=r.radius)}return e!=this.closest_connection},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},80278(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.InsertionMarkerManager=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(35009);e.InsertionMarkerManager=function(){function t(){this.top_block=void 0,this._workspace=void 0,this.last_on_stack=void 0,this.last_marker=void 0,this.closest_connection=void 0,this.first_marker=void 0,this.local_connection=void 0,this.would_delete_block_=!1,this.marker_connection=void 0,this.highlighting_block=!1,this.highlighted_block=void 0,this._available_connections=[]}return t.prototype.init=function(t){this.runtime_data.selected=t,this.top_block=t,this._workspace=t.get_workspace(),this.top_block.output_connection||(this.first_marker=this.create_marker_block(this.top_block)),this._available_connections=this._init_available_connections(t)},t.prototype.create_marker_block=function(t){var e,o=t.type;this.events.disable();try{if(void 0==this._workspace)throw ReferenceError("Trying to create marker before init the insertion marker manager.");(e=this.block_factory({prototype_name:o,workspace:this._workspace,is_insertion_marker:!0})).set_insertion_marker(!0),0===e.inputList.length&&e.appendDummyInput(),e.init_svg()}finally{this.events.enable()}return e},t.prototype.would_delete_block=function(){return this.would_delete_block_},t.prototype._init_available_connections=function(t){var e=t.get_connections(!1),o=t.last_connection_in_stack();return o&&(e.push(o),this.last_on_stack=o,this.last_marker=this.create_marker_block(o.get_source_block())),e.filter(function(t){return t.in_db})},t.prototype.get_start_radius=function(){return this.closest_connection&&this.local_connection?this.theme.blink_params.CONNECTING_SNAP_RADIUS:this.theme.blink_params.SNAP_RADIUS},t.prototype._get_candidate=function(t){for(var e=this.get_start_radius(),o=void 0,i=void 0,r=0;r<this._available_connections.length;r++){var s=this._available_connections[r],a=s.closest(e,t);a.connection&&(o=a.connection,i=s,e=a.radius)}return{closest:o,local:i,radius:e}},t.prototype.should_delete=function(t,e){if(void 0==this.top_block)throw ReferenceError("Deleting block not found.");var o=t&&!!t.closest&&e!==a.DeleteArea.DELETE_AREA_TOOLBOX;return!!e&&!this.top_block.get_parent()&&this.top_block.is_deletable()&&!o},t.prototype.should_update_previews=function(t,e){var o=t.local,i=t.closest,r=t.radius;if(!o||!i)return!(!this.local_connection||!this.closest_connection);if(o.type===a.CONNECTION_TYPE.OUTPUT_VALUE)return!0;if(this.local_connection&&this.closest_connection){if(this.closest_connection==i)return!1;var s=this.local_connection.get_xy()[0]+e[0]-this.closest_connection.get_xy()[0],_=this.local_connection.get_xy()[1]+e[1]-this.closest_connection.get_xy()[1],c=Math.sqrt(s*s+_*_);return!(i&&r>c-this.theme.blink_params.CURRENT_CONNECTION_PREFERENCE)}return!this.local_connection&&!this.closest_connection||(console.error("Only one of localConnection_ and closestConnection_ was set."),console.error("Returning true from shouldUpdatePreviews, but it's not clear why."),!0)},t.prototype.unhighlight_block=function(){var t=this.closest_connection,e=this.highlighted_block;if(void 0==t||void 0==e)throw ReferenceError("Connection not found for unhighlight.");e.highlight_for_replacement(!1),this.highlighted_block=void 0,this.highlighting_block=!1},t.prototype.disconnect_marker=function(){if(this.marker_connection){var t=this.marker_connection,e=t.get_source_block(),o=e.next_connection,i=e.previous_connection;if(t!=o||i&&i.get_targe_connection())if(t.type==a.CONNECTION_TYPE.NEXT_STATEMENT&&t!=o){var r=t.get_targe_connection();if(void 0==r)throw ReferenceError("Connection not found when disconnect marker.");r.get_source_block().unplug(!1);var s=i?i.get_targe_connection():void 0;e.unplug(!0),s&&s.connect(r)}else e.unplug(!0);else{var _=t.targetBlock();if(void 0==_)throw ReferenceError("Target block not found when disconnect marger.");_.unplug(!1)}if(t.get_targe_connection())throw Error("markerConnection_ still connected at the end of disconnectInsertionMarker");this.marker_connection=void 0;var c=e.get_svg_root();void 0!=c&&c.setAttribute("visibility","hidden")}},t.prototype.hide_preview=function(){this.highlighting_block?this.unhighlight_block():this.marker_connection&&this.disconnect_marker()},t.prototype.maybe_hide_preview=function(t){t.closest||this.hide_preview();var e=this.closest_connection&&this.local_connection,o=this.closest_connection!=t.closest,i=this.local_connection!=t.local;e&&(o||i||this.would_delete_block_)&&this.hide_preview(),this.marker_connection=void 0,this.closest_connection=void 0,this.local_connection=void 0},t.prototype.should_replace=function(){var t=this.closest_connection,e=this.local_connection;if(void 0==e)throw ReferenceError("Local connection not found when trying replace/insert block.");if(void 0==this.top_block)throw ReferenceError("Block not found when trying replace/insert block.");return e.type==a.CONNECTION_TYPE.OUTPUT_VALUE||e!=e.get_source_block().get_first_statement_connection()&&!(this.top_block.next_connection||e.type!=a.CONNECTION_TYPE.PREVIOUS_STATEMENT||void 0==t||!t.is_connected())},t.prototype.highlight_block=function(){var t=this.closest_connection,e=this.local_connection;if(void 0!=t&&void 0!=e){var o=t.targetBlock();o&&(this.highlighted_block=o,o.highlight_for_replacement(!0)),this.highlighting_block=!0}},t.prototype.connect_marker=function(){var t=this.local_connection,e=this.closest_connection;if(void 0!=e){var o=this.last_on_stack&&t==this.last_on_stack?this.last_marker:this.first_marker;if(void 0!=o&&void 0!=t){var i=o.get_matching_connection(t.get_source_block(),t);if(void 0!=i){if(i==this.marker_connection)throw Error("Made it to connect_marker even though the marker isn't changing");o.render();var r=o.get_svg_root();void 0!=r&&r.setAttribute("visibility","visible"),o.position_new_block(o,i,e),i.connect(e),this.marker_connection=i}}}},t.prototype.show_preview=function(){this.should_replace()?this.highlight_block():this.connect_marker()},t.prototype.maybe_show_preview=function(t){if(!this.would_delete_block_){var e=t.closest,o=t.local;e&&!(e==this.closest_connection||e.source_block.is_insertion_marker())&&(this.closest_connection=e,this.local_connection=o,this.show_preview())}},t.prototype.update=function(t,e){var o=this._get_candidate(t);this.would_delete_block_=this.should_delete(o,e),(this.would_delete_block_||this.should_update_previews(o,t))&&(this.events.disable(),this.maybe_hide_preview(o),this.maybe_show_preview(o),this.events.enable())},t.prototype.apply_connections=function(){if(void 0==this.top_block)throw ReferenceError("Top block not found when applying connections.");if(this.highlighting_block&&this.highlighted_block?this.closest_connection=(null==(t=this.highlighted_block.output_connection)?void 0:t.target_connection)||(null==(e=this.highlighted_block.previous_connection)?void 0:e.target_connection):this.marker_connection&&(this.closest_connection=this.marker_connection.target_connection),this.closest_connection){if(this.events.disable(),this.hide_preview(),this.events.enable(),this.local_connection&&this.local_connection.connect(this.closest_connection),this.top_block.is_rendered()){if(this.local_connection){var t,e,o=this.local_connection.is_superior()?this.closest_connection:this.local_connection;this.block_animations.connection_ui_effect(o.get_source_block())}this.top_block.get_root_block().bring_to_front()}return!0}return!1},t.prototype.dispose=function(){this.top_block=void 0,this._workspace=void 0,this._available_connections.length=0,this.closest_connection=void 0,this.local_connection=void 0,this.events.disable();try{this.first_marker&&(this.first_marker.dispose(),this.first_marker=void 0),this.last_marker&&(this.last_marker.dispose(),this.last_marker=void 0)}finally{this.events.enable()}this.highlighted_block=void 0},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.BlockSvg)],t.prototype,"block_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},97839(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Events=void 0;var i=o(31635),r=o(71519),s=o(68865),a=o(62879),_=o(35009),c=o(89221);e.Events=function(){function t(){this.FIRE_QUEUE_=[],this.disabled_=0,this.group_="",this._record_undo=!0,this._is_undoing=!1,this.enable_filter=!1,this.listener_disabled=0}return t.prototype.set_disabled=function(t){this.disabled_=t},t.prototype.is_record_undo=function(){return this._record_undo},t.prototype.set_record_undo=function(t){this._record_undo=t},t.prototype.is_undoing=function(){return this._is_undoing},t.prototype.set_undoing=function(t){this._is_undoing=t},t.prototype.fire=function(t){var e=this;if(t&&this.is_enabled())if(t.is_record_undo()&&this.enable_filter)this.FIRE_QUEUE_.length||window.setTimeout(function(){e.fire_now()},0),this.FIRE_QUEUE_.push(t);else{var o=this.workspace_db.get(t.get_workspace_id());o&&o.fire_change_listener(t)}},t.prototype.fire_now=function(){var t=this.filter(this.FIRE_QUEUE_,!0);this.FIRE_QUEUE_.length=0;for(var e=0;e<t.length;e++){var o=t[e],i=this.workspace_db.get(o.get_workspace_id());i&&i.fire_change_listener(o)}},t.prototype.filter=function(t,e){var o=t.slice();e||o.reverse();for(var i=[],r=new Map,s=0;s<o.length;s++){var a=o[s];if(!a.is_null()){var c="",l="";a.type===_.BlockEventType.CHANGE&&(c=a.element||"",l=a.get_name()||"");var h=a.type+"&&"+a.get_block_id()+"&&"+a.get_workspace_id()+"&&"+c+"&&"+l,d=r.get(h);if(d)switch(a.type){case _.BlockEventType.MOVE:if(d.index===s-1){var u=a.get_new_loc();d.event.update_new_loc(u),d.index=s}else r.set(h,{index:s,event:a}),i.push(a);break;case _.BlockEventType.CHANGE:d.event.update_new_value(a.get_new_value());break;default:r.set(h,{index:s,event:a}),i.push(a)}else r.set(h,{index:s,event:a}),i.push(a)}}return o=i.filter(function(t){return!t.is_null()}),e||o.reverse(),o},t.prototype.clear_pending_undo=function(){for(var t=0;t<this.FIRE_QUEUE_.length;t++)this.FIRE_QUEUE_[t].set_record_undo(!1)},t.prototype.disable=function(){this.disabled_++},t.prototype.enable=function(){this.disabled_--},t.prototype.is_enabled=function(){return 0==this.disabled_},t.prototype.get_group=function(){return this.group_},t.prototype.set_group=function(t){var e=this.group_;if(this.group_="boolean"==typeof t?t?(0,c.gen_uid)():"":t,e&&e!==this.group_&&this.is_enabled()){var o=this.group_event_factory({type:_.GroupEventType.GroupEnd,group:e});this.fire(o)}if(this.group_&&e!==this.group_&&this.is_enabled()){var i=this.group_event_factory({type:_.GroupEventType.GroupStart,group:this.group_});this.fire(i)}},t.prototype.disable_orphans=function(t){if(t.type==_.BlockEventType.MOVE||t.type==_.BlockEventType.CREATE){this.disable();var e=this.workspace_db.get(t.get_workspace_id());if(void 0==e)return console.error("Trying to enable/disable a block when the workspace disposed."),void this.enable();var o=e.get_block_by_id(t.get_block_id());if(void 0!=o){var i=o.get_parent();if(i&&!i.disabled)for(var r=o.get_descendants(),s=0;s<r.length;s++)r[s].set_disabled(!1);else if((o.output_connection||o.previous_connection)&&!e.is_dragging())do o.set_disabled(!0),o=o.get_next_block();while(o)}this.enable()}},t.prototype.bind_event=function(t,e,o,i){var r=this,s=function(t){o?i.call(o,t):i(t)};t.addEventListener(e,s,!1);var a={original:{target:t,name:e,listener:s},additional:[]};if(e in this.touch_manager.TOUCH_MAP)for(var _=function(t){if(1==t.changedTouches.length){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}s(t),a.original&&r.unbind_original(a)},c=0;c<this.touch_manager.TOUCH_MAP[e].length;c++){var l=this.touch_manager.TOUCH_MAP[e][c];t.addEventListener(l,_,!1),a.additional.push({target:t,name:l,listener:_})}return a},t.prototype.unbind_event_by_data=function(t){var e=t.target,o=t.name,i=t.listener;return e.removeEventListener(o,i,!1),i},t.prototype.unbind_original=function(t){var e;return t.original&&(e=this.unbind_event_by_data(t.original),t.original=void 0),e},t.prototype.unbind_event=function(t){for(var e=this.unbind_original(t);t.additional.length>0;){var o=t.additional.pop();e=this.unbind_event_by_data(o)}return e},t.prototype.bind_event_with_checks=function(t,e,o,i,r,s){var a=this,_=function(t){if(t.target instanceof Element)for(var e=!r,s=a.touch_manager.split_event_by_touches(t),_=0;_<s.length;_++){var c=s[_];if(2===s.length)return;e&&!a.touch_manager.should_handle_event(c)||(a.touch_manager.set_client_from_touch(c),o?i.call(o,c):i(c))}};t.addEventListener(e,_,!1);var c={original:{target:t,name:e,listener:_},additional:[]};if(e in this.touch_manager.TOUCH_MAP)for(var l=function(t){_(t),c.original&&a.unbind_original(c),s||0!=t.cancelable&&t.preventDefault()},h=0;h<this.touch_manager.TOUCH_MAP[e].length;h++){var d=this.touch_manager.TOUCH_MAP[e][h];t.addEventListener(d,l,!1),c.additional.push({target:t,name:d,listener:l})}return c},t.prototype.enable_listener=function(){this.listener_disabled++},t.prototype.disable_listener=function(){this.listener_disabled--},t.prototype.is_listener_enabled=function(){return 0===this.listener_disabled},(0,i.__decorate)([(0,a.lazy_inject)(s.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,a.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,a.lazy_inject)(s.BINDING.GroupEvent)],t.prototype,"group_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},16800(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Extensions=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(35009),_=o(82267),c=o(86295);e.Extensions=function(){function t(){this.extensions={},this.mutators={},this.MUTATOR_PROPERTIES_=["domToMutation","mutationToDom"]}return t.prototype.register=function(t,e){if((0,_.string_is_empty_or_whitespace)(t))throw Error('Error when registering extension "'+t+'": invalid extension name. ');this.extensions[t]?console.error('Error when registering extension "'+t+'": extension existed.'):this.extensions[t]=e},t.prototype.register_mixin=function(t,e){var o=this.check_existed_mutator_property(e);if(o)throw Error('Error when registering extension "'+t+'": Trying to register mixin with mutator property: '+o+". ");this.register(t,function(){this.mixin(e)})},t.prototype.unregister=function(t){t in this.extensions&&delete this.extensions[t]},t.prototype.register_mutator=function(t,e,o){for(var i=0;i<this.MUTATOR_PROPERTIES_.length;i++){var r=this.MUTATOR_PROPERTIES_[i];if(!e.hasOwnProperty(r))throw Error('Error when registering mutator "'+t+'": missing required property "'+r+'". ');if(!(0,c.is_func)(e[r]))throw Error('Error when registering mutator "'+t+'": required property "'+r+'" must be a function. ')}this.mutators[t]=function(){this.mixin(e),o&&o.apply(this)}},t.prototype.unregister_mutator=function(t){t in this.mutators&&delete this.mutators[t]},t.prototype.apply=function(t,e){var o='Error when applying extension "'+t+'": ',i=this.extensions[t];if(!(0,c.is_func)(i))throw Error(o+"extension not found.");var r=this.get_mutator_properties(e);if(i.apply(e),!this.mutator_properties_match(r,e))throw Error(o+"mutation properties changed when applying a non-mutator extension.")},t.prototype.apply_mutator=function(t,e){var o='Error when applying mutator "'+t+'": ',i=this.mutators[t];if(!(0,c.is_func)(i))throw Error(o+"mutator not found.");var r=this.check_existed_mutator_property(e);if(r)throw Error(o+"mutation property "+r+" already existed on block "+e);i.apply(e);var s=this.check_absent_mutator_property(e);if(s)throw Error(o+"applied a mutator didn't add \""+s+'"')},t.prototype.check_existed_mutator_property=function(t){for(var e=0;e<this.MUTATOR_PROPERTIES_.length;e++){var o=this.MUTATOR_PROPERTIES_[e];if(t.hasOwnProperty(o))return o}},t.prototype.check_absent_mutator_property=function(t){for(var e=0;e<this.MUTATOR_PROPERTIES_.length;e++){var o=this.MUTATOR_PROPERTIES_[e];if(!t.hasOwnProperty(o))return o}},t.prototype.get_mutator_properties=function(t){for(var e=[],o=0;o<this.MUTATOR_PROPERTIES_.length;o++)e.push(t[this.MUTATOR_PROPERTIES_[o]]);return e},t.prototype.mutator_properties_match=function(t,e){var o=this.get_mutator_properties(e);if(o.length!=t.length)return!1;for(var i=0;i<o.length;i++)if(t[i]!=o[i])return!1;return!0},t.prototype.build_tooltip_for_dropdown=function(t,e){var o=this,i=[];document&&this.utils.run_after_page_load(function(){for(var t in e)o.utils.check_message_references(e[t])});var r=this;return function(){var o=this;this.type&&-1===i.indexOf(this.type)&&(r.check_dropdown_options_in_table(this,t,e),i.push(this.type)),this.set_tooltip(function(){var s=o.get_field_value(t),a=s?e[s]:void 0;if(void 0==a){if(-1===i.indexOf(o.type)){var _="No tooltip mapping for value "+s+" of field "+t;void 0!=o.type&&(_+=" of block type "+o.type),console.warn(_+".")}}else a=r.utils.replace_message_references(a);return a||""})}},t.prototype.check_dropdown_options_in_table=function(t,e,o){var i=t.get_field(e);if(i&&(0,c.is_func)(i.is_dynamic)&&!i.is_dynamic())for(var r=i.get_options(),s=0;s<r.length;++s){var _=r[s][a.OptionTypes.VALUE];(void 0==_||void 0==o[_])&&console.warn("No tooltip mapping for value "+_+" of field "+e+" of block type "+t.type)}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},64689(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Json=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(35009),c=o(99469),l=o(89221),h=o(86295),d=o(25507),u=o(19673);e.Json=function(){function t(){}return t.prototype.comment_to_json=function(t){var e=t.get_parent_block(),o=t.get_bubble_size(),i=t.get_relative_position();return{id:t.id,parent_id:void 0===e?null:e.id,text:t.get_text(),pinned:t.is_expanded(),size:[o.width,o.height],location:[i[0],i[1]],auto_layout:t.is_auto_layout(),color_theme:t.get_color_theme()}},t.prototype.comment_dom_to_json=function(t,e,o){if("comment"!==t.tagName.toLowerCase())throw Error("Trying to convert a non-comment dom into comment json.");var i={id:e||t.getAttribute("id")||(0,l.gen_uid)(),parent_id:o||null,text:t.textContent||"",pinned:"true"===t.getAttribute("pinned"),auto_layout:"true"===t.getAttribute("auto_layout"),size:null,location:null,color_theme:null},r=parseInt(t.getAttribute("w")||"",10),s=parseInt(t.getAttribute("h")||"",10);isNaN(r)||isNaN(s)||(i.size=[r,s]);var a=parseFloat(t.getAttribute("relativeleft_")||""),_=parseFloat(t.getAttribute("relativetop_")||"");isNaN(a)||isNaN(_)||(i.location=[a,_]);var c=t.getAttribute("color_theme");return(0,h.is_comment_theme)(c)&&(i.color_theme=c),i},t.prototype.merge_workspace_data=function(t,e){function o(t,e){Object.keys(e).forEach(function(o){t[o]=e[o]})}o(t.blocks,e.blocks),o(t.connections,e.connections),o(t.comments,e.comments)},t.prototype.block_to_json=function(t){var e=this,o={blocks:{},connections:{},comments:{}};o.connections[t.id]={};var i={},r={},s={},a={};t.inputList.map(function(c){if(c.fieldRow.forEach(function(t){if(t.editable&&"string"==typeof t.name)if((0,h.is_field_number)(t)){var e=void 0;i[e=t.allow_text&&!(0,l.is_valid_number)(t.get_value())?"TEXT":t.name]=t.get_value(),r[e]={min:t.min_,max:t.max_,precision:t.precision_,mod:t.mod_||null};var o=t.get_controller_option();o&&(void 0===s[t.name]&&(s[t.name]={}),s[e].controller_type=o.type,o.type===_.ControllerType.SLIDER?(s[e].left_text=o.left_text,s[e].right_text=o.right_text):o.type===_.ControllerType.COLOR_PICKER&&(s[e].color_format=o.color_format,s[e].line=o.line))}else(0,h.is_field_default_value)(t)?(i[t.name]=t.get_value(),void 0===s[t.name]&&(s[t.name]={}),s[t.name].has_been_edited=t.get_has_been_edited()):i[t.name]=t.get_value()}),c.name){var d,u,p=null==(d=c.connection)?void 0:d.get_shadow_string();a[c.name]=p||""}var f=null==(u=c.connection)?void 0:u.targetBlock();if(f){var g=e.block_to_json(f);e.merge_workspace_data(o,g),o.connections[t.id][f.id]={type:"input",input_type:c.type===_.InputType.VALUE?"value":"statement",input_name:c.name}}}),t.comment&&(o.comments[t.comment.id]=this.comment_to_json(t.comment));var c=t.get_location(),d=t.mutation_to_string();o.blocks[t.id]={type:t.type,id:t.id,comment:void 0===t.comment?null:t.comment.id,is_shadow:t.is_shadow(),collapsed:t.is_collapsed(),disabled:t.disabled,deletable:t.deletable_,movable:t.movable_,editable:t.editable_,visible:t.visibility_,location:[c[0],c[1]],shadows:a,fields:i,field_constraints:r,field_extra_attr:s,mutation:d,is_output:!!t.output_connection,parent_id:void 0===t.parent_block?null:t.parent_block.id};var u=t.get_next_block();if(u){var p=this.block_to_json(u);this.merge_workspace_data(o,p),o.connections[t.id][u.id]={type:"next"}}return o},t.prototype.workspace_to_json=function(t){var e=this,o={blocks:{},connections:{},comments:{}};return t.get_top_blocks(!1).forEach(function(t){var i=e.block_to_json(t);e.merge_workspace_data(o,i)}),t.get_top_comments(!1).forEach(function(t){o.comments[t.id]=e.comment_to_json(t)}),o},t.prototype.json_to_block_headless=function(t,e,o){void 0===o&&(o=!0);var i=e.new_block(t.type,t.id);return this.parse_block_data(t,i,o)},t.prototype.parse_block_data=function(t,e,o){void 0===o&&(o=!0),null!==t.is_shadow&&e.set_shadow(t.is_shadow),null!==t.collapsed&&e.set_collapsed(t.collapsed),null!==t.disabled&&e.set_disabled(t.disabled),e.set_deletable(t.deletable),e.set_movable(t.movable),e.set_editable(t.editable);var i=(0,u.parse_visibility)(t.visible);return i&&e.set_visibility(i),t.type!==e.type&&console.warn("Trying to set invalid block data to block: ",e),e.string_to_mutation(t.mutation),e.inputList.forEach(function(e){var o;e.fieldRow.forEach(function(e){if(e.editable&&void 0!==e.name){var o=e.name;if((0,h.is_field_number)(e)){void 0===t.fields.NUM&&void 0!==t.fields.TEXT&&(o="TEXT",e.set_allow_text(!0));var i,r=t.field_constraints[o];void 0!==r&&(e.set_constraints(r.min,r.max,r.precision),null!==r.mod&&(e.mod_=r.mod)),void 0!==(i=t.field_extra_attr&&t.field_extra_attr[o])&&void 0!==i.controller_type&&("SLIDER"===i.controller_type?e.set_controller_option({type:_.ControllerType.SLIDER,left_text:i.left_text||"",right_text:i.right_text||""}):i.controller_type===_.ControllerType.COLOR_PICKER?e.set_controller_option({type:_.ControllerType.COLOR_PICKER,color_format:i.color_format,line:i.line}):e.set_controller_option({type:_.ControllerType.ANGLE_SCALE}))}if((0,h.is_field_default_value)(e)&&void 0!==(i=t.field_extra_attr&&t.field_extra_attr[o])&&void 0!==i.has_been_edited){var s=i.has_been_edited;e.set_has_been_edited(s)}var a=t.fields[o];void 0!==a&&void 0!==e.call_validator(a)&&"FieldImage"!==e.field_type&&e.set_value(a)}}),e.connection&&t.shadows[e.name]&&((null==(o=e.connection.targetBlock())?void 0:o.is_shadow())&&e.connection.remove_shadow(),e.connection.set_shadow_from_string(t.shadows[e.name]))}),t.location&&o&&e.move_by(s.vec2.fromValues(t.location[0],t.location[1])),e},t.prototype.comment_json_to_dom=function(t){var e=(0,d.create_dom)("comment",void 0,t.text);return null!==t.color_theme&&e.setAttribute("pinned",""+(t.pinned||!1)),t.size&&(e.setAttribute("h",""+t.size[1]),e.setAttribute("w",""+t.size[0])),t.location&&(e.setAttribute("relativeleft_",""+t.location[0]),e.setAttribute("relativetop_",""+t.location[1])),null!==t.auto_layout&&e.setAttribute("auto_layout",""+t.auto_layout),t.color_theme&&e.setAttribute("color_theme",""+t.color_theme),e.setAttribute("id",t.id),e},t.prototype.json_to_comment_headless=function(t,e){if(t.parent_id){var o,i=e.get_block_by_id(t.parent_id);if(!i)throw Error("Comment parent block not found");i.set_comment_text("",t.id),(0,c.assert)(i.comment,"Create block comment failed."),o=i.comment}else o=e.new_workspace_comment(void 0,t.id);null!==t.text&&o.set_text(t.text),null!==t.pinned&&o.set_expanded(t.pinned),t.size&&o.set_bubble_size(t.size[0],t.size[1]),t.location&&(o.set_relative_position(s.vec2.fromValues(t.location[0],t.location[1])),o.get_parent_block()||o.move_by(s.vec2.fromValues(t.location[0],t.location[1]))),null!==t.auto_layout&&o.set_auto_layout(t.auto_layout);var r=t.color_theme;return(0,h.is_comment_theme)(r)&&o.set_color_theme(r,!0),o},t.prototype.json_to_workspace_headless=function(t,e){var o=this,i=t.blocks,r=t.connections,s=t.comments,a=[];if(i&&Object.keys(i).forEach(function(t){o.json_to_block_headless(i[t],e,!1),a.push(t)}),r){var _=[];Object.keys(r).forEach(function(t){Object.keys(r[t]).forEach(function(s){var a=r[t][s],c=e.get_block_by_id(t),l=e.get_block_by_id(s);if(c&&l){if("next"===a.type)h=c.next_connection,d=l.previous_connection;else{var h,d,u=c.get_input(a.input_name);h=u&&u.connection,d=l.output_connection||l.previous_connection}if(!h||!d)return l.is_shadow()?(l.dispose(),void console.error("Connected connection not found. Shadow block disposed.")):void console.error("Connected connection not found.");d.context?_.push({inferior:d,superior:h}):o.try_connect(d,h,i)}else console.error("Connected block not found. ")})}),_.forEach(function(t){o.try_connect(t.inferior,t.superior,i)}),a.forEach(function(t){var o;null!=(o=e.get_block_by_id(t))&&o.respawn_all_shadows()})}return s&&Object.keys(s).forEach(function(t){o.json_to_comment_headless(s[t],e),a.push(t)}),a},t.prototype.try_connect=function(t,e,o){if(e.connect(t,!0))o&&t.source_block.is_shadow()&&this.parse_block_data(o[t.source_block.id],t.source_block,!1);else{if(this.runtime_data.is_pasting())t.source_block.dispose(!1,!1);else for(var i=t.source_block.get_descendants(!1),r=i.length-1;r>=0;r--)i[r].init_svg(),i[r].update_collapsed(),i[r].render(!1);e.respawn_shadow()}},t.prototype.json_to_workspace=function(t,e){var o=this.events.get_group();o||this.events.set_group(!0);var i=e.is_resizes_enabled();i&&e.set_resizes_enabled(!1),this.utils.start_text_cache();var r=[];try{this.events.disable(),r=this.json_to_workspace_headless(t,e),e.rendered&&this.render_blocks_and_comments(e,r,t.blocks||{})}catch(t){throw Error("Something wrong with json data. Unable to convert it to workspace.")}finally{this.events.enable(),o||this.events.set_group(!1),i&&e.set_resizes_enabled(!0),this.utils.stop_text_cache()}return r},t.prototype.render_blocks_and_comments=function(t,e,o){var i=this;t.get_top_blocks(!1).forEach(function(t){if(!(0>e.indexOf(t.id))){i.events.disable();try{t.set_connections_hidden(!0);for(var r=t.get_descendants(!1),a=r.length-1;a>=0;a--)r[a].init_svg();for(a=r.length-1;a>=0;a--)r[a].update_collapsed(),r[a].render(!1);for(a=r.length-1;a>=0;a--){var _=r[a];_.comment&&_.comment.init_svg()}var c=o[t.id];c.location&&t.move_by(s.vec2.fromValues(c.location[0],c.location[1])),window.setTimeout(function(){void 0!=t&&void 0!=t.get_workspace()&&t.set_connections_hidden(!1)},1)}finally{t.update_disabled(),i.events.enable()}i.events.is_enabled()&&i.events.fire(i.create_event_factory({block:t}))}}),t.get_top_comments(!1).forEach(function(t){0>e.indexOf(t.id)||t.init_svg()})},t.prototype.reset_element_ids=function(t){var e=JSON.stringify(t);function o(t,e,o){return t.replace(RegExp(e.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&"),"g"),o)}return Object.keys(t.blocks).forEach(function(t){e=o(e,t,(0,l.gen_uid)())}),Object.keys(t.comments).forEach(function(t){e=o(e,t,(0,l.gen_uid)())}),JSON.parse(e)},t.prototype.get_block_data_by_id=function(t,e){var o={blocks:{},connections:{},comments:{}},i=[];if(!function t(e,o){var r=o[e];if(void 0!==r&&(i.push(e),Object.keys(r).length))for(var s in r)t(s,o)}(e,t.connections),i.length){for(var r=0;r<i.length;r++)!function(t,e){o.blocks[e]=t.blocks[e],o.connections[e]=t.connections[e];var i=t.blocks[e].comment;i&&(o.comments[i]=t.comments[i])}(t,i[r]);return o}},t.prototype.workspace_dom_to_json=function(t){var e,o={blocks:{},connections:{},comments:{}},i=new Set;Array.from(t.querySelectorAll("block")).forEach(function(t){var e=t.getAttribute("id");e&&i.add(e)});for(var r=t.childNodes.length,s=0;s<r;s++)if(t.childNodes[s].nodeType!==_.NodeType.TEXT){var a=t.childNodes[s],c=a.tagName.toLowerCase();if("block"===c){var h=this.block_dom_to_json(a,void 0,i);this.merge_workspace_data(o,h)}else if("comment"===c){var d=a.getAttribute("id")||(0,l.gen_uid)(),u=this.comment_dom_to_json(a,d);h={blocks:{},connections:{},comments:((e={})[d]=u,e)},this.merge_workspace_data(o,h)}else console.error(c+" cannot be a top-level element.")}return o},t.prototype.block_dom_to_json=function(t,e,o){void 0===o&&(o=new Set);var i={blocks:{},connections:{},comments:{}},r=t.nodeName.toLowerCase(),s=t.getAttribute("id")||"";i.connections[s]={};for(var a=t.getAttribute("x")||"0",c=t.getAttribute("y")||"0",h=null,d="",p={},f={},g={},v={},b=t.childNodes.length,m=0;m<b;m++)if(t.childNodes[m].nodeType!==_.NodeType.TEXT){var y=t.childNodes[m],k=y.tagName.toLowerCase();if("field"!==k)if("comment"!==k)if("mutation"!==k)if("value"!==k){if("statement"!==k)if("next"!==k);else{if("true"===y.getAttribute("last_next_in_stack"))continue;for(w=0;w<y.childNodes.length;w++)y.childNodes[w].nodeType!==_.NodeType.TEXT&&"block"===(N=(O=y.childNodes[w]).tagName.toLowerCase())&&(E=O.getAttribute("id")||"",i.connections[s][E]={type:"next"},S=this.block_dom_to_json(O,s,o),this.merge_workspace_data(i,S))}else for(var w=0;w<y.childNodes.length;w++)if(y.childNodes[w].nodeType!==_.NodeType.TEXT&&(p[T=y.getAttribute("name")||""]="","block"===(N=(O=y.childNodes[w]).tagName.toLowerCase()))){var E=O.getAttribute("id")||"";i.connections[s][E]={type:"input",input_type:"statement",input_name:T},S=this.block_dom_to_json(O,s,o),this.merge_workspace_data(i,S)}}else{for(var T=y.getAttribute("name")||"",x=void 0,I=void 0,w=0;w<y.childNodes.length;w++)if(y.childNodes[w].nodeType!==_.NodeType.TEXT){if("shadow"===(N=(O=y.childNodes[w]).tagName.toLowerCase())||"empty"===N){var O,N,C=O.getAttribute("id");C&&o.has(C)&&O.setAttribute("id",this.utils.gen_uid()),p[T]=this.utils.dom_to_string(O),x=O}"block"===N&&(I=O)}if(I){var A=I.getAttribute("id")||"";i.connections[s][A]={type:"input",input_type:"value",input_name:T};var S=this.block_dom_to_json(I,s,o);this.merge_workspace_data(i,S)}else if(x){A=x.getAttribute("id")||"",i.connections[s][A]={type:"input",input_type:"value",input_name:T};var S=this.block_dom_to_json(x,s,o);this.merge_workspace_data(i,S)}}else d=this.utils.dom_to_string(y);else{h=y.getAttribute("id")||(0,l.gen_uid)();var L=this.comment_dom_to_json(y,h,s);i.comments[h]=L}else{var D=y.getAttribute("name")||"";f[D]=y.textContent||"";var R=y.getAttribute("constraints");null!==R&&(g[D]=(0,u.parse_constraints)(R));var M=y.getAttribute("has_been_edited");null!==M&&(v[D]={has_been_edited:"true"===M})}}return i.blocks[s]={type:t.getAttribute("type")||"",id:s,is_shadow:"block"!==r,collapsed:"true"===t.getAttribute("collapsed"),disabled:"true"===t.getAttribute("disabled"),deletable:"false"!==t.getAttribute("deletable"),movable:"false"!==t.getAttribute("movable"),editable:"false"!==t.getAttribute("editable")&&"empty"!==r,visible:t.getAttribute("visible")||"",location:[parseInt(a),parseInt(c)],shadows:p,fields:f,field_constraints:g,field_extra_attr:v,comment:h,mutation:d,parent_id:e||null,is_output:null},i},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},38730(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Registry=void 0;var i=o(31635),r=o(71519),s=function(){function t(){this.field_map={}}return t.prototype.register=function(t,e){if(!t)throw Error('Invalid field type "'+t+'"');this.field_map[t]=e},t.prototype.from_json=function(t){var e=t.type;if(!e||!this.field_map[e])throw Error('Custom field type "'+e+'" not found');return new this.field_map[e](t)},t}();e.Registry=(0,i.__decorate)([(0,r.injectable)()],function(){this.field=new s})},57811(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RuntimeData=void 0;var i=o(31635),r=o(71519),s=(0,i.__importStar)(o(47168)),a=o(36963),_=o(25507);e.RuntimeData=function(){function t(){var t=this;this.selected=void 0,this.editing=void 0,this.pasting_count=0,this.dragging_connections=[],this.hide_chaff_effects=[],this.document_events_bound=!1,this.before_scale=1,this.pinch_listener=function(e){var o=t.workspace_db.current;o.current_gesture_&&o.current_gesture_.cancel();var i=e.scale;i-t.before_scale>.08?(o.mark_focused(),o.zoom_center(.5),t.before_scale=i):i-t.before_scale<-.08&&(o.mark_focused(),o.zoom_center(-.5),t.before_scale=i)},this.pinchend_listener=function(){t.before_scale=1},this.clipboard=new c}return t.prototype.set_pasting=function(t){t?this.pasting_count++:this.pasting_count--},t.prototype.is_pasting=function(){return this.pasting_count},t.prototype.register_finger_events=function(){if(!this.hammer_manager){var t=document.querySelector(".blocklySvg");this.hammer_manager=new s.Manager(t)}this.pinch_recognizer||(this.pinch_recognizer=new s.Pinch),this.hammer_manager.add(this.pinch_recognizer),this.hammer_manager.on("pinch",this.pinch_listener),this.hammer_manager.on("pinchend",this.pinchend_listener)},t.prototype.unregister_finger_events=function(){var t,e,o;this.pinch_recognizer&&null!=(t=this.hammer_manager)&&t.remove(this.pinch_recognizer),null!=(e=this.hammer_manager)&&e.off("pinch",this.pinch_listener),null!=(o=this.hammer_manager)&&o.off("pinchend",this.pinchend_listener)},t.prototype.cancel_gesture_when_multi_touch=function(){var t,e=this;null!=(t=this.workspace_db.current)&&t.get_parent_svg().addEventListener("touchmove",function(t){var o=e.workspace_db.current;t.touches.length>1&&o.current_gesture_&&o.current_gesture_.cancel()})},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}();var c=function(){function t(){}return t.prototype.get_content=function(){if(this.content)return Array.isArray(this.content)?this.content.map(function(t){return(0,_.clone_node)(t,!0)}):(0,_.clone_node)(this.content,!0)},t.prototype.copy=function(t){var e=this.xml.workspace_element_to_dom_with_xy(t);return this.content=e,e},t.prototype.copy_all=function(t){var e=this,o=t.map(function(t){return e.xml.workspace_element_to_dom_with_xy(t)});return this.content=o,o},t.prototype.duplicate=function(t){var e=this.copy(t);return t.get_workspace().paste((0,_.clone_node)(e,!0)),e},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.xml)],t.prototype,"xml",void 0),t}()},12564(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Tooltip=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(25507),_=o(86295),c=o(82267);e.Tooltip=function(){function t(){this.visible=!1,this.blocked_=!1,this.LIMIT=50,this.mouse_out_pid_=0,this.show_pid_=0,this.last_x_=0,this.last_y_=0,this.poisoned_element_=void 0,this.OFFSET_X=0,this.OFFSET_Y=10,this.RADIUS_OK=20,this.HOVER_MS=750,this.MARGINS=5,this.DIV=void 0}return t.prototype.create_dom=function(){return this.DIV||(this.DIV=(0,a.create_dom)("div","blocklyTooltipDiv"),document.body.appendChild(this.DIV)),this.DIV},t.prototype.bind_mouse_event=function(t){this.events.bind_event(t,"mouseover",void 0,this.on_mouse_over.bind(this)),this.events.bind_event(t,"mouseout",void 0,this.on_mouse_out.bind(this)),t.addEventListener("mousemove",this.on_mouse_move.bind(this),!1)},t.prototype.on_mouse_over=function(t){if(!this.blocked_){var e=t.target;e&&e.tooltip&&(this.element_!==t.target&&(this.hide(),this.poisoned_element_=void 0,this.element_=e),clearTimeout(this.mouse_out_pid_))}},t.prototype.on_mouse_out=function(t){var e=this;this.blocked_||(0,a.is_in_same_shadow)(t.target,t.relatedTarget)||(this.mouse_out_pid_=window.setTimeout(function(){e.element_=void 0,e.poisoned_element_=void 0,e.hide()},1),clearTimeout(this.show_pid_))},t.prototype.on_mouse_move=function(t){if(this.element_&&!this.blocked_)if(this.visible){var e=this.last_x_-t.pageX,o=this.last_y_-t.pageY;Math.sqrt(e*e+o*o)>this.RADIUS_OK&&this.hide()}else this.poisoned_element_!=this.element_&&(clearTimeout(this.show_pid_),this.last_x_=t.pageX,this.last_y_=t.pageY,this.show_pid_=window.setTimeout(this.show_.bind(this),this.HOVER_MS))},t.prototype.hide=function(){this.visible&&(this.visible=!1,this.DIV&&(this.DIV.style.display="none")),this.show_pid_&&clearTimeout(this.show_pid_)},t.prototype.block=function(){this.hide(),this.blocked_=!0},t.prototype.unblock=function(){this.blocked_=!1},t.prototype.show_=function(){var t;if(!this.blocked_){this.poisoned_element_=this.element_;var e=this.DIV||this.create_dom();(0,a.remove_children)(e);for(var o=null==(t=this.element_)?void 0:t.tooltip;(0,_.is_func)(o);)o=o();if(o){for(var i=(o=(0,c.wrap)(o,this.LIMIT)).split("\n"),r=0;r<i.length;r++){var s=document.createElement("div");s.appendChild(document.createTextNode(i[r])),e.appendChild(s)}var l=(0,a.get_viewport_size)();e.style.display="block",this.visible=!0;var h=this.last_x_;h+=this.OFFSET_X;var d=this.last_y_+this.OFFSET_Y;d+e.offsetHeight>l.height+window.scrollY&&(d-=e.offsetHeight+2*this.OFFSET_Y),h+e.offsetWidth>l.width+window.scrollX-2*this.MARGINS&&(h=l.width-e.offsetWidth-2*this.MARGINS),e.style.top=d+"px",e.style.left=h+"px"}}},t.prototype.get_element=function(){return this.element_},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},77468(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TouchManager=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(86295);e.TouchManager=function(){function t(){this._touch_identifier=void 0,this.TOUCH_MAP=a.BrowserFeature.TOUCH_ENABLED?{mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]}:{},this._long_pid=0,this.is_touch_event=function(t){return t.type.startsWith("touch")}}return t.prototype.long_start=function(t,e){this.long_stop(),1==t.changedTouches.length&&(this._long_pid=window.setTimeout(function(){t.button=2,t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY,e&&e.handle_right_click(t)},this.theme.blink_params.LONGPRESS))},t.prototype.long_stop=function(){this._long_pid&&(clearTimeout(this._long_pid),this._long_pid=0)},t.prototype.clear_touch_identifier=function(){this._touch_identifier=void 0},t.prototype.should_handle_event=function(t){return!this.is_mouse_or_touch_event(t)||this.check_touch_identifier(t)},t.prototype.get_touch_identifier_from_event=function(t){return this.is_touch_event(t)&&t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].identifier||"mouse"},t.prototype.check_touch_identifier=function(t){var e=this.get_touch_identifier_from_event(t);return void 0!=this._touch_identifier?this._touch_identifier==e:("mousedown"==t.type||"touchstart"==t.type)&&(this._touch_identifier=e,!0)},t.prototype.set_client_from_touch=function(t){if(this.is_touch_event(t)){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}},t.prototype.is_mouse_or_touch_event=function(t){return t.type.startsWith("touch")||t.type.startsWith("mouse")},t.prototype.split_event_by_touches=function(t){var e=[];if(this.is_touch_event(t))for(var o=0;o<t.changedTouches.length;o++){var i=Object.assign({},t,{type:t.type,changedTouches:[t.changedTouches[o]],target:t.target,stopPropagation:function(){t.stopPropagation()},preventDefault:function(){0!=t.cancelable&&t.preventDefault()}});e[o]=i}else e.push(t);return e},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},82543(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.zh_hans=void 0,e.zh_hans={DUPLICATE_BLOCK:"",COPY_ALL:" %1 ",ADD_COMMENT:"",REMOVE_COMMENT:"",DELETE_BLOCK:"",DELETE_X_BLOCKS:" %1 ",DELETE_ALL_BLOCKS:" %1 ?",CLEAN_UP:"",COLLAPSE_BLOCK:"",COLLAPSE_ALL:"",EXPAND_BLOCK:"",EXPAND_ALL:"",UNDO:"",REDO:"",PASTE:"",COPY_AND_PASTE:"",GLOBAL_COMMENT:"",COMMENT:"",BLUE_COMMENT:"",GREEN_COMMENT:"",YELLOW_COMMENT:"",RED_COMMENT:"",DELETE_COMMENT:"",WHATS_THIS:"",SAY_SOMETHING:"",START_ON_CLICK:"%1   ",START_ON_CLICK_2:"%1    %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1   ",SELF_LISTEN:"%1    %2 %3 %4",SELF_BROADCAST:" %1",SELF_BROADCAST_AND_WAIT:" %1 ",WHEN:"%1  %2 %3",TERMINATE:"",REPEAT_FOREVER:" %1 %2",REPEAT_N_TIMES:" %1  %2 %3",REPEAT_FOREVER_UNTIL:" %1 %2 %3",BREAK:"",WARP:" %1 %2",WAIT_SECS:" %1 ",WAIT_UNTIL:" %1",DESTRUCT:"",CONTROLS_IF_MSG_IF:"",CONTROLS_IF_MSG_ELSEIF:"",CONTROLS_IF_MSG_ELSE:"",CONTROLS_IF_TOOLTIP_1:"",CONTROLS_IF_TOOLTIP_2:"",CONTROLS_IF_TOOLTIP_3:"",CONTROLS_IF_TOOLTIP_4:"",TELL:" %1  %2 %3",SYNC_TELL:" %1  %2 %3",GET_TIME:" %1",YEAR:"",MONTH:"",DATE:"",WEEK:"",WEEK0:"",WEEK1:"",WEEK2:"",WEEK3:"",WEEK4:"",WEEK5:"",WEEK6:"",HOUR:"",MINUTE:"",SECOND:"",TIMER:"",RESET_TIMER:" ",MATH_NUMBER_TOOLTIP:"",RANDOM_NUM:" %1  %2 ",DIVISIBLE_BY:"%1  %2 ",CALCULATE:" %1",CALCULATE_TOOLTIPS:"",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"",MATH_ARITHMETIC_TOOLTIP_MINUS:"",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"",MATH_ARITHMETIC_TOOLTIP_POWER:"",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"",MATH_SINGLE_TOOLTIP_ROOT:"",MATH_SINGLE_OP_ABSOLUTE:"",MATH_SINGLE_TOOLTIP_ABS:"",MATH_SINGLE_TOOLTIP_NEG:"",MATH_SINGLE_TOOLTIP_LN:"",MATH_SINGLE_TOOLTIP_LOG10:"",MATH_SINGLE_TOOLTIP_EXP:" e",MATH_SINGLE_TOOLTIP_POW10:"10",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"",MATH_ROUND_OPERATOR_ROUND:"",MATH_ROUND_OPERATOR_ROUNDUP:"",MATH_ROUND_OPERATOR_ROUNDDOWN:"",MATH_MODULO_TITLE:"%1 \xf7 %2 ",MATH_MODULO_TOOLTIP:"",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"",MATH_IS_ODD:"",MATH_IS_PRIME:"",MATH_IS_WHOLE:"",MATH_IS_POSITIVE:"",MATH_IS_NEGATIVE:"",MATH_IS_TOOLTIP:"",MATH_DEGREES:"",LOGIC_NEGATE_TITLE:"%1 ",LOGIC_BOOLEAN_TRUE:"",LOGIC_BOOLEAN_FALSE:"",LOGIC_BOOLEAN_TOOLTIP:"",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"",LOGIC_COMPARE_TOOLTIP_NEQ:"",LOGIC_COMPARE_TOOLTIP_LT:"",LOGIC_COMPARE_TOOLTIP_LTE:"",LOGIC_COMPARE_TOOLTIP_GT:"",LOGIC_COMPARE_TOOLTIP_GTE:"",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_AND:"",LOGIC_OPERATION_OR:"",LOGIC_OPERATION_TOOLTIP_AND:"",LOGIC_OPERATION_TOOLTIP_OR:"",TEXT_TEXT_TOOLTIP:"",TEXT_SELECT:"%1  %2  %3 ",TEXT_LENGTH:"%1 ",TEXT_CONTAIN:"%1  %2",TEXT_SPLIT:" %1  %2 ",TEXT_JOIN_TOOLTIP:"",TEXT_JOIN_TITLE_HEAD:"",TEXT_JOIN_TITLE_TAIL:"",VARIABLES_GET:"%1",VARIABLES_SET:" %1  %2",CHANGE_VARIABLE:" %1 %2 %3",INCREASE:"",DECREASE:"",LISTS_GET:"%1",LISTS_APPEND:" %1  %2 ",LISTS_INSERT_VALUE:" %3  %1  %2 ",LISTS_COPY:" %2  %1",LISTS_LENGTH:"%1 ",LISTS_IS_EXIST:"%1  %2",LISTS_INDEX_OF:"%2  %1 ",PROCEDURES_PARAMETER:"%1",PROCEDURES_RETURN_VALUE:" %1 %2",PROCEDURES_DEFNORETURN_TITLE:"",PROCEDURES_DEFNORETURN_PROCEDURE:"",PROCEDURES_DEFNORETURN_TOOLTIP:"",PROCEDURES_DEFRETURN_RETURN:"",COLOR_PICKER:"%1",RED:"",GREEN:"",BLUE:"",HUE:"",SATURATION:"",BRIGHTNESS:"",OPACITY:"",SELECT_COLOR_PARAM_TYPE:"",COLOR_PREVIEW:""}},54682(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.en=void 0,e.en={DUPLICATE_BLOCK:"Copy",COPY_ALL:"Copy %1 Blocks",ADD_COMMENT:"Add Comment",REMOVE_COMMENT:"Remove Comment",DELETE_BLOCK:"Delete Block",DELETE_X_BLOCKS:"Delete %1 Blocks",DELETE_ALL_BLOCKS:"Delete all %1 blocks?",CLEAN_UP:"Clean up Blocks",COLLAPSE_BLOCK:"Collapse Block",COLLAPSE_ALL:"Collapse All Blocks",EXPAND_BLOCK:"Expand Block",EXPAND_ALL:"Expand All Blocks",UNDO:"Undo",REDO:"Redo",PASTE:"Paste",COPY_AND_PASTE:"Copy and Paste",GLOBAL_COMMENT:"Add Workspace Comment",COMMENT:"Comment",BLUE_COMMENT:"Blue Comment",GREEN_COMMENT:"Green Comment",YELLOW_COMMENT:"Yellow Comment",RED_COMMENT:"Red Comment",DELETE_COMMENT:"Delete Comment",WHATS_THIS:"Describe this functionality...",SAY_SOMETHING:"Say something...",START_ON_CLICK:"%1 When Start clicked",START_ON_CLICK_2:"%1 When Start clicked %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 On running group activated",SELF_LISTEN:"%1 When I receive %2 %3 %4",SELF_BROADCAST:"Broadcast %1",SELF_BROADCAST_AND_WAIT:"Broadcast and wait",WHEN:"%1 when %2 %3",TERMINATE:"terminate",REPEAT_FOREVER:"Forever %1 %2",REPEAT_N_TIMES:"Repeat %1 times %2 %3",REPEAT_FOREVER_UNTIL:"Repeat forever until %1 %2 %3",BREAK:"Quit loop",WARP:"Warp %1 %2",WAIT_SECS:"Wait %1 secs",WAIT_UNTIL:"Wait until %1",DESTRUCT:"Destruct",CONTROLS_IF_MSG_IF:"If",CONTROLS_IF_MSG_ELSEIF:"Else if",CONTROLS_IF_MSG_ELSE:"Else",CONTROLS_IF_TOOLTIP_1:"If a value is true, then do some statements.",CONTROLS_IF_TOOLTIP_2:"If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",CONTROLS_IF_TOOLTIP_3:"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",CONTROLS_IF_TOOLTIP_4:"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",TELL:"Make %1 run %2 %3",SYNC_TELL:"Make %1 run and wait %2 %3",GET_TIME:"Current %1",YEAR:"Year",MONTH:"Month",DATE:"Date",WEEK:"Week",WEEK0:"Sunday",WEEK1:"Monday",WEEK2:"Tuesday",WEEK3:"Wednesday",WEEK4:"Thursday",WEEK5:"Friday",WEEK6:"Saturday",HOUR:"Hour",MINUTE:"Minute",SECOND:"Second",TIMER:"Timer",RESET_TIMER:"Reset timer",MATH_NUMBER_TOOLTIP:"A number.",RANDOM_NUM:"Pick random %1 to %2",DIVISIBLE_BY:"%1 is divisible by %2",CALCULATE:"Math expression %1",CALCULATE_TOOLTIPS:"Enter math expression and calculate the results quickly",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"Return the sum of the two numbers.",MATH_ARITHMETIC_TOOLTIP_MINUS:"Return the difference of the two numbers.",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"Return the product of the two numbers.",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"Return the quotient of the two numbers.",MATH_ARITHMETIC_TOOLTIP_POWER:"Return the first number raised to the power of the second number.",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"Sqrt",MATH_SINGLE_TOOLTIP_ROOT:"Return the square root of a number.",MATH_SINGLE_OP_ABSOLUTE:"Abs",MATH_SINGLE_TOOLTIP_ABS:"Return the absolute value of a number.",MATH_SINGLE_TOOLTIP_NEG:"Return the negation of a number.",MATH_SINGLE_TOOLTIP_LN:"Return the natural logarithm of a number.",MATH_SINGLE_TOOLTIP_LOG10:"Return the base 10 logarithm of a number.",MATH_SINGLE_TOOLTIP_EXP:"Return e to the power of a number.",MATH_SINGLE_TOOLTIP_POW10:"Return 10 to the power of a number.",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"Round a number up or down.",MATH_ROUND_OPERATOR_ROUND:"Round",MATH_ROUND_OPERATOR_ROUNDUP:"Round up",MATH_ROUND_OPERATOR_ROUNDDOWN:"Round down",MATH_MODULO_TITLE:"Remainder of %1 \xf7 %2",MATH_MODULO_TOOLTIP:"Return the remainder from dividing the two numbers.",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"even",MATH_IS_ODD:"odd",MATH_IS_PRIME:"prime",MATH_IS_WHOLE:"whole",MATH_IS_POSITIVE:"positive",MATH_IS_NEGATIVE:"negative",MATH_IS_TOOLTIP:"Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",MATH_DEGREES:"degrees",LOGIC_NEGATE_TITLE:"%1 false",LOGIC_BOOLEAN_TRUE:"true",LOGIC_BOOLEAN_FALSE:"false",LOGIC_BOOLEAN_TOOLTIP:"Returns either true or false.",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"Return true if both inputs equal each other.",LOGIC_COMPARE_TOOLTIP_NEQ:"Return true if both inputs are not equal to each other.",LOGIC_COMPARE_TOOLTIP_LT:"Return true if the first input is smaller than the second input.",LOGIC_COMPARE_TOOLTIP_LTE:"Return true if the first input is smaller than or equal to the second input.",LOGIC_COMPARE_TOOLTIP_GT:"Return true if the first input is greater than the second input.",LOGIC_COMPARE_TOOLTIP_GTE:"Return true if the first input is greater than or equal to the second input.",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_TOOLTIP_AND:"Return true if both inputs are true.",LOGIC_OPERATION_AND:"and",LOGIC_OPERATION_TOOLTIP_OR:"Return true if at least one of the inputs is true.",LOGIC_OPERATION_OR:"or",TEXT_TEXT_TOOLTIP:"A letter, word, or line of text.",TEXT_SELECT:"Substring of %1 from %2 to %3",TEXT_LENGTH:"Length of %1",TEXT_CONTAIN:"%1 contains %2",TEXT_SPLIT:"Split %1 by %2",TEXT_JOIN_TOOLTIP:"Create a piece of text by joining together a_ny number of items.",TEXT_JOIN_TITLE_HEAD:"put",TEXT_JOIN_TITLE_TAIL:"together",VARIABLES_GET:"%1",VARIABLES_SET:"Set variable %1 to %2",CHANGE_VARIABLE:"%2 variable %1 by %3",INCREASE:"Increase",DECREASE:"Decrease",LISTS_GET:"%1",LISTS_APPEND:"Append %1 to the last of list %2",LISTS_INSERT_VALUE:"Insert %3 at %2 of %1",LISTS_COPY:"Copy lists %2 to %1",LISTS_LENGTH:"Get the length of list %1",LISTS_IS_EXIST:"If list %1 contains %2",LISTS_INDEX_OF:"Index of %1 in %2",PROCEDURES_PARAMETER:"Parameter %1",PROCEDURES_RETURN_VALUE:"Return %1 %2",PROCEDURES_DEFNORETURN_TITLE:"Define function",PROCEDURES_DEFNORETURN_PROCEDURE:"Function",PROCEDURES_DEFNORETURN_TOOLTIP:"create a function.",PROCEDURES_DEFRETURN_RETURN:"Return",COLOR_PICKER:"%1",RED:"Red",GREEN:"Green",BLUE:"Blue",HUE:"Hue",SATURATION:"Saturation",BRIGHTNESS:"Brightness",OPACITY:"Opacity",SELECT_COLOR_PARAM_TYPE:"Select color selection method",COLOR_PREVIEW:"Color preview"}},37225(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.zh_hant=void 0,e.zh_hant={DUPLICATE_BLOCK:"",COPY_ALL:" %1 )",ADD_COMMENT:"",REMOVE_COMMENT:"",DELETE_BLOCK:"",DELETE_X_BLOCKS:" %1 ",DELETE_ALL_BLOCKS:" %1 ",CLEAN_UP:"",COLLAPSE_BLOCK:"",COLLAPSE_ALL:"",EXPAND_BLOCK:"",EXPAND_ALL:"",UNDO:"",REDO:"",PASTE:"",COPY_AND_PASTE:"",GLOBAL_COMMENT:"",COMMENT:"",BLUE_COMMENT:"",GREEN_COMMENT:"",YELLOW_COMMENT:"",RED_COMMENT:"",DELETE_COMMENT:"",WHATS_THIS:"",SAY_SOMETHING:"",START_ON_CLICK:"%1   ",start_on_click_2:"%1    %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1   ",SELF_LISTEN:"%1    %2 %3 %4",SELF_BROADCAST:" %1",SELF_BROADCAST_AND_WAIT:" %1 ",WHEN:"%1  %2 %3",TERMINATE:"",REPEAT_FOREVER:" %1 %2",REPEAT_N_TIMES:" %1  %2 %3",REPEAT_FOREVER_UNTIL:" %1 %2 %3",BREAK:"",WARP:" %1 %2",WAIT_SECS:" %1 ",WAIT_UNTIL:" %1",DESTRUCT:"",CONTROLS_IF_MSG_IF:"",CONTROLS_IF_MSG_ELSEIF:"",CONTROLS_IF_MSG_ELSE:"",CONTROLS_IF_TOOLTIP_1:" true ",CONTROLS_IF_TOOLTIP_2:" true ",CONTROLS_IF_TOOLTIP_3:" true true ",CONTROLS_IF_TOOLTIP_4:" true true  ture",TELL:" %1  %2 %3",SYNC_TELL:" %1  %2 %3",GET_TIME:" %1",YEAR:"",MONTH:"",DATE:"",WEEK:"",WEEK0:"",WEEK1:"",WEEK2:"",WEEK3:"",WEEK4:"",WEEK5:"",WEEK6:"",HOUR:"",MINUTE:"",SECOND:"",TIMER:"",RESET_TIMER:" ",MATH_NUMBER_TOOLTIP:"",RANDOM_NUM:" %1  %2 ",DIVISIBLE_BY:"%1  %2 ",CALCULATE:" %1",CALCULATE_TOOLTIPS:"",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"",MATH_ARITHMETIC_TOOLTIP_MINUS:"",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"",MATH_ARITHMETIC_TOOLTIP_POWER:"",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"",MATH_SINGLE_TOOLTIP_ROOT:"",MATH_SINGLE_OP_ABSOLUTE:"",MATH_SINGLE_TOOLTIP_ABS:"",MATH_SINGLE_TOOLTIP_NEG:"",MATH_SINGLE_TOOLTIP_LN:"",MATH_SINGLE_TOOLTIP_LOG10:"",MATH_SINGLE_TOOLTIP_EXP:" e",MATH_SINGLE_TOOLTIP_POW10:"10",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:".",MATH_ROUND_OPERATOR_ROUND:"",MATH_ROUND_OPERATOR_ROUNDUP:"",MATH_ROUND_OPERATOR_ROUNDDOWN:"",MATH_MODULO_TITLE:"%1 \xf7 %2 ",MATH_MODULO_TOOLTIP:"",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"",MATH_IS_ODD:"",MATH_IS_PRIME:"",MATH_IS_WHOLE:"",MATH_IS_POSITIVE:"",MATH_IS_NEGATIVE:"",MATH_IS_TOOLTIP:"",MATH_DEGREES:"",LOGIC_NEGATE_TITLE:"%1 ",LOGIC_BOOLEAN_TRUE:"",LOGIC_BOOLEAN_FALSE:"",LOGIC_BOOLEAN_TOOLTIP:"",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:" true",LOGIC_COMPARE_TOOLTIP_NEQ:" true",LOGIC_COMPARE_TOOLTIP_LT:" true",LOGIC_COMPARE_TOOLTIP_LTE:" true",LOGIC_COMPARE_TOOLTIP_GT:" true",LOGIC_COMPARE_TOOLTIP_GTE:" true",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_AND:"",LOGIC_OPERATION_OR:"",LOGIC_OPERATION_TOOLTIP_AND:" true true",LOGIC_OPERATION_TOOLTIP_OR:" true true",TEXT_TEXT_TOOLTIP:"",TEXT_SELECT:"%1  %2  %3 ",TEXT_LENGTH:"%1 ",TEXT_CONTAIN:"%1  %2",TEXT_SPLIT:" %1  %2 ",TEXT_JOIN_TOOLTIP:"",TEXT_JOIN_TITLE_HEAD:"",TEXT_JOIN_TITLE_TAIL:"",VARIABLES_GET:"%1",VARIABLES_SET:" %1  %2",CHANGE_VARIABLE:" %1 %2 %3",INCREASE:"",DECREASE:"",LISTS_GET:"%1",LISTS_APPEND:" %1  %2 ",LISTS_INSERT_VALUE:" %3  %1  %2 ",LISTS_COPY:" %2  %1",LISTS_LENGTH:"%1 ",LISTS_IS_EXIST:"%1  %2",LISTS_INDEX_OF:"%2  %1 ",PROCEDURES_PARAMETER:"%1",PROCEDURES_RETURN_VALUE:" %1 %2",PROCEDURES_DEFNORETURN_TITLE:"",PROCEDURES_DEFNORETURN_PROCEDURE:"",PROCEDURES_DEFNORETURN_TOOLTIP:"",PROCEDURES_DEFRETURN_RETURN:"",COLOR_PICKER:"%1",RED:"",GREEN:"",BLUE:"",HUE:"",SATURATION:"",BRIGHTNESS:"",OPACITY:"",SELECT_COLOR_PARAM_TYPE:"",COLOR_PREVIEW:""}},79028(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(54682),_=o(82543),c=o(37225),l=o(36963),h=o(35009),d=o(443),u=o(89221),p=o(86295),f=o(48264),g=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*\))?/,v=/transform:\s*translate\(\s*([-+\d.e]+)px(([ ,]\s*([-+\d.e]+)\s*)px)*\)?/,b=/transform:\s*translate3d\(\s*([-+\d.e]+)px([ ,]\s*([-+\d.e]+)\s*)px([ ,]\s*([-+\d.e]+)\s*)px\)?/,m=/scale\(\s*([-+\d.e]+)\s*\)/;e.Utils=function(){function t(){var t=this;this.is_3d_supported_cached_=void 0,this.string_to_dom=function(t){if(window.ActiveXObject){var e=new window.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}var o=new DOMParser().parseFromString(t,"text/xml");return o&&o.firstChild&&o.firstChild===o.lastChild||console.error("string_to_dom did not obtain a valid XML tree."),o.firstChild},this.cached_shadow_dom=new Map,this.shadow_type_map={text:'<shadow type="text"><field name="TEXT"></field></shadow>',math_number:'<shadow type="math_number"><field name="NUM"></field></shadow>',logic_empty:'<empty type="logic_empty"><field name="BOOL"></field></empty>',lists_get:'<shadow type="lists_get"><field name="VAR"></field></shadow>'},this.get_shadow_dom=function(e,o,i,r){var s,a=null==(s=t.cached_shadow_dom.get(t.shadow_type_map[e]))?void 0:s.cloneNode(!0);return a||(a=t.string_to_dom(t.shadow_type_map[e]),t.cached_shadow_dom.set(t.shadow_type_map[e],a)),i&&Object.keys(i).forEach(function(t){a.setAttribute(t,i[t])}),a.firstElementChild&&(void 0!=o&&(a.firstElementChild.textContent=o),r&&Object.keys(r).forEach(function(t){a.firstElementChild.setAttribute(t,r[t])})),a},this.try_parse_shadow=function(e){var o=e.match(/^<shadow[^<]+type="([^"]+)"[^>]*>[^<]*<field[^>]*>(.*)<\/field>[^<]*<\/shadow>$/)||e.match(/^<empty[^<]+type="([^"]+)"/)||[],i=o[1],r=o[2];if(i&&t.shadow_type_map[i])return t.get_shadow_dom(i,r,t.parse_attrs((e.match(/^<shadow ([^>]*)>/)||e.match(/^<empty ([^>]*)>/)||[])[1]),t.parse_attrs((e.match(/<field ([^>]*)>/)||[])[1]))},this.string_to_dom_with_shadow_cache=function(e){var o=t.try_parse_shadow(e);if(o)return o;if(!(o=t.string_to_dom(e)))throw Error("Cannot convert string to xml. "+e);return o},this.cache_reference=0,this.cached_widths=new Map,this.cached_style=""}return t.prototype.hide_chaff=function(t,e){for(var o=0,i=this.runtime_data.hide_chaff_effects;o<i.length;o++)(0,i[o])();if(this.widget_div.hide(e),!t){var r=this.workspace_db.current,s=r&&r.get_toolbox();s&&s.flyout&&s.flyout.is_auto_close()&&s.clear_selection()}},t.prototype.gen_uid=function(){return(0,u.gen_uid)()},t.prototype.is_3d_supported=function(){if(void 0!=this.is_3d_supported_cached_)return this.is_3d_supported_cached_;if(!window.getComputedStyle)return!1;var t=document.createElement("p"),e="none",o={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var i in document.body.insertBefore(t,null),o)if(void 0!=t.style.getPropertyValue(o[i])){t.style.setProperty(o[i],"translate3d(1px,1px,1px)");var r=window.getComputedStyle(t);if(!r)return document.body.removeChild(t),!1;e=r.getPropertyValue(o[i])}return document.body.removeChild(t),this.is_3d_supported_cached_="none"!==e,this.is_3d_supported_cached_},t.prototype.run_after_page_load=function(t){if(!document)throw Error("Blockly.utils.run_after_page_load() requires browser document.");if("complete"===document.readyState)t();else var e=setInterval(function(){"complete"===document.readyState&&(clearInterval(e),t())},10)},t.prototype.svg_resize=function(t){for(var e=t,o=e.get_options().parentWorkspace;o;)o=(e=o).get_options().parentWorkspace;var i=e.get_parent_svg(),r=e.get_injection_div();if(r){var s=e.get_toolbox(),a=(null==s?void 0:s.get_width())||0,_=(null==s?void 0:s.get_height())||0,c=e.get_flyout();c&&c.is_visible()&&!c.is_auto_close()&&(a+=c.get_width());var l=r.offsetWidth,d=r.offsetHeight;if(!(l<a||d<_)){var u=l;e.options.toolboxPosition===h.TOOLBOX_POSITION.LEFT&&(u-=a,e.offset[0]=a),e.options.toolboxPosition===h.TOOLBOX_POSITION.RIGHT&&(u-=a);var p=d;e.options.toolboxPosition===h.TOOLBOX_POSITION.TOP&&(p-=_,e.offset[1]=_),e.options.toolboxPosition===h.TOOLBOX_POSITION.BOTTOM&&(p-=_),i.cachedWidth_!=u&&(i.setAttribute("width",u+"px"),i.cachedWidth_=u),i.cachedHeight_!=p&&(i.setAttribute("height",p+"px"),i.cachedHeight_=p),e.resize(),this.set_transform_style(i,t.offset[0],t.offset[1])}}},t.prototype.set_language=function(t){switch(void 0===t&&(t="zh"),t){case"en":Object.assign(this.Msg,a.en);break;case"zh":Object.assign(this.Msg,_.zh_hans);break;case"tw":Object.assign(this.Msg,c.zh_hant)}},t.prototype.get_scale=function(t){var e=1,o=t.getAttribute("transform");if(void 0!=o){var i=o.match(m);i&&i[1]&&(e=parseFloat(i[1]))}return e},t.prototype.get_relative_xy=function(t){var e=s.vec2.create(),o=t.getAttribute("x"),i=t.getAttribute("y");o&&(e[0]=parseInt(o,10)),i&&(e[1]=parseInt(i,10));var r=t.getAttribute("transform"),a=void 0!=r&&r.match(g);a&&(e[0]+=parseFloat(a[1]),a[3]&&(e[1]+=parseFloat(a[3])));var _=t.getAttribute("style");if(_&&_.indexOf("translate")>-1){var c=_.match(v);c?(e[0]+=parseFloat(c[1]),c[4]&&(e[1]+=parseFloat(c[4]))):(c=_.match(b))&&(e[0]+=parseFloat(c[1]),c[3]&&(e[1]+=parseFloat(c[3])))}return e},t.prototype.get_injection_div_xy=function(t){for(var e=s.vec2.create(),o=t;o instanceof Element;){var i=this.get_relative_xy(o),r=this.get_scale(o);if(s.vec2.scaleAndAdd(e,i,e,r),-1!=(" "+(o.getAttribute("class")||"")+" ").indexOf(" injectionDiv "))break;o=o.parentNode}return e},t.prototype.common_word_suffix=function(t){if(!t.length)return 0;if(1==t.length)return t[0].length;for(var e=0,o=0,i=(0,d.shortest_string_length)(t);o<i;o++){for(var r=t[0].substr(-o-1,1),s=1;s<t.length;s++)if(r!=t[s].substr(-o-1,1))return e;" "==r&&(e=o+1)}for(s=1;s<t.length;s++)if((r=t[s].charAt(t[s].length-o-1))&&" "!=r)return e;return i},t.prototype.common_word_prefix=function(t){if(!t.length)return 0;if(1==t.length)return t[0].length;for(var e=0,o=0,i=(0,d.shortest_string_length)(t);o<i;o++){for(var r=t[0][o],s=1;s<t.length;s++)if(r!=t[s][o])return e;" "==r&&(e=o+1)}for(s=1;s<t.length;s++)if((r=t[s][o])&&" "!=r)return e;return i},t.prototype.is_target_input=function(t){var e=t.target;return"textarea"==e.type||"text"==e.type||"number"==e.type||"email"==e.type||"password"==e.type||"search"==e.type||"tel"==e.type||"url"==e.type||e.isContentEditable},t.prototype.check_message_references=function(t){for(var e=!0,o=/%{BKY_([a-zA-Z][a-zA-Z0-9_]*)}/g,i=o.exec(t);i;){var r=i[1];void 0==this.Msg[r]&&(console.warn("WARNING: No message string for %{BKY_"+r+"}."),e=!1),t=t.substring(i.index+r.length+1),i=o.exec(t)}return e},t.prototype.mouse_to_svg=function(t,e,o){var i=e.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,o||(o=e.getScreenCTM().inverse()),i.matrixTransform(o)},t.prototype.is_right_button=function(t){return!(!t.ctrlKey||!f.is.mac())||2==t.button},t.prototype.confirm=function(t,e){e(window.confirm(t))},t.prototype.replace_message_references=function(t){return this.tokenize_interpolation(t).reduce(function(t,e){return"number"==typeof e?t+"%"+e:""+t+e},"")},t.prototype.tokenize_interpolation=function(t){var e=[],o=t.split("");o.push("");for(var i=h.TokenizationState.BaseCase,r=[],s="",a="",_=0;_<o.length;_++){var c=o[_];switch(i){case h.TokenizationState.BaseCase:if("%"===c){(a=r.join(""))&&e.push(a),r.length=0,i=h.TokenizationState.PercentFound;break}r.push(c);break;case h.TokenizationState.PercentFound:if("%"===c){r.push(c),i=h.TokenizationState.BaseCase;break}if("0"<=c&&c<="9"){i=h.TokenizationState.DigitFound,s=c,(a=r.join(""))&&e.push(a),r.length=0;break}if("{"==c){i=h.TokenizationState.MsgRefFound;break}r.push("%",c),i=h.TokenizationState.BaseCase;break;case h.TokenizationState.DigitFound:if("0"<=c&&c<="9"){s+=c;break}e.push(parseInt(s,10)),_--,i=h.TokenizationState.BaseCase;break;case h.TokenizationState.MsgRefFound:if(""===c){r.splice(0,0,"%{"),_--,i=h.TokenizationState.BaseCase;break}if("}"!==c){r.push(c);break}var l=r.join("");if(/[A-Z]\w*/i.test(l)){var d=l.toUpperCase(),u=d.startsWith("BKY_")?d.substring(4):void 0,f=u&&u in this.Msg?this.Msg[u]:void 0;void 0!==f?(0,p.is_string)(f)?Array.prototype.push.apply(e,this.tokenize_interpolation(f)):e.push(String(f)):e.push("%{"+l+"}"),r.length=0,i=h.TokenizationState.BaseCase}else e.push("%{"+l+"}"),r.length=0,i=h.TokenizationState.BaseCase}}(a=r.join(""))&&e.push(a);var g=[];r.length=0;for(var v=0;v<e.length;++v)"string"==typeof e[v]?r.push(e[v]):((a=r.join(""))&&g.push(a),r.length=0,g.push(e[v]));return(a=r.join(""))&&g.push(a),r.length=0,g},t.prototype.get_svg_size=function(t){return{width:t.cachedWidth_,height:t.cachedHeight_}},t.prototype.set_transform_style=function(t,e,o,i){if("number"==typeof e||"number"==typeof o||"number"==typeof i){var r=t.style.transform||t.style.webkitTransform||"translate(0px, 0px) scale(1)",a=r;if("number"==typeof e||"number"==typeof o){var _=s.vec2.fromValues(0,0),c=void 0!=a&&a.match(g);c&&(_[0]=parseFloat(c[1]),_[1]=parseFloat(c[3]));var l="number"==typeof e?e:_[0],h="number"==typeof o?o:_[1];(l!==_[0]||h!==_[1])&&(a=a.replace(/translate\([^)]+\)/,"translate("+l+"px, "+h+"px)"))}"number"==typeof i&&(a=a.replace(/scale\([^)]+\)/,"scale("+i+")")),a!==r&&(t.style.transform=a,t.style.webkitTransform=a)}},t.prototype.parse_attrs=function(t){var e={};if(!t)return e;try{t.split(/\s/).forEach(function(t){if(!(t.length<2)){var o=t.split("="),i=o[0],r=o[1];e[i]=r.slice(1,r.length-1)}})}catch(t){console.error("Parsing shadow attribute error: "+t)}return e},t.prototype.dom_to_string=function(t){return new XMLSerializer().serializeToString(t)},t.prototype.start_text_cache=function(){this.cache_reference++},t.prototype.stop_text_cache=function(){this.cache_reference--,this.cache_reference||(this.cached_widths.clear(),this.cached_style="")},t.prototype.measure_text=function(t,e){if(!this.canvas_context){var o=document.createElement("canvas");o.style.display="none",document.body.appendChild(o),this.canvas_context=o.getContext("2d")}return this.canvas_context.font=e,this.canvas_context.measureText(t).width},t.prototype.get_cached_width=function(t){var e=this,o=t.textContent+"\n"+t.className.baseVal,i=this.cached_widths.get(o)||0;if(i)return i;try{if(!this.cached_style){var r=function(t){var o=window.getComputedStyle(t);e.cached_style=o.fontWeight+" "+o.fontSize+" "+o.fontFamily};if(document.body.contains(t))r(t);else{for(var s=t;s.parentNode&&"text"!==s.tagName.toLowerCase();)s=s.parentNode;var a=s.cloneNode(!0);document.body.appendChild(a),r(a),document.body.removeChild(a)}}i=this.measure_text(t.textContent||"",this.cached_style)}catch(e){console.warn(e);var _=t.textContent;return void 0==_?0:8*_.length}return this.cached_widths.set(o,i),i},(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},78672(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WidgetDiv=void 0;var i=o(31635),r=o(71519),s=o(25507),a=o(53137);e.WidgetDiv=function(){function t(){this.dispose_=void 0}return t.prototype.create_dom=function(){void 0==this.DIV&&(this.DIV=(0,s.create_dom)("div","blocklyWidgetDiv"),document.body.appendChild(this.DIV))},t.prototype.show=function(t,e){if(this.hide(),this.owner_=t,this.dispose_=e,void 0!=this.DIV){var o=(0,a.get_viewport_page_offset)(document);this.DIV.style.top=o[1]+"px",this.DIV.style.direction="ltr",this.DIV.style.display="block"}},t.prototype.hide=function(){this.is_visible()&&(this.owner_=void 0,this.dispose_&&this.dispose_(),this.dispose_=void 0,this.hide_and_clear_dom())},t.prototype.hide_and_clear_dom=function(){void 0!=this.DIV&&(this.DIV.setAttribute("style","display: none;"),(0,s.remove_children)(this.DIV))},t.prototype.is_visible=function(){return!!this.owner_},t.prototype.hide_if_owner=function(t){this.owner_==t&&this.hide()},t.prototype.position=function(t,e,o,i,r){e<(i=i||(0,a.get_viewport_page_offset)(document))[1]&&(e=i[1]),r?t>(o=o||(0,s.get_viewport_size)()).width+i[0]&&(t=o.width+i[0]):t<i[0]&&(t=i[0]),void 0!=this.DIV&&(this.DIV.style.left=t+"px",this.DIV.style.top=e+"px",this.DIV.style.height="0px",this.DIV.setAttribute("tabindex","-1"),this.DIV.style.outline="none",this.DIV.focus())},t.prototype.position_with_anchor=function(t,e,o,i){var r=this.calculate_y(t,e,o),s=this.calculate_x(t,e,o,i);this.position_internal(s,r,o.height)},t.prototype.calculate_y=function(t,e,o){return e.bottom+o.height>=t.bottom?e.top-o.height:e.bottom},t.prototype.calculate_x=function(t,e,o,i){if(i){var r=Math.max(e.right-o.width,t.left);return Math.min(r,t.right-o.width)}return Math.max(r=Math.min(e.left,t.right-o.width),t.left)},t.prototype.position_internal=function(t,e,o){void 0!=this.DIV&&(this.DIV.style.left=t+"px",this.DIV.style.top=e+"px",this.DIV.style.height=o+"px")},(0,i.__decorate)([(0,r.injectable)()],t)}()},59967(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDB=void 0;var i=o(31635),r=o(71519);e.WorkspaceDB=function(){function t(){this.db=new Map}return t.prototype.add=function(t){this.db.set(t.id,t)},t.prototype.remove=function(t){return this.db.delete(t.id)},t.prototype.get=function(t){return this.db.get(t)},(0,i.__decorate)([(0,r.injectable)()],t)}()},602(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Xml=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(35009),_=o(36963),c=o(86295),l=o(99469),h=o(89221),d=(0,i.__importStar)(o(25507));e.Xml=function(){function t(){this.grouped_blocks=[],this.scoped_connections=[]}return t.prototype.workspace_to_dom=function(t,e){for(var o=d.create_dom("xml"),i=t.get_top_blocks(!0),r=0;r<i.length;r++){var s=i[r];s.is_insertion_marker()||s.parent_group||o.appendChild(this.block_to_dom_with_xy(s,e))}var a=t.get_top_comments(!0);for(r=0;r<a.length;r++){var _=a[r];o.appendChild(this.comment_to_dom_with_xy(_,e))}return o},t.prototype.dom_to_workspace=function(t,e){var o=[];this.utils.start_text_cache();var i=t.childNodes.length,r=this.events.get_group();r||this.events.set_group(!0);var a=e.is_resizes_enabled();a&&e.set_resizes_enabled(!1);try{for(var _=0;_<i;_++){var l=t.childNodes[_],h=l.nodeName.toLowerCase(),d=void 0;if("block"!=h&&("shadow"!=h||this.events.is_record_undo())&&("empty"!=h||this.events.is_record_undo())?"shadow"===h||"empty"===h?console.error("Shadow block cannot be a top-level block."):"comment"===h&&(d=this.dom_to_workspace_comment(l,e)):d=this.dom_to_block(l,e),d){o.push(d.id);var u=parseInt(l.getAttribute("x")||"0",10),p=parseInt(l.getAttribute("y")||"0",10);isNaN(u)||isNaN(p)||(u=e.RTL?0-u:u,(0,c.is_block_svg)(d)&&d.parent_group?d.parent_group.move_by(s.vec2.fromValues(u,p)):d.move_by(s.vec2.fromValues(u,p)))}}}finally{r||this.events.set_group(!1),this.utils.stop_text_cache()}return a&&e.set_resizes_enabled(!0),o},t.prototype.block_to_dom=function(t,e){if((0,c.is_block_group)(t)){var o,i,r,s=this.block_to_dom(t.origin_block,e),_=t.get_field_value(a.BLOCK_GROUP_NAME_FIELD_NAME);if((0,l.assert)("string"==typeof _),s.setAttribute(a.BLOCK_GROUP_NAME_XML_TAG,_),s.setAttribute(a.BLOCK_GROUP_ID_XML_TAG,t.id),t.group_type!==a.BlockGroupType.EXECUTION)return s;var h=null==(o=t.next_connection)?void 0:o.targetBlock(),u=h&&this.block_to_dom(h,e);if(u){u.setAttribute(a.BLOCK_GROUP_STOPPED_XML_TAG,"true");var p=s.querySelector("next["+a.LAST_NEXT_XML_TAG+'="true"]');null!=p&&p.removeAttribute(a.LAST_NEXT_XML_TAG),null!=p&&p.appendChild(u)}return s}if((s=t.is_shadow()?t.is_editable()?d.create_dom("shadow"):d.create_dom("empty"):d.create_dom("block")).setAttribute("type",t.type),e||s.setAttribute("id",t.id),t.mutationToDom){var f=t.mutationToDom();f&&(f.hasChildNodes()||f.hasAttributes())&&s.appendChild(f)}for(var g=0;g<t.inputList.length;g++)for(var v=t.inputList[g],b=0;b<v.fieldRow.length;b++){var m=v.fieldRow[b];this.field_to_dom(m,s)}if(t.parent_group?(t.parent_group.comment&&s.appendChild(this.comment_to_dom(t.parent_group.comment)),s.setAttribute("visible",t.parent_group.visibility_)):(t.comment&&s.appendChild(this.comment_to_dom(t.comment)),s.setAttribute("visible",t.visibility_)),t.data){var y=d.create_dom("data",void 0,t.data);s.appendChild(y)}for(g=0;g<t.inputList.length;g++){var k=!0;if((v=t.inputList[g]).type!=a.InputType.DUMMY&&v.connection){var w=v.connection.targetBlock();v.type==a.InputType.VALUE?r=d.create_dom("value"):v.type==a.InputType.STATEMENT&&(r=d.create_dom("statement"));var E=v.connection.get_shadow_dom();!(!E||w&&w.is_shadow())&&r&&r.appendChild(this.clone_shadow(E)),w&&(r&&r.appendChild(this.block_to_dom(w,e)),k=!1),r&&r.setAttribute("name",v.name),k||s.appendChild(r)}}t.inputs_inline_default!=t.inputs_inline&&s.setAttribute("inline",String(t.inputs_inline)),t.is_collapsed()&&s.setAttribute("collapsed",String(!0)),t.disabled&&s.setAttribute("disabled",String(!0)),t.deletable_||s.setAttribute("deletable",String(!1)),t.movable_||s.setAttribute("movable",String(!1)),t.editable_||s.setAttribute("editable",String(!1));var T=null==(i=t.next_connection)?void 0:i.targetBlock();if(T){var x=d.create_dom("next",void 0,this.block_to_dom(T,e));s.appendChild(x)}else if(t.next_connection){var I=t.get_root_block();t.next_connection===I.last_connection_in_stack()&&((x=d.create_dom("next")).setAttribute(""+a.LAST_NEXT_XML_TAG,"true"),s.appendChild(x))}var O=t.next_connection&&t.next_connection.get_shadow_dom();return!(!O||T&&T.is_shadow())&&r&&r.appendChild(this.clone_shadow(O)),s},t.prototype.field_to_dom=function(t,e){if(t.name&&t.editable){var o=d.create_dom("field",void 0,String(t.get_value())),i=t.name;(0,c.is_field_number)(t)&&(i=this.field_number_to_dom(t,o)),(0,c.is_field_default_value)(t)&&this.field_default_value_to_dom(t,o),o.setAttribute("name",i),e.appendChild(o)}},t.prototype.field_number_to_dom=function(t,e){var o=[t.min_,t.max_,t.precision_,t.mod_].join(",");if(e.setAttribute("constraints",o),void 0!=t.exceptions){var i=t.exceptions.join(",");e.setAttribute("exceptions",i)}var r=t.get_controller_option();if(r){var s=void 0;s=r.type===a.ControllerType.SLIDER?[r.type,r.left_text,r.right_text].join(","):r.type===a.ControllerType.COLOR_PICKER?[r.type,r.color_format,r.line].join(","):r.type,e.setAttribute("controller",s)}var _=t.name;return t.allow_text&&(e.setAttribute("allow_text","true"),(0,h.is_valid_number)(t.get_value())||(_="TEXT")),_},t.prototype.field_default_value_to_dom=function(t,e){var o=t.get_has_been_edited();e.setAttribute("has_been_edited",String(o))},t.prototype.clone_shadow=function(t){for(var e,o=t=d.clone_node(t,!0);o;)if(o.firstChild)o=o.firstChild;else{for(;o&&!o.nextSibling;)e=o,o=o.parentNode,e.nodeType==a.NodeType.TEXT&&""==e.data.trim()&&o.firstChild!=e&&d.remove_node(e);o&&(e=o,o=o.nextSibling,e.nodeType==a.NodeType.TEXT&&""==e.data.trim()&&d.remove_node(e))}return t},t.prototype.dom_to_block=function(t,e){var o;this.events.disable();try{o=this.dom_to_block_headless(t,e);var i=this.scoped_connections.slice();this.scoped_connections.length=0;for(var r=0;r<i.length;r++){var s=i[r],a=s[0],_=s[1];_.connect(a,!0)||this.handle_unconnectable_child_block(a.source_block,_)}if(e.rendered){o.set_connections_hidden(!0);var c=o.get_descendants(!1);for(r=c.length-1;r>=0;r--)c[r].respawn_all_shadows();for(r=(c=o.get_descendants(!1)).length-1;r>=0;r--)c[r].init_svg();for(r=c.length-1;r>=0;r--)c[r].update_collapsed(),c[r].render(!1);for(r=c.length-1;r>=0;r--)(d=c[r]).comment&&d.comment.init_svg();var l=this.grouped_blocks.slice();for(this.grouped_blocks.length=0,r=l.length-1;r>=0;r--){var h=l[r],d=h.block,u=h.id,p=h.name,f=h.group_stop_at;d.hide_into_group(p,{id:u,group_stop_at:f})}window.setTimeout(function(){if(void 0!=o&&void 0!=o.get_workspace()){o.set_connections_hidden(!1);for(var t=0;t<l.length;t++)l[t].block.set_connections_hidden(!1)}},1),o.update_disabled()}}finally{this.events.enable()}return this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:o})),o},t.prototype.dom_to_block_headless=function(t,e,o){var i=t.getAttribute("type");if(void 0==i)throw ReferenceError("Block type unspecified.");var r=t.getAttribute("id")||o||void 0,s=t.nodeName.toLowerCase(),_=e.new_block(i,r),c=t.getAttribute(a.BLOCK_GROUP_ID_XML_TAG);c&&e.get_block_by_id(c)&&(c=(0,h.gen_uid)());var l=t.getAttribute(a.BLOCK_GROUP_NAME_XML_TAG);if("true"===t.getAttribute(a.BLOCK_GROUP_STOPPED_XML_TAG))for(var d=this.grouped_blocks.length-1;d>=0;d--){var u=this.grouped_blocks[d];u.block.is_starting_block()||u.block.is_output_block()||void 0!==u.group_stop_at||(u.group_stop_at=c||_.id)}for(c&&l&&this.grouped_blocks.push({block:_,id:c,name:l}),d=0;d<t.childNodes.length;d++){var p=t.childNodes[d];if(p.nodeType!=a.NodeType.TEXT){for(var f=void 0,g=void 0,v=0;v<p.childNodes.length;v++){var b=p.childNodes[v];if(b.nodeType==a.NodeType.ELEMENT){var m=b.nodeName.toLowerCase();"block"==m?g=b:("shadow"==m||"empty"===m)&&(f=b)}}switch(p.nodeName.toLowerCase()){case"mutation":_.domToMutation&&(_.domToMutation(p),void 0!=_.init_svg&&_.init_svg());break;case"comment":_.set_comment_text("",p.getAttribute("id")||void 0),this.parse_comment_attributes(p,_.comment);break;case"data":_.data=p.textContent;break;case"title":case"field":this.parse_child_field(p,_);break;case"value":case"statement":var y=p.getAttribute("name"),k=_.get_input(y);if(!k||!k.connection){console.warn("Ignoring non-existent input "+y+" in block "+i);break}this.parse_connection(e,k.connection,f,g);break;case"next":if(!_.next_connection){console.error("Trying to connect to invalid next connect: "+_);break}this.parse_connection(e,_.next_connection,f,g);break;default:console.warn("Ignoring unknown tag: "+p.nodeName)}}}var w=t.getAttribute("inline");w&&_.set_inputs_inline("true"==w);var E=t.getAttribute("disabled");E&&_.set_disabled("true"==E);var T=t.getAttribute("deletable");T&&_.set_deletable("true"==T);var x=t.getAttribute("movable");x&&_.set_movable("true"==x);var I=t.getAttribute("editable");I&&_.set_editable("true"==I);var O=t.getAttribute("visible");if(O){var N=void 0;N="false"===O||O===a.BlockVisibility.TRANSLUCENT?a.BlockVisibility.TRANSLUCENT:"hidden"===O?a.BlockVisibility.HIDDEN:a.BlockVisibility.VISIBLE,_.set_chunk_visibility(N)}if("shadow"===s||"empty"===s){var C=_.get_children();for(d=0;d<C.length;d++)C[d].is_shadow()||console.error("Shadow block not allowed non-shadow child.");_.set_shadow(!0),"empty"===s&&_.set_editable(!1)}var A=t.getAttribute("collapsed");return A&&_.set_collapsed("true"==A),_},t.prototype.parse_fields=function(t,e){for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];i.nodeType!==a.NodeType.TEXT&&"field"===i.nodeName.toLowerCase()&&this.parse_child_field(i,e)}},t.prototype.parse_connection=function(t,e,o,i){var r;if(o&&((null==(r=e.targetBlock())?void 0:r.is_shadow())&&e.remove_shadow(),e.set_shadow_dom(o)),i){var s=this.dom_to_block_headless(i,t,void 0),a=s.output_connection||s.previous_connection;a?a.context?this.scoped_connections.push([a,e]):e.connect(a,!0)||this.handle_unconnectable_child_block(s,e):console.error("Child block does not have output or previous statement.")}},t.prototype.handle_unconnectable_child_block=function(t,e){if(this.runtime_data.is_pasting())t.dispose(!1,!1);else for(var o=t.get_descendants(!1),i=o.length-1;i>=0;i--)o[i].init_svg(),o[i].update_collapsed(),o[i].render(!1);e.respawn_shadow()},t.prototype.parse_child_field=function(t,e){var o=t.getAttribute("name");if(void 0!=o){"true"===t.getAttribute("allow_text")&&"NUM"!==o&&(o="NUM");var i=e.get_field(o);if(i){var r=t.textContent;if((0,c.is_field_number)(i)){var s=t.getAttribute("constraints");if(s){var _=s.split(",");i.set_constraints(_[0],_[1],_[2]),_[3]&&i.set_mod(_[3])}var l=t.getAttribute("exceptions");if(l){var h=[];h=l.split(",").map(function(t){return+t}),i.set_exceptions(h)}var d=t.getAttribute("allow_text"),u=void 0;d&&(u="true"===d),i.set_allow_text&&i.set_allow_text(u);var p=t.getAttribute("controller");if(p){var f=void 0;f="SLIDER"===(h=p.split(","))[0]?{type:a.ControllerType.SLIDER,left_text:h[1],right_text:h[2]}:"COLOR_PICKER"===h[0]?{type:a.ControllerType.COLOR_PICKER,color_format:h[1],line:h[2]}:{type:a.ControllerType.ANGLE_SCALE},i.set_controller_option(f)}}if((0,c.is_field_default_value)(i)){var g=t.getAttribute("has_been_edited");g&&i.set_has_been_edited("true"===g)}var v=i.call_validator(r);void 0!=v&&"FieldImage"!==i.field_type&&i.set_value(v)}}},t.prototype.dom_to_text=function(t){return this.utils.dom_to_string(t)},t.prototype.text_to_dom=function(t){return this.utils.string_to_dom(t)},t.prototype.block_to_dom_with_xy=function(t,e){var o,i=this.block_to_dom(t,e),r=(null==(o=t.parent_group)?void 0:o.get_relative_to_surface_xy())||t.get_relative_to_surface_xy();return i.setAttribute("x",String(Math.round(r[0]))),i.setAttribute("y",String(Math.round(r[1]))),i},t.prototype.filter_undefined_blocks=function(t,e){void 0===e&&(e=!1);for(var o=!1,i=t.querySelectorAll("block"),r=0;r<i.length;r++){var s=i[r],a=s.getAttribute("type");if(!this.Blink.Blocks[a]){o||(o=!0);var _=s.parentElement;"NEXT"===_.nodeName?_.parentElement.removeChild(_):_.removeChild(s)}}return e?{xml:t,deleted:o}:t},t.prototype.comment_to_dom_with_xy=function(t,e){var o=this.comment_to_dom(t,e),i=t.get_relative_to_surface_xy();return o.setAttribute("x",String(Math.round(i[0]))),o.setAttribute("y",String(Math.round(i[1]))),o},t.prototype.dom_to_workspace_comment=function(t,e){var o=t.getAttribute("id")||void 0,i=e.new_workspace_comment(void 0,o);return this.parse_comment_attributes(t,i),i.init_svg(),i},t.prototype.comment_to_dom=function(t,e){var o=t.get_text(),i=d.create_dom("comment",void 0,o);i.setAttribute("pinned",String(t.is_expanded()));var r=t.get_bubble_size();i.setAttribute("h",String(r.height)),i.setAttribute("w",String(r.width));var s=t.get_relative_position();return i.setAttribute("relativeleft_",""+s[0]),i.setAttribute("relativetop_",""+s[1]),i.setAttribute("auto_layout",String(t.is_auto_layout())),i.setAttribute("color_theme",String(t.get_color_theme())),e||i.setAttribute("id",t.id),i},t.prototype.parse_comment_attributes=function(t,e){if(e){e.set_text(t.textContent||"");var o=t.getAttribute("pinned");o&&e.set_expanded("true"==o);var i=parseInt(t.getAttribute("w")||"",10),r=parseInt(t.getAttribute("h")||"",10);isNaN(i)||isNaN(r)||e.set_bubble_size(i,r);var a=parseFloat(t.getAttribute("relativeleft_")||""),_=parseFloat(t.getAttribute("relativetop_")||"");isNaN(a)||isNaN(_)||e.set_relative_position(s.vec2.fromValues(a,_));var l=t.getAttribute("auto_layout");l&&e.set_auto_layout("true"===l);var h=t.getAttribute("color_theme");(0,c.is_comment_theme)(h)&&e.set_color_theme(h,!0)}},t.prototype.dom_to_workspace_element=function(t,e){var o=t.tagName.toLowerCase();return"block"===o?this.dom_to_block(t,e):"comment"===o?this.dom_to_workspace_comment(t,e):void console.error("Undefined workspace element: "+t)},t.prototype.workspace_element_to_dom=function(t,e){return(0,c.is_block_svg)(t)?this.block_to_dom(t,e):(0,c.is_workspace_comment)(t)?this.comment_to_dom(t,e):(console.error("Undefined workspace element: "+t),d.create_dom("element"))},t.prototype.workspace_element_to_dom_with_xy=function(t,e){return(0,c.is_block_svg)(t)?this.block_to_dom_with_xy(t,e):(0,c.is_workspace_comment)(t)?this.comment_to_dom_with_xy(t,e):(console.error("Undefined workspace element: "+t),d.create_dom("element"))},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.Blink)],t.prototype,"Blink",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},92129(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SliderController=void 0;var i=o(31635),r=o(71519),s=o(89221),a=o(37747);e.SliderController=function(t){function e(){var e=t.call(this)||this;return e.base_color=new a.Color("#000000"),e.left_text="",e.right_text="",e.min=0,e.max=100,e.slider_width=140,e}return(0,i.__extends)(e,t),e.prototype.show=function(t,e){var o;if("number"==typeof t.min_&&"number"==typeof t.max_){var i=(null==(o=t.source_block)?void 0:o.is_shadow())?t.source_block.parent_block:t.source_block;i&&(this.slider||this.init(),this.owner=t,this.min=t.min_,this.max=t.max_,this.left_text=e.left_text,this.right_text=e.right_text,this.base_color=i.get_colour(),this.update_slider(),this.container.style.display="block",this.position())}},e.prototype.init=function(){this.slider=document.createElement("div"),this.slider.classList.add("blockly-controller","slider-controller"),this.slider.setAttribute("tabindex","-1"),this.left_text_ele=document.createElement("span"),this.left_text_ele.classList.add("slider-text"),this.left_text_ele.innerText=this.left_text,this.slider.appendChild(this.left_text_ele);var t=document.createElement("div");t.classList.add("slider-wrapper"),this.slider.appendChild(t),this.slider_rail=document.createElement("div"),this.slider_rail.classList.add("slider-rail"),this.slider_rail.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_rail),this.slider_track=document.createElement("div"),this.slider_track.classList.add("slider-track"),this.slider_track.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_track),this.slider_handle=document.createElement("div"),this.slider_handle.classList.add("slider-handle"),this.slider_handle.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_handle),this.right_text_ele=document.createElement("span"),this.right_text_ele.classList.add("slider-text"),this.right_text_ele.innerText=this.right_text,this.slider.appendChild(this.right_text_ele),this.slider_handle.addEventListener("mousedown",this.bind_slider_event.bind(this)),t.addEventListener("mousedown",this.bind_slider_event.bind(this)),t.addEventListener("mouseup",this.set_slider_handle_position.bind(this)),this.container.appendChild(this.slider),document.body.appendChild(this.container)},e.prototype.update_slider=function(){if(this.slider_track&&this.slider_handle&&this.slider_rail&&this.left_text_ele&&this.right_text_ele&&this.owner){this.slider_handle.style.backgroundColor=this.base_color.toString();var t=new a.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.6});this.slider_track.style.backgroundColor=t.toString();var e=new a.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.2});this.slider_rail.style.backgroundColor=e.toString(),this.left_text_ele.innerText=this.left_text,this.right_text_ele.innerText=this.right_text;var o=this.field_to_slider_value(Number(this.owner.get_value()));this.set_slider_value(o)}},e.prototype.update_value=function(t){var e=this.field_to_slider_value(t);this.set_slider_value(e)},e.prototype.field_to_slider_value=function(t){var e=(0,s.clamp)(t,this.min,this.max);return Math.round((this.min<0?e-this.min:e)/(this.max-this.min)*this.slider_width)},e.prototype.bind_slider_event=function(){var t=this;if(this.slider_rail){this.slider_rail_left=this.slider_rail.getBoundingClientRect().left;var e=this.move_slider_handle.bind(this);document.addEventListener("mousemove",e),document.addEventListener("mouseup",function o(){t.slider_rail_left=void 0,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",o)})}},e.prototype.move_slider_handle=function(t){t.stopPropagation(),this.update_slider_and_field_value(t.clientX)},e.prototype.set_slider_handle_position=function(t){this.slider_rail&&(this.slider_rail_left=this.slider_rail.getBoundingClientRect().left,this.update_slider_and_field_value(t.clientX))},e.prototype.update_slider_and_field_value=function(t){if(this.slider_rail_left){var e,o,i=(null==(o=null==(e=this.owner)?void 0:e.source_block)?void 0:o.get_workspace().get_scale())||1,r=(t-this.slider_rail_left)/i,a=(0,s.clamp)(r,0,this.slider_width),_=this.max-this.min,c=this.min+Math.round(a/this.slider_width*_);this.set_slider_value(a),this.owner&&(this.owner.set_html_input_value(c.toString()),this.owner.on_html_input_change())}},e.prototype.set_slider_value=function(t){this.slider_handle&&this.slider_track&&(this.slider_handle.style.left=t+"px",this.slider_track.style.width=t+"px")},(0,i.__decorate)([(0,r.injectable)()],e)}(o(14494).Controller)},14494(t,e,o){"use strict";e.Controller=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(25507);e.Controller=function(){function t(){this.container=(0,a.create_dom)("div",{style:"position: fixed",class:"blocklyWidgetDiv"}),this.container.style.display="none"}return t.prototype.show=function(t,e){},t.prototype.hide=function(){this.container.style.display="none"},t.prototype.update_value=function(t){},t.prototype.position=function(){if(this.owner&&this.container){var t=this.owner.source_block;if(t){var e=t.get_workspace().get_scale()||1;this.container.style.transformOrigin="top left",this.container.style.transform="scale("+e+")";var o=(this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_FIELD+1)*e,i=this.container.getBoundingClientRect().width;if(!t.is_shadow()){var r=this.owner.get_absolute_xy(),s=this.owner.get_size(),_=s.width*e,c=s.height*e,l=r[0]+_/2-i/2,h=r[1]+c+o;return this.container.style.left=l+"px",void(this.container.style.top=h+"px")}var d=t.svg_group,u=(0,a.get_page_offset)(d),p=t.width*e,f=t.height*e,g=u[0]+p/2-i/2,v=u[1]+f+o;this.container.style.left=g+"px",this.container.style.top=v+"px"}}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},91581(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.inject_icon_symbols=e.SYMBOL=void 0;var i=(0,o(31635).__importStar)(o(48264));e.SYMBOL={DEGREE_MARK_MAJOR:"blocklyDegreeMarkMajor",DEGREE_MARK_MINOR:"blocklyDegreeMarkMinor",DEGREE_POINTER:"blocklyDegreePointer"},e.inject_icon_symbols=function(t){var o;(o={})[e.SYMBOL.DEGREE_MARK_MAJOR]='\n      <symbol id="'+e.SYMBOL.DEGREE_MARK_MAJOR+'" viewBox="0 0 1024 1024">\n        <path d="M512 156.734694a5.22449 5.22449 0 0 1 5.22449 5.22449v20.897959a5.22449 5.22449 0 0 1-10.44898 0v-20.897959a5.22449 5.22449 0 0 1 5.22449-5.22449z m355.265306 355.265306a5.22449 5.22449 0 0 1-5.22449 5.22449h-20.897959a5.22449 5.22449 0 1 1 0-10.44898h20.897959a5.22449 5.22449 0 0 1 5.22449 5.22449z m-355.265306 355.265306a5.22449 5.22449 0 0 1-5.22449-5.22449v-20.897959a5.22449 5.22449 0 1 1 10.44898 0v20.897959a5.22449 5.22449 0 0 1-5.22449 5.22449zM156.734694 512a5.22449 5.22449 0 0 1 5.22449-5.22449h20.897959a5.22449 5.22449 0 0 1 0 10.44898h-20.897959a5.22449 5.22449 0 0 1-5.22449-5.22449z m333.76653-397.270204c-5.632 0-8.704-3.949714-8.704-10.825143 0-7.021714 3.657143-11.190857 8.270368-11.190857 5.851429 0 9.874286 4.827429 10.673632 15.433143-3.213061 4.681143-6.948571 6.582857-10.24 6.582857z m-15.652571 21.577143c3.150367 3.218286 7.538939 5.705143 13.756082 5.705143 10.381061 0 20.035918-8.484571 20.035918-29.696 0-17.773714-8.338286-26.112-18.651429-26.112-8.704 0-16.018286 7.021714-16.018285 17.700571 0 11.264 6.070857 16.896 15.072653 16.896 4.096 0 8.704-2.413714 11.849143-6.290286-0.517224 15.36-6.144 20.626286-12.653715 20.626286a12.000653 12.000653 0 0 1-8.85551-4.022857l-4.534857 5.193143z m55.771429 5.705143c10.537796 0 17.413224-9.362286 17.413224-28.086858 0-18.578286-6.880653-27.721143-17.413224-27.721142-10.605714 0-17.402776 9.069714-17.402776 27.721142 0 18.724571 6.797061 28.086857 17.402776 28.086858z m0-6.656c-5.485714 0-9.357061-5.851429-9.357062-21.430858 0-15.433143 3.876571-21.065143 9.357062-21.065142 5.485714 0 9.36751 5.632 9.36751 21.065142 0 15.579429-3.876571 21.430857-9.36751 21.430858z m32.15151-28.818286c5.919347 0 10.825143-4.388571 10.825143-10.898286s-4.905796-10.898286-10.830368-10.898286c-5.773061 0-10.752 4.388571-10.752 10.898286s4.978939 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.929796-2.706286-5.929796-6.509714 0-3.876571 2.418939-6.582857 5.929796-6.582857 3.578776 0 5.99249 2.706286 5.99249 6.582857 0 3.803429-2.413714 6.509714-5.99249 6.509714zM462.576327 928.078367h19.309714v-6.217143h-19.309714v6.217143z m39.606857-8.777143c-5.632 0-8.704-3.949714-8.704-10.825142 0-7.021714 3.657143-11.190857 8.265143-11.190858 5.851429 0 9.874286 4.827429 10.678857 15.433143-3.218286 4.681143-6.948571 6.582857-10.24 6.582857z m-15.652572 21.577143c3.145143 3.218286 7.533714 5.705143 13.750857 5.705143 10.386286 0 20.041143-8.484571 20.041143-29.696 0-17.773714-8.338286-26.112-18.651428-26.112-8.704 0-16.018286 7.021714-16.018286 17.700572 0 11.264 6.070857 16.896 15.067429 16.896 4.096 0 8.704-2.413714 11.849142-6.290286-0.512 15.36-6.144 20.626286-12.653714 20.626286a12.000653 12.000653 0 0 1-8.850286-4.022858l-4.534857 5.193143z m55.771429 5.705143c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362286 21.065143c0 15.579429-3.876571 21.430857-9.362286 21.430857z m32.146286-28.818286c5.924571 0 10.825143-4.388571 10.825142-10.898285s-4.900571-10.898286-10.825142-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898285z m0-4.388571c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714zM23.750531 532.897959h30.72v-6.948571H43.937959v-46.884572H37.574531c-3.072 1.901714-6.656 3.145143-11.702858 4.096v5.339429H35.526531v37.449143H23.750531V532.897959z m51.09551 0.950857c10.386286 0 17.408-6.144 17.408-14.116571 0-7.314286-4.242286-11.483429-9.069714-14.262857v-0.365715c3.364571-2.486857 7.094857-7.168 7.094857-12.653714 0-8.411429-5.851429-14.262857-15.213715-14.262857-8.850286 0-15.36 5.485714-15.36 13.897143 0 5.705143 3.218286 9.728 7.241143 12.580571v0.365715c-4.973714 2.633143-9.654857 7.387429-9.654857 14.482285 0 8.338286 7.460571 14.336 17.554286 14.336z m3.510857-30.866285c-5.997714-2.340571-11.117714-5.046857-11.117714-10.898286 0-4.827429 3.291429-7.826286 7.68-7.826286 5.266286 0 8.265143 3.730286 8.265143 8.704 0 3.584-1.609143 7.021714-4.827429 10.020572z m-3.364571 24.795428c-5.778286 0-10.24-3.730286-10.24-9.069714 0-4.681143 2.56-8.704 6.290285-11.264 7.314286 2.998857 13.238857 5.485714 13.238857 12.068571 0 5.046857-3.803429 8.265143-9.289142 8.265143z m36.24751 6.070857c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362285 21.065143c0 15.579429-3.876571 21.430857-9.362285 21.430857z m29.664653-28.818285c5.924571 0 10.825143-4.388571 10.825143-10.898286s-4.900571-10.898286-10.825143-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714z m785.460245 39.862857c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362285 21.065143c0 15.579429-3.876571 21.430857-9.362285 21.430857z m29.664653-28.818285c5.924571 0 10.825143-4.388571 10.825143-10.898286s-4.900571-10.898286-10.825143-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714z" p-id="16942"></path>\n      </symbol>\n    ',o[e.SYMBOL.DEGREE_MARK_MINOR]='\n      <symbol id="'+e.SYMBOL.DEGREE_MARK_MINOR+'" viewBox="0 0 1024 1024">\n       <path d="M644.514909 17.446788a7.757576 7.757576 0 0 1 5.484606 9.50303l-4.010667 14.979879a7.757576 7.757576 0 0 1-14.987636-4.010667l4.010667-14.987636a7.757576 7.757576 0 0 1 9.50303-5.484606zM768 68.592485a7.757576 7.757576 0 0 1 2.839273 10.596848l-7.757576 13.436122a7.757576 7.757576 0 0 1-13.436121-7.757576l7.757576-13.436121A7.757576 7.757576 0 0 1 768 68.592485z m106.038303 81.369212a7.757576 7.757576 0 0 1 0 10.969212l-10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212-10.969212l10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212 0zM955.407515 256a7.757576 7.757576 0 0 1-2.839273 10.596848l-13.436121 7.757576a7.757576 7.757576 0 1 1-7.757576-13.436121l13.436122-7.757576a7.757576 7.757576 0 0 1 10.596848 2.839273z m51.145697 123.485091a7.757576 7.757576 0 0 1-5.484606 9.50303l-14.987636 4.010667a7.757576 7.757576 0 0 1-4.010667-14.987636l14.979879-4.010667a7.757576 7.757576 0 0 1 9.50303 5.484606z m0 265.029818a7.757576 7.757576 0 0 1-9.50303 5.484606l-14.979879-4.010667a7.757576 7.757576 0 1 1 4.010667-14.987636l14.987636 4.010667a7.757576 7.757576 0 0 1 5.484606 9.50303zM955.407515 768a7.757576 7.757576 0 0 1-10.596848 2.839273l-13.436122-7.757576a7.757576 7.757576 0 0 1 7.757576-13.436121l13.436121 7.757576a7.757576 7.757576 0 0 1 2.839273 10.596848z m-81.369212 106.038303a7.757576 7.757576 0 0 1-10.969212 0l-10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212-10.969212l10.969212 10.969212a7.757576 7.757576 0 0 1 0 10.969212zM768 955.407515a7.757576 7.757576 0 0 1-10.596848-2.839273l-7.757576-13.436121a7.757576 7.757576 0 1 1 13.436121-7.757576l7.757576 13.436122a7.757576 7.757576 0 0 1-2.839273 10.596848z m-123.485091 51.145697a7.757576 7.757576 0 0 1-9.50303-5.484606l-4.010667-14.987636a7.757576 7.757576 0 0 1 14.987636-4.010667l4.010667 14.979879a7.757576 7.757576 0 0 1-5.484606 9.50303z m-265.029818 0a7.757576 7.757576 0 0 1-5.484606-9.50303l4.010667-14.979879a7.757576 7.757576 0 1 1 14.987636 4.010667l-4.010667 14.987636a7.757576 7.757576 0 0 1-9.50303 5.484606zM256 955.407515a7.757576 7.757576 0 0 1-2.839273-10.596848l7.757576-13.436122a7.757576 7.757576 0 0 1 13.436121 7.757576l-7.757576 13.436121a7.757576 7.757576 0 0 1-10.596848 2.839273z m-106.038303-81.369212a7.757576 7.757576 0 0 1 0-10.969212l10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212 10.969212l-10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212 0zM68.592485 768a7.757576 7.757576 0 0 1 2.839273-10.596848l13.436121-7.757576a7.757576 7.757576 0 0 1 7.757576 13.436121l-13.436122 7.757576A7.757576 7.757576 0 0 1 68.592485 768zM17.454545 644.514909a7.757576 7.757576 0 0 1 5.484607-9.50303l14.987636-4.010667a7.757576 7.757576 0 0 1 4.010667 14.987636l-14.979879 4.010667a7.757576 7.757576 0 0 1-9.503031-5.484606z m0-265.029818a7.757576 7.757576 0 0 1 9.503031-5.484606l14.979879 4.010667a7.757576 7.757576 0 0 1-4.010667 14.987636l-14.987636-4.010667a7.757576 7.757576 0 0 1-5.484607-9.50303zM68.592485 256a7.757576 7.757576 0 0 1 10.596848-2.839273l13.436122 7.757576a7.757576 7.757576 0 0 1-7.757576 13.436121l-13.436121-7.757576A7.757576 7.757576 0 0 1 68.592485 256z m81.369212-106.038303a7.757576 7.757576 0 0 1 10.969212 0l10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212 10.969212l-10.969212-10.969212a7.757576 7.757576 0 0 1 0-10.969212zM256 68.592485a7.757576 7.757576 0 0 1 10.596848 2.839273l7.757576 13.436121a7.757576 7.757576 0 0 1-13.436121 7.757576l-7.757576-13.436122A7.757576 7.757576 0 0 1 256 68.592485zM379.485091 17.454545a7.757576 7.757576 0 0 1 9.50303 5.484607l4.010667 14.987636a7.757576 7.757576 0 0 1-14.987636 4.010667l-4.010667-14.979879a7.757576 7.757576 0 0 1 5.484606-9.503031z" p-id="8468"></path>\n      </symbol>\n    ',o[e.SYMBOL.DEGREE_POINTER]='\n      <symbol id="'+e.SYMBOL.DEGREE_POINTER+'" viewBox="0 0 1024 1024">\n        <path d="M544.64 71.424c14.08 6.784 25.6 17.792 32.64 31.36l247.04 474.88c11.264 21.76 10.048 47.552-3.2 68.224-13.312 20.672-36.8 33.28-62.08 33.28H621.44l0.128 210.624C621.568 928.64 588.8 960 548.48 960H475.456c-40.32 0-72.96-31.424-72.96-70.208l-0.128-210.56H265.024c-25.344 0-48.832-12.672-62.08-33.28a67.84 67.84 0 0 1-3.2-68.352L446.72 102.784c18.048-34.624 61.888-48.64 97.92-31.36z" p-id="16814"></path> \n      </symbol>\n    ',Object.keys(o).map(function(t){return i.dom.parse_to_SVG(o[t])}).forEach(function(e){t.appendChild(e)})}},44083(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AngleController=void 0;var i=o(31635),r=o(71519),s=o(91581),a=o(25507),_=o(37747);e.AngleController=function(t){function e(){var e=t.call(this)||this;return e.pointer_elements=[],e.base_color=new _.Color("#000000"),e.mod=void 0,e.center_position=void 0,e.base_line_height=1,e.angle_interval=15,e.min_degree=-180,e.max_degree=180,e}return(0,i.__extends)(e,t),e.prototype.show=function(t,e){var o,i,r,s=(null==(o=t.source_block)?void 0:o.is_shadow())?t.source_block.parent_block:t.source_block;if(s&&(this.angle_scale||this.init(),this.owner=t,this.mod=t.mod_,this.base_color=s.get_colour(),this.update_angle_scale(),this.container.style.display="block",this.position(),this.base_line)){var a=(null==(r=null==(i=this.owner)?void 0:i.source_block)?void 0:r.get_workspace().get_scale())||1,_=this.base_line.getBoundingClientRect();this.center_position={left:_.left,top:_.top+this.base_line_height/2*a}}},e.prototype.init=function(){this.angle_scale=document.createElement("div"),this.angle_scale.classList.add("blockly-controller","angle-controller"),this.angle_scale.setAttribute("tabindex","-1");var t=(0,a.create_svg_element)("svg",{class:"blocklyIcon degree-mark-major"},this.angle_scale);this.degree_mark_major=(0,a.create_svg_element)("use",{},t),this.degree_mark_major.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s.SYMBOL.DEGREE_MARK_MAJOR);var e=(0,a.create_svg_element)("svg",{class:"blocklyIcon degree-mark-minor"},this.angle_scale);this.degree_mark_minor=(0,a.create_svg_element)("use",{},e),this.degree_mark_minor.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s.SYMBOL.DEGREE_MARK_MINOR);var o=document.createElement("div");o.classList.add("wrapper"),this.angle_scale.appendChild(o);var i=document.createElement("div");i.classList.add("grey-circle"),o.appendChild(i),this.mask=document.createElement("div"),this.mask.classList.add("mask-wrapper"),o.appendChild(this.mask),this.mask_top_clip=document.createElement("div"),this.mask_top_clip.classList.add("mask-clip"),this.mask.appendChild(this.mask_top_clip),this.mask_bottom_clip=document.createElement("div"),this.mask_bottom_clip.classList.add("mask-clip"),this.mask.appendChild(this.mask_bottom_clip);var r=document.createElement("div");r.classList.add("white-circle"),this.mask.appendChild(r),this.base_line=document.createElement("div"),this.base_line.classList.add("base-line"),o.appendChild(this.base_line),this.center=document.createElement("div"),this.center.classList.add("center"),o.appendChild(this.center),this.pointer=document.createElement("div"),this.pointer.classList.add("pointer"),o.appendChild(this.pointer);var _=document.createElement("div");_.classList.add("pointer-line"),this.pointer.appendChild(_),this.pointer_elements.push(_);var c=document.createElement("div");c.classList.add("pointer-arrow-wrapper"),this.pointer.appendChild(c);var l=document.createElement("div");l.classList.add("pointer-arrow-circle"),c.appendChild(l),this.pointer_elements.push(l);var h=(0,a.create_svg_element)("svg",{class:"blocklyIcon pointer-icon"},l),d=(0,a.create_svg_element)("use",{},h);d.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+s.SYMBOL.DEGREE_POINTER),d.setAttribute("fill","#ffffff"),this.angle_scale.addEventListener("mousedown",this.bind_angle_event.bind(this)),this.angle_scale.addEventListener("mouseup",this.set_pointer_position.bind(this)),this.container.appendChild(this.angle_scale),document.body.appendChild(this.container)},e.prototype.update_angle_scale=function(){var t=this;if(this.degree_mark_major&&this.degree_mark_minor&&this.base_line&&this.center&&this.pointer&&this.mask&&this.owner){this.degree_mark_major.style.fill=this.base_color.toString(),this.base_line.style.backgroundColor=this.base_color.toString(),this.center.style.backgroundColor=this.base_color.toString(),this.pointer_elements.forEach(function(e){return e.style.backgroundColor=t.base_color.toString()});var e=new _.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.4});this.degree_mark_minor.style.fill=e.toString();var o=new _.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.2});this.mask.style.backgroundColor=o.toString();var i=this.field_to_angle_value(Number(this.owner.get_value()));this.set_angle_value(i)}},e.prototype.update_value=function(t){var e=this.field_to_angle_value(t);this.set_angle_value(e)},e.prototype.field_to_angle_value=function(t){var e=this.max_degree-this.min_degree,o=t%e;return!0===this.mod?o<=this.min_degree?o+=e:o>this.max_degree&&(o-=e):o<this.min_degree?o+=e:o>=this.max_degree&&(o-=e),Math.round(o)},e.prototype.bind_angle_event=function(){var t=this.move_pointer.bind(this);document.addEventListener("mousemove",t),document.addEventListener("mouseup",function e(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)})},e.prototype.move_pointer=function(t){t.stopPropagation(),this.update_angle_and_field_value(t.clientX,t.clientY)},e.prototype.set_pointer_position=function(t){this.update_angle_and_field_value(t.clientX,t.clientY)},e.prototype.update_angle_and_field_value=function(t,e){if(this.center_position){var o=t-this.center_position.left,i=Math.atan2(this.center_position.top-e,o)/Math.PI*180;i=Math.round(i/this.angle_interval)*this.angle_interval,void 0!==this.mod&&(this.mod&&i===this.min_degree&&(i+=this.angle_interval),this.mod||i!==this.max_degree||(i-=this.angle_interval)),this.set_angle_value(i),this.owner&&(this.owner.set_html_input_value(i.toString()),this.owner.on_html_input_change())}},e.prototype.set_angle_value=function(t){this.pointer&&this.mask_top_clip&&this.mask_bottom_clip&&(this.pointer.style.transform="translateY(-50%) rotate("+-t+"deg)",t>0?(this.mask_top_clip.style.transform="rotate(-"+t+"deg)",this.mask_bottom_clip.style.transform="rotate(180deg)"):(this.mask_top_clip.style.transform="rotate(0deg)",this.mask_bottom_clip.style.transform="rotate("+(180-t)+"deg)"))},(0,i.__decorate)([(0,r.injectable)()],e)}(o(14494).Controller)},1603(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SimplifiedCommentBubble=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(44015),_=o(86295),c=o(35009),l=o(25507);e.SimplifiedCommentBubble=function(){function t(){this.is_showing=!1,this.selected_comment="",this.comments=new Map}return t.prototype.popup=function(t){var e,o=this;if(!this.is_showing){this.is_showing=!0,this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:c.UIEventType.COMMENT_OPEN,workspace_id:t.workspace.id,old_value:!1,new_value:!0,block_id:t.id}));var i=null==(e=t.get_icon())?void 0:e.children;if(i)for(var r=0;r<i.length;r++)i[r].setAttribute("data-showing","true");this.update_bubble("reset",t),this.bubble_&&(document.body.appendChild(this.bubble_),this.animate_once(this.bubble_,"showBubbleAnimation"));var s=function e(r){if(r.type!==c.UIEventType.H_SCROLLBAR_SET&&r.type!==c.UIEventType.V_SCROLLBAR_SET&&(r.type!==c.BlockEventType.CHANGE||"comment"!==r.element||r.get_new_value()||0===o.comments.size)){if(r.type===c.BlockEventType.CHANGE&&"comment_text"===r.element){var s=r.get_block_id();if(s&&o.comments.get(s))return}if(r.type!==c.UIEventType.SIMPLIFIED_COMMENT_EDIT&&r.type!==c.UIEventType.SIMPLIFIED_COMMENT_DELETE&&r.type!==c.UIEventType.SIMPLIFIED_COMMENT_SELECT){if(i)for(var a=0;a<i.length;a++)i[a].removeAttribute("data-showing");o.bubble_&&(o.animate_once(o.bubble_,"hideBubbleAnimation",function(){o.bubble_&&(0,l.remove_node)(o.bubble_)}),t.workspace.remove_change_listener(e),o.is_showing=!1,o.comments.clear(),o.selected_comment="",o.events.is_enabled()&&o.events.fire(o.ui_event_factory({type:c.UIEventType.COMMENT_OPEN,workspace_id:t.workspace.id,old_value:!0,new_value:!1,block_id:t.id})))}}};window.setTimeout(function(){return t.workspace.add_change_listener(s)})}},t.prototype.update_bubble=function(t,e){var o=this,i=e.get_parent_block();if(i&&(this.bubble_||(this.bubble_=document.createElement("div"),this.bubble_.classList.add("blocklySimplifiedCommentBubble","blocklySimplifiedCommentBubbleCover"),this.bubble_content_=document.createElement("div"),this.bubble_content_.classList.add("blocklySimplifiedCommentBubbleContent")),this.bubble_content_))if("reset"!==t){if("remove"===t){var r,s,c=null==(r=null==(s=this.comments.get(e.id))?void 0:s.parentElement)?void 0:r.parentElement;return c&&this.bubble_content_.removeChild(c),this.comments.delete(e.id),void(this.selected_comment="")}"edit"!==t||(s=this.comments.get(e.id))&&(s.innerText=e.get_text())}else{for(;this.bubble_content_.firstChild;)this.bubble_content_.removeChild(this.bubble_content_.firstChild);for(var l=(0,a.get_outer_block)(i),h=(0,a.get_nested_blocks_with_comment)(l),d=0;d<h.length;d++){var u=h[d];(0,_.is_block_group)(u)?u.nested_blocks_with_comment.forEach(function(t){o.create_comment_bubble_text(t)}):this.create_comment_bubble_text(h[d])}}},t.prototype.create_comment_bubble_text=function(t){var e=this,o=t.comment;if(o){var i=document.createElement("div");i.classList.add("blocklySimplifiedCommentTextWrapper");var r=document.createElement("div");r.classList.add("blocklySimplifiedCommentTextDecorator"),r.style.backgroundColor=t.get_colour().toString();var s=document.createElement("div");s.classList.add("blocklySimplifiedCommentTextBg");var a=document.createElement("div");a.classList.add("blocklySimplifiedCommentText");var _=function(){return 1!==e.comments.size||t.is_output_block()};this.events.bind_event_with_checks(s,"click",o,function(){if(_()){var t,i,r,s=e.selected_comment;if(s){e.selected_comment="";var a=e.comments.get(s);if(null!=(t=null==a?void 0:a.parentElement)&&t.classList.remove("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!0,new_value:!1,block_id:s})),s!==o.id){e.selected_comment=o.id;var l=e.comments.get(o.id);null!=(i=null==l?void 0:l.parentElement)&&i.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!1,new_value:!0,block_id:o.id}))}}else{e.selected_comment=o.id;var h=e.comments.get(o.id);null!=(r=null==h?void 0:h.parentElement)&&r.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!1,new_value:!0,block_id:o.id}))}}});var l=document.createElement("div");l.classList.add("blocklySimplifiedCommentTextSeparator");var h=new Image;h.src=this.Msg.ICON_COMMENT_EDIT,h.alt="Edit",h.classList.add("blocklySimplifiedCommentEditButton"),this.events.bind_event_with_checks(h,"click",o,function(){e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_EDIT,workspace_id:o.workspace.id,old_value:void 0,new_value:void 0,block_id:o.id})),o.focus()});var d=new Image;d.src=this.Msg.ICON_COMMENT_REMOVE,d.classList.add("blocklySimplifiedCommentRemoveButton"),this.events.bind_event_with_checks(d,"click",o,function(){e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_DELETE,workspace_id:o.workspace.id,old_value:void 0,new_value:void 0,block_id:o.id})),t.set_comment_text(void 0)});var u=new Image;u.src=this.Msg.ICON_COMMENT_MORE,u.classList.add("blocklySimplifiedCommentMoreButton"),u.setAttribute("tabindex","-1");var p=!1,f=!1;this.events.bind_event_with_checks(u,"focus",o,function(){var t,i,l,g;f||(f=!0,_()&&(l=e.selected_comment,e.selected_comment=o.id),l&&l!==o.id&&e.events.is_enabled()&&(null!=(t=null==(g=e.comments.get(l))?void 0:g.parentElement)&&t.classList.remove("blocklySimplifiedCommentTextActive"),e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!0,new_value:!1,block_id:l}))),e.selected_comment&&l!==o.id&&(null!=(i=null==(g=e.comments.get(o.id))?void 0:g.parentElement)&&i.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:c.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!1,new_value:!0,block_id:o.id}))),h.style.display="block",e.animate_once(h,"showEditButtonAnimation"),d.style.display="block",e.animate_once(d,"showRemoveButtonAnimation"),e.animate_once(u,"expandMoreButtonAnimation",function(){u.style.transform="rotate(90deg)",p=!0,f=!1}),r.style.opacity="0.4",r.style.left="26px",a.style.opacity="0.4",s.style.marginLeft="26px")}),this.events.bind_event_with_checks(u,"blur",o,function(){f||(f=!0,e.animate_once(h,"hideEditButtonAnimation",function(){return h.style.display=""}),e.animate_once(d,"hideRemoveButtonAnimation",function(){return d.style.display=""}),e.animate_once(u,"collapseMoreButtonAnimation",function(){u.style.transform="",p=!1,f=!1}),a.style.opacity="",s.style.marginLeft="",r.style.opacity="",r.style.left="")}),this.events.bind_event_with_checks(u,"click",o,function(){p?u.blur():u.focus()}),a.innerText=o.get_text(),this.comments.set(o.id,a),this.bubble_&&this.bubble_content_&&(i.appendChild(r),i.appendChild(s),s.appendChild(a),l&&i.appendChild(l),i.appendChild(h),i.appendChild(d),i.appendChild(u),this.bubble_content_.appendChild(i),this.bubble_.appendChild(this.bubble_content_))}},t.prototype.animate_once=function(t,e,o){var i=function i(){t&&(t.removeEventListener("webkitAnimationEnd",i),t.removeEventListener("animationend",i),t.classList.remove(e),o&&o())};t.addEventListener("webkitAnimationEnd",i),t.addEventListener("animationend",i),t.classList.add(e)},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},6765(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ColorController=void 0;var i=o(31635),r=o(71519),s=o(89221),a=o(37747),_=o(35009),c=o(36963);e.ColorController=function(t){function e(){var e=t.call(this)||this;return e.color_handle_element=null,e.current_color_panel_element=null,e.color_review_element=null,e.color_strip_width=182,e.min=0,e.max=100,e}return(0,i.__extends)(e,t),e.prototype.show=function(t,e){var o,i=(null==(o=t.source_block)?void 0:o.is_shadow())?t.source_block.parent_block:t.source_block;i&&(this.owner=t,this.color_format=e.color_format,this.line=e.line,this.color=i.color_,this.color_format&&this.line&&this.color&&(this.init(),this.update_color(),this.container.style.display="block",this.position()))},e.prototype.hide=function(){var t;this.container.style.display="none",null!=(t=this.color_element)&&t.remove()},e.prototype.init=function(){var t=this;this.color_element=document.createElement("div"),this.color_element.classList.add("blockly-controller","color-controller"),this.color_element.setAttribute("tabindex","-1");var e=document.createElement("div"),o="",i=this.Blink.Msg;this.color_format===_.EColorControllerFormat.HSVA?o=this.create_color_panel([["h","H "+i.HUE],["s","S "+i.SATURATION],["v","V "+i.BRIGHTNESS],["a","A "+i.OPACITY]]):this.color_format===_.EColorControllerFormat.RGBA&&(o=this.create_color_panel([["r","R "+i.RED],["g","G "+i.GREEN],["b","B "+i.BLUE],["a","A "+i.OPACITY]])),e.innerHTML=o,e.classList.add("color-panel"),this.color_element.appendChild(e),e.childNodes.forEach(function(e){var o,i,r;t.set_color_panel_item_left(e),e.addEventListener("mousedown",t.bind_color_strip_event.bind(t,e)),null!=(o=e.querySelector(".color-handle"))&&o.addEventListener("mousedown",t.bind_color_event.bind(t)),null!=(i=e.querySelector(".color-strip-panel"))&&i.addEventListener("mousedown",t.bind_color_event.bind(t)),e.querySelector(".color-strip-panel").addEventListener("mouseup",t.set_color_handle_position.bind(t)),(null==(r=t.line)?void 0:r.toLowerCase())===e.getAttribute("data")&&(t.color_handle_element=e.querySelector(".color-handle"),t.current_color_panel_element=e.querySelector(".color-strip-panel"))});var r="\n      <div>\n        "+i.COLOR_PREVIEW+'\n      </div>\n      <div class="color-preview">\n      </div>\n    ',s=document.createElement("div");s.classList.add("preview-panel"),s.innerHTML=r,this.color_review_element=s.querySelector(".color-preview"),this.color_element.appendChild(s),this.container.appendChild(this.color_element),document.body.appendChild(this.container)},e.prototype.update_color=function(){if(this.color&&this.color_element&&this.color_format&&this.line&&this.owner&&"number"==typeof this.owner.min_&&"number"==typeof this.owner.max_){this.min=this.owner.min_,this.max=this.owner.max_;var t=this.field_to_color_value(Number(this.owner.get_value()),this.min,this.max);this.set_color_value(t),this.update_dropdown_color()}},e.prototype.set_color_panel_item_left=function(t){var e,o,i,r,s,a,_=null==(o=null==(e=this.owner)?void 0:e.source_block)?void 0:o.parent_block,c=t.getAttribute("data"),l=t.querySelector(".color-handle");if(_&&c&&l){var h=this.get_field_value(_,c.toUpperCase()),d=(null==(a=null==(s=null==(r=null==(i=_.get_input_target_block(c.toUpperCase()))?void 0:i.output_connection)?void 0:r.target_connection)?void 0:s.get_shadow_dom())?void 0:a.firstChild).getAttribute("constraints");if(d){var u=d.split(","),p=u[0],f=u[1],g=this.field_to_color_value(h,p,f);l.style.left=g+"px"}}},e.prototype.create_color_panel=function(t){return t.map(function(t){return'<div data="'+t[0]+'" id="'+t[0]+'_panel" class="color-panel-item">\n    <div class="color-label">'+t[1]+'</div>\n    <div class="color-strip-panel">\n      <div id="'+t[0]+'_panel_strip" class="color-strip"></div>\n      <div class="color-handle"></div>\n    </div>\n  </div>'}).join("")},e.prototype.get_linear_gradient_rgba=function(t,e,o){var r=(0,i.__assign)({},t),s=(0,i.__assign)({},t);return r[e]=0,s[e]=o,"linear-gradient(90deg, "+(0,a.rgba_to_hex)(r)+", "+(0,a.rgba_to_hex)(s)+")"},e.prototype.get_linear_gradient_hsva=function(t,e,o){var r,s,_=null==(s=null==(r=this.owner)?void 0:r.source_block)?void 0:s.parent_block;if(!_)return"";var c={h:this.get_field_value(_,"H"),s:this.get_field_value(_,"S"),v:this.get_field_value(_,"V")};if("h"===e)return"linear-gradient(90deg, \n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:0})))+",\n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:60})))+",\n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:120})))+",\n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:180})))+",\n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:240})))+",\n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:300})))+",\n        "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},c),{a:t.a,h:360})))+")";var l=(0,i.__assign)((0,i.__assign)({},c),{a:t.a}),h=(0,i.__assign)((0,i.__assign)({},c),{a:t.a});return l[e]=0,h[e]=o,"linear-gradient(90deg, "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)(l))+", "+(0,a.rgba_to_hex)((0,a.hsva_to_rgba)(h))+")"},e.prototype.update_dropdown_color=function(){var t=this,e=this.color;if(e){this.color_review_element&&(this.color_review_element.style.background=e.toString());var o="rgba",i=[["r",255],["g",255],["b",255],["a",1]];this.color_format===_.EColorControllerFormat.HSVA&&(o="hsva",i=[["h",360],["s",100],["v",100],["a",1]]),i.forEach(function(i){var r,s,a,_,c,l=document.getElementById(i[0]+"_panel_strip");if(l){if(!(null==(_=null==(a=null==(s=null==(r=t.owner)?void 0:r.source_block)?void 0:s.parent_block)?void 0:a.get_input_target_block(i[0].toString().toUpperCase()))?void 0:_.get_field_value("NUM"))){var h=document.getElementById(i[0]+"_panel");h.style.opacity="0.2",null!=(c=null==h?void 0:h.querySelector(".color-handle"))&&c.remove(),l.style.cursor="not-allowed"}l.style.background="rgba"===o?t.get_linear_gradient_rgba(e,i[0],i[1]):t.get_linear_gradient_hsva(e,i[0],i[1])}})}},e.prototype.update_value=function(t){if(this.color&&this.line){if("A"===this.line)this.color.a=t/100;else if(this.color_format===_.EColorControllerFormat.RGBA)this.color[this.line.toLowerCase()]=t;else if(this.color_format===_.EColorControllerFormat.HSVA){var e,o,i=null==(o=null==(e=this.owner)?void 0:e.source_block)?void 0:o.parent_block;if(!i)return;var r=this.get_field_value(i,"H"),s=this.get_field_value(i,"S"),c=this.get_field_value(i,"V");if(!r||!s||!c)return;var l={h:r,s:s,v:c};l[this.line.toLowerCase()]=t;var h=(0,a.hsv_to_rgb)(l),d=h[0],u=h[1],p=h[2];this.color.r=d,this.color.g=u,this.color.b=p}var f=this.field_to_color_value(t,this.min,this.max);this.set_color_value(f),this.update_dropdown_color()}},e.prototype.get_field_value=function(t,e){var o,i,r,s,a;return(null==(o=t.get_input_target_block(e))?void 0:o.get_field_value("NUM"))||(null==(a=null==(s=null==(r=null==(i=t.get_input_target_block(e))?void 0:i.output_connection)?void 0:r.target_connection)?void 0:s.get_shadow_dom())?void 0:a.textContent)},e.prototype.field_to_color_value=function(t,e,o){var i=(0,s.clamp)(t,e,o);return Math.round((e<0?i-e:i)/(o-e)*this.color_strip_width)},e.prototype.bind_color_strip_event=function(t){var e,o,i,r,s=t.getAttribute("data");if(s){var a=null==(r=null==(i=null==(o=null==(e=this.owner)?void 0:e.source_block)?void 0:o.parent_block)?void 0:i.get_input_target_block(s.toUpperCase()))?void 0:r.get_field("NUM");a?(this.owner=a,this.line=s.toUpperCase(),this.color_handle_element=t.querySelector(".color-handle"),this.current_color_panel_element=t.querySelector(".color-strip-panel"),this.update_color()):this.color_handle_element=null}},e.prototype.bind_color_event=function(t){var e=this;if(t.preventDefault(),this.current_color_panel_element){this.current_color_panel_item_left=this.current_color_panel_element.getBoundingClientRect().left;var o=this.move_color_handle.bind(this);document.addEventListener("mousemove",o),document.addEventListener("mouseup",function t(){e.current_color_panel_item_left=void 0,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t)})}},e.prototype.move_color_handle=function(t){t.stopPropagation(),this.update_color_and_field_value(t.clientX)},e.prototype.set_color_handle_position=function(t){this.current_color_panel_element&&(this.current_color_panel_item_left=this.current_color_panel_element.getBoundingClientRect().left,this.update_color_and_field_value(t.clientX))},e.prototype.update_color_and_field_value=function(t){if(this.current_color_panel_item_left&&this.color_handle_element){var e,o,i=(null==(o=null==(e=this.owner)?void 0:e.source_block)?void 0:o.get_workspace().get_scale())||1,r=(t-this.current_color_panel_item_left)/i,a=(0,s.clamp)(r,0,this.color_strip_width),_=this.max-this.min,c=Math.round(a/this.color_strip_width*_),l=this.min<0?c+this.min:c;this.set_color_value(a),this.owner&&(this.owner.set_html_input_value(l.toString()),this.owner.on_html_input_change(),this.owner.get_value()!==l.toString()&&this.owner.set_value(l.toString()))}},e.prototype.set_color_value=function(t){this.color_handle_element&&(this.color_handle_element.style.left=t+"px")},(0,i.__decorate)([(0,c.lazy_inject)(c.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(14494).Controller)},16325(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseNode=void 0;var i=o(25507);e.BaseNode=function(){function t(t){this.children_=[],this.selectable_=!0,this.selected_=!1,this.disabled_=!1,this.expanded_=!0,this.name_=t||""}return t.prototype.get_name=function(){return this.name_},t.prototype.set_tree=function(t){this.parent_=t},t.prototype.get_tree=function(){return this.parent_},t.prototype.get_element=function(){return this.element_},t.prototype.get_children_container=function(){return this.children_container_},t.prototype.dispose=function(){this.children_=[]},t.prototype.has_children=function(){return this.children_.length>0},t.prototype.get_children=function(){return this.children_},t.prototype.remove_child_at=function(t){return this.remove_child(this.children_[t])},t.prototype.remove_child=function(t){if(!t||t.get_tree()!==this)throw Error("Not our child.");return t.dispose(),t},t.prototype.remove_children=function(){for(var t=[];this.has_children();)t.push(this.remove_child_at(0));return t},t.prototype.add_child_at=function(t,e){var o=t.get_tree();if(o!==this){void 0!=o&&o.remove_child(t);var r=this.children_[e];return this.children_.splice(e,0,t),r?(0,i.insert_before)(t.html_div,r.html_div):this.children_container_.appendChild(t.html_div),t.set_tree(this),t}},t.prototype.add=function(t){return this.add_child_at(t,this.children_.length)},t.prototype.is_selectable=function(){return this.selectable_},t.prototype.is_selected=function(){return this.selected_},t.prototype.select=function(){this.selected_=!0},t.prototype.unselect=function(){this.selected_=!1},t.prototype.set_disabled=function(t){t!==this.disabled_&&(this.disabled_=t)},t.prototype.is_disabled=function(){return this.disabled_},t.prototype.set_expanded=function(t){if(t!==this.expanded_){this.expanded_=t;var e="blocklyTreeExpanded";!this.expanded_&&this.html_div.classList.contains(e)?this.html_div.classList.remove(e):this.expanded_&&!this.html_div.classList.contains(e)&&this.html_div.classList.add(e),this.children_container_.style.display=this.expanded_?"":"none"}},t.prototype.is_expanded=function(){return this.expanded_},t}()},64635(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TreeNode=void 0;var i=o(31635),r=o(36963),s=o(86295),a=o(25507);e.TreeNode=function(t){function e(o){var i=t.call(this)||this;i.DEFAULT_CLASSNAMES={NORMAL:"blocklyTreeRow",SELECTED:"blocklyTreeSelected",DISABLED:"blockly_toolbox_disabled"},i.blocks=[];var r={text:void 0,name:"",color:"",secondary_color:i.theme.flyout.BACKGROUND_COLOR.toString(),element:{unselected_classname:"",disabled_classname:"",selected_classname:"",style:"",selected_style:""},icon:{style:void 0,selected_style:void 0,html:void 0,selected_html:void 0,font_id:void 0,selected_font_id:void 0},children:[],blocks:[],selectable:!0};return o.text&&(o.text=i.utils.replace_message_references(o.text)),i.config_=(0,s.parse_attr_deep)(r,o),i.init(),i.name_=i.config_.name||(0,s.unique_id)("treenode_"),i.selectable_=i.config_.selectable,i.blocks="string"==typeof i.config_.blocks?i.config_.blocks:Array.from(i.config_.blocks),Array.from(i.config_.children).forEach(function(t){var o=new e(t);i.add(o)}),i}return(0,i.__extends)(e,t),e.prototype.get_element=function(){return this.element_},e.prototype.get_color=function(){return this.config_.color},e.prototype.get_flyout_background_color=function(){return this.config_.secondary_color},e.prototype.init=function(){if(this.html_div=document.createElement("div"),this.html_div.className="blocklyTreeNode",this.element_=document.createElement("div"),this.element_.id=this.config_.name,this.element_.setAttribute("role","treeitem"),this.element_.setAttribute("name",this.config_.name),this.icon_el=document.createElement("div"),this.icon_el.className="blocklyTreeIcon",this.config_.icon.font_id?(0,a.create_font_icon)(this.config_.icon.font_id,this.icon_el):this.config_.icon.html&&(this.icon_el.innerHTML=this.config_.icon.html),this.config_.icon.style&&this.icon_el.setAttribute("style",this.config_.icon.style),this.element_.appendChild(this.icon_el),this.config_.color&&(this.element_.style.color=this.config_.color,this.element_.dataset.color=this.config_.color),this.config_.element.style&&this.element_.setAttribute("style",this.config_.element.style),void 0!=this.config_.text){var t=document.createElement("div");t.classList.add("blocklyTreeLabel"),t.textContent=this.config_.text,this.element_.appendChild(t)}this.children_container_=document.createElement("div"),this.children_container_.className="blocklyTreeChildren",this.html_div.appendChild(this.element_),this.html_div.appendChild(this.children_container_),this.element_.className=this.get_node_classname(),this.set_expanded(!1)},e.prototype.get_blocks=function(t){return this.blocks},e.prototype.set_blocks=function(t){"string"==typeof t||Array.isArray(t)?this.blocks=t:this.blocks=Array.from(t)},e.prototype.push_block=function(t){if("string"==typeof this.blocks)throw Error("Trying to add block to a node with custom key");this.blocks.push(t)},e.prototype.select=function(){this.disabled_||(this.selected_=!0,this.update_node())},e.prototype.unselect=function(){this.selected_=!1,this.update_node()},e.prototype.set_disabled=function(t){t!==this.disabled_&&(this.disabled_=t,this.update_node())},e.prototype.get_node_classname=function(){return this.disabled_?"\n        "+this.DEFAULT_CLASSNAMES.NORMAL+"\n        "+this.DEFAULT_CLASSNAMES.DISABLED+"\n        "+this.config_.element.disabled_classname+"\n      ":this.is_selected()?"\n        "+this.DEFAULT_CLASSNAMES.NORMAL+"\n        "+this.DEFAULT_CLASSNAMES.SELECTED+"\n        "+this.config_.element.selected_classname+"\n      ":"\n      "+this.DEFAULT_CLASSNAMES.NORMAL+"\n      "+this.config_.element.unselected_classname+"\n    "},e.prototype.update_node=function(){(this.element_.className=this.get_node_classname(),this.is_selected())?(this.element_.style.backgroundColor=this.get_color(),this.config_.element.selected_style&&this.element_.setAttribute("style",this.config_.element.selected_style),void 0!=this.config_.icon.selected_style&&this.icon_el.setAttribute("style",this.config_.icon.selected_style),void 0!=this.config_.icon.selected_font_id?((0,a.remove_children)(this.icon_el),(0,a.create_font_icon)(this.config_.icon.selected_font_id,this.icon_el)):void 0!=this.config_.icon.selected_html&&(this.icon_el.innerHTML=this.config_.icon.selected_html),this.element_.setAttribute("aria-selected","true")):(this.element_.style.backgroundColor="",this.config_.element.style&&this.config_.element.selected_style&&this.element_.setAttribute("style",this.config_.element.style),this.config_.icon.style&&this.config_.icon.selected_style&&this.icon_el.setAttribute("style",this.config_.icon.style),this.config_.icon.font_id&&this.config_.icon.selected_font_id?((0,a.remove_children)(this.icon_el),(0,a.create_font_icon)(this.config_.icon.font_id,this.icon_el)):this.config_.icon.html&&this.config_.icon.selected_html&&(this.icon_el.innerHTML=this.config_.icon.html),this.element_.setAttribute("aria-selected","false"))},e.prototype.dispose=function(){if(this.parent_){var t=this.parent_.get_children(),e=t.indexOf(this);t.splice(e,1)}this.html_div.remove(),this.set_tree(void 0)},e.prototype.find_node_by_name=function(t){if(this.name_===t)return this;for(var e=0;e<this.children_.length;e++){var o=this.children_[e];if(o.get_name()===t)return o;var i=o.find_node_by_name(t);if(i)return i}},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],e.prototype,"theme",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.utils)],e.prototype,"utils",void 0),e}(o(16325).BaseNode)},69549(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Toolbox=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(35009),_=o(99469),c=o(25507),l=o(86295),h=o(89221),d=o(16325),u=o(64635);e.Toolbox=function(t){function e(e){var o=t.call(this)||this;o.get_node_from_event_=function(t){for(var e=t.target;void 0!=e;){var i=o.find_node_by_name(e.id);if(void 0!=i)return i;if(e==o.children_container_)break;e=e.parentNode}};var i=e.options;o.workspace_=e,o.toolbox_position=e.get_options().toolboxPosition;var r=Object.assign({},o.workspace_.options,{disabledPatternId:i.disabledPatternId,parentWorkspace:e,RTL:e.RTL,toolboxPosition:i.toolboxPosition,blockly_type:i.blockly_type,id:void 0});return o.flyout=o.vertical_flyout_factory(r),o}return(0,i.__extends)(e,t),e.prototype.get_flyout=function(){return this.flyout},e.prototype.get_width=function(){return this.html_div?this.html_div.offsetWidth:0},e.prototype.get_height=function(){return this.html_div?this.html_div.offsetHeight:0},e.prototype.get_workspace_id=function(){if(this.workspace_)return this.workspace_.id},e.prototype.init=function(){var t=this;if(this.workspace_){var e=this.workspace_,o=e.get_options(),i=this.workspace_.get_workspace_drag_surface(),r=i&&i.get_svg();if(void 0!=r){this.html_div=(0,c.create_dom)("div","blocklyToolboxDiv"),this.html_div.setAttribute("dir",e.RTL?"RTL":"LTR"),void 0!==o.toolbox_background_class?this.html_div.classList.add(o.toolbox_background_class):this.html_div.style.background=this.theme.flyout.BACKGROUND_COLOR.toString(),this.children_container_=document.createElement("div"),this.children_container_.className="blocklyTreeRoot",(0,_.assert)(o.toolbox_config,"Toolbox is not defined."),this.populate(o.toolbox_config),this.html_div.appendChild(this.children_container_),(0,c.insert_after)(this.html_div,r),(0,c.insert_before)(this.flyout.create_dom("svg"),this.html_div),this.flyout.init(e),this.position(),this.events.bind_event(this.html_div,"mousedown",this,function(){t.mousedown_time=Date.now()}),this.events.bind_event(this.html_div,"touchmove",this,function(){t.mousedown_time=void 0});var s=(0,l.throttle)(function(e){return t.handle_mousedown(e)},200);this.events.bind_event(this.html_div,"mouseup",this,function(e){t.mousedown_time&&Date.now()-t.mousedown_time<200&&s(e),t.mousedown_time=void 0})}else console.warn("Ref SVG not Found.")}},e.prototype.handle_mousedown=function(t){if(this.utils.is_right_button(t)||t.target==this.html_div)return this.utils.hide_chaff(!1),void this.touch_manager.clear_touch_identifier();this.utils.hide_chaff(!0);var e=this.get_node_from_event_(t);e&&!e.is_disabled()&&(e.is_selected()?this.clear_selection():e.is_selectable()&&this.set_selected_item(e),e.set_expanded(!e.is_expanded()),this.block_animations.toolbox_click_effect()),this.touch_manager.clear_touch_identifier()},e.prototype.populate=function(t){this.remove_children(),this.workspace_&&(Array.isArray(t)?this.build_by_config(t):this.sync_trees_(t),this.workspace_.resize_contents())},e.prototype.build_by_config=function(t){var e=this;t.forEach(function(t){var o=new u.TreeNode(t);e.add(o)})},e.prototype.sync_nodes_=function(t,e){for(var o,i=0,r=void 0;i<t.childNodes.length;i++)if((r=t.childNodes[i])instanceof Element)switch(r.tagName.toUpperCase()){case"SEP":if(void 0==o)break;var s=r.getAttribute("gap");void 0!=s&&o.setAttribute("gap",s);break;case"BLOCK":case"SHADOW":case"LABEL":case"BUTTON":e.push_block(r),o=r}},e.prototype.sync_trees_=function(t){for(var e,o,i=0,r=void 0;i<t.childNodes.length;i++)if((r=t.childNodes[i])instanceof Element)switch(r.tagName.toUpperCase()){case"CATEGORY":var s=r.getAttribute("name");if(void 0==s)throw ReferenceError("Child node does not have name.");var a=r.getAttribute("text")||void 0,_=r.getAttribute("color"),c=_&&(null==(e=this.theme.get_color(_))?void 0:e.fill.toString())||_||void 0,l=r.getAttribute("flyout_background")||void 0,h=r.getAttribute("element_classname")||void 0,d=r.getAttribute("element_disabled_classname")||void 0,p=r.getAttribute("element_classname_selected")||void 0,f=r.getAttribute("element_style")||void 0,g=r.getAttribute("element_selected_style")||void 0,v=r.getAttribute("icon")||void 0,b=r.getAttribute("selected_icon")||void 0,m=r.getAttribute("icon_html")||void 0,y=r.getAttribute("icon_selected_html")||void 0,k=new u.TreeNode({text:a,name:s,color:c,secondary_color:l,element:{unselected_classname:h,disabled_classname:d,selected_classname:p,style:f,selected_style:g},icon:{style:v,selected_style:b,html:m,selected_html:y}}),w=r.getAttribute("custom");w&&0===r.childElementCount?(k.set_blocks(w),k.get_element().dataset.custom=w):(this.sync_nodes_(r,k),0===k.get_blocks().length&&k.set_disabled(!0)),this.add(k);break;case"SEP":console.error("TreeSeparator is not implemented currently. ")}},e.prototype.position=function(){void 0!=this.html_div&&this.workspace_&&(void 0!=this.workspace_.get_parent_svg()?(this.toolbox_position==a.TOOLBOX_POSITION.RIGHT?(this.html_div.style.top="0",this.html_div.style.right="0"):(this.html_div.style.top="0",this.html_div.style.left="0"),this.flyout.position()):console.warn("Parent SVG not Found."))},e.prototype.get_client_rect=function(){if(void 0!=this.html_div){var t=this.html_div.getBoundingClientRect(),e=this.workspace_.get_options().delete_area_margin,o=t.left,i=t.top,r=t.width,s=t.height;return new h.Rect(o-e[3],i-e[0],r+e[1]+e[3],s+e[0]+e[2])}},e.prototype.add_delete_style=function(){(0,c.add_class)(this.html_div,"blocklyToolboxDelete")},e.prototype.remove_delete_style=function(){(0,c.remove_class)(this.html_div,"blocklyToolboxDelete")},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.flyout.dispose(),(0,c.remove_node)(this.html_div),this.workspace_=void 0},e.prototype.get_selected=function(){return this.selected_node},e.prototype.get_last_selected=function(){return this.last_selected_node},e.prototype.set_selected_item=function(t){var e,o,i=this.selected_node;if(t!==i){this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.CATEGORY_WILL_CHANGE,workspace_id:(null==(e=this.workspace_)?void 0:e.id)||"",old_value:i,new_value:t})),i&&i.unselect();var r=[];if(t&&(t.select(),r=t.get_blocks(!0)),t&&r&&r.length>0){var s=t.get_flyout_background_color();if(s){var _=this.flyout.get_background();_&&(_.style.fill=s)}this.flyout.show(r),this.last_selected_node!==t&&this.flyout.scroll_to_start()}else this.flyout.hide();t&&(this.last_selected_node=t),this.selected_node=t,this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.CATEGORY,workspace_id:(null==(o=this.workspace_)?void 0:o.id)||"",old_value:i,new_value:t}))}},e.prototype.clear_selection=function(){this.set_selected_item()},e.prototype.refresh_selection=function(){if(void 0!=this.selected_node){var t=this.selected_node.get_blocks();void 0!=t&&this.flyout.show(t)}},e.prototype.find_node_by_name=function(t){if(t)for(var e=0;e<this.children_.length;e++){var o=this.children_[e];if(o.get_name()===t)return o;var i=o.find_node_by_name(t);if(i)return i}},e.prototype.new_node=function(t){return new u.TreeNode(t)},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],e.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.block_animations)],e.prototype,"block_animations",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],e.prototype,"theme",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.VerticalFlyout)],e.prototype,"vertical_flyout_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],e.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(d.BaseNode)},20716(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockDragSurfaceSvg=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(25507),c=o(78194);e.BlockDragSurfaceSvg=function(){function t(t){this.SVG_=void 0,this.drag_group_=void 0,this.container_=void 0,this.scale_=1,this.surface_xy_=void 0,this.container_=t,this.create_dom()}return t.prototype.create_dom=function(){this.SVG_||(this.SVG_=(0,_.create_svg_element)("svg",{xmlns:c.SVG_NS,"xmlns:html":c.HTML_NS,"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",class:"blocklyBlockDragSurface"},this.container_),this.drag_group_=(0,_.create_svg_element)("g",{},this.SVG_))},t.prototype.set_blocks_and_show=function(t){this.clear_additions(),void 0!=this.drag_group_&&0!==this.drag_group_.childNodes.length&&console.error("Already dragging a block."),this.drag_group_&&this.SVG_&&(this.drag_group_.appendChild(t),this.SVG_.style.display="block",this.surface_xy_=s.vec2.fromValues(0,0))},t.prototype.translate_and_scale_group=function(t,e,o){this.scale_=o;var i=t.toFixed(0),r=e.toFixed(0);this.drag_group_&&this.drag_group_.setAttribute("transform","translate("+i+", "+r+") scale("+o+")")},t.prototype.set_scale=function(t){if(this.scale_=t,this.drag_group_){var e=this.drag_group_.getAttribute("transform"),o="scale("+t+")";this.drag_group_.setAttribute("transform",e?e.replace(/scale\([0-9\.]+\)/,o):o)}},t.prototype.translate_surface_internal=function(){if(void 0==this.surface_xy_)throw Error("surfaceXY_ can not be undefined");if(void 0==this.SVG_)throw Error("SVG_ can not be undefined");var t=this.surface_xy_[0],e=this.surface_xy_[1],o=t.toFixed(0),i=e.toFixed(0);this.SVG_.style.display="block",(0,_.set_css_transform)(this.SVG_,"translate3d("+o+"px, "+i+"px, 0px)")},t.prototype.translate_surface=function(t,e){this.surface_xy_=s.vec2.fromValues(t*this.scale_,e*this.scale_),this.translate_surface_internal()},t.prototype.get_surface_translation=function(){var t=this.utils.get_relative_xy(this.SVG_);return s.vec2.fromValues(t[0]/this.scale_,t[1]/this.scale_)},t.prototype.get_group=function(){return this.drag_group_},t.prototype.get_current_block=function(){if(this.drag_group_)return this.drag_group_.firstChild},t.prototype.clear_and_hide=function(t){var e=this.get_current_block();t?void 0!=e&&t.appendChild(e):this.drag_group_&&void 0!=e&&this.drag_group_.removeChild(e),this.SVG_&&(this.SVG_.style.display="none"),this.drag_group_&&(this.clear_additions(),0!==this.drag_group_.childNodes.length&&console.error("Drag group was not cleared.")),this.surface_xy_=void 0},t.prototype.clear_additions=function(){if(this.drag_group_)for(var t=this.drag_group_.childElementCount-1;t>=0;t--){var e=this.drag_group_.children[t];e.classList.contains("blocklyDraggable")||(0,_.remove_node)(e)}},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},85905(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionDB=void 0;var i=o(31635),r=o(71519);e.ConnectionDB=function(){function t(){this.connections=[],this.connections=[]}return t.prototype.add_connection=function(t){if(t.in_db)throw Error("Connection already in database.");if(!t.get_source_block().is_in_flyout){var e=this.find_position_for_connection(t);this.connections.splice(e,0,t),t.in_db=!0}},t.prototype.find_connection=function(t){if(!this.connections.length)return -1;var e=this.find_position_for_connection(t);if(e>=this.connections.length)return -1;for(var o=t.y_,i=e,r=e;i>=0&&this.connections[i].y_==o;){if(this.connections[i]==t)return i;i--}for(;r<this.connections.length&&this.connections[r].y_==o;){if(this.connections[r]==t)return r;r++}return -1},t.prototype.find_position_for_connection=function(t){if(!this.connections.length)return 0;for(var e=0,o=this.connections.length;e<o;){var i=Math.floor((e+o)/2);if(this.connections[i].y_<t.y_)e=i+1;else{if(!(this.connections[i].y_>t.y_)){e=i;break}o=i}}return e},t.prototype.remove_connection=function(t){if(!t.in_db)throw Error("Connection not in database.");var e=this.find_connection(t);if(-1==e)throw Error("Unable to find connection in connectionDB.");t.in_db=!1,this.connections.splice(e,1)},t.prototype.get_neighbours=function(t,e){for(var o=t.x_,i=t.y_,r=this.connections,s=0,a=r.length-2,_=a;s<_;)r[_].y_<i?s=_:a=_,_=Math.floor((s+a)/2);var c=[];function l(t){var s=o-r[t].x_,a=i-r[t].y_;return Math.sqrt(s*s+a*a)<=e&&c.push(r[t]),a<e}if(s=_,a=_,r.length){for(;s>=0&&l(s);)s--;do a++;while(a<r.length&&l(a))}return c},t.prototype.is_in_y_range=function(t,e,o){return Math.abs(this.connections[t].y_-e)<=o},t.prototype.search_for_closest=function(t,e,o){if(!t.source_block.is_stack_connectable()||!this.connections.length)return{connection:void 0,radius:e};var i=t.y_,r=t.x_;t.x_=r+o[0],t.y_=i+o[1];for(var s,a=this.find_position_for_connection(t),_=void 0,c=e,l=a-1;l>=0&&this.is_in_y_range(l,t.y_,e);)s=this.connections[l],t.is_connection_allowed(s,c)&&(_=s,c=s.distance_from(t)),l--;for(var h=a;h<this.connections.length&&this.is_in_y_range(h,t.y_,e);)s=this.connections[h],t.is_connection_allowed(s,c)&&(_=s,c=s.distance_from(t)),h++;return t.x_=r,t.y_=i,{connection:_,radius:c}},(0,i.__decorate)([(0,r.injectable)()],t)}()},59946(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Grid=void 0;var i=o(31635),r=o(71519),s=o(25507),a=o(84728);e.Grid=function(){function t(t){this.scale=1;var e=t.svg_defs,o=t.svg_rnd,i=t.gridOptions;this.spacing=i.spacing,this.step=i.step,this.snap_to_grid=i.snap,this.grid_pattern=(0,s.create_svg_element)("pattern",{id:"blocklyGridPattern"+o,patternUnits:"userSpaceOnUse",fill:"transparent"},e),this.bg_rect=(0,s.create_svg_element)("rect",{class:"blinkGridPatternBg",fill:"transparent"},this.grid_pattern),this.outer_rect=(0,s.create_svg_element)("path",{class:"blinkGridPatternOuter",stroke:"rgb(136, 136, 136)"},this.grid_pattern),this.inner_lines=(0,s.create_svg_element)("path",{class:"blinkGridPatternInner",stroke:"rgb(136, 136, 136)"},this.grid_pattern),this.update()}return t.prototype.should_snap=function(){return this.snap_to_grid},t.prototype.move_to=function(t,e){this.grid_pattern.setAttribute("x",String(t)),this.grid_pattern.setAttribute("y",String(e)),(a.is.ie()||a.is.edge())&&this.set_scale(this.scale)},t.prototype.get_spacing=function(){return this.spacing},t.prototype.get_pattern_id=function(){return this.grid_pattern.id},t.prototype.dispose=function(){(0,s.remove_node)(this.grid_pattern)},t.prototype.update=function(){var t=this.spacing*this.scale||10,e=t*this.step;this.grid_pattern.setAttribute("width",e.toString()),this.grid_pattern.setAttribute("height",e.toString()),this.bg_rect.setAttribute("width",e.toString()),this.bg_rect.setAttribute("height",e.toString()),this.outer_rect.setAttribute("d","M "+e+" 0 L 0 0 0 "+e);for(var o=[],i=[],r=1;r<this.step;r++)o.push("M 0 "+r*t+" L "+e+" "+r*t),i.push("M "+r*t+" 0 L "+r*t+" "+e);this.inner_lines.setAttribute("d",o.join(" ")+i.join(" "))},t.prototype.set_scale=function(t){this.scale=t,this.update()},t.prototype.set_color=function(t,e){this.bg_rect.setAttribute("fill",t),this.outer_rect.setAttribute("stroke",e),this.inner_lines.setAttribute("stroke",e)},(0,i.__decorate)([(0,r.injectable)()],t)}()},84879(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceAudio=void 0;var i=o(31635),r=o(71519),s=o(25507),a=o(84728),_=o(36963);e.WorkspaceAudio=function(){function t(t){this.last_sound_=void 0,this.SOUNDS_={},this.parent_workspace_=t}return t.prototype.load=function(t,e){if(t.length){try{o=new window.Audio}catch(t){return}for(var o,i,r=0;r<t.length;r++){var s=t[r],a=s.match(/\.(\w+)$/);if(a&&o.canPlayType("audio/"+a[1])){i=new window.Audio(s);break}}i&&i.play&&(this.SOUNDS_[e]=i)}},t.prototype.play=function(t,e){var o=this.SOUNDS_[t];if(o){var i=Date.now();if(void 0!=this.last_sound_&&i-this.last_sound_<this.theme.blink_params.SOUND_LIMIT)return;this.last_sound_=i;var r=void 0;(r=a.is.ie(9)||a.is.ipad()||a.is.android()?o:(0,s.clone_node)(o)).volume=void 0==e?1:e;var _=r.play();_&&_.catch(function(t){console.log(t)})}else if(this.parent_workspace_){var c=this.parent_workspace_.get_audio_manager();c&&c.play(t,e)}},t.prototype.preload=function(){for(var t in this.SOUNDS_)if(this.SOUNDS_[t].volume=.01,a.is.ipad()||a.is.iphone())break},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},3840(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDragSurfaceSvg=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(25507),_=o(78194);e.WorkspaceDragSurfaceSvg=function(){function t(t,e){this.previous_sibling_=void 0,this.container_=t,this.SVG_=(0,a.create_svg_element)("svg",{xmlns:_.SVG_NS,"xmlns:html":_.HTML_NS,"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",class:"blocklyWsDragSurface"}),e?(0,a.insert_after)(this.SVG_,e):this.container_.appendChild(this.SVG_)}return t.prototype.get_svg=function(){return this.SVG_},t.prototype.translate_surface=function(t,e){t=Number(t.toFixed(0)),e=Number(e.toFixed(0)),this.SVG_.style.display="block",(0,a.set_css_transform)(this.SVG_,"translate3d("+t+"px, "+e+"px, 0px)")},t.prototype.set_contents_and_show=function(t,e,o,i){if(!this.SVG_)throw Error("No Svg Element");0!==this.SVG_.childNodes.length&&console.error("Already dragging a block."),this.previous_sibling_=o,this.SVG_.style.display="none";var r=document.createDocumentFragment();r.appendChild(t),e&&r.appendChild(e),r.firstElementChild&&r.firstElementChild.setAttribute("transform","translate(0, 0) scale("+i+")"),r.lastElementChild&&r.lastElementChild.setAttribute("transform","translate(0, 0) scale("+i+")"),this.SVG_.appendChild(r),this.SVG_.style.display="block"},t.prototype.get_surface_translation=function(){return this.utils.get_relative_xy(this.SVG_)},t.prototype.clear_and_hide=function(t){if(!this.SVG_)throw Error("No Svg_");var e=this.SVG_.childNodes[0],o=this.SVG_.childNodes[1];if(!e||!o||!(0,a.has_class)(e,"blocklyBlockCanvas")||!(0,a.has_class)(o,"blocklyBubbleCanvas"))throw Error("Couldn't clear and hide the drag surface.  A node was missing.");void 0!=this.previous_sibling_?(0,a.insert_after)(e,this.previous_sibling_):t.insertBefore(e,t.firstChild),(0,a.insert_after)(o,e),this.SVG_.style.display="none",0!=this.SVG_.childNodes.length&&console.error("Drag surface was not cleared."),(0,a.set_css_transform)(this.SVG_,""),this.previous_sibling_=void 0},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},21653(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceSvg=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(35009),c=o(44015),l=o(89221),h=o(25507),d=o(443),u=o(86295),p=o(84728);e.WorkspaceSvg=function(){var t;function e(t,e,o,i){this.connectionDBList=[],this.degrade_translate=void 0,this.MAX_UNDO=1024,this.SCAN_ANGLE=3,this.listeners_=[],this.blockDB_=new Map,this.workspace_comment_db=new Map,this.undo_stack_=[],this.redo_stack_=[],this.top_blocks_=[],this.top_comments=[],this.is_clearing=!1,this.is_drag_surface_active_=!1,this.cached_parent_svg_=void 0,this.flyout_=void 0,this.toolbox_=void 0,this.inverse_screen_CTM_=void 0,this.inverse_screen_CTM_dirty_=!0,this.blocks_area_=void 0,this.workspace_area_=void 0,this.workspace_area_dirty_=!0,this.delete_area_flyout=void 0,this.is_flyout_rect_dirty_=!0,this.toolbox_category_callbacks_={},this.last_recorded_page_scroll_=void 0,this.resize_handler_wrapper_=void 0,this.rendered=!0,this.is_flyout=!1,this.resizes_enabled_=!0,this.toolbox_refresh_enabled_=!0,this.scroll_xy=s.vec2.create(),this.content_offset_by_view=s.vec2.create(),this.drag_delta_xy_=s.vec2.create(),this.scale=1,this.current_gesture_=void 0,this.workspace_drag_surface_=void 0,this.injection_div_=void 0,this.flyout_button_callbacks_={},this.custom_flyout_buttons=new Map,this.svg_group=void 0,this.svg_bubble_canvas_=void 0,this.target_workspace=void 0,this.event_dict=new Map,this.custom_change_events_=new Map,this.pre_paste=[],this.pre_paste_extend=[],this.gestures_enabled=!0,this.offset=s.vec2.fromValues(0,0),this.is_hotkey_enable=!0,this.id=t.id||(0,l.gen_uid)(),this.workspace_db.add(this),this.options=t,this.RTL=!!this.options.RTL,this.toolbox_position=this.options.toolboxPosition,this.is_flyout=t.in_flyout,this.top_blocks_=[],this.top_comments=[],this.listeners_=[],this.undo_stack_=[],this.redo_stack_=[],this.get_metrics=t.get_metrics||this.get_metrics,this.set_metrics=t.set_metrics||this.set_metrics,this.init_connection_db(),e&&(this.block_drag_surface_=e),o&&(this.workspace_drag_surface_=o),i&&(this.injection_div_=i),this.audio_manager_=this.workspace_audio_factory(t.parentWorkspace),!t.in_flyout&&t.svg_defs&&t.svg_rnd&&(this.grid_=this.grid_factory(t))}return t=e,e.prototype.get_element_from_db=function(t){return this.blockDB_.get(t)||this.workspace_comment_db.get(t)},e.prototype.get_options=function(){return this.options},e.prototype.get_undo_stack=function(){return this.undo_stack_},e.prototype.set_undo_stack=function(t){this.undo_stack_=t},e.prototype.get_redo_stack=function(){return this.redo_stack_},e.prototype.set_redo_stack=function(t){this.redo_stack_=t},e.prototype.get_toolbox=function(){return this.toolbox_},e.prototype.get_flyout=function(){return this.flyout_?this.flyout_:this.toolbox_?this.toolbox_.flyout:void 0},e.prototype.get_workspace_area=function(){var t=this.get_parent_svg();return this.workspace_area_dirty_&&void 0!=t&&(this.workspace_area_=t.getBoundingClientRect(),this.workspace_area_dirty_=!1),this.workspace_area_},e.prototype.get_delete_area_flyout=function(){if(!this.is_flyout_rect_dirty_)return this.delete_area_flyout;var t=this.flyout_||this.toolbox_&&this.toolbox_.flyout;return t&&t.is_visible()&&"none"!==this.get_options().delete_area?this.delete_area_flyout=t.get_client_rect():this.delete_area_flyout=void 0,this.is_flyout_rect_dirty_=!1,this.delete_area_flyout},e.prototype.get_block_drag_surface=function(){return this.block_drag_surface_},e.prototype.is_resizes_enabled=function(){return this.resizes_enabled_},e.prototype.get_scale=function(){return this.scale},e.prototype.get_delete_area_toolbox=function(){return this.delete_area_toolbox_},e.prototype.get_scrollbar=function(){return this._scrollbar},e.prototype.set_scrollbar=function(t){this._scrollbar=t},e.prototype.get_workspace_drag_surface=function(){return this.workspace_drag_surface_},Object.defineProperty(e.prototype,"use_workspace_drag_surface_",{get:function(){return this.degrade_translate?this.blockDB_.size<this.degrade_translate:!!this.workspace_drag_surface_},enumerable:!1,configurable:!0}),e.prototype.get_target_workspace=function(){return this.target_workspace},e.prototype.set_target_workspace=function(t){this.target_workspace=t},e.prototype.init_connection_db=function(){this.connectionDBList[_.CONNECTION_TYPE.INPUT_VALUE]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.OUTPUT_VALUE]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.NEXT_STATEMENT]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.PREVIOUS_STATEMENT]=this.connection_db_factory()},e.prototype.remaining_capacity=function(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.get_all_blocks().length},e.prototype.undo=function(t){var e=t?this.redo_stack_:this.undo_stack_,o=t?this.undo_stack_:this.redo_stack_,i=e.pop();if(i){for(var r=[i],s=i._group;e.length&&s&&s==e[e.length-1]._group;){var a=e.pop();a&&r.push(a)}for(var _=0;_<r.length;_++){var c=r[_];o.push(c)}var l=this.events.filter(r,!!t);this.events.set_record_undo(!1),this.events.set_undoing(!0),this.set_resizes_enabled(!1);try{for(s&&this.events.set_group(s),_=0;_<l.length;_++){var h=l[_];h.run&&h.run(!!t)}s&&this.events.set_group(!1)}catch(t){console.error(t)}finally{this.set_resizes_enabled(!0),this.events.set_undoing(!1),this.events.set_record_undo(!0)}}},e.prototype.clear_undo=function(){this.undo_stack_.length=0,this.redo_stack_.length=0,this.events.clear_pending_undo()},e.prototype.get_all_blocks=function(){for(var t=this.get_top_blocks(!1),e=0;e<t.length;e++)t.push.apply(t,t[e].get_children());return t},e.prototype.add_top_block=function(t){this.top_blocks_.push(t)},e.prototype.add_top_comment=function(t){this.top_comments.push(t)},e.prototype.get_top_blocks=function(t,e){void 0===e&&(e=!1);var o=this.top_blocks_.filter(function(t){return!t.parent_group});if(e&&(o=o.filter(function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE})),t&&o.length>1){var i=Math.sin((0,l.to_radians)(this.SCAN_ANGLE));this.RTL&&(i*=-1),o.sort(function(t,e){var o=t.get_relative_to_surface_xy(),r=e.get_relative_to_surface_xy();return o[1]+i*o[0]-(r[1]+i*r[0])})}return o},e.prototype.get_last_block=function(){var t=this.get_top_blocks(!0),e=t[t.length-1];if(e){for(var o=e.get_full_next_block();o;)o=(e=o).get_full_next_block();return e}},e.prototype.get_top_comments=function(t,e){void 0===e&&(e=!1);var o=this.top_comments.slice();if(e&&(o=o.filter(function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE})),t&&o.length>1){var i=Math.sin((0,l.to_radians)(this.SCAN_ANGLE));this.RTL&&(i*=-1),o.sort(function(t,e){var o=t.get_relative_to_surface_xy(),r=e.get_relative_to_surface_xy();return o[1]+i*o[0]-(r[1]+i*r[0])})}return o},e.prototype.get_top_elements=function(t,e){void 0===e&&(e=!1);var o=this.top_comments.slice();if(o=o.concat(this.top_blocks_.filter(function(t){return!t.parent_group})),e&&(o=o.filter(function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE})),t&&o.length>1){var i=Math.sin((0,l.to_radians)(this.SCAN_ANGLE));this.RTL&&(i*=-1),o.sort(function(t,e){var o=t.get_relative_to_surface_xy(),r=e.get_relative_to_surface_xy();return o[1]+i*o[0]-(r[1]+i*r[0])})}return o},e.prototype.remove_change_listener=function(t){(0,d.remove)(this.listeners_,t)},e.prototype.remove_top_block=function(t){if(!(0,d.remove)(this.top_blocks_,t))throw Error("Block "+t.type+" ["+t.id+"] not present in workspace's list of top-most blocks.")},e.prototype.remove_top_comment=function(t){if(!(0,d.remove)(this.top_comments,t))throw Error("Comment "+t.get_text()+" ["+t.id+"] not present in workspace's list of top-most comments.")},e.prototype.fire_change_listener=function(t){if(t.is_record_undo()&&this.events.is_record_undo())for(this.undo_stack_.push(t),this.redo_stack_.length=0;this.undo_stack_.length>this.MAX_UNDO&&this.MAX_UNDO>=0;)this.undo_stack_.shift();for(var e=this.listeners_.slice(),o=0;o<e.length;o++)(0,e[o])(t);var i=this.event_dict.get("common");i&&i(t);var r=this.event_dict.get(t.type);if(r&&r(t),_.AllUIEvents.includes(t.type)){var s=this.event_dict.get(_.BlockEventType.UI);s&&s(t)}},e.prototype.get_block_by_id=function(t){var e=this.blockDB_.get(t),o=this.get_flyout();if(!e&&void 0!=o){var i=o.get_workspace();void 0!=i&&(e=i.blockDB_.get(t))}return e||void 0},e.prototype.add_change_listener=function(t,e){return void 0===e&&(e=!0),e?this.listeners_.push(t):this.listeners_.unshift(t),t},e.prototype.add_event_listener=function(t,e){this.event_dict.set(t,e)},e.prototype.add_custom_change_event=function(t,e){this.custom_change_events_.set(t,e)},e.prototype.get_change_event=function(t){return this.custom_change_events_.get(t)},e.prototype.create_dom=function(t){return this.svg_group=(0,h.create_svg_element)("g",{class:"blocklyWorkspace"}),t&&(this.svg_background_=(0,h.create_svg_element)("rect",{height:"100%",width:"100%",class:t},this.svg_group)),"blocklyMainBackground"==t&&this.grid_&&this.svg_background_&&(this.svg_background_.style.fill="url(#"+this.grid_.get_pattern_id()+")"),this.svg_block_canvas_=(0,h.create_svg_element)("g",{class:"blocklyBlockCanvas"},this.svg_group),this.svg_bubble_canvas_=(0,h.create_svg_element)("g",{class:"blocklyBubbleCanvas"},this.svg_group),!this.is_flyout&&(this.events.bind_event_with_checks(this.svg_group,"mousedown",this,this.on_mouse_down),this.options.ws_scrollable&&this.events.bind_event_with_checks(this.svg_group,"wheel",this,this.on_wheel_scroll)),this.options.has_categories&&(this.toolbox_=this.toolbox_factory(this)),this.record_delete_areas(),this.svg_group},e.prototype.paste=function(t,e,o){void 0===o&&(o=!1),t&&(0,h.reset_all_block_id)(t),this._paste(t,e,o,!1)},e.prototype._paste=function(t,e,o,i){var r;void 0===o&&(o=!1),void 0===i&&(i=!0),this.runtime_data.set_pasting(!0);try{for(var a=0;a<this.pre_paste.length;a++)t&&(t=(r=this.pre_paste[a].call(this,t,e,o||!1,i)).xml_block,e=r.mouse_position,o=r.is_move_to_default);if(!t||!this.rendered||t.getElementsByTagName("block").length>=this.remaining_capacity())return;this.current_gesture_&&this.current_gesture_.cancel(),this.events.disable();var _=this.resizes_enabled_;_&&this.set_resizes_enabled(!1);var l=void 0,h=e||{x:0,y:0};try{if(l=this.xml.dom_to_workspace_element(t,this),(0,u.is_block_svg)(l)&&(l=l.parent_group||l),!l)return;var d=void 0,p=void 0;if(e)h=e,l.move_by(s.vec2.fromValues(e.x,e.y));else{if(o){var f=this.get_origin_offset_in_pixels(),g=this.get_paste_offset();d=(g.left-f[0])/this.scale,p=(g.top-f[1])/this.scale}else{var v=t.getAttribute("x"),b=t.getAttribute("y");if(!v||!b)return;d=parseInt(v,10),p=parseInt(b,10)}if(isNaN(d)||isNaN(p))throw Error();this.RTL&&(d=-d);var m=void 0;do{m=!1;var y=this.get_all_blocks().slice();for(a=0,y=y.concat(this.top_comments.slice());a<y.length;a++){var k=y[a].get_relative_to_surface_xy();if(1>=Math.abs(d-k[0])&&1>=Math.abs(p-k[1])){m=!0;break}}if(!m){var w=(0,u.is_block_svg)(l)?l.get_connections(!1):[];for(a=0;a<w.length;a++)if(w[a].closest(this.theme.blink_params.SNAP_RADIUS,s.vec2.fromValues(d,p)).connection){m=!0;break}}m&&(d+=this.theme.blink_params.SNAP_RADIUS,p+=2*this.theme.blink_params.SNAP_RADIUS)}while(m);h={x:d,y:p},l.move_by(s.vec2.fromValues(d,p))}}finally{this.events.enable(),_&&this.set_resizes_enabled(!0)}l.select();var E=this.events.get_group();return this.events.set_group(E||!0),!this.events.is_enabled()||(0,u.is_block_svg)(l)&&l.is_shadow()||this.events.fire(this.create_event_factory({block:l})),(0,u.is_block_svg)(l)&&((0,c.fire_block_onchange)(l),l.parent_group&&this.events.fire(this.change_event_factory("group_block",{block:l,old_value:void 0,new_value:[l.parent_group.id,l.parent_group.group_name,l.parent_group.group_stop_at||""]}))),this.events.set_group(E||!1),l.bring_to_front(),h}finally{this.runtime_data.set_pasting(!1)}},e.prototype.set_pre_paste=function(t){this.pre_paste.push(t)},e.prototype.set_pre_paste_extend=function(t){this.pre_paste_extend.push(t)},e.prototype.paste_extend=function(t,e,o){void 0===o&&(o=!1);var i=this.events.get_group();this.events.set_group(i||!0),this.runtime_data.set_pasting(!0),(0,h.reset_all_block_id)(t);for(var r=0;r<this.pre_paste_extend.length;r++)t=(_=this.pre_paste_extend[r].call(this,t,e,o||!1)).xml_blocks,e=_.mouse_position,o=_.is_move_to_default;if(t.length<=1)return t[0]&&this._paste(t[0],e,o,!0),void this.events.set_group(i);var s=function(t){var e=t.getAttribute("x"),o=t.getAttribute("y");return{x:parseInt(e||"0",10),y:parseInt(o||"0",10)}},a=this.resizes_enabled_;for(a&&this.set_resizes_enabled(!1),e?this._paste(t[0],e,o):e=this._paste(t[0],void 0,o)||{x:0,y:0},r=1,c=s(t[0]),l=e.x-c.x,d=e.y-c.y,u=t.length;r<u;r++){var _,c,l,d,u,p=t[r],f=s(t[r]),g={x:f.x+l,y:f.y+d};this._paste(p,g,!1)}this.runtime_data.set_pasting(!1),this.events.set_group(i),a&&this.set_resizes_enabled(!0)},e.prototype.get_paste_offset=function(){var t={left:40,top:30},e=(0,h.get_translate)(this.get_parent_svg());return t.left+=e.x,t},e.prototype.record_delete_areas=function(){(this.is_flyout_rect_dirty_=!0,"none"===this.get_options().delete_area)?(this.delete_area_toolbox_=void 0,this.delete_area_flyout=void 0):this.flyout_?this.delete_area_toolbox_=this.flyout_.get_client_rect():this.toolbox_?this.delete_area_toolbox_=this.toolbox_.get_client_rect():this.delete_area_toolbox_=void 0},e.prototype.is_delete_area=function(t){var e=s.vec2.fromValues(t.clientX,t.clientY),o=this.get_delete_area_flyout();return this.delete_area_toolbox_&&this.delete_area_toolbox_.contains(e)||o&&o.contains(e)?_.DeleteArea.DELETE_AREA_TOOLBOX:_.DeleteArea.DELETE_AREA_NONE},e.prototype.set_gestures_enabled=function(t){this.gestures_enabled!==t&&(this.options.pinch&&(t?this.runtime_data.register_finger_events():this.runtime_data.unregister_finger_events()),this.gestures_enabled=t)},e.prototype.is_gestures_enabled=function(){return this.gestures_enabled},e.prototype.on_wheel_scroll=function(t){if(this.current_gesture_&&this.current_gesture_.cancel(),this.gestures_enabled){var e=1===t.deltaMode?15:1;if(t.ctrlKey){var o=p.is.mac()?50:100,i=-t.deltaY/o*e,r=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());this.zoom(r.x,r.y,i)}else{this.widget_div.hide(!0);var s=this.scroll_xy[0]-t.deltaX*e,a=this.scroll_xy[1]-t.deltaY*e;t.shiftKey&&0===t.deltaX&&(s=this.scroll_xy[0]-t.deltaY*e,a=this.scroll_xy[1]),this.start_drag_metrics=this.get_metrics(),this.scroll(s,a)}t.preventDefault()}},e.prototype.show_context_menu=function(t){var e=this;if(!this.options.readOnly&&!this.is_flyout){var o=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm()),i=this.get_origin_offset_in_pixels(),r=(0,h.get_translate)(this.get_parent_svg()),s={x:(o.x+r.x-i[0])/this.scale,y:(o.y+r.y-i[1])/this.scale},a=[];this.options.context_menu.workspace.forEach(function(t){if("number"==typeof t)switch(t){case _.WorkspaceOptionType.CLEAN_UP:return e.add_clean_up_option(a);case _.WorkspaceOptionType.PASTE:return e.add_paste_option(a,s);case _.WorkspaceOptionType.DELETE_ALL:return e.add_delete_all_blocks_option(a);case _.WorkspaceOptionType.COPY_ALL:return e.add_copy_all_blocks_option(a);case _.WorkspaceOptionType.GLOBAL_COMMENT:return e.add_global_comment_option(a,s);default:return console.warn("Undefined workspace menu option: "+t)}var o=t(e);o&&a.push(o)}),this.context_menu.show(t,{source:"workspace",options:a},this.RTL)}},e.prototype.add_paste_option=function(t,e){var o=this,i=this.runtime_data.clipboard.get_content();t.push({text:this.Msg.PASTE,name:"paste",enabled:void 0!=i,callback:function(){i&&(Array.isArray(i)?o.paste_extend(i,e):o.paste(i,e))}})},e.prototype.add_clean_up_option=function(t){if(this._scrollbar){var e=this.get_top_elements(!0),o={text:this.Msg.CLEAN_UP,name:"clean_up",enabled:e.length>1,callback:this.clean_up.bind(this)};t.push(o)}},e.prototype.add_delete_all_blocks_option=function(t,e,o){var i=this;void 0===e&&(e=!0);for(var r=this.get_top_elements(!0,e),s=[],a=0;a<r.length;a++)!function t(e){if((0,u.is_block_svg)(e))if(e.is_deletable())s=s.concat(e.get_descendants());else for(var o=e.get_children(),i=0;i<o.length;i++)t(o[i]);else e.is_deletable()&&(s=s.concat([e]))}(r[a]);var _=this.events.get_group(),l=function t(){""===_?(i.events.set_group(!0),_=i.events.get_group()):i.events.set_group(_);var e=s.shift();e&&(e.workspace?(e.dispose(!1,!0),window.setTimeout(t,10)):t()),i.events.set_group(!1)},h=(0,c.cal_num_blocks)(s),d={text:this.Msg.DELETE_X_BLOCKS.replace("%1",String(h)),name:"delete_all",enabled:h>0,callback:function(){i.current_gesture_&&i.current_gesture_.cancel(),!o||h<2?l():o(l)}};t.push(d)},e.prototype.add_copy_all_blocks_option=function(t,e){var o=this;void 0===e&&(e=!0);var i=this.get_top_elements(!0,e),r=0;i.forEach(function(t){(0,u.is_block_svg)(t)?r+=(0,c.cal_num_blocks)(t.get_descendants()):r++}),t.push({text:this.Msg.COPY_ALL.replace("%1",String(r)),name:"copy_all",enabled:r>0,callback:function(){o.runtime_data.clipboard.copy_all(i)}})},e.prototype.add_global_comment_option=function(t,e){var o=this;if("simplified"!==this.options.comment_type){var i={text:this.Msg.GLOBAL_COMMENT,name:"global_comment",enabled:!0,callback:function(){var t=o.events.get_group();o.events.set_group(t||!0);var i=o.new_workspace_comment(e);i.init_svg(),i.set_expanded(!0),i.focus(),o.events.set_group(t)}};t.push(i)}else console.warn("Trying to create global comment when using simplified comment. Ignoring this command. ")},e.prototype.new_workspace_comment=function(t,e){return this.workspace_comment_factory({workspace:this,type:this.options.comment_type,position:t,opt_id:e})},e.prototype.update_toolbox=function(t){var e="string"==typeof t?this.xml.text_to_dom(t):t;if(void 0!=e){if(!this.options.toolbox_config)throw Error("Existing toolbox is undefined.  Can't create new toolbox.");if(e.getElementsByTagName("category").length){if(!this.toolbox_)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.toolbox_config=e,this.toolbox_.populate(e)}else{if(!this.flyout_)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.toolbox_config=e,this.flyout_.show(e.childNodes)}}else if(this.options.toolbox_config)throw Error("Can't nullify an existing toolbox.")},e.prototype.translate=function(t,e){if(this.use_workspace_drag_surface_&&this.is_drag_surface_active_&&this.workspace_drag_surface_)this.workspace_drag_surface_.translate_surface(t+this.offset[0],e+this.offset[1]);else{var o="translate("+t+", "+e+") scale("+this.scale+")";void 0!=this.svg_block_canvas_&&this.svg_block_canvas_.setAttribute("transform",o),void 0!=this.svg_bubble_canvas_&&this.svg_bubble_canvas_.setAttribute("transform",o)}this.block_drag_surface_&&this.block_drag_surface_.translate_and_scale_group(t+this.offset[0],e+this.offset[1],this.scale)},e.prototype.new_block=function(t,e){return this.block_factory({workspace:this,id:e,prototype_name:t})},e.prototype.get_svg_xy=function(t){var e=s.vec2.create(),o=t,i=1,r=this.get_canvas(),a=this.get_bubble_canvas();(void 0!=r&&r.contains(o)||void 0!=a&&a.contains(o))&&(i=this.scale);do{var _=this.utils.get_relative_xy(o);(o==this.get_canvas()||o==this.get_bubble_canvas())&&(i=1),s.vec2.scaleAndAdd(e,e,_,i),o=o.parentNode}while(o&&o!=this.get_parent_svg());return e},e.prototype.resize=function(){this.toolbox_&&this.toolbox_.position(),this.flyout_&&this.flyout_.position(),this._scrollbar?this._scrollbar.resize():this.translate(this.scroll_xy[0],this.scroll_xy[1]),this.update_screen_calculations()},e.prototype.update_screen_calculations=function(){this.inverse_screen_CTM_dirty_=!0,this.workspace_area_dirty_=!0,this.record_cached_areas()},e.prototype.record_cached_areas=function(){this.record_blocks_area_(),this.record_delete_areas()},e.prototype.record_blocks_area_=function(){var t=this.get_injection_div();this.blocks_area_=t?t.getBoundingClientRect():void 0},e.prototype.get_canvas=function(){return this.svg_block_canvas_},e.prototype.is_dragging=function(){return this.current_gesture_&&this.current_gesture_.is_dragging()},e.prototype.set_resizes_enabled=function(t){var e=!this.resizes_enabled_&&t;this.resizes_enabled_=t,e&&this.resize_contents()},e.prototype.cancel_current_gesture=function(){this.current_gesture_&&this.current_gesture_.cancel()},e.prototype.get_audio_manager=function(){return this.audio_manager_},e.prototype.get_gesture=function(t){var e="mousedown"==t.type||"touchstart"==t.type,o=this.current_gesture_;return o?e&&o.has_started()?void o.cancel():o:e?(this.current_gesture_=this.gesture_factory({event:t,workspace:this}),this.current_gesture_):void 0},e.prototype.get_grid=function(){return this.grid_},e.prototype.is_inside_workspace_area=function(t){var e=s.vec2.fromValues(t.clientX,t.clientY),o=this.get_workspace_area();return!!o&&(0,l.contains)(o,e)},e.prototype.is_inside_blocks_area=function(t){var e=s.vec2.fromValues(t.clientX,t.clientY);return!!(this.is_delete_area(t)||this.blocks_area_&&(0,l.contains)(this.blocks_area_,e))},e.prototype.setup_drag_surface=function(){if(this.use_workspace_drag_surface_&&this.workspace_drag_surface_&&!this.is_drag_surface_active_){if(void 0==this.svg_block_canvas_)throw ReferenceError("Block Canvas not found when draging.");this.is_drag_surface_active_=!0;var t=this.svg_block_canvas_.previousSibling||void 0;if(void 0!=this.get_parent_svg()){var e=this.utils.get_relative_xy(this.svg_block_canvas_);this.workspace_drag_surface_&&(this.workspace_drag_surface_.set_contents_and_show(this.svg_block_canvas_,this.svg_bubble_canvas_,t,this.scale),this.workspace_drag_surface_.translate_surface(e[0]+this.offset[0],e[1]+this.offset[1]))}}},e.prototype.reset_drag_surface=function(){if(this.use_workspace_drag_surface_&&this.workspace_drag_surface_){this.is_drag_surface_active_=!1;var t=this.workspace_drag_surface_.get_surface_translation();this.workspace_drag_surface_.clear_and_hide(this.svg_group);var e="translate("+(t[0]-this.offset[0])+", "+(t[1]-this.offset[1])+") scale("+this.scale+")";void 0!=this.svg_block_canvas_&&this.svg_block_canvas_.setAttribute("transform",e),void 0!=this.svg_bubble_canvas_&&this.svg_bubble_canvas_.setAttribute("transform",e)}},e.prototype.refresh_toolbox_selection=function(){if(this.toolbox_)this.toolbox_.flyout&&!this.current_gesture_&&this.toolbox_refresh_enabled_&&this.toolbox_.refresh_selection();else{var t=this.target_workspace,e=null==t?void 0:t.get_toolbox();t&&e&&e.flyout&&!t.current_gesture_&&t.get_toolbox_refresh_enabled&&e.refresh_selection()}},e.prototype.register_toolbox_category_callback=function(t,e){this.toolbox_category_callbacks_&&(this.toolbox_category_callbacks_[t]=e)},e.prototype.get_parent_svg=function(){if(this.cached_parent_svg_)return this.cached_parent_svg_;for(var t=this.svg_group;t;){if("svg"==t.tagName)return this.cached_parent_svg_=t,t;t=t.parentNode}throw Error("Workspace may not been init.")},e.prototype.get_blocks_bounding_box=function(){var t=this.get_top_blocks(!1);if(this.workspace_comment_db.forEach(function(e){t.push(e)}),!t.length)return{x:0,y:0,width:0,height:0};for(var e=t[0].get_bounding_rectangle(),o=1;o<t.length;o++){var i=t[o].get_bounding_rectangle();i.topLeft[0]<e.topLeft[0]&&(e.topLeft[0]=i.topLeft[0]),i.bottomRight[0]>e.bottomRight[0]&&(e.bottomRight[0]=i.bottomRight[0]),i.topLeft[1]<e.topLeft[1]&&(e.topLeft[1]=i.topLeft[1]),i.bottomRight[1]>e.bottomRight[1]&&(e.bottomRight[1]=i.bottomRight[1])}return{x:e.topLeft[0],y:e.topLeft[1],width:e.bottomRight[0]-e.topLeft[0],height:e.bottomRight[1]-e.topLeft[1]}},e.prototype.set_resize_handler_wrapper=function(t){this.resize_handler_wrapper_=t},e.prototype.resize_contents=function(){this.resizes_enabled_&&this.rendered&&(this._scrollbar&&this._scrollbar.resize(),this.inverse_screen_CTM_dirty_=!0)},e.prototype.get_bubble_canvas=function(){return this.svg_bubble_canvas_},e.prototype.add_flyout=function(t){var e=Object.assign({},this.options,{parentWorkspace:this});return this.flyout_=this.flyout_factory(e),this.flyout_.create_dom(t)},e.prototype.get_toolbox_category_callback=function(t){return this.toolbox_category_callbacks_?this.toolbox_category_callbacks_[t]:void 0},e.prototype.update_screen_calculations_if_scrolled=function(){var t=(0,h.get_document_scroll)();void 0!=this.last_recorded_page_scroll_&&s.vec2.equals(this.last_recorded_page_scroll_,t)||(this.last_recorded_page_scroll_=t,this.update_screen_calculations())},e.prototype.mark_focused=function(){this.options.parentWorkspace instanceof t?this.options.parentWorkspace.mark_focused():(this.Blink.mainWorkspace=this,this.set_browser_focus())},e.prototype.set_browser_focus=function(){document.activeElement&&document.activeElement.blur();try{this.get_parent_svg().focus()}catch(e){try{(t=this.get_parent_svg())&&t.setActive()}catch(e){var t;(t=this.get_parent_svg())&&t.focus()}}},e.prototype.get_inverse_screen_ctm=function(){var t=this.get_parent_svg();if(this.inverse_screen_CTM_dirty_&&void 0!=t){var e=t.getScreenCTM();e&&(this.inverse_screen_CTM_=e.inverse(),this.inverse_screen_CTM_dirty_=!1)}return this.inverse_screen_CTM_},e.prototype.get_origin_offset_in_pixels=function(){if(void 0==this.svg_block_canvas_)throw ReferenceError("Block Canvas not found when get origin offset.");return this.utils.get_injection_div_xy(this.svg_block_canvas_)},e.prototype.get_injection_div=function(){return this.injection_div_},e.prototype.dispose=function(){var t;if(this.rendered=!1,this.current_gesture_&&this.current_gesture_.cancel(),this.listeners_.length=0,this.clear(),this.workspace_db.remove(this),this.svg_group&&((0,h.remove_node)(this.svg_group),this.svg_group=void 0),this.svg_block_canvas_=void 0,this.svg_bubble_canvas_=void 0,this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=void 0),this.flyout_&&(this.flyout_.dispose(),this.flyout_=void 0),this._scrollbar&&(this._scrollbar.dispose(),delete this._scrollbar),null!=(t=this.grid_)&&t.dispose(),this.grid_=void 0,this.toolbox_category_callbacks_={},this.flyout_button_callbacks_={},this.custom_flyout_buttons.clear(),!this.options.parentWorkspace){var e=this.get_parent_svg();if(void 0==e)throw ReferenceError();var o=e.parentNode;void 0!=o&&(0,h.remove_node)(o)}this.resize_handler_wrapper_&&(this.events.unbind_event(this.resize_handler_wrapper_),this.resize_handler_wrapper_=void 0)},e.prototype.set_visible=function(t){this._scrollbar&&this._scrollbar.set_container_visible(t);var e=this.get_flyout();void 0!=e&&e.set_container_visible(t);var o=this.get_parent_svg();if(void 0==o)throw ReferenceError("Workspace may not been init.");if(o.style.display=t?"block":"none",this.toolbox_&&(this.toolbox_.html_div.style.display=t?"block":"none"),t){for(var i=this.get_all_blocks(),r=i.length-1;r>=0;r--)i[r].render(!1);this.resize()}else this.utils.hide_chaff(!0)},e.prototype.glow_stack=function(t,e){var o=this.get_block_by_id(t);if(!o)throw Error("Tried to glow stack on block that does not exist.");o.set_glow_stack(e)},e.prototype.on_mouse_down=function(t){var e=this.get_gesture(t);e&&e.handle_ws_start(t,this)},e.prototype.start_drag=function(t,e){var o=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());o.x/=this.scale,o.y/=this.scale;var i=s.vec2.fromValues(o.x,o.y);this.drag_delta_xy_=s.vec2.sub(e,e,i)},e.prototype.move_drag=function(t){var e=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());e.x/=this.scale,e.y/=this.scale;var o=s.vec2.fromValues(e.x,e.y);return s.vec2.fromValues(this.drag_delta_xy_[0]+o[0],this.drag_delta_xy_[1]+o[1])},e.prototype.is_draggable=function(){return!!this._scrollbar},e.prototype.clean_up=function(t){this.set_resizes_enabled(!1);var e=this.events.get_group();this.events.set_group(e||!0);for(var o=this.get_top_elements(!0),i=s.vec2.fromValues(0,0),r=0;r<o.length;r++)o[r].sort(i);if(t&&this._scrollbar){var a=this.get_metrics(),_=-a.contentLeft-t[0],c=-a.contentTop-t[1];this._scrollbar.set(_,c)}this.events.set_group(e),this.set_resizes_enabled(!0)},e.prototype.zoom=function(t,e,o){var i=Math.pow(this.options.zoomOptions.scaleSpeed,o),r=Math.max(this.options.zoomOptions.minScale,Math.min(this.scale*i,this.options.zoomOptions.maxScale));if(i=r/this.scale,this.scale!=r){if(this._scrollbar&&this.svg_block_canvas_){var a=this.svg_block_canvas_.getCTM();if(!a)return void console.error("Get Canvas CTM failed.");var _=this.get_parent_svg().createSVGPoint();_.x=t,_.y=e,t=(_=_.matrixTransform(a.inverse())).x,e=_.y;var c=a.translate(t*(1-i),e*(1-i)).scale(i);s.vec2.set(this.scroll_xy,c.e,c.f)}this.set_scale(r)}},e.prototype.zoom_center=function(t){var e=this.get_metrics(),o=e.viewWidth/2,i=e.viewHeight/2;this.zoom(o,i,t)},e.prototype.zoom_to_fit=function(){var t=this.get_metrics(),e=this.get_blocks_bounding_box(),o=e.width,i=e.height;if(o){var r=t.viewWidth,s=t.viewHeight;this.flyout_&&(r-=this.flyout_.get_width()),this._scrollbar||(o+=t.contentLeft,i+=t.contentTop);var a=r/o,_=s/i;this.set_scale(Math.min(a,_)),this.scroll_center()}},e.prototype.scroll_center=function(){if(this._scrollbar){this.widget_div.hide(!0),this.utils.hide_chaff(!1);var t=this.get_metrics(),e=(t.contentWidth-t.viewWidth)/2;this.flyout_&&(e-=this.flyout_.get_width()/2);var o=(t.contentHeight-t.viewHeight)/2;this._scrollbar.set(e,o)}},e.prototype.center_on_block=function(t){if(this._scrollbar){var e=this.get_block_by_id(t);if(e){var o=e.get_relative_to_surface_xy(),i=e.get_height_width(),r=o[1]+i.height/2,s=this.RTL?-1:1,a=o[0]+s*i.width/2,_=this.scale,c=this.get_metrics(),l=a*_-c.contentLeft,h=r*_-c.contentTop,d=l-c.viewWidth/2,u=h-c.viewHeight/2;this.utils.hide_chaff(),this._scrollbar.set(d,u)}}},e.prototype.set_scale=function(t){t=Math.max(this.options.zoomOptions.minScale,Math.min(t,this.options.zoomOptions.maxScale)),this.rendered||(this.scale=t),this.events.is_enabled()&&(o=this.ui_event_factory({type:_.UIEventType.SCALE,workspace_id:this.id,old_value:this.scale,new_value:t})),this.scale=t,this.events.fire(o),null!=(e=this.grid_)&&e.set_scale(this.scale),this._scrollbar?this._scrollbar.resize():this.translate(this.scroll_xy[0],this.scroll_xy[1]),this.utils.hide_chaff(!1,!0);var e,o,i=function(e){var o=e.getAttribute("transform"),i="scale("+t+")";e.setAttribute("transform",o?o.replace(/scale\([0-9\.]+\)/,i):i)};this.svg_block_canvas_&&i(this.svg_block_canvas_),this.svg_bubble_canvas_&&i(this.svg_bubble_canvas_),this.block_drag_surface_&&this.block_drag_surface_.set_scale(t),this.flyout_&&this.flyout_.reflow()},e.prototype.scroll=function(t,e){if(this._scrollbar&&this.start_drag_metrics){var o=this.start_drag_metrics;t=Math.min(t,-o.contentLeft),e=Math.min(e,-o.contentTop),t=Math.max(t,o.viewWidth-o.contentLeft-o.contentWidth),e=Math.max(e,o.viewHeight-o.contentTop-o.contentHeight),this.widget_div.hide(!0),this._scrollbar.set(-t-o.contentLeft,-e-o.contentTop)}},e.getDimensionsPx_=function(t){var e=0,o=0;return t&&(e=t.get_width(),o=t.get_height()),{width:e,height:o}},e.getContentDimensions_=function(t,e){return t._scrollbar?this.getContentDimensionsBounded_(t,e):this.getContentDimensionsExact_(t)},e.getContentDimensionsExact_=function(t){var e=t.get_blocks_bounding_box(),o=t.get_scale(),i=e.width*o,r=e.height*o,s=e.x*o,a=e.y*o;return{left:s,top:a,right:s+i,bottom:a+r,width:i,height:r}},e.getContentDimensionsBounded_=function(t,e){var o=this.getContentDimensionsExact_(t),i=e.width||0,r=e.height||0,s=i,a=r,_=t.options.workspace.content_margin;if("number"==typeof _)s=_,a=_;else{var c=_.match(/[0-9]+%/),l=c&&c[0]&&parseFloat(c[0])/100;("number"!=typeof l||isNaN(l))&&(console.error("option workspace.content_margin is not a valid percentage. Using default value (50%)."),l=.5),s=i*l,a=r*l}var h=Math.min(o.left-s,o.right-i),d=Math.max(o.right+s,o.left+i),u=Math.min(o.top-a,o.bottom-r);return{left:h,top:u,height:Math.max(o.bottom+a,o.top+r)-u,width:d-h}},e.prototype.get_metrics=function(){var e=t.getDimensionsPx_(this.toolbox_),o=this.flyout_||this.toolbox_&&this.toolbox_.flyout,i=o&&!o.is_auto_close()&&o.is_visible()?t.getDimensionsPx_(o):{width:0,height:0},r=this.utils.get_svg_size(this.get_parent_svg()),s=t.getContentDimensions_(this,r),a=0;this.toolbox_&&this.toolbox_position==_.TOOLBOX_POSITION.LEFT&&(a+=e.width,a+=i.width);var c=0;return this.toolbox_&&this.toolbox_position==_.TOOLBOX_POSITION.TOP&&(c=e.height+i.height),{absoluteTop:c,absoluteLeft:a,contentHeight:s.height,contentWidth:s.width,contentTop:s.top,contentLeft:s.left,viewHeight:r.height||0,viewWidth:r.width||0,viewTop:-this.scroll_xy[1],viewLeft:-this.scroll_xy[0],flyoutWidth:i.width,flyoutHeight:i.height,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:this.toolbox_position}},e.prototype.set_metrics=function(t){if(!this.get_scrollbar())throw Error("Attempt to set top level workspace scroll without scrollbars.");var e,o=this.get_metrics();(0,u.is_number)(t.x)&&(this.content_offset_by_view[0]=t.x,this.scroll_xy[0]=-o.contentLeft-t.x),(0,u.is_number)(t.y)&&(this.content_offset_by_view[1]=t.y,this.scroll_xy[1]=-o.contentTop-t.y);var i=this.scroll_xy[0],r=this.scroll_xy[1];this.translate(i,r),null!=(e=this.grid_)&&e.move_to(i,r)},e.prototype.set_toolbox_refresh_enabled=function(t){var e=!this.toolbox_refresh_enabled_&&t;this.toolbox_refresh_enabled_=t,e&&this.refresh_toolbox_selection()},e.prototype.get_toolbox_refresh_enabled=function(){return this.toolbox_refresh_enabled_},e.prototype.clear=function(t){void 0===t&&(t=!0),this.set_resizes_enabled(!1),this.is_clearing=!0;var e=this.events.get_group();for(e||this.events.set_group(!0),t&&this.widget_div&&this.widget_div.hide(!0),t&&this.Blink.tooltip&&this.Blink.tooltip.hide();this.top_blocks_.length;)this.top_blocks_[0].dispose();for(;this.top_comments.length;)this.top_comments[0].dispose();e||this.events.set_group(!1),this.is_clearing=!1,this.set_resizes_enabled(!0)},e.prototype.register_button_callback=function(t,e){(0,u.is_func)(e)||console.error("Button callbacks must be functions."),this.flyout_button_callbacks_&&(this.flyout_button_callbacks_[t]=e)},e.prototype.get_button_callback=function(t){return this.flyout_button_callbacks_?this.flyout_button_callbacks_[t]:void 0},e.prototype.remove_button_callback=function(t){this.flyout_button_callbacks_&&(this.flyout_button_callbacks_[t]=void 0)},e.prototype.remove_toolbox_category_callback=function(t){this.toolbox_category_callbacks_&&(this.toolbox_category_callbacks_[t]=void 0)},e.prototype.clear_gesture=function(){this.current_gesture_=void 0},e.prototype.register_flyout_button=function(t,e){this.custom_flyout_buttons.set(t,e)},e.prototype.get_custom_flyout_button=function(t){return this.custom_flyout_buttons.get(t)},e.prototype.set_read_only=function(t){this.options.readOnly=t},e.prototype.set_hotkey_enable=function(t){this.is_hotkey_enable=t},e.prototype.get_hotkey_enable=function(){return this.is_hotkey_enable},e.prototype.show_external_comment_editor=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){return[2,window.prompt("Enter comment text",t)||""]})})},e.prototype.register_comment_editor=function(t){this.show_external_comment_editor=t},e.prototype.for_each_element_in_stack=function(t,e,o){void 0===o&&(o=!1);var i,r=this.Blink.mainWorkspace.get_element_from_db(t);null!=(i=null==r?void 0:r.get_top_parent())&&i.for_each_descendant_element(e,o)},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Msg)],e.prototype,"Msg",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],e.prototype,"utils",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.context_menu)],e.prototype,"context_menu",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.widget_div)],e.prototype,"widget_div",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.runtime_data)],e.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.theme)],e.prototype,"theme",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.workspace_db)],e.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.UIEvent)],e.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.CreateEvent)],e.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.WorkspaceComment)],e.prototype,"workspace_comment_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.BlockSvg)],e.prototype,"block_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Toolbox)],e.prototype,"toolbox_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.VerticalFlyout)],e.prototype,"flyout_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Gesture)],e.prototype,"gesture_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.ConnectionDB)],e.prototype,"connection_db_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.WorkspaceAudio)],e.prototype,"workspace_audio_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Grid)],e.prototype,"grid_factory",void 0),t=(0,i.__decorate)([(0,r.injectable)()],e)}()},6590(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FieldButton=void 0;var i=o(31635),r=o(71519),s=o(86295),a=o(25507),_=o(48264);e.FieldButton=function(t){function e(e){var o=t.call(this,e)||this;return o.field_type="FieldButton",o.image_width=o.width_,o.image_height=o.height_,o.has_circle=e.has_circle,o.click_handler_=e.opt_callback,o.has_circle&&(o.image_width=.6*o.width_,o.image_height=.6*o.height_),o}return(0,i.__extends)(e,t),e.prototype.update_height=function(){this.size_.height=this.height_},e.prototype.init=function(){var t=this;if(!this.field_group){if(this.field_group=(0,a.create_svg_element)("g",{class:"fieldButton",cursor:"default"},void 0),this.visible_||(this.field_group.style.display="none"),this.has_circle&&(this.circle_element=(0,a.create_svg_element)("rect",{width:this.width_,height:this.height_,rx:this.width_/2,ry:this.width_/2,stroke:"rgba(0, 0, 0, .15)",fill:"rgba(255, 255, 255, .15)"},this.field_group),this.events.bind_event_with_checks(this.field_group,"mousedown",this,function(){t.circle_element&&(t.circle_element.style.fill="rgba(0, 0, 0, .15)")})),"string"==typeof this.src_?(this.image_element=(0,a.create_svg_element)("image",{height:this.image_height+"px",width:this.image_width+"px"},this.field_group),this.set_value(this.src_)):(this.image_element=(0,a.create_svg_element)("g",{height:this.height_+"px",width:this.width_+"px"},this.field_group),this.image_element.appendChild(this.src_)),_.is.firefox()&&(this.rect_element=(0,a.create_svg_element)("rect",{height:this.height_+"px",width:this.width_+"px","fill-opacity":0},this.field_group)),void 0==this.source_block)throw ReferenceError("Field should have source block when init.");this.source_block.get_svg_root().appendChild(this.field_group),this.events.bind_event_with_checks(this.field_group,"mouseup",this,this.on_click),this.mouse_down_wrapper=this.events.bind_event_with_checks(this.field_group,"mousedown",this,this.on_mouse_down)}},e.prototype.on_click=function(t){if(this.source_block){this.circle_element&&(this.circle_element.style.fill="rgba(255, 255, 255, .15)");var e=this.source_block.get_workspace().get_gesture(t);e&&e.is_dragging_block?e.handle_up(t):!(this.source_block.is_in_flyout||this.utils.is_right_button(t))&&(e&&(e.update_is_mutation_click(!0),e.handle_up(t)),this.click_handler_&&this.click_handler_(this))}},e.prototype.get_img_scale=function(){return 1},e.prototype.layout=function(t,e){if(this.source_block&&(t[0]+=this.render_sep,!(0,s.is_nil)(this.image_element))){var o=this.get_img_scale(),i=Number(((1-o)*this.size_.width/2).toFixed(2)),r=this.source_block.previous_connection?4*i:3*i,a=1.5*i,_=(this.width_-this.image_width)/2,c=(this.height_-this.image_height)/2;this.circle_element&&this.circle_element.setAttribute("transform","scale("+o+") translate("+(t[0]+r)+", "+(t[1]+e/2-this.height_/2+a)+")"),this.image_element.setAttribute("transform","scale("+o+") translate("+(t[0]+r+_)+", "+(t[1]+e/2-this.height_/2+a+c)+")"),t[0]+=this.size_.width}},(0,i.__decorate)([(0,r.injectable)()],e)}(o(95994).FieldImage)},68301(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FieldIcon=void 0;var i=o(31635),r=o(71519),s=o(25507),a=o(48264),_=o(89221);e.FieldIcon=function(t){function e(e){var o=t.call(this,e)||this;return o.field_type="FieldIcon",o.width_=o.theme.renderer.HEAD_ICON_WIDTH,o.height_=o.theme.renderer.HEAD_ICON_WIDTH,o.size_=new _.Size(0,0),o.opt_is_head_=e.opt_is_head||!1,o.set_value(o.utils.replace_message_references(e.src)),o}return(0,i.__extends)(e,t),e.prototype.is_head=function(){return this.opt_is_head_},e.prototype.init=function(){if(!this.field_group){if(!1===this.opt_is_head_&&void 0!=this.source_block){if("*"===this.text_||""===this.text_)return;this.size_=new _.Size(this.width_,this.height_)}this.field_group=(0,s.create_svg_element)("g",{transform:"translate(-"+this.theme.renderer.HEAD_ICON_WRAP_WIDTH/2+", -"+(this.theme.renderer.HEAD_ICON_WRAP_WIDTH-this.theme.renderer.MIN_HEIGHT)+")"}),this.visible_||(this.field_group.style.display="none");var t=this.theme.renderer.HEAD_ICON_WRAP_WIDTH/2;if((0,s.create_svg_element)("circle",{cx:t,cy:t,r:t,fill:void 0!=this.source_block?this.source_block.get_colour():"",stroke:void 0!=this.source_block?this.source_block.get_border_colour():this.theme.block_color.DEFAULT.border,class:"blockly_head_icon_wrapper"},this.field_group),this.image_element=(0,s.create_svg_element)("image",{height:this.height_+"px",width:this.width_+"px",x:t-this.width_/2,y:t-this.height_/2,class:"blockly_head_icon"},this.field_group),this.set_value(this.src_),a.is.Gecko()&&(0,s.create_svg_element)("rect",{height:this.height_+"px",width:this.width_+"px","fill-opacity":0},this.field_group),void 0==this.source_block)throw ReferenceError("Field should have source block when init.");var e=this.source_block.get_svg_root();if(void 0==e)throw ReferenceError("Field should have svg root when init.");e.appendChild(this.field_group)}},e.prototype.layout=function(t){return t},(0,i.__decorate)([(0,r.injectable)()],e)}(o(95994).FieldImage)},63030(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FieldLabelSerializable=void 0;var i=o(31635),r=o(71519);e.FieldLabelSerializable=function(t){function e(e){var o=t.call(this,e)||this;return o.editable=!0,o.field_type="FieldLabelSerializable",o}return(0,i.__extends)(e,t),e.prototype.get_display_text=function(){var t=this.text_;return t.length>this.max_display_length&&(t=t.substring(0,this.max_display_length-2)+""),t.replace(/\s/g,"\xa0")},(0,i.__decorate)([(0,r.injectable)()],e)}(o(35322).FieldLabel)},4523(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FieldMultilineInput=void 0;var i=o(31635),r=o(71519),s=o(25507);e.FieldMultilineInput=function(t){function e(e){var o=t.call(this,e)||this;return o.padding_y=3,o.line_height=22,o.padding_x=0,o.field_type="FieldMultilineInput",o.max_length=e.max_length,o.max_width=e.max_width,o}return(0,i.__extends)(e,t),e.prototype.get_display_text=function(){return this.text_?this.text_:"\xa0"},e.prototype.render_=function(){var t,e,o=this;if(this.visible_&&this.text_element&&this.source_block){(0,s.remove_children)(this.text_element),this.text_element.setAttribute("text-anchor","start"),this.text_element.setAttribute("dominant-baseline","central");var i=this.get_display_text();this.utils.start_text_cache();var r=0,a=(0,s.create_svg_element)("tspan");this.text_element.appendChild(a);for(var _=0,c=Array.from(i),l=0;l<c.length;l++){a.textContent=c.slice(_,l+1).join("").replace(/\n/g,"").replace(/\s/g,"\xa0");var h=this.utils.get_cached_width(a);r=Math.max(r,h);var d=c[l],u=c[l+1],p=void 0!==this.max_width&&h>=this.max_width&&void 0!==c[l+1];("\n"===d||p)&&(a=(0,s.create_svg_element)("tspan"),this.text_element.appendChild(a),p&&"\n"===u&&l++,_=l+1)}this.utils.stop_text_cache(),this.padding_x=0,this.source_block.is_shadow()||(this.padding_x=r>=this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?this.theme.renderer.TEXT_PADDING_IN_FIELD:(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD+2*this.theme.renderer.TEXT_PADDING_IN_FIELD-r)/2);var f=this.padding_y;Array.from(this.text_element.children).forEach(function(t){t.setAttribute("x",""+o.padding_x),t.setAttribute("y",""+(f+o.line_height/2)),f+=o.line_height}),f+=this.padding_y,this.size_.height=f,this.size_.width=r+2*this.padding_x,null!=(t=this.border_rect)&&t.setAttribute("width",String(this.size_.width)),null!=(e=this.border_rect)&&e.setAttribute("height",String(this.size_.height))}else this.size_.width=0},e.prototype.widget_create=function(){if(!this.source_block)throw Error("[FieldMultilineInput] Trying to create widget before init on a block. ");return this.html_input=t.prototype.widget_create.call(this,"textarea","blocklyHtmlTextarea"),this.html_input.style.lineHeight=this.line_height+"px",this.html_input.style.paddingTop=this.source_block.is_shadow()&&this.source_block.height<=this.theme.renderer.MIN_HEIGHT_SHADOW?(this.source_block.height-this.line_height)/2+"px":this.padding_y+"px",this.source_block.is_shadow()?(this.html_input.style.paddingLeft="23px",this.html_input.style.paddingRight=23*.8+"px"):(this.html_input.style.paddingLeft=this.padding_x+"px",this.html_input.style.paddingRight=.8*this.padding_x+"px"),this.html_input},e.prototype.on_html_input_keydown=function(e){"Enter"!==e.key&&t.prototype.on_html_input_keydown.call(this,e)},e.prototype.on_html_input_change=function(){this.html_input&&this.source_block&&(!this.is_composition_inputting&&this.max_length&&this.html_input.value.length>this.max_length&&(this.html_input.value=this.html_input.value.substr(0,this.max_length)),t.prototype.on_html_input_change.call(this),this.html_input.style.paddingTop=this.source_block.is_shadow()&&this.source_block.height<=this.theme.renderer.MIN_HEIGHT_SHADOW?(this.source_block.height-this.line_height)/2+"px":this.padding_y+"px",this.source_block.is_shadow()||(this.html_input.style.paddingLeft=this.padding_x+"px",this.html_input.style.paddingRight=this.padding_x+"px"))},(0,i.__decorate)([(0,r.injectable)()],e)}(o(10575).FieldTextInput)},58956(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MutationRemoveButton=e.MutationAddButton=void 0;var i=o(31635),r=o(71519),s=o(25507),a=function(t){function e(e,o,i){void 0===i&&(i=20);var r=t.call(this,{src:"",width:i,height:i})||this;return r.is_add=e,r.index_=o,r.field_type="FieldMutation",r}return(0,i.__extends)(e,t),e.prototype.init=function(){var t,e=this;if(!this.field_group){this.field_group=(0,s.create_svg_element)("g",{},void 0),this.visible_||(this.field_group.style.display="none"),this.image_element=(0,s.create_svg_element)("g",{width:this.width_,height:this.height_,class:"fieldButton"},this.field_group),this.rect_element=(0,s.create_svg_element)("rect",{width:this.width_,height:this.height_,rx:this.width_/2,ry:this.width_/2,stroke:"rgba(0, 0, 0, .15)",fill:"rgba(255, 255, 255, .15)"},this.image_element),(0,s.create_svg_element)("line",{stroke:"#fff","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10,x1:this.width_/3,y1:this.height_/2,x2:2*this.width_/3,y2:this.height_/2},this.image_element),this.is_add&&(0,s.create_svg_element)("line",{stroke:"#fff","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10,x1:this.width_/2,y1:this.height_/3,x2:this.width_/2,y2:2*this.height_/3},this.image_element),this.events.bind_event_with_checks(this.field_group,"mousedown",this,function(){e.rect_element&&(e.rect_element.style.fill="rgba(0, 0, 0, .15)")});var o=null==(t=this.source_block)?void 0:t.get_svg_root();if(void 0==o)throw ReferenceError("Field should have svg root when init.");o.appendChild(this.field_group),this.events.bind_event_with_checks(this.field_group,"mouseup",this,this.on_click),this.mouse_down_wrapper=this.events.bind_event_with_checks(this.field_group,"mousedown",this,this.on_mouse_down)}},e.prototype.get_img_scale=function(){return 1},e.prototype.on_click=function(t){if(this.source_block){this.rect_element&&(this.rect_element.style.fill="rgba(255, 255, 255, .15)");var e,o,i=this.source_block.get_workspace().get_gesture(t);if(i&&i.is_dragging_block)i.handle_up(t);else if(!this.source_block.is_in_flyout&&!this.utils.is_right_button(t)){if(i&&(i.update_is_mutation_click(!0),i.handle_up(t)),!this.events.is_enabled())return;var r=this.events.get_group();this.events.set_group(r||!0);var s=this.source_block;this.is_add?null!=(e=s.addMutation)&&e.call(s,this.index_,this.name):null!=(o=s.removeMutation)&&o.call(s,this.index_,this.name),s.bump_neighbours(),this.events.set_group(r)}}},e.prototype.set_index=function(t){this.index_=t},e}(o(95994).FieldImage);e.MutationAddButton=function(t){function e(){return t.call(this,!0)||this}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,r.injectable)()],e)}(a),e.MutationRemoveButton=function(t){function e(e){return void 0===e&&(e=void 0),t.call(this,!1,e)||this}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,r.injectable)()],e)}(a)},47441(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FieldTextDropdown=void 0;var i=o(31635),r=o(71519),s=o(25507),a=o(10575),_=o(26821);e.FieldTextDropdown=function(t){function e(e){var o,i=t.call(this,{text:(null==(o=e()[0])?void 0:o.value)||""})||this;return i.get_options=e,i.field_type="FieldTextDropdown",i.menu_items=[],i.padding_x=10,i.text_margin=0,i}return(0,i.__extends)(e,t),e.prototype.render_=function(){var t,e;this.size_.width=0,this.visible_&&this.field_group&&this.source_block&&(this.size_.width=this.padding_x,this.update_height(),this.render_text_element(),this.render_arrow(),null!=(t=this.border_rect)&&t.setAttribute("width",String(this.size_.width)),null!=(e=this.border_rect)&&e.setAttribute("height",String(this.size_.height)))},e.prototype.render_text_element=function(){if(this.text_element&&this.field_group){(0,s.remove_children)(this.text_element),this.text_element.appendChild(document.createTextNode(this.get_display_text()));var t=this.utils.get_cached_width(this.text_element);this.text_margin=t<this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD-t)/2:0,this.size_.width+=this.text_margin,this.text_element.setAttribute("y",String(this.size_.height/2)),this.text_element.setAttribute("x",String(this.size_.width)),this.size_.width+=t+this.text_margin}},e.prototype.render_arrow=function(){var t=this;if(this.field_group&&this.source_block)if(this.arrow||(this.arrow=(0,_.draw_arrow)(this.source_block.workspace.options.dropdown.arrow_type),this.field_group.appendChild(this.arrow)),this.size_.width+=this.source_block.workspace.options.dropdown.padding,this.arrow.setAttribute("transform","translate("+this.size_.width+", "+(this.size_.height/2-7)+")"),this.size_.width+=12+this.source_block.workspace.options.dropdown.padding,this.source_block.is_shadow()){var e=function(){var e,o=null==(e=t.source_block)?void 0:e.get_parent();o&&t.arrow&&(t.arrow.style.fill=o.get_colour().toString())};this.events.is_record_undo()?e():window.setTimeout(e)}else this.arrow.style.fill=this.source_block.get_colour().toString()},e.prototype.widget_dispose=function(){var e=this;return function(){t.prototype.widget_dispose.call(e)(),e.menu&&(0,s.remove_node)(e.menu),e.menu_items=[],e.menu=void 0}},e.prototype.show_editor=function(){var e=t.prototype.show_editor.call(this);if(!this.source_block)return e;var o=this.source_block.workspace.get_scale();return e.style.paddingLeft=(this.padding_x+this.text_margin)*o+"px",e.style.textAlign="start",this.menu=this.create_dropdown_element(),e},e.prototype.create_dropdown_element=function(){var t=this;this.menu_items=[];var e=document.createElement("div");e.classList.add("menu-wrapper");for(var o=this.get_options(),i=this,r=0;r<o.length;r++)!function(r){var s=o[r],a=document.createElement("div");a.classList.add("menu-item"),a.dataset.value=s.value,a.innerText=s.value,a.setAttribute("tabindex","-1"),a.style.outline="none",s.value===i.get_value()&&a.classList.add("menu_item_selected"),e.appendChild(a),a.style.minWidth="172px",a.addEventListener("click",function(){t.set_html_input_value(s.value),t.widget_div.hide()}),i.menu_items.push(a)}(r);e.classList.add("blocklyDropdownMenu");var a=(0,s.create_dom)("div",{style:"position: fixed",class:"blocklyWidgetDiv"});a.appendChild(e),document.body.appendChild(a),a.style.display="block";var c=(0,_.position_dropdown)(e,this);return a.style.left=c[0]+"px",a.style.top=c[1]+"px",a},e.prototype.highlight_matched=function(){var t=this;if(this.menu)for(var e=this,o=0,i=this.menu_items.length;o<i;o++)!function(o,i){var r=e.menu_items[o];if(e.get_value()===r.dataset.value){r.classList.add("menu-item-hover");var s=r.getBoundingClientRect(),a=e.menu.getBoundingClientRect(),_=s.top<a.top,c=s.bottom>a.bottom;(_||c)&&requestAnimationFrame(function(){t.menu&&(r.scrollIntoView(_),t.menu.classList.contains("scroll-smooth")||t.menu.classList.add("scroll-smooth"))})}else r.classList.remove("menu-item-hover")}(o)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.menu&&(0,s.remove_node)(this.menu),this.widget_div.hide_if_owner(this)},e.prototype.on_html_input_change=function(){t.prototype.on_html_input_change.call(this),this.html_input.style.paddingLeft=(this.padding_x+this.text_margin)*this.workspace_.get_scale()+"px",this.highlight_matched()},(0,i.__decorate)([(0,r.injectable)()],e)}(a.FieldTextInput)},5130(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.FieldDefaultValue=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(25507);e.FieldDefaultValue=function(t){function e(e){var o=t.call(this,{text:e.enable_empty?e.default_value:e.default_value||"0",opt_validator:e.opt_validator})||this;return o.has_been_edited=!1,o.enable_empty=!1,o.field_type="FieldDefaultValue",void 0!==e.enable_empty&&(o.enable_empty=e.enable_empty),o}return(0,i.__extends)(e,t),e.prototype.get_has_been_edited=function(){return this.has_been_edited},e.prototype.set_has_been_edited=function(t){if(t!==this.has_been_edited){if(this.source_block&&this.events.is_enabled()){var e=this.events.get_group();this.events.set_group(e||!0),this.events.fire(this.change_event_factory("field_default_value",{block:this.source_block,old_value:this.has_been_edited,new_value:t,name:this.name}))}this.has_been_edited=t,this.rerender()}},e.prototype.rerender=function(){this.text_element&&(this.has_been_edited?(0,a.remove_class_if_necessary)(this.text_element,"blocklyTextDefault"):(0,a.add_class)(this.text_element,"blocklyTextDefault"))},e.prototype.on_html_input_change=function(){this.set_has_been_edited(!0),t.prototype.on_html_input_change.call(this)},e.prototype.get_validated_value=function(t,e){return this.enable_empty||t?t:e},e.prototype.widget_dispose=function(){var e=this;return function(){if(e.html_input){var o=e.get_validated_value(e.html_input.value,e.html_input.defaultValue);t.prototype.widget_dispose.call(e,o)()}}},e.prototype.init=function(){t.prototype.init.call(this),this.text_element&&!this.has_been_edited&&(0,a.add_class)(this.text_element,"blocklyTextDefault")},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.widget_div)],e.prototype,"widget_div",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(10575).FieldTextInput)},80591(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Input=void 0;var i=o(31635),r=o(71519),s=o(36963),a=o(86295);e.Input=function(){function t(t){this.field_width=0,this.field_height=0,this.margin_left=this.theme.renderer.SEP_SPACE_X,this.render_width=0,this.render_height=0,this.width=0,this.height=0,this.visible_=!0,this.setCheck=this.set_check,this.appendField=this.append_field,this.type=t.type,this.name=t.name,this.source_block=t.block,this.connection=t.connection,this.fieldRow=[]}return t.prototype.is_visible=function(){return this.visible_},t.prototype.init=function(){if(void 0!=this.source_block){var t=this.source_block.get_workspace();if(void 0!=t&&t.rendered)for(var e=0;e<this.fieldRow.length;e++)this.fieldRow[e].init()}else console.warn("Trying to init an input without its source block.")},t.prototype.dispose=function(){for(var t=0;t<this.fieldRow.length;t++)this.fieldRow[t].dispose();this.connection&&this.connection.dispose(),delete this.source_block},t.prototype.set_visible=function(t){var e=[];if(this.visible_==t)return e;this.visible_=t;for(var o=0;o<this.fieldRow.length;o++){var i=this.fieldRow[o];i.opt_is_head_||i.set_visible(t)}if(this.connection){t?e=this.connection.unhide_all():this.connection.hide_all();var r=this.connection.targetBlock();r&&r.set_visible_as_child(t)}return e},t.prototype.set_check=function(t){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.set_check(t),this},t.prototype.append_field=function(t,e){return this.insert_field_at(this.fieldRow.length,t,e),this},t.prototype.insert_field_at=function(t,e,o){if(t<0||t>this.fieldRow.length)throw Error("index "+t+" out of bounds.");return e||o?((0,a.is_string)(e)&&(e=this.field_label_factory({text:this.utils.replace_message_references(e)})),e.source_block=this.source_block,void 0!=o&&(e.name=o),void 0!=this.source_block&&this.source_block.rendered&&e.init(),(0,a.is_field_dropdown)(e)&&e.prefix_field&&(t=this.insert_field_at(t,e.prefix_field)),this.fieldRow.splice(t,0,e),++t,(0,a.is_field_dropdown)(e)&&e.suffix_field&&(t=this.insert_field_at(t,e.suffix_field)),void 0!=this.source_block&&this.source_block.rendered&&this.source_block.render(),t):0},t.prototype.remove_field=function(t){for(var e,o,i=0,r=this.fieldRow.length;i<r;i++){var s=this.fieldRow[i];if(s.name===t)return s.dispose(),this.fieldRow.splice(i,1),(null==(e=this.source_block)?void 0:e.rendered)&&null!=(o=this.source_block)&&o.render(),!0}return!1},t.prototype.get_field=function(t){for(var e=0,o=this.fieldRow.length;e<o;e++){var i=this.fieldRow[e];if(i.name===t)return i}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FieldLabel)],t.prototype,"field_label_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},98683(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockRenderer=void 0;var i=o(31635),r=o(35009),s=o(36963),a=o(25507);e.BlockRenderer=function(){function t(t){this.edge_width=this.theme.renderer.BLOCK_EDGE_WIDTH,this.padding_l=this.theme.renderer.ROW_PADDING,this.padding_r=this.theme.renderer.ROW_PADDING,this.min_height=this.theme.renderer.MIN_HEIGHT,this.CORNER_LEFT_TOP="a "+this.theme.renderer.CORNER_RADIUS+" "+this.theme.renderer.CORNER_RADIUS+" 0 0 1 "+this.theme.renderer.CORNER_RADIUS+" -"+this.theme.renderer.CORNER_RADIUS,this.CORNER_LEFT_BOTTOM="a "+this.theme.renderer.CORNER_RADIUS+" "+this.theme.renderer.CORNER_RADIUS+" 0 0 1 -"+this.theme.renderer.CORNER_RADIUS+" -"+this.theme.renderer.CORNER_RADIUS,t.is_render_notch()&&(this.padding_l=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER+this.theme.renderer.NOTCH_WIDTH,this.padding_r=this.theme.renderer.ROW_PADDING+8)}return t.prototype.min_width=function(t){return(t&&t.is_render_notch()||t)&&this.theme.renderer.MIN_WIDTH},t.prototype.render_path_start=function(t,e){t.push("m 0,"+this.theme.renderer.CORNER_RADIUS),t.push(this.CORNER_LEFT_TOP),e.is_render_notch()&&void 0!=e.previous_connection&&this.render_path_notch_top(t)},t.prototype.render_path_notch_top=function(t){t.push("H",""+this.theme.renderer.NTOCH_START_PADDING),t.push(this.theme.renderer.NOTCH_PATH_LEFT)},t.prototype.render_path_notch_bottom=function(t){t.push("H",""+(this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER)),t.push(this.theme.renderer.NOTCH_PATH_RIGHT)},t.prototype.render_edge_shape_right=function(t,e,o,i,r){void 0===o&&(o=!0);var s=r?Math.min(r/2,this.edge_width):this.edge_width,a=e.height;t.push("a "+s+" "+s+" 0 0 1 "+s+" "+s),0==o?t.push("V "+(a-this.min_height/2)):(i[1]>2*s&&!r&&t.push("v "+(i[1]-2*s)),r&&t.push("v "+(r-2*s))),t.push("a "+s+" "+s+" 0 0 1 -"+s+" "+s)},t.prototype.render_edge_shape_collapsed_right=function(t,e){var o=e.height;t.push(this.theme.renderer.COLLAPSED_PATH),t.push("v "+(o-this.min_height+e.height/2))},t.prototype.render_edge_shape_group_right=function(t,e){var o=e.height-5.5-3.5;t.push("h "+this.theme.renderer.GROUP_RIGHT_EDGE_WIDTH+"\n      "+this.theme.renderer.GROUP_TOP_RIGHT_PATH+"\n      l -8.6 "+o+"\n      "+this.theme.renderer.GROUP_BOTTOM_RIGHT_PATH)},t.prototype.render_path_end=function(t,e){var o=e.is_render_notch()?this.theme.renderer.CORNER_RADIUS:this.theme.renderer.CORNER_RADIUS_END_BLOCK_WITHOUD_NOTCH;e.is_ending_block()?(t.push("H",o.toString()),t.push("a",o+","+o+" 0 0,1 -"+o+",-"+o)):(t.push("H "+this.theme.renderer.CORNER_RADIUS),t.push(this.CORNER_LEFT_BOTTOM))},t.prototype.get_decoration_path=function(t,e,o,i,r){var s=i-28*t;return(0,a.create_svg_element)("path",{d:"\n        m "+(this.theme.renderer.STATEMENT_MIN_WIDTH+4*t)+" "+((r?12:8)+8*t)+",\n        h "+s+",\n        v 20, a 20 20 0 0 1 -20 20,\n        h -"+(s-22)+",\n        a 2 2 0 0 1 -2 -2, z",fill:e.toString(),stroke:o.toString(),class:"decoration_for_collapsed_blocks"})},t.prototype.render_group_decoration_blocks=function(t){if(!t.svg_path)return 0;t.decoration_block_paths.forEach(a.remove_node),t.decoration_block_paths.length=0;var e=t.origin_block,o=e.get_full_next_block(),i=Math.min(this.theme.renderer.EXECUTION_GROUP_DECORATION_WIDTH,t.width-this.theme.renderer.STATEMENT_MIN_WIDTH-this.theme.renderer.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN);if(o){var r=this.get_decoration_path(1,o.get_original_colour(),o.get_border_colour(),i,!1);t.decoration_block_paths.unshift(r),t.svg_group.insertBefore(r,t.svg_path)}var s=this.get_decoration_path(0,e.get_original_colour(),e.get_border_colour(),i,!o);return t.decoration_block_paths.unshift(s),t.svg_group.insertBefore(s,t.svg_path),0},t.prototype.render_group_bottom=function(t){t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_TOP),t.push("v "+(this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT-2*this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM),t.push(this.theme.renderer.GROUP_EXTRA_ROW_RIGHT)},t.prototype.get_field_padding_y=function(){return this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_FIELD},t.prototype.get_block_padding_y=function(t){return t!==r.InputType.VALUE?this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_STATEMENT_BLOCK:this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_VALUE_BLOCK},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),t}()},52742(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.OutputBlockRenderer=void 0;var i=o(31635),r=o(35009),s=o(25507);e.OutputBlockRenderer=function(t){function e(e){var o=t.call(this,e)||this;return o.padding_l=o.theme.renderer.ROW_PADDING_OUTPUT,o.padding_r=o.theme.renderer.ROW_PADDING_OUTPUT,o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT,o.min_height=o.theme.renderer.MIN_HEIGHT_OUTPUT,e.get_output_shape()===r.OutputShape.HEXAGONAL&&(o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT_HEXAGONAL),o}return(0,i.__extends)(e,t),e.prototype.min_width=function(t){return t&&this.theme.renderer.MIN_WIDTH_OUTPUT},e.prototype.render_path_start=function(t,e){e&&t.push("m "+this.edge_width+",0")},e.prototype.render_edge_shape_right=function(t,e){if(e.get_output_shape()===r.OutputShape.HEXAGONAL)t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+", "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          "+this.theme.renderer.CORNER_OFFSET_X+", "+this.theme.renderer.CORNER_OFFSET_Y),t.push("l "+this.edge_width+" "+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+", "+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+" 0 0,1 \n          0, "+this.theme.renderer.CENTER_CORNER_OFFSET),t.push("l -"+this.edge_width+" "+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+","+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          -"+this.theme.renderer.CORNER_OFFSET_X+", "+this.theme.renderer.CORNER_OFFSET_Y);else{t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 "+this.edge_width+" "+this.edge_width);var o=e.height-2*this.edge_width;o>0&&t.push("v "+o),t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 -"+this.edge_width+" "+this.edge_width)}},e.prototype.render_path_end=function(t,e){if(e.get_output_shape()===r.OutputShape.HEXAGONAL)t.push("H "+this.edge_width),t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+","+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          -"+this.theme.renderer.CORNER_OFFSET_X+", -"+this.theme.renderer.CORNER_OFFSET_Y),t.push("l -"+this.edge_width+" -"+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+","+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+" 0 0,1 \n            0, -"+this.theme.renderer.CENTER_CORNER_OFFSET),t.push("l "+this.edge_width+" -"+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+","+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          "+this.theme.renderer.CORNER_OFFSET_X+", -"+this.theme.renderer.CORNER_OFFSET_Y);else{t.push("H "+this.edge_width),t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 -"+this.edge_width+" -"+this.edge_width);var o=e.height-2*this.edge_width;o>0&&t.push("v -"+o),t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 "+this.edge_width+" -"+this.edge_width)}},e.prototype.render_edge_shape_collapsed_right=function(t,e){var o=e.height;t.push(this.theme.renderer.COLLAPSED_PATH),t.push("v "+(o-this.min_height+e.height/2-this.theme.renderer.CORNER_OFFSET_X))},e.prototype.get_layered_value_descendants=function(t,e){var o;if(void 0===e&&(e=!0),!t.output_connection)return[];for(var i=[],s=0;s<t.inputList.length;s++){var a=t.inputList[s];if(a.type===r.InputType.VALUE){var _=null==(o=a.connection)?void 0:o.targetBlock();if(!(!_||e&&_.is_shadow()))for(var c=this.get_layered_value_descendants(_,e),l=0;l<c.length;l++)i[l]=i[l]||[],i[l]=i[l].concat(c[l])}}return i.unshift([t]),i},e.prototype.select_output_group_children=function(t){for(var e,o,i=t.origin_block,r=this.get_layered_value_descendants(i,!0),s=[],a=1;a<r.length;a++)s=s.concat(r[a]);var _=function(t){return t.get_original_colour()===i.get_original_colour()};for(a=0;a<s.length;a++){var c=s[a];if(e)if(o){if(!_(e)&&!_(o))break;_(o)||(e=o),o=c}else o=c;else e=c}return[e,o]},e.prototype.render_decoration_block=function(t,e,o,i,a){return a===r.OutputShape.HEXAGONAL?(0,s.create_svg_element)("path",{d:"\n            m "+(e+t*this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET-5)+" 6,\n            h "+(o+10)+",\n            a 3,3 0 0,1 2,1\n            l "+this.edge_width+" "+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+",\n            a 2,2 0 0,1 0,2\n            l -"+this.edge_width+" "+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+"\n            a 3,3 0 0,1 -2,1\n            h -"+(o+10)+",\n            a 3,3 0 0,1 -2,-1\n            l -"+this.edge_width+" -"+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+"\n            a 2,2 0 0,1 0,-2\n            l "+this.edge_width+" -"+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+"\n            a 3,3 0 0,1 2,-1\n          ",fill:i.get_original_colour(),stroke:i.get_border_colour(),class:"decoration_for_collapsed_blocks"}):(0,s.create_svg_element)("path",{d:"\n            m "+(e+t*this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET)+" 6,\n            h "+o+",\n            a "+this.edge_width+" "+this.edge_width+" 0 0 1 0 "+2*this.edge_width+",\n            h -"+o+",\n            a "+this.edge_width+" "+this.edge_width+" 0 0 1 0 -"+2*this.edge_width,fill:i.get_original_colour(),stroke:i.get_border_colour(),class:"decoration_for_collapsed_blocks"})},e.prototype.render_group_decoration_blocks=function(t){t.decoration_block_paths.forEach(s.remove_node),t.decoration_block_paths.length=0;var e=this.select_output_group_children(t),o=e[0],i=e[1],a=0,_=t.get_field(r.BLOCK_GROUP_TAG_FIELD_NAME),c=this.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT+this.theme.renderer.SEP_SPACE_X+_.get_size().width+this.theme.renderer.SEP_SPACE_X+this.theme.renderer.OUTPUT_GROUP_DECORATION_PADDING,l=t.get_field(r.BLOCK_GROUP_NAME_FIELD_NAME).get_size().width,h=t.origin_block.get_output_shape()||r.OutputShape.ROUND,d=this.render_decoration_block(0,c,l,t.origin_block,h);if(i){var u=this.render_decoration_block(2,c,l,i,h);t.decoration_block_paths.unshift(u),t.svg_group.insertBefore(u,t.svg_group.lastChild),a+=this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET}if(o){var p=this.render_decoration_block(1,c,l,o,h);t.decoration_block_paths.unshift(p),t.svg_group.insertBefore(p,t.svg_group.lastChild),a+=this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET}return t.decoration_block_paths.unshift(d),t.svg_group.insertBefore(d,t.svg_group.lastChild),a+this.theme.renderer.OUTPUT_GROUP_DECORATION_PADDING},e.prototype.get_field_padding_y=function(){return this.theme.renderer.OUTPUT_ROW_PADDING_Y_TO_FIELD},e.prototype.get_block_padding_y=function(){return this.theme.renderer.OUTPUT_ROW_PADDING_Y_TO_VALUE_BLOCK},e}(o(98683).BlockRenderer)},73364(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HeadBlockRenderer=void 0;var i=o(31635),r=o(25507);e.HeadBlockRenderer=function(t){function e(e){var o=t.call(this,e)||this;return o.padding_l=o.theme.renderer.ROW_PADDING_HEAD,e.is_render_notch()&&(o.padding_l=o.theme.renderer.NTOCH_START_PADDING+o.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER+o.theme.renderer.NOTCH_WIDTH-o.theme.renderer.SEP_SPACE_X),o}return(0,i.__extends)(e,t),e.prototype.get_decoration_path=function(t,e,o,i){var s=i-28*t;return(0,r.create_svg_element)("path",{d:"\n        m "+4*t+" "+(8+8*t)+",\n        h "+s+",\n        v 20, a 20 20 0 0 1 -20 20,\n        h -"+(s-22)+",\n        a 2 2 0 0 1 -2 -2, z",fill:e.toString(),stroke:o.toString(),class:"decoration_for_collapsed_blocks"})},e.prototype.render_group_decoration_blocks=function(t){t.decoration_block_paths.forEach(r.remove_node),t.decoration_block_paths.length=0;var e=Math.min(this.theme.renderer.EXECUTION_GROUP_DECORATION_WIDTH,t.width-this.theme.renderer.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN),o=t.origin_block.get_full_next_block();if(o){var i=o.get_full_next_block();if(i){var s=this.get_decoration_path(1,i.get_original_colour(),i.get_border_colour(),e);t.decoration_block_paths.unshift(s),t.svg_group.insertBefore(s,t.svg_path)}var a=this.get_decoration_path(0,o.get_original_colour(),o.get_border_colour(),e);t.decoration_block_paths.unshift(a),t.svg_group.insertBefore(a,t.svg_path)}return 0},e}(o(98683).BlockRenderer)},14296(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ShadowBlockRenderer=void 0;var i=o(31635),r=o(35009),s=o(86295);e.ShadowBlockRenderer=function(t){function e(e){var o=t.call(this,e)||this;if("param"===e.element_type||"param_color"===e.element_type)return o;switch(o.padding_l=o.theme.renderer.ROW_PADDING_SHADOW,o.padding_r=o.theme.renderer.ROW_PADDING_SHADOW,o.min_height=o.theme.renderer.MIN_HEIGHT_SHADOW,e.get_output_shape()){case r.OutputShape.HEXAGONAL:o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW_HEXAGONAL;break;case r.OutputShape.ROUND:o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW_ROUND;break;default:o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW}return 1!==e.inputList.length||1!==e.inputList[0].fieldRow.length||(0,s.is_field_number)(e.inputList[0].fieldRow[0])||(0,s.is_field_text_input)(e.inputList[0].fieldRow[0])||(0,s.is_field_default_value)(e.inputList[0].fieldRow[0])||(o.padding_l=o.theme.renderer.ROW_PADDING_OUTPUT_NON_TEXT,o.padding_r=o.theme.renderer.ROW_PADDING_OUTPUT_NON_TEXT),o}return(0,i.__extends)(e,t),e.prototype.min_width=function(e){return"param"===e.element_type||"param_color"===e.element_type?t.prototype.min_width.call(this,e):e.get_output_shape()===r.OutputShape.HEXAGONAL?this.theme.renderer.MIN_WIDTH_SHADOW_HEXAGONAL-(this.theme.renderer.CORNER_OFFSET_X+this.theme.renderer.CORNER_OFFSET_X+.54):this.theme.renderer.MIN_WIDTH_SHADOW},e.prototype.get_field_padding_y=function(){return this.theme.renderer.SHADOW_ROW_PADDING_Y_TO_FIELD},e.prototype.get_block_padding_y=function(){return 0},e}(o(52742).OutputBlockRenderer)},55487(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.block_render_svg=void 0;var i=o(31635),r=o(77276),s=o(35009),a=o(78194),_=o(86295),c=o(73364),l=o(14296),h=o(52742),d=o(98683);e.block_render_svg=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fixed_size_rule=[function(t,o){e.is_starting_block()||e.is_collapsed()||t!==e.inputList.length-1||!e.inputList[t-1]||e.inputList[t-1].type!==s.InputType.STATEMENT||(e.inputList[t].height=26,e.inputList[t].width=e.theme.renderer.INPUT_EXTRA_ROW_WIDTH,o.padding_l=52,o.padding_r=16)},function(t,o){(0,_.is_block_group)(e)&&e.group_type===s.BlockGroupType.OUTPUT&&(e.inputList[t].height=48,o.height=48)},function(t){e.is_starting_block()&&e.inputList[t].type===s.InputType.STATEMENT&&(e.inputList[t].render_height=0,e.inputList[t].height=0)}],e}return(0,i.__extends)(e,t),e.prototype.get_block_renderer=function(){return this.is_starting_block()?new c.HeadBlockRenderer(this):void 0!=this.output_connection?this.is_shadow()&&"param_color"!==this.element_type?new l.ShadowBlockRenderer(this):new h.OutputBlockRenderer(this):new d.BlockRenderer(this)},e.prototype.render=function(t){this.width=0,this.svg_path_width=0,this.block_renderer=this.get_block_renderer(),this.utils.start_text_cache(),this.rendered=!0;var e=0;this.warning&&(e=this.warning.render_icon(e,this.block_renderer));var o=this._render_compute(e);if(this.render_draw_(o),this.render_move_connections_(),this.comment&&this.comment.reposition(),!1!==t){var i=this.get_parent();i?i.render(!0):this.workspace.resize_contents()}this.utils.stop_text_cache(),this.update_chunk_visibility()},e.prototype.render_fields_=function(t,e,o){for(var i=0;i<t.length;++i)t[i].layout(e,o);return e},e.prototype.create_row_for_input_=function(t,e){return Object.assign([],{type:t.type!==s.InputType.STATEMENT?s.InputRowType.INLINE:s.InputRowType.STATEMENT,padding_l:t.type===s.InputType.STATEMENT&&this.is_starting_block()?e:this.block_renderer.padding_l+e,padding_r:this.block_renderer.padding_r,height:0})},e.prototype.compute_input_height_=function(t){return t.type===s.InputType.STATEMENT?this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT:this.block_renderer.min_height},e.prototype.compute_input_width_=function(t){var e;if(!this.is_output_block())return 0;switch(null==(e=t.connection)?void 0:e.get_output_shape()){case s.OutputShape.ROUND:return this.theme.renderer.INPUT_SHAPE_ROUND_WIDTH;case s.OutputShape.HEXAGONAL:return this.theme.renderer.INPUT_SHAPE_HEXAGONAL_WIDTH;default:return 0}},e.prototype._render_compute=function(t){for(var e,o=this.inputList,i=Object.assign([],{type:s.InputRowType.INLINE,right_edge:0,statement_width:0,height:0}),r=this.get_inputs_inline()&&!this.is_collapsed(),a=function(a){var c,l=o[a];if(!l.is_visible())return"continue";r&&void 0!=e&&e!==s.InputType.STATEMENT&&l.type!==s.InputType.STATEMENT?c=i[i.length-1]:(c=_.create_row_for_input_(l,void 0==e?t:0),e=l.type,i.push(c)),c.push(l),l.field_width=0,l.field_height=0;for(var h=0;h<l.fieldRow.length;h++){var d=l.fieldRow[h],u=d.get_size();d.render_sep=c.length>1||h>0||_.is_starting_block()?d.margin_left:0,l.field_width+=d.render_sep+u.width,l.field_height=Math.max(l.field_height,u.height)}if(l.render_width=0,l.render_height=0,l.connection){var p=l.connection.targetBlock();if(p){var f=p.get_height_width();p.is_shadow()&&"param_color"!==p.element_type?l.field_height=Math.max(l.field_height,f.height):l.render_height=Math.max(l.render_height,f.height),l.render_width=Math.max(l.render_width,f.width)}}l.height=Math.max(_.compute_input_height_(c),l.field_height+2*_.block_renderer.get_field_padding_y(),l.render_height+2*_.block_renderer.get_block_padding_y(l.type)),l.width=Math.max(_.compute_input_width_(l),l.field_width+l.render_width),_.fixed_size_rule.forEach(function(t){return t(a,c)}),c.height=Math.max(c.height,l.height)},_=this,c=0;c<o.length;c++)a(c);return i.forEach(function(t){t.forEach(function(e){e.height=t.height})}),i.right_edge=Math.max(i.right_edge,this.block_renderer.min_width(this)-this.block_renderer.padding_r),i},e.prototype.render_draw_=function(t){var e=[];this.render_draw_top_(e);var o=this.render_draw_right_(e,t);this.render_draw_bottom_(e,o),this.render_draw_left_(e);var i=e.join(" ");this.svg_path&&(this.svg_path.setAttribute("d",i),this.RTL&&this.svg_path.setAttribute("transform","scale(-1 1)"))},e.prototype.render_move_connections_=function(){var t=this.get_relative_to_surface_xy();void 0!=this.previous_connection&&this.previous_connection.move_to_offset(t),void 0!=this.output_connection&&this.output_connection.move_to_offset(t);for(var e=0;e<this.inputList.length;++e){var o=this.inputList[e].connection;o&&(o.move_to_offset(t),o.is_connected()&&o.tighten())}this.next_connection&&(this.next_connection.move_to_offset(t),this.next_connection.is_connected()&&this.next_connection.tighten())},e.prototype.render_draw_top_=function(t){if(this.block_renderer.render_path_start(t,this),void 0!=this.previous_connection){var e=0;this.is_render_notch()&&(e=this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NTOCH_START_PADDING),this.previous_connection.set_offset_in_block(e,0)}},e.prototype.render_draw_right_=function(t,e){for(var o=r.vec2.create(),i=0,c=0,l=0,h=e.length;l<h;l++){var d=e[l],u=e[l-1];o[0]=d.padding_l,d.type==s.InputRowType.INLINE?u&&u.type==s.InputRowType.STATEMENT&&l!==h-1?this.render_row_inline_(t,o,l,e,this.block_renderer.edge_width,Math.max(this.theme.renderer.MIN_WIDTH-i,i)):this.render_row_inline_(t,o,l,e,this.block_renderer.edge_width):d.type==s.InputRowType.STATEMENT&&((void 0==u||this.is_starting_block())&&0!=this.inputs_inline||this.block_renderer.render_edge_shape_right(t,this,!0,o,c),this.render_row_statement(t,o,d,l,e)),o[1]+=d.height,i=o[0],c=d.height}if(0===e.length&&(o[0]=e.right_edge,t.push("H",""+o[0]),this.block_renderer.render_edge_shape_right(t,this,this.inputs_inline,o,c),this.width=Math.max(this.width,o[0]+this.block_renderer.padding_r),this.svg_path_width=Math.max(this.width,o[0]+this.block_renderer.padding_r),o[1]=this.block_renderer.min_height),this.height=o[1],e[e.length-1]&&e[e.length-1][0].name===a.COLLAPSED_INPUT_NAME)return this.block_renderer.render_edge_shape_collapsed_right(t,this),o;if((0,_.is_block_group)(this)){var p=this.block_renderer.render_group_decoration_blocks(this);return t.push("h "+p),o[0]+=p,this.block_renderer.render_edge_shape_group_right(t,this),this.width+=p+this.theme.renderer.GROUP_RIGHT_EXTENDED_WIDTH,this.group_type===s.BlockGroupType.EXECUTION&&(this.height+=this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT),o}return(e[e.length-1]&&e[e.length-1].type!==s.InputType.STATEMENT||this.is_starting_block())&&this.block_renderer.render_edge_shape_right(t,this,this.inputs_inline,o,c),o},e.prototype.render_row_inline_=function(t,e,o,i,r,a){for(var _=i[o],c=0;c<_.length;c++){var l=_[c];if(e=this.render_fields_(l.fieldRow,e,_.height||0),l.type==s.InputType.VALUE){e[0]+=0===l.fieldRow.length&&0===c?0:l.margin_left;var h=l.connection,d=h.targetBlock();l.connection&&l.connection.get_targe_connection()&&void 0!=d&&h.set_offset_in_block(e[0],e[1]+(_.height-d.height)/2),e[0]+=l.render_width}a&&(e[0]=Math.max(e[0],a))}var u=i.right_edge,p=i[o-1];void 0!=p&&p.type===s.InputType.STATEMENT&&(u=this.theme.renderer.STATEMENT_OTHER_ROW_MIN_WIDTH-this.theme.renderer.BLOCK_EDGE_WIDTH),i.right_edge=Math.max(e[0],u),e[0]=Math.max(e[0],i.right_edge),0===o&&(this.first_row_width=e[0]+_.padding_r,this.first_row_height=_.height),this.width=Math.max(this.width,e[0]+_.padding_r),this.svg_path_width=Math.max(this.width,e[0]+_.padding_r);var f=Math.min(_.height/2,r);t.push("H",""+(e[0]+_.padding_r-f))},e.prototype.draw_statement_input_=function(t,e,o){this.is_render_notch()&&(t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER)),t.push(this.theme.renderer.NOTCH_PATH_RIGHT)),1==o.length&&0==o[0].fieldRow.length?t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)):t.push("H "+(e+this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_TOP+" v "+(o.height-2*this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)+" "+this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM),this.is_render_notch()&&(t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.NTOCH_START_PADDING)),t.push(this.theme.renderer.NOTCH_PATH_LEFT))},e.prototype.render_row_statement=function(t,e,o,i,r){var _=o[0];this.render_fields_(_.fieldRow,e,o.height||0),this.is_starting_block()&&0!=this.inputs_inline||(this.draw_statement_input_(t,e[0],o),(1!=o.length||0!=o[0].fieldRow.length)&&(e[0]+=this.theme.renderer.STATEMENT_MIN_WIDTH));var c=e[0];if(this.is_render_notch()&&(this.is_starting_block()?a.SPECIAL_CONNECTION_INPUT_NAME.includes(_.name)&&(c=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH):c=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.STATEMENT_MIN_WIDTH),!_.connection)throw Error("Statement connection should be renderable.");if(_.connection.set_offset_in_block(c,e[1]),i==r.length-1||r[i+1].type==s.InputType.STATEMENT){if(this.is_starting_block())return;var l=this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT/2,h=Math.max(this.theme.renderer.INPUT_EXTRA_ROW_WIDTH-l,e[0]+this.theme.renderer.ROW_PADDING);t.push("H "+h),t.push("a "+l+" "+l+" 0,0,1 0, "+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT),e[1]+=this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT}},e.prototype.render_draw_bottom_=function(t,e){if(!a.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)||!this.is_collapsed()){(0,_.is_block_group)(this)&&this.group_type===s.BlockGroupType.EXECUTION&&(this.block_renderer.render_group_bottom(t),e[0]=this.theme.renderer.STATEMENT_MIN_WIDTH,e[1]+=this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT);var o=this.next_connection||this.is_include_special_input()&&!this.is_collapsed(),i=0;this.is_render_notch()&&o&&(this.block_renderer.render_path_notch_bottom(t),i=this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NTOCH_START_PADDING),this.next_connection&&this.next_connection.set_offset_in_block(i,e[1])}},e.prototype.render_draw_left_=function(t){void 0!=this.output_connection&&this.output_connection.set_offset_in_block(0,0),this.block_renderer.render_path_end(t,this),t.push("z")},e}},99356(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BlockGroup=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(35009),_=o(99469),c=o(86295),l=o(44015);e.BlockGroup=function(t){function e(e){var o=t.call(this,{workspace:e.workspace,id:e.id})||this;return o.element_type="block_group",o.group_type=0,o.nested_blocks_with_comment=[],o.decoration_block_paths=[],o.show_name_editor=function(t,e){return(0,i.__awaiter)(o,void 0,void 0,function(){var o,r,s;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(o=null==(s=this.workspace.options.block_group)?void 0:s.show_name_editor)?[4,o(t.get_text())]:(e.call(t),[2]);case 1:return void 0!=(r=i.sent())&&t.set_value(r),[2]}})})},o.init=function(){o.events.disable();var t,e,i,r,s=o.origin_xy||o.origin_block.get_relative_to_surface_xy();o.move_by(s),o.set_chunk_visibility(o.origin_block.get_visibility());try{if(o.origin_block.is_starting_block())return o.group_type=a.BlockGroupType.START,void o.init_start_group();if(o.origin_block.output_connection)return o.group_type=a.BlockGroupType.OUTPUT,void o.init_output_group();o.group_type=a.BlockGroupType.EXECUTION,o.init_execution_group()}finally{if(o.origin_block.get_svg_root().style.display="none",o.origin_block.get_descendants(!1,!0).forEach(function(t){return t.set_comment_visible(!1)}),"simplified"===o.workspace.get_options().comment_type){if((0,l.get_nested_blocks_with_comment)(o.origin_block).forEach(function(t){var e;(0,c.is_block_group)(t)?(e=o.nested_blocks_with_comment).push.apply(e,t.nested_blocks_with_comment):o.nested_blocks_with_comment.push(t)}),o.nested_blocks_with_comment.length){var _=null==(t=o.nested_blocks_with_comment[0].comment)?void 0:t.get_text();o.set_comment_text(_),null!=(e=o.comment)&&e.init_svg(!0)}}else o.set_comment_text(null==(i=o.origin_block.comment)?void 0:i.get_text()),null!=(r=o.comment)&&r.init_svg(!0);o.origin_block.set_connectable(!1),o.events.enable()}},o.origin_block=e.origin_block,o.group_name=e.group_name,o.on_release=e.on_release,o.origin_block_display=o.origin_block.get_svg_root().style.display,o.origin_xy=e.origin_xy,o.group_stop_at=e.group_stop_at,o.init(),o}return(0,i.__extends)(e,t),e.prototype.init_start_group=function(){this.set_colour(this.theme.block_group_color.START_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.START_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t=this.origin_block.inputList[0].fieldRow[0],e=this.field_icon_factory({src:t.src_||"",opt_is_head:!0}),o=this.field_text_input_factory({text:this.group_name});o.show_editor=this.show_name_editor.bind(this,o,o.show_editor),this.append_dummy_input("START_GROUP").append_field(e).append_field(this.Msg.START_GROUP_TAG,a.BLOCK_GROUP_TAG_FIELD_NAME).append_field(o,a.BLOCK_GROUP_NAME_FIELD_NAME),this.set_previous_statement(!1),this.set_next_statement(!1)},e.prototype.init_output_group=function(){this.set_colour(this.theme.block_group_color.OUTPUT_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.OUTPUT_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t,e=this.field_text_input_factory({text:this.group_name});e.margin_left=this.theme.renderer.SEP_SPACE_X+this.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT,e.show_editor=this.show_name_editor.bind(this,e,e.show_editor),this.append_dummy_input("OUTPUT_GROUP").append_field(this.Msg.OUTPUT_GROUP_TAG,a.BLOCK_GROUP_TAG_FIELD_NAME).append_field(e,a.BLOCK_GROUP_NAME_FIELD_NAME),(0,_.assert)(this.origin_block.output_connection),this.set_output(!0,null==(t=this.origin_block.output_connection)?void 0:t.check_),(0,_.assert)(this.output_connection);var o=this.origin_block.output_connection.target_connection;null!=o&&o.connect(this.output_connection)},e.prototype.init_execution_group=function(){this.set_colour(this.theme.block_group_color.EXECUTION_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.EXECUTION_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t=this.field_text_input_factory({text:this.group_name});t.show_editor=this.show_name_editor.bind(this,t,t.show_editor),this.append_dummy_input("EXECUTION_GROUP").append_field(this.Msg.EXECUTION_GROUP_TAG,a.BLOCK_GROUP_TAG_FIELD_NAME).append_field(t,a.BLOCK_GROUP_NAME_FIELD_NAME),(0,_.assert)(this.origin_block.previous_connection),this.set_previous_statement(!0),(0,_.assert)(this.previous_connection);var e=this.origin_block.previous_connection.target_connection,o=void 0;if(this.group_stop_at){this.set_next_statement(!0);var i=this.workspace.get_block_by_id(this.group_stop_at);o=i&&i.previous_connection,(0,_.assert)(o),o.disconnect(),this.next_connection.connect(o)}else this.origin_block.last_connection_in_stack()&&this.set_next_statement(!0);null!=e&&e.disconnect(),null!=e&&e.connect(this.previous_connection)},e.prototype.options_add_set_blocks_group=function(t){var e=this;t.push({text:this.utils.replace_message_references("%{BKY_RELEASE_GROUP}"),name:"release_group",area:"block",enabled:!0,callback:function(){e.release()}})},e.prototype.dispose=function(t,e){var o;if(this.workspace){var i=this.events.get_group();if(this.events.set_group(i||!0),e&&this.rendered&&this.block_animations.dispose_ui_effect(this),this.release(),null==(o=this.origin_block)?void 0:o.workspace){var r=this.origin_block.get_descendants(!0,!0);if(r)for(var s=0;s<r.length;s++){var a=r[s];(0,c.is_block_group)(a)&&a.release()}this.origin_block.dispose(t,!1)}this.events.set_group(i)}},e.prototype.release=function(){switch(this.events.disable(),this.group_name=this.get_field_value(a.BLOCK_GROUP_NAME_FIELD_NAME),this.origin_block.move_by(s.vec2.sub(s.vec2.create(),this.get_relative_to_surface_xy(),this.origin_block.get_relative_to_surface_xy())),this.origin_block.get_svg_root().style.display=this.origin_block_display,this.origin_block.set_connectable(!0),this.origin_block.set_chunk_visibility(this.get_visibility()),this.origin_block.update_chunk_visibility(),this.group_type){case a.BlockGroupType.EXECUTION:(0,_.assert)(this.origin_block.previous_connection,"Statement block must have prev conn. ");var e,o,i,r,c,l,h,d,u=null==(e=this.previous_connection)?void 0:e.target_connection;null!=(o=this.previous_connection)&&o.disconnect();var p=null==(i=this.next_connection)?void 0:i.target_connection;if(this.group_stop_at=null==p?void 0:p.source_block.id,null==(r=this.next_connection)||r.disconnect(),p){var f=this.origin_block.last_connection_in_stack();(0,_.assert)(f),f.connect(p)}(null==u?void 0:u.source_block.workspace)===this.origin_block.workspace&&null!=u&&u.connect(this.origin_block.previous_connection);break;case a.BlockGroupType.OUTPUT:(0,_.assert)(this.origin_block.output_connection,"Output block must have output conn. ");var g=null==(c=this.output_connection)?void 0:c.target_connection;null!=(l=this.output_connection)&&l.disconnect(),null!=g&&g.connect(this.origin_block.output_connection)}this.origin_block.get_descendants(!1,!0).forEach(function(t){return t.set_comment_visible(!0)}),null!=(h=this.origin_block.comment)&&h.init_svg(!0),t.prototype.dispose.call(this,!1,!1),this.events.enable(),null!=(d=this.on_release)&&d.call(this)},(0,i.__decorate)([(0,r.injectable)()],e)}(o(20439).BlockSvg)},45179(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RenderedConnection=void 0;var i=o(31635),r=o(71519),s=(0,i.__importDefault)(o(22776)),a=o(77276),_=o(36963),c=o(35009),l=o(86295),h=o(25507),d=o(78194);e.RenderedConnection=function(){var t;function e(t){var e=this;this.x_=0,this.y_=0,this.hidden_=!1,this.in_db=!1,this.shadow_dom=void 0,this.can_connect_to_previous=function(t){if(e.target_connection||-1!=e.runtime_data.dragging_connections.indexOf(t))return!1;var o=e.source_block.get_first_statement_connection(),i=e==o,r=e==e.source_block.next_connection;if(void 0!=o&&!i&&!r)return!1;var s=void 0!=e.source_block.previous_connection;if(i&&s)return!0;if(r||i&&!s){if(!t.target_connection)return!0;var a=t.targetBlock();return!!a&&!!a.is_insertion_marker()&&!a.get_previous_block()}return!1},this.source_block=t.source,this.type=t.type,this.context=t.context;var o=t.source.get_workspace();o&&o.connectionDBList&&(this.db_=o.connectionDBList[t.type],this.db_opposite=o.connectionDBList[c.OPPOSITE_TYPE[t.type]],this.hidden_=!this.db_),this.offset_in_block=a.vec2.create()}return t=e,e.connect_reciprocally=function(t,e){t&&e||console.error("Cannot connect undefined connections."),t.target_connection=e,e.target_connection=t},e.prototype.get_targe_connection=function(){return this.target_connection},e.prototype.move_to=function(t){var e,o;this.in_db&&null!=(e=this.db_)&&e.remove_connection(this),this.x_=t[0],this.y_=t[1],this.hidden_||null==(o=this.db_)||o.add_connection(this)},e.prototype.move_by=function(t){this.move_to(a.vec2.fromValues(t[0]+this.x_,t[1]+this.y_))},e.prototype.highlight=function(){var t,e=null==(t=this.workspace_db.current)?void 0:t.get_options().connection_effect,o=e?e.color:"#fff";this.type==c.CONNECTION_TYPE.INPUT_VALUE||this.type===c.CONNECTION_TYPE.OUTPUT_VALUE?this.highlight_input(o):this.type===c.CONNECTION_TYPE.NEXT_STATEMENT?this.highlight_statement(o,!0):this.type===c.CONNECTION_TYPE.PREVIOUS_STATEMENT&&this.highlight_statement(o,!1)},e.prototype.highlight_input=function(e){var o=this.source_block.get_relative_to_surface_xy(),i=this.x_-o[0],r=this.y_-o[1],s="";if(this.target_connection){var a=this.target_connection.source_block.svg_path,_=void 0;void 0!=a&&(_=a.getAttribute("d")),"string"==typeof _&&(s=_)}t.highlighted_path=(0,h.create_svg_element)("path",{filter:"url(#blur-1px)",class:"blocklyHighlightedConnectionCover",transform:"translate("+i+", "+r+")",fill:e,d:s},this.source_block.get_svg_root())},e.prototype.highlight_statement=function(e,o){var i=this.source_block,r=this.offset_in_block[0],a=o?this.offset_in_block[1]-1:-3;t.highlighted_path=(0,h.create_svg_element)("g",{class:"g_blockly_next_statement_underline",transform:"translate(0, "+a+")"},this.source_block.get_svg_root()),(0,h.create_svg_element)("circle",{r:"4",cx:r,cy:"2",fill:e},t.highlighted_path),(0,h.create_svg_element)("circle",{r:"8",cx:r,cy:"2",fill:e,"fill-opacity":"0.3",filter:"url(#blur-1px)"},t.highlighted_path);var _=(0,h.create_svg_element)("rect",{x:r,y:"0",rx:"2",width:"0",height:"3",fill:e},t.highlighted_path),c=this.get_path_top_length(i)-r||i.width-i.block_renderer.padding_r-r;this.offset_in_block[1]>=80&&(c=75),"controls_if"===this.source_block.type&&(this.offset_in_block[1]>=100&&(c=55),this.offset_in_block[1]>=140&&(c=75)),(0,s.default)({targets:_,width:{value:c,duration:200,easing:"easeOutQuad"}})},e.prototype.get_path_top_length=function(t){var e=t.get_svg_root().querySelector("path");if(e){var o=e.getAttribute("d").match(/H\s.*?\s/gi);if(void 0==o)return 0;var i=o.map(function(t){return t.match(/\d+(.\d+)?/g)});return Math.max.apply(Math,i)}return 0},e.prototype.unhighlight=function(){t.highlighted_path&&((0,h.remove_node)(t.highlighted_path),delete t.highlighted_path)},e.prototype.set_offset_in_block=function(t,e){this.offset_in_block[0]=t,this.offset_in_block[1]=e},e.prototype.move_to_offset=function(t){this.move_to(a.vec2.fromValues(t[0]+this.offset_in_block[0],t[1]+this.offset_in_block[1]))},e.prototype.tighten=function(){if(void 0==this.target_connection)throw ReferenceError("Target connection not found.");var t=this.target_connection.get_xy();if(a.vec2.sub(t,t,[this.x_,this.y_]),0!==t[0]||0!==t[1]){var e=this.targetBlock(),o=e.get_svg_root(),i=this.utils.get_relative_xy(o);a.vec2.sub(i,i,t),o.setAttribute("transform","translate("+i[0]+", "+i[1]+")"),e.move_connections(a.vec2.negate(t,t))}},e.prototype.targetBlock=function(){if(this.is_connected()&&void 0!=this.target_connection)return this.target_connection.get_source_block()},e.prototype.closest=function(t,e){return this.db_opposite?this.db_opposite.search_for_closest(this,t,e):{connection:void 0,radius:t}},e.prototype.connect_to_inferior=function(e){(function(e){var o,i,r=this,s=this,a=s.get_source_block(),_=e.get_source_block(),l=!1;if(s==a.get_first_statement_connection()&&(l=!0),e.is_connected()&&(l&&(o=e.target_connection),e.disconnect()),s.is_connected()){var h=s.targetBlock(),d=s.get_shadow_dom();if(s.set_shadow_dom(void 0),h&&h.is_shadow())this.events.disable(),d=_.is_shadow()?this.xml.block_to_dom(_):this.xml.block_to_dom(h),h.dispose(),h=void 0,this.events.enable();else if(s.type==c.CONNECTION_TYPE.NEXT_STATEMENT){if(h&&!h.previous_connection)throw Error("Orphan block does not have a previous connection.");for(var u=_;u.next_connection;){var p=u.get_next_block();if(!p||p.is_shadow()){h&&h.previous_connection&&h.previous_connection.check_type(u.next_connection)&&(u.next_connection.connect(h.previous_connection),h=void 0);break}u=p}}if(h&&(s.disconnect(),this.events.is_record_undo())){var f=this.events.get_group();window.setTimeout(function(){r.events.get_group()&&r.events.get_group()!==f?console.error("current group "+r.events.get_group()+", blocking scheduled bump"):h&&h.get_workspace()&&!h.get_parent()&&(r.events.set_group(f),h.output_connection?h.output_connection.bump_away_from(s):h.previous_connection&&h.previous_connection.bump_away_from(s),r.events.set_group(!1))},this.theme.blink_params.BUMP_DELAY)}d&&s.set_shadow_dom(d)}l&&o&&a.previous_connection&&o.connect(a.previous_connection),_.visibility_for_undo=_.get_visibility(),this.events.is_enabled()&&(i=this.move_event_factory({block:_})),t.connect_reciprocally(s,e),_.set_parent(a),i&&(i.record_new(),this.events.fire(i))}).call(this,e);var o=this.get_source_block(),i=e.get_source_block();o.rendered&&(o.update_disabled(),o.update_collapsed()),i.rendered&&i.update_disabled(),o.rendered&&i.rendered&&(this.type==c.CONNECTION_TYPE.NEXT_STATEMENT||this.type==c.CONNECTION_TYPE.PREVIOUS_STATEMENT?i.render():o.render())},e.prototype.disconnect_internal=function(t,e){this.events.is_enabled()&&(o=this.move_event_factory({block:e}));var o,i=this.target_connection;i&&(i.target_connection=void 0,this.target_connection=void 0,e.set_parent(void 0),o&&(o.record_new(),this.events.fire(o)),e.visibility_for_undo&&this.events.is_undoing()&&(e.set_chunk_visibility(e.visibility_for_undo),e.update_chunk_visibility(),e.visibility_for_undo=void 0),t.is_rendered()&&t.render(),e.is_rendered()&&(e.update_disabled(),e.render()))},e.prototype.respawn_shadow=function(){var t,e=this.get_source_block(),o=this.get_shadow_dom();if(e.get_workspace()&&!this.is_connected()&&o){this.events.disable();var i="color_picker"===o.getAttribute("type")?this.xml.dom_to_block(o,e.get_workspace()):this.xml.dom_to_block_headless(o,e.get_workspace());if(o.setAttribute("id",i.id),this.set_shadow_dom(o),i.output_connection)this.connect(i.output_connection);else{if(!i.previous_connection)throw Error("Child block does not have output or previous statement.");this.connect(i.previous_connection)}this.xml.parse_fields(o,i),e.rendered&&(i.init_svg(),i.render()),this.type===c.CONNECTION_TYPE.INPUT_VALUE&&this.source_block.is_collapsed()&&(null!=(t=this.target_connection)&&t.hide_all(),i.set_visible_as_child(!1)),this.events.enable()}},e.prototype.neighbours_=function(t){var e;return(null==(e=this.db_opposite)?void 0:e.get_neighbours(this,t))||[]},e.prototype.bump_away_from=function(t){if(this.source_block.is_stack_connectable()&&t.get_source_block().is_stack_connectable()){var e=this.source_block.get_workspace();if(!e||!e.is_dragging()){var o=this.source_block.get_root_block();if(!o.is_in_flyout){var i=!1;if(!o.is_movable()){if(!(o=t.get_source_block().get_root_block()).is_movable())return;t=this,i=!0}var r=this.runtime_data.selected==o;r||o.add_select();var s=t.x_+this.theme.blink_params.SNAP_RADIUS-this.x_,_=t.y_+this.theme.blink_params.SNAP_RADIUS-this.y_;i&&(_=-_),o.RTL&&(s=-s),o.move_by(a.vec2.fromValues(s,_)),r||o.remove_select()}}}},e.prototype.unhide_all=function(){this.set_hidden(!1);var t=[];if(this.type!=c.CONNECTION_TYPE.INPUT_VALUE&&this.type!=c.CONNECTION_TYPE.NEXT_STATEMENT)return t;var e=this.targetBlock();if(e){var o=void 0;e.is_collapsed()?(o=[],e.output_connection&&o.push(e.output_connection),e.next_connection&&o.push(e.next_connection),e.previous_connection&&o.push(e.previous_connection)):o=e.get_connections(!0);for(var i=0;i<o.length;i++)t.push.apply(t,o[i].unhide_all());t.length||(t[0]=e)}return t},e.prototype.hide_all=function(){var t;if(this.set_hidden(!0),this.target_connection){var e=this.targetBlock();if(void 0==e)throw Error("target_block should not be undefined");for(var o=e.get_descendants(),i=0;i<o.length;i++){for(var r=o[i],s=r.get_connections(!0),a=0;a<s.length;a++)s[a].set_hidden(!0);null!=(t=r.warning)&&t.set_expanded(!1)}}},e.prototype.is_connection_allowed=function(t,e){return!!t.source_block.is_stack_connectable()&&!(this.distance_from(t)>e)&&(function(t){if(t.get_source_block().is_insertion_marker()||!t.get_source_block().is_rendered()||d.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(t.get_source_block().type)&&t.get_source_block().is_collapsed()||t.get_source_block().get_collapsed_surround_parent()||"procedures_2_defnoreturn"==t.source_block.type&&t.target_connection&&"procedures_2_stable_parameter"==t.target_connection.source_block.type||t.target_connection&&t.target_connection.source_block.is_shadow()&&"param"===t.target_connection.source_block.element_type||this.can_connect_with_reason(t)!=c.CONNECTABLE_TYPE.CAN_CONNECT)return!1;switch(t.type){case c.CONNECTION_TYPE.PREVIOUS_STATEMENT:return this.can_connect_to_previous(t);case c.CONNECTION_TYPE.OUTPUT_VALUE:return!1;case c.CONNECTION_TYPE.INPUT_VALUE:if((e=t.targetBlock())&&t.target_connection&&!e.is_movable()&&!e.is_shadow())return!1;break;case c.CONNECTION_TYPE.NEXT_STATEMENT:var e;if((e=t.targetBlock())&&t.is_connected_to_non_insertion_marker()&&!this.source_block.next_connection&&!e.is_shadow()&&e.next_connection)return!1;break;default:throw Error("Unknown connection type in is_connection_allowed")}return -1==this.runtime_data.dragging_connections.indexOf(t)}).call(this,t)},e.prototype.distance_from=function(t){var e=this.x_-t.x_,o=this.y_-t.y_;return Math.sqrt(e*e+o*o)},e.prototype.get_shadow_dom=function(){if(this.shadow_dom)return"string"==typeof this.shadow_dom&&(this.shadow_dom=this.utils.string_to_dom(this.shadow_dom)),this.shadow_dom},e.prototype.get_shadow_string=function(){return this.shadow_dom&&"string"!=typeof this.shadow_dom?this.xml.dom_to_text(this.shadow_dom):this.shadow_dom},e.prototype.set_shadow_dom=function(t){this.shadow_dom=t},e.prototype.set_shadow_from_string=function(t){this.shadow_dom=t},e.prototype.connect=function(t,e){if(void 0===e&&(e=!1),this.target_connection==t)return!1;var o=!0;try{this.check_connection(t)}catch(t){e||console.error(t),o=!1}if(!o)return!1;var i=this.is_superior()?this:t,r=this.is_superior()?t:this;return i.connect_to_inferior(r),r.source_block.update_layer_colour(),!0},e.prototype.on_check_changed=function(){if(this.is_connected()&&this.target_connection&&!this.check_type(this.target_connection)){var t=this.is_superior()?this.targetBlock():this.source_block;if(void 0==t)throw ReferenceError("Connection source block not found.");t.unplug(),this.source_block.bump_neighbours()}},e.prototype.get_output_shape=function(){return this.check_&&1==this.check_.length&&"Boolean"==this.check_[0]?c.OutputShape.HEXAGONAL:c.OutputShape.ROUND},e.prototype.get_xy=function(){return a.vec2.fromValues(this.x_,this.y_)},e.prototype.set_hidden=function(t){this.hidden_=t,this.db_&&(t&&this.in_db?this.db_.remove_connection(this):t||this.in_db||this.db_.add_connection(this))},e.prototype.get_source_block=function(){return this.source_block},e.prototype.dispose=function(){if(this.is_connected())throw Error("Disconnect connection before disposing of it.");this.in_db&&this.db_&&this.db_.remove_connection(this),delete this.db_,delete this.db_opposite},e.prototype.is_connected_to_non_insertion_marker=function(){var t=this.targetBlock();return!!t&&!t.is_insertion_marker()},e.prototype.disconnect=function(){var t,e,o,i=this.target_connection;i&&(i.target_connection!==this&&console.error("Target connection not connected to source connection."),this.is_superior()?(t=this.source_block,e=i.get_source_block(),o=this):(t=i.get_source_block(),e=this.source_block,o=i),this.disconnect_internal(t,e),o.respawn_shadow(),e.update_layer_colour())},e.prototype.set_check=function(t){return t?(this.check_=(0,l.is_array)(t)?t:[t],this.on_check_changed()):this.check_=void 0,this},e.prototype.is_connected=function(){return!!this.target_connection},e.prototype.check_type=function(t){if(!this.check_||!t.check_)return!0;for(var e=0;e<this.check_.length;e++)if(-1!=t.check_.indexOf(this.check_[e]))return!0;return!1},e.prototype.check_connection=function(t){switch(this.can_connect_with_reason(t)){case c.CONNECTABLE_TYPE.CAN_CONNECT:break;case c.CONNECTABLE_TYPE.REASON_SELF_CONNECTION:throw Error("Attempted to connect a block to itself.");case c.CONNECTABLE_TYPE.REASON_DIFFERENT_WORKSPACES:throw Error("Blocks not on same workspace.");case c.CONNECTABLE_TYPE.REASON_WRONG_TYPE:throw Error("Attempt to connect incompatible types.");case c.CONNECTABLE_TYPE.REASON_TARGET_NULL:throw Error("Target connection is undefined.");case c.CONNECTABLE_TYPE.REASON_CHECKS_FAILED:throw"Connection checks failed. "+(this+" expected "+this.check_+", found ")+t.check_;case c.CONNECTABLE_TYPE.REASON_SHADOW_PARENT:throw Error("Connecting non-shadow to shadow block.");default:throw Error("Unknown connection failure: this should never happen!")}},e.prototype.can_connect_with_reason=function(t){var e,o;return t?(this.is_superior()?(e=this.source_block,o=t.get_source_block()):(o=this.source_block,e=t.get_source_block()),e&&e===o?c.CONNECTABLE_TYPE.REASON_SELF_CONNECTION:t.type!==c.OPPOSITE_TYPE[this.type]?c.CONNECTABLE_TYPE.REASON_WRONG_TYPE:e&&o&&e.get_workspace()!==o.get_workspace()?c.CONNECTABLE_TYPE.REASON_DIFFERENT_WORKSPACES:this.check_type(t)?e.is_shadow()&&!o.is_shadow()&&"param_color"!==e.element_type?c.CONNECTABLE_TYPE.REASON_SHADOW_PARENT:c.CONNECTABLE_TYPE.CAN_CONNECT:c.CONNECTABLE_TYPE.REASON_CHECKS_FAILED):c.CONNECTABLE_TYPE.REASON_TARGET_NULL},e.prototype.is_superior=function(){return this.type==c.CONNECTION_TYPE.INPUT_VALUE||this.type==c.CONNECTION_TYPE.NEXT_STATEMENT},e.prototype.remove_shadow=function(){if(this.is_superior()){this.set_shadow_dom(void 0);var t=this.targetBlock();t&&t.is_shadow()&&(this.events.disable(),this.disconnect_internal(this.source_block,t),t.dispose(),this.events.enable())}},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.runtime_data)],e.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.utils)],e.prototype,"utils",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.theme)],e.prototype,"theme",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.workspace_db)],e.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.MoveEvent)],e.prototype,"move_event_factory",void 0),t=(0,i.__decorate)([(0,r.injectable)()],e)}()},52102(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceComment=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(35009),c=o(71288),l=o(78194),h=o(25507),d=o(89221),u=o(86295);e.WorkspaceComment=function(t){function e(e,o,i,r){var a=t.call(this,e)||this;a.element_type="comment",a.SIZE=24,a.width=40,a.height=40,a.left_top_offset=[-12,-12],a.color_theme="BLUE",a.text_="",a.bubble_width_=214,a.bubble_height_=126,a.parent_width_=0,a.relative_position_=s.vec2.create(),a.expanded_=!1,a.prev_text_l=0,a.is_textarea_focused=!1,a.auto_layout_=!0,a.parent_block_=o;var _=a.workspace.is_resizes_enabled();a.workspace.set_resizes_enabled(!1),a.events.disable(),a.id=void 0!=r?r:(0,d.gen_uid)(),a.svg_group.classList.add("blocklyWorkspaceComment"),a.update_movable(),o&&(o.is_rendered()&&(a.parent_width_=o.first_row_width,a.relative_position_=s.vec2.fromValues(a.parent_width_+60,o.first_row_height/2)),a.deletable_=!1);var c=void 0;if(i)if(a.parent_block_){c=(0,u.clone_deep)(a.get_relative_position()),a.set_relative_position(s.vec2.fromValues(i.x,i.y));var l=a.parent_block_.get_relative_to_surface_xy();a.translate(s.vec2.add(l,l,a.relative_position_))}else a.translate(s.vec2.fromValues(i.x,i.y));if(e.workspace_comment_db.set(a.id,a),o||e.add_top_comment(a),a.init_events(),a.events.enable(),a.events.is_enabled()){if(a.parent_block_){var h=a.change_event_factory("comment",{block:a.parent_block_,old_value:void 0,new_value:a.id});a.events.fire(h)}else a.events.fire(a.create_event_factory({block:a}));if(i&&a.parent_block_){var p=a.move_event_factory({block:a});p.set_record_undo(!1),c&&p.set_old_coord(c),p.record_new(),a.events.fire(p)}}return a.workspace.set_resizes_enabled(_),a}return(0,i.__extends)(e,t),e.prototype.init_svg=function(){var t;this.parent_block_&&!this.svg_line_&&(this.svg_line_=(0,h.create_svg_element)("line",{class:"blocklyCommentLine",x1:0,y1:0},this.svg_group),this.svg_line_.style.stroke=_.THEME_COLOR_MAP[this.color_theme].toString()),this.svg_icon||(this.svg_icon=(0,h.create_svg_element)("g",{class:"blocklyCommentGroup",filter:"url(#"+c.FILTER.BOXSHADOW+")"}),this.draw_icon(this.svg_icon),this.events.bind_event_with_checks(this.svg_icon,"mouseup",this,this.on_icon_click)),this.reposition(),this.expanded_?this.show_editor():this.update_icon(),this.rendered=!0,null!=(t=this.workspace.get_canvas())&&t.appendChild(this.svg_group)},e.prototype.update_icon=function(){this.svg_icon&&(this.svg_icon.setAttribute("transform","translate("+this.left_top_offset[0]+", "+this.left_top_offset[1]+")"),this.expanded_||this.svg_group.appendChild(this.svg_icon))},e.prototype.get_icon=function(){return this.svg_icon},e.prototype.draw_line=function(){if(this.parent_block_&&this.svg_group&&this.svg_line_){var t=this.compute_line_connect_position();t[0]!==Number(this.svg_line_.getAttribute("x2"))&&this.svg_line_.setAttribute("x2",""+t[0]),t[1]!==Number(this.svg_line_.getAttribute("y2"))&&this.svg_line_.setAttribute("y2",""+t[1])}},e.prototype.draw_icon=function(t,e,o){e=e||this.SIZE,o=o||"url(#CommentLinearGradient-"+this.color_theme+")",(0,h.create_svg_element)("circle",{class:"blocklyCommentShape",r:e/2,cx:e/2,cy:e/2,fill:o},t),(0,h.create_svg_element)("path",{class:"blocklyCommentSymbol",transform:"scale("+e/24+") translate(4,4)",d:"M6.98347343,1.49411736 C7.33446274,1.16471383 7.86095956,1 8.38745638,1 C8.91395321,1 9.44045003,1.16471383 9.79146505,1.49411736 C10.2301953,1.82354502 10.4057028,2.23529341 10.4057028,2.72941077 C10.4057028,3.22352813 10.2301953,3.63530065 9.79146505,3.96470418 C9.35270913,4.29413184 8.91395321,4.45882154 8.38745638,4.45882154 C7.86095956,4.45882154 7.33446274,4.29413184 6.89573253,3.96470418 C6.54471751,3.63530065 6.28146909,3.22352813 6.28146909,2.72941077 C6.3692357,2.23529341 6.54471751,1.82354502 6.98347343,1.49411736 L6.98347343,1.49411736 Z M10.3500141,14.3956806 C9.75084061,14.5982168 9.33065616,14.744752 9.08946072,14.8352862 C8.6507048,15 8.21197458,15 7.68547776,15 C6.89573253,15 6.19372819,14.8352862 5.75497227,14.4235378 C5.31624206,14.0117653 5.05299365,13.5999928 5.05299365,13.0235305 C5.05299365,12.7764719 5.05299365,12.611758 5.14073455,12.3646994 C5.14073455,12.1176407 5.22847545,11.870582 5.31624206,11.6235233 L6.19372819,8.90587781 C6.28146909,8.65881913 6.3692357,8.41176045 6.3692357,8.16470177 C6.4569766,7.91764308 6.4569766,7.75295338 6.4569766,7.5058947 C6.4569766,7.17646704 6.3692357,6.92940836 6.19372819,6.76471866 C6.01822068,6.60000483 5.75497227,6.60000483 5.31624206,6.60000483 C5.05299365,6.60000483 4.87748614,6.60000483 4.61423772,6.68234968 C4.52669943,6.70973993 4.43188454,6.73712818 4.32979305,6.76451443 C4.19006969,6.80197087 4.04642345,6.71909078 4.00894402,6.57937358 C4.00300701,6.55724137 4,6.53442576 4,6.51151108 C4,6.30823881 4.12437054,6.12566505 4.31352762,6.05123915 C5.07451793,5.75187496 5.58425502,5.57793699 5.84273888,5.52942525 C6.3692357,5.36471142 6.80796592,5.28236657 7.33446274,5.28236657 C8.12420797,5.28236657 8.82621231,5.44705627 9.26496823,5.85882878 C9.70369844,6.18823231 9.96694685,6.68234968 9.96694685,7.25883602 L9.96694685,7.91764308 C9.96694685,8.24707075 9.87920595,8.49412943 9.79146505,8.74118811 L8.91395321,11.4588336 C8.82621231,11.7058923 8.73847141,11.952951 8.73847141,12.2000097 C8.6507048,12.4470683 8.6507048,12.694127 8.6507048,12.8588167 C8.6507048,13.1882444 8.73847141,13.4353031 8.91395321,13.5999928 C9.08946072,13.7647066 9.35270913,13.7647066 9.87920595,13.7647066 C10.0547135,13.7647066 10.3179619,13.7647066 10.5812103,13.6823617 C10.6420133,13.6633368 10.7063269,13.6443129 10.7741511,13.6252899 C10.8691243,13.5986609 10.967707,13.6540565 10.9943439,13.7490274 C11.0075127,13.7959791 11.0009105,13.8462737 10.97607,13.8882359 C10.8348216,14.1268423 10.6126922,14.3068868 10.3500141,14.3956806 Z"},t)},e.prototype.on_icon_click=function(t){this.workspace.is_dragging()||this.utils.is_right_button(t)||this.set_expanded(!0)},e.prototype.get_bounding_rectangle=function(){var e=t.prototype.get_bounding_rectangle.call(this),o=e.topLeft,i=e.bottomRight;return{topLeft:s.vec2.add(s.vec2.create(),o,this.left_top_offset),bottomRight:s.vec2.add(s.vec2.create(),i,this.left_top_offset)}},e.prototype.get_parent_block=function(){return this.parent_block_},e.prototype.get_top_parent=function(){return this.get_root_block()||this},e.prototype.get_root_block=function(){for(var t=this.parent_block_;null==t?void 0:t.parent_block;)t=t.parent_block;return t},e.prototype.dispose=function(e,o){var i;this.events.is_enabled()&&(i=this.parent_block_?this.change_event_factory("comment",{block:this.parent_block_,old_value:this.xml.comment_to_dom_with_xy(this),new_value:void 0}):this.delete_event_factory({block:this})),this.workspace.workspace_comment_db.delete(this.id),this.parent_block_||this.workspace.remove_top_comment(this),t.prototype.dispose.call(this,e,o&&!this.parent_block_),this.events.fire(i)},e.prototype.show_context_menu=function(t){var e=this;if(!this.workspace.get_options().readOnly&&this.context_menu&&!this.is_in_flyout){var o=function(t){var o=(0,h.create_svg_element)("g",{width:16,height:16});return e.draw_icon(o,16,_.THEME_COLOR_MAP[t].toString()),o},i=function(t){var o=e.color_theme;o!==t&&(e.set_color_theme(t),e.events.is_enabled()&&e.events.fire(e.change_event_factory("comment_color",{block:e,old_value:o,new_value:t})))},r=[{text:this.Msg.BLUE_COMMENT,name:"comment_set_color_blue",enabled:!0,callback:i.bind(this,"BLUE"),icon:o("BLUE"),selected:"BLUE"===this.color_theme},{text:this.Msg.GREEN_COMMENT,name:"comment_set_color_green",enabled:!0,callback:i.bind(this,"GREEN"),icon:o("GREEN"),selected:"GREEN"===this.color_theme},{text:this.Msg.YELLOW_COMMENT,name:"comment_set_color_yellow",enabled:!0,callback:i.bind(this,"YELLOW"),icon:o("YELLOW"),selected:"YELLOW"===this.color_theme},{text:this.Msg.RED_COMMENT,name:"comment_set_color_red",enabled:!0,callback:i.bind(this,"RED"),icon:o("RED"),selected:"RED"===this.color_theme},{text:this.Msg.DELETE_COMMENT,name:"comment_delete",enabled:!0,callback:function(){e.parent_block_?e.parent_block_.set_comment_text(void 0):e.dispose(void 0,!0)}}];this.context_menu.current_block=this,this.context_menu.show(t,{source:"block",options:r},this.RTL)}},e.prototype.get_color_theme=function(){return this.color_theme},e.prototype.get_colour=function(){return _.THEME_COLOR_MAP[this.color_theme]},e.prototype.set_color_theme=function(t,e){var o=this;if(t!==this.color_theme)if((0,u.is_comment_theme)(t)){var i,r=_.THEME_COLOR_MAP[this.color_theme];this.color_theme=t;var s=_.THEME_COLOR_MAP[this.color_theme];this.svg_line_&&(this.svg_line_.style.stroke=s.toString()),this.bubble_&&(this.bubble_.style.background="linear-gradient(to bottom, "+s+" 4px, #fff 4px)",this.expanded_&&!e&&this.empty_border&&(this.empty_border.classList.add("blocklyCommentBorder"),this.empty_border.style.backgroundColor=r.toString(),this.empty_border.addEventListener("animationend",function(){o.empty_border&&(o.empty_border.classList.remove("blocklyCommentBorder"),o.empty_border.style.backgroundColor="transparent")}))),this.svg_icon&&(i=this.svg_icon.querySelector("circle"))&&i.setAttribute("fill","url(#CommentLinearGradient-"+this.color_theme+")"),this.sub_icon&&(i=this.sub_icon.querySelector("circle"))&&i.setAttribute("fill",s.toString())}else console.warn("Trying to set invalid color theme: "+t)},e.prototype.move_by=function(t){this.events.is_enabled()&&(e=this.move_event_factory({block:this}));var e,o=this.get_relative_to_surface_xy();this.translate(s.vec2.add(this.location_,o,t)),this.parent_block_&&(s.vec2.add(this.relative_position_,this.relative_position_,t),this.draw_line()),e&&e.record_new(),this.rendered&&this.workspace.resize_contents(),e&&this.events.fire(e)},e.prototype.sort=function(t){var e=this.get_relative_to_surface_xy(),o=s.vec2.fromValues(t[0]+20,t[1]+20);this.move_by(s.vec2.sub(e,o,e)),s.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])},e.prototype.get_text=function(){return this.text_},e.prototype.set_text=function(t){var e;this.text_!=t&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_text",{block:this,old_value:this.text_,new_value:t})),this.text_=t),this.textarea_&&(this.textarea_.value=t),this.text_layout(),e&&this.events.fire(e)},e.prototype.get_bubble_size=function(){return{width:this.bubble_width_,height:this.bubble_height_}},e.prototype.set_bubble_size=function(t,e){(t=Math.max(140,t))!==this.bubble_width_&&(this.bubble_width_=t,this.bubble_&&this.bubble_.setAttribute("width",""+t),this.bubble_shadow_&&this.bubble_shadow_.setAttribute("width",""+t),this.expanded_&&(this.width=t)),(e=Math.max(68,e))!==this.bubble_height_&&(this.bubble_height_=e,this.bubble_&&this.bubble_.setAttribute("height",""+e),this.bubble_shadow_&&this.bubble_shadow_.setAttribute("height",""+e),this.expanded_&&(this.height=e))},e.prototype.get_relative_position=function(){return this.parent_block_?this.relative_position_:this.location_},e.prototype.set_relative_position=function(t){this.relative_position_=t},e.prototype.set_expanded=function(t){var e;t!=this.expanded_&&(this.expanded_=t,this.rendered&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_expand",{block:this,old_value:!t,new_value:t})),t?this.show_editor():this.hide_editor(),this.update_visibility(),this.events.fire(e),this.workspace.resize_contents()))},e.prototype.is_expanded=function(){return this.expanded_},e.prototype.update_visibility=function(){if(this.parent_block_){var t=this.parent_block_;(0,u.is_block_svg)(t)&&(t=t.get_root_block());var e=t.get_visibility();(0,h.update_visibility_class)(this.svg_group,e)}},e.prototype.reposition=function(){if(this.parent_block_&&this.parent_block_.is_rendered()){var t=this.parent_block_.get_relative_to_surface_xy();this.parent_width_&&this.parent_width_!==this.parent_block_.first_row_width&&this.relative_position_[0]>this.parent_width_/2&&(this.relative_position_[0]-=this.parent_width_,this.relative_position_[0]+=this.parent_block_.first_row_width),this.parent_width_=this.parent_block_.first_row_width,this.translate(s.vec2.add(t,t,this.relative_position_)),this.draw_line()}},e.prototype.show_editor=function(){var t=this;if(this.svg_icon&&(0,h.remove_node)(this.svg_icon),this.left_top_offset=[-20,-20],!this.bubble_||!this.bubble_shadow_){this.bubble_=(0,h.create_svg_element)("foreignObject",{width:this.bubble_width_,height:this.bubble_height_,class:"blocklyCommentBubble",transform:"translate("+this.left_top_offset[0]+", "+this.left_top_offset[1]+")"}),this.bubble_.style.background="linear-gradient(to bottom, "+_.THEME_COLOR_MAP[this.color_theme]+" 4px, #fff 4px)",this.empty_border=document.createElement("div"),this.empty_border.classList.add("blockCommentEmptyBorder"),this.bubble_.appendChild(this.empty_border);var e=document.createElement("div");e.classList.add("blocklyCommentBubbleLabel");var o=document.createElement("div");this.sub_icon=(0,h.create_svg_element)("svg",{width:14,height:14,class:"blocklyCommentBubbleIcon"},o),this.draw_icon(this.sub_icon,14,_.THEME_COLOR_MAP[this.color_theme].toString());var i=document.createElement("div");i.textContent=this.Msg.COMMENT,o.appendChild(i),e.appendChild(o);var r=(0,h.create_svg_element)("svg",{width:12,height:12,class:"blocklyCommentBubbleClose"},e);(0,h.create_svg_element)("path",{d:"m8,4 l3.834 3.834 c0.352,0.352 0.352,0.92 0,1.278 l-0.32,0.32 c-0.352,0.352 -0.92,0.352 -1.278,0 l-2.926,-2.926 l-2.926,2.926 c-0.352,0.352 -0.92,0.352 -1.278,0 l-0.32,-0.32 c-0.352,-0.352 -0.352,-0.92 0,-1.278 l3.834,-3.834 q 0.6892,-0.8 1.3784,0 z"},r),e.appendChild(r),this.textarea_=document.createElementNS(l.HTML_NS,"textarea"),this.textarea_.classList.add("blocklyCommentTextarea"),this.textarea_.placeholder=this.parent_block_?this.Msg.WHATS_THIS:this.Msg.SAY_SOMETHING,this.events.bind_event_with_checks(this.textarea_,"mousedown",this,this.textarea_mouse_down),this.events.bind_event_with_checks(this.textarea_,"blur",this,function(e){e.stopPropagation(),e.preventDefault(),t.textarea_&&t.set_text(t.textarea_.value||""),t.is_textarea_focused=!1}),this.events.bind_event_with_checks(this.textarea_,"input",this,function(e){e.stopPropagation(),e.preventDefault(),t.text_layout()}),this.events.bind_event_with_checks(r,"mousedown",this,function(t){t.stopPropagation(),t.preventDefault(),this.set_expanded(!1)});var s=document.createElement("div");s.classList.add("blocklyCommentTopContainer");var a=document.createElement("div");a.classList.add("blocklyCommentMainContainer"),a.appendChild(e),a.appendChild(this.textarea_),this.bubble_.appendChild(s),s.appendChild(a);var d=document.createElement("div");d.classList.add("blocklyCommentBottomContainer"),this.bubble_.appendChild(d);var u=this.create_resize_controllers();u&&(s.appendChild(u.ew_resize),d.appendChild(u.ns_resize),d.appendChild(u.nwse_resize)),this.bubble_shadow_=(0,h.create_svg_element)("rect",{width:this.bubble_width_,height:this.bubble_height_,filter:"url(#"+c.FILTER.BOXSHADOW+")",transform:"translate("+this.left_top_offset[0]+", "+this.left_top_offset[1]+")"})}this.textarea_&&(this.textarea_.value=this.text_),this.svg_group.appendChild(this.bubble_shadow_),this.svg_group.appendChild(this.bubble_),this.height=this.bubble_height_,this.width=this.bubble_width_,this.bring_to_front()},e.prototype.text_layout=function(){if(this.textarea_&&this.auto_layout_){if(this.textarea_.value.length>=this.prev_text_l){var t=this.textarea_.scrollHeight+52;return this.set_bubble_size(this.bubble_width_,Math.max(t,126)),void(this.prev_text_l=this.textarea_.value.length)}this.set_bubble_size(this.bubble_width_,126),this.prev_text_l=0,this.text_layout()}},e.prototype.hide_editor=function(){this.bubble_shadow_&&(0,h.remove_node)(this.bubble_shadow_),this.bubble_&&(0,h.remove_node)(this.bubble_),this.width=40,this.height=40,this.left_top_offset=[-12,-12],this.update_icon()},e.prototype.textarea_mouse_down=function(t){var e=this;if(this.textarea_)if(this.is_textarea_focused)t.stopPropagation();else{this.bring_to_front();var o=this.events.bind_event_with_checks(this.textarea_,"mouseup",this,function(){e.textarea_&&e.textarea_.focus(),e.is_textarea_focused=!0,e.select(),e.events.unbind_event(o),e.workspace.cancel_current_gesture(),e.touch_manager.clear_touch_identifier()})}},e.prototype.create_resize_controllers=function(){if(this.bubble_){var t={ew_resize:document.createElement("div"),ns_resize:document.createElement("div"),nwse_resize:document.createElement("div")};return t.ew_resize.classList.add("blocklyCommentEWResize"),this.events.bind_event_with_checks(t.ew_resize,"mousedown",this,this.resize_mouse_down.bind(this,"ew")),t.ns_resize.classList.add("blocklyCommentNSResize"),this.events.bind_event_with_checks(t.ns_resize,"mousedown",this,this.resize_mouse_down.bind(this,"ns")),t.nwse_resize.classList.add("blocklyCommentNWSEResize"),this.events.bind_event_with_checks(t.nwse_resize,"mousedown",this,this.resize_mouse_down.bind(this,"nwse")),t}},e.prototype.unbind_resize_events=function(){this.on_mouseup_wrapper&&(this.events.unbind_event(this.on_mouseup_wrapper),this.on_mouseup_wrapper=void 0),this.on_mousemove_wrapper&&(this.events.unbind_event(this.on_mousemove_wrapper),this.on_mousemove_wrapper=void 0)},e.prototype.resize_mouse_down=function(t,e){this.bring_to_front(),this.select(),e.stopPropagation(),e.preventDefault(),this.utils.is_right_button(e)||(this.workspace.start_drag(e,s.vec2.fromValues(this.bubble_width_,this.bubble_height_)),this.select(),this.size_before_resize=[this.bubble_width_,this.bubble_height_],this.on_mouseup_wrapper=this.events.bind_event_with_checks(document,"mouseup",this,this.bubble_mouse_up),this.on_mousemove_wrapper=this.events.bind_event_with_checks(document,"mousemove",this,this.resize_mouse_move.bind(this,t)))},e.prototype.resize_mouse_move=function(t,e){this.auto_layout_=!1;var o=this.workspace.move_drag(e);t.indexOf("e")>-1&&t.indexOf("w")>-1&&this.set_bubble_size(o[0],this.bubble_height_),t.indexOf("n")>-1&&t.indexOf("s")>-1&&this.set_bubble_size(this.bubble_width_,o[1])},e.prototype.bubble_mouse_up=function(){this.touch_manager.clear_touch_identifier(),this.unbind_resize_events(),this.size_before_resize&&(this.size_before_resize[0]!==this.bubble_width_||this.size_before_resize[1]!==this.bubble_height_)&&this.events.is_enabled()&&this.events.fire(this.change_event_factory("comment_resize",{block:this,old_value:this.size_before_resize,new_value:[this.bubble_width_,this.bubble_height_]})),this.size_before_resize=void 0},e.prototype.is_auto_layout=function(){return this.auto_layout_},e.prototype.set_auto_layout=function(t){this.auto_layout_=t},e.prototype.focus=function(){if(this.set_expanded(!0),this.textarea_){var t,e,o=(0,h.get_viewport_size)();if(this.textarea_.getBoundingClientRect().left>=o.width){var i=this.get_relative_to_surface_xy()[0]+this.left_top_offset[0],r=this.workspace.get_metrics(),s=this.workspace.get_scale();i=i*s-r.contentLeft-r.viewWidth+this.bubble_width_*s,null!=(e=null==(t=this.workspace.get_scrollbar())?void 0:t.h_scroll)&&e.set(i),this.textarea_.focus()}else this.textarea_.focus()}},Object.defineProperty(e.prototype,"use_drag_surface",{get:function(){return!!this.workspace.get_block_drag_surface()&&!this.parent_block_},enumerable:!1,configurable:!0}),e.prototype.compute_line_connect_position=function(){var t=s.vec2.scale(s.vec2.create(),this.relative_position_,-1);if(!this.parent_block_||!this.parent_block_.rendered)return t;var e=s.vec2.create();e[1]=this.parent_block_.first_row_height/2;var o=this.parent_block_.first_row_width,i=this.relative_position_[0]>o/2;return i&&(e[0]+=o),this.parent_block_.is_starting_block()&&!i&&(e[0]-=22),s.vec2.add(t,t,e)},e.prototype.cancel_operation=function(){this.is_textarea_focused&&(this.textarea_.value=this.text_,this.textarea_.blur()),this.size_before_resize&&(this.set_bubble_size(this.size_before_resize[0],this.size_before_resize[1]),this.bubble_mouse_up()),this.unselect()},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Msg)],e.prototype,"Msg",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.json)],e.prototype,"json",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(31728).WorkspaceElement)},8701(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SimplifiedWorkspaceComment=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(35009),c=o(25507),l=o(86295),h=o(89221),d=o(44015),u=o(71288);e.SimplifiedWorkspaceComment=function(t){function e(e,o,i,r){var a=t.call(this,e)||this;a.element_type="comment",a.icon_size=32,a.h_distance=-6,a.icon_offset=4,a.icon_limit=3,a.text_="",a.width=a.icon_size,a.height=a.icon_size,a.left_top_offset=[-a.icon_size/2,-a.icon_size/2],a.bubble_width_=214,a.bubble_height_=126,a.auto_layout_=!0,a.relative_position_=s.vec2.create(),a.expanded_=!1,a.color_theme="BLUE",a.is_textarea_focused=!1,a.parent_block_=o,a.base_block=o;var _=a.workspace.is_resizes_enabled();return a.workspace.set_resizes_enabled(!1),a.events.disable(),a.id=void 0!=r?r:(0,h.gen_uid)(),a.svg_group.classList.add("blocklyWorkspaceComment"),a.update_movable(),o&&(a.deletable_=!1),i&&a.translate(s.vec2.fromValues(i.x,i.y)),e.workspace_comment_db.set(a.id,a),o||e.add_top_comment(a),a.init_events(),a.events.enable(),a.events.is_enabled()&&(a.parent_block_?a.events.fire(a.change_event_factory("comment",{block:a.parent_block_,old_value:void 0,new_value:a.id})):a.events.fire(a.create_event_factory({block:a}))),a.workspace.set_resizes_enabled(_),a}return(0,i.__extends)(e,t),e.prototype.get_icon=function(){return this.svg_icon},e.prototype.get_text=function(){return this.text_},e.prototype.set_text=function(t){var e;this.text_!=t&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_text",{block:this,old_value:this.text_,new_value:t})),this.text_=t),e&&this.events.fire(e),this.comment_bubble.update_bubble("edit",this)},e.prototype.init_svg=function(t){var e,o,i=this;if(this.parent_block_){var r=(0,d.get_outer_block)(this.parent_block_);this.base_block=r;var s=(0,d.get_nested_blocks_with_comment)(r),a=s[0];if(a!==this.parent_block_)return null!=(e=null==a?void 0:a.comment)&&e.init_svg(!0),void(this.svg_icon||(this.svg_icon=(0,c.create_svg_element)("g",{},this.svg_group),this.reposition()));s.forEach(function(t){var e;t!==i.parent_block_&&t.comment&&t.comment.rendered&&(t.comment.rendered=!1,null!=(e=i.workspace.get_canvas())&&e.removeChild(t.comment.svg_group))}),this.svg_icon&&this.svg_group.removeChild(this.svg_icon),this.svg_icon=(0,c.create_svg_element)("g",{},this.svg_group);for(var _=s.length>this.icon_limit?this.icon_limit-1:s.length-1,l=_;l>=0;l--){var h=s[l],u=(0,c.create_svg_element)("g",{class:"blocklySimplifiedCommentIcon"},this.svg_icon);this.draw_icon(u,h.get_colour().toString());var p=this.icon_offset*(_-l);u.setAttribute("transform","translate("+(this.left_top_offset[0]-p)+", "+this.left_top_offset[1]+")")}if(this.events.bind_event_with_checks(this.svg_icon,"mouseup",this,this.on_icon_click),this.reposition(),this.rendered=!0,null!=(o=this.workspace.get_canvas())&&o.appendChild(this.svg_group),this.update_visibility(),this.events.is_record_undo()&&this.events.is_enabled()&&!t&&1===this.svg_icon.childElementCount){var f=this.svg_icon.firstElementChild;f.style.opacity="0",setTimeout(this.comment_bubble.animate_once.bind(this,f,"createCommentAnimation",function(){f.style.opacity=""}))}}},e.prototype.draw_icon=function(t,e){e=e||"#608FEE",(0,c.create_svg_element)("rect",{width:this.icon_size,height:this.icon_size,fill:"none",stroke:"none"},t),(0,c.create_svg_element)("path",{d:"M10,4 L20,4 C24.418278,4 28,7.581722 28,12 L28,21 L28,21 L30.2365586,27.7096759 C30.4112064,28.2336192 30.1280464,28.7999392 29.6041031,28.974587 C29.3524967,29.0584558 29.0778786,29.0389393 28.8406617,28.9203309 L19,24 L19,24 L10,24 C5.581722,24 2,20.418278 2,16 L2,12 C2,7.581722 5.581722,4 10,4 Z",fill:e},t),(0,c.create_svg_element)("circle",{fill:"#fff",cx:8,cy:14,r:2},t),(0,c.create_svg_element)("circle",{fill:"#fff",cx:15,cy:14,r:2},t),(0,c.create_svg_element)("circle",{fill:"#fff",cx:22,cy:14,r:2},t),t.setAttribute("filter","url(#"+u.FILTER.SURROUND_SHADOW_DARK+")"),t.setAttribute("transform-origin",this.icon_size+" "+this.icon_size)},e.prototype.reposition=function(){var t=this.base_block||this.parent_block_;if(t&&t.rendered){var e=this.h_distance-this.icon_size/2;t.is_starting_block()&&(e-=22),this.relative_position_=s.vec2.fromValues(e,t.first_row_height/2);var o=t.get_relative_to_surface_xy();this.translate(s.vec2.add(o,o,this.relative_position_))}},e.prototype.show_editor=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,this.workspace.show_external_comment_editor(this.text_)];case 1:return void 0!=(t=e.sent())&&this.set_text(t),[2]}})})},e.prototype.focus=function(){this.show_editor()},e.prototype.on_icon_click=function(t){this.workspace.is_dragging()||this.utils.is_right_button(t)||this.comment_bubble.popup(this)},e.prototype.get_bounding_rectangle=function(){var e=t.prototype.get_bounding_rectangle.call(this),o=e.topLeft,i=e.bottomRight;return{topLeft:s.vec2.add(s.vec2.create(),o,this.left_top_offset),bottomRight:s.vec2.add(s.vec2.create(),i,this.left_top_offset)}},e.prototype.get_parent_block=function(){return this.parent_block_},e.prototype.get_top_parent=function(){return this.get_root_block()||this},e.prototype.get_root_block=function(){for(var t=this.parent_block_;null==t?void 0:t.parent_block;)t=t.parent_block;return t},e.prototype.dispose=function(){var e,o=this;this.comment_bubble.update_bubble("remove",this),this.events.is_enabled()&&(e=this.parent_block_?this.change_event_factory("comment",{block:this.parent_block_,old_value:this.xml.comment_to_dom_with_xy(this),new_value:void 0}):this.delete_event_factory({block:this})),this.workspace.workspace_comment_db.delete(this.id),this.parent_block_||this.workspace.remove_top_comment(this),t.prototype.dispose.call(this),this.events.fire(e),setTimeout(function(){if(o.parent_block_){var t=(0,d.get_outer_block)(o.parent_block_),e=(0,d.get_nested_blocks_with_comment)(t)[0];e&&e.comment&&e.rendered&&e.comment.init_svg(!0)}})},e.prototype.show_context_menu=function(t){},e.prototype.on_mouse_down=function(e){this.parent_block_||t.prototype.on_mouse_down.call(this,e)},e.prototype.sort=function(t){if(this.rendered){var e=this.get_relative_to_surface_xy(),o=s.vec2.fromValues(t[0]+this.icon_size/2,t[1]+this.icon_size/2);this.move_by(s.vec2.sub(e,o,e)),s.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])}},e.prototype.get_bubble_size=function(){return{width:this.bubble_width_,height:this.bubble_height_}},e.prototype.set_bubble_size=function(t,e){this.bubble_width_=t,this.bubble_height_=e},e.prototype.is_auto_layout=function(){return this.auto_layout_},e.prototype.set_auto_layout=function(t){this.auto_layout_=t},e.prototype.get_relative_position=function(){return this.parent_block_?this.relative_position_:this.location_},e.prototype.set_relative_position=function(t){this.relative_position_=t},e.prototype.set_expanded=function(t){this.expanded_=t},e.prototype.is_expanded=function(){return this.expanded_},e.prototype.update_visibility=function(){if(this.parent_block_){var t=this.parent_block_;(0,l.is_block_svg)(t)&&(t=t.get_root_block());var e=t.get_visibility();(0,c.update_visibility_class)(this.svg_group,e)}},e.prototype.get_color_theme=function(){return this.color_theme},e.prototype.set_color_theme=function(t){t!==this.color_theme&&(this.color_theme=t)},e.prototype.get_colour=function(){return _.THEME_COLOR_MAP[this.color_theme]},e.prototype.draw_line=function(){},e.prototype.cancel_operation=function(){},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.SimplifiedCommentBubble)],e.prototype,"comment_bubble",void 0),(0,i.__decorate)([(0,r.injectable)()],e)}(o(31728).WorkspaceElement)},40208(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Options=void 0;var i=o(31635),r=o(71519),s=o(86295),a=o(84728),_=o(62879),c=o(68865),l=o(35009);e.Options=function(){function t(t){this.disabledPatternId="",this.embossFilterId="",this.pinch=void 0,this.notch=void 0,this.degrade_translate=void 0,this.tooltip=void 0,this.timer=void 0,this.toolbox_background_class=void 0,this.in_flyout=!1;var e,o,i,r,s,a,h,d,u,p,f,g,v=!!t.readOnly,b=!1;v?(b=!1,e=!1,o=!1,i=!1,r=!1):(t.toolbox&&(b=(s="string"==typeof t.toolbox?(0,_.get_instance)().get(c.BINDING.xml).text_to_dom(t.toolbox):t.toolbox)instanceof Element?!(!s||!s.getElementsByTagName("category").length):s.length>0),void 0==(e=t.collapse)&&(e=b),void 0==(o=t.comments)&&(o=b),void 0==(i=t.disable)&&(i=b),r=void 0==t.sounds||t.sounds);var m=!!t.rtl,y=t.horizontalLayout;if(void 0==y&&(y=!1),"number"==typeof t.toolboxPosition)a=t.toolboxPosition;else{var k="end"!==t.toolboxPosition;a=y?k?l.TOOLBOX_POSITION.TOP:l.TOOLBOX_POSITION.BOTTOM:k===m?l.TOOLBOX_POSITION.RIGHT:l.TOOLBOX_POSITION.LEFT}void 0!==t.scrollbars?(h=t.scrollbars,d=t.scrollbars,u=t.scrollbars,p=t.scrollbars):(void 0==(h=t.scrollable?t.scrollable.workspace:void 0)&&(h=b),void 0==(d=t.scrollable?t.scrollable.flyout:void 0)&&(d=b),void 0==(u=t.show_scrollbars?t.show_scrollbars.workspace:void 0)&&(u=b),void 0==(p=t.show_scrollbars?t.show_scrollbars.flyout:void 0)&&(p=b));var w=t.css;void 0==w&&(w=!0);var E="https://static.codemao.cn/blockly/media/";t.media&&(E=t.media),f=void 0==t.oneBasedIndex||!!t.oneBasedIndex,g=void 0!=t.blockly_type?t.blockly_type:"default",this.RTL=m,this.oneBasedIndex=f,this.collapse=e,this.comments=o,this.comment_type=t.comment_type||"normal",this.disable=i,this.readOnly=v,this.maxBlocks=t.maxBlocks||1/0,this.pathToMedia=E,this.has_categories=b,this.ws_scrollable=h,this.ws_show_scrollbars=u,this.flyout_scrollable=d,this.flyout_show_scrollbars=p,this.hasSounds=r,this.hasCss=w,this.horizontalLayout=y,this.toolbox_config=s,this.gridOptions=this.parse_grid_options(t),this.zoomOptions=this.parse_zoom_options(t),this.toolboxPosition=a,this.blockly_type=g,this.connection_effect=this.parse_connection_effect_options(t),this.field_max_length=t.field_max_length,this.pinch=t.pinch,this.notch=t.notch,this.degrade_translate=t.degrade_translate,this.tooltip=t.tooltip,this.timer=t.timer,this.toolbox_background_class=t.toolbox_background_class,this.id=t.id,this.flyout=this.parse_flyout_options(t.flyout),this.custom_svg_defs=t.custom_svg_defs,this.delete_area_margin=this.parse_delete_area_margin(t,a),this.workspace={content_margin:t.workspace&&t.workspace.content_margin||"50%"},this.theme="string"==typeof t.theme?t.theme:"light",this.dropdown=this.parse_dropdown_options(t),this.delete_area=t.delete_area||"default",this.block_group=this.parse_block_group_options(t),this.auto_resize=this.parse_auto_resize_options(t),this.context_menu=this.parse_context_menu_options(t)}return t.prototype.parse_zoom_options=function(t){var e=t.zoom||{};return{controls:void 0!=e.controls&&e.controls,wheel:void 0!=e.wheel&&e.wheel,startScale:void 0==e.startScale?1:e.startScale,maxScale:void 0==e.maxScale?3:e.maxScale,minScale:void 0==e.minScale?.3:e.minScale,scaleSpeed:void 0==e.scaleSpeed?1.2:e.scaleSpeed}},t.prototype.parse_grid_options=function(t){var e=t.grid||{};return{spacing:e.spacing||35,step:void 0===e.step?4:e.step,snap:!!e.spacing&&!!e.snap}},t.prototype.parse_connection_effect_options=function(t){if(t.connection_effect){var e=t.connection_effect||{};return{type:e.type,color:e.color}}},t.prototype.parse_dropdown_options=function(t){var e=t.dropdown&&t.dropdown.menu||{},o=t.dropdown||{};return{padding:"number"==typeof o.padding?o.padding:6,arrow_type:o.arrow_type||"line",menu:{align:e.align||(a.is.mobile()||a.is.ipad()?"center":"first"),scalable:"boolean"!=typeof e.scalable||e.scalable}}},t.prototype.parse_delete_area_margin=function(t,e){var o=t.delete_area_margin;return Array.isArray(o)?o:(void 0===o&&(o=1e7),e===l.TOOLBOX_POSITION.LEFT?[o,0,o,o]:e===l.TOOLBOX_POSITION.TOP?[o,o,0,o]:e===l.TOOLBOX_POSITION.RIGHT?[o,o,o,0]:[0,o,o,o])},t.prototype.parse_flyout_options=function(t){return(0,s.parse_attr_deep)({auto_close:!0,fixed_width:void 0,min_width:void 0,max_width:void 0,corner_radius:0,padding:{top:15,bottom:20,left:30,right:30},blocks:{default_gap:16,head_block_offset:[0,0]}},t)},t.prototype.parse_block_group_options=function(t){if(t.block_group)return!0===t.block_group?{}:t.block_group},t.prototype.parse_auto_resize_options=function(t){if(t.auto_resize)return!0===t.auto_resize?{delay:0}:t.auto_resize},t.prototype.parse_context_menu_options=function(t){var e,o,i=[l.WorkspaceOptionType.PASTE,l.WorkspaceOptionType.CLEAN_UP,l.WorkspaceOptionType.DELETE_ALL,l.WorkspaceOptionType.COPY_ALL,l.WorkspaceOptionType.GLOBAL_COMMENT],r=[l.BlockOptionType.COPY_AND_PASTE,l.BlockOptionType.COPY,l.BlockOptionType.ADD_COMMENT,l.BlockOptionType.COLLAPSE,l.BlockOptionType.DELETE,l.BlockOptionType.SET_GROUP];return{workspace:(null==(e=t.context_menu)?void 0:e.workspace)||i,block:(null==(o=t.context_menu)?void 0:o.block)||r}},(0,i.__decorate)([(0,r.injectable)()],t)}()},98207(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ScrollbarPair=e.Scrollbar=void 0;var i=o(31635),r=o(71519),s=o(77276),a=o(36963),_=o(35009),c=o(25507),l=function(){var t;function e(e,o,i,r,a){void 0===i&&(i=!1),void 0===r&&(r=""),void 0===a&&(a=!0),this.origin_=s.vec2.create(),this.size_ratio_=0,this.start_drag_handle=0,this.handle_position_=0,this.start_drag_mouse=0,this.handle_length_=0,this.scroll_view_size_=0,this.scroll_content_size_=0,this.container_visible_=!0,this.is_visible_=!0,this.workspace_=e,this.pair_=i||!1,this.horizontal_=o,this.old_host_metrics_=void 0;var _="blocklyScrollbar"+(this.horizontal_?"Horizontal":"Vertical");r&&(_+=" "+r),this.outer_svg_=(0,c.create_svg_element)("svg",{class:_}),this.svg_group=(0,c.create_svg_element)("g",{},this.outer_svg_),this.svg_background_=(0,c.create_svg_element)("rect",{class:"blocklyScrollbarBackground"},this.svg_group);var l=Math.floor((t.scrollbar_thickness-5)/2);this.svg_handle_=(0,c.create_svg_element)("rect",{class:"blocklyScrollbarHandle",rx:l,ry:l},this.svg_group),o?(this.svg_background_.setAttribute("height",t.scrollbar_thickness.toString()),this.outer_svg_.setAttribute("height",t.scrollbar_thickness.toString()),this.svg_handle_.setAttribute("height",(t.scrollbar_thickness-9).toString()),this.svg_handle_.setAttribute("y","5"),this.length_attribute_="width",this.position_attribute_="x"):(this.svg_background_.setAttribute("width",t.scrollbar_thickness.toString()),this.outer_svg_.setAttribute("width",t.scrollbar_thickness.toString()),this.svg_handle_.setAttribute("width",(t.scrollbar_thickness-9).toString()),this.svg_handle_.setAttribute("x","5"),this.length_attribute_="height",this.position_attribute_="y"),(0,c.insert_after)(this.outer_svg_,this.workspace_.get_parent_svg()),this.on_mouse_down_bar_wrapper_=this.events.bind_event_with_checks(this.svg_background_,"mousedown",this,this.on_mouse_down_bar),this.on_mouse_down_handle_wrapper_=this.events.bind_event_with_checks(this.svg_handle_,"mousedown",this,this.on_mousedown_handle),this.position_=s.vec2.fromValues(0,0),this.opt_visible=a,a||this.update_display()}return t=e,e.prototype.resize_view=function(e){var o=this.horizontal_?e.viewWidth-1:e.viewHeight-1;this.pair_&&(o-=t.scrollbar_thickness),this.set_scroll_view_size(Math.max(0,o));var i=e.absoluteLeft+.5,r=e.absoluteTop+.5;this.horizontal_?r+=e.viewHeight-t.scrollbar_thickness-1:i+=e.viewWidth-t.scrollbar_thickness-1,this.set_position(i,r),this.resize_content(e)},e.prototype.resize_content=function(t){this.scroll_content_size_=this.horizontal_?t.contentWidth:t.contentHeight,this.pair_||this.set_visible(this.scroll_view_size_<this.scroll_content_size_),this.size_ratio_=this.scroll_view_size_/this.scroll_content_size_,(this.size_ratio_==-1/0||this.size_ratio_==1/0||isNaN(this.size_ratio_))&&(this.size_ratio_=0);var e,o=this.scroll_view_size_*this.size_ratio_;this.set_handle_length(Math.max(0,o));var i={};this.horizontal_?(i.x=this.constrain_target_pos(t.viewLeft-t.contentLeft),this.set_handle_position(i.x*this.size_ratio_)):(i.y=this.constrain_target_pos(t.viewTop-t.contentTop),this.set_handle_position(i.y*this.size_ratio_)),null!=(e=this.workspace_)&&e.set_metrics(i)},e.prototype.set_handle_length=function(t){var e;this.handle_length_=t,null!=(e=this.svg_handle_)&&e.setAttribute(this.length_attribute_,String(this.handle_length_))},e.prototype.set_visible=function(t){var e=t!=this.is_visible();if(this.pair_)throw Error("Unable to toggle visibility of paired scrollbars.");this.is_visible_=t,e&&this.update_display()},e.prototype.set_position=function(t,e){if(this.outer_svg_){this.position_[0]=t,this.position_[1]=e;var o="translate("+(this.position_[0]+this.origin_[0])+"px, "+(this.position_[1]+this.origin_[1])+"px)";(0,c.set_css_transform)(this.outer_svg_,o)}},e.prototype.set_scroll_view_size=function(t){var e,o;this.scroll_view_size_=t,null!=(e=this.outer_svg_)&&e.setAttribute(this.length_attribute_,String(this.scroll_view_size_)),null!=(o=this.svg_background_)&&o.setAttribute(this.length_attribute_,String(this.scroll_view_size_))},e.prototype.dispose=function(){this.clean_up(),this.on_mouse_down_bar_wrapper_&&(this.events.unbind_event(this.on_mouse_down_bar_wrapper_),this.on_mouse_down_bar_wrapper_=void 0),this.on_mouse_down_handle_wrapper_&&(this.events.unbind_event(this.on_mouse_down_handle_wrapper_),this.on_mouse_down_handle_wrapper_=void 0),this.outer_svg_&&(0,c.remove_node)(this.outer_svg_),delete this.outer_svg_,delete this.svg_group,delete this.svg_background_,delete this.svg_handle_,delete this.workspace_},e.prototype.metrics_are_equivalent=function(t,e){return!(!t||!e)&&t.viewWidth==e.viewWidth&&t.viewHeight==e.viewHeight&&t.viewLeft==e.viewLeft&&t.viewTop==e.viewTop&&t.absoluteTop==e.absoluteTop&&t.absoluteLeft==e.absoluteLeft&&t.contentWidth==e.contentWidth&&t.contentHeight==e.contentHeight&&t.contentLeft==e.contentLeft&&t.contentTop==e.contentTop},e.prototype.set_origin=function(t){this.origin_=t},e.prototype.is_visible=function(){return this.is_visible_},e.prototype.set_container_visible=function(t){var e=t!=this.container_visible_;this.container_visible_=t,e&&this.update_display()},e.prototype.update_display=function(){if(void 0==this.outer_svg_)throw Error("outerSvg_ is undefined");this.opt_visible&&this.is_visible()&&this.container_visible_?this.outer_svg_.setAttribute("display","block"):this.outer_svg_.setAttribute("display","none")},e.prototype.on_mouse_move_handle=function(t){var e=(this.horizontal_?t.clientX:t.clientY)-this.start_drag_mouse,o=(this.start_drag_handle+e)/this.size_ratio_;this.set(o)},e.prototype.on_mouse_up_handle=function(){var t;null!=(t=this.workspace_)&&t.reset_drag_surface(),this.touch_manager.clear_touch_identifier(),this.clean_up()},e.prototype.on_mousedown_handle=function(e){var o,i;null!=(o=this.workspace_)&&o.mark_focused(),this.clean_up(),this.utils.is_right_button(e)?e.stopPropagation():(this.start_drag_handle=this.handle_position_,null!=(i=this.workspace_)&&i.setup_drag_surface(),this.start_drag_mouse=this.horizontal_?e.clientX:e.clientY,t.on_mouse_up_wrapper_=this.events.bind_event_with_checks(document,"mouseup",this,this.on_mouse_up_handle),t.on_mouse_move_wrapper_=this.events.bind_event_with_checks(document,"mousemove",this,this.on_mouse_move_handle),e.stopPropagation(),e.preventDefault())},e.prototype.clean_up=function(){this.utils.hide_chaff(!0),t.on_mouse_up_wrapper_&&(this.events.unbind_event(t.on_mouse_up_wrapper_),t.on_mouse_up_wrapper_=void 0),t.on_mouse_move_wrapper_&&(this.events.unbind_event(t.on_mouse_move_wrapper_),t.on_mouse_move_wrapper_=void 0)},e.prototype.on_mouse_down_bar=function(t){if(!this.workspace_||!this.svg_handle_)throw Error("this.workspace_ is undefined");if(this.workspace_.mark_focused(),this.touch_manager.clear_touch_identifier(),this.clean_up(),this.utils.is_right_button(t))t.stopPropagation();else{var e=this.utils.mouse_to_svg(t,this.workspace_.get_parent_svg(),this.workspace_.get_inverse_screen_ctm()),o=this.horizontal_?e.x:e.y,i=this.utils.get_injection_div_xy(this.svg_handle_),r=this.horizontal_?i[0]:i[1],s=this.handle_position_,a=.95*this.handle_length_;o<=r?s-=a:o>=r+this.handle_length_&&(s+=a);var _=s/this.size_ratio_;this.set(_),t.stopPropagation(),t.preventDefault()}},e.prototype.set_handle_position=function(t){this.svg_handle_&&(this.handle_position_=t,"y"==this.position_attribute_?(0,c.set_css_transform)(this.svg_handle_,"translate3d(0px, "+this.handle_position_+"px, 0px)"):"x"==this.position_attribute_&&(0,c.set_css_transform)(this.svg_handle_,"translate3d("+this.handle_position_+"px, 0px, 0px)"))},e.prototype.constrain_target_pos=function(t){return Math.max(0,Math.min(t,this.scroll_content_size_-this.scroll_view_size_))},e.prototype.set=function(t){if(this.workspace_){var e=this.workspace_.content_offset_by_view[+!this.horizontal_];if((t=this.constrain_target_pos(t))!==e){this.set_handle_position(t*this.size_ratio_);var o={};this.horizontal_?o.x=t:o.y=t,this.workspace_.set_metrics(o);var i=this.horizontal_?_.UIEventType.H_SCROLLBAR_SET:_.UIEventType.V_SCROLLBAR_SET;this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:i,workspace_id:this.workspace_.id,old_value:e,new_value:t}))}}},e.prototype.set_block_offset_by_view=function(t){if(this.workspace_){var e=this.workspace_.content_offset_by_view[+!this.horizontal_],o={},i=this.workspace_.get_metrics();if(this.horizontal_?o.x=t=this.constrain_target_pos(-i.contentLeft-t):o.y=t=this.constrain_target_pos(-i.contentTop-t),t!==e){this.workspace_.set_metrics(o);var r=this.workspace_.content_offset_by_view;this.horizontal_?this.set_handle_position(r[0]*this.size_ratio_):this.set_handle_position(r[1]*this.size_ratio_);var s=this.horizontal_?_.UIEventType.H_SCROLLBAR_SET:_.UIEventType.V_SCROLLBAR_SET;this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s,workspace_id:this.workspace_.id,old_value:e,new_value:t}))}}},e.prototype.resize=function(t){if(this.workspace_){var e=t||this.workspace_.get_metrics();e&&e.viewWidth&&e.viewHeight&&!(this.old_host_metrics_&&this.metrics_are_equivalent(e,this.old_host_metrics_))&&(this.old_host_metrics_=e,this.resize_view(e))}},e.scrollbar_thickness=15,(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],e.prototype,"utils",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.UIEvent)],e.prototype,"ui_event_factory",void 0),t=(0,i.__decorate)([(0,r.injectable)()],e)}();e.Scrollbar=l,e.ScrollbarPair=function(){function t(t,e){void 0===e&&(e=!0),this.old_host_metrics_=void 0,this.workspace_=t,this.h_scroll=new l(t,!0,!0,"blocklyMainWorkspaceScrollbar",e),this.v_scroll=new l(t,!1,!0,"blocklyMainWorkspaceScrollbar",e)}return t.prototype.set_container_visible=function(t){var e,o;null!=(e=this.h_scroll)&&e.set_container_visible(t),null!=(o=this.v_scroll)&&o.set_container_visible(t)},t.prototype.dispose=function(){var t,e;delete this.workspace_,this.old_host_metrics_=void 0,null!=(t=this.h_scroll)&&t.dispose(),delete this.h_scroll,null!=(e=this.v_scroll)&&e.dispose(),delete this.v_scroll},t.prototype.resize=function(){if(this.workspace_){var t,e,o=this.workspace_.get_metrics();if(o){var i=!1,r=!1;this.old_host_metrics_&&this.old_host_metrics_.viewWidth==o.viewWidth&&this.old_host_metrics_.viewHeight==o.viewHeight&&this.old_host_metrics_.absoluteTop==o.absoluteTop&&this.old_host_metrics_.absoluteLeft==o.absoluteLeft?(this.old_host_metrics_&&this.old_host_metrics_.contentWidth==o.contentWidth&&this.old_host_metrics_.viewLeft==o.viewLeft&&this.old_host_metrics_.contentLeft==o.contentLeft||(i=!0),this.old_host_metrics_&&this.old_host_metrics_.contentHeight==o.contentHeight&&this.old_host_metrics_.viewTop==o.viewTop&&this.old_host_metrics_.contentTop==o.contentTop||(r=!0)):(i=!0,r=!0),i&&null!=(t=this.h_scroll)&&t.resize(o),r&&null!=(e=this.v_scroll)&&e.resize(o),this.old_host_metrics_=o}}},t.prototype.set=function(t,e){if(this.h_scroll&&this.v_scroll&&this.workspace_){var o=this.workspace_.content_offset_by_view,i={x:this.h_scroll.constrain_target_pos(t),y:this.v_scroll.constrain_target_pos(e)};(i.x!==o[0]||i.y!==o[1])&&(this.workspace_.set_metrics(i),this.h_scroll.set_handle_position(i.x*this.h_scroll.size_ratio_),this.v_scroll.set_handle_position(i.y*this.v_scroll.size_ratio_),this.events.is_enabled()&&(this.events.fire(this.ui_event_factory({type:_.UIEventType.H_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[0],new_value:i.x})),this.events.fire(this.ui_event_factory({type:_.UIEventType.V_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[1],new_value:i.y}))))}},t.prototype.set_block_offset_by_view=function(t,e){if(this.h_scroll&&this.v_scroll&&this.workspace_){var o=this.workspace_.content_offset_by_view,i=this.workspace_.get_metrics(),r={x:this.h_scroll.constrain_target_pos(-i.contentLeft-t),y:this.v_scroll.constrain_target_pos(-i.contentTop-e)};(r.x!==o[0]||r.y!==o[1])&&(this.workspace_.set_metrics(r),this.h_scroll.set_handle_position(r.x*this.h_scroll.size_ratio_),this.v_scroll.set_handle_position(r.y*this.v_scroll.size_ratio_),this.events.is_enabled()&&(this.events.fire(this.ui_event_factory({type:_.UIEventType.H_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[0],new_value:r.x})),this.events.fire(this.ui_event_factory({type:_.UIEventType.V_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[1],new_value:r.y}))))}},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,r.injectable)()],t)}()},38842(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BLINK_CSS_CONTENT=void 0,e.BLINK_CSS_CONTENT='.blocklyText{cursor:default;fill:#fff;pointer-events:none}.blocklyEditable .blocklyText{fill:#333}.blocklyEditable .blocklyTextDefault{fill:rgba(51,51,51,.4)}.dark .blocklyEditable .blocklyText{fill:#fff}.blockly_head_icon_wrapper{stroke-dasharray:97;stroke-dashoffset:158;stroke-linecap:round;stroke-width:1px}.blocklyDisabled .blocklyFieldDropdownNonShadow>g,.blocklyDisabled>.blocklyEditableTextBlack>g:not(.b-text-group){fill:#abafb6!important}.blocklyDisabled>.blocklyEditableTextBlack>rect,.blocklyDisabled>.blocklyFieldDropdownNonShadow>rect,.blocklyDisabled>path{stroke:#9399a4}.blocklyDisabled .blocklyDropdownArrow,.blocklyDisabled>.blocklyEditableTextBlack>.dropdown_element>path{fill:#686d76!important}.blocklyDisabled .blockly_head_icon_wrapper{fill:#abafb6!important;stroke:#9399a4!important}.InsertionMarker>.blocklyPath{stroke:none}.blocklyDraggable .output-block-hover:hover>path{stroke:#fff;stroke-width:2px}.blocklySurroundShadow{fill:transparent;stroke:#fff;stroke-width:2px;pointer-events:none}.blocklyBlockDisposeWrapper{position:absolute}.blocklyBlockDisposeWrapper .blocklyBlockDispose{-webkit-animation:dispose 150ms linear forwards;animation:dispose 150ms linear forwards}@-webkit-keyframes dispose{from{transform:scale(1)}to{transform:scale(0)}}@keyframes dispose{from{transform:scale(1)}to{transform:scale(0)}}.blocklyBlockTranslucent{opacity:.5}.blocklyBlockHidden{opacity:0;pointer-events:none}.blocklyBlockUnOperable{pointer-events:none}.blocklyStackGlow{-webkit-filter:url(#blocklySelectedFilter);filter:url(#blocklySelectedFilter)}.procedures_2_defnoreturn>.blocklyEditable text,.procedures_2_parameter>.blocklyEditable .blocklyText,.procedures_2_stable_parameter>.blocklyEditable .blocklyText{fill:#fff}.procedures_2_stable_parameter>.blocklyText:nth-child(3){fill:rgba(255,255,255,.5)}.procedures_2_defnoreturn>.blocklyEditable>rect{stroke:rgba(194,106,81,.5)}.procedures_2_parameter>.blocklyEditable>rect,.procedures_2_stable_parameter>.blocklyEditable>rect{display:none}.decoration_for_collapsed_blocks{pointer-events:none}.blocklyDraggable>.blocklyFieldTextInput>rect{fill:rgba(0,0,0,.1);cursor:default}.blocklyDraggable>.blocklyFieldTextInput .blocklyText{fill:#fff}.blocklyDraggable>.blocklyFieldTextInput .blocklyTextDefault{fill:rgba(255,255,255,.4)}.color_selector{width:112px}.color_selector_item{float:left;width:16px;height:16px;box-shadow:inset 0 0 0 1px #666}.color_selector_item:hover{box-shadow:inset 0 0 0 1px #fff}.blocklyFieldDropdown>rect,.blocklyShadowDropdown>path{cursor:pointer;fill:#fff;fill-opacity:.6}.blocklyFieldDropdown>rect:hover,.blocklyShadowDropdown>path:hover{fill-opacity:.8}.blocklyFieldDropdown[data-showing=true]>rect,.blocklyShadowDropdown[data-showing=true]>path{cursor:pointer;fill:#000;fill-opacity:.1}.blocklyShadow .blocklyFieldDropdown>rect{opacity:0;pointer-events:none}.dark .blocklyFieldDropdown>rect,.dark .blocklyShadowDropdown>path{cursor:pointer;fill:#fff;fill-opacity:.15;stroke:rgba(0,0,0,.15)}.dark .blocklyFieldDropdown>rect:hover,.dark .blocklyShadowDropdown>path:hover{fill-opacity:.3}.dark .blocklyShadowDropdown>path{fill:#000;fill-opacity:.1}.dark .blocklyFieldDropdown[data-showing=true]>rect,.dark .blocklyShadowDropdown[data-showing=true]>path{cursor:pointer;fill:#fff;fill-opacity:1;-webkit-filter:url(#blur-1px);filter:url(#blur-1px)}.dark :not(.blocklyShadowDropdown)>.blocklyFieldDropdown>.blocklyDropdownArrow{fill:#000!important;fill-opacity:.15}.dark .blocklyFieldDropdown[data-showing=true] .blocklyDropdownArrow,.dark .blocklyShadowDropdown[data-showing=true] .blocklyDropdownArrow{opacity:0}.dark .blocklyFieldDropdown[data-showing=true] .blocklyText,.dark .blocklyShadowDropdown[data-showing=true] .blocklyText{fill:#333}.blocklyQuote{fill:#333;opacity:.5}.dark .blocklyShadow>path{fill:#000;fill-opacity:.1;stroke:none}.dark .blocklyQuote{fill:#fff;opacity:1}.fieldButton{cursor:pointer}.fieldButton:hover>rect{fill:rgba(255,255,255,.4)}.dropdown_element{cursor:pointer}.blocklyPlusSign{background:center/contain no-repeat url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU1LjEgKDc4MTM2KSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT5pY24vYWRkX2JsYWNrPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Imljbi9hZGRfYmxhY2siIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJpY25fYWRkX2JsYWNrIj4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgeD0iMCIgeT0iMCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIj48L3JlY3Q+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik01LDUgTDUsMiBDNSwxLjQ0NzcxNTI1IDUuNDQ3NzE1MjUsMSA2LDEgQzYuNTUyMjg0NzUsMSA3LDEuNDQ3NzE1MjUgNywyIEw3LDUgTDEwLDUgQzEwLjU1MjI4NDcsNSAxMSw1LjQ0NzcxNTI1IDExLDYgQzExLDYuNTUyMjg0NzUgMTAuNTUyMjg0Nyw3IDEwLDcgTDcsNyBMNywxMCBDNywxMC41NTIyODQ3IDYuNTUyMjg0NzUsMTEgNiwxMSBDNS40NDc3MTUyNSwxMSA1LDEwLjU1MjI4NDcgNSwxMCBMNSw3IEwyLDcgQzEuNDQ3NzE1MjUsNyAxLDYuNTUyMjg0NzUgMSw2IEMxLDUuNDQ3NzE1MjUgMS40NDc3MTUyNSw1IDIsNSBMNSw1IFoiIGlkPSJDb21iaW5lZC1TaGFwZSIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+);opacity:.15}.blocklyCommentGroup .blocklyCommentShape{stroke:#fff;stroke-width:2px}.blocklyCommentSymbol{fill:#fff}.blocklyCommentLine{stroke-width:2px;stroke-linecap:round;stroke-dasharray:4 6}.blocklyCommentBubble{border-radius:2px;position:relative;box-sizing:border-box}.blocklyCommentBubble .blocklyCommentTopContainer{width:100%;height:calc(100% - 8px);display:flex}.blocklyCommentBubble .blocklyCommentTopContainer .blocklyCommentMainContainer{width:calc(100% - 4px);height:100%}.blocklyCommentBubble .blocklyCommentBottomContainer{width:100%;height:4px;display:flex}@-webkit-keyframes borderEaseOut{from{margin-left:0}to{margin-left:100%}}@keyframes borderEaseOut{from{margin-left:0}to{margin-left:100%}}.blocklyCommentBorder{-webkit-animation:borderEaseOut .2s forwards ease-out;animation:borderEaseOut .2s forwards ease-out}.blockCommentEmptyBorder{height:4px;width:100%;background-color:transparent}.blocklyCommentBubbleLabel{height:32px;width:100%;display:flex;align-items:center;justify-content:space-between;padding:0 7px 0 12px}.blocklyCommentBubbleLabel .blocklyCommentBubbleIcon{margin-right:8px}.blocklyCommentBubbleLabel div{display:flex;align-items:center;font-size:12px;font-weight:400;color:#8c8c8c;line-height:12px}.blocklyCommentBubbleLabel .blocklyCommentBubbleClose{justify-self:end;fill:rgba(0,0,0,.2);cursor:pointer}.blocklyCommentTextarea{background-color:transparent;border:0;padding:0;resize:none;outline:0;font-size:14px;font-weight:400;color:#333;cursor:text;overflow:hidden;margin:8px 16px 0 12px;height:calc(100% - 44px);width:calc(100% - 28px)}.blocklyCommentTextarea::-webkit-input-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea::-moz-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea:-ms-input-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea::placeholder{color:rgba(0,0,0,.3)}.blocklyCommentEWResize{cursor:ew-resize;width:4px;height:100%}.blocklyCommentNSResize{cursor:ns-resize;height:100%;width:calc(100% - 4px)}.blocklyCommentNWSEResize{cursor:nwse-resize;width:4px;height:4px}.createCommentAnimation{-webkit-animation:createComment .3s cubic-bezier(.34,1.56,.64,1);animation:createComment .3s cubic-bezier(.34,1.56,.64,1)}@-webkit-keyframes createComment{from{opacity:0;transform:scale(.4) rotate(-60deg) translate(-16px,-16px)}to{opacity:.4;transform:scale(1) rotate(0) translate(-16px,-16px)}}@keyframes createComment{from{opacity:0;transform:scale(.4) rotate(-60deg) translate(-16px,-16px)}to{opacity:.4;transform:scale(1) rotate(0) translate(-16px,-16px)}}.blocklySimplifiedCommentIcon[data-showing=true]>path{stroke:#fff;stroke-width:2px}.blocklySimplifiedCommentBubble{position:fixed;bottom:16px;left:0;right:0;margin:0 78px 0 24px;min-height:64px;max-height:148px;background-color:rgba(15,11,48,.95);border-radius:32px;display:flex;flex-direction:column;justify-content:center}.blocklySimplifiedCommentBubbleCover{overflow:hidden}.blocklySimplifiedCommentBubbleCover::before{content:"";position:absolute;z-index:1;width:100%;height:8px;left:0;top:0;background-image:linear-gradient(rgba(11,8,42,.8),rgba(11,8,42,.52),rgba(11,8,42,0))}.blocklySimplifiedCommentBubbleCover::after{content:"";position:absolute;width:100%;height:8px;left:0;bottom:0;background-image:linear-gradient(rgba(11,8,42,0),rgba(11,8,42,.52),rgba(11,8,42,.8))}.blocklySimplifiedCommentBubbleContent{width:100%;background:0 0;display:flex;flex-direction:column;padding:8px 0;overflow:scroll}.blocklySimplifiedCommentBubbleContent ::-webkit-scrollbar{width:0}.blocklySimplifiedCommentBubbleContent ::-webkit-scrollbar-thumb{background:0 0}.blocklySimplifiedCommentBubbleContent :last-child .blocklySimplifiedCommentTextSeparator{display:none}.showBubbleAnimation{-webkit-animation:showBubble .2s ease-out;animation:showBubble .2s ease-out}.hideBubbleAnimation{animation:showBubble .2s ease-out reverse}@-webkit-keyframes showBubble{from{bottom:-100%}to{bottom:16px}}@keyframes showBubble{from{bottom:-100%}to{bottom:16px}}.disposeBubbleContentAnimation{-webkit-animation:disposeBubbleContent 120ms ease-out;animation:disposeBubbleContent 120ms ease-out}@-webkit-keyframes disposeBubbleContent{to{opacity:0;scale:0}}@keyframes disposeBubbleContent{to{opacity:0;scale:0}}.disposeBubbleAnimation{-webkit-animation:disposeBubble .2s ease-out;animation:disposeBubble .2s ease-out}@-webkit-keyframes disposeBubble{to{bottom:48px;height:0;margin:0 128px 0 74px}}@keyframes disposeBubble{to{bottom:48px;height:0;margin:0 128px 0 74px}}.blocklySimplifiedCommentTextWrapper{position:relative}.blocklySimplifiedCommentTextDecorator{width:2px;height:14px;border-radius:2px;position:absolute;top:11px;left:42px;opacity:1;transition:opacity 120ms ease-out,left 120ms ease-out}.blocklySimplifiedCommentTextSeparator{position:absolute;bottom:0;left:42px;right:48px;height:1px;background:#c7b7ff;opacity:.2}.blocklySimplifiedCommentTextBg{margin-left:42px;margin-right:48px;opacity:1;transition:margin-left 120ms ease-out}.blocklySimplifiedCommentTextActive{background:rgba(199,183,255,.2)}.blocklySimplifiedCommentText{color:#c7b7ff;line-height:21px;min-height:37px;padding:8px 0 8px 6px;font-size:14px;word-break:break-all;width:308px;box-sizing:border-box;opacity:1;transition:opacity 120ms ease-out}.blocklySimplifiedCommentEditButton{position:absolute;top:0;right:116px;margin:auto;width:32px;height:32px;display:none}.showEditButtonAnimation{-webkit-animation:showEditButton 120ms ease-out;animation:showEditButton 120ms ease-out}.hideEditButtonAnimation{animation:showEditButton 120ms ease-out reverse}@-webkit-keyframes showEditButton{from{right:96px;opacity:0}to{right:116px;opacity:1}}@keyframes showEditButton{from{right:96px;opacity:0}to{right:116px;opacity:1}}.blocklySimplifiedCommentRemoveButton{position:absolute;top:0;right:64px;margin:auto;width:32px;height:32px;display:none}.showRemoveButtonAnimation{-webkit-animation:showRemoveButton 120ms ease-out;animation:showRemoveButton 120ms ease-out}.hideRemoveButtonAnimation{animation:showRemoveButton 120ms ease-out reverse}@-webkit-keyframes showRemoveButton{from{right:44px;opacity:0}to{right:64px;opacity:1}}@keyframes showRemoveButton{from{right:44px;opacity:0}to{right:64px;opacity:1}}.blocklySimplifiedCommentMoreButton{position:absolute;top:0;right:12px;margin:auto;width:32px;height:32px;outline:0}.expandMoreButtonAnimation{-webkit-animation:expandMoreButton 120ms ease-out;animation:expandMoreButton 120ms ease-out}.collapseMoreButtonAnimation{animation:expandMoreButton 120ms ease-out reverse}@-webkit-keyframes expandMoreButton{from{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes expandMoreButton{from{transform:rotate(0)}to{transform:rotate(90deg)}}.injectionDiv{height:100%;width:100%;position:relative;background:#fff}.injectionDiv>*{position:absolute;left:0;top:0}.injectionDiv *{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.injectionDiv ::-webkit-scrollbar{width:0;display:none}.injectionDiv ::-webkit-scrollbar-thumb{background:0 0}.blocklySvg{overflow:hidden;position:absolute}.blocklyScrollbarHorizontal,.blocklyScrollbarVertical{position:absolute;outline:0;opacity:.3}.blocklyScrollbarHorizontal .blocklyScrollbarBackground,.blocklyScrollbarVertical .blocklyScrollbarBackground{opacity:0;position:absolute}.blocklyScrollbarHorizontal .blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarHandle{stroke:#bbb;fill:#bbb}.blocklyScrollbarHorizontal .blocklyScrollbarBackground:active+.blocklyScrollbarHandle,.blocklyScrollbarHorizontal .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,.blocklyScrollbarHorizontal .blocklyScrollbarHandle:active,.blocklyScrollbarHorizontal .blocklyScrollbarHandle:hover,.blocklyScrollbarVertical .blocklyScrollbarBackground:active+.blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarHandle:active,.blocklyScrollbarVertical .blocklyScrollbarHandle:hover{stroke-width:4}.blocklyWsDragSurface{display:none;position:absolute;overflow:visible}.blocklyFlyout{box-shadow:rgba(191,173,163,.3) 2px 0 4px 0;background:#fbfbfb;position:absolute}.blocklyFlyout .blocklyDraggable *{cursor:-webkit-grab!important;cursor:grab!important}.blocklyFlyout .blocklyDraggable .blocklyEditable *,.blocklyFlyout .blocklyDraggable .blocklyEditableTextBlack *,.blocklyFlyout .blocklyDraggable .blocklyShadow,.blocklyFlyout .blocklyDraggable .fieldButton,.blocklyFlyout .blocklyFlyoutHidden{pointer-events:none}.blocklyFlyout .blocklyFlyoutClickable,.blocklyFlyout .blocklyFlyoutClickable *{cursor:pointer}.blocklyFlyout .blocklyLine{fill:#cacaca;cursor:default}.blocklyFlyout .blocklyButtonTip{stroke:none;font-size:12px;cursor:default}.blocklyToolboxDiv{display:flex;flex-direction:column;align-items:center;overflow-x:hidden;overflow-y:auto;position:absolute;min-width:54px;background:#fbfbfb;transform:translateZ(0);height:100%;border-right:1px solid #f0f0f0}.blocklyToolboxDiv .blocklyTreeRoot{padding:0}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow{border-radius:6px;min-width:64px;min-height:50px;white-space:nowrap;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow.blocklyTreeSelected{color:#fff;background-color:#ffb388}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow *{pointer-events:none}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow .blocklyTreeIcon{max-width:36px;max-height:28px}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow .blocklyTreeLabel{line-height:14px}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeChildren{display:block;flex-direction:column;align-items:center}.blocklyBlockDragSurface{display:none;position:absolute;top:0;left:0;right:0;bottom:0;overflow:visible;-webkit-backface-visibility:hidden;backface-visibility:hidden}.blinkGridPatternOuter{stroke-opacity:.8;stroke-width:2px}.blinkGridPatternInner{stroke-opacity:.4;stroke-width:1px}.blocklyWidgetDiv{display:none;position:fixed;z-index:99999;outline:0;box-sizing:border-box}.blocklyWidgetDiv *{box-sizing:border-box}.menu-wrapper{background:#fff;box-shadow:0 1px 6px 0 rgba(0,0,0,.15);border-radius:4px;padding:4px 0;overflow-y:auto;overflow-x:hidden;margin:0;outline:0}.menu-wrapper .menu-item{position:relative;height:32px;line-height:32px;padding:0 16px;font-size:14px;font-weight:400;color:#333;cursor:pointer;white-space:nowrap;display:flex;align-items:center;justify-content:start}.menu-wrapper .menu-item.menu-item-hover:not(.menu_item_disable):not(.menu_button),.menu-wrapper .menu-item:hover:not(.menu_item_disable):not(.menu_button){background-color:#fff7cf}.menu-wrapper .menu-item *{pointer-events:none}.menu-wrapper .menu_item_enable{cursor:default}.menu-wrapper .menu_item_disable{color:#000;opacity:.3;cursor:default}.menu-wrapper .dropdown_divider{border-top:1px solid #bbb;margin:4px 0}.menu-wrapper .menu_button{padding-right:20px;color:#fb5}.menu-wrapper .menu_button:hover{color:#c99342}.menu-wrapper .menu_group{position:relative;min-width:120px;padding-right:48px}.menu-wrapper .menu_group *{pointer-events:none}.menu-wrapper .menu_group.menu_group_expanded{background-color:#fff7cf}.menu-wrapper .menu_group::after{content:"";position:absolute;border:solid;border-width:4px 6px;border-color:transparent transparent transparent #979797;top:12px;right:4px}.menu-wrapper .menu_item_image_plus{height:56px;min-width:200px;padding-left:36px;padding-right:56px}.menu-wrapper .menu_item_image_plus>:first-child:not(.image_plus){fill:#fb5;position:absolute;left:12px}.menu-wrapper .menu_item_image_plus .image_plus{width:40px;height:40px;background:#fafafa;border:1px solid #f0f0f0;border-radius:4px;margin-right:8px;display:flex;align-items:center;justify-content:center}.menu-wrapper.scroll-smooth{scroll-behavior:smooth}.blocklyDropdownMenu{min-width:172px;max-height:314px}.menu_group_children{position:fixed;z-index:999999;outline:0;box-sizing:border-box}.menu_group_children *{box-sizing:border-box}.dropdown-triangle{position:absolute;left:50%;transform:translateX(-50%);width:0;height:0}.lower-menu .dropdown-triangle{top:0}.blocklyContextMenu{border-radius:4px;color:#fff;cursor:pointer;position:absolute}.blocklyContextMenu .italic{font-style:italic}.color-menu{width:300px;height:306px;background:#fff;box-shadow:0 1px 6px 0 rgba(76,81,89,.2);border-radius:4px;display:flex;flex-direction:column;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-menu .color-menu-title{width:300px;height:46px;font-size:14px;font-weight:500;color:#333;padding:16px}.color-menu .color-menu-item{width:268px;height:54px;background:#f5f9ff;border-radius:6px;margin-bottom:8px;display:flex;justify-content:center;align-items:center;cursor:pointer}.color-menu .color-menu-item:hover{background:#e8f1ff}.color-menu .color-menu-item .color-menu-item-content{padding:0 13px;height:31px;background:#e76cea;border-radius:16px;border:1px solid #b353b5;display:flex;justify-content:center;align-items:center;font-size:13px}.color-menu .color-menu-item .color-menu-item-content .color-palette{width:32px;height:24px;border-radius:12px;position:relative}.color-menu .color-menu-item .color-menu-item-content .color-palette div{width:100%;height:100%;border-radius:12px;border:1px solid #fff;position:absolute;z-index:3}.color-menu .color-menu-item .color-menu-item-content .color-palette::after,.color-menu .color-menu-item .color-menu-item-content .color-palette::before{content:"";position:absolute;width:100%;height:100%;border-radius:inherit;top:0;left:0}.color-menu .color-menu-item .color-menu-item-content .color-palette::after{display:block;background-color:inherit;z-index:2;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAClJREFUKFNj/P///38GLODDhw/YhBkYR6SG9+/fYw0lAQEB7KE0EjUAAPijQL2LySF6AAAAAElFTkSuQmCC) left center}.color-menu .color-menu-item .color-menu-item-content .color-palette::before{display:block;z-index:1;background-color:#fff}.color-menu .color-menu-item .color-menu-item-content .color-string{height:23px;line-height:23px;background:#fff;border-radius:13px;border:1px solid #b353b5;font-weight:500;color:#333;padding:0 2px}.color-menu .color-menu-item .color-menu-item-content .color-hsva,.color-menu .color-menu-item .color-menu-item-content .color-rgba{height:23px;line-height:23px;font-weight:500;color:#fff;display:flex;align-items:center}.color-menu .color-menu-item .color-menu-item-content .color-hsva div,.color-menu .color-menu-item .color-menu-item-content .color-rgba div{max-width:42px;min-width:36px;background:#fff;border-radius:13px;border:1px solid #b353b5;color:#333;margin:0 6px;text-align:center}.color-menu .color-menu-item .color-menu-item-content .color-hsva div:last-child,.color-menu .color-menu-item .color-menu-item-content .color-rgba div:last-child{margin-right:0}.color-menu .color-menu-item-selected{border:2px solid #297eff}.color-menu .injectionDiv{background:0 0}.color-menu .injectionDiv .blocklyMainBackground{display:none}.blocklyHtmlInput{border:none;position:absolute;top:0;left:0;height:100%;margin:0;outline:0;width:100%;text-align:center;border-radius:12px}.blocklyInvalidInput{background:#faa}.blocklyHtmlTextarea{line-break:anywhere;white-space:break-spaces;border:none;position:absolute;top:0;left:0;height:100%;width:100%;text-align:left;box-sizing:border-box;cursor:text;overflow:hidden;outline:0;resize:none}.blocklyDragging,.blocklyDragging *{cursor:-webkit-grabbing!important;cursor:grabbing!important}.blocklyTooltipDiv{background-color:#ffffc7;border:1px solid #ddc;box-shadow:4px 4px 20px 1px rgba(0,0,0,.15);color:#000;display:none;font-size:9pt;opacity:.9;padding:2px;position:absolute;z-index:100000;pointer-events:none}::-moz-selection{background-color:rgba(77,151,255,.25)}::selection{background-color:rgba(77,151,255,.25)}.slider-controller{height:44px;display:flex;background:#fff;box-shadow:0 0 6px 0 rgba(76,81,89,.2);border-radius:4px;padding:0 8px}.slider-controller .slider-text{font-size:12px;line-height:12px;color:#77808c;margin:auto 4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.slider-controller .slider-wrapper{position:relative;display:flex;align-items:center;justify-content:space-around;height:14px;width:156px;margin:auto}.slider-controller .slider-wrapper .slider-rail{height:6px;width:140px;border-radius:4px;margin:auto}.slider-controller .slider-wrapper .slider-rail:hover{cursor:pointer}.slider-controller .slider-wrapper .slider-handle{height:14px;width:14px;border-radius:50%;position:absolute;left:0}.slider-controller .slider-wrapper .slider-handle:hover{cursor:pointer}.slider-controller .slider-wrapper .slider-track{height:6px;width:0;border-radius:4px;position:absolute;left:8px;top:4px}.slider-controller .slider-wrapper .slider-track:hover{cursor:pointer}.angle-controller{width:204px;height:204px;background-color:#fff;box-shadow:0 0 6px 0 rgba(76,81,89,.2);border-radius:4px;position:relative;display:flex;align-items:center;justify-content:space-around}.angle-controller .degree-mark-major{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:196px}.angle-controller .degree-mark-minor{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:132px}.angle-controller .wrapper{position:relative;width:120px;height:120px;cursor:pointer}.angle-controller .wrapper .grey-circle{width:120px;height:120px;border-radius:50%;background-color:#f2f2f2}.angle-controller .wrapper .mask-wrapper{position:absolute;top:0;left:0;width:120px;height:120px;border-radius:50%;background-color:rgba(255,179,184,.4)}.angle-controller .wrapper .mask-wrapper .mask-clip{position:absolute;left:0;top:0;width:120px;height:120px;border-radius:50%;clip:rect(0,120px,60px,0);background-color:#f2f2f2}.angle-controller .wrapper .mask-wrapper .white-circle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:64px;height:64px;border-radius:50%;background-color:#fff}.angle-controller .wrapper .base-line{position:absolute;top:50%;left:50%;transform:translateY(-50%);height:1px;width:60px;background-color:#f46767}.angle-controller .wrapper .center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:50%;background-color:#f46767;z-index:1}.angle-controller .wrapper .pointer{position:absolute;top:50%;left:50%;height:28px;width:60px;transform-origin:left center;transform:translateY(-50%) rotate(-90deg)}.angle-controller .wrapper .pointer .pointer-line{position:absolute;top:50%;left:0;transform:translateY(-50%);height:1px;width:60px;background-color:#f46767}.angle-controller .wrapper .pointer .pointer-arrow-wrapper{position:absolute;top:0;right:0;transform:rotate(90deg)}.angle-controller .wrapper .pointer .pointer-arrow-wrapper .pointer-arrow-circle{width:28px;height:28px;border-radius:50%;background-color:#f46767;display:flex;align-items:center;justify-content:space-around}.angle-controller .wrapper .pointer .pointer-arrow-wrapper .pointer-arrow-circle .pointer-icon{font-size:16px}.color-controller{width:222px;height:277px;background:#fff;box-shadow:0 1px 6px 0 rgba(76,81,89,.4);border-radius:4px}.color-controller .color-panel{padding:16px;height:228px}.color-controller .color-panel .color-panel-item{font-size:14px;font-weight:500;color:#1a1a1a;margin-bottom:14px}.color-controller .color-panel .color-panel-item .color-label{line-height:16px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-controller .color-panel .color-panel-item .color-strip-panel{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAClJREFUKFNj/P///38GLODDhw/YhBkYR6SG9+/fYw0lAQEB7KE0EjUAAPijQL2LySF6AAAAAElFTkSuQmCC) left center}.color-controller .color-panel .color-panel-item .color-strip-panel{position:relative;margin-top:8px;cursor:pointer}.color-controller .color-panel .color-panel-item .color-strip-panel .color-handle{position:absolute;top:-1px;width:8px;height:14px;background:#fff;box-shadow:0 0 2px 0 rgba(0,0,0,.1);border-radius:2px;border:2px solid rgba(0,0,0,.1)}.color-controller .color-panel .color-panel-item .color-strip-panel-selected{cursor:pointer}.color-controller .color-panel .color-panel-item .color-strip{width:100%;height:12px;border-radius:4px;border:1px solid #e6e6e6}.color-controller .preview-panel{display:flex;justify-content:space-between;align-items:center;width:222px;height:49px;border-top:1px solid rgba(11,24,38,.1);padding:0 16px;font-size:14px;font-weight:500;color:#1a1a1a;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-controller .preview-panel .color-preview{width:24px;height:24px;border-radius:4px;border:1px solid rgba(0,0,0,.08)}.blocklyIcon{width:1em;height:1em}'},4193(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Msg=void 0,e.Msg={MATH_ADDITION_SYMBOL:"+",MATH_SUBTRACTION_SYMBOL:"-",MATH_DIVISION_SYMBOL:"\xf7",MATH_MULTIPLICATION_SYMBOL:"\xd7",MATH_POWER_SYMBOL:"^",MATH_TRIG_SIN:"sin",MATH_TRIG_COS:"cos",MATH_TRIG_TAN:"tan",MATH_TRIG_ASIN:"asin",MATH_TRIG_ACOS:"acos",MATH_TRIG_ATAN:"atan",START_GROUP_TAG:"",OUTPUT_GROUP_TAG:"",EXECUTION_GROUP_TAG:"",BLOCK_GROUP:"",RELEASE_GROUP:"",HIDE_BLOCK_STACK:"",SHOW_BLOCK_STACK:""}},31728(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceElement=void 0;var i=o(31635),r=o(77276),s=o(36963),a=o(35009),_=o(25507),c=o(71288);e.WorkspaceElement=function(){function t(t){this.id="",this.width=0,this.height=0,this.rendered=!1,this.deletable_=!0,this.movable_=!0,this.editable_=!0,this.disabled=!1,this.location_=r.vec2.create(),this.visibility_=a.BlockVisibility.VISIBLE,this.event_initialized=!1,this.svg_group=(0,_.create_svg_element)("g",{}),this.svg_group.translate_="",this.workspace=t,this.is_in_flyout=t.is_flyout,this.RTL=t.RTL}return t.prototype.get_svg_root=function(){return this.svg_group},t.prototype.set_workspace=function(t){this.workspace=t},t.prototype.get_workspace=function(){return this.workspace},t.prototype.set_deletable=function(t){this.deletable_=t},t.prototype.is_deletable=function(){return this.deletable_&&!(this.workspace&&this.workspace.get_options().readOnly)},t.prototype.set_delete_style=function(t){void 0!=this.svg_group?t?(0,_.add_class_if_necessary)(this.svg_group,"blocklyDraggingDelete"):(0,_.remove_class_if_necessary)(this.svg_group,"blocklyDraggingDelete"):console.warn("Cannot set delete style for block without init.")},t.prototype.set_movable=function(t){this.movable_=t},t.prototype.is_movable=function(){return this.movable_},t.prototype.update_movable=function(){if(void 0==this.svg_group)throw ReferenceError("Cannot update movable to block without svg group.");var t=this.svg_group.classList;this.is_movable()?t.add("blocklyDraggable"):t.remove("blocklyDraggable")},t.prototype.set_editable=function(t){this.editable_=t},t.prototype.is_editable=function(){return this.editable_},t.prototype.set_disabled=function(t){this.disabled=t},t.prototype.get_location=function(){return this.location_},t.prototype.move_by=function(t){this.events.is_enabled()&&(e=this.move_event_factory({block:this}));var e,o=this.get_relative_to_surface_xy();this.translate(r.vec2.add(this.location_,o,t)),e&&e.record_new(),this.workspace.resize_contents(),e&&this.events.fire(e)},t.prototype.dispose=function(t,e){if(this.workspace){var o=this.workspace;this.runtime_data.selected===this&&(this.unselect(),o.cancel_current_gesture()),this.context_menu.current_block==this&&this.context_menu.hide(),e&&this.rendered&&this.block_animations.dispose_ui_effect(this),this.rendered=!1,(0,_.remove_node)(this.svg_group),(0,_.remove_children)(this.svg_group),o.resize_contents()}},t.prototype.on_mouse_down=function(t){if(this.workspace){var e=this.workspace.get_gesture(t);e&&e.handle_block_start(t,this)}},Object.defineProperty(t.prototype,"use_drag_surface",{get:function(){return!!this.workspace.get_block_drag_surface()},enumerable:!1,configurable:!0}),t.prototype.get_relative_to_surface_xy=function(){var t,e,o=this.use_drag_surface?null==(t=this.workspace.get_block_drag_surface())?void 0:t.get_group():void 0,i=this.svg_group;if(void 0==i)return r.vec2.create();var s=r.vec2.create();do{if(r.vec2.add(s,s,this.utils.get_relative_xy(i)),this.use_drag_surface&&(null==(e=this.workspace.get_block_drag_surface())?void 0:e.get_current_block())==i){var a=this.workspace.get_block_drag_surface().get_surface_translation();r.vec2.add(s,s,[a[0],a[1]])}i=i.parentNode}while(i&&i!=this.workspace.get_canvas()&&i!=o);return s},t.prototype.translate=function(t){var e=this.svg_group;if(void 0==e)throw ReferenceError("Block should have svg root when translating.");e.setAttribute("transform","translate("+t[0]+", "+t[1]+")"),this.location_=t},t.prototype.move_off_drag_surface=function(t){var e;if(this.svg_group&&this.workspace.svg_block_canvas_){var o=this.svg_group.getAttribute("filter");o&&o.includes(c.FILTER.DRAG_SHADOW)&&this.svg_group.removeAttribute("filter"),this.use_drag_surface?(this.translate(t),null!=(e=this.workspace.get_block_drag_surface())&&e.clear_and_hide(this.workspace.svg_block_canvas_)):this.location_=t}},t.prototype.set_mouse_through_style=function(t){void 0!=this.svg_group?t?(0,_.add_class_if_necessary)(this.svg_group,"blocklyDraggingMouseThrough"):(0,_.remove_class_if_necessary)(this.svg_group,"blocklyDraggingMouseThrough"):console.warn("Cannot set the style for block without init.")},t.prototype.set_dragging=function(t){if(void 0!=this.svg_group){var e=this.svg_group;t?(e.translate_="",e.skew_="",(0,_.add_class_if_necessary)(e,"blocklyDragging")):(0,_.remove_class_if_necessary)(e,"blocklyDragging")}else console.warn("Cannot set delete style for block without init.")},t.prototype.move_during_drag=function(t){var e;this.svg_group&&(this.use_drag_surface?null!=(e=this.workspace.get_block_drag_surface())&&e.translate_surface(t[0],t[1]):(this.svg_group.translate_="translate("+t[0]+", "+t[1]+")",this.svg_group.setAttribute("transform",this.svg_group.translate_+this.svg_group.skew_)))},t.prototype.bring_to_front=function(){var t=this.svg_group;void 0!=t&&void 0!=t.parentNode&&t.parentNode.appendChild(t)},t.prototype.select=function(){if(this.runtime_data.selected!=this){var t=void 0;if(this.runtime_data.selected){t=this.runtime_data.selected.id,this.events.disable();try{this.runtime_data.selected.unselect()}catch(t){console.error(t)}finally{this.events.enable()}}var e=this.ui_event_factory({type:a.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:t,new_value:this.id});this.runtime_data.selected=this,this.events.fire(e)}},t.prototype.unselect=function(){if(this.runtime_data.selected==this){var t=this.ui_event_factory({type:a.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:this.id,new_value:void 0});this.runtime_data.selected=void 0,this.events.fire(t)}},t.prototype.move_to_drag_surface=function(){var t;if(this.svg_group)if(this.use_drag_surface){var e=this.get_relative_to_surface_xy();this.clear_transform_attributes();var o=this.workspace.get_block_drag_surface();null!=o&&o.translate_surface(e[0],e[1]),null!=o&&o.set_blocks_and_show(this.svg_group)}else null!=(t=this.workspace.svg_block_canvas_)&&t.appendChild(this.svg_group)},t.prototype.clear_transform_attributes=function(){this.svg_group&&(0,_.remove_attribute)(this.svg_group,"transform")},t.prototype.get_bounding_rectangle=function(){var t=this.get_relative_to_surface_xy(),e=this.get_height_width();return{topLeft:t,bottomRight:r.vec2.fromValues(t[0]+e.width,t[1]+e.height)}},t.prototype.get_height_width=function(){return{height:this.height,width:this.width}},t.prototype.get_visibility=function(){return this.visibility_},t.prototype.init_events=function(){if(!this.workspace.get_options().readOnly&&!this.event_initialized){var t=this.get_svg_root();void 0!=t&&(this.events.bind_event_with_checks(t,"mousedown",this,this.on_mouse_down),this.event_initialized=!0)}},t.prototype.get_top_parent=function(){return this},t.prototype.for_each_descendant_element=function(t){t(this)},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.context_menu)],t.prototype,"context_menu",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.DeleteEvent)],t.prototype,"delete_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t}()},18141(t,e,o){"use strict";e.bind_di_modules=void 0;var i=o(36074),r=o(38509),s=o(22418),a=o(22233),_=o(62040),c=o(17959),l=o(2734),h=o(81374),d=o(32061),u=o(26547),p=o(64138),f=o(21771),g=o(76204),v=o(85549),b=o(80278),m=o(97839),y=o(16800),k=o(64689),w=o(38730),E=o(57811),T=o(50072),x=o(12564),I=o(77468),O=o(79028),N=o(78672),C=o(59967),A=o(602),S=o(92129),L=o(44083),D=o(1603),R=o(6765),M=o(69549),B=o(20716),P=o(85905),G=o(59946),U=o(84879),F=o(3840),z=o(21653),j=o(31728),H=o(6590),W=o(95208),V=o(86709),X=o(68301),Y=o(95994),K=o(63030),q=o(35322),J=o(4523),Q=o(58956),Z=o(51919),$=o(47441),tt=o(10575),te=o(5130),to=o(80591),ti=o(55487),tn=o(99356),tr=o(20439),ts=o(45179),ta=o(52102),t_=o(8701),tc=o(40208),tl=o(98207),th=o(38842),td=o(4193),tu=o(86295),tp=o(68865);e.bind_di_modules=function(t){t.bind(tp.BINDING.ChangeEvent).toFunction(function(t,e){if(!(e.block instanceof j.WorkspaceElement)||"string"!=typeof t)throw Error("\n        Trying to create invalid change event with event "+t+" and param "+e+".\n        It may caused by wrong custom change event subtype registry.\n        Note that options of any change event should include [block], [old_value] and [new_value].\n        Check https://codemao.yuque.com/milktea/blink/zy9tlg for more information.\n      ");return new i.ChangeEvent(t,e)}),t.bind(tp.BINDING.CreateEvent).toFunction(function(t){return new i.CreateEvent(t)}),t.bind(tp.BINDING.DeleteEvent).toFunction(function(t){return new i.DeleteEvent(t)}),t.bind(tp.BINDING.DragAreaChangeEvent).toFunction(function(t){return new i.DragAreaChangeEvent(t)}),t.bind(tp.BINDING.EndDragEvent).toFunction(function(t){return new i.EndDragEvent(t)}),t.bind(tp.BINDING.MoveEvent).toFunction(function(t){return new i.MoveEvent(t)}),t.bind(tp.BINDING.StartDragEvent).toFunction(function(t){return new i.StartDragEvent(t)}),t.bind(tp.BINDING.ContextMenuOptionEvent).toFunction(function(t){return new r.ContextMenuOptionEvent(t)}),t.bind(tp.BINDING.GroupEvent).toFunction(function(t){return new r.GroupEvent(t)}),t.bind(tp.BINDING.UIEvent).toFunction(function(t){return new r.UIEvent(t)}),t.bind(tp.BINDING.FlyoutButton).toFunction(function(t){return new s.FlyoutButton(t)}),t.bind(tp.BINDING.VerticalFlyout).toFunction(function(t){return new a.VerticalFlyout(t)}),t.bind(tp.BINDING.WorkspaceElementDragger).toFunction(function(t){if((0,tu.is_block_svg)(t.target))return new _.BlockDragger({target:t.target,workspace:t.workspace});if((0,tu.is_workspace_comment)(t.target))return new h.WorkspaceCommentDragger({target:t.target,workspace:t.workspace});throw Error("Trying to drag invalid element")}),t.bind(tp.BINDING.WorkspaceDragger).toFunction(function(t){return(0,tu.is_workspace)(t)?new d.WorkspaceDragger(t):new c.FlyoutDragger(t)}),t.bind(tp.BINDING.Gesture).toFunction(function(t){return new l.Gesture(t)}),t.bind(tp.BINDING.Blink).to(u.Blink).inSingletonScope(),t.bind(tp.BINDING.block_animations).to(p.BlockAnimations).inSingletonScope(),t.bind(tp.BINDING.context_menu).to(f.ContextMenu).inSingletonScope(),t.bind(tp.BINDING.css).to(g.Css).inSingletonScope(),t.bind(tp.BINDING.dragged_connection_manager).to(v.DraggedConnectionManager).inSingletonScope(),t.bind(tp.BINDING.insertion_marker_manager).to(b.InsertionMarkerManager).inSingletonScope(),t.bind(tp.BINDING.events).to(m.Events).inSingletonScope(),t.bind(tp.BINDING.extensions).to(y.Extensions).inSingletonScope(),t.bind(tp.BINDING.json).to(k.Json).inSingletonScope(),t.bind(tp.BINDING.registry).to(w.Registry).inSingletonScope(),t.bind(tp.BINDING.runtime_data).to(E.RuntimeData).inSingletonScope(),t.bind(tp.BINDING.theme).to(T.Theme).inSingletonScope(),t.bind(tp.BINDING.tooltip).to(x.Tooltip).inSingletonScope(),t.bind(tp.BINDING.touch_manager).to(I.TouchManager).inSingletonScope(),t.bind(tp.BINDING.utils).to(O.Utils).inSingletonScope(),t.bind(tp.BINDING.widget_div).to(N.WidgetDiv).inSingletonScope(),t.bind(tp.BINDING.workspace_db).to(C.WorkspaceDB).inSingletonScope(),t.bind(tp.BINDING.xml).to(A.Xml).inSingletonScope(),t.bind(tp.BINDING.slider_controller).to(S.SliderController).inSingletonScope(),t.bind(tp.BINDING.angle_controller).to(L.AngleController).inSingletonScope(),t.bind(tp.BINDING.color_controller).to(R.ColorController).inSingletonScope(),t.bind(tp.BINDING.Toolbox).toFunction(function(t){return new M.Toolbox(t)}),t.bind(tp.BINDING.BlockDragSurfaceSvg).toFunction(function(t){return new B.BlockDragSurfaceSvg(t)}),t.bind(tp.BINDING.ConnectionDB).toFunction(function(){return new P.ConnectionDB}),t.bind(tp.BINDING.Grid).toFunction(function(t){return new G.Grid(t)}),t.bind(tp.BINDING.WorkspaceAudio).toFunction(function(t){return new U.WorkspaceAudio(t)}),t.bind(tp.BINDING.WorkspaceDragSurfaceSvg).toFunction(function(t,e){return new F.WorkspaceDragSurfaceSvg(t,e)}),t.bind(tp.BINDING.WorkspaceSvg).toFunction(function(t,e,o,i){return new z.WorkspaceSvg(t,e,o,i)}),t.bind(tp.BINDING.FieldButton).toFunction(function(t){return new H.FieldButton(t)}),t.bind(tp.BINDING.FieldColour).toFunction(function(t){return new W.FieldColour(t)}),t.bind(tp.BINDING.FieldDropdown).toFunction(function(t){return new V.FieldDropdown(t)}),t.bind(tp.BINDING.FieldIcon).toFunction(function(t){return new X.FieldIcon(t)}),t.bind(tp.BINDING.FieldImage).toFunction(function(t){return new Y.FieldImage(t)}),t.bind(tp.BINDING.FieldLabel).toFunction(function(t){return new q.FieldLabel(t)}),t.bind(tp.BINDING.FieldLabelSerializable).toFunction(function(t){return new K.FieldLabelSerializable(t)}),t.bind(tp.BINDING.FieldMultilineInput).toFunction(function(t){return new J.FieldMultilineInput(t)}),t.bind(tp.BINDING.MutationAddButton).toFunction(function(){return new Q.MutationAddButton}),t.bind(tp.BINDING.MutationRemoveButton).toFunction(function(t){return new Q.MutationRemoveButton(t)}),t.bind(tp.BINDING.FieldNumber).toFunction(function(t){return new Z.FieldNumber(t)}),t.bind(tp.BINDING.FieldTextDropdown).toFunction(function(t){return new $.FieldTextDropdown(t)}),t.bind(tp.BINDING.FieldTextInput).toFunction(function(t){return new tt.FieldTextInput(t)}),t.bind(tp.BINDING.FieldDefaultValue).toFunction(function(t){return new te.FieldDefaultValue(t)}),t.bind(tp.BINDING.Input).toFunction(function(t){return new to.Input(t)}),t.bind(tp.BINDING.RenderedConnection).toFunction(function(t){return new ts.RenderedConnection(t)}),t.bind(tp.BINDING.BlockSvg).toFunction(function(t){return new((0,ti.block_render_svg)(tr.BlockSvg))(t)}),t.bind(tp.BINDING.BlockGroup).toFunction(function(t){return new((0,ti.block_render_svg)(tn.BlockGroup))(t)}),t.bind(tp.BINDING.SimplifiedCommentBubble).to(D.SimplifiedCommentBubble).inSingletonScope(),t.bind(tp.BINDING.WorkspaceComment).toFunction(function(t){return"simplified"===t.type?new t_.SimplifiedWorkspaceComment(t.workspace,t.parent_block,t.position,t.opt_id):new ta.WorkspaceComment(t.workspace,t.parent_block,t.position,t.opt_id)}),t.bind(tp.BINDING.Options).toFunction(function(t){return new tc.Options(t)}),t.bind(tp.BINDING.Scrollbar).toFunction(function(t,e,o,i,r){return new tl.Scrollbar(t,e,o,i,r)}),t.bind(tp.BINDING.ScrollbarPair).toFunction(function(t,e){return new tl.ScrollbarPair(t,e)}),t.bind(tp.BINDING.Msg).toConstantValue(td.Msg),t.bind(tp.BINDING.css_content).toConstantValue(th.BLINK_CSS_CONTENT)}},82472(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.no_event=e.is_target_input=e.is_right_button=void 0,e.is_right_button=function(t){return 2==t.button},e.is_target_input=function(t){return t.target instanceof HTMLInputElement&&("textarea"==t.target.type||"text"==t.target.type||"number"==t.target.type||"email"==t.target.type||"password"==t.target.type||"search"==t.target.type||"tel"==t.target.type||"url"==t.target.type||t.target.isContentEditable)},e.no_event=function(t){t.preventDefault(),t.stopPropagation()}},82267(t,e){"use strict";function o(t,e,o){for(var i=[0],r=[],s=0;s<t.length;s++)i[i.length-1]+=t[s].length,!0===e[s]?(i.push(0),r.push(t[s].charAt(t[s].length-1))):!1===e[s]&&i[i.length-1]++;var a=Math.max.apply(Math,i),_=0;for(s=0;s<i.length;s++)_-=2*Math.pow(Math.abs(o-i[s]),1.5),_-=Math.pow(a-i[s],1.5),-1!=".?!".indexOf(r[s])?_+=o/3:-1!=",;)]}".indexOf(r[s])&&(_+=o/4);return i.length>1&&i[i.length-1]<=i[i.length-2]&&(_+=.5),_}Object.defineProperty(e,"__esModule",{value:!0}),e.wrap=e.string_trim=e.string_is_empty_or_whitespace=e.case_insensitive_equals=e.case_insensitive_compare=void 0,e.case_insensitive_compare=function(t,e){var o=String(t).toLowerCase(),i=String(e).toLowerCase();return o<i?-1:+(o!=i)},e.case_insensitive_equals=function(t,e){return"string"==typeof t&&"string"==typeof e&&t.toLowerCase()==e.toLowerCase()},e.string_is_empty_or_whitespace=function(t){return/^[\s\xa0]*$/.test(t)},e.string_trim=function(t){return t.replace(/\s+$/,"").replace(/ +\n/g,"\n")},e.wrap=function(t,e){for(var i=t.split("\n"),r=0;r<i.length;r++)i[r]=function(t,e){if(t.length<=e)return t;for(var i,r,s=t.trim().split(/\s+/),a=0;a<s.length;a++)s[a].length>e&&(e=s[a].length);var _=-1/0,c=1;do{r=_,i=t;var l=[],h=s.length/c,d=1;for(a=0;a<s.length-1;a++)d<(a+1.5)/h?(d++,l[a]=!0):l[a]=!1;_=o(s,l=function t(e,i,r){for(var s,a=o(e,i,r),_=0;_<i.length-1;_++)if(i[_]!=i[_+1]){var c=i.slice();c[_]=!c[_],c[_+1]=!c[_+1];var l=o(e,c,r);l>a&&(a=l,s=c)}return s?t(e,s,r):i}(s,l,e),e),t=function(t,e){for(var o=[],i=0;i<t.length;i++)o.push(t[i]),void 0!=e[i]&&o.push(e[i]?"\n":" ");return o.join("")}(s,l),c++}while(_>r);return i}(i[r],e);return i.join("\n")}},443(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shortest_string_length=e.equals=e.remove=void 0;var i=o(86295);e.remove=function(t,e){var o=t.indexOf(e),i=o>=0;return i&&t.splice(o,1),i},e.equals=function(t,e){if(!(0,i.is_array)(t)||!(0,i.is_array)(e)||t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0},e.shortest_string_length=function(t){return t.length?t.reduce(function(t,e){return t.length<e.length?t:e}).length:0}},19673(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.parse_visibility=e.parse_constraints=void 0;var i=o(35009);e.parse_constraints=function(t){var e=t.split(","),o=parseFloat(e[0]),i=parseFloat(e[1]),r=parseFloat(e[2]),s="true"===e[3]||null;return{min:isNaN(o)?-1/0:o,max:isNaN(i)?1/0:i,precision:isNaN(r)?0:r,mod:s}},e.parse_visibility=function(t){var e;switch(t){case"visible":e=i.BlockVisibility.VISIBLE;break;case"hidden":e=i.BlockVisibility.HIDDEN;break;case"translucent":e=i.BlockVisibility.TRANSLUCENT;break;default:return}return e}},48264(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.json=e.block=e.string=e.color=e.asserts=e.array=e.maths=e.math=e.base=e.event=e.dom=e.style=e.is=void 0;var i=o(31635);e.style=(0,i.__importStar)(o(53137)),e.dom=(0,i.__importStar)(o(25507)),e.event=(0,i.__importStar)(o(82472)),e.base=(0,i.__importStar)(o(86295));var r=(0,i.__importStar)(o(89221));e.math=r,e.maths=r,e.array=(0,i.__importStar)(o(443)),e.asserts=(0,i.__importStar)(o(99469)),e.color=(0,i.__importStar)(o(37747)),e.string=(0,i.__importStar)(o(82267));var s=o(84728);Object.defineProperty(e,"is",{enumerable:!0,get:function(){return s.is}}),e.block=(0,i.__importStar)(o(44015)),e.json=(0,i.__importStar)(o(19673))},58059(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o(31635);(0,i.__exportStar)(o(35009),e),(0,i.__exportStar)(o(78194),e)},62879(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.lazy_inject=e.bind_singleton=e.get_instance=void 0;var i=o(31635),r=o(71519),s=(0,i.__importDefault)(o(24033)),a=new r.Container;e.get_instance=function(){return a},e.bind_singleton=function(t,e){a.rebind(t).to(e).inSingletonScope()},e.lazy_inject=(0,s.default)(a).lazyInject},68865(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BINDING=void 0,e.BINDING={Blink:Symbol("Blink"),block_animations:Symbol("block_animations"),touch_manager:Symbol("touch_manager"),dragged_connection_manager:Symbol("dragged_connection_manager"),insertion_marker_manager:Symbol("insertion_marker_manager"),utils:Symbol("utils"),xml:Symbol("xml"),registry:Symbol("registry"),json:Symbol("json"),css_content:Symbol("css_content"),css:Symbol("css"),widget_div:Symbol("widget_div"),runtime_data:Symbol("runtime_data"),context_menu:Symbol("context_menu"),events:Symbol("events"),extensions:Symbol("extensions"),slider_controller:Symbol("slider_controller"),angle_controller:Symbol("angle_controller"),color_controller:Symbol("color_controller"),WorkspaceElementDragger:Symbol("WorkspaceElementDragger"),FlyoutDragger:Symbol("FlyoutDragger"),WorkspaceDragger:Symbol("WorkspaceDragger"),Inject:Symbol("Inject"),Msg:Symbol("Msg"),WorkspaceDragSurfaceSvg:Symbol("WorkspaceDragSurfaceSvg"),BlockSvg:Symbol("BlockSvg"),BlockDragSurfaceSvg:Symbol("BlockDragSurfaceSvg"),ConnectionDB:Symbol("connection_db"),WorkspaceSvg:Symbol("WorkspaceSvg"),WorkspaceAudio:Symbol("WorkspaceAudio"),EndDragEvent:Symbol("EndDragEvent"),StartDragEvent:Symbol("StartDragEvent"),MoveEvent:Symbol("MoveEvent"),ChangeEvent:Symbol("ChangeEvent"),UIEvent:Symbol("UIEvent"),CreateEvent:Symbol("CreateEvent"),DeleteEvent:Symbol("DeleteEvent"),DragAreaChangeEvent:Symbol("DragAreaChangeEvent"),ContextMenuOptionEvent:Symbol("ContextMenuOptionEvent"),GroupEvent:Symbol("GroupEvent"),FlyoutButton:Symbol("FlyoutButton"),VerticalFlyout:Symbol("VerticalFlyout"),Field:Symbol("Field"),FieldImage:Symbol("Image"),FieldIcon:Symbol("Icon"),FieldLabel:Symbol("Label"),FieldLabelSerializable:Symbol("LabelSerializable"),FieldDropdown:Symbol("Dropdown"),FieldButton:Symbol("FieldButton"),FieldColour:Symbol("FieldColour"),FieldTextInput:Symbol("FieldTextInput"),FieldTextDropdown:Symbol("FieldTextDropdown"),FieldNumber:Symbol("FieldNumber"),FieldMultilineInput:Symbol("FieldMultilineInput"),FieldDefaultValue:Symbol("FieldDefaultValue"),Toolbox:Symbol("Toolbox"),MutationAddButton:Symbol("MutationAddButton"),MutationRemoveButton:Symbol("MutationRemoveButton"),Scrollbar:Symbol("Scrollbar"),ScrollbarPair:Symbol("ScrollbarPair"),Grid:Symbol("Grid"),Comment:Symbol("Comment"),Bubble:Symbol("Bubble"),Gesture:Symbol("Gesture"),RenderedConnection:Symbol("RenderedConnection"),Input:Symbol("Input"),Options:Symbol("Options"),Warning:Symbol("Warning"),tooltip:Symbol("tooltip"),theme:Symbol("theme"),WorkspaceComment:Symbol("WorkspaceComment"),BlockGroup:Symbol("BlockGroup"),SimplifiedCommentBubble:Symbol("SimplifiedCommentBubble"),workspace_db:Symbol("workspace_db")}},15514(t,e,o){"use strict";o.d(e,{a:()=>d,b:()=>a,c:()=>p,d:()=>f,e:()=>s,f:()=>u,g:()=>r,h:()=>h,i:()=>l,j:()=>c,k:()=>_});var i=o(94220),r="icon-widget-list-viewer",s=360,a=500,_=200,c=100,l=428,h=926,d="#F7F7F7",u="#CCC",p="tiled",f=i.o.IMAGE_AND_TITLE_DESC;i.H,i.H,i.H,i.H,i.H,i.v,i.H,i.H,i.v,i.H,i.H,i.v,i.H,i.v,i.H,i.H,i.v,i.H,i.H,i.H,i.v,i.v},92380(t,e,o){"use strict";o.d(e,{a:()=>h});var i=o(7452),r=o.n(i),s=o(34221),a=o(99085),_=o(94082),c=function(){var t,e;function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"appCraft";a.a(this,o),this._dbs=void 0,this._databaseName=void 0,this._tableName="grid",this._version=1,this._dbs={},this._databaseName=t,this.open(this._databaseName,this._version)}return _.a(o,[{key:"open",value:function(t,e){var o=this;return new Promise(function(i,r){if(o._dbs[t+e])i(o._dbs[t+e]);else{var s=indexedDB.open(t,e);s.onupgradeneeded=function(t){var e=t.target.result;if(!1===e.objectStoreNames.contains(o._tableName)){var r=e.createObjectStore(o._tableName,{keyPath:"id"});r.createIndex("id","id",{unique:!0}),r.createIndex("name","name"),r.createIndex("header","header"),r.createIndex("data","data")}i(e)},s.onsuccess=function(r){var s=r.target.result;o._dbs[t+e]=s,i(s)},s.onerror=function(t){r(t),console.error("IndexedDB",t)}}})}},{key:"_getTransaction",value:(t=s.a(r().mark(function t(e){var o;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._dbs[this._databaseName+e]){t.next=4;break}o=this._dbs[this._databaseName+e],t.next=7;break;case 4:return t.next=6,this.open(this._databaseName,e);case 6:o=t.sent;case 7:return t.abrupt("return",o.transaction([this._tableName],"readwrite"));case 8:case"end":return t.stop()}},t,this)})),function(e){return t.apply(this,arguments)})},{key:"_getObjectStore",value:(e=s.a(r().mark(function t(){var e;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getTransaction(this._version);case 2:return e=t.sent,t.abrupt("return",e.objectStore(this._tableName));case 4:case"end":return t.stop()}},t,this)})),function(){return e.apply(this,arguments)})},{key:"get",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var r=e.get(t);r.onsuccess=function(t){o(t.target.result)},r.onerror=function(t){i(t)}})})}},{key:"getAll",value:function(){var t=this;return new Promise(function(e,o){t._getObjectStore().then(function(t){try{var i=t.getAll();i.onsuccess=function(t){e(t.target.result)},i.onerror=function(t){o(t)}}catch(t){o(t)}})})}},{key:"add",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var r=e.add(t);r.onsuccess=function(t){o(t.target.result)},r.onerror=function(t){i(t)}})})}},{key:"delete",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var r=e.delete(t);r.onsuccess=function(t){o(t.target.result)},r.onerror=function(t){i(t)}})})}},{key:"put",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var r=e.put(t);r.onsuccess=function(t){o(t.target.result)},r.onerror=function(t){i(t)}})})}},{key:"clear",value:function(){var t=this;return new Promise(function(e,o){t._getObjectStore().then(function(i){var r=i.clear(t._tableName);r.onsuccess=function(t){e(t.target.result)},r.onerror=function(t){o(t)}})})}}]),o}(),l=new URLSearchParams(window.location.search.split("?")[1]).get("archiveId"),h=l?new c(l):new c},1725(t,e,o){"use strict";o.d(e,{a:()=>f,b:()=>E,c:()=>d,d:()=>m,e:()=>v,f:()=>P,g:()=>D,h:()=>x,i:()=>k,j:()=>S,k:()=>O,l:()=>u,m:()=>C,n:()=>M});var i=o(7452),r=o.n(i),s=o(34221),a=o(12327),_=o(7683),c=o(75195),l=o(67240),h=o(14104);function d(t,e,o,i,r,s,l,h,d,u,p,f){var g=_.d(),v=_.e(),b={id:t,version:c.e,screenList:[],widgetMap:{},variableMap:{},gridMap:{},blockJsonMap:{},initialScreenId:d,apiToken:u,extensionWidgetList:g,unsafeExtensionWidgetList:v};return i.forEach(function(t){return b.variableMap[t.id]=t.defaultValue}),r.forEach(function(t){return b.variableMap[t.id]=t.defaultValue}),f.forEach(function(t){return b.variableMap[t.id]=t.defaultValue}),p.forEach(function(t){var e=a.Cb(t);e&&(b.widgetMap[t]=e)}),o.forEach(function(t){t.primitiveVariables.forEach(function(t){return b.variableMap[t.id]=t.defaultValue}),t.arrayVariables.forEach(function(t){return b.variableMap[t.id]=t.defaultValue}),t.objectVariables.forEach(function(t){return b.variableMap[t.id]=t.defaultValue}),t.widgetIds.forEach(function(t){var e=a.Cb(t);e&&(b.widgetMap[t]=e)}),null!=(o=t.invisibleWidgetIds)&&o.forEach(function(t){var e=a.Cb(t);e&&(b.widgetMap[t]=e)}),b.screenList.push({id:t.id,title:t.title,type:t.type,position:t.position,size:t.size,widgetIds:t.widgetIds,invisibleWidgetIds:t.invisibleWidgetIds,backgroundColor:t.backgroundColor,backgroundImage:t.backgroundImage,backgroundImageResizeMode:t.backgroundImageResizeMode});var o,i=e.getWorkspaceDataByScreenId(t.id);i&&(b.blockJsonMap[t.id]=i.getWorkspaceJson()),b.imageFileMap=s,b.soundFileMap=l,b.iconFileMap=h}),b}function u(t,e){return p.apply(this,arguments)}function p(){return(p=s.a(r().mark(function t(e,o){var i,s;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(l.a.serverHost+"/coconut/web/build",{method:"POST",credentials:"include",body:JSON.stringify({name:e.apkName,data:o,icon:e.apkIcon,appSplash:e.apkSplash,workId:o.id}),headers:{"Content-Type":"application/json"}});case 2:return i=t.sent,t.next=5,i.json();case 5:return s=t.sent,t.abrupt("return",s.data);case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function f(t){return g.apply(this,arguments)}function g(){return(g=s.a(r().mark(function t(e){var o,i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(l.a.serverHost+"/coconut/web/build/progress?pack_label="+e,{mode:"cors",method:"GET",cache:"no-cache",credentials:"include"});case 2:return o=t.sent,t.next=5,o.json();case 5:return i=t.sent,t.abrupt("return",i.data);case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function v(t){return b.apply(this,arguments)}function b(){return(b=s.a(r().mark(function t(e){var o,i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(l.a.serverHost+"/coconut/web/apk/info/latest?work_id="+e,{mode:"cors",method:"GET",cache:"no-cache",credentials:"include"});case 2:return o=t.sent,t.next=5,o.json();case 5:return i=t.sent,t.abrupt("return",i.data);case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function m(t){return y.apply(this,arguments)}function y(){return(y=s.a(r().mark(function t(e){var o,i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(l.a.serverHost+"/coconut/web/apk/pack/stop?pack_label="+e,{mode:"cors",method:"put",cache:"no-cache",credentials:"include"});case 2:return o=t.sent,t.next=5,o.json();case 5:return i=t.sent,t.abrupt("return",i.success);case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function k(t){return w.apply(this,arguments)}function w(){return(w=s.a(r().mark(function t(e){var o,i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(l.a.serverHost+"/coconut/web/apk/info?pack_label="+encodeURIComponent(e),{mode:"cors",method:"GET",cache:"no-cache",credentials:"include"});case 2:return o=t.sent,t.next=5,o.json();case 5:return i=t.sent,t.abrupt("return",{url:i.data.apk_url,version:i.data.version,expireTime:i.data.apk_download_url_expire_time});case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function E(t,e){return T.apply(this,arguments)}function T(){return(T=s.a(r().mark(function t(e,o){var i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/editor/service/compile",{mode:"same-origin",method:"POST",body:JSON.stringify({id:e,data:o}),headers:{"Content-Type":"application/json"}});case 2:return i=t.sent,t.abrupt("return",i.status);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function x(t){return I.apply(this,arguments)}function I(){return(I=s.a(r().mark(function t(e){var o,i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/editor/service/code?id=".concat(e),{method:"GET"});case 2:return o=t.sent,t.next=5,o.text();case 5:return i=t.sent,t.abrupt("return",i);case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function O(t){return N.apply(this,arguments)}function N(){return(N=s.a(r().mark(function t(e){var o,i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(l.a.serverHost+"/coconut/web/token?work_id=".concat(e),{mode:"cors",method:"GET",credentials:"include"});case 2:return o=t.sent,t.next=5,o.json();case 5:return i=t.sent,t.abrupt("return",i.data);case 7:case"end":return t.stop()}},t)}))).apply(this,arguments)}function C(t){return A.apply(this,arguments)}function A(){return(A=s.a(r().mark(function t(e){var o,i,s,a,_,c,d,u;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.name,i=e.description,s=e.operation,a=e.coverUrl,_=e.bcmcUrl,c=e.playerUrl,d=e.workId,t.next=3,h.a.put(l.a.serverHost+"/coconut/web/work/".concat(d,"/publish"),{name:o,description:i,operation:s,cover_url:a,bcmc_url:_,player_url:c});case 3:return u=t.sent,t.abrupt("return",u.data);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}function S(t){return L.apply(this,arguments)}function L(){return(L=s.a(r().mark(function t(e){var o;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get(l.a.serverHost+"/coconut/web/work/".concat(e,"/info"));case 2:return o=t.sent,t.abrupt("return",o.data);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function D(t){return R.apply(this,arguments)}function R(){return(R=s.a(r().mark(function t(e){var o,i,s=arguments;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=s.length>1&&void 0!==s[1]?s[1]:1,t.next=3,h.a.get(l.a.serverHost+"/coconut/web/work/".concat(e,"/load?channel=").concat(o));case 3:return i=t.sent,t.abrupt("return",i.data);case 5:case"end":return t.stop()}},t)}))).apply(this,arguments)}function M(t,e){return B.apply(this,arguments)}function B(){return(B=s.a(r().mark(function t(e,o){var i;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.put(l.a.serverHost+"/coconut/web/work/".concat(e,"/publish_h5"),{bcmc_url:o});case 2:return i=t.sent,t.abrupt("return",i.data);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}function P(t){return G.apply(this,arguments)}function G(){return(G=s.a(r().mark(function t(e){var o;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h.a.get(l.a.serverHost+"/coconut/web/work/archive/list/".concat(e,"?offset=0&limit=").concat(50));case 2:return o=t.sent,t.abrupt("return",o.data.data.items);case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}},88963(t,e,o){"use strict";o.d(e,{a:()=>y,b:()=>k,c:()=>E,d:()=>b,e:()=>p,f:()=>g,g:()=>m,h:()=>v,i:()=>w,j:()=>T,k:()=>x}),(r=p||(p={})).camera="camera",r.microphone="microphone",(f||(f={})).IMAGE_LIST="IMAGE_LIST",(s=g||(g={}))[s.MY_PROJECT=0]="MY_PROJECT",s[s.CREATE_PROJECT=1]="CREATE_PROJECT",(a=v||(v={})).DevTools="DevTools",a.ResourceLayout="ResourceLayout",(_=b||(b={})).HOME_COURSE="HOME_COURSE",_.HOME_TEMPLATE="HOME_TEMPLATE",_.COURSE="COURSE",_.TEMPLATE="TEMPLATE",_.OTHER="OTHER",_.MY_WORK="MY_WORK",_.LOCAL_FILE="LOCAL_FILE",(c=m||(m={}))[c.FREEDOM=1]="FREEDOM",c[c.TEMPLATE=2]="TEMPLATE",c[c.COURSE=3]="COURSE",c[c.LOCAL=4]="LOCAL",(l=y||(y={})).DYNAMIC_DROPDOWN="DYNAMIC_DROPDOWN",l.IMAGE_DROPDOWN="IMAGE_DROPDOWN",l.ICON_DROPDOWN="ICON_DROPDOWN",l.ACTOR_STYLE_DROPDOWN="ACTOR_STYLE_DROPDOWN",l.SOUND_DROPDOWN="SOUND_DROPDOWN",l.SCREEN_DROPDOWN="SCREEN_DROPDOWN",(h=k||(k={})).PRIMITIVE="PRIMITIVE",h.ARRAY="ARRAY",h.BROADCAST="BROADCAST",h.DOCUMENT_KEY="DOCUMENT_KEY",h.CLOUD_DATA_KEY="CLOUD_DATA_KEY",h.GRID="GRID",h.OBJECT="OBJECT",h.NONE="",(d=w||(w={})).GLOBAL="GLOBAL",d.SCREEN="SCREEN",(u=E||(E={}))[u.Edit=1]="Edit",u[u.ReadOnly=2]="ReadOnly",u[u.Preview=3]="Preview";var i,r,s,a,_,c,l,h,d,u,p,f,g,v,b,m,y,k,w,E,T,x="__WITHOUT_FOCUS__";(i=T||(T={}))[i.Show=0]="Show",i[i.Hide=1]="Hide",i[i.ReadOnly=2]="ReadOnly"},50687(t,e,o){"use strict";o.d(e,{a:()=>u,b:()=>d});var i,r=o(99085),s=o(94082),a=o(41594),_=o.n(a);navigator.platform.match("Mac")?i="osx":navigator.platform.match("Windows")?i="windows":navigator.platform.match("Linux")&&(i="linux");var c=function(){function t(){r.a(this,t),this.handlers=[]}return s.a(t,[{key:"addHandler",value:function(t){this.handlers.push(t)}},{key:"removeHandler",value:function(t){var e=this.handlers.indexOf(t);-1!==e&&this.handlers.splice(e,1)}},{key:"dispatch",value:function(t){var e=!1;return this.handlers.forEach(function(o){h(t,o.keys)&&(e=e||!1!==o.callback())}),e}}]),t}(),l=_().createContext(new c),h=function t(e,o){if("string"==typeof o)return e===o;if(Array.isArray(o))return o.includes(e);if("object"==typeof o){var r=o[i||"windows"];return!!r&&t(e,r)}return!1};function d(t){var e=t.keys,o=t.callback,i=t.disabled,r=(0,a.useContext)(l);return(0,a.useEffect)(function(){if(!i){var t={keys:e,callback:o};return r.addHandler(t),function(){return r.removeHandler(t)}}},[e,o,i,r]),null}function u(t){var e=t.children,o=t.useCapture,i=t.emitter,r=(0,a.useRef)(new c);return(0,a.useEffect)(function(){var t=function(t){var e=document.activeElement;if(e){var o=e.tagName;if("INPUT"===o||"TEXTAREA"===o||e.getAttribute("contenteditable"))return}var i=[];t.altKey&&i.push("alt"),t.ctrlKey&&i.push("control"),t.metaKey&&i.push("command"),t.key&&i.push(t.key.toLowerCase());var s=i.join("+");!1!==r.current.dispatch(s)&&(t.stopImmediatePropagation(),t.preventDefault())},e=i||document;return e.addEventListener("keydown",t,o),function(){return e.removeEventListener("keydown",t,o)}},[o,i]),_().createElement(l.Provider,{value:r.current},e)}},66912(t,e,o){"use strict";o.d(e,{a:()=>s,b:()=>r,c:()=>a}),(i=r||(r={})).styleA="styleA",i.styleB="styleB";var i,r,s="DIALOG_WIDGET",a={type:s,icon:"icon-dialog",title:"widgetName",platforms:["web","android","ios"],isGlobalWidget:!0,isInvisibleWidget:!0,properties:[{key:"style",label:"style",valueType:"string",editorType:"OptionSwitch",defaultValue:r.styleA,dropdown:[{label:"styleA",value:r.styleA},{label:"styleB",value:r.styleB}],blockOptions:{generateBlock:!1}},{key:"themeColor",label:"themeColor",valueType:"color",editorType:"Color",defaultValue:"#2B4BF2",blockOptions:{generateBlock:!1}},{key:"previewImage",label:"previewImage",valueType:"string",editorType:"PreviewImage",defaultValue:"",blockOptions:{generateBlock:!1}},{key:"title",label:"title",valueType:"string",editorType:"TextInput",defaultValue:"",readonly:!0},{key:"text",label:"text",valueType:"string",editorType:"TextInput",defaultValue:"",readonly:!0},{key:"image",label:"image",valueType:"string",editorType:"TextInput",defaultValue:"",readonly:!0},{key:"selectedOption",label:"selectedOption",valueType:"string",editorType:"TextInput",defaultValue:"",readonly:!0},{key:"inputText",label:"inputText",valueType:"string",editorType:"TextInput",defaultValue:"",readonly:!0}],methods:[{key:"message",label:"message",params:[{key:"setTitle",label:"setTitle",valueType:"multilineString",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setText",label:"setText",valueType:"multilineString",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setButtonText",label:"setButtonText",valueType:"string",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setImage",label:"setImage",valueType:"image",defaultValue:""},{key:"setShowCancelButton",label:"setShowCancelButton",valueType:"boolean",defaultValue:!0}],blockOptions:{inputsInline:!1}},{key:"select",label:"select",params:[{key:"setTitle",label:"setTitle",valueType:"multilineString",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setText",label:"setText",valueType:"multilineString",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setOption1",label:"setOption1",valueType:"string",checkType:["string","boolean","number","array"],defaultValue:"1"},{key:"setOption2",label:"setOption2",valueType:"string",checkType:["string","boolean","number","array"],defaultValue:"2"},{key:"setShowCancelButton",label:"setShowCancelButton",valueType:"boolean",defaultValue:!0}],blockOptions:{inputsInline:!1}},{key:"prompt",label:"prompt",params:[{key:"setTitle",label:"setTitle",valueType:"multilineString",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setText",label:"setText",valueType:"multilineString",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setInputPlaceHolder",label:"setInputPlaceHolder",valueType:"string",checkType:["string","boolean","number","array"],defaultValue:""},{key:"setShowCancelButton",label:"setShowCancelButton",valueType:"boolean",defaultValue:!0}],blockOptions:{inputsInline:!1}}],events:[{key:"onClickButton",label:"onClickButton",params:[{key:"buttonText",label:"buttonText",valueType:"string"}]},{key:"onSelectOption",label:"onSelectOption",params:[{key:"selectedOption",label:"selectedOption",valueType:"string"}]},{key:"onCancelSelection",label:"onCancelSelection",params:[]},{key:"onFinishInput",label:"onFinishInput",params:[{key:"inputText",label:"inputText",valueType:"string"}]},{key:"onCancelInput",label:"onCancelInput",params:[]}]}},26564(t,e,o){"use strict";function i(){return(i=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t}).apply(this,arguments)}o.r(e),o.d(e,{a:()=>i,default:()=>r});let r=i},52846(t,e,o){"use strict";o.d(e,{a:()=>s,b:()=>c,c:()=>l,d:()=>a,e:()=>h,f:()=>r});var i=o(22224);function r(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return t.substr(0,e)+(t.length>e?"...":"")}function s(t){var e=window.getSelection?window.getSelection():null;if(e){var o=document.createElement("span");document.body.appendChild(o),o.style.position="fixed",o.style.zIndex="-1000",o.innerText=t;var i=document.createRange();return i.selectNodeContents(o),e.removeAllRanges(),e.addRange(i),document.execCommand("Copy"),o.remove(),!0}return!1}function a(t){return i.isArray(t)||i.isPlainObject(t)?_(t,null,2).replace(RegExp('"'.concat(31,"...OBJECT").concat(30,'"'),"g"),"{...}").replace(RegExp('"'.concat(31,"...ARRAY").concat(30,'"'),"g"),"[...]"):"".concat(t)}function _(t,e,o,r){var s,a,_;return JSON.stringify(t,(a=[],_=[],(s=r)||(s=function(){return i.isArray(this)?"".concat(31,"...ARRAY").concat(30):"".concat(31,"...OBJECT").concat(30)}),function(t,o){if(a.length>0){var i=a.indexOf(this);i>=0?(a.splice(i+1),_.splice(i,1/0,t)):(a.push(this),_.push(t)),a.indexOf(o)>=0&&(o=s.call(this,t,o))}else a.push(o);return e?e.call(this,t,o):o}),o)}function c(t){for(var e=t.length,o=0;o<t.length;o++)t.charCodeAt(o)>256&&e++;return e}function l(t,e){for(var o="",i=0,r=0;r<t.length&&(t.charCodeAt(r)>256?i+=2:i+=1,!(i>e));r++)o+=t[r];return o}function h(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=function(){return i.isArray(this)?"[...]":"{...}"};return"object"!=typeof t?t.toString():Array.isArray(t)?e?_(t,void 0,void 0,o).replace(/"([^"]+)"/g,"$1"):_(t,void 0,void 0,o):_(t,void 0,void 0,o).replace(/([^"]+):"([^"]+)"/g,"$1:$2").replaceAll('"[...]"',"[...]").replaceAll('"{...}"',"{...}")}},4425(t,e,o){"use strict";o.d(e,{a:()=>a});var i=o(13414),r=o(49422),s=o(54427);function a(t){var e="function"==typeof Map?new Map:void 0;return(a=function(t){if(null===t||-1===Function.toString.call(t).indexOf("[native code]"))return t;if("function"!=typeof t)throw TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,o)}function o(){return s.a(t,arguments,i.a(this).constructor)}return o.prototype=Object.create(t.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),r.a(o,t)})(t)}},87379(t){"undefined"!=typeof self&&self,t.exports=function(t){function e(i){if(o[i])return o[i].exports;var r=o[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var o={};return e.m=t,e.c=o,e.d=function(t,o,i){e.o(t,o)||Object.defineProperty(t,o,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var o=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(o,"a",o),o},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="/dist/",e(e.s=58)}([function(t,e){var o=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=o)},function(t,e){var o=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=o)},function(t,e,o){var i=o(31)("wks"),r=o(22),s=o(0).Symbol,a="function"==typeof s;(t.exports=function(t){return i[t]||(i[t]=a&&s[t]||(a?s:r)("Symbol."+t))}).store=i},function(t,e,o){var i=o(8);t.exports=function(t){if(!i(t))throw TypeError(t+" is not an object!");return t}},function(t,e,o){t.exports=!o(10)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,o){var i=o(0),r=o(1),s=o(19),a=o(6),_=o(9),c=function t(e,o,c){var l,h,d,u=e&t.F,p=e&t.G,f=e&t.S,g=e&t.P,v=e&t.B,b=e&t.W,m=p?r:r[o]||(r[o]={}),y=m.prototype,k=p?i:f?i[o]:(i[o]||{}).prototype;for(l in p&&(c=o),c)!((h=!u&&k&&void 0!==k[l])&&_(m,l))&&(d=h?k[l]:c[l],m[l]=p&&"function"!=typeof k[l]?c[l]:v&&h?s(d,i):b&&k[l]==d?function(t){var e=function(e,o,i){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,o)}return new t(e,o,i)}return t.apply(this,arguments)};return e.prototype=t.prototype,e}(d):g&&"function"==typeof d?s(Function.call,d):d,g&&((m.virtual||(m.virtual={}))[l]=d,e&t.R&&y&&!y[l]&&a(y,l,d)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e,o){var i=o(7),r=o(21);t.exports=o(4)?function(t,e,o){return i.f(t,e,r(1,o))}:function(t,e,o){return t[e]=o,t}},function(t,e,o){var i=o(3),r=o(43),s=o(29),a=Object.defineProperty;e.f=o(4)?Object.defineProperty:function(t,e,o){if(i(t),e=s(e,!0),i(o),r)try{return a(t,e,o)}catch(t){}if("get"in o||"set"in o)throw TypeError("Accessors not supported!");return"value"in o&&(t[e]=o.value),t}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e){var o={}.hasOwnProperty;t.exports=function(t,e){return o.call(t,e)}},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,o){var i=o(47),r=o(27);t.exports=function(t){return i(r(t))}},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){return new Date().getTime()>t+864e5}function s(t){return(0,v.default)(t).filter(function(t){return t.startsWith("x:")}).map(function(e){return[e,t[e].toString()]})}function a(t){return"qiniu_js_sdk_upload_file_"+t.name+"_size_"+t.size}function _(t){try{return JSON.parse(localStorage.getItem(a(t)))||[]}catch(t){return window.console&&window.console.warn&&console.warn("getLocalFileInfo failed"),[]}}function c(t){return{Authorization:"UpToken "+t}}function l(){return window.XMLHttpRequest?new XMLHttpRequest:new window.ActiveXObject("Microsoft.XMLHTTP")}function h(t){return new p.default(function(e,o){var i=new FileReader;i.readAsArrayBuffer(t),i.onload=function(t){e(t.target.result)},i.onerror=function(){o(Error("fileReader "))}})}function d(t,e){return new p.default(function(o,i){var r=l();r.open(e.method,t),e.onCreate&&e.onCreate(r),e.headers&&(0,v.default)(e.headers).forEach(function(t){return r.setRequestHeader(t,e.headers[t])}),r.upload.addEventListener("progress",function(t){t.lengthComputable&&e.onProgress&&e.onProgress({loaded:t.loaded,total:t.total})}),r.onreadystatechange=function(){var t=r.responseText;if(4===r.readyState){var e=r.getResponseHeader("x-reqId")||"";if(200!==r.status){var s="xhr request failed, code: "+r.status+";";return t&&(s=s+" response: "+t),void i({code:r.status,message:s,reqId:e,isRequestError:!0})}try{o({data:JSON.parse(t),reqId:e})}catch(t){i(t)}}},r.send(e.body)})}function u(){return"http:"===window.location.protocol?"http:":"https:"}e.__esModule=!0;var p=i(o(18)),f=i(o(34)),g=i(o(86)),v=i(o(36));e.isChunkExpired=r,e.getChunks=function(t,e){for(var o=[],i=Math.ceil(t.size/e),r=0;r<i;r++){var s=t.slice(e*r,r===i-1?t.size:e*(r+1));o.push(s)}return o},e.filterParams=s,e.sum=function(t){return t.reduce(function(t,e){return t+e},0)},e.setLocalFileInfo=function(t,e){try{localStorage.setItem(a(t),(0,g.default)(e))}catch(t){window.console&&window.console.warn&&console.warn("setLocalFileInfo failed")}},e.removeLocalFileInfo=function(t){try{localStorage.removeItem(a(t))}catch(t){window.console&&window.console.warn&&console.warn("removeLocalFileInfo failed")}},e.getLocalFileInfo=_,e.getResumeUploadedSize=function(t){return _(t).filter(function(t){return t&&!r(t.time)}).reduce(function(t,e){return t+e.size},0)},e.createMkFileUrl=function(t,e,o,i){var r=t+"/mkfile/"+e.size;null!=o&&(r+="/key/"+(0,b.urlSafeBase64Encode)(o)),i.mimeType&&(r+="/mimeType/"+(0,b.urlSafeBase64Encode)(e.type));var a=i.fname;return a&&(r+="/fname/"+(0,b.urlSafeBase64Encode)(a)),i.params&&s(i.params).forEach(function(t){return r+="/"+encodeURIComponent(t[0])+"/"+(0,b.urlSafeBase64Encode)(t[1])}),r},e.getHeadersForChunkUpload=function(t){var e=c(t);return(0,f.default)({"content-type":"application/octet-stream"},e)},e.getHeadersForMkFile=function(t){var e=c(t);return(0,f.default)({"content-type":"text/plain"},e)},e.createXHR=l,e.computeMd5=function(t){return h(t).then(function(t){var e=new y.default.ArrayBuffer;return e.append(t),e.end()})},e.readAsArrayBuffer=h,e.request=d,e.getPortFromUrl=function(t){if(t&&t.match){var e=t.match(/(^https?)/);if(!e)return"";var o=e[1];return(e=t.match(/^https?:\/\/([^:^\/]*):(\d*)/))?e[2]:"http"===o?"80":"443"}return""},e.getDomainFromUrl=function(t){if(t&&t.match){var e=t.match(/^https?:\/\/([^:^\/]*)/);return e?e[1]:""}return""},e.getUploadUrl=function(t,e){var o=u();if(null!=t.uphost)return p.default.resolve(o+"//"+t.uphost);if(null!=t.region){var i=m.regionUphostMap[t.region],r=t.useCdnDomain?i.cdnUphost:i.srcUphost;return p.default.resolve(o+"//"+r)}return(function(t){try{var e,o,i,r=(o=(e=t.split(":"))[0],(i=JSON.parse((0,b.urlSafeBase64Decode)(e[2]))).ak=o,i.bucket=i.scope.split(":")[0],i);return d(u()+"//api.qiniu.com/v2/query?ak="+r.ak+"&bucket="+r.bucket,{method:"GET"})}catch(t){return p.default.reject(t)}})(e).then(function(t){return o+"//"+t.data.up.acc.main[0]})},e.isContainFileMimeType=function(t,e){return e.indexOf(t)>-1},e.createObjectURL=function(t){return(window.URL||window.webkitURL||window.mozURL).createObjectURL(t)},e.getTransform=function(t,e){var o=t.width,i=t.height;switch(e){case 1:return{width:o,height:i,matrix:[1,0,0,1,0,0]};case 2:return{width:o,height:i,matrix:[-1,0,0,1,o,0]};case 3:return{width:o,height:i,matrix:[-1,0,0,-1,o,i]};case 4:return{width:o,height:i,matrix:[1,0,0,-1,0,i]};case 5:return{width:i,height:o,matrix:[0,1,1,0,0,0]};case 6:return{width:i,height:o,matrix:[0,1,-1,0,i,0]};case 7:return{width:i,height:o,matrix:[0,-1,-1,0,i,o]};case 8:return{width:i,height:o,matrix:[0,-1,1,0,0,o]}}};var b=o(56),m=o(39),y=i(o(91))},function(t,e){t.exports=!0},function(t,e){t.exports={}},function(t,e,o){var i=o(46),r=o(32);t.exports=Object.keys||function(t){return i(t,r)}},function(t,e){var o={}.toString;t.exports=function(t){return o.call(t).slice(8,-1)}},function(t,e,o){"use strict";e.__esModule=!0,e.default=function(t,e){if(!(t instanceof e))throw TypeError("Cannot call a class as a function")}},function(t,e,o){t.exports={default:o(59),__esModule:!0}},function(t,e,o){var i=o(20);t.exports=function(t,e,o){if(i(t),void 0===e)return t;switch(o){case 1:return function(o){return t.call(e,o)};case 2:return function(o,i){return t.call(e,o,i)};case 3:return function(o,i,r){return t.call(e,o,i,r)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var o=0,i=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++o+i).toString(36))}},function(t,e,o){var i=o(7).f,r=o(9),s=o(2)("toStringTag");t.exports=function(t,e,o){t&&!r(t=o?t:t.prototype,s)&&i(t,s,{configurable:!0,value:e})}},function(t,e,o){var i=o(27);t.exports=function(t){return Object(i(t))}},function(t,e){e.f=({}).propertyIsEnumerable},function(t,e){var o=Math.ceil,i=Math.floor;t.exports=function(t){return isNaN(t*=1)?0:(t>0?i:o)(t)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,o){var i=o(8),r=o(0).document,s=i(r)&&i(r.createElement);t.exports=function(t){return s?r.createElement(t):{}}},function(t,e,o){var i=o(8);t.exports=function(t,e){var o,r;if(!i(t))return t;if(e&&"function"==typeof(o=t.toString)&&!i(r=o.call(t))||"function"==typeof(o=t.valueOf)&&!i(r=o.call(t))||!e&&"function"==typeof(o=t.toString)&&!i(r=o.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,o){var i=o(31)("keys"),r=o(22);t.exports=function(t){return i[t]||(i[t]=r(t))}},function(t,e,o){var i=o(1),r=o(0),s=r["__core-js_shared__"]||(r["__core-js_shared__"]={});(t.exports=function(t,e){return s[t]||(s[t]=void 0!==e?e:{})})("versions",[]).push({version:i.version,mode:o(13)?"pure":"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,o){"use strict";var i=o(20);t.exports.f=function(t){return new function(t){var e,o;this.promise=new t(function(t,i){if(void 0!==e||void 0!==o)throw TypeError("Bad Promise constructor");e=t,o=i}),this.resolve=i(e),this.reject=i(o)}(t)}},function(t,e,o){t.exports={default:o(83),__esModule:!0}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,o){t.exports={default:o(88),__esModule:!0}},function(t,e,o){e.f=o(2)},function(t,e,o){var i=o(0),r=o(1),s=o(13),a=o(37),_=o(7).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=s?{}:i.Symbol||{});"_"==t.charAt(0)||t in e||_(e,t,{value:a.f(t)})}},function(t,e,o){"use strict";e.__esModule=!0,e.regionUphostMap={z0:{srcUphost:"up.qiniup.com",cdnUphost:"upload.qiniup.com"},z1:{srcUphost:"up-z1.qiniup.com",cdnUphost:"upload-z1.qiniup.com"},z2:{srcUphost:"up-z2.qiniup.com",cdnUphost:"upload-z2.qiniup.com"},na0:{srcUphost:"up-na0.qiniup.com",cdnUphost:"upload-na0.qiniup.com"},as0:{srcUphost:"up-as0.qiniup.com",cdnUphost:"upload-as0.qiniup.com"}},e.region={z0:"z0",z1:"z1",z2:"z2",na0:"na0",as0:"as0"}},function(t,e){},function(t,e,o){"use strict";var i=o(60)(!0);o(42)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,o=this._i;return o>=e.length?{value:void 0,done:!0}:(t=i(e,o),this._i+=t.length,{value:t,done:!1})})},function(t,e,o){"use strict";var i=o(13),r=o(5),s=o(44),a=o(6),_=o(14),c=o(61),l=o(23),h=o(65),d=o(2)("iterator"),u=!([].keys&&"next"in[].keys()),p=function(){return this};t.exports=function(t,e,o,f,g,v,b){c(o,e,f);var m,y,k,w=function(t){if(!u&&t in I)return I[t];switch(t){case"keys":case"values":return function(){return new o(this,t)}}return function(){return new o(this,t)}},E=e+" Iterator",T="values"==g,x=!1,I=t.prototype,O=I[d]||I["@@iterator"]||g&&I[g],N=O||w(g),C=g?T?w("entries"):N:void 0,A="Array"==e&&I.entries||O;if(A&&(k=h(A.call(new t)))!==Object.prototype&&k.next&&(l(k,E,!0),i||"function"==typeof k[d]||a(k,d,p)),T&&O&&"values"!==O.name&&(x=!0,N=function(){return O.call(this)}),(!i||b)&&(u||x||!I[d])&&a(I,d,N),_[e]=N,_[E]=p,g)if(m={values:T?N:w("values"),keys:v?N:w("keys"),entries:C},b)for(y in m)y in I||s(I,y,m[y]);else r(r.P+r.F*(u||x),e,m);return m}},function(t,e,o){t.exports=!o(4)&&!o(10)(function(){return 7!=Object.defineProperty(o(28)("div"),"a",{get:function(){return 7}}).a})},function(t,e,o){t.exports=o(6)},function(t,e,o){var i=o(3),r=o(62),s=o(32),a=o(30)("IE_PROTO"),_=function(){},c=function(){var t,e=o(28)("iframe"),i=s.length;for(e.style.display="none",o(49).appendChild(e),e.src="javascript:",(t=e.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),c=t.F;i--;)delete c.prototype[s[i]];return c()};t.exports=Object.create||function(t,e){var o;return null!==t?(_.prototype=i(t),o=new _,_.prototype=null,o[a]=t):o=c(),void 0===e?o:r(o,e)}},function(t,e,o){var i=o(9),r=o(11),s=o(63)(!1),a=o(30)("IE_PROTO");t.exports=function(t,e){var o,_=r(t),c=0,l=[];for(o in _)o!=a&&i(_,o)&&l.push(o);for(;e.length>c;)i(_,o=e[c++])&&!~s(l,o)&&l.push(o);return l}},function(t,e,o){var i=o(16);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==i(t)?t.split(""):Object(t)}},function(t,e,o){var i=o(26),r=Math.min;t.exports=function(t){return t>0?r(i(t),0x1fffffffffffff):0}},function(t,e,o){var i=o(0).document;t.exports=i&&i.documentElement},function(t,e,o){o(66);for(var i=o(0),r=o(6),s=o(14),a=o(2)("toStringTag"),_="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<_.length;c++){var l=_[c],h=i[l],d=h&&h.prototype;d&&!d[a]&&r(d,a,l),s[l]=s.Array}},function(t,e,o){var i=o(16),r=o(2)("toStringTag"),s="Arguments"==i(function(){return arguments}());t.exports=function(t){var e,o,a;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(o=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),r))?o:s?i(e):"Object"==(a=i(e))&&"function"==typeof e.callee?"Arguments":a}},function(t,e,o){var i=o(3),r=o(20),s=o(2)("species");t.exports=function(t,e){var o,a=i(t).constructor;return void 0===a||void 0==(o=i(a)[s])?e:r(o)}},function(t,e,o){var i,r,s,a=o(19),_=o(75),c=o(49),l=o(28),h=o(0),d=h.process,u=h.setImmediate,p=h.clearImmediate,f=h.MessageChannel,g=h.Dispatch,v=0,b={},m=function(){var t=+this;if(b.hasOwnProperty(t)){var e=b[t];delete b[t],e()}},y=function(t){m.call(t.data)};u&&p||(u=function(t){for(var e=[],o=1;arguments.length>o;)e.push(arguments[o++]);return b[++v]=function(){_("function"==typeof t?t:Function(t),e)},i(v),v},p=function(t){delete b[t]},"process"==o(16)(d)?i=function(t){d.nextTick(a(m,t,1))}:g&&g.now?i=function(t){g.now(a(m,t,1))}:f?(s=(r=new f).port2,r.port1.onmessage=y,i=a(s.postMessage,s,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(i=function(t){h.postMessage(t+"","*")},h.addEventListener("message",y,!1)):i="onreadystatechange"in l("script")?function(t){c.appendChild(l("script")).onreadystatechange=function(){c.removeChild(this),m.call(t)}}:function(t){setTimeout(a(m,t,1),0)}),t.exports={set:u,clear:p}},function(t,e){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,e,o){var i=o(3),r=o(8),s=o(33);t.exports=function(t,e){if(i(t),r(e)&&e.constructor===t)return e;var o=s.f(t);return(0,o.resolve)(e),o.promise}},function(t,e,o){"use strict";e.__esModule=!0,e.urlSafeBase64Encode=function(t){return(t=function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,i=void 0,r=void 0,s=void 0,a=void 0,_=0,c=0,l="",h=[];if(!t)return t;t=function(t){if(null==t)return"";var e,o=t+"",i="",r=void 0,s=void 0;r=s=0,e=o.length;for(var a=0;a<e;a++){var _=o.charCodeAt(a),c=null;if(_<128)s++;else if(_>127&&_<2048)c=String.fromCharCode(_>>6|192,63&_|128);else if(63488&_^!0)c=String.fromCharCode(_>>12|224,_>>6&63|128,63&_|128);else{if(64512&_^!0)throw RangeError("Unmatched trail surrogate at "+a);var l=o.charCodeAt(++a);if(64512&l^!0)throw RangeError("Unmatched lead surrogate at "+(a-1));c=String.fromCharCode((_=((1023&_)<<10)+(1023&l)+65536)>>18|240,_>>12&63|128,_>>6&63|128,63&_|128)}null!==c&&(s>r&&(i+=o.slice(r,s)),i+=c,r=s=a+1)}return s>r&&(i+=o.slice(r,e)),i}(t+"");do o=(a=t.charCodeAt(_++)<<16|t.charCodeAt(_++)<<8|t.charCodeAt(_++))>>18&63,i=a>>12&63,r=a>>6&63,s=63&a,h[c++]=e.charAt(o)+e.charAt(i)+e.charAt(r)+e.charAt(s);while(_<t.length);switch(l=h.join(""),t.length%3){case 1:l=l.slice(0,-2)+"==";break;case 2:l=l.slice(0,-1)+"="}return l}(t)).replace(/\//g,"_").replace(/\+/g,"-")},e.urlSafeBase64Decode=function(t){return function(t){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o=void 0,i=void 0,r=void 0,s=void 0,a=void 0,_=void 0,c=0,l=0,h=[];if(!t)return t;t+="";do o=(_=e.indexOf(t.charAt(c++))<<18|e.indexOf(t.charAt(c++))<<12|(s=e.indexOf(t.charAt(c++)))<<6|(a=e.indexOf(t.charAt(c++))))>>16&255,i=_>>8&255,r=255&_,h[l++]=64===s?String.fromCharCode(o):64===a?String.fromCharCode(o,i):String.fromCharCode(o,i,r);while(c<t.length);return h.join("")}(t=t.replace(/_/g,"/").replace(/-/g,"+"))}},function(t,e,o){var i=o(46),r=o(32).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return i(t,r)}},function(t,e,o){"use strict";e.__esModule=!0,e.pipeline=e.compressImage=e.exif=e.imageInfo=e.watermark=e.imageMogr2=e.getUploadUrl=e.filterParams=e.getHeadersForMkFile=e.getResumeUploadedSize=e.getHeadersForChunkUpload=e.createMkFileUrl=e.region=e.upload=void 0;var i,r=o(39),s=o(12),a=o(92),_=o(94),c=o(95),l=o(109),h=(i=o(110))&&i.__esModule?i:{default:i},d=new l.StatisticsLogger;e.upload=function(t,e,o,i,r){var s={file:t,key:e,token:o,putExtra:i,config:r};return new c.Observable(function(t){var e=new a.UploadManager(s,{onData:function(e){return t.next(e)},onError:function(e){return t.error(e)},onComplete:function(e){return t.complete(e)}},d);return e.putFile(),e.stop.bind(e)})},e.region=r.region,e.createMkFileUrl=s.createMkFileUrl,e.getHeadersForChunkUpload=s.getHeadersForChunkUpload,e.getResumeUploadedSize=s.getResumeUploadedSize,e.getHeadersForMkFile=s.getHeadersForMkFile,e.filterParams=s.filterParams,e.getUploadUrl=s.getUploadUrl,e.imageMogr2=_.imageMogr2,e.watermark=_.watermark,e.imageInfo=_.imageInfo,e.exif=_.exif,e.compressImage=h.default,e.pipeline=_.pipeline},function(t,e,o){o(40),o(41),o(50),o(69),o(81),o(82),t.exports=o(1).Promise},function(t,e,o){var i=o(26),r=o(27);t.exports=function(t){return function(e,o){var s,a,_=String(r(e)),c=i(o),l=_.length;return c<0||c>=l?t?"":void 0:(s=_.charCodeAt(c))<55296||s>56319||c+1===l||(a=_.charCodeAt(c+1))<56320||a>57343?t?_.charAt(c):s:t?_.slice(c,c+2):a-56320+(s-55296<<10)+65536}}},function(t,e,o){"use strict";var i=o(45),r=o(21),s=o(23),a={};o(6)(a,o(2)("iterator"),function(){return this}),t.exports=function(t,e,o){t.prototype=i(a,{next:r(1,o)}),s(t,e+" Iterator")}},function(t,e,o){var i=o(7),r=o(3),s=o(15);t.exports=o(4)?Object.defineProperties:function(t,e){r(t);for(var o,a=s(e),_=a.length,c=0;_>c;)i.f(t,o=a[c++],e[o]);return t}},function(t,e,o){var i=o(11),r=o(48),s=o(64);t.exports=function(t){return function(e,o,a){var _,c=i(e),l=r(c.length),h=s(a,l);if(t&&o!=o){for(;l>h;)if((_=c[h++])!=_)return!0}else for(;l>h;h++)if((t||h in c)&&c[h]===o)return t||h||0;return!t&&-1}}},function(t,e,o){var i=o(26),r=Math.max,s=Math.min;t.exports=function(t,e){return(t=i(t))<0?r(t+e,0):s(t,e)}},function(t,e,o){var i=o(9),r=o(24),s=o(30)("IE_PROTO"),a=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return i(t=r(t),s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?a:null}},function(t,e,o){"use strict";var i=o(67),r=o(68),s=o(14),a=o(11);t.exports=o(42)(Array,"Array",function(t,e){this._t=a(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,o=this._i++;return!t||o>=t.length?(this._t=void 0,r(1)):r(0,"keys"==e?o:"values"==e?t[o]:[o,t[o]])},"values"),s.Arguments=s.Array,i("keys"),i("values"),i("entries")},function(t,e){t.exports=function(){}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e,o){"use strict";var i,r,s,a,_=o(13),c=o(0),l=o(19),h=o(51),d=o(5),u=o(8),p=o(20),f=o(70),g=o(71),v=o(52),b=o(53).set,m=o(76)(),y=o(33),k=o(54),w=o(77),E=o(55),T=c.TypeError,x=c.process,I=x&&x.versions,O=I&&I.v8||"",N=c.Promise,C="process"==h(x),A=function(){},S=r=y.f,L=!!function(){try{var t=N.resolve(1),e=(t.constructor={})[o(2)("species")]=function(t){t(A,A)};return(C||"function"==typeof PromiseRejectionEvent)&&t.then(A)instanceof e&&0!==O.indexOf("6.6")&&-1===w.indexOf("Chrome/66")}catch(t){}}(),D=function(t){var e;return!(!u(t)||"function"!=typeof(e=t.then))&&e},R=function(t,e){if(!t._n){t._n=!0;var o=t._c;m(function(){for(var i=t._v,r=1==t._s,s=0;o.length>s;)!function(e){var o,s,a,_=r?e.ok:e.fail,c=e.resolve,l=e.reject,h=e.domain;try{_?(r||(2==t._h&&P(t),t._h=1),!0===_?o=i:(h&&h.enter(),o=_(i),h&&(h.exit(),a=!0)),o===e.promise?l(T("Promise-chain cycle")):(s=D(o))?s.call(o,c,l):c(o)):l(i)}catch(t){h&&!a&&h.exit(),l(t)}}(o[s++]);t._c=[],t._n=!1,e&&!t._h&&M(t)})}},M=function(t){b.call(c,function(){var e,o,i,r=t._v,s=B(t);if(s&&(e=k(function(){C?x.emit("unhandledRejection",r,t):(o=c.onunhandledrejection)?o({promise:t,reason:r}):(i=c.console)&&i.error&&i.error("Unhandled promise rejection",r)}),t._h=C||B(t)?2:1),t._a=void 0,s&&e.e)throw e.v})},B=function(t){return 1!==t._h&&0===(t._a||t._c).length},P=function(t){b.call(c,function(){var e;C?x.emit("rejectionHandled",t):(e=c.onrejectionhandled)&&e({promise:t,reason:t._v})})},G=function(t){var e=this;e._d||(e._d=!0,(e=e._w||e)._v=t,e._s=2,e._a||(e._a=e._c.slice()),R(e,!0))},U=function t(e){var o,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===e)throw T("Promise can't be resolved itself");(o=D(e))?m(function(){var r={_w:i,_d:!1};try{o.call(e,l(t,r,1),l(G,r,1))}catch(t){G.call(r,t)}}):(i._v=e,i._s=1,R(i,!1))}catch(t){G.call({_w:i,_d:!1},t)}}};L||(N=function(t){f(this,N,"Promise","_h"),p(t),i.call(this);try{t(l(U,this,1),l(G,this,1))}catch(t){G.call(this,t)}},(i=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=o(78)(N.prototype,{then:function(t,e){var o=S(v(this,N));return o.ok="function"!=typeof t||t,o.fail="function"==typeof e&&e,o.domain=C?x.domain:void 0,this._c.push(o),this._a&&this._a.push(o),this._s&&R(this,!1),o.promise},catch:function(t){return this.then(void 0,t)}}),s=function(){var t=new i;this.promise=t,this.resolve=l(U,t,1),this.reject=l(G,t,1)},y.f=S=function(t){return t===N||t===a?new s(t):r(t)}),d(d.G+d.W+!L*d.F,{Promise:N}),o(23)(N,"Promise"),o(79)("Promise"),a=o(1).Promise,d(d.S+!L*d.F,"Promise",{reject:function(t){var e=S(this);return(0,e.reject)(t),e.promise}}),d(d.S+d.F*(_||!L),"Promise",{resolve:function(t){return E(_&&this===a?N:this,t)}}),d(d.S+!(L&&o(80)(function(t){N.all(t).catch(A)}))*d.F,"Promise",{all:function(t){var e=this,o=S(e),i=o.resolve,r=o.reject,s=k(function(){var o=[],s=0,a=1;g(t,!1,function(t){var _=s++,c=!1;o.push(void 0),a++,e.resolve(t).then(function(t){!c&&(c=!0,o[_]=t,--a||i(o))},r)}),--a||i(o)});return s.e&&r(s.v),o.promise},race:function(t){var e=this,o=S(e),i=o.reject,r=k(function(){g(t,!1,function(t){e.resolve(t).then(o.resolve,i)})});return r.e&&i(r.v),o.promise}})},function(t,e){t.exports=function(t,e,o,i){if(!(t instanceof e)||void 0!==i&&i in t)throw TypeError(o+": incorrect invocation!");return t}},function(t,e,o){var i=o(19),r=o(72),s=o(73),a=o(3),_=o(48),c=o(74),l={},h={};(e=t.exports=function(t,e,o,d,u){var p,f,g,v,b=u?function(){return t}:c(t),m=i(o,d,e?2:1),y=0;if("function"!=typeof b)throw TypeError(t+" is not iterable!");if(s(b)){for(p=_(t.length);p>y;y++)if((v=e?m(a(f=t[y])[0],f[1]):m(t[y]))===l||v===h)return v}else for(g=b.call(t);!(f=g.next()).done;)if((v=r(g,m,f.value,e))===l||v===h)return v}).BREAK=l,e.RETURN=h},function(t,e,o){var i=o(3);t.exports=function(t,e,o,r){try{return r?e(i(o)[0],o[1]):e(o)}catch(e){var s=t.return;throw void 0!==s&&i(s.call(t)),e}}},function(t,e,o){var i=o(14),r=o(2)("iterator"),s=Array.prototype;t.exports=function(t){return void 0!==t&&(i.Array===t||s[r]===t)}},function(t,e,o){var i=o(51),r=o(2)("iterator"),s=o(14);t.exports=o(1).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||s[i(t)]}},function(t,e){t.exports=function(t,e,o){var i=void 0===o;switch(e.length){case 0:return i?t():t.call(o);case 1:return i?t(e[0]):t.call(o,e[0]);case 2:return i?t(e[0],e[1]):t.call(o,e[0],e[1]);case 3:return i?t(e[0],e[1],e[2]):t.call(o,e[0],e[1],e[2]);case 4:return i?t(e[0],e[1],e[2],e[3]):t.call(o,e[0],e[1],e[2],e[3])}return t.apply(o,e)}},function(t,e,o){var i=o(0),r=o(53).set,s=i.MutationObserver||i.WebKitMutationObserver,a=i.process,_=i.Promise,c="process"==o(16)(a);t.exports=function(){var t,e,o,l=function(){var i,r;for(c&&(i=a.domain)&&i.exit();t;){r=t.fn,t=t.next;try{r()}catch(i){throw t?o():e=void 0,i}}e=void 0,i&&i.enter()};if(c)o=function(){a.nextTick(l)};else if(!s||i.navigator&&i.navigator.standalone)if(_&&_.resolve){var h=_.resolve(void 0);o=function(){h.then(l)}}else o=function(){r.call(i,l)};else{var d=!0,u=document.createTextNode("");new s(l).observe(u,{characterData:!0}),o=function(){u.data=d=!d}}return function(i){var r={fn:i,next:void 0};e&&(e.next=r),t||(t=r,o()),e=r}}},function(t,e,o){var i=o(0).navigator;t.exports=i&&i.userAgent||""},function(t,e,o){var i=o(6);t.exports=function(t,e,o){for(var r in e)o&&t[r]?t[r]=e[r]:i(t,r,e[r]);return t}},function(t,e,o){"use strict";var i=o(0),r=o(1),s=o(7),a=o(4),_=o(2)("species");t.exports=function(t){var e="function"==typeof r[t]?r[t]:i[t];a&&e&&!e[_]&&s.f(e,_,{configurable:!0,get:function(){return this}})}},function(t,e,o){var i=o(2)("iterator"),r=!1;try{var s=[7][i]();s.return=function(){r=!0},Array.from(s,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var o=!1;try{var s=[7],a=s[i]();a.next=function(){return{done:o=!0}},s[i]=function(){return a},t(s)}catch(t){}return o}},function(t,e,o){"use strict";var i=o(5),r=o(1),s=o(0),a=o(52),_=o(55);i(i.P+i.R,"Promise",{finally:function(t){var e=a(this,r.Promise||s.Promise),o="function"==typeof t;return this.then(o?function(o){return _(e,t()).then(function(){return o})}:t,o?function(o){return _(e,t()).then(function(){throw o})}:t)}})},function(t,e,o){"use strict";var i=o(5),r=o(33),s=o(54);i(i.S,"Promise",{try:function(t){var e=r.f(this),o=s(t);return(o.e?e.reject:e.resolve)(o.v),e.promise}})},function(t,e,o){o(84),t.exports=o(1).Object.assign},function(t,e,o){var i=o(5);i(i.S+i.F,"Object",{assign:o(85)})},function(t,e,o){"use strict";var i=o(4),r=o(15),s=o(35),a=o(25),_=o(24),c=o(47),l=Object.assign;t.exports=!l||o(10)(function(){var t={},e={},o=Symbol(),i="abcdefghijklmnopqrst";return t[o]=7,i.split("").forEach(function(t){e[t]=t}),7!=l({},t)[o]||Object.keys(l({},e)).join("")!=i})?function(t,e){for(var o=_(t),l=arguments.length,h=1,d=s.f,u=a.f;l>h;)for(var p,f=c(arguments[h++]),g=d?r(f).concat(d(f)):r(f),v=g.length,b=0;v>b;)p=g[b++],i&&!u.call(f,p)||(o[p]=f[p]);return o}:l},function(t,e,o){t.exports={default:o(87),__esModule:!0}},function(t,e,o){var i=o(1),r=i.JSON||(i.JSON={stringify:JSON.stringify});t.exports=function(t){return r.stringify.apply(r,arguments)}},function(t,e,o){o(89),t.exports=o(1).Object.keys},function(t,e,o){var i=o(24),r=o(15);o(90)("keys",function(){return function(t){return r(i(t))}})},function(t,e,o){var i=o(5),r=o(1),s=o(10);t.exports=function(t,e){var o=(r.Object||{})[t]||Object[t],a={};a[t]=e(o),i(i.S+i.F*s(function(){o(1)}),"Object",a)}},function(t,e,o){t.exports=function(t){"use strict";function e(t,e){var o=t[0],i=t[1],r=t[2],s=t[3];i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&r|~i&s)+e[0]-0x28955b88|0)<<7|o>>>25)+i|0)&i|~o&r)+e[1]-0x173848aa|0)<<12|s>>>20)+o|0)&o|~s&i)+e[2]+0x242070db|0)<<17|r>>>15)+s|0)&s|~r&o)+e[3]-0x3e423112|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&r|~i&s)+e[4]-0xa83f051|0)<<7|o>>>25)+i|0)&i|~o&r)+e[5]+0x4787c62a|0)<<12|s>>>20)+o|0)&o|~s&i)+e[6]-0x57cfb9ed|0)<<17|r>>>15)+s|0)&s|~r&o)+e[7]-0x2b96aff|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&r|~i&s)+e[8]+0x698098d8|0)<<7|o>>>25)+i|0)&i|~o&r)+e[9]-0x74bb0851|0)<<12|s>>>20)+o|0)&o|~s&i)+e[10]-42063|0)<<17|r>>>15)+s|0)&s|~r&o)+e[11]-0x76a32842|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&r|~i&s)+e[12]+0x6b901122|0)<<7|o>>>25)+i|0)&i|~o&r)+e[13]-0x2678e6d|0)<<12|s>>>20)+o|0)&o|~s&i)+e[14]-0x5986bc72|0)<<17|r>>>15)+s|0)&s|~r&o)+e[15]+0x49b40821|0)<<22|i>>>10)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&s|r&~s)+e[1]-0x9e1da9e|0)<<5|o>>>27)+i|0)&r|i&~r)+e[6]-0x3fbf4cc0|0)<<9|s>>>23)+o|0)&i|o&~i)+e[11]+0x265e5a51|0)<<14|r>>>18)+s|0)&o|s&~o)+e[0]-0x16493856|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&s|r&~s)+e[5]-0x29d0efa3|0)<<5|o>>>27)+i|0)&r|i&~r)+e[10]+0x2441453|0)<<9|s>>>23)+o|0)&i|o&~i)+e[15]-0x275e197f|0)<<14|r>>>18)+s|0)&o|s&~o)+e[4]-0x182c0438|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&s|r&~s)+e[9]+0x21e1cde6|0)<<5|o>>>27)+i|0)&r|i&~r)+e[14]-0x3cc8f82a|0)<<9|s>>>23)+o|0)&i|o&~i)+e[3]-0xb2af279|0)<<14|r>>>18)+s|0)&o|s&~o)+e[8]+0x455a14ed|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i&s|r&~s)+e[13]-0x561c16fb|0)<<5|o>>>27)+i|0)&r|i&~r)+e[2]-0x3105c08|0)<<9|s>>>23)+o|0)&i|o&~i)+e[7]+0x676f02d9|0)<<14|r>>>18)+s|0)&o|s&~o)+e[12]-0x72d5b376|0)<<20|i>>>12)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i^r^s)+e[5]-378558|0)<<4|o>>>28)+i|0)^i^r)+e[8]-0x788e097f|0)<<11|s>>>21)+o|0)^o^i)+e[11]+0x6d9d6122|0)<<16|r>>>16)+s|0)^s^o)+e[14]-0x21ac7f4|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i^r^s)+e[1]-0x5b4115bc|0)<<4|o>>>28)+i|0)^i^r)+e[4]+0x4bdecfa9|0)<<11|s>>>21)+o|0)^o^i)+e[7]-0x944b4a0|0)<<16|r>>>16)+s|0)^s^o)+e[10]-0x41404390|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i^r^s)+e[13]+0x289b7ec6|0)<<4|o>>>28)+i|0)^i^r)+e[0]-0x155ed806|0)<<11|s>>>21)+o|0)^o^i)+e[3]-0x2b10cf7b|0)<<16|r>>>16)+s|0)^s^o)+e[6]+0x4881d05|0)<<23|i>>>9)+r|0,i=((i+=((r=((r+=((s=((s+=((o=((o+=(i^r^s)+e[9]-0x262b2fc7|0)<<4|o>>>28)+i|0)^i^r)+e[12]-0x1924661b|0)<<11|s>>>21)+o|0)^o^i)+e[15]+0x1fa27cf8|0)<<16|r>>>16)+s|0)^s^o)+e[2]-0x3b53a99b|0)<<23|i>>>9)+r|0,i=((i+=((s=((s+=(i^((o=((o+=(r^(i|~s))+e[0]-0xbd6ddbc|0)<<6|o>>>26)+i|0)|~r))+e[7]+0x432aff97|0)<<10|s>>>22)+o|0)^((r=((r+=(o^(s|~i))+e[14]-0x546bdc59|0)<<15|r>>>17)+s|0)|~o))+e[5]-0x36c5fc7|0)<<21|i>>>11)+r|0,i=((i+=((s=((s+=(i^((o=((o+=(r^(i|~s))+e[12]+0x655b59c3|0)<<6|o>>>26)+i|0)|~r))+e[3]-0x70f3336e|0)<<10|s>>>22)+o|0)^((r=((r+=(o^(s|~i))+e[10]-1051523|0)<<15|r>>>17)+s|0)|~o))+e[1]-0x7a7ba22f|0)<<21|i>>>11)+r|0,i=((i+=((s=((s+=(i^((o=((o+=(r^(i|~s))+e[8]+0x6fa87e4f|0)<<6|o>>>26)+i|0)|~r))+e[15]-0x1d31920|0)<<10|s>>>22)+o|0)^((r=((r+=(o^(s|~i))+e[6]-0x5cfebcec|0)<<15|r>>>17)+s|0)|~o))+e[13]+0x4e0811a1|0)<<21|i>>>11)+r|0,i=((i+=((s=((s+=(i^((o=((o+=(r^(i|~s))+e[4]-0x8ac817e|0)<<6|o>>>26)+i|0)|~r))+e[11]-0x42c50dcb|0)<<10|s>>>22)+o|0)^((r=((r+=(o^(s|~i))+e[2]+0x2ad7d2bb|0)<<15|r>>>17)+s|0)|~o))+e[9]-0x14792c6f|0)<<21|i>>>11)+r|0,t[0]=o+t[0]|0,t[1]=i+t[1]|0,t[2]=r+t[2]|0,t[3]=s+t[3]|0}function o(t){var e,o=[];for(e=0;e<64;e+=4)o[e>>2]=t.charCodeAt(e)+(t.charCodeAt(e+1)<<8)+(t.charCodeAt(e+2)<<16)+(t.charCodeAt(e+3)<<24);return o}function i(t){var e,o=[];for(e=0;e<64;e+=4)o[e>>2]=t[e]+(t[e+1]<<8)+(t[e+2]<<16)+(t[e+3]<<24);return o}function r(t){var i,r,s,a,_,c,l=t.length,h=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(i=64;i<=l;i+=64)e(h,o(t.substring(i-64,i)));for(r=(t=t.substring(i-64)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i=0;i<r;i+=1)s[i>>2]|=t.charCodeAt(i)<<(i%4<<3);if(s[i>>2]|=128<<(i%4<<3),i>55)for(e(h,s),i=0;i<16;i+=1)s[i]=0;return _=parseInt((a=(a=8*l).toString(16).match(/(.*?)(.{0,8})$/))[2],16),c=parseInt(a[1],16)||0,s[14]=_,s[15]=c,e(h,s),h}function s(t){var e;for(e=0;e<t.length;e+=1)t[e]=function(t){var e,o="";for(e=0;e<4;e+=1)o+=l[t>>8*e+4&15]+l[t>>8*e&15];return o}(t[e]);return t.join("")}function a(t){return/[\u0080-\uFFFF]/.test(t)&&(t=unescape(encodeURIComponent(t))),t}function _(t){var e,o=[],i=t.length;for(e=0;e<i-1;e+=2)o.push(parseInt(t.substr(e,2),16));return String.fromCharCode.apply(String,o)}function c(){this.reset()}var l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return s(r("hello")),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function t(t,e){return(t=0|t||0)<0?Math.max(t+e,0):Math.min(t,e)}ArrayBuffer.prototype.slice=function(e,o){var i,r,s,a,_=this.byteLength,c=t(e,_),l=_;return void 0!==o&&(l=t(o,_)),c>l?new ArrayBuffer(0):(s=new Uint8Array(r=new ArrayBuffer(i=l-c)),a=new Uint8Array(this,c,i),s.set(a),r)}}(),c.prototype.append=function(t){return this.appendBinary(a(t)),this},c.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var i,r=this._buff.length;for(i=64;i<=r;i+=64)e(this._hash,o(this._buff.substring(i-64,i)));return this._buff=this._buff.substring(i-64),this},c.prototype.end=function(t){var e,o,i=this._buff,r=i.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r;e+=1)a[e>>2]|=i.charCodeAt(e)<<(e%4<<3);return this._finish(a,r),o=s(this._hash),t&&(o=_(o)),this.reset(),o},c.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[0x67452301,-0x10325477,-0x67452302,0x10325476],this},c.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},c.prototype.setState=function(t){return this._buff=t.buff,this._length=t.length,this._hash=t.hash,this},c.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},c.prototype._finish=function(t,o){var i,r,s,a=o;if(t[a>>2]|=128<<(a%4<<3),a>55)for(e(this._hash,t),a=0;a<16;a+=1)t[a]=0;r=parseInt((i=(i=8*this._length).toString(16).match(/(.*?)(.{0,8})$/))[2],16),s=parseInt(i[1],16)||0,t[14]=r,t[15]=s,e(this._hash,t)},c.hash=function(t,e){return c.hashBinary(a(t),e)},c.hashBinary=function(t,e){var o=s(r(t));return e?_(o):o},c.ArrayBuffer=function(){this.reset()},c.ArrayBuffer.prototype.append=function(t){var o,r,s,a=(o=this._buff.buffer,(r=new Uint8Array(o.byteLength+t.byteLength)).set(new Uint8Array(o)),r.set(new Uint8Array(t),o.byteLength),r),_=a.length;for(this._length+=t.byteLength,s=64;s<=_;s+=64)e(this._hash,i(a.subarray(s-64,s)));return this._buff=new Uint8Array(s-64<_?a.buffer.slice(s-64):0),this},c.ArrayBuffer.prototype.end=function(t){var e,o,i=this._buff,r=i.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(e=0;e<r;e+=1)a[e>>2]|=i[e]<<(e%4<<3);return this._finish(a,r),o=s(this._hash),t&&(o=_(o)),this.reset(),o},c.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[0x67452301,-0x10325477,-0x67452302,0x10325476],this},c.ArrayBuffer.prototype.getState=function(){var t,e=c.prototype.getState.call(this);return t=e.buff,e.buff=String.fromCharCode.apply(null,new Uint8Array(t)),e},c.ArrayBuffer.prototype.setState=function(t){return t.buff=function(t,e){var o,i=t.length,r=new Uint8Array(new ArrayBuffer(i));for(o=0;o<i;o+=1)r[o]=t.charCodeAt(o);return r}(t.buff),c.prototype.setState.call(this,t)},c.ArrayBuffer.prototype.destroy=c.prototype.destroy,c.ArrayBuffer.prototype._finish=c.prototype._finish,c.ArrayBuffer.hash=function(t,o){var r=s(function(t){var o,r,s,a,_,c,l=t.length,h=[0x67452301,-0x10325477,-0x67452302,0x10325476];for(o=64;o<=l;o+=64)e(h,i(t.subarray(o-64,o)));for(r=(t=o-64<l?t.subarray(o-64):new Uint8Array(0)).length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<r;o+=1)s[o>>2]|=t[o]<<(o%4<<3);if(s[o>>2]|=128<<(o%4<<3),o>55)for(e(h,s),o=0;o<16;o+=1)s[o]=0;return _=parseInt((a=(a=8*l).toString(16).match(/(.*?)(.{0,8})$/))[2],16),c=parseInt(a[1],16)||0,s[14]=_,s[15]=c,e(h,s),h}(new Uint8Array(t)));return o?_(r):r},c}()},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.UploadManager=void 0;var r=i(o(18)),s=i(o(34)),a=i(o(17)),_=o(12),c=o(93);e.UploadManager=function(){function t(e,o,i){var r=this;(0,a.default)(this,t),this.config=(0,s.default)({useCdnDomain:!0,disableStatisticsReport:!1,retryCount:3,checkByMD5:!1,uphost:null,forceDirect:!1,concurrentRequestLimit:3,region:null},e.config),this.putExtra=(0,s.default)({fname:"",params:{},mimeType:null},e.putExtra),this.statisticsLogger=i,this.progress=null,this.xhrList=[],this.xhrHandler=function(t){return r.xhrList.push(t)},this.aborted=!1,this.file=e.file,this.key=e.key,this.token=e.token,this.onData=function(){},this.onError=function(){},this.onComplete=function(){},this.retryCount=0,(0,s.default)(this,o)}return t.prototype.putFile=function(){var t=this;if(this.aborted=!1,this.putExtra.fname||(this.putExtra.fname=this.file.name),!this.putExtra.mimeType||!this.putExtra.mimeType.length||(0,_.isContainFileMimeType)(this.file.type,this.putExtra.mimeType)){var e=(0,_.getUploadUrl)(this.config,this.token).then(function(e){return t.uploadUrl=e,t.uploadAt=new Date().getTime(),t.config.forceDirect?t.directUpload():t.file.size>4194304?t.resumeUpload():t.directUpload()});return e.then(function(e){t.onComplete(e.data),t.config.disableStatisticsReport||t.sendLog(e.reqId,200)},function(e){if(t.clear(),e.isRequestError&&!t.config.disableStatisticsReport){var o=t.aborted?"":e.reqId,i=t.aborted?-2:e.code;t.sendLog(o,i)}var r=e.isRequestError&&0===e.code&&!t.aborted,s=++t.retryCount<=t.config.retryCount;r&&s?t.putFile():t.onError(e)}),e}var o=Error("file type doesn't match with what you specify");this.onError(o)},t.prototype.clear=function(){this.xhrList.forEach(function(t){return t.abort()}),this.xhrList=[]},t.prototype.stop=function(){this.clear(),this.aborted=!0},t.prototype.sendLog=function(t,e){this.statisticsLogger.log({code:e,reqId:t,host:(0,_.getDomainFromUrl)(this.uploadUrl),remoteIp:"",port:(0,_.getPortFromUrl)(this.uploadUrl),duration:(new Date().getTime()-this.uploadAt)/1e3,time:Math.floor(this.uploadAt/1e3),bytesSent:this.progress?this.progress.total.loaded:0,upType:"jssdk-h5",size:this.file.size},this.token)},t.prototype.directUpload=function(){var t=this,e=new FormData;return e.append("file",this.file),e.append("token",this.token),null!=this.key&&e.append("key",this.key),e.append("fname",this.putExtra.fname),(0,_.filterParams)(this.putExtra.params).forEach(function(t){return e.append(t[0],t[1])}),(0,_.request)(this.uploadUrl,{method:"POST",body:e,onProgress:function(e){t.updateDirectProgress(e.loaded,e.total)},onCreate:this.xhrHandler}).then(function(e){return t.finishDirectProgress(),e})},t.prototype.resumeUpload=function(){var t=this;this.loaded={mkFileProgress:0,chunks:null},this.ctxList=[],this.localInfo=(0,_.getLocalFileInfo)(this.file),this.chunks=(0,_.getChunks)(this.file,4194304),this.initChunksProgress();var e=new c.Pool(function(e){return t.uploadChunk(e)},this.config.concurrentRequestLimit),o=this.chunks.map(function(t,o){return e.enqueue({chunk:t,index:o})}),i=r.default.all(o).then(function(){return t.mkFileReq()});return i.then(function(e){(0,_.removeLocalFileInfo)(t.file)},function(e){701===e.code&&(0,_.removeLocalFileInfo)(t.file)}),i},t.prototype.uploadChunk=function(t){var e=this,o=t.index,i=t.chunk,s=this.localInfo[o],a=this.uploadUrl+"/mkblk/"+i.size,c=s&&!(0,_.isChunkExpired)(s.time),l=this.config.checkByMD5,h=function(){return e.updateChunkProgress(i.size,o),e.ctxList[o]={ctx:s.ctx,size:s.size,time:s.time,md5:s.md5},r.default.resolve(null)};return c&&!l?h():(0,_.computeMd5)(i).then(function(t){if(c&&t===s.md5)return h();var r=(0,_.getHeadersForChunkUpload)(e.token),l=function(t){e.updateChunkProgress(t.loaded,o)},d=e.xhrHandler;return(0,_.request)(a,{method:"POST",headers:r,body:i,onProgress:l,onCreate:d}).then(function(r){l({loaded:i.size}),e.ctxList[o]={time:new Date().getTime(),ctx:r.data.ctx,size:i.size,md5:t},(0,_.setLocalFileInfo)(e.file,e.ctxList)})})},t.prototype.mkFileReq=function(){var t=this,e=(0,s.default)({mimeType:"application/octet-stream"},this.putExtra),o=(0,_.createMkFileUrl)(this.uploadUrl,this.file,this.key,e),i=this.ctxList.map(function(t){return t.ctx}).join(","),a=(0,_.getHeadersForMkFile)(this.token),c=this.xhrHandler;return(0,_.request)(o,{method:"POST",body:i,headers:a,onCreate:c}).then(function(e){return t.updateMkFileProgress(1),r.default.resolve(e)})},t.prototype.updateDirectProgress=function(t,e){this.progress={total:this.getProgressInfoItem(t,e+1)},this.onData(this.progress)},t.prototype.finishDirectProgress=function(){if(!this.progress)return this.progress={total:this.getProgressInfoItem(this.file.size,this.file.size)},void this.onData(this.progress);var t=this.progress.total;this.progress={total:this.getProgressInfoItem(t.loaded+1,t.size)},this.onData(this.progress)},t.prototype.initChunksProgress=function(){this.loaded.chunks=this.chunks.map(function(t){return 0}),this.notifyResumeProgress()},t.prototype.updateChunkProgress=function(t,e){this.loaded.chunks[e]=t,this.notifyResumeProgress()},t.prototype.updateMkFileProgress=function(t){this.loaded.mkFileProgress=t,this.notifyResumeProgress()},t.prototype.notifyResumeProgress=function(){var t=this;this.progress={total:this.getProgressInfoItem((0,_.sum)(this.loaded.chunks)+this.loaded.mkFileProgress,this.file.size+1),chunks:this.chunks.map(function(e,o){return t.getProgressInfoItem(t.loaded.chunks[o],e.size)})},this.onData(this.progress)},t.prototype.getProgressInfoItem=function(t,e){return{loaded:t,size:e,percent:t/e*100}},t}()},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.Pool=void 0;var r=i(o(18)),s=i(o(17));e.Pool=function(){function t(e,o){(0,s.default)(this,t),this.runTask=e,this.queue=[],this.processing=[],this.limit=o}return t.prototype.enqueue=function(t){var e=this;return new r.default(function(o,i){e.queue.push({task:t,resolve:o,reject:i}),e.check()})},t.prototype.run=function(t){var e=this;this.queue=this.queue.filter(function(e){return e!==t}),this.processing.push(t),this.runTask(t.task).then(function(){e.processing=e.processing.filter(function(e){return e!==t}),t.resolve(),e.check()},function(e){return t.reject(e)})},t.prototype.check=function(){var t=this,e=this.processing.length,o=this.limit-e;this.queue.slice(0,o).forEach(function(e,o){t.run(e)})},t}()},function(t,e,o){"use strict";function i(t,e){return t=encodeURIComponent(t),"/"!==e.slice(e.length-1)&&(e+="/"),e+t}function r(t,e,o){if(!/^\d$/.test(t.mode))throw"mode should be number in imageView2";var r=t.mode,s=t.w,a=t.h,_=t.q,c=t.format;if(!s&&!a)throw"param w and h is empty in imageView2";var l="imageView2/"+encodeURIComponent(r);return l+=(s?"/w/"+encodeURIComponent(s):"")+(a?"/h/"+encodeURIComponent(a):"")+(_?"/q/"+encodeURIComponent(_):"")+(c?"/format/"+encodeURIComponent(c):""),e&&(l=i(e,o)+"?"+l),l}function s(t,e,o){var r=t["auto-orient"],s=t.thumbnail,a=t.strip,_=t.gravity,c=t.crop,l=t.quality,h=t.rotate,d=t.format,u=t.blur,p="imageMogr2";return p+=(r?"/auto-orient":"")+(s?"/thumbnail/"+encodeURIComponent(s):"")+(a?"/strip":"")+(_?"/gravity/"+encodeURIComponent(_):"")+(l?"/quality/"+encodeURIComponent(l):"")+(c?"/crop/"+encodeURIComponent(c):"")+(h?"/rotate/"+encodeURIComponent(h):"")+(d?"/format/"+encodeURIComponent(d):"")+(u?"/blur/"+encodeURIComponent(u):""),e&&(p=i(e,o)+"?"+p),p}function a(t,e,o){var r=t.mode;if(!r)throw"mode can't be empty in watermark";var s="watermark/"+r;if(1!==r&&2!==r)throw"mode is wrong";if(1===r){var a=t.image;if(!a)throw"image can't be empty in watermark";s+=a?"/image/"+(0,c.urlSafeBase64Encode)(a):""}if(2===r){var _=t.text,l=t.font,h=t.fontsize,d=t.fill;if(!_)throw"text can't be empty in watermark";s+=(_?"/text/"+(0,c.urlSafeBase64Encode)(_):"")+(l?"/font/"+(0,c.urlSafeBase64Encode)(l):"")+(h?"/fontsize/"+h:"")+(d?"/fill/"+(0,c.urlSafeBase64Encode)(d):"")}var u=t.dissolve,p=t.gravity,f=t.dx,g=t.dy;return s+=(u?"/dissolve/"+encodeURIComponent(u):"")+(p?"/gravity/"+encodeURIComponent(p):"")+(f?"/dx/"+encodeURIComponent(f):"")+(g?"/dy/"+encodeURIComponent(g):""),e&&(s=i(e,o)+"?"+s),s}e.__esModule=!0,e.imageView2=r,e.imageMogr2=s,e.watermark=a,e.imageInfo=function(t,e){var o=i(t,e)+"?imageInfo";return(0,_.request)(o,{method:"GET"})},e.exif=function(t,e){var o=i(t,e)+"?exif";return(0,_.request)(o,{method:"GET"})},e.pipeline=function(t,e,o){var _=void 0,c=void 0,l="";if("[object Array]"===Object.prototype.toString.call(t)){for(var h=0,d=t.length;h<d;h++){if(!(_=t[h]).fop)throw"fop can't be empty in pipeline";switch(_.fop){case"watermark":l+=a(_)+"|";break;case"imageView2":l+=r(_)+"|";break;case"imageMogr2":l+=s(_)+"|";break;default:c=!0}if(c)throw"fop is wrong in pipeline"}if(e){var u=(l=i(e,o)+"?"+l).length;"|"===l.slice(u-1)&&(l=l.slice(0,u-1))}return l}throw"pipeline's first param should be array"};var _=o(12),c=o(56)},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.Observable=void 0;var r=i(o(96)),s=i(o(17));e.Observable=function(){function t(e){(0,s.default)(this,t),this.subscribeAction=e}return t.prototype.subscribe=function(t,e,o){var i=new a(t,e,o),r=this.subscribeAction(i);return new _(i,r)},t}();var a=function(){function t(e,o,i){(0,s.default)(this,t),this.isStopped=!1,"object"===(void 0===e?"undefined":(0,r.default)(e))?(this._onNext=e.next,this._onError=e.error,this._onCompleted=e.complete):(this._onNext=e,this._onError=o,this._onCompleted=i)}return t.prototype.next=function(t){!this.isStopped&&this._onNext&&this._onNext(t)},t.prototype.error=function(t){!this.isStopped&&this._onError&&(this.isStopped=!0,this._onError(t))},t.prototype.complete=function(t){!this.isStopped&&this._onCompleted&&(this.isStopped=!0,this._onCompleted(t))},t}(),_=function(){function t(e,o){(0,s.default)(this,t),this.observer=e,this.result=o}return t.prototype.unsubscribe=function(){this.observer.isStopped=!0,this.result()},t}()},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(o(97)),s=i(o(99)),a="function"==typeof s.default&&"symbol"==typeof r.default?function(t){return typeof t}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":typeof t};e.default="function"==typeof s.default&&"symbol"===a(r.default)?function(t){return void 0===t?"undefined":a(t)}:function(t){return t&&"function"==typeof s.default&&t.constructor===s.default&&t!==s.default.prototype?"symbol":void 0===t?"undefined":a(t)}},function(t,e,o){t.exports={default:o(98),__esModule:!0}},function(t,e,o){o(41),o(50),t.exports=o(37).f("iterator")},function(t,e,o){t.exports={default:o(100),__esModule:!0}},function(t,e,o){o(101),o(40),o(107),o(108),t.exports=o(1).Symbol},function(t,e,o){"use strict";var i=o(0),r=o(9),s=o(4),a=o(5),_=o(44),c=o(102).KEY,l=o(10),h=o(31),d=o(23),u=o(22),p=o(2),f=o(37),g=o(38),v=o(103),b=o(104),m=o(3),y=o(8),k=o(24),w=o(11),E=o(29),T=o(21),x=o(45),I=o(105),O=o(106),N=o(35),C=o(7),A=o(15),S=O.f,L=C.f,D=I.f,R=i.Symbol,M=i.JSON,B=M&&M.stringify,P=p("_hidden"),G=p("toPrimitive"),U={}.propertyIsEnumerable,F=h("symbol-registry"),z=h("symbols"),j=h("op-symbols"),H=Object.prototype,W="function"==typeof R&&!!N.f,V=i.QObject,X=!V||!V.prototype||!V.prototype.findChild,Y=s&&l(function(){return 7!=x(L({},"a",{get:function(){return L(this,"a",{value:7}).a}})).a})?function(t,e,o){var i=S(H,e);i&&delete H[e],L(t,e,o),i&&t!==H&&L(H,e,i)}:L,K=function(t){var e=z[t]=x(R.prototype);return e._k=t,e},q=W&&"symbol"==typeof R.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof R},J=function t(e,o,i){return e===H&&t(j,o,i),m(e),o=E(o,!0),m(i),r(z,o)?(i.enumerable?(r(e,P)&&e[P][o]&&(e[P][o]=!1),i=x(i,{enumerable:T(0,!1)})):(r(e,P)||L(e,P,T(1,{})),e[P][o]=!0),Y(e,o,i)):L(e,o,i)},Q=function(t,e){m(t);for(var o,i=v(e=w(e)),r=0,s=i.length;s>r;)J(t,o=i[r++],e[o]);return t},Z=function(t){var e=U.call(this,t=E(t,!0));return!(this===H&&r(z,t)&&!r(j,t))&&(!(e||!r(this,t)||!r(z,t)||r(this,P)&&this[P][t])||e)},$=function(t,e){if(t=w(t),e=E(e,!0),t!==H||!r(z,e)||r(j,e)){var o=S(t,e);return!o||!r(z,e)||r(t,P)&&t[P][e]||(o.enumerable=!0),o}},tt=function(t){for(var e,o=D(w(t)),i=[],s=0;o.length>s;)r(z,e=o[s++])||e==P||e==c||i.push(e);return i},te=function(t){for(var e,o=t===H,i=D(o?j:w(t)),s=[],a=0;i.length>a;)r(z,e=i[a++])&&(!o||r(H,e))&&s.push(z[e]);return s};W||(_((R=function(){if(this instanceof R)throw TypeError("Symbol is not a constructor!");var t=u(arguments.length>0?arguments[0]:void 0);return s&&X&&Y(H,t,{configurable:!0,set:function e(o){this===H&&e.call(j,o),r(this,P)&&r(this[P],t)&&(this[P][t]=!1),Y(this,t,T(1,o))}}),K(t)}).prototype,"toString",function(){return this._k}),O.f=$,C.f=J,o(57).f=I.f=tt,o(25).f=Z,N.f=te,s&&!o(13)&&_(H,"propertyIsEnumerable",Z,!0),f.f=function(t){return K(p(t))}),a(a.G+a.W+!W*a.F,{Symbol:R});for(var to="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ti=0;to.length>ti;)p(to[ti++]);for(var tn=A(p.store),tr=0;tn.length>tr;)g(tn[tr++]);a(a.S+!W*a.F,"Symbol",{for:function(t){return r(F,t+="")?F[t]:F[t]=R(t)},keyFor:function(t){if(!q(t))throw TypeError(t+" is not a symbol!");for(var e in F)if(F[e]===t)return e},useSetter:function(){X=!0},useSimple:function(){X=!1}}),a(a.S+!W*a.F,"Object",{create:function(t,e){return void 0===e?x(t):Q(x(t),e)},defineProperty:J,defineProperties:Q,getOwnPropertyDescriptor:$,getOwnPropertyNames:tt,getOwnPropertySymbols:te});var ts=l(function(){N.f(1)});a(a.S+a.F*ts,"Object",{getOwnPropertySymbols:function(t){return N.f(k(t))}}),M&&a(a.S+a.F*(!W||l(function(){var t=R();return"[null]"!=B([t])||"{}"!=B({a:t})||"{}"!=B(Object(t))})),"JSON",{stringify:function(t){for(var e,o,i=[t],r=1;arguments.length>r;)i.push(arguments[r++]);if(o=e=i[1],(y(e)||void 0!==t)&&!q(t))return b(e)||(e=function(t,e){if("function"==typeof o&&(e=o.call(this,t,e)),!q(e))return e}),i[1]=e,B.apply(M,i)}}),R.prototype[G]||o(6)(R.prototype,G,R.prototype.valueOf),d(R,"Symbol"),d(Math,"Math",!0),d(i.JSON,"JSON",!0)},function(t,e,o){var i=o(22)("meta"),r=o(8),s=o(9),a=o(7).f,_=0,c=Object.isExtensible||function(){return!0},l=!o(10)(function(){return c(Object.preventExtensions({}))}),h=function(t){a(t,i,{value:{i:"O"+ ++_,w:{}}})},d=t.exports={KEY:i,NEED:!1,fastKey:function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,i)){if(!c(t))return"F";if(!e)return"E";h(t)}return t[i].i},getWeak:function(t,e){if(!s(t,i)){if(!c(t))return!0;if(!e)return!1;h(t)}return t[i].w},onFreeze:function(t){return l&&d.NEED&&c(t)&&!s(t,i)&&h(t),t}}},function(t,e,o){var i=o(15),r=o(35),s=o(25);t.exports=function(t){var e=i(t),o=r.f;if(o)for(var a,_=o(t),c=s.f,l=0;_.length>l;)c.call(t,a=_[l++])&&e.push(a);return e}},function(t,e,o){var i=o(16);t.exports=Array.isArray||function(t){return"Array"==i(t)}},function(t,e,o){var i=o(11),r=o(57).f,s={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return a&&"[object Window]"==s.call(t)?function(t){try{return r(t)}catch(t){return a.slice()}}(t):r(i(t))}},function(t,e,o){var i=o(25),r=o(21),s=o(11),a=o(29),_=o(9),c=o(43),l=Object.getOwnPropertyDescriptor;e.f=o(4)?l:function(t,e){if(t=s(t),e=a(e,!0),c)try{return l(t,e)}catch(t){}if(_(t,e))return r(!i.f.call(t,e),t[e])}},function(t,e,o){o(38)("asyncIterator")},function(t,e,o){o(38)("observable")},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0,e.StatisticsLogger=void 0;var r=i(o(36)),s=i(o(17)),a=o(12);e.StatisticsLogger=function(){function t(){(0,s.default)(this,t)}return t.prototype.log=function(t,e){var o="";(0,r.default)(t).forEach(function(e){return o+=t[e]+","}),this.send(o,e,0)},t.prototype.send=function(t,e,o){var i=(0,a.createXHR)(),r=this;i.open("POST","https://uplog.qbox.me/log/3"),i.setRequestHeader("Content-type","application/x-www-form-urlencoded"),i.setRequestHeader("Authorization","UpToken "+e),i.onreadystatechange=function(){4===i.readyState&&200!==i.status&&++o<=3&&r.send(t,e,o)},i.send(t)},t}()},function(t,e,o){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}e.__esModule=!0;var r=i(o(18)),s=i(o(34)),a=i(o(17)),_=i(o(36)),c=o(111),l=o(12),h={PNG:"image/png",JPEG:"image/jpeg",WEBP:"image/webp",BMP:"image/bmp"},d=Math.log(2),u=(0,_.default)(h).map(function(t){return h[t]}),p=h.JPEG,f=function(){function t(e,o){(0,a.default)(this,t),this.config=(0,s.default)({quality:.92,noCompressIfLarger:!1},o),this.file=e}return t.prototype.process=function(){var t,e=this;this.outputType=this.file.type;var o={};return(t=this.file.type,u.includes(t))?this.getOriginImage().then(function(t){return e.getCanvas(t)}).then(function(t){var i=1;return e.config.maxWidth&&(i=Math.min(1,e.config.maxWidth/t.width)),e.config.maxHeight&&(i=Math.min(1,i,e.config.maxHeight/t.height)),o.width=t.width,o.height=t.height,e.doScale(t,i)}).then(function(t){var i=e.toBlob(t);return i.size>e.file.size&&e.config.noCompressIfLarger?{dist:e.file,width:o.width,height:o.height}:{dist:i,width:t.width,height:t.height}}):r.default.reject(Error("unsupported file type: "+this.file.type))},t.prototype.clear=function(t,e,o){this.outputType===p?(t.fillStyle="#fff",t.fillRect(0,0,e,o)):t.clearRect(0,0,e,o)},t.prototype.getOriginImage=function(){var t=this;return new r.default(function(e,o){var i=(0,l.createObjectURL)(t.file),r=new Image;r.onload=function(){e(r)},r.onerror=function(){o("image load error")},r.src=i})},t.prototype.getCanvas=function(t){var e=this;return new r.default(function(o,i){c.EXIF.getData(t,function(){var i=c.EXIF.getTag(t,"Orientation")||1,r=(0,l.getTransform)(t,i),s=r.width,a=r.height,_=r.matrix,h=document.createElement("canvas"),d=h.getContext("2d");h.width=s,h.height=a,e.clear(d,s,a),d.transform.apply(d,_),d.drawImage(t,0,0),o(h)})})},t.prototype.doScale=function(t,e){if(1===e)return r.default.resolve(t);var o=t.getContext("2d"),i=Math.min(4,Math.ceil(1/e/d)),s=Math.pow(e,1/i),a=document.createElement("canvas"),_=a.getContext("2d"),c=t.width,l=t.height,h=c,u=l;a.width=c,a.height=l;for(var p=void 0,f=void 0,g=0;g<i;g++){var v=c*s|0,b=l*s|0;g===i-1&&(v=h*e,b=u*e),g%2==0?(p=t,f=_):(p=a,f=o),this.clear(f,c,l),f.drawImage(p,0,0,c,l,0,0,v,b),c=v,l=b}var m=p===t?a:t,y=f.getImageData(0,0,c,l);return m.width=c,m.height=l,f.putImageData(y,0,0),r.default.resolve(m)},t.prototype.toBlob=function(t){return new Blob([new Uint8Array(atob(t.toDataURL(this.outputType,this.config.quality).split(",")[1]).split("").map(function(t){return t.charCodeAt(0)}))],{type:this.outputType})},t}();e.default=function(t,e){return new f(t,e).process()}},function(t,e,o){var i;(function(){function o(t){return!!t.exifdata}function r(t){var e=new DataView(t);if(c&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return c&&console.log("Not a valid JPEG"),!1;for(var o,i=2,r=t.byteLength;i<r;){if(255!=e.getUint8(i))return c&&console.log("Not a valid marker at offset "+i+", found: "+e.getUint8(i)),!1;if(o=e.getUint8(i+1),c&&console.log(o),225==o)return c&&console.log("Found 0xFFE1 marker"),function(t,e){if("Exif"!=a(t,e,4))return c&&console.log("Not valid EXIF data! "+a(t,e,4)),!1;var o,i,r,_,l,g=e+6;if(18761==t.getUint16(g))o=!1;else{if(19789!=t.getUint16(g))return c&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;o=!0}if(42!=t.getUint16(g+2,!o))return c&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var v=t.getUint32(g+4,!o);if(v<8)return c&&console.log("Not valid TIFF data! (First offset less than 8)",t.getUint32(g+4,!o)),!1;if((i=s(t,g,g+v,d,o)).ExifIFDPointer)for(r in _=s(t,g,g+i.ExifIFDPointer,h,o)){switch(r){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":_[r]=f[r][_[r]];break;case"ExifVersion":case"FlashpixVersion":_[r]=String.fromCharCode(_[r][0],_[r][1],_[r][2],_[r][3]);break;case"ComponentsConfiguration":_[r]=f.Components[_[r][0]]+f.Components[_[r][1]]+f.Components[_[r][2]]+f.Components[_[r][3]]}i[r]=_[r]}if(i.GPSInfoIFDPointer)for(r in l=s(t,g,g+i.GPSInfoIFDPointer,u,o))"GPSVersionID"===r&&(l[r]=l[r][0]+"."+l[r][1]+"."+l[r][2]+"."+l[r][3]),i[r]=l[r];return i.thumbnail=function(t,e,o,i){var r,a,_=(r=e+o,a=t.getUint16(r,!i),t.getUint32(r+2+12*a,!i));if(!_||_>t.byteLength)return{};var c=s(t,e,e+_,p,i);if(c.Compression)switch(c.Compression){case 6:if(c.JpegIFOffset&&c.JpegIFByteCount){var l=e+c.JpegIFOffset,h=c.JpegIFByteCount;c.blob=new Blob([new Uint8Array(t.buffer,l,h)],{type:"image/jpeg"})}break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",c.Compression)}else 2==c.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");return c}(t,g,v,o),i}(e,i+4,e.getUint16(i+2));i+=2+e.getUint16(i+2)}}function s(t,e,o,i,r){var s,_,l,h=t.getUint16(o,!r),d={};for(l=0;l<h;l++)s=o+12*l+2,(_=i[t.getUint16(s,!r)])||!c||console.log("Unknown tag: "+t.getUint16(s,!r)),d[_]=function(t,e,o,i,r){var s,_,c,l,h,d,u=t.getUint16(e+2,!r),p=t.getUint32(e+4,!r),f=t.getUint32(e+8,!r)+o;switch(u){case 1:case 7:if(1==p)return t.getUint8(e+8,!r);for(s=p>4?f:e+8,_=[],l=0;l<p;l++)_[l]=t.getUint8(s+l);return _;case 2:return a(t,s=p>4?f:e+8,p-1);case 3:if(1==p)return t.getUint16(e+8,!r);for(s=p>2?f:e+8,_=[],l=0;l<p;l++)_[l]=t.getUint16(s+2*l,!r);return _;case 4:if(1==p)return t.getUint32(e+8,!r);for(_=[],l=0;l<p;l++)_[l]=t.getUint32(f+4*l,!r);return _;case 5:if(1==p)return(c=new Number((h=t.getUint32(f,!r))/(d=t.getUint32(f+4,!r)))).numerator=h,c.denominator=d,c;for(_=[],l=0;l<p;l++)h=t.getUint32(f+8*l,!r),d=t.getUint32(f+4+8*l,!r),_[l]=new Number(h/d),_[l].numerator=h,_[l].denominator=d;return _;case 9:if(1==p)return t.getInt32(e+8,!r);for(_=[],l=0;l<p;l++)_[l]=t.getInt32(f+4*l,!r);return _;case 10:if(1==p)return t.getInt32(f,!r)/t.getInt32(f+4,!r);for(_=[],l=0;l<p;l++)_[l]=t.getInt32(f+8*l,!r)/t.getInt32(f+4+8*l,!r);return _}}(t,s,e,0,r);return d}function a(t,e,o){var i="";for(n=e;n<e+o;n++)i+=String.fromCharCode(t.getUint8(n));return i}function _(t){var e={};if(1==t.nodeType){if(t.attributes.length>0){e["@attributes"]={};for(var o=0;o<t.attributes.length;o++){var i=t.attributes.item(o);e["@attributes"][i.nodeName]=i.nodeValue}}}else if(3==t.nodeType)return t.nodeValue;if(t.hasChildNodes())for(var r=0;r<t.childNodes.length;r++){var s=t.childNodes.item(r),a=s.nodeName;if(null==e[a])e[a]=_(s);else{if(null==e[a].push){var c=e[a];e[a]=[],e[a].push(c)}e[a].push(_(s))}}return e}var c=!1,l=function t(e){return e instanceof t?e:this instanceof t?void(this.EXIFwrapped=e):new t(e)};void 0!==t&&t.exports&&(e=t.exports=l),e.EXIF=l;var h=l.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},d=l.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},u=l.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},p=l.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},f=l.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},g={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};l.enableXmp=function(){l.isXmpEnabled=!0},l.disableXmp=function(){l.isXmpEnabled=!1},l.getData=function(t,e){return!((self.Image&&t instanceof self.Image||self.HTMLImageElement&&t instanceof self.HTMLImageElement)&&!t.complete||(o(t)?e&&e.call(t):function(t,e){function o(o){t.exifdata=r(o)||{},t.iptcdata=function(t){var e,o=new DataView(t);if(c&&console.log("Got file of length "+t.byteLength),255!=o.getUint8(0)||216!=o.getUint8(1))return c&&console.log("Not a valid JPEG"),!1;for(var i=2,r=t.byteLength;i<r;){if(e=i,56===o.getUint8(e)&&66===o.getUint8(e+1)&&73===o.getUint8(e+2)&&77===o.getUint8(e+3)&&4===o.getUint8(e+4)&&4===o.getUint8(e+5)){var s=o.getUint8(i+7);return s%2!=0&&(s+=1),0===s&&(s=4),function(t,e,o){for(var i,r,s,_,c=new DataView(t),l={},h=e;h<e+o;)28===c.getUint8(h)&&2===c.getUint8(h+1)&&(_=c.getUint8(h+2))in g&&(s=c.getInt16(h+3),r=g[_],i=a(c,h+5,s),l.hasOwnProperty(r)?l[r]instanceof Array?l[r].push(i):l[r]=[l[r],i]:l[r]=i),h++;return l}(t,i+8+s,o.getUint16(i+6+s))}i++}}(o)||{},l.isXmpEnabled&&(t.xmpdata=function(t){if("DOMParser"in self){var e=new DataView(t);if(c&&console.log("Got file of length "+t.byteLength),255!=e.getUint8(0)||216!=e.getUint8(1))return c&&console.log("Not a valid JPEG"),!1;for(var o=2,i=t.byteLength,r=new DOMParser;o<i-4;){if("http"==a(e,o,4)){var s=o-1,l=e.getUint16(o-2)-1,h=a(e,s,l),d=h.indexOf("xmpmeta>")+8,u=(h=h.substring(h.indexOf("<x:xmpmeta"),d)).indexOf("x:xmpmeta")+10;return h=h.slice(0,u)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+h.slice(u),function(t){try{var e={};if(t.children.length>0)for(var o=0;o<t.children.length;o++){var i=t.children.item(o),r=i.attributes;for(var s in r){var a=r[s],c=a.nodeName,l=a.nodeValue;void 0!==c&&(e[c]=l)}var h=i.nodeName;if(void 0===e[h])e[h]=_(i);else{if(void 0===e[h].push){var d=e[h];e[h]=[],e[h].push(d)}e[h].push(_(i))}}else e=t.textContent;return e}catch(t){console.log(t.message)}}(r.parseFromString(h,"text/xml"))}o++}}}(o)||{}),e&&e.call(t)}if(t.src)if(/^data\:/i.test(t.src))o(function(t,e){e=e||t.match(/^data\:([^\;]+)\;base64,/im)[1]||"",t=t.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var o=atob(t),i=o.length,r=new ArrayBuffer(i),s=new Uint8Array(r),a=0;a<i;a++)s[a]=o.charCodeAt(a);return r}(t.src));else if(/^blob\:/i.test(t.src)){var i,s;(h=new FileReader).onload=function(t){o(t.target.result)},i=t.src,(s=new XMLHttpRequest).open("GET",i,!0),s.responseType="blob",s.onload=function(t){var e;(200==this.status||0===this.status)&&(e=this.response,h.readAsArrayBuffer(e))},s.send()}else{var h,d=new XMLHttpRequest;d.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";o(d.response),d=null},d.open("GET",t.src,!0),d.responseType="arraybuffer",d.send(null)}else self.FileReader&&(t instanceof self.Blob||t instanceof self.File)&&((h=new FileReader).onload=function(t){c&&console.log("Got file of length "+t.target.result.byteLength),o(t.target.result)},h.readAsArrayBuffer(t))}(t,e),0))},l.getTag=function(t,e){if(o(t))return t.exifdata[e]},l.getIptcTag=function(t,e){if(o(t))return t.iptcdata[e]},l.getAllTags=function(t){if(!o(t))return{};var e,i=t.exifdata,r={};for(e in i)i.hasOwnProperty(e)&&(r[e]=i[e]);return r},l.getAllIptcTags=function(t){if(!o(t))return{};var e,i=t.iptcdata,r={};for(e in i)i.hasOwnProperty(e)&&(r[e]=i[e]);return r},l.pretty=function(t){if(!o(t))return"";var e,i=t.exifdata,r="";for(e in i)i.hasOwnProperty(e)&&("object"==typeof i[e]?i[e]instanceof Number?r+=e+" : "+i[e]+" ["+i[e].numerator+"/"+i[e].denominator+"]\r\n":r+=e+" : ["+i[e].length+" values]\r\n":r+=e+" : "+i[e]+"\r\n");return r},l.readFromBinaryFile=function(t){return r(t)},void 0!==(i=(function(){return l}).apply(e,[]))&&(t.exports=i)}).call(this)}])},30806(t,e,o){"use strict";var i,r=o(87379),s=function(){return(s=Object.assign||function(t){for(var e,o=1,i=arguments.length;o<i;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function a(t,e,o,i){return new(o||(o=Promise))(function(r,s){function a(t){try{c(i.next(t))}catch(t){s(t)}}function _(t){try{c(i.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?r(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(a,_)}c((i=i.apply(t,e||[])).next())})}function _(t,e){var o,i,r,s,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:_(0),throw:_(1),return:_(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function _(s){return function(_){var c=[s,_];if(o)throw TypeError("Generator is already executing.");for(;a;)try{if(o=1,i&&(r=2&c[0]?i.return:c[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,c[1])).done)return r;switch(i=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,i=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===c[0]||2===c[0])){a=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){a.label=c[1];break}if(6===c[0]&&a.label<r[1]){a.label=r[1],r=c;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(c);break}r[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(t,a)}catch(t){c=[6,t],i=0}finally{o=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}var c={env:"dev",api:"https://dev-open-service.codemao.cn",pid:"sysinfo_dev"},l={env:"staging",api:"https://staging-open-service.codemao.cn",pid:"sysinfo_dev"},h={env:"prod",api:"https://open-service.codemao.cn",pid:"sysinfo"},d={env:"dev",api:"https://test-open-service.codemao.cn",pid:"sysinfo_dev"},u=(i=h,{init:function(t){var e=t.env,o=t.config;switch(e){case"dev":i=c;break;case"staging":i=l;break;case"test":i=d;break;default:i=h}o&&(i=Object.assign({},i,o))},get:function(){return i}}),p=function(){function t(t,e,o){this._observer=r.upload(t,e.key,e.token),this._subObject=o}return t.prototype.start=function(){this._subscription=this._observer.subscribe(this._subObject)},t.prototype.cancel=function(){this._subscription.unsubscribe()},t}();function f(t,e){return a(this,void 0,void 0,function(){return _(this,function(o){return[2,new Promise(function(o,i){var r=e.async,s=e.data,a=e.headers,_=void 0===a?{}:a,c=e.method,l=void 0===c?"get":c,h=e.timeout,d=void 0===h?0:h,u=e.onprogress,p=new XMLHttpRequest;e.withCredentials&&(p.withCredentials=!0),p.responseType="json",p.timeout=d,p.ontimeout=function(){i(Error("the request timeout "+d+"ms"))},p.onerror=function(){i(Error("unknown error"))},p.upload&&u&&(p.upload.onprogress=u),p.onreadystatechange=function(){4===p.readyState&&(p.status>=200&&p.status<300?o(p.response):i(Error("this request is error")))},console.log("xhr type",l),p.open(l,t,void 0===r||r),Object.keys(_).forEach(function(t){p.setRequestHeader(t,_[t])});try{p.send(void 0===s?null:s)}catch(t){i(t)}})]})})}var g=function(){function t(){}return t.prototype.upload=function(t,e,o,i){return a(this,void 0,void 0,function(){var r,s,a;return _(this,function(_){switch(_.label){case 0:return r=i.onprogress,s=i.timeout,a=new FormData,Object.keys(o).forEach(function(t){a.append(t,o[t])}),a.append("file",t),[4,f(e,{method:"post",data:a,onprogress:r,timeout:s})];case 1:return[2,_.sent()]}})})},t}(),v=function(t,e){return a(void 0,void 0,void 0,function(){var o;return _(this,function(i){return o={data:{m:{d:1,p:"sysinfo"},b:[{e:"cdn_upload",i:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=new Date().getTime(),o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?o:3&o|8).toString(16)}),t:parseInt(""+new Date().getTime()/1e3,10),d:{data:t}}]},type:0},[2,f("https://collection.codemao.cn/report/"+u.get().pid,{method:"post",data:JSON.stringify(o),timeout:e||2e4})]})})},b=function(t,e){return t+"?"+Object.keys(e).filter(function(t){return void 0!==e[t]}).map(function(t){return t+"="+e[t]}).join("&")};e.a=function(){function t(t){this.ali=new g,this.region="hd",this.projectName=t.projectName,t.region&&(this.region=t.region),u.init(t)}return t.prototype.create=function(t,e){return a(this,void 0,void 0,function(){var o,i,r,c,l,h,d,g,m,y,k,w,E,T,x,I=this;return _(this,function(O){var N,C,A;switch(O.label){case 0:if(o=e.onprogress,r=void 0===(i=e.timeout)?2e5:i,c=e.onsuccess,l=e.onerror,h=e.persistentOption,d=e.insertOnly,!t)return l&&l(""),[2];g=e.filename||t.name||Date.now()+"."+(t.type||""),m={projectName:this.projectName,filePaths:g,filePath:g,tokensCount:1,fileSign:"p1",insertOnly:void 0===d||d,persistentOption:h},O.label=1;case 1:return O.trys.push([1,3,,4]),[4,(N=e.type||"normal",C=m,A=e.authToken,a(void 0,void 0,void 0,function(){var t,e,o,i,r,a,c;return _(this,function(_){switch(_.label){case 0:return t=({normal:u.get().api+"/cdn/qi-niu/tokens/uploading",transcode:u.get().api+"/cdn/qi-niu/tokens/videos/transcoding",slice:u.get().api+"/cdn/qi-niu/tokens/videos"})[N],e={},A&&(e.Authorization=A),[4,f(b(t,s(s({},C),{cdnName:"qiniu"})),{headers:e,withCredentials:!0})];case 1:return o=_.sent(),"normal"===N?[2,{filePath:o.tokens[0].file_path,token:o.tokens[0].token,bucketUrl:o.bucket_url,bucket:o.bucket}]:(i=o.file_path,r=o.token,a=o.bucket_url,c=o.bucket,"transcode"===N?[2,{filePath:i,token:r,bucketUrl:a,bucket:c,transcodePath:o.transcode_path}]:[2,{filePath:i,token:r,bucketUrl:a,bucket:c,m3u8Path:o.m3u8_file_path}])}})}))];case 2:return k=(y=O.sent()).bucketUrl,w=y.token,E=y.filePath,T=y.bucket,this._subObject={next:function(t){o&&o(t)},error:function(i){return a(I,void 0,void 0,function(){var i,h,d,p,g,y,k,w,E,T;return _(this,function(x){switch(x.label){case 0:var I,O;return x.trys.push([0,3,,4]),[4,(I=m,O=e.authToken,a(void 0,void 0,void 0,function(){var t,e,o;return _(this,function(i){switch(i.label){case 0:return t=u.get().api+"/cdn/qi-niu/tokens/uploading",e={},O&&(e.Authorization=O),[4,f(b(t,s(s({},I),{cdnName:"aliyun"})),{headers:e,withCredentials:!0})];case 1:return[2,{accessKey:(o=i.sent()).tokens[0].access_key,encodedPolicy:o.tokens[0].policy,bucketUrl:o.bucket_url,uploadUrl:o.upload_url,filename:o.tokens[0].file_path,token:o.tokens[0].token,bucket:o.bucket}]}})}))];case 1:return h=(i=x.sent()).bucketUrl,d=i.accessKey,p=i.encodedPolicy,g=i.filename,y=i.token,k=i.uploadUrl,w=i.bucket,[4,this.ali.upload(t,k,{key:g,policy:p,OSSAccessKeyId:d,success_action_status:200,signature:y,bucket:w},{onprogress:o,timeout:r})];case 2:return x.sent(),v([{cdn:"qiniu",bucket:w,file_path:g,region:"hd",source:"",status:0},{cdn:"aliyun",bucket:w,file_path:g,region:"hd",source:E=""+h+g,status:1}]),c&&c({url:E,filename:g}),[3,4];case 3:return T=x.sent(),l&&l(T),[3,4];case 4:return[2]}})})},complete:function(t){var o=k+E;v([{cdn:"qiniu",bucket:T,file_path:E,region:I.region,source:o,status:1}]);var i={url:o,filename:g,hash:t.hash};if("transcode"===e.type){var r=""+k+y.transcodePath;v([{cdn:"qiniu",bucket:k,file_path:y.transcodePath,region:"hd",source:r,status:1}]),i.transcodeUrl=r}"slice"===e.type&&(i.sliceUrl=""+k+y.m3u8Path),console.log("done",t),c&&c(i)}},[2,new p(t,{key:E,token:w},this._subObject)];case 3:return console.log(x=O.sent()),l&&l(x),[2];case 4:return[2]}})})},t}()},63888(t,e,o){"use strict";o.d(e,{a:()=>b,b:()=>E,c:()=>k,d:()=>N,e:()=>m,f:()=>I});var i=o(7452),r=o.n(i),s=o(92136),a=o(34221),_=o(99085),c=o(98784),l=o(97415),h=o(4425),d=o(30806),u=o(32919),p=o(99432),f=o(33383),g=o(67240),v=new d.a({env:g.a.env,projectName:g.a.productCode,config:{pid:g.a.pid,api:g.a.openServiceHost}}),b=function(t){c.a(o,t);var e=l.a(o);function o(t,i){var r;return _.a(this,o),(r=e.call(this,i)).uploadResult=t,r}return o}(h.a(Error));function m(t){return y.apply(this,arguments)}function y(){return(y=a.a(r().mark(function t(e){var o,i,s,a=arguments;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=a.length>1&&void 0!==a[1]?a[1]:"IMAGE",i=e instanceof File?e.name:"",t.next=4,new Promise(function(t,r){v.create(e,{filename:"".concat(g.a.productCode,"/").concat(p.a(o),"_").concat(Date.now())+f.I(i),onsuccess:function(e){return t(e)},onerror:function(t){return r(t)}}).then(function(t){return null==t?void 0:t.start()}).catch(function(t){return r(t)})});case 4:return s=t.sent,t.abrupt("return",s);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function k(t,e){var o,i=[],r=s.a(t);try{for(r.s();!(o=r.n()).done;){var a=o.value;i.push(function(t,e){return w.apply(this,arguments)}(a,e))}}catch(t){r.e(t)}finally{r.f()}return Promise.all(i)}function w(){return(w=a.a(r().mark(function t(e,o){var i,s,a,_,c;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.cdnUrl,s=e.source,!e||i||!s){t.next=16;break}if(a=null,!f.R(s)){t.next=7;break}a=f.o(s,e.id),t.next=11;break;case 7:if(!f.P(s)){t.next=11;break}return t.next=10,f.f(s,e.id);case 10:a=t.sent;case 11:if(!a){t.next=16;break}return t.next=14,m(a);case 14:(_=t.sent)&&(c=_.url.replace("https://static-creation.codemao.cn/","https://creation.codemao.cn/"),u.bc(e.id,c),e.groupId&&void 0!==e.groupImageIndex&&u.cc(e.groupId,e.groupImageIndex,c),e.cdnUrl=c,o&&o(e));case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}function E(t,e){return T.apply(this,arguments)}function T(){return(T=a.a(r().mark(function t(e,o){var i,a,_,c;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:i=[],a=s.a(e);try{for(a.s();!(_=a.n()).done;)c=_.value,i.push(function(t,e){return x.apply(this,arguments)}(c,o))}catch(t){a.e(t)}finally{a.f()}return t.next=5,Promise.all(i);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}},t)}))).apply(this,arguments)}function x(){return(x=a.a(r().mark(function t(e,o){var i,s,a,_;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.cdnUrl,s=e.source,!e||i||!s){t.next=16;break}if(a=null,!f.R(s)){t.next=7;break}a=f.o(s,e.id),t.next=11;break;case 7:if(!f.P(s)){t.next=11;break}return t.next=10,f.g(s,e.id);case 10:a=t.sent;case 11:if(!a){t.next=16;break}return t.next=14,m(a);case 14:(_=t.sent)&&(e.cdnUrl=_.url.replace("https://static-creation.codemao.cn/","https://creation.codemao.cn/"),o&&o(e));case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}function I(t){return O.apply(this,arguments)}function O(){return(O=a.a(r().mark(function t(e){var o,i,s,a;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(o=f.m(e))){t.next=10;break}return i=new File([o],"screenshot.png",{type:o.type}),t.next=6,m(i);case 6:if(!(s=t.sent)){t.next=10;break}return a=s.url.replace("https://static-creation.codemao.cn/","https://creation.codemao.cn/"),t.abrupt("return",a);case 10:return t.abrupt("return","");case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function N(t,e){var o,i=[],r=s.a(t);try{for(r.s();!(o=r.n()).done;){var a=o.value;i.push(function(t,e){return C.apply(this,arguments)}(a,e))}}catch(t){r.e(t)}finally{r.f()}return Promise.all(i)}function C(){return(C=a.a(r().mark(function t(e,o){var i,s,a,_;return r().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(i=e.cdnUrl,s=e.source,!e||i||!s){t.next=16;break}if(a=null,!f.R(s)){t.next=7;break}a=f.o(s,e.name),t.next=11;break;case 7:if(!f.P(s)){t.next=11;break}return t.next=10,f.f(s,e.name);case 10:a=t.sent;case 11:if(!a){t.next=16;break}return t.next=14,m(a,"SOUND");case 14:(_=t.sent)&&(e.cdnUrl=_.url.replace("https://static-creation.codemao.cn/","https://creation.codemao.cn/"),o&&o(e));case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}}}]);
//# sourceMappingURL=47.d83da141a2c63e78.js.map