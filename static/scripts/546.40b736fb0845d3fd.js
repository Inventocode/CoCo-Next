"use strict";(self.webpackChunkcoco_next=self.webpackChunkcoco_next||[]).push([["546"],{68146(t,e,i){i.r(e),i.d(e,{a:()=>k,b:()=>f,c:()=>a,d:()=>c,default:()=>E,e:()=>A,f:()=>r,g:()=>_,h:()=>y,i:()=>g,j:()=>v,k:()=>m,l:()=>b,m:()=>x,n:()=>I,o:()=>w,p:()=>h,q:()=>p,r:()=>l,s:()=>O,t:()=>s,u:()=>d,v:()=>u,w:()=>T});var o=i(5107),n=i(66185);function r(t){return{width:Math.floor(.7*t.width),height:Math.floor(.7*t.height)}}function s(t){return new o.o(Math.floor(.7*t.x),Math.floor(.7*t.y))}function a(t){return new o.o(Math.floor(t.x/.7),Math.floor(t.y/.7))}function _(t,e){var i=new o.l;return i.tx=-Math.floor(.7*(t.x+e.width/2)),i.ty=-Math.floor(.7*(t.y+e.height/2)),i.a=i.d=.7,i}function c(t,e){return h(new o.o(e.x-t.pivot.x*t.scale.x,e.y-t.pivot.y*t.scale.y),e,t.rotation)}function h(t,e,i){var n=t.x-e.x,r=t.y-e.y,s=Math.cos(i),a=Math.sin(i),_=s*n-r*a+e.x,c=s*r+n*a+e.y;return new o.o(_,c)}function l(t,e){var i=h(c(e,e.position),e.position,-e.rotation),n=h(t,e.position,-e.rotation),r=e.scale.x>0?n.x-i.x+e.width/2:n.x-i.x-e.width/2,s=e.scale.y>0?n.y-i.y+e.height/2:n.y-i.y-e.height/2;return new o.o(Math.round(r/e.scale.x),Math.round(s/e.scale.y))}function p(t,e){var i=new o.o(e.position.x-e.pivot.x*e.scale.x,e.position.y-e.pivot.y*e.scale.y),n=t.x*e.scale.x,r=t.y*e.scale.y,s=e.scale.x>0?n+i.x-e.width/2:n+i.x+e.width/2,a=e.scale.y>0?r+i.y-e.height/2:r+i.y+e.height/2,_=h(new o.o(s,a),e.position,e.rotation);return new o.o(_.x,_.y)}function d(t,e){if(0===t&&0===e)return 0;var i=Math.pow(t*t+e*e,.5),o=Math.asin(e/i);return t<0&&(o=o>0?Math.PI-o:-Math.PI-o),o<0?o+2*Math.PI:o}function u(t){return 180*t/Math.PI}function f(t){return t*Math.PI/180}function g(t){var e=parseInt(t,16);return[e>>16&255,e>>8&255,255&e]}function y(t){var e=g(t);return function(t,e,i){var o,n,r=Math.max(t/=255,e/=255,i/=255),s=Math.min(t,e,i),a=(r+s)/2;if(r===s)o=n=0;else{var _=r-s;switch(n=a>.5?_/(2-r-s):_/(r+s),r){case t:o=(e-i)/_+6*(e<i);break;case e:o=(i-t)/_+2;break;case i:o=(t-e)/_+4;break;default:o=0}o/=6}return[o*=360,n,a]}(e[0],e[1],e[2])}function v(t,e,i){var o,n=function(t,e,i){if(t/=360,0===e)o=n=r=i;else{var o,n,r,s=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},a=i<.5?i*(1+e):i+e-i*e,_=2*i-a,c=t,h=t-1/3;o=s(_,a,t+1/3),n=s(_,a,c),r=s(_,a,h)}return[Math.round(255*o),Math.round(255*n),Math.round(255*r)]}(t,e,i);return o=n[0],("00000"+(o<<16|n[1]<<8|n[2]).toString(16)).slice(-6)}function b(t){return!(!t||!t.type)&&t.type===n.d.Actor}function x(t){return!(!t||!t.type)&&t.type===n.d.Scene}function m(t){return!(!t||!t.type)&&t.type===n.c.ActorWrapper}function w(t){return t.type.startsWith("touch")}function O(t){var e=2*Math.PI,i=Math.abs(t);return i=i>e?i%e:i,(i=(t<0?-1:1)<0?e-i:i)>Math.PI?i-e:i}function A(t,e){if(0!==t.width&&0!==t.height){var i=Math.min(e.width/t.width,e.height/t.height);return i>1?1:i}}var k=16;function T(t,e){var i=Date.now();return function(){for(var o=[],n=0;n<arguments.length;n++)o[n]=arguments[n];var r=Date.now();r-i>=e&&(t.apply(void 0,o),i=r)}}function I(t,e){var i=e.width/2,o=e.height/2;return!(t.x<-i||t.x>i||t.y<-o||t.y>o)}let E=16},29798(t,e,i){var o=i(54926);e.a=i(82608).a(function(t,e){return function(t,e,i){var n,r;if("function"==typeof t.indexOf)switch(typeof e){case"number":if(0===e){for(n=1/e;i<t.length;){if(0===(r=t[i])&&1/r===n)return i;i+=1}return -1}if(e!=e){for(;i<t.length;){if("number"==typeof(r=t[i])&&r!=r)return i;i+=1}return -1}return t.indexOf(e,i);case"string":case"boolean":case"function":case"undefined":return t.indexOf(e,i);case"object":if(null===e)return t.indexOf(e,i)}for(;i<t.length;){if(o.a(t[i],e))return i;i+=1}return -1}(e,t,0)>=0})},65273(t,e,i){i.d(e,{a:()=>i$});var o,n,r,s,a,_,c,h,l,p,d,u,f,g,y,v,b,x,m,w,O,A,k,T,I,E,L,S,R,M,C,P,G,N,D,F,j,z,B,H,V,U,W,X,Y=i(73472),K=i(47168),q=i(5107),J={App:Symbol("App"),Data:Symbol("Data"),Events:Symbol("Events"),Textures:Symbol("Textures"),Scenes:Symbol("Scenes"),Scene:Symbol("Scene"),Transition:Symbol("Transition"),Actors:Symbol("Actors"),Actor:Symbol("Actor"),Stage:Symbol("Stage"),StageAnimation:Symbol("StageAnimation"),Physics:Symbol("Physics")},Q=i(66185),Z=i(67892),$=i(29798),tt=i(68146),te=i(72934),ti=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},to=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tn=function(t,e){return function(i,o){e(i,o,t)}},tr=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var _=[r,a];if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&_[0]?o.return:_[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,_[1])).done)return n;switch(o=0,n&&(_=[2&_[0],n.value]),_[0]){case 0:case 1:n=_;break;case 4:return s.label++,{value:_[1],done:!1};case 5:s.label++,o=_[1],_=[0];continue;case 7:_=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===_[0]||2===_[0])){s=0;continue}if(3===_[0]&&(!n||_[1]>n[0]&&_[1]<n[3])){s.label=_[1];break}if(6===_[0]&&s.label<n[1]){s.label=n[1],n=_;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(_);break}n[2]&&s.ops.pop(),s.trys.pop();continue}_=e.call(t,s)}catch(t){_=[6,t],o=0}finally{i=n=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}},ts=function(){function t(t,e,i,o,n,r,s,a){this.app=t,this.data=e(t),this.textures=i(this.data),this.scenes=o(t,this.data),this.actors=n(t,this.data),this.stage_animation=r(this.data),this.physics=s(t,this.data),this.events=a}return t.prototype.init=function(t){this.app.init(t)},t.prototype.render=function(){this.app.render()},t.prototype.start_rendering=function(){this.app.get_app().ticker.start()},t.prototype.stop_rendering=function(){this.app.get_app().ticker.stop()},t.prototype.get_view=function(){return this.app.get_app().view},t.prototype.get_view_size=function(){return this.app.get_app_view_size()},t.prototype.get_screenshot=function(t){var e,i,o,n;return e=this,i=void 0,o=void 0,n=function(){var e=this;return tr(this,function(i){return[2,new Promise(function(i,o){e.app.get_screenshot(t).then(i).catch(o)})]})},new(o||(o=Promise))(function(t,r){function s(t){try{_(n.next(t))}catch(t){r(t)}}function a(t){try{_(n.throw(t))}catch(t){r(t)}}function _(e){var i;e.done?t(e.value):((i=e.value)instanceof o?i:new o(function(t){t(i)})).then(s,a)}_((n=n.apply(e,i||[])).next())})},t.prototype.extract_pixels=function(t,e,i,o){var n=this.get_view(),r=n.width,s=n.height,a=new q.r(new q.d({width:r,height:s}));if(this.app.get_app().renderer.render(this.app.get_app().stage,{renderTexture:a}),this.app.get_renderer_type()===q.p.WEBGL)return a.frame=this.get_render_texture_frame(t,e,i,o),this.app.get_extract_module().pixels(a);var _=this.app.get_extract_module().canvas(a).getContext("2d");return _?_.getImageData(t,e,i,o).data:void 0},t.prototype.extract_canvas=function(t,e,i,o){var n=this.get_view(),r=n.width,s=n.height,a=new q.r(new q.d({width:r,height:s}));return this.app.get_app().renderer.render(this.app.get_app().stage,{renderTexture:a}),a.frame=this.get_render_texture_frame(t,e,i,o),this.app.get_extract_module().canvas(a)},t.prototype.get_render_texture_frame=function(t,e,i,o){var n=this.get_view(),r=n.width,s=n.height;return t=te.a(0,r-1,t),i=te.a(1,r-t,i),e=te.a(0,s-1,e),o=te.a(1,s-e,o),new q.q(t,e,i,o)},t.prototype.resize=function(t,e){this.app.resize(t,e)},t.prototype.set_background_color=function(t){this.app.get_app().renderer.backgroundColor=t},t.prototype.set_background_alpha=function(t){this.app.get_app().renderer.backgroundAlpha=t},t.prototype.add_rendering_update_listener=function(t){this.app.get_app().ticker.add(t)},t.prototype.remove_rendering_update_listener=function(t){this.app.get_app().ticker.remove(t)},t.prototype.destroy=function(){this.data.clear_all_actors_cache(),this.data.clear_all_scenes_cache(),this.data.clear_all_sprite_sheet_cache(),this.data.clear_all_textures_points_cache(),this.app.destroy()},ti([Y.injectable(),tn(0,Y.inject(J.App)),tn(1,Y.inject(J.Data)),tn(2,Y.inject(J.Textures)),tn(3,Y.inject(J.Scenes)),tn(4,Y.inject(J.Actors)),tn(5,Y.inject(J.StageAnimation)),tn(6,Y.inject(J.Physics)),tn(7,Y.inject(J.Events)),to("design:paramtypes",[Object,Function,Function,Function,Function,Function,Function,Object])],t)}(),ta=function(){return(ta=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},t_=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var _=[r,a];if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&_[0]?o.return:_[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,_[1])).done)return n;switch(o=0,n&&(_=[2&_[0],n.value]),_[0]){case 0:case 1:n=_;break;case 4:return s.label++,{value:_[1],done:!1};case 5:s.label++,o=_[1],_=[0];continue;case 7:_=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===_[0]||2===_[0])){s=0;continue}if(3===_[0]&&(!n||_[1]>n[0]&&_[1]<n[3])){s.label=_[1];break}if(6===_[0]&&s.label<n[1]){s.label=n[1],n=_;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(_);break}n[2]&&s.ops.pop(),s.trys.pop();continue}_=e.call(t,s)}catch(t){_=[6,t],o=0}finally{i=n=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}},tc=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&0>e.indexOf(o)&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)0>e.indexOf(o[n])&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i},th=function(t,e){var i,o,n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},tl=function(){function t(t){this.data=t}return t.prototype.init=function(){var t,e,o,n;return t=this,e=void 0,o=void 0,n=function(){var t,e;return t_(this,function(o){switch(o.label){case 0:return this.cmao_gsap?[3,2]:(t=this,[4,i.e("368").then(i.bind(i,93347))]);case 1:t.cmao_gsap=o.sent(),o.label=2;case 2:return this.cmao_custom_ease?[3,4]:(e=this,[4,i.e("613").then(i.bind(i,25060))]);case 3:e.cmao_custom_ease=o.sent(),o.label=4;case 4:return this.cmao_gsap&&this.cmao_custom_ease&&this.cmao_gsap.gsap.registerPlugin(this.cmao_custom_ease.CustomEase),[2]}})},new(o||(o=Promise))(function(i,r){function s(t){try{_(n.next(t))}catch(t){r(t)}}function a(t){try{_(n.throw(t))}catch(t){r(t)}}function _(t){var e;t.done?i(t.value):((e=t.value)instanceof o?e:new o(function(t){t(e)})).then(s,a)}_((n=n.apply(t,e||[])).next())})},t.prototype.create_ease_function=function(t,e){if(this.cmao_custom_ease)return this.cmao_custom_ease.CustomEase.create(t,e)},t.prototype.compose_timeline=function(t,e,i){var o=this;if(this.cmao_gsap&&this.data.get_internal_actor(t)){i&&(n=i.on_start,r=i.on_update,s=i.on_complete);var n,r,s,a=new this.cmao_gsap.TimelineLite({onStart:n,onUpdate:r,onComplete:s});return e.forEach(function(e){var i=e.tween_opt,n=e.timeline_pos,r=o.compose_tween(t,i);r&&a.add(r,n)}),a}},t.prototype.compose_tween=function(t,e){var i,o,n=this.data.get_internal_actor(t);if(this.cmao_gsap&&n){switch(e.variation_type){case Q.f.TO:o=this.manufacture_tween_vars(n,[e.tween_vars]),i=this.cmao_gsap.TweenLite.to(o.target,o.vars[0]);break;case Q.f.FROM:o=this.manufacture_tween_vars(n,[e.tween_vars]),i=this.cmao_gsap.TweenLite.from(o.target,o.vars[0]);break;case Q.f.FROM_TO:o=this.manufacture_tween_vars(n,[e.tween_vars.from,e.tween_vars.to]),i=this.cmao_gsap.TweenLite.fromTo(o.target,o.vars[0],o.vars[1])}return n.on("destroy",function(){return i.kill()}),i}},t.prototype.manufacture_tween_vars=function(e,i){var o=this,n={},r=[],s=Object.keys(t.HOOK_FACTORY);return i.forEach(function(i){var a=i.on_start,_=i.on_update,c=i.on_complete,h=tc(i,["on_start","on_update","on_complete"]),l=Z.a(h),p=Math.random().toString();l.id=p;var d=!1;if(o.cmao_gsap){var u=o.cmao_gsap,f=[],g=[],y={},v=Object.keys(h);s.forEach(function(i){if($.a(i,v)){void 0===n[i]&&(n[i]=0);var o=th(t.HOOK_FACTORY[i](e,n),3),r=o[0],s=o[1],a=o[2];f.push(r),g.push(s),a&&(y[i]=a)}}),f.push(function(){d=!0;var t=u.gsap.getById(p);t&&t.invalidate()}),a&&f.push(a),_&&g.push(_),r.push(ta(ta({},l),{modifiers:y,onStart:function(){f.forEach(function(t){return t()})},onUpdate:function(){d&&g.forEach(function(t){return t()})},onComplete:c}))}}),{target:n,vars:r}},t.HOOK_FACTORY={position_x:function(t,e){return[function(){e.position_x=t.position.x},function(){var i=t.position.y;t.set_pixi_position(e.position_x,i)}]},position_y:function(t,e){return[function(){e.position_y=-t.position.y},function(){var i=t.position.x;t.set_pixi_position(i,-e.position_y)}]},scale_x:function(t,e){return[function(){e.scale_x=t.scale.x},function(){var i=t.scale.y;t.set_pixi_scale(e.scale_x,i)}]},scale_y:function(t,e){return[function(){e.scale_y=t.scale.y},function(){var i=t.scale.x;t.set_pixi_scale(i,e.scale_y)}]},rotation:function(t,e){return[function(){e.rotation=t.rotation_value},function(){t.set_rotation(e.rotation)},function(t){return tt.s(t)}]},pixi_rotation:function(t,e){return[function(){e.pixi_rotation=t.rotation},function(){t.set_pixi_rotation(e.pixi_rotation)},function(t){return tt.s(t)}]},alpha:function(t,e){return[function(){e.alpha=t.alpha},function(){t.set_alpha(e.alpha)}]}},t}(),tp=i(3738),td=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},tu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tf=function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{_(o.next(t))}catch(t){r(t)}}function a(t){try{_(o.throw(t))}catch(t){r(t)}}function _(t){var e;t.done?n(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(s,a)}_((o=o.apply(t,e||[])).next())})},tg=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var _=[r,a];if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&_[0]?o.return:_[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,_[1])).done)return n;switch(o=0,n&&(_=[2&_[0],n.value]),_[0]){case 0:case 1:n=_;break;case 4:return s.label++,{value:_[1],done:!1};case 5:s.label++,o=_[1],_=[0];continue;case 7:_=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===_[0]||2===_[0])){s=0;continue}if(3===_[0]&&(!n||_[1]>n[0]&&_[1]<n[3])){s.label=_[1];break}if(6===_[0]&&s.label<n[1]){s.label=n[1],n=_;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(_);break}n[2]&&s.ops.pop(),s.trys.pop();continue}_=e.call(t,s)}catch(t){_=[6,t],o=0}finally{i=n=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}},ty=function(){var t;function e(t){var e=this;this.mouse_down_time=0,this.cancel_multi_touch=!1,this.on_stage_swipe=function(t){var i=e.get_app().stage;i.name&&e.events.fire("stage:swipe",{target_id:i.name,data:t})},this.events=t}return e.prototype.init=function(t){var e=this;this.app?console.warn("Application cannot be reinitialized."):(this.app=new q.b(t.renderer),this.app.stage.name=t.id?t.id:"stage",this.cancel_multi_touch=void 0!==t.cancel_multi_touch&&t.cancel_multi_touch,this.app.stage.pivot.set(-this.app.renderer.width/2,-this.app.renderer.height/2),this.app.stage.interactive=!0,this.app.stage.hitArea=new q.q(-this.app.renderer.width/2,-this.app.renderer.height/2,this.app.renderer.width,this.app.renderer.height),this.app.ticker.autoStart=!1,this.app.ticker.stop(),this.scene_container=new q.f,this.scene_container.name="scenes",this.scene_container.interactive=!0,this.app.stage.addChild(this.scene_container),new K.Manager(this.app.view,{recognizers:[[K.Swipe,{direction:K.DIRECTION_ALL}]]}).on("swipe",this.on_stage_swipe),this.app.stage.addListener("mousedown",function(t){return e.emit_mouse_event(t,"stage:mousedown")}),this.app.stage.addListener("mousemove",function(t){return e.emit_mouse_event(t,"stage:mousemove")}),this.app.stage.addListener("mouseup",function(t){return e.emit_mouse_event(t,"stage:mouseup")}),this.app.stage.addListener("mouseupoutside",function(t){return e.emit_mouse_event(t,"stage:mouseupoutside")}),this.app.stage.addListener("touchstart",function(t){return e.emit_mouse_event(t,"stage:touchstart")}),this.app.stage.addListener("touchmove",function(t){return e.emit_mouse_event(t,"stage:touchmove")}),this.app.stage.addListener("touchend",function(t){return e.emit_mouse_event(t,"stage:touchend")}),this.app.stage.addListener("touchendoutside",function(t){return e.emit_mouse_event(t,"stage:touchendoutside")}),this.app.stage.addListener("rightclick",function(t){return e.emit_mouse_event(t,"stage:rightclick")}),t.development&&tp.a.set_log_enabled(!0))},e.prototype.get_app=function(){if(!this.app)throw Error("Application needs init before using.");return this.app},e.prototype.get_app_view_size=function(){var t=this.get_app_view_resolution(),e=this.get_app().view,i=e.width,o=e.height;return{width:i/=t,height:o/=t}},e.prototype.get_app_view_resolution=function(){return this.get_app().renderer.resolution},e.prototype.get_scene_container=function(){if(!this.scene_container)throw Error("Scene container needs init before using.");return this.scene_container},e.prototype.render=function(){this.get_app().ticker.started||this.get_app().render()},e.prototype.get_renderer_type=function(){return this.get_app().renderer.type},e.prototype.get_interaction_manager=function(){return this.get_app().renderer.plugins.interaction},e.prototype.get_extract_module=function(){return this.get_app().renderer.plugins.extract},e.prototype.screenshot=function(t){return tf(this,void 0,void 0,function(){var e,i,o,n,r,s,a,_,c,h,l;return tg(this,function(p){return e=t&&void 0!==t.scale?t.scale:.5,i=t&&t.type,o=t&&void 0!==t.quality?t.quality:1,r=(n=this.get_app().view).width,s=n.height,_=(a=document.createElement("canvas")).getContext("2d"),c=r*e,h=s*e,a.width=c,a.height=h,(l=new Image).src=this.get_app().view.toDataURL(i,o),[2,new Promise(function(e,n){l.onload=function(){_&&(_.drawImage(l,0,0,c,h),t&&t.handstand&&(_.clearRect(0,0,c,h),_.translate(c/2,h/2),_.rotate(Math.PI),_.translate(-c/2,-h/2),_.scale(-1,1),_.drawImage(l,0,0,-c,h)),e(a.toDataURL(i,o)))},l.onerror=function(t){n(t)}})]})})},e.prototype.get_screenshot=function(t){return tf(this,void 0,void 0,function(){var e,i=this;return tg(this,function(o){return e=this.get_app().renderer,[2,new Promise(function(o,n){e.once("postrender",function(){i.screenshot(t).then(function(t){return o(t)}).catch(function(t){return n(t)})}),e.render(i.get_app().stage)})]})})},e.prototype.resize=function(t,e){var i=this.get_app(),o=i.stage,n=i.renderer;o.pivot.set(-t/2,-e/2),o.hitArea=new q.q(-t/2,-e/2,t,e),n.resize(t,e),o.name&&this.events.fire("stage:resize",{target_id:o.name,data:{width:t,height:e}})},e.prototype.destroy=function(){this.get_app().destroy(!0,!0),this.app=void 0},e.prototype.emit_mouse_event=function(t,e){var i=this.get_app().stage,o=t.data.getLocalPosition(i),n=o.x,r=o.y;switch(e){case"stage:mousedown":case"stage:touchstart":this.mouse_down_time=new Date().getTime();break;case"stage:mouseup":case"stage:touchend":new Date().getTime()-this.mouse_down_time<1e3&&i.name&&this.events.fire("stage:click",{target_id:i.name,data:{position:{x:n,y:-r}}})}if(i.name&&this.events.fire(e,{target_id:i.name,data:{position:{x:n,y:-r}}}),this.cancel_multi_touch){var s=t.data.originalEvent;tt.o(s)&&s.touches.length>1&&this.events.emit_break_event()}},td([Y.injectable(),(t=Y.inject(J.Events),function(e,i){t(e,i,0)}),tu("design:paramtypes",[Object])],e)}(),tv=function(t,e){var i,o,n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=r.next()).done;)s.push(i.value)}catch(t){o={error:t}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(o)throw o.error}}return s},tb=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(tv(arguments[e]));return t};function tx(t,e,i,o){o=o||{mode:"vertex"};for(var n,r,s,a,_,c=[],h=-1,l=D.SKIP,p=0,d=t.length,u=3;u<d;u++)if(t[u]>>>24>0){h=u;break}if(h>=0){n=s=h%e|0,r=a=h/e|0;do{switch((_=function(t,e){var i,o=0;return f(t-1,e-1)&&(o|=1),f(t,e-1)&&(o|=2),f(t-1,e)&&(o|=4),f(t,e)&&(o|=8),6===o?l===D.MOVE_UP?D.MOVE_LEFT:D.MOVE_RIGHT:9===o?l===D.MOVE_RIGHT?D.MOVE_UP:D.MOVE_DOWN:1===(i=o)||5===i||13===i?D.MOVE_UP:8===i||10===i||11===i?D.MOVE_DOWN:4===i||12===i||14===i?D.MOVE_LEFT:2===i||3===i||7===i?D.MOVE_RIGHT:D.SKIP}(n,r))===D.MOVE_UP?r--:_===D.MOVE_DOWN?r++:_===D.MOVE_LEFT?n--:_===D.MOVE_RIGHT&&n++,o.mode){case"vertex":_!==l&&c.push(new q.m(n,r));break;case"step":p%o.step==0&&c.push(new q.m(n,r));break;case"mixed":_!==l?(c.push(new q.m(n,r)),p=0):p%o.step==0&&c.push(new q.m(n,r))}l=_,p++}while(n!==s||r!==a);o.tolerance&&(c=function t(e,i,o){var n=e.length-1;if(n<2)return e;for(var r=e[0],s=e[n],a=i*i,_=-1,c=0,h=1;h<n;h++){var l=function(t,e,i){var o=tm(e,i);if(!o)return 0;var n=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/o;return tm(t,n<0?e:n>1?i:new q.m(e.x+n*(i.x-e.x),e.y+n*(i.y-e.y)))}(e[h],r,s);l>c&&(c=l,_=h)}if(c<=a){if(!o)return[r,s];var p=Math.floor(Math.sqrt(tm(r,s))/o),d=[];for(h=1;h<p;h++)d.push(new q.m(r.x+(s.x-r.x)*h/p,r.y+(s.y-r.y)*h/p));return tb([r],d,[s])}var u=e.slice(0,_+1),f=e.slice(_),g=t(u,i,o),y=t(f,i,o);return g.slice(0,g.length-1).concat(y)}(c,o.tolerance,o.step))}function f(o,n){return o>=0&&n>=0&&o<e&&n<i&&t[n*e+o]>>>24>0}return c}function tm(t,e){var i=t.x-e.x,o=t.y-e.y;return i*i+o*o}function tw(t,e){var i=function(t){for(var e=[],i=0,o=0,n=0,r=0;r<t.length;r++)if(0===r){var s=t[t.length-1];o=i=s.x===t[0].x?1/0:(s.y-t[0].y)/(s.x-t[0].x),e.push(s)}else{var a=void 0;if(i===(a=t[r-1].x===t[r].x?1/0:(t[r-1].y-t[r].y)/(t[r-1].x-t[r].x))||.001>Math.abs(i-a))continue;i=a,r===t.length-1&&(n=a),e.push(t[r-1])}return(o===n||.001>Math.abs(o-n))&&e.shift(),e}(t);if(i.length){for(var o=i.length,n=function t(e){for(var i=0,o=0,n=0;n<e.length;n++){var r=tO(n+1,e.length),s=tO(n+2,e.length);tL(e[n],e[r],e[s])===tT?i++:o++}if(o===i){var a=Z.a(e);return a.pop(),t(a)}return o>i}(i),r=void 0,s=-1,a=0;a<o;a++){var _=i[a],c=tO(a+1,o),h=tO(a+2,o),l=tL(_,i[c],i[h]);if(n&&l===tT||!n&&l===tI){r=i[c],s=c;break}}if(r){var p=s,d=tO(p+1,o),u=tO(p-1,o),f=(2*Math.PI-tk(i[u],i[p],i[d]))/2,g=100,y=0;for(a=0;a<o;a++)if(a!==p&&a!==u&&a!==d){var v=tL(i[u],i[p],i[a]);if((n&&v===tI||!n&&v===tT||v===tE)&&!function(t,e,i,o,n){for(var r=[e,i,o],s=[tO(n-1,t.length),n,tO(n+1,t.length)],a=0;a<t.length;a++){var _=(a+1)%t.length;if(!(r.indexOf(a)>=0&&r.indexOf(_)>=0)&&!(s.indexOf(a)>=0&&s.indexOf(_)>=0)&&function(t,e,i,o){if(tR(t,i)||tR(t,o)||tR(e,i)||tR(e,o))return!0;var n=function(t,e,i,o){var n=e.y-t.y,r=t.x-e.x,s=e.x*t.y-t.x*e.y,a=o.y-i.y,_=i.x-o.x,c=o.x*i.y-i.x*o.y,h=a*r-n*_;if(0!==h)return new q.o((_*s-r*c)/h,(n*c-a*s)/h)}(t,e,i,o);return n?tS(n.x,t.x,e.x)&&tS(n.x,i.x,o.x)&&tS(n.y,t.y,e.y)&&tS(n.y,i.y,o.y):3===tL(t,e,i)||3===tL(t,e,o)}(t[a],t[_],t[i],t[n]))return!0}return!1}(i,u,p,d,a)){var b=Math.abs(tk(i[u],i[p],i[a])-f);b<g&&(g=b,y=a)}}var x=function(t,e,i){var o=Math.min(e,i),n=Math.max(e,i),r=t[o],s=t[n],a=o+1,_=Math.abs(e-i)-1,c=[],h=a+_-t.length;if(h>0)for(var l=0;l<h;l++){var p=t.shift();t.push(p),a--}return(c=t.splice(a,_)).push(s,r),[c,t]}(i,p,y);tw(x[0],e),tw(x[1],e)}else e.push(i)}}function tO(t,e){return t>=e?t%e:t<0?e+t%e:t}function tA(t,e){var i=Math.hypot(e.x-t.x,e.y-t.y),o=(e.x-t.x)/i;return e.y>=t.y?Math.acos(o):2*Math.PI-Math.acos(o)}function tk(t,e,i){var o=Math.abs(tA(e,t)-tA(e,i));return o>Math.PI?2*Math.PI-o:o}(o=D||(D={}))[o.MOVE_UP=0]="MOVE_UP",o[o.MOVE_DOWN=1]="MOVE_DOWN",o[o.MOVE_LEFT=2]="MOVE_LEFT",o[o.MOVE_RIGHT=3]="MOVE_RIGHT",o[o.SKIP=4]="SKIP";var tT=1,tI=2,tE=4;function tL(t,e,i){var o=tA(t,e),n=tA(t,i);return .001>Math.abs(o-n)||.001>Math.abs(o-n-Math.PI)?tS(i.x,t.x,e.x)&&tS(i.y,t.y,e.y)?3:tE:o<=Math.PI?n<o||n-o>Math.PI?tT:tI:n>o||o-n>Math.PI?tI:tT}function tS(t,e,i){return t>=e&&t<=i||t>=i&&t<=e}function tR(t,e){return t.x===e.x&&t.y===e.y}var tM=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},tC=function(){function t(t){this.scenes_cache=new Map,this.actors_cache=new Map,this.textures_points_color_data=new Map,this.textures_bounds_points=new Map,this.textures_internal_points=new Map,this.textures_convex_groups=new Map,this.sprite_sheets=new Map,this.app=t}return t.prototype.get_texture=function(t){var e=q.B.TextureCache[t];if(e instanceof q.y)return e},t.prototype.get_texture_points_color_data=function(t){var e=this.textures_points_color_data.get(t);if(e)return e;var i=this.get_texture(t);return i?this.set_points_data(t,i):void 0},t.prototype.get_texture_points_position=function(t){var e=this.get_texture_internal_points(t),i=this.get_texture_bounds_points(t);if(e&&i)return e.concat(i)},t.prototype.get_texture_internal_points=function(t){var e=this.textures_internal_points.get(t);if(e)return e;var i=this.get_texture(t),o=this.get_texture_points_color_data(t);if(i&&o){var n=tt.f({width:i.width,height:i.height}),r=function(t,e,i,o,n){void 0===o&&(o=12),void 0===n&&(n=0);var r,s,a=[],_=function(o,n){return o>=0&&n>=0&&o<e&&n<i&&t[n*e+o]>>>24>0};for(r=0,s=0;s<i;r+=o)if(r>e&&(r=0,s+=o),!(s>i)){var c=n?(Math.random()-.5)*n+r:r,h=n?(Math.random()-.5)*n+s:s;_(c-1,h-1)&&_(c,h-1)&&_(c-1,h)&&_(c,h)&&a.push(new q.m(c,h))}return a}(o,n.width,n.height);if(r)return this.textures_internal_points.set(t,r),r}},t.prototype.get_texture_bounds_points=function(t){var e=this.textures_bounds_points.get(t);if(e)return e;var i=this.get_texture(t),o=this.get_texture_points_color_data(t);if(i&&o){var n=tt.f({width:i.width,height:i.height}),r=tx(o,n.width,n.height,{mode:"step",step:5});if(r)return this.textures_bounds_points.set(t,r),r}},t.prototype.get_texture_convex_groups=function(t){var e=this.textures_convex_groups.get(t);if(e)return e;var i=this.collect_texture_convex_groups(t);return i?(this.textures_convex_groups.set(t,i),i):void 0},t.prototype.collect_texture_convex_groups=function(t){var e=this.get_texture(t),i=this.get_texture_points_color_data(t);if(e&&i){var o=tt.f({width:e.width,height:e.height}),n=tx(i,o.width,o.height,{mode:"vertex",tolerance:5});if(n){var r=[];return tw(n,r),r}}},t.prototype.set_points_data=function(t,e){var i=e.baseTexture.getDrawableSource&&e.baseTexture.getDrawableSource(),o=document.createElement("canvas"),n=o.getContext("2d");if(n&&i){var r=tt.f({width:e.width,height:e.height});o.width=r.width||1,o.height=r.height||1,n.drawImage(i,0,0,o.width,o.height);var s=new Uint32Array(n.getImageData(0,0,o.width,o.height).data.buffer);return this.textures_points_color_data.set(t,s),s}},t.prototype.get_internal_scene=function(t){var e=this.scenes_cache.get(t);if(e)return e;for(var i=this.app.get_scene_container().children,o=0;o<i.length;o++){var n=i[o];if(tt.m(n)&&n.id===t)return this.scenes_cache.set(t,n),n}},t.prototype.get_internal_actor=function(t,e){var i=this.actors_cache.get(t),o=function(t){return!e||$.a(t.get_id(),e)};if(i)return!e||o(i.get_parent_scene())?i:void 0;var n=this.app.get_scene_container().children;try{for(var r=tM(n),s=r.next();!s.done;s=r.next()){var a=s.value;if(tt.m(a)&&o(a)){var _=a.get_actor_container().children;try{for(l=void 0,u=(d=tM(_)).next();!u.done;u=d.next()){var c,h,l,p,d,u,f=u.value;if(tt.k(f)&&f.id===t){var g=f.get_actor();return this.actors_cache.set(t,g),g}}}catch(t){l={error:t}}finally{try{u&&!u.done&&(p=d.return)&&p.call(d)}finally{if(l)throw l.error}}}}}catch(t){c={error:t}}finally{try{s&&!s.done&&(h=r.return)&&h.call(r)}finally{if(c)throw c.error}}},t.prototype.get_target=function(t){return this.get_internal_scene(t)||this.get_internal_actor(t)},t.prototype.clear_scene_cache=function(t){this.scenes_cache.get(t)&&this.scenes_cache.delete(t)},t.prototype.clear_actor_cache=function(t){this.actors_cache.get(t)&&this.actors_cache.delete(t)},t.prototype.clear_texture_points_cache=function(t){this.textures_points_color_data.get(t)&&this.textures_points_color_data.delete(t),this.textures_bounds_points.get(t)&&this.textures_bounds_points.delete(t),this.textures_internal_points.get(t)&&this.textures_internal_points.delete(t),this.textures_convex_groups.get(t)&&this.textures_convex_groups.delete(t)},t.prototype.clear_all_scenes_cache=function(){this.scenes_cache.clear()},t.prototype.clear_all_actors_cache=function(){this.actors_cache.clear()},t.prototype.clear_all_textures_points_cache=function(){this.textures_points_color_data.clear(),this.textures_bounds_points.clear(),this.textures_internal_points.clear(),this.textures_convex_groups.clear()},t.prototype.get_sprite_sheet_data=function(t){return this.sprite_sheets.get(t)},t.prototype.parse_and_cache_sprite_sheet_data=function(t,e,i){var o=this;return new Promise(function(n,r){var s=o.sprite_sheets.get(t);s&&n(s);var a=o.get_texture(e);if(a){var _=new q.u(a,i);_.parse(function(){if(_.textures){var i={origin_texture_id:e,texture_ids:Object.keys(_.textures)};o.sprite_sheets.set(t,i),n(i)}else n(void 0)})}else n(void 0)})},t.prototype.clear_sprite_sheet_cache=function(t){return this.sprite_sheets.delete(t)},t.prototype.clear_all_sprite_sheet_cache=function(){this.sprite_sheets.clear()},t.prototype.is_texture_in_sprite_sheet=function(t){var e,i,o=this.sprite_sheets.values();try{for(var n=tM(o),r=n.next();!r.done;r=n.next()){var s=r.value;if($.a(t,s.texture_ids))return!0}}catch(t){e={error:t}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}return!1},t}(),tP=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},tG=function(){function t(){this.event_emitter=new q.B.EventEmitter,this.disabled=0,this.fire_queue=[]}return t.prototype.disable=function(){this.disabled++},t.prototype.enable=function(){if(this.disabled<=0)return this.disabled=0,new tp.a("Do not use enable more than once");this.disabled--},t.prototype.is_enabled=function(){return 0===this.disabled},t.prototype.add_listener=function(t,e){this.event_emitter.addListener(t,e)},t.prototype.remove_listener=function(t,e){this.event_emitter.removeListener(t,e)},t.prototype.fire=function(t,e){this.is_enabled()&&(this.fire_queue.push([t,e]),this.release())},t.prototype.emit_break_event=function(t){this.event_emitter.emit("break",t)},t.prototype.release=function(){var t=this.fire_queue.shift();t&&(this.emit(t[0],t[1]),this.release())},t.prototype.emit=function(t,e){this.event_emitter.emit(t,e)},tP([Y.injectable()],t)}(),tN=i(13719),tD=i.n(tN),tF=function(t,e,i,o){return new(i||(i=Promise))(function(n,r){function s(t){try{_(o.next(t))}catch(t){r(t)}}function a(t){try{_(o.throw(t))}catch(t){r(t)}}function _(t){var e;t.done?n(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(s,a)}_((o=o.apply(t,e||[])).next())})},tj=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var _=[r,a];if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&_[0]?o.return:_[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,_[1])).done)return n;switch(o=0,n&&(_=[2&_[0],n.value]),_[0]){case 0:case 1:n=_;break;case 4:return s.label++,{value:_[1],done:!1};case 5:s.label++,o=_[1],_=[0];continue;case 7:_=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===_[0]||2===_[0])){s=0;continue}if(3===_[0]&&(!n||_[1]>n[0]&&_[1]<n[3])){s.label=_[1];break}if(6===_[0]&&s.label<n[1]){s.label=n[1],n=_;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(_);break}n[2]&&s.ops.pop(),s.trys.pop();continue}_=e.call(t,s)}catch(t){_=[6,t],o=0}finally{i=n=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}},tz="Cannot load the image of sprite sheet",tB=function(){function t(t){this.data=t,this.loading_urls=new Set}return t.prototype.load_texture=function(t,e){return tF(this,void 0,void 0,function(){var i;return tj(this,function(o){return this.data.get_texture(t)?[2,new tp.a("Texture "+t+" already exists. Please use new texture id")]:(i=q.y.from(e),q.y.addToCache(i,t),i.valid?[2,new tp.a("This texture "+t+" is already available in pixi")]:[2,new Promise(function(t,e){i.baseTexture.on("loaded",function(){t()}),i.baseTexture.on("update",function(){t()}),i.baseTexture.on("error",function(t){i.destroy(!0),e(t)})})])})})},t.prototype.get_texture_img_url=function(t){var e=this.data.get_texture(t);if(!e)return tp.b.error("Cannot find texture "+t);var i=e.baseTexture.getDrawableSource&&e.baseTexture.getDrawableSource();return i&&i instanceof HTMLImageElement?tp.b.success(i.src):tp.b.error("Cannot get url because source is not ImageElement")},t.prototype.destroy_texture=function(t){var e=this.data.get_texture(t);return e?this.data.is_texture_in_sprite_sheet(t)?new tp.a("Texture "+t+" is part of sprite sheet. Cannot destroy it alone"):(e.destroy(!0),void this.data.clear_texture_points_cache(t)):new tp.a("Cannot find texture "+t)},t.prototype.clear_texture_cache=function(t){if(!this.data.get_texture(t))return new tp.a("Cannot find texture "+t);delete q.B.TextureCache[t],this.data.clear_texture_points_cache(t)},t.prototype.clear_all_textures_cache=function(){this.data.clear_all_textures_points_cache()},t.prototype.destroy_all_textures=function(){q.B.destroyTextureCache(),q.B.clearTextureCache(),this.data.clear_all_textures_points_cache(),this.data.clear_all_sprite_sheet_cache()},t.prototype.load_sprite_sheet=function(t){return tF(this,void 0,void 0,function(){var e,i,o,n,r,s,a,_=this;return tj(this,function(c){switch(c.label){case 0:if(e=this.data.get_sprite_sheet_data(t))return new tp.a("Sprite sheet already exists."),[2,e.texture_ids];if(this.loading_urls.has(t))return[2,new tp.a("Sprite sheet is being loaded.")];this.loading_urls.add(t),i=function(){return _.loading_urls.delete(t)},c.label=1;case 1:return c.trys.push([1,3,,4]),[4,tD().get(t)];case 2:return o=c.sent().data,[3,4];case 3:return n=c.sent(),i(),[2,new tp.a(n)];case 4:r=q.B.url.resolve(t,o.meta.image),s="SPRITE_SHEET_"+t,c.label=5;case 5:return c.trys.push([5,7,,8]),[4,this.load_texture(s,r)];case 6:return c.sent(),a=this.data.get_texture(s),[3,8];case 7:return c.sent(),i(),[2,new tp.a(tz)];case 8:return a?[4,this.data.parse_and_cache_sprite_sheet_data(t,s,o)]:(i(),[2,new tp.a(tz)]);case 9:return(e=c.sent())?(i(),[2,e.texture_ids]):(i(),[2,new tp.a("Cannot parse sprite sheet textures.")])}})})},t.prototype.destroy_sprite_sheet=function(t){var e=this,i=this.data.get_sprite_sheet_data(t);if(!i)return new tp.a("Cannot find sprite sheet "+t);i.texture_ids.forEach(function(t){var i=e.data.get_texture(t);i&&i.destroy()});var o=this.data.get_texture(i.origin_texture_id);o&&o.destroy(!0),this.data.clear_sprite_sheet_cache(t)},t.prototype.get_sprite_sheet_texture_ids=function(t){var e=this.data.get_sprite_sheet_data(t);if(e)return e.texture_ids},t}();(n=F||(F={}))[n.QUAD=0]="QUAD",n[n.BOUNCE=1]="BOUNCE";var tH=function(t){return 1-(1-t)*(1-t)},tV=function(t){return t<.36363636363636365?7.5625*t*t:t<.7272727272727273?7.5625*(t-=.5454545454545454)*t+.75:t<.9090909090909091?7.5625*(t-=.8181818181818182)*t+.9375:7.5625*(t-=.9545454545454546)*t+.984375};(r=j||(j={}))[r.X=0]="X",r[r.Y=1]="Y",r[r.ALPHA=2]="ALPHA",r[r.ANGLE=3]="ANGLE";var tU=function(){function t(t){this.handler_cache=new Set,this.app=t}return t.prototype.update_attributes=function(t,e,i){var o,n;if(!(t instanceof q.A))switch(i){case j.X:return n=e-t.x,o=t.x,function(e){t.position.set(o+n*e,t.position.y)};case j.Y:return n=e-t.y,o=t.y,function(e){t.position.set(t.position.x,o+n*e)};case j.ALPHA:return n=e-t.alpha,o=t.alpha,function(e){t.alpha=o+n*e}}if(i===j.ANGLE)return n=e-t.angle,o=t.angle,function(e){t.angle=o+n*e}},t.prototype.create_tween=function(t){var e,i,o=this,n=t.target,r=1e3*t.duration,s=performance.now(),a=(null==(e=t.to_options)?void 0:e.ease)||F.QUAD,_=t.to_options,c=t.delay?1e3*t.delay:0;switch(a){case F.QUAD:i=tH;break;case F.BOUNCE:i=tV}var h={};n instanceof q.A||(void 0!==_.x&&_.x-n.position.x!=0&&(h.update_x=this.update_attributes(n,_.x,j.X)),void 0!==_.y&&_.y-n.position.y!=0&&(h.update_y=this.update_attributes(n,_.y,j.Y)),void 0!==_.visible&&(n.visible=_.visible),void 0!==_.alpha&&(h.update_alpha=this.update_attributes(n,_.alpha,j.ALPHA))),void 0!==_.angle&&(h.update_angle=this.update_attributes(n,_.angle,j.ANGLE));var l=function t(){var e=performance.now();if(!(c>0&&s+c>e)){var n=(e-s-c)/r,a=i(n);if(n>1)return o.update_target(h,a),void o.remove_ticker(t);o.update_target(h,a)}};this.handler_cache.add(l),this.app.get_app().ticker.add(l)},t.prototype.update_target=function(t,e){t.update_x&&t.update_x(e),t.update_y&&t.update_y(e),t.update_alpha&&t.update_alpha(e),t.update_angle&&t.update_angle(e)},t.prototype.to=function(t,e,i,o){return this.create_tween({target:t,duration:e,to_options:i,delay:o}),this},t.prototype.from=function(t,e,i,o){var n={angle:t.angle};return t instanceof q.A||(n.x=t.position.x,n.y=t.position.x,n.visible=t.visible,n.alpha=t.alpha),this.set_target_initial_state(t,i),this.create_tween({target:t,duration:e,to_options:n,delay:o}),this},t.prototype.from_to=function(t,e,i,o,n){return this.set_target_initial_state(t,i),this.create_tween({target:t,duration:e,to_options:o,delay:n}),this},t.prototype.set_target_initial_state=function(t,e){t instanceof q.A||(void 0!==e.x&&(t.position.x=e.x),void 0!==e.y&&(t.position.y=e.y),void 0!==e.alpha&&(t.alpha=e.alpha),void 0!==e.visible&&(t.visible=e.visible)),void 0!==e.angle&&(t.angle=e.angle)},t.prototype.set_complete_handler=function(t){this.on_complete=t},t.prototype.get_cache_size=function(){return this.handler_cache.size},t.prototype.clear=function(){var t=this;this.handler_cache.forEach(function(e){t.app.get_app().ticker.remove(e)}),this.handler_cache.clear(),this.on_complete=void 0},t.prototype.remove_ticker=function(t){this.app.get_app().ticker.remove(t),this.handler_cache.delete(t),0===this.handler_cache.size&&(this.on_complete&&this.on_complete(),this.on_complete=void 0)},t}(),tW=function(){function t(t){this.app=t,this.tl=new tU(this.app)}return t.prototype.on_complete=function(){},t.prototype.set_transition=function(t,e,i,o){var n=this;if(this.clear_tl(e,i),this.on_complete=function(){n.reset_scenes(e,i),o&&o()},"none"!==t)switch(this.tl.set_complete_handler(this.on_complete),this.scene_destroy_handler=function(){n.clear_tl(e,i),n.scene_destroy_handler=void 0},e.add_listener("destroy",this.scene_destroy_handler),i.add_listener("destroy",this.scene_destroy_handler),t){case"slide_up":case"slide_left":case"slide_down":case"slide_right":return void this.set_slide_transition(e,i,t);case"bounce_up":case"bounce_down":case"bounce_left":case"bounce_right":return void this.set_bounce_transition(i,t);case"fade_in_out":return void this.set_fade_transition(e,i);case"distort":return void this.set_distort_transition(e,i)}else o&&o()},t.prototype.set_slide_transition=function(t,e,i){var o=this.app.get_app().view,n=o.width,r=o.height;e.visible=!0;var s=0,a=0;switch(i){case"slide_down":e.position.y=-r,a=r;break;case"slide_up":e.position.y=r,a=-r;break;case"slide_left":e.position.x=n,s=-n;break;case"slide_right":e.position.x=-n,s=n}this.tl.to(t,.5,{x:s,y:a,ease:F.QUAD}).to(e,.5,{x:0,y:0,ease:F.QUAD})},t.prototype.set_bounce_transition=function(t,e){var i=this.app.get_app(),o=this.app.get_scene_container(),n=i.view,r=n.width,s=n.height;switch(this.in_scene_origin_z_index=o.getChildIndex(t),o.setChildIndex(t,o.children.length-1),t.visible=!0,e){case"bounce_down":t.position.y=-s;break;case"bounce_up":t.position.y=s;break;case"bounce_left":t.position.x=r;break;case"bounce_right":t.position.x=-r}this.tl.to(t,1,{x:0,y:0,ease:F.BOUNCE})},t.prototype.set_fade_transition=function(t,e){e.visible=!0,e.alpha=0,this.tl.to(t,.5,{alpha:0,ease:F.QUAD}).from_to(e,.5,{alpha:0},{alpha:1,ease:F.QUAD})},t.prototype.set_distort_transition=function(t,e){var i=this.app.get_app(),o=i.view,n=o.width,r=o.height,s=new q.r(new q.d({width:n,height:r})),a=new q.r(new q.d({width:n,height:r}));t.visible=!0,e.visible=!1,i.renderer.render(i.stage,{renderTexture:s}),t.visible=!1,e.visible=!0,i.renderer.render(i.stage,{renderTexture:a}),this.out_sprite=q.t.from(s),this.out_sprite.anchor.set(.5),this.in_sprite=q.t.from(a),this.in_sprite.anchor.set(.5);var _=Math.min(n,r),c=new q.o(n/2,r/2),h=new q.A({radius:_,angle:0,padding:10});h.offset=c;var l=new q.A({radius:_,angle:tt.b(189),padding:10});l.offset=c,this.out_sprite.filters=[h],this.in_sprite.filters=[l],i.stage.addChild(this.out_sprite,this.in_sprite),this.tl.from_to(this.out_sprite,.5,{alpha:1},{alpha:0}).from_to(h,.5,{angle:0},{angle:tt.b(-227.8)}).from_to(this.in_sprite,.5,{visible:!0,alpha:0},{visible:!0,alpha:1},.1).to(l,.5,{angle:0},.1)},t.prototype.clear_tl=function(t,e){this.tl.get_cache_size()&&(this.reset_scenes(t,e),this.tl.clear())},t.prototype.reset_scenes=function(t,e){t.x=0,t.y=0,t.alpha=1,e.x=0,e.y=0,e.alpha=1,this.scene_destroy_handler&&(t.remove_listener("destroy",this.scene_destroy_handler),e.remove_listener("destroy",this.scene_destroy_handler),this.scene_destroy_handler=void 0),void 0!==this.in_scene_origin_z_index&&(this.app.get_scene_container().setChildIndex(e,this.in_scene_origin_z_index),this.in_scene_origin_z_index=void 0),this.out_sprite&&(this.out_sprite.destroy({children:!0,texture:!0,baseTexture:!0}),this.out_sprite=void 0),this.in_sprite&&(this.in_sprite.destroy({children:!0,texture:!0,baseTexture:!0}),this.in_sprite=void 0)},t}(),tX=i(59401),tY=(s=function(t,e){return(s=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),tK=function(t){function e(e,i,o,n,r,s,a,_,c){var h=t.call(this,e,o,n)||this;return h.type=Q.d.Background,h.rotation_type=Q.e.ALL,h.rotation_value=0,h.is_horizontal_flipped=!1,h.is_vertical_flipped=!1,h.is_rotation_flipped=!1,h.transform_offset={pivot:{x:0,y:0},position:{x:0,y:0}},h.custom_pivot={x:0,y:0},h.adaptive_scale={x:1,y:1},h.transform_position={x:0,y:0},h.on_resize=function(t){t.target_id===h.app.get_app().stage.name&&(h.width=t.data.width,h.height=t.data.height)},h.id=c,h.name=c,h.texture_id=i,h.anchor.set(.5),h.interactive=!0,h.emit_scene_event=r,h.app=s,h.data=a,h.events=_,h.events.add_listener("stage:resize",h.on_resize),h}return tY(e,t),e.prototype.set_position=function(t,e){this.update_pixi_position(t,e),this.emit_scene_event("change",{position:this.transform_position})},e.prototype.set_position_x=function(t){var e=this.get_position().y;this.set_position(t,e)},e.prototype.set_position_y=function(t){var e=this.get_position().x;this.set_position(e,t)},e.prototype.move_forward=function(t){var e=this.get_position(),i=this.get_rotation(),o=e.x+Math.cos(i)*t,n=e.y+Math.sin(i)*t;this.set_position(o,n)},e.prototype.get_position=function(){var t=this.transform_offset.position;return{x:this.transform_position.x-t.x,y:-this.transform_position.y+t.y}},e.prototype.set_scale=function(t,e){var i=t;void 0!==i&&(i=Math.max(0,i),i=this.is_rotation_flipped!==this.is_vertical_flipped?-1*i:i);var o=void 0===e?t:e;void 0!==o&&(o=Math.max(0,o),o=this.is_horizontal_flipped?-1*o:o),this.set_pixi_scale(i,o)},e.prototype.get_scale=function(){var t=this.get_pixi_scale();return{x:Math.abs(t.x),y:Math.abs(t.y)}},e.prototype.set_rotation=function(t){var e=tt.s(t);this.rotation_value=e;var i=!1;switch(this.rotation_type){case Q.e.ALL:this.set_pixi_rotation(-this.rotation_value),i=this.is_rotation_flipped;break;case Q.e.LEFT_RIGHT:this.set_pixi_rotation(0),i=(this.rotation_value>=Math.PI/2||this.rotation_value<-Math.PI/2)!==this.is_rotation_flipped;break;case Q.e.NONE:this.set_pixi_rotation(0),i=this.is_rotation_flipped}if(i){var o=this.get_pixi_scale(),n=o.x,r=o.y;this.is_rotation_flipped=!this.is_rotation_flipped,this.set_pixi_scale(-1*n,r)}},e.prototype.set_flipped=function(t){var e=this.get_pixi_scale(),i=e.x,o=e.y;switch(t){case"vertical":return this.set_pixi_scale(-1*i,o),void(this.is_vertical_flipped=!this.is_vertical_flipped);case"horizontal":return this.set_pixi_scale(i,-1*o),void(this.is_horizontal_flipped=!this.is_horizontal_flipped)}},e.prototype.set_rotation_type=function(t){this.rotation_type=t,this.set_rotation(this.rotation_value)},e.prototype.set_visible=function(t){this.visible=t,this.emit_scene_event("change",{visible:this.visible})},e.prototype.set_alpha=function(t){this.alpha=t,this.emit_scene_event("change",{alpha:this.alpha})},e.prototype.get_rotation=function(){return this.rotation_value},e.prototype.get_rotation_type=function(){return this.rotation_type},e.prototype.get_visible=function(){return this.visible},e.prototype.get_alpha=function(){return this.alpha},e.prototype.get_texture_id=function(){return this.texture_id},e.prototype.get_vertical_flipped=function(){return this.is_vertical_flipped},e.prototype.get_horizontal_flipped=function(){return this.is_horizontal_flipped},e.prototype.set_texture=function(t,e){var i=this.data.get_texture(t);if(!i)return new tp.a("Cannot find texture "+t+". Please load texture first");this.texture=i,this.texture_id=t,e&&(e.pivot&&(this.custom_pivot=e.pivot),void 0!==e.adaption&&(this.adaption=e.adaption)),this.on_texture_updated()},e.prototype.update_adaptive_scale=function(){if(this.adaption){var t=this.app.get_app_view_size(),e=t.width,i=t.height,o=e/this.texture.width,n=i/this.texture.height,r=void 0;switch(this.adaption){case Q.a.CONTAIN:r=Math.min(o,n),this.adaptive_scale={x:r,y:r},this.width=this.texture.width*this.adaptive_scale.x,this.height=this.texture.height*this.adaptive_scale.y,this.transform_offset.position={x:this.width/2,y:this.height/2};break;case Q.a.COVER:r=Math.max(o,n),this.adaptive_scale={x:r,y:r},this.width=e,this.height=i,this.transform_offset.position={x:e/2,y:i/2};break;case Q.a.STRETCH:this.adaptive_scale={x:o,y:n},this.width=e,this.height=i,this.transform_offset.position={x:e/2,y:i/2};break;default:return}}else this.adaptive_scale={x:1,y:1};this.update_pixi_position(),this.tileTransform.scale.set(this.adaptive_scale.x,this.adaptive_scale.y)},e.prototype.set_adaption_mode=function(t){this.adaption!==t&&this.data.get_texture(this.texture_id)&&(this.adaption=t,this.on_texture_updated())},e.prototype.update_pixi_position=function(t,e){var i=this.transform_offset.position;this.transform_position={x:t?t+i.x:i.x,y:e?-e+i.y:i.y},this.tileTransform.position.set(this.transform_position.x%(this.texture.width*this.adaptive_scale.x),this.transform_position.y%(this.texture.height*this.adaptive_scale.y))},e.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.on_resize),t.prototype.destroy.call(this)},e}(q.z),tq=function(t){function e(e,i,o,n,r,s,a,_,c){var h=t.call(this,e,i,o,n,r,s,a,_,c)||this;h.update_transform=function(t){h.transform_offset.position={x:t.width/2,y:t.height/2},h.update_pixi_position(),h.update_transform_pivot(),h.update_adaptive_scale()},h.on_stage_resize=function(t){t.target_id===h.app.get_app().stage.name&&h.update_transform(t.data)};var l=s.get_app().view,p=l.width,d=l.height;return h.update_transform({width:p,height:d}),h.events.add_listener("stage:resize",h.on_stage_resize),h}return tY(e,t),e.prototype.set_pixi_rotation=function(t){this.tileTransform.rotation=t,this.emit_scene_event("change",{rotation:this.get_pixi_rotation()})},e.prototype.get_pixi_rotation=function(){return this.tileTransform.rotation},e.prototype.set_pixi_scale=function(t,e){this.tileTransform.scale.set(void 0===t?void 0:t*this.adaptive_scale.x,void 0===e?void 0:e*this.adaptive_scale.y),this.emit_scene_event("change",{scale:this.tileTransform.scale})},e.prototype.get_pixi_scale=function(){var t=this.tileTransform.scale,e=t.x,i=t.y;return{x:e/this.adaptive_scale.x,y:i/this.adaptive_scale.y}},e.prototype.on_texture_updated=function(){this.update_transform_pivot(),this.update_adaptive_scale()},e.prototype.update_transform_pivot=function(){var t=this.texture,e=t.width,i=t.height;this.transform_offset.pivot={x:e/2+this.custom_pivot.x,y:i/2+this.custom_pivot.y},this.tileTransform.pivot.set(this.transform_offset.pivot.x,this.transform_offset.pivot.y)},e.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.on_stage_resize),t.prototype.destroy.call(this)},e}(tK);function tJ(t,e,i,o,n,r,s,a,_){var c=tK.call(this,t,e,i,o,n,r,s,a,_)||this;return c.update_transform=function(t){t.target_id===c.app.get_app().stage.name&&c.on_texture_updated()},c.update_transform_position(0,0),c.events.add_listener("stage:resize",c.update_transform),c}tY(tJ,tK),tJ.prototype.set_pixi_rotation=function(t){this.rotation=t,this.emit_scene_event("change",{rotation:this.get_pixi_rotation()})},tJ.prototype.get_pixi_rotation=function(){return this.rotation},tJ.prototype.set_pixi_scale=function(t,e){this.scale.set(t,e),this.emit_scene_event("change",{scale:this.get_pixi_scale()})},tJ.prototype.get_pixi_scale=function(){var t=this.scale;return{x:t.x,y:t.y}},tJ.prototype.on_texture_updated=function(){this.update_adaptive_scale();var t=this.tileTransform.position,e=t.x,i=t.y,o=e-this.transform_offset.position.x,n=i-this.transform_offset.position.y;this.update_transform_position(o,n)},tJ.prototype.update_transform_position=function(t,e){var i=this.app.get_app_view_size(),o=i.width,n=i.height,r=this.texture,s=r.width,a=r.height,_=-((s*this.adaptive_scale.x-o)/2)-this.custom_pivot.x,c=-((a*this.adaptive_scale.y-n)/2)-this.custom_pivot.y;this.transform_offset.position={x:_,y:c},this.tileTransform.position.set(this.transform_offset.position.x+t,this.transform_offset.position.y+e)},tJ.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.update_transform),tK.prototype.destroy.call(this)};var tQ=(a=function(t,e){return(a=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),tZ=function(t){function e(e,i,o,n,r,s){var a=t.call(this)||this;a.type=Q.d.Scene,a.brush_canvas=document.createElement("canvas"),a.brush_ctx=a.brush_canvas.getContext("2d"),a.should_update_brush_texture=!1,a.mouse_down_time=0,a.on_resize=function(t){if(t.target_id===a.app.get_app().stage.name){var e=a.app.get_app().view,i=e.width,o=e.height;a.brush_canvas.width=i,a.brush_canvas.height=o}},a.on_tick=function(){a.should_update_brush_texture&&(a.should_update_brush_texture=!1,a.update_brush())},a.data=n,a.app=r,a.events=s,a.id=e,a.name=e;var _=a.app.get_app().view,c=_.width,h=_.height,l=a.app.get_app_view_resolution();a.visible=!1,a.interactive=!0;var p=a.app.get_renderer_type()===q.p.WEBGL,d=a.emit_event.bind(a);return a.background=new tq(i,o,c,h,d,r,n,s,e),a.addChildAt(a.background,0),a.brush_canvas.width=c,a.brush_canvas.height=h,a.brush_sprite=q.t.from(a.brush_canvas),a.brush_sprite.anchor.set(.5),a.brush_sprite.position.set(0,0),a.brush_sprite.scale.set(1/l),a.addChildAt(a.brush_sprite,1),a.actor_container=new q.f,a.actor_container.name="actor_container",a.addChildAt(a.actor_container,2),a.background.addListener("mousedown",function(){return a.emit_mouse_event("scene:mousedown")}),a.background.addListener("mousemove",function(){return a.emit_mouse_event("scene:mousemove")}),a.background.addListener("mouseup",function(){return a.emit_mouse_event("scene:mouseup")}),a.background.addListener("mouseupoutside",function(){return a.emit_mouse_event("scene:mouseupoutside")}),a.background.addListener("touchstart",function(){return a.emit_mouse_event("scene:touchstart")}),a.background.addListener("touchmove",function(){return a.emit_mouse_event("scene:touchmove")}),a.background.addListener("touchend",function(){return a.emit_mouse_event("scene:touchend")}),a.background.addListener("touchendoutside",function(){return a.emit_mouse_event("scene:touchendoutside")}),a.events.add_listener("stage:resize",a.on_resize),a.app.get_app().ticker.add(a.on_tick),p&&(a.effects=new tX.a(a.app,a)),a}return tQ(e,t),e.prototype.emit_event=function(t,e){this.emit(t,e)},e.prototype.add_listener=function(t,e){this.on(t,e)},e.prototype.remove_listener=function(t,e){this.off(t,e)},e.prototype.destroy=function(){this.emit_event("destroy",void 0),this.app.get_app().ticker.remove(this.on_tick),this.events.remove_listener("stage:resize",this.on_resize),this.brush_sprite.destroy({children:!0,texture:!0,baseTexture:!0}),t.prototype.destroy.call(this,{children:!0}),this.data.clear_scene_cache(this.id)},e.prototype.get_background=function(){return this.background},e.prototype.get_id=function(){return this.id},e.prototype.get_actor_ids=function(t){var e=[],i=t?function(i){return i.group===t&&e.push(i.id)}:function(t){return e.push(t.id)};return this.actor_container.children.forEach(function(t){tt.k(t)&&i(t.get_actor())}),e},e.prototype.get_brush_ctx=function(){return this.brush_ctx},e.prototype.should_update_brush=function(){this.should_update_brush_texture=!0},e.prototype.update_brush=function(){this.brush_sprite.texture.update()},e.prototype.get_actor_container=function(){return this.actor_container},e.prototype.emit_mouse_event=function(t){switch(t){case"scene:mousedown":case"scene:touchstart":this.mouse_down_time=new Date().getTime(),this.events.fire("scene:selected",{target_id:this.id});break;case"scene:mouseup":case"scene:touchend":new Date().getTime()-this.mouse_down_time<1e3&&this.events.fire("scene:click",{target_id:this.id})}this.events.fire(t,{target_id:this.id})},e.prototype.get_effects=function(){return this.effects?tp.b.success(this.effects):tp.b.error("Effect not available. It needs support of WebGL.")},e.prototype.set_brush_target=function(t){var e=this,i=this.data.get_internal_actor(t,[this.get_id()]);if(!i)return new tp.a("Cannot find actor "+t+" in scene "+this.id);i.wrapper.addChild(this.brush_sprite),this.brush_unset_listener=function(){e.unset_brush_target()},i.add_listener("destroy",this.brush_unset_listener)},e.prototype.get_brush_target=function(){if(tt.k(this.brush_sprite.parent))return this.brush_sprite.parent.get_actor()},e.prototype.unset_brush_target=function(){var t=this.brush_sprite.parent;tt.k(t)&&(this.addChildAt(this.brush_sprite,1),this.brush_unset_listener&&(t.get_actor().remove_listener("destroy",this.brush_unset_listener),this.brush_unset_listener=void 0))},e}(q.f),t$=function(){function t(t,e,i,o,n){this.transition_type="none",this.app=t,this.data=e,this.transition=i(t),this.scene=o,this.events=n}return t.prototype.load_scene=function(t,e){if(this.data.get_internal_scene(t))return tp.b.error("Scene "+t+" already exists. Please use new scene id");var i=e?this.data.get_texture(e):q.y.EMPTY;if(!i)return tp.b.error("Cannot find texture "+e+". Please load texture first");var o=this.scene(t,i,e||"",this.data,this.app);return this.app.get_scene_container().addChild(o),tp.b.success(o)},t.prototype.set_current_scene=function(t,e){var i=this,o=this.data.get_internal_scene(t);if(!o)return new tp.a("Cannot find scene "+t);if(this.current_scene!==t){if(!this.current_scene)return this.current_scene=t,this.set_one_scene_visible(t),void(e&&e());var n=this.data.get_internal_scene(this.current_scene);if(!n)return new tp.a("Cannot find out scene "+this.current_scene);this.current_scene=t,this.transition.set_transition(this.transition_type,n,o,function(){i.set_one_scene_visible(o.id),e&&e()})}},t.prototype.get_current_scene=function(){return this.current_scene},t.prototype.destroy_scene=function(t){var e=this.data.get_internal_scene(t);if(!e)return tp.b.error("Cannot find scene "+t);e.destroy(),this.current_scene===t&&(this.current_scene=void 0);var i=this.app.get_scene_container().children,o=[];return i.forEach(function(t){tt.m(t)&&o.push(t.id)}),tp.b.success({scene_ids:o})},t.prototype.dispose_actors_by_scene=function(t){var e=this,i=this.data.get_internal_scene(t);if(!i)return new tp.a("Cannot find scene "+t);i.get_actor_container().removeChildren().forEach(function(t){if(tt.k(t)){var i=t.get_actor();i.destroy(),e.data.clear_actor_cache(i.get_id())}})},t.prototype.destroy_all_scenes=function(){var t=this;this.get_scene_ids().forEach(function(e){var i=t.data.get_internal_scene(e);i&&i.destroy()}),this.current_scene=void 0,this.data.clear_all_scenes_cache()},t.prototype.get_scene_ids=function(){var t=[];return this.app.get_scene_container().children.forEach(function(e){tt.m(e)&&t.push(e.id)}),t},t.prototype.set_one_scene_visible=function(t){this.app.get_scene_container().children.forEach(function(e){tt.m(e)&&(e.id===t?e.visible=!0:e.visible=!1)}),this.events.fire("scene:current_scene_changed",t)},t.prototype.set_transition_type=function(t){if("distort"===t&&this.app.get_renderer_type()!==q.p.WEBGL)return new tp.a("Only WEBGL support distort transition");this.transition_type=t},t.prototype.get_scene=function(t){var e=this.data.get_internal_scene(t);return e?tp.b.success(e):tp.b.error("Cannot find scene "+t)},t}(),t0=i(66799),t1=function(){function t(t,e,i){this.app=t,this.data=e,this.actor=i}return t.prototype.load_actor=function(t){var e=t.actor_id,i=t.parent_scene_id,o=t.position,n=t.scale,r=t.rotation_type,s=t.rotation,a=t.visible,_=t.group;if(this.data.get_internal_actor(e))return tp.b.error("Actor "+e+" already exists. Please use new actor id");var c=this.data.get_internal_scene(i);if(!c)return tp.b.error("Scene "+i+" should be loaded before loading actor "+e);var h=this.actor({actor_id:e,parent_scene:c,app:this.app,data:this.data});return o&&(h.set_position_x(o.x),h.set_position_y(o.y)),n&&h.set_scale(n.x,n.y),void 0!==s&&h.set_rotation(s),void 0!==r&&h.set_rotation_type(r),void 0!==a&&h.set_visible(a),void 0!==_&&h.set_group(_),tp.b.success(h)},t.prototype.destroy_actor=function(t){var e=this.data.get_internal_actor(t);if(!e)return new tp.a("Cannot find actor "+t);e.destroy()},t.prototype.destroy_all_actors=function(){var t=this;this.app.get_scene_container().children.forEach(function(e){tt.m(e)&&e.get_actor_ids().forEach(function(e){var i=t.data.get_internal_actor(e);i&&i.destroy()})}),this.data.clear_all_actors_cache()},t.prototype.get_actor_ids=function(t){var e=[];return this.app.get_scene_container().children.forEach(function(i){tt.m(i)&&(e=e.concat(i.get_actor_ids(t)))}),e},t.prototype.get_actor=function(t){var e=this.data.get_internal_actor(t);return e?tp.b.success(e):tp.b.error("Cannot find actor "+t)},t}(),t2=i(40868),t5=i(42139),t3=i(97932),t6=(_=function(t,e){return(_=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),t4=function(){function t(t,e,i,o,n,r){if(this.app=t,this.data=e,this.box2d=i,this.scene_world=o,this.actor=n,this.get_strength=r,this.type=t2.a.ELASTIC,this.position_cache=new this.box2d.Vec2,this.particle_system=this.scene_world.world.m_particleSystemList,this.start_rotation=this.actor.rotation,!this.particle_system)throw Error("Trying to init elastic body before particle system initialized. ")}return t.get_max_anchors=function(){if(this._max_anchors)return this._max_anchors;var t=document.createElement("canvas").getContext("webgl");if(!t)throw Error("[Elastic Body]: WebGL not supported");var e=Math.floor(t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS)/5);return this._max_anchors=Math.floor((e-1)/2),this._max_anchors},t.prototype.set_enabled=function(t){var e;if(t&&!this.particle_group){var i=tt.d(this.actor,this.actor.position);this.init({x:t5.o(i.x),y:t5.o(i.y)},null==(e=this.actor.current_style)?void 0:e.texture_id)}else!t&&this.particle_group&&this.clear()},t.prototype.set_dynamic=function(){},t.prototype.set_fixed_rotation=function(t){},t.prototype.set_sensor=function(t){},t.prototype.set_mass=function(t){},t.prototype.get_linear_velocity=function(){if(this.particle_group){var t=this.particle_group.GetLinearVelocity();return new this.box2d.Vec2(t.x,-t.y)}return this.box2d.Vec2_zero},t.prototype.set_linear_velocity=function(t,e){if(this.particle_group)for(var i=this.particle_group.m_firstIndex;i<this.particle_group.m_lastIndex;i++)this.particle_system.m_velocityBuffer.data[i].Set(t,-e)},t.prototype.get_particle_group_rotation=function(){if(!this.particle_group)return 0;if(!this.particle_group_start_rotation)return this.particle_group.GetAngle();var t=this.particle_system.m_positionBuffer.data[this.particle_group.m_firstIndex],e=this.particle_group.GetAnchorPosition(),i=new this.box2d.Vec2;return this.box2d.Vec2.SubVV(t,e,i),i.SelfNormalize(),this.box2d.Atan2(i.y,i.x)-this.box2d.Atan2(this.particle_group_start_rotation.y,this.particle_group_start_rotation.x)},t.prototype.get_rotation=function(){return this.particle_group?this.start_rotation+this.get_particle_group_rotation():this.start_rotation},t.prototype.set_rotation=function(t){if(this.particle_group)for(var e=t-this.get_rotation(),i=this.get_position(),o=this.particle_group.m_firstIndex;o<this.particle_group.m_lastIndex;o++){var n=tt.p(this.particle_system.m_positionBuffer.data[o],i,e);this.particle_system.m_positionBuffer.data[o]=new this.box2d.Vec2(n.x,n.y)}else this.start_rotation=t},t.prototype.get_position=function(){if(!this.particle_group||!this.particle_group_anchor_offset)return this.position_cache;var t=this.particle_group.GetAnchorPosition(),e=this.get_particle_group_rotation(),i=tt.p(this.particle_group_anchor_offset,{x:0,y:0},e);return new this.box2d.Vec2(t.x-i.x,t.y-i.y)},t.prototype.set_position=function(t){if(this.particle_group)for(var e=this.get_position(),i=t.x-e.x,o=t.y-e.y,n=this.particle_group.m_firstIndex;n<this.particle_group.m_lastIndex;n++)this.particle_system.m_positionBuffer.data[n].SelfAddXY(i,o)},t.prototype.scale_points=function(t,e,i){if(!i){for(var o=1/0,n=1/0,r=-1/0,s=-1/0,a=0;a<t.length;a++)o=Math.min(o,t[a].x),n=Math.min(n,t[a].y),r=Math.max(r,t[a].x),s=Math.max(s,t[a].y);i={x:(r+o)/2,y:(s+n)/2}}var _=[];for(a=0;a<t.length;a++){var c={x:t[a].x,y:t[a].y},h=c.x-i.x;c.x=h>0?Math.ceil(h*e+i.x)+1:Math.floor(h*e+i.x)-1;var l=c.y-i.y;c.y=l>0?Math.ceil(l*e+i.y)+1:Math.floor(l*e+i.y)-1,_.push(c)}return _},t.prototype.init=function(t,e){if(e){var i=this.generate_position_data(e);if(i){this.clear();var o=i.points,n=i.triangles,r=new this.box2d.ParticleGroupDef;r.positionData=o,r.flags=this.box2d.ParticleFlag.b2_elasticParticle|this.box2d.ParticleFlag.b2_waterParticle|this.box2d.ParticleFlag.b2_particleContactListenerParticle|this.box2d.ParticleFlag.b2_particleContactFilterParticle|this.box2d.ParticleFlag.b2_fixtureContactListenerParticle|this.box2d.ParticleFlag.b2_fixtureContactFilterParticle,r.groupFlags=this.box2d.ParticleGroupFlag.b2_solidParticleGroup,r.color.SetRGBA(255,255,255,.5),r.strength=this.get_strength(),r.position.Set(t.x,t.y),r.angle=this.actor.rotation,r.id=this.actor.id,this.particle_group=this.particle_system.CreateParticleGroup(r),this.start_rotation=this.actor.rotation;var s=this.particle_group.GetAnchorPosition();this.particle_group_anchor_offset=new this.box2d.Vec2,this.box2d.Vec2.SubVV(s,t,this.particle_group_anchor_offset);var a=this.particle_system.m_positionBuffer.data[this.particle_group.m_firstIndex];this.particle_group_start_rotation=new this.box2d.Vec2,this.box2d.Vec2.SubVV(a,s,this.particle_group_start_rotation),this.particle_group_start_rotation.SelfNormalize();var _=this.particle_group.GetParticleCount(),c=this.particle_group.m_firstIndex;if(!n.length)for(var h=0;h<this.particle_system.GetTriadCount();h++){var l=this.particle_system.GetTriads()[h],p=l.indexA,d=l.indexB,u=l.indexC;this.particle_group.ContainsParticle(p)&&this.particle_group.ContainsParticle(d)&&this.particle_group.ContainsParticle(u)&&n.push([p-c,u-c,d-c])}this.soft_filter=new t3.a({max_num_anchors:_,triangles:n}),this.soft_filter.enabled=!0,this.filters_cache=this.actor.filters,this.actor.filters=[this.soft_filter]}}},t.prototype.clear=function(){this.position_cache=this.get_position(),this.particle_group&&(this.particle_group.DestroyParticles(!1),this.particle_system.DestroyParticleGroup(this.particle_group),this.particle_group=void 0,this.particle_group_anchor_offset=void 0,this.particle_group_start_rotation=void 0,this.soft_filter=void 0,this.actor.filters=this.filters_cache||[],this.filters_cache=void 0)},t.prototype.destroy=function(){this.clear()},t.prototype.on_tick=function(){if(this.soft_filter&&this.particle_group){for(var t=this.get_particle_group_rotation(),e=[],i=this.particle_group.GetAnchorPosition(),o=0;o<this.particle_group.GetParticleCount();o++){var n=this.particle_group.relativePositions[o],r={x:i.x+n.x,y:i.y+n.y};r=tt.p(r,i,t);var s=this.particle_system.m_positionBuffer.data[o+this.particle_group.m_firstIndex];e.push([this.map_physics_coord_to_pixi(r),this.map_physics_coord_to_pixi(s)])}var a=this.app.get_app().view,_=a.width,c=a.height;this.soft_filter.set_anchors(e,_,c)}},t.prototype.apply_force=function(t){var e;null!=(e=this.particle_group)&&e.ApplyForce(t)},t.prototype.generate_position_data=function(e){var i=this,o=this.data.get_texture(e),n=this.data.get_texture_bounds_points(e);if(n&&o){var r=this.actor.get_scale(),s=this.particle_system.GetRadius()*Math.SQRT2,a=t5.o(o.width*r.x),_=t5.o(o.height*r.y),c=Math.sqrt(Math.pow(a+s,2)+Math.pow(_+s,2))/Math.sqrt(Math.pow(a,2)+Math.pow(_,2)),h=this.scale_points(n,c).map(function(t){var e=tt.c(new q.o(t.x,t.y));return new q.o(t5.o((e.x-o.width/2)*i.actor.scale.x),t5.o((e.y-o.height/2)*i.actor.scale.y))}),l=[];h&&tw(h,l);var p=new this.box2d.ParticleSystem_CompositeShape(l.map(function(t){var e=new i.box2d.PolygonShape;return e.Set(t),e})),d=[],u=new Set,f=this.particle_system.GetParticleStride(),g=.5*t.get_max_anchors(),y=Math.max(Math.ceil(Math.sqrt(a*_/g)/f),1),v=this.box2d.Transform.IDENTITY,b=new this.box2d.AABB;for(p.ComputeAABB(b,v,0);!u.size;){for(var x=0,m=Math.floor(b.lowerBound.y/f)*f;m<b.upperBound.y;m+=f){u.size>0&&x++;for(var w=x%y==0||m+f>=b.upperBound.y,O=!1,A=Math.floor(b.lowerBound.x/f)*f,k=0;A<b.upperBound.x;){O&&k++;var T=k%y==0,I=new this.box2d.Vec2(A,m),E=d.length;p.TestPoint(v,I)&&(O||(A+=f/2,I.Set(A,m)),w&&T&&u.add(E),d.push(I),O=!0),O?A+=f:A++}w&&O&&u.add(d.length-1)}u.size>g&&(y++,d.length=0,u.clear())}for(var L=d.length,S=t.get_max_anchors()-g,R=Math.floor(h.length/S),M=new Set;u.size<t.get_max_anchors();){for(var C=this,P=0;P<h.length;P+=R)!function(t){var e=h[t];d.every(function(t){return i.box2d.Vec2.DistanceVV(t,e)>=i.particle_system.GetRadius()})&&(M.add(d.length),d.push(new C.box2d.Vec2(e.x,e.y)))}(P);if(u.size+M.size<=t.get_max_anchors())break;d.length=L,M.clear(),R++}if(u.size===d.length)return{points:d,triangles:[]};var G=[],N=new this.box2d.VoronoiDiagram(u.size+M.size);return u.forEach(function(t){N.AddGenerator(d[t],t,!0)}),M.forEach(function(t){N.AddGenerator(d[t],t,!0)}),N.Generate(f/2,2*f),N.GetNodes(function(t,e,i){G.push([t,e,i])}),{points:d,triangles:G}}},t.prototype.map_physics_coord_to_pixi=function(t){var e=t5.n(t.x),i=t5.n(t.y),o=this.app.get_app().view;return{x:e+o.width/2,y:i+o.height/2}},t.prototype.get_dragged_body=function(t){var e=this,i=new this.box2d.CircleShape;i.m_p.Copy(t),i.m_radius=2*this.particle_system.GetRadius();var o=new this.box2d.BodyDef;o.type=this.box2d.BodyType.b2_dynamicBody,o.position.Copy(t),o.id="ParticleJoint",o.fixedRotation=!1;var n=this.scene_world.world.CreateBody(o),r=new this.box2d.MassData,s=[],a=new this.box2d.AABB;i.ComputeAABB(a,this.box2d.Transform.IDENTITY,0);var _=function(t){function e(e){var i=t.call(this)||this;return i.ReportParticle=e,i}return t6(e,t),e.prototype.ReportFixture=function(t){return!1},e}(this.box2d.QueryCallback);this.scene_world.world.QueryAABB(new _(function(i,o){return s.push({index:o,offset:e.box2d.Vec2.SubVV(i.m_positionBuffer.data[o],t,new e.box2d.Vec2)}),!0}),a);for(var c=0;c<s.length;c++)r.mass=this.particle_system.m_groupBuffer[s[c].index].GetMass();return n.SetMassData(r),this.update_callback&&this.scene_world.update_callbacks.has(this.update_callback)&&this.scene_world.update_callbacks.delete(this.update_callback),this.update_callback=function(){var t=n.GetLinearVelocity(),i=n.GetPosition();s.forEach(function(o){var n=o.index,r=o.offset;e.particle_system.GetVelocityBuffer()[n].Copy(t);var s=e.box2d.Vec2.AddVV(i,r,new e.box2d.Vec2);e.particle_system.m_positionConstraintBuffer[n]=[s,s]})},this.scene_world.update_callbacks.add(this.update_callback),n},t.prototype.on_end_drag=function(){this.update_callback&&(this.scene_world.update_callbacks.delete(this.update_callback),this.update_callback=void 0)},t.prototype.refilter=function(){},t}(),t8=function(){function t(t,e,i,o,n,r,s){this.data=t,this.box2d=e,this.scene_world=i,this.actor=o,this.type=t2.a.NORMAL;var a=new this.box2d.BodyDef;a.type=this.box2d.BodyType.b2_staticBody,a.enabled=!1,a.fixedRotation=!0,a.id=this.actor.id,this.body=this.scene_world.world.CreateBody(a),this.fixture_def=new this.box2d.FixtureDef,this.fixture_def.density=n||t5.b,this.fixture_def.friction=r||t5.c,this.fixture_def.restitution=s||t5.e}return t.prototype.set_enabled=function(t){this.body.SetEnabled(t)},t.prototype.set_dynamic=function(t){this.body.SetType(t?this.box2d.BodyType.b2_dynamicBody:this.box2d.BodyType.b2_staticBody)},t.prototype.set_fixed_rotation=function(t){this.body.SetFixedRotation(t)},t.prototype.set_sensor=function(t){var e=this.body.GetFixtureList();if(t!==(null==e?void 0:e.IsSensor()))for(;e;)e.SetSensor(t),e=e.m_next},t.prototype.set_mass=function(t){var e=this.get_mass();0===e&&(e=1),this.set_density(this.get_density()*t/e)},t.prototype.get_mass=function(){return this.body.GetMass()},t.prototype.set_density=function(t){this.set_physics_property(0,t),this.body.ResetMassData(),this.fixture_def.density=t},t.prototype.get_density=function(){var t=this.body.GetFixtureList();return t?t.GetDensity():0},t.prototype.set_friction=function(t){this.set_physics_property(1,t)},t.prototype.get_friction=function(){var t=this.body.GetFixtureList();return t?t.GetFriction():0},t.prototype.set_restitution=function(t){this.set_physics_property(2,t)},t.prototype.get_restitution=function(){var t=this.body.GetFixtureList();return t?t.GetRestitution():0},t.prototype.get_linear_velocity=function(){var t=this.body.GetLinearVelocity(),e=t.x,i=t.y;return new this.box2d.Vec2(e,-i)},t.prototype.set_linear_velocity=function(t,e){this.body.SetLinearVelocity(new this.box2d.Vec2(t,-e))},t.prototype.get_rotation=function(){return this.body.GetAngle()},t.prototype.set_rotation=function(t){this.body.SetAngle(t),this.body.SetAwake(!0)},t.prototype.get_position=function(){return this.body.GetPosition()},t.prototype.set_position=function(t){this.body.SetPosition(t),this.body.SetAwake(!0)},t.prototype.init=function(t,e){for(var i=this.body.GetFixtureList();i;)this.body.DestroyFixture(i),i=this.body.GetFixtureList();this.body.SetPositionXY(t.x,t.y),this.body.SetAngle(this.actor.rotation),e&&this.create_fixture(e)},t.prototype.destroy=function(){this.scene_world.world.DestroyBody(this.body)},t.prototype.on_tick=function(){},t.prototype.apply_force=function(t){this.body.ApplyForceToCenter(t,!0)},t.prototype.create_fixture=function(t){var e=this;if(this.body&&t){var i=this.data.get_texture_convex_groups(t),o=this.data.get_texture(t);i&&o&&i.forEach(function(t){var i,n=new e.box2d.PolygonShape,r=[];t.forEach(function(t){var i=tt.c(t);r.push(new e.box2d.Vec2(t5.o(i.x-o.width/2)*e.actor.scale.x,t5.o(i.y-o.height/2)*e.actor.scale.y))}),n.Set(r),e.fixture_def.shape=n,null!=(i=e.body)&&i.CreateFixture(e.fixture_def)})}},t.prototype.set_physics_property=function(t,e){for(var i=this.body.GetFixtureList();i;){switch(t){case 0:i.SetDensity(e);break;case 1:i.SetFriction(e);break;case 2:i.SetRestitution(e);break;default:return}i=i.m_next}},t.prototype.refilter=function(){for(var t=this.body.GetFixtureList();t;)t.Refilter(),t=t.m_next},t.prototype.get_dragged_body=function(){return this.body},t.prototype.on_end_drag=function(){},t}(),t7=function(){function t(t,e,i,o,n){var r,s=this;this.app=t,this.data=e,this.box2d=i,this.scene_world=o,this.force_handler_cache=new Set,this.collision_filter=new Set,this.bodies_cache=[],this.should_recreate_body=!1,this.on_actor_change=function(t){var e;if(t.texture||t.scale||t.pivot){if(!s.is_enabled())return void(s.should_recreate_body=!0);s.physics_body.init(s.convert_pixi_to_physics_position(s.actor.position),null==(e=s.actor.get_current_style())?void 0:e.texture_id)}},this.on_actor_destroy=function(){return s.destroy()},this.set_strength=function(t){s.group_strength=t;var e=s.bodies_cache[t2.a.ELASTIC];(null==e?void 0:e.particle_group)&&(e.particle_group.m_strength=s.group_strength)},this.get_strength=function(){return s.group_strength},this.physics_set_pixi_position=function(t,e){if(!s.actor.is_dragging()||!s.is_enabled()){var i=s.convert_pixi_to_physics_position(new q.o(t,e));s.bodies_cache.forEach(function(t){return t.set_position(i)}),s.fork_set_pixi_position(t,e)}},this.physics_set_pixi_rotation=function(t){s.bodies_cache.forEach(function(e){return e.set_rotation(t)}),s.fork_set_pixi_rotation(t)},this.handler=function(){if(s.is_enabled()){var t=s.physics_body.get_rotation(),e=s.physics_body.get_position(),i=e.x,o=e.y,n=s.convert_physics_to_pixi_position(i,o,t);s.fork_set_pixi_rotation(t),s.fork_set_pixi_position(n.x,n.y),s.actor.set_rotation_value(s.convert_to_rotation_value(t))}s.update_body_state(),s.physics_body.on_tick(),s.force_handler_cache.size&&s.force_handler_cache.forEach(function(t){return t()})},this.drag_start=function(t){if((s.collidable||s.forceable)&&s.actor.get_draggable()){s.mouse_joint&&s.scene_world.world.DestroyJoint(s.mouse_joint);var e=t.data.getLocalPosition(s.actor.parent),i={x:t5.o(e.x),y:t5.o(e.y)},o=s.physics_body.get_dragged_body(i),n=new s.box2d.MouseJointDef;n.bodyA=s.mouse_joint_dummy_body,n.bodyB=o,n.target.Set(i.x,i.y),n.maxForce=t5.i*o.m_mass,n.stiffness=t5.k,n.damping=t5.a,s.mouse_joint=s.scene_world.world.CreateJoint(n),o.SetAwake(!0)}},this.drag_move=tt.w(function(t){if((s.collidable||s.forceable)&&s.actor.is_dragging()&&s.mouse_joint){var e=s.app.get_app().view,i=e.width,o=e.height,n=t.data.getLocalPosition(s.actor.parent);if(tt.n(n,{width:i,height:o})){var r={x:t5.o(n.x),y:t5.o(n.y)};s.mouse_joint.GetTarget().Set(r.x,r.y),s.mouse_joint.GetBodyB().SetAwake(!0)}}},tt.a),this.drag_end=function(){(s.collidable||s.forceable)&&s.mouse_joint&&(s.scene_world.world.DestroyJoint(s.mouse_joint),s.mouse_joint=void 0,s.physics_body.on_end_drag())},this.on_destroy=n.on_destroy,this.actor=n.actor,this.actor_id=n.actor.id,this.mouse_joint_dummy_body=n.mouse_joint_dummy_body,this.collidable=n.collidable,this.forceable=n.forceable,this.elastic=n.elastic,this.group_strength=n.strength||1;var a=n.density,_=n.friction,c=n.restitution;this.physics_body=this.get_normal_body(a,_,c),this.elastic&&(this.physics_body=this.get_elastic_body());var h=null==(r=this.actor.get_current_style())?void 0:r.texture_id,l=this.convert_pixi_to_physics_position(this.actor.position);this.bodies_cache.forEach(function(t){return t.init(l,h)}),this.update_body_state(),this.app.get_app().ticker.add(this.handler),this.fork_set_pixi_position=this.actor.set_pixi_position.bind(this.actor),this.actor.set_pixi_position=this.physics_set_pixi_position.bind(this),this.fork_set_pixi_rotation=this.actor.set_pixi_rotation.bind(this.actor),this.actor.set_pixi_rotation=this.physics_set_pixi_rotation.bind(this),this.actor.add_listener("change",this.on_actor_change),this.actor.add_listener("destroy",this.on_actor_destroy),this.actor.addListener("mousedown",this.drag_start),this.actor.addListener("mousemove",this.drag_move),this.actor.addListener("mouseup",this.drag_end),this.actor.addListener("mouseupoutside",this.drag_end),this.actor.addListener("touchstart",this.drag_start),this.actor.addListener("touchmove",this.drag_move),this.actor.addListener("touchend",this.drag_end),this.actor.addListener("touchendoutside",this.drag_end)}return t.prototype.update_body_state=function(){var t,e=this.is_enabled();if(this.physics_body.set_enabled(e),e){this.should_recreate_body&&(this.physics_body.init(this.convert_pixi_to_physics_position(this.actor.position),null==(t=this.actor.get_current_style())?void 0:t.texture_id),this.should_recreate_body=!1),this.physics_body.set_dynamic(this.forceable);var i=this.forceable&&!this.collidable;this.physics_body.set_sensor(i)}},t.prototype.get_elastic_body=function(){if(this.bodies_cache[t2.a.ELASTIC])return this.bodies_cache[t2.a.ELASTIC];var t=new t4(this.app,this.data,this.box2d,this.scene_world,this.actor,this.get_strength);return this.bodies_cache[t2.a.ELASTIC]=t,t},t.prototype.get_normal_body=function(t,e,i){if(this.bodies_cache[t2.a.NORMAL])return this.bodies_cache[t2.a.NORMAL];var o=new t8(this.data,this.box2d,this.scene_world,this.actor,t,e,i);return this.bodies_cache[t2.a.NORMAL]=o,o},t.prototype.convert_pixi_to_physics_position=function(t){var e=tt.d(this.actor,t);return{x:t5.o(e.x),y:t5.o(e.y)}},t.prototype.convert_physics_to_pixi_position=function(t,e,i){var o={x:t5.n(t),y:t5.n(e)},n={x:o.x+this.actor.pivot.x*this.actor.scale.x,y:o.y+this.actor.pivot.y*this.actor.scale.y};return tt.p(n,o,i)},t.prototype.add_ids_to_collision_filter=function(t){var e=this;if(0!==t.length){var i=!1;t.forEach(function(t){!e.collision_filter.has(t)&&(e.collision_filter.add(t),i||(i=!0))}),i&&this.physics_body.refilter()}},t.prototype.remove_ids_from_collision_filter=function(t){var e=this;t.forEach(function(t){e.collision_filter.has(t)&&e.collision_filter.delete(t)})},t.prototype.prevent_collision_with_actors=function(t){this.add_ids_to_collision_filter(t)},t.prototype.prevent_collision_with_edges=function(t){var e=[];t.forEach(function(t){e.push(t.toString())}),this.add_ids_to_collision_filter(e)},t.prototype.enable_collision_with_actors=function(t){this.remove_ids_from_collision_filter(t)},t.prototype.enable_collision_with_edges=function(t){var e=[];t.forEach(function(t){e.push(t.toString())}),this.remove_ids_from_collision_filter(e)},t.prototype.set_collidable=function(t){this.collidable=t},t.prototype.set_forceable=function(t){this.forceable=t},t.prototype.is_enabled=function(){return this.actor.visible&&(this.collidable||this.forceable)},t.prototype.is_dynamic=function(){return this.forceable},t.prototype.set_fixed_rotation=function(t){this.bodies_cache.forEach(function(e){return e.set_fixed_rotation(t)})},t.prototype.get_collision_filter=function(){return this.collision_filter},t.prototype.set_mass=function(t){this.get_normal_body().set_mass(t)},t.prototype.get_mass=function(){return this.get_normal_body().get_mass()},t.prototype.set_density=function(t){this.get_normal_body().set_density(t)},t.prototype.get_density=function(){return this.get_normal_body().get_density()},t.prototype.set_friction=function(t){this.get_normal_body().set_friction(t)},t.prototype.get_friction=function(){return this.get_normal_body().get_friction()},t.prototype.set_restitution=function(t){this.get_normal_body().set_restitution(t)},t.prototype.get_restitution=function(){return this.get_normal_body().get_restitution()},t.prototype.set_elastic=function(t){var e;if(t!==this.elastic){var i=this.physics_body.get_rotation(),o=this.physics_body.get_position(),n=this.physics_body.get_linear_velocity(),r=this.is_enabled();this.physics_body.set_enabled(!1),this.physics_body=t?this.get_elastic_body():this.get_normal_body(),this.physics_body.type===t2.a.NORMAL&&this.physics_body.init(this.convert_pixi_to_physics_position(this.actor.position),null==(e=this.actor.get_current_style())?void 0:e.texture_id),this.physics_body.set_enabled(r),this.physics_body.set_rotation(i),this.physics_body.set_position(o),this.physics_body.set_linear_velocity(n.x,n.y),this.elastic=t}},t.prototype.get_linear_velocity=function(){return this.physics_body.get_linear_velocity()},t.prototype.set_linear_velocity=function(t,e){this.physics_body.set_linear_velocity(t,e)},t.prototype.apply_force=function(t,e){var i=new this.box2d.Vec2(t,-e);this.physics_body.apply_force(i)},t.prototype.apply_force_in_time=function(t){var e=this,i=t.time,o=t.x,n=t.y,r=t.on_complete,s=Math.round(i/t5.f),a=1;this.force_handler_cache.add(function t(){a>s?(e.force_handler_cache.delete(t),r()):(e.apply_force(o,n),a++)})},t.prototype.destroy=function(){this.app.get_app().ticker.remove(this.handler),this.actor.removeListener("mousedown",this.drag_start),this.actor.removeListener("mousemove",this.drag_move),this.actor.removeListener("mouseup",this.drag_end),this.actor.removeListener("mouseupoutside",this.drag_end),this.actor.removeListener("touchstart",this.drag_start),this.actor.removeListener("touchmove",this.drag_move),this.actor.removeListener("touchend",this.drag_end),this.actor.removeListener("touchendoutside",this.drag_end),this.actor.remove_listener("change",this.on_actor_change),this.actor.remove_listener("destroy",this.on_actor_destroy),this.mouse_joint&&this.scene_world.world.DestroyJoint(this.mouse_joint),this.bodies_cache.forEach(function(t){return t.destroy()}),this.actor.set_pixi_position=this.fork_set_pixi_position,this.actor.set_pixi_rotation=this.fork_set_pixi_rotation,this.on_destroy()},t.prototype.convert_to_rotation_value=function(t){var e=tt.s(-t);return this.actor.is_rotation_flipped?tt.s(e+Math.PI):e},t.prototype.get_velocity_direction=function(){var t=this.physics_body.get_linear_velocity();return tt.v(Math.atan2(t.y,t.x))},t.prototype.get_current_physics_body=function(){return this.physics_body},t}(),t9=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},et=function(){function t(t,e,i,o,n){var r=this;this.app=t,this.data=e,this.scene=i,this.box2d=o,this.body_list=new Map,this.collision_list=new Set,this.edge_list=new Map,this.update_callbacks=new Set,this.update=function(){r.world.Step(t5.f,t5.l,t5.j),r.update_callbacks.forEach(function(t){return t()})},this.on_scene_destroy=function(){return r.destroy()},this.world=new o.World(new o.Vec2(0,n||t5.d));var s=new this.box2d.ParticleSystemDef;s.radius=1.2,this.world.CreateParticleSystem(s);var a=new o.ContactListener,_=function(t,e){if(t&&e&&t!==e){var i=t5.m(t,e),o=t5.m(e,t);r.collision_list.add(i),r.collision_list.add(o)}};a.BeginContact=function(t){return _(t.GetFixtureA().GetBody().GetId(),t.GetFixtureB().GetBody().GetId())},a.BeginContactBodyParticleGroup=function(t,e){var i;return _(e.body.GetId(),(null==(i=t.m_groupBuffer[e.index])?void 0:i.id)||"")},a.BeginContactParticleGroupParticleGroup=function(t,e){var i,o;return _((null==(i=t.m_groupBuffer[e.GetIndexA()])?void 0:i.id)||"",(null==(o=t.m_groupBuffer[e.GetIndexB()])?void 0:o.id)||"")};var c=function(t,e){if(t&&e&&t!==e){var i=t5.m(t,e),o=t5.m(e,t);r.collision_list.delete(i),r.collision_list.delete(o)}};a.EndContact=function(t){return c(t.GetFixtureA().GetBody().GetId(),t.GetFixtureB().GetBody().GetId())},a.EndContactBodyParticleGroup=function(t,e){var i;return c(e.body.GetId(),(null==(i=t.m_groupBuffer[e.index])?void 0:i.id)||"")},a.EndContactParticleGroupParticleGroup=function(t,e){var i,o;return c((null==(i=t.m_groupBuffer[e.GetIndexA()])?void 0:i.id)||"",(null==(o=t.m_groupBuffer[e.GetIndexB()])?void 0:o.id)||"")};var h=function(t,e){var i=r.body_list.get(t),o=r.body_list.get(e);return!(null==i?void 0:i.get_collision_filter().has(e))&&!(null==o?void 0:o.get_collision_filter().has(t))},l=new o.ContactFilter;l.ShouldCollide=function(t,e){return h(t.GetBody().GetId(),e.GetBody().GetId())},l.ShouldCollideFixtureParticle=function(t,e,i){var o;return h(t.GetBody().GetId(),(null==(o=e.m_groupBuffer[i])?void 0:o.id)||"")},l.ShouldCollideParticleParticle=function(t,e,i){var o,n;return h((null==(o=t.m_groupBuffer[e])?void 0:o.id)||"",(null==(n=t.m_groupBuffer[i])?void 0:n.id)||"")},this.world.SetContactListener(a),this.world.SetContactFilter(l),this.scene.add_listener("destroy",this.on_scene_destroy),this.mouse_joint_dummy_body=this.world.CreateBody(),this.app.get_app().ticker.add(this.update)}return t.prototype.create_body=function(t){var e=this,i=this.data.get_internal_actor(t.actor_id);if(i){var o=t.density,n=t.friction,r=t.restitution,s=t.strength,a=new t7(this.app,this.data,this.box2d,this,{on_destroy:function(){e.body_list.delete(t.actor_id)},actor:i,mouse_joint_dummy_body:this.mouse_joint_dummy_body,collidable:!!t.collidable,forceable:!!t.forceable,elastic:!!t.elastic,density:o,friction:n,restitution:r,strength:s});return this.body_list.set(t.actor_id,a),a}},t.prototype.create_edges=function(t){if(0!==t.length){var e,i,o=this.app.get_app().view,n=o.width,r=o.height,s=t5.o(n)/2,a=t5.o(r)/2;try{for(var _=t9(t),c=_.next();!c.done;c=_.next()){var h=c.value;if(!this.edge_list.get(h)){var l=0,p=0;switch(h){case Q.b.TOP:p=-a-t5.h;break;case Q.b.BOTTOM:p=a+t5.h;break;case Q.b.LEFT:l=-s-t5.h;break;case Q.b.RIGHT:l=s+t5.h;break;default:return}var d=this.world.CreateBody({id:h.toString()}),u=new this.box2d.PolygonShape;u.SetAsBox(t5.h,t5.h),d.CreateFixture(u,t5.g),d.SetPositionXY(l,p),this.edge_list.set(h,d)}}}catch(t){e={error:t}}finally{try{c&&!c.done&&(i=_.return)&&i.call(_)}finally{if(e)throw e.error}}}},t.prototype.destroy_edges=function(t){if(0!==t.length&&0!==this.edge_list.size)try{for(var e,i,o=t9(t),n=o.next();!n.done;n=o.next()){var r=n.value,s=this.edge_list.get(r);s&&(s.GetWorld().DestroyBody(s),this.edge_list.delete(r))}}catch(t){e={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(e)throw e.error}}},t.prototype.destroy_body=function(t){var e=this.body_list.get(t);e&&e.destroy()},t.prototype.destroy=function(){this.app.get_app().ticker.remove(this.update),this.scene.remove_listener("destroy",this.on_scene_destroy),this.body_list.forEach(function(t){t.destroy()}),this.edge_list.forEach(function(t){t.GetWorld().DestroyBody(t)}),this.body_list.clear(),this.edge_list.clear(),this.collision_list.clear()},t.prototype.get_body=function(t){return this.body_list.get(t)},t.prototype.set_gravity=function(t,e){this.world.SetGravity(new this.box2d.Vec2(t,-e))},t.prototype.check_bumped=function(t,e){var i=this.data.get_internal_actor(t),o=this.data.get_internal_actor(e);if(!i||i.has_left_stage()||!o||o.has_left_stage())return!1;var n=this.get_body(t),r=this.get_body(e);if(!n||!n.is_enabled()||!r||!r.is_enabled())return!1;var s=t5.m(t,e),a=t5.m(e,t);return this.collision_list.has(s)||this.collision_list.has(a)},t.prototype.check_collision_with_edge=function(t,e){var i,o,n=this.data.get_internal_actor(t);if(!n||n.has_left_stage())return!1;var r=this.get_body(t);if(!r||!r.is_enabled())return!1;var s=e?[e]:[Q.b.TOP,Q.b.BOTTOM,Q.b.LEFT,Q.b.RIGHT];try{for(var a=t9(s),_=a.next();!_.done;_=a.next()){var c=_.value,h=this.edge_list.get(c);if(h){var l=h.GetId(),p=t5.m(t,l),d=t5.m(l,t);if(this.collision_list.has(p)||this.collision_list.has(d))return!0}}}catch(t){i={error:t}}finally{try{_&&!_.done&&(o=a.return)&&o.call(a)}finally{if(i)throw i.error}}return!1},t}(),ee=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var _=[r,a];if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&_[0]?o.return:_[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,_[1])).done)return n;switch(o=0,n&&(_=[2&_[0],n.value]),_[0]){case 0:case 1:n=_;break;case 4:return s.label++,{value:_[1],done:!1};case 5:s.label++,o=_[1],_=[0];continue;case 7:_=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===_[0]||2===_[0])){s=0;continue}if(3===_[0]&&(!n||_[1]>n[0]&&_[1]<n[3])){s.label=_[1];break}if(6===_[0]&&s.label<n[1]){s.label=n[1],n=_;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(_);break}n[2]&&s.ops.pop(),s.trys.pop();continue}_=e.call(t,s)}catch(t){_=[6,t],o=0}finally{i=n=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}},ei=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},eo=function(){function t(t,e){this.app=t,this.data=e,this.world_list=new Map}return t.prototype.init=function(t){var e,o,n,r,s;return o=this,n=void 0,r=void 0,s=function(){var o,n,r,s,a,_,c=this;return ee(this,function(h){switch(h.label){case 0:return this.box2d?[3,2]:(o=this,[4,i.e("346").then(i.bind(i,99145))]);case 1:o.box2d=h.sent(),h.label=2;case 2:return!t||this.debug_draw?[3,4]:(n=this.app.get_app().view).parentElement?((r=document.createElement("canvas")).width=n.width,r.height=n.height,r.style.width=n.style.width,r.style.height=n.style.height,r.style.position="absolute",r.style.top="0",r.style.left="0",r.style.pointerEvents="none",n.parentElement.appendChild(r),[4,Promise.all([i.e("346"),i.e("537")]).then(i.bind(i,86768))]):[2];case 3:s=h.sent().DebugDraw,this.debug_draw=new s(r),_=(a=this.box2d.DrawFlags).e_none|a.e_shapeBit|a.e_particleBit,null!=(e=this.debug_draw)&&e.SetFlags(_),this.draw_handler=function(t){var e,i,o;null!=(i=null==(e=c.debug_draw)?void 0:e.m_ctx)&&i.clearRect(0,0,r.width,r.height),t&&null!=(o=c.latest_world)&&o.world.DebugDraw()},h.label=4;case 4:return[2]}})},new(r||(r=Promise))(function(t,e){function i(t){try{_(s.next(t))}catch(t){e(t)}}function a(t){try{_(s.throw(t))}catch(t){e(t)}}function _(e){var o;e.done?t(e.value):((o=e.value)instanceof r?o:new r(function(t){t(o)})).then(i,a)}_((s=s.apply(o,n||[])).next())})},t.prototype.create_world=function(t,e){var i=this.data.get_internal_scene(t);if(this.box2d&&i){var o=new et(this.app,this.data,i,this.box2d,e);return this.debug_draw&&(o.world.SetDebugDraw(this.debug_draw),0===this.world_list.size&&this.draw_handler&&this.app.get_app().ticker.add(this.draw_handler)),this.world_list.set(t,o),this.latest_world=o,o}},t.prototype.destroy_world=function(t){var e,i=this.world_list.get(t);if(!i)return new tp.a("Can not find world with id "+t);this.world_list.delete(t),i.destroy(),this.latest_world===i&&(this.latest_world=void 0),this.draw_handler&&0===this.world_list.size&&(this.app.get_app().ticker.remove(this.draw_handler),null!=(e=this.draw_handler)&&e.call(this,0))},t.prototype.destroy_all_worlds=function(){try{for(var t,e,i=ei(this.world_list.keys()),o=i.next();!o.done;o=i.next()){var n=o.value;this.destroy_world(n)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}},t.prototype.get_world=function(t){var e=this.world_list.get(t);return this.latest_world=e||this.latest_world,e},t}(),en=new Y.Container;en.bind(J.Events).to(tG).inSingletonScope(),en.bind(J.App).to(ty),en.bind(J.Data).toFactory(function(){return function(t){return new tC(t)}}),en.bind(J.Textures).toFactory(function(){return function(t){return new tB(t)}}),en.bind(J.Transition).toFactory(function(){return function(t){return new tW(t)}}),en.bind(J.StageAnimation).toFactory(function(){return function(t){return new tl(t)}}),en.bind(J.Physics).toFactory(function(){return function(t,e){return new eo(t,e)}}),en.bind(J.Scene).toFactory(function(t){var e=t.container.get(J.Events);return function(t,i,o,n,r){return new tZ(t,i,o,n,r,e)}}),en.bind(J.Scenes).toFactory(function(t){var e=t.container.get(J.Events),i=t.container.get(J.Transition),o=t.container.get(J.Scene);return function(t,n){return new t$(t,n,i,o,e)}}),en.bind(J.Actor).toFactory(function(t){return function(e){var i=Object.assign({},e,{events:t.container.get(J.Events)});return new t0.a(i)}}),en.bind(J.Actors).toFactory(function(t){var e=t.container.get(J.Actor);return function(t,i){return new t1(t,i,e)}}),en.bind(J.Stage).to(ts);var er=function(){function t(){this.loader=q.k.shared,this.tasks=[],this.is_loading=!1}return t.prototype.add=function(t){this.tasks.push(t),this.is_loading||this.execute()},t.prototype.get_resources=function(){return this.loader.resources},t.prototype.execute=function(){var t=this;this.is_loading=!0;var e=this.tasks.shift();if(e){var i=this.loader.resources[e.url];if(i)return e.on_success&&e.on_success(i),void this.execute();this.loader.add(e.url).load(function(i,o){var n=o[e.url];if(!n||n.error){var r=n?n.error:Error("No available resource.");e.on_error&&e.on_error(r),n&&delete o[e.url]}n&&!n.error&&e.on_success&&e.on_success(n),t.execute()})}else this.is_loading=!1},t}(),es=i(57180);function ea(t,e){this.actor_dialogs=new Map,this.dialog_containers=new Map,this.actor_destroy_handlers=new Map,this.app=t,this.data=e}ea.prototype.load_dialog=function(t,e){var i=t.parent_scene,o=this.get_dialog_container(i);this.actor_dialogs.set(t.get_id(),e),o.addChild(e.get_graphics())},ea.prototype.destroy_actor_dialog=function(t){var e=this.actor_dialogs.get(t);if(!e)return new tp.a("Actor dialog "+t+" has not been found");var i=this.data.get_internal_actor(t),o=this.actor_destroy_handlers.get(t);i&&o&&(i.remove_listener("destroy",o),this.actor_destroy_handlers.delete(t)),this.actor_dialogs.delete(t),e.destroy()},ea.prototype.destroy_all_actor_dialogs=function(){var t=this;this.dialog_containers.forEach(function(e){t.destroy_dialog_container(e)})},ea.prototype.set_container_z_index=function(){console.warn("Method deprecated. It will not change anything.")},ea.prototype.destroy=function(){this.destroy_all_actor_dialogs()},ea.prototype.get_dialog_container=function(t){var e=this,i=t.get_id(),o=this.dialog_containers.get(i);return o||(o=new q.f,t.addChild(o),this.dialog_containers.set(i,o),t.add_listener("destroy",function(){var t=e.dialog_containers.get(i);t&&e.destroy_dialog_container(t)})),o},ea.prototype.destroy_dialog_container=function(t){var e=this,i=t.parent;tt.m(i)&&(this.dialog_containers.delete(i.get_id()),t.removeChildren().forEach(function(t){t.name&&e.actor_dialogs.delete(t.name),t.destroy()})),t.destroy()};var e_=function(){function t(t,e,i){var o=this;this.actor_dialog=new q.j,this.text=new q.v(""),this.content_width=0,this.content_height=0,this.on_change=function(t){o.update_on_change(t)},this.update_on_change=function(t){(t.position||t.scale||t.rotation)&&o.update_dialog_position(),void 0!==t.alpha&&o.update_dialog_alpha(),(t.position||t.scale||t.rotation||void 0!==t.visible)&&o.update_dialog_visible()},this.actor_dialog.name=t.id,this.text.name="text",this.actor=t,this.STAGE_WIDTH=e,this.STAGE_HEIGHT=i,this.actor_dialog.addChild(this.text),this.actor.add_listener("change",this.on_change)}return t.prototype.update_dialog_alpha=function(){this.actor_dialog.alpha=this.actor.get_alpha()},t.prototype.update_dialog_visible=function(){var t=this.actor.get_visible()&&0!==this.actor.get_scale().x;this.actor_dialog.visible=t},t.prototype.update_dialog_position=function(){var t=tt.d(this.actor,this.actor.position);this.actor_dialog.position.set(t.x,t.y-this.actor.height/2-this.actor_dialog.height),this.actor_dialog.scale.x=1,this.text.scale.x=1;var e=this.content_width===this.DIALOG_MIN_WIDTH?(this.content_width-this.text.width)/2:this.TEXT_PADDING;this.text.position.x=e,this.text.position.y=this.TEXT_PADDING,this.calibrate_edge_detection(this.actor_dialog.getBounds(),t)},t.prototype.calibrate_edge_detection=function(t,e){var i=this.STAGE_WIDTH/2,o=this.STAGE_HEIGHT/2,n=t.x+t.width>this.STAGE_WIDTH,r=t.x<0,s=t.y<0,a=t.y+t.height>this.STAGE_HEIGHT;n&&this.actor_dialog.scale.x>0&&(this.actor_dialog.scale.x=-1,this.text.scale.x=-1,this.text.position.x=this.content_width-this.text.position.x,e.x>i&&(this.actor_dialog.position.x=i)),r&&(this.actor_dialog.position.x=-i),s&&(this.actor_dialog.position.y=-o),a&&(this.actor_dialog.position.y=o-this.actor_dialog.height)},t.prototype.actor_is_in_stage=function(){var t=this.actor.getBounds();return t.x<this.STAGE_WIDTH&&t.x>-t.width&&t.y<this.STAGE_HEIGHT&&t.y>-t.height},t.prototype.destroy=function(){this.actor.remove_listener("change",this.on_change),this.actor_dialog.destroy({children:!0,texture:!0})},t.prototype.get_graphics=function(){return this.actor_dialog},t}(),ec=(c=function(t,e){return(c=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}c(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),eh={fontSize:"26px",fontFamily:["PingFangSC-Medium","Microsoft YaHei"],fill:"#666666",wordWrap:!0,wordWrapWidth:208,breakWords:!0,lineHeight:36},el=function(){function t(t,e){this.dialog_cache=new Map,this.app=t,this.data=e}return t.prototype.load_actor_dialog=function(t,e,i){var o=this,n=this.data.get_internal_actor(t);if(!n)return new tp.a("Actor "+t+" has not been found");var r=this.dialog_cache.get(t);if(!r){var s=this.app.get_app_view_size();(r=new ep(n,i,s.width,s.height,this.app.get_renderer_type()===q.p.WEBGL)).get_graphics().setParent(n.wrapper),this.dialog_cache.set(t,r),n.add_listener("destroy",function(){o.destroy_actor_dialog(t)})}r.update(e,i)},t.prototype.destroy_actor_dialog=function(t){var e=this.dialog_cache.get(t);if(!e)return new tp.a("Actor dialog "+t+" has not been found");this.dialog_cache.delete(t),e.destroy()},t.prototype.destroy_all_actor_dialogs=function(){this.dialog_cache.forEach(function(t){t.destroy()}),this.dialog_cache.clear()},t.prototype.destroy=function(){this.destroy_all_actor_dialogs()},t}(),ep=function(t){function e(e,i,o,n,r){var s=t.call(this,e,o,n)||this;return s.DIALOG_MIN_WIDTH=108,s.DIALOG_MAX_WIDTH=248,s.TEXT_PADDING=20,s.bubbles=new q.j,s.update_on_change=function(t){(t.position||t.scale||t.rotation)&&s.update_dialog_position()},s.type=i,s.actor=e,s.text.style=eh,s.bubbles.name="bubbles",s.actor_dialog.addChild(s.bubbles),s.update_dialog_style(),r&&(s.actor_dialog.filters=[new q.h({rotation:45,distance:3,alpha:.15,color:0,blur:0})]),s}return ec(e,t),e.prototype.update=function(t,e){(t!==this.text.text||e!==this.type)&&(this.text.text=t,this.type=e,this.update_dialog_style()),this.update_dialog_position()},e.prototype.update_dialog_style=function(){var t,e,i=this.text.width+2*this.TEXT_PADDING;this.content_height=this.text.height+30,this.content_width=te.a(this.DIALOG_MIN_WIDTH,this.DIALOG_MAX_WIDTH,i);var o={start_x:.1*this.DIALOG_MAX_WIDTH,center_x:.1*this.DIALOG_MAX_WIDTH-5},n={x:25,y:this.content_height+20},r={x:5,y:this.content_height+40},s=this.content_height>80?40:this.content_height/2,a=(null==(e=null==(t=this.actor)?void 0:t.app)?void 0:e.get_app().renderer.type)===q.p.CANVAS;switch(this.actor_dialog.clear(),this.bubbles.clear(),this.type){case es.a.SAYING:a&&(this.actor_dialog.beginFill(0,.3),this.actor_dialog.drawRoundedRect(0,0,this.content_width+1,this.content_height+1,16),this.actor_dialog.moveTo(o.start_x,this.content_height),this.actor_dialog.lineTo(o.center_x+1,this.content_height+25+1),this.actor_dialog.lineTo(o.start_x+1+25,this.content_height+1),this.actor_dialog.endFill()),this.actor_dialog.beginFill(0xffffff),this.actor_dialog.drawRoundedRect(0,0,this.content_width,this.content_height,16),this.actor_dialog.moveTo(o.start_x,this.content_height),this.actor_dialog.lineTo(o.center_x,this.content_height+25),this.actor_dialog.lineTo(o.start_x+25,this.content_height),this.actor_dialog.endFill(),this.bubbles.visible=!1;break;case es.a.THINKING:a&&(this.bubbles.beginFill(0,.3),this.bubbles.drawEllipse(n.x+1,n.y+1,13,10),this.bubbles.drawEllipse(r.x+1,r.y+1,8,6),this.bubbles.endFill(),this.bubbles.visible=!0,this.actor_dialog.beginFill(0,.3),this.actor_dialog.drawRoundedRect(0,0,this.content_width+1,this.content_height+1,s),this.actor_dialog.endFill()),this.bubbles.beginFill(0xffffff),this.bubbles.drawEllipse(n.x,n.y,13,10),this.bubbles.drawEllipse(r.x,r.y,8,6),this.bubbles.endFill(),this.bubbles.visible=!0,this.actor_dialog.beginFill(0xffffff),this.actor_dialog.drawRoundedRect(0,0,this.content_width,this.content_height,s),this.actor_dialog.endFill()}},e}(e_);(h=z||(z={}))[h.RECORDING=0]="RECORDING",h[h.RECOGNITION=1]="RECOGNITION";var ed={distance:2,color:0,alpha:.5,rotation:45,blur:0},eu={alpha:.22,rotation:90,distance:3},ef={fontFamily:["PingFangSC","Microsoft YaHei"],fontSize:20,fontWeight:"500",align:"center"},eg={fontFamily:["PingFangSC","Microsoft YaHei"],fontSize:20,fontWeight:"400",lineHeight:26,align:"left",fill:"#000000",wordWrap:!0,wordWrapWidth:550,breakWords:!0},ey={width:7,gap:15,max_height:65,min_height:10,num_per_side:8,color:0xff4455},ev={width:3,gap:8,max_height:23,min_height:5,num_per_side:14,color:1952135},eb=(l=function(t,e){return(l=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ex=function(t){function e(e,i){var o=t.call(this)||this;return o.is_touching=!1,o.on_default_mouse_down=function(){o.is_touching=!0},o.on_default_mouse_up=function(){o.is_touching&&(o.is_touching=!1,o.type&&o.events.fire("voice_dialog_btn:click",{type:o.type}))},o.on_default_mouse_out=function(){o.is_touching=!1},o.app=e,o.events=i,o.interactive=!0,o.addListener("mousedown",o.on_default_mouse_down).addListener("mouseup",o.on_default_mouse_up).addListener("mouseout",o.on_default_mouse_out).addListener("touchstart",o.on_default_mouse_down).addListener("touchend",o.on_default_mouse_up).addListener("touchendoutside",o.on_default_mouse_out),o}return eb(e,t),e}(q.j),em=function(t){function e(e,i,o,n){void 0===o&&(o=1);var r=t.call(this,e,i)||this;return r.icon=new q.t,r.default_alpha=o,r.active_alpha=void 0===n?o:n,r.icon.anchor.set(.5),r.set_icon_alpha(r.default_alpha),r.default_alpha!==r.active_alpha&&r.addListener("mouseover",function(){r.set_icon_alpha(r.active_alpha)}).addListener("mouseout",function(){r.set_icon_alpha(r.default_alpha)}),r.addChild(r.icon),r}return eb(e,t),e.prototype.set_icon_texture=function(t){this.icon.texture=t},e.prototype.set_icon_alpha=function(t){this.icon.alpha=t,this.app.render()},e}(ex),ew=function(t){function e(e,i){var o=t.call(this,e,i,.4,.3)||this;return o.scale.set(.16),o.type="close_btn",o}return eb(e,t),e}(em),eO=function(t){function e(e,i){var o=t.call(this,e,i,1,.7)||this;return o.scale.set(.56),o.app.get_renderer_type()===q.p.WEBGL&&(o.drop_shadow_filter=new q.h(eu),o.filters=[o.drop_shadow_filter]),o}return eb(e,t),e.prototype.set_textures=function(t){this.textures=t},e.prototype.draw_btn=function(t){if(this.textures&&this.type!==t&&(this.type=t,this.set_icon_texture(this.textures[this.type]),this.drop_shadow_filter)){switch(t){case"recorder_btn":this.drop_shadow_filter.color=0xff4455,this.drop_shadow_filter.blur=5;break;case"terminate_btn":this.drop_shadow_filter.color=0xf06060,this.drop_shadow_filter.blur=5;break;case"play_btn":case"stop_btn":this.drop_shadow_filter.color=1298827,this.drop_shadow_filter.blur=7;break;case"recognize_btn":return void(this.filters=[])}this.filters=[this.drop_shadow_filter]}},e}(em),eA=function(t){function e(e,i,o,n,r){void 0===n&&(n=1);var s=t.call(this,e,i)||this;return s.text=new q.v("",ef),s.default_alpha=n,s.active_alpha=void 0===r?n:r,s.type=o,s.cursor="pointer",s.text.anchor.set(.5),s.default_alpha!==s.active_alpha&&s.addListener("mouseover",function(){s.set_text_alpha(s.active_alpha)}).addListener("mouseout",function(){s.set_text_alpha(s.default_alpha)}),s.addChild(s.text),s}return eb(e,t),e.prototype.set_text=function(t){this.text.text=t},e.prototype.set_text_color=function(t){this.text.style.fill=t},e.prototype.set_text_alpha=function(t){this.text.alpha=t,this.app.render()},e}(ex),ek=(p=function(t,e){return(p=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}p(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),eT=function(t){function e(e){var i=e.gap,o=e.num_per_side,n=e.width,r=e.max_height,s=e.min_height,a=e.color,_=t.call(this)||this;_.animation_interval=120,_.current_central_gap=0,_.max_item_height=r,_.min_item_height=s,_.item_num_per_side=o,_.item_gap=i;for(var c=n/2,h=0;h<2*_.item_num_per_side;h++){var l=new q.j;l.beginFill(a).drawRoundedRect(0,0,n,_.max_item_height,c).endFill(),l.position.x=h*i,_.addChild(l)}return _}return ek(e,t),e.prototype.set_item_height=function(t,e){t instanceof q.j&&(t.height=e,t.position.y=(this.max_item_height-e)/2)},e.prototype.animate=function(){var t=this;this.animation_timer&&window.clearInterval(this.animation_timer);var e=this.max_item_height-this.min_item_height;this.animation_timer=window.setInterval(function(){for(var i=0;i<t.item_num_per_side;i++){var o=Math.random()*e+t.min_item_height,n=t.children[i],r=t.children[t.children.length-i-1];t.set_item_height(n,o),t.set_item_height(r,o)}},this.animation_interval)},e.prototype.terminate=function(){this.animation_timer&&window.clearInterval(this.animation_timer)},e.prototype.set_central_gap=function(t){if(this.current_central_gap!==t){this.current_central_gap=t;for(var e=0;e<2*this.item_num_per_side;e++){var i=this.children[e],o=e<this.item_num_per_side?e*this.item_gap:e*this.item_gap+t;i.position.x=o}}},e}(q.j),eI=function(){function t(t,e){this.start_time=0,this.volume_bar=new eT(t),this.timer=new q.v("00:00",eg),this.parent_graphics=e}return t.prototype.set_text=function(t){this.timer.text=t},t.prototype.start_counting=function(){var t=this;0===this.start_time&&(this.start_time=Date.now(),this.timer.text="00:00"),this.counting_timer=window.setInterval(function(){var e=Math.round((Date.now()-t.start_time)/1e3),i=Math.floor(e/60);e-=60*i;var o=i<10?"0"+i:i.toString(),n=e<10?"0"+e:e.toString();t.timer.text=o+":"+n},1e3)},t.prototype.stop_counting=function(){this.timer.text="00:00",this.start_time=0,this.counting_timer&&clearInterval(this.counting_timer)},t.prototype.start_animation=function(){this.volume_bar.animate()},t.prototype.stop_animation=function(){this.volume_bar.terminate()},t.prototype.get_volume_bar=function(){return this.volume_bar},t.prototype.get_timer=function(){return this.timer},t}(),eE=function(t){function e(e,i,o,n){var r=t.call(this,ey,e)||this;r.get_text_record=o,r.events=n;var s=i.max_duration,a=i.thresholds,_=r.get_text_record(),c=_.countdown_prefix,h=_.countdown_suffix;return r.countdown_prefix=c,r.countdown_suffix=h,r.countdown_opt={max_duration:s,thresholds:Math.min(s,a)},r.timer.anchor.set(.5),r.parent_graphics.addChild(r.volume_bar,r.timer),r}return ek(e,t),e.prototype.set_visible=function(t){this.timer.visible=t,this.volume_bar.visible=t},e.prototype.start_counting=function(){var t=this;0===this.start_time&&(this.start_time=Date.now()-1e3,this.timer.text="00:01"),this.counting_timer=window.setInterval(function(){var e=Math.round((Date.now()-t.start_time)/1e3);if(e<t.countdown_opt.thresholds){var i=Math.floor(e/60);e-=60*i;var o=i<10?"0"+i:i.toString(),n=e<10?"0"+e:e.toString();t.timer.text=o+":"+n}else{var r=t.countdown_opt.max_duration-e;r>0?t.timer.text=""+t.countdown_prefix+r+t.countdown_suffix:(clearInterval(t.counting_timer),t.events.fire("voice_dialog:recorder_time_up",void 0))}},1e3)},e.prototype.stop_counting=function(){this.timer.text="00:00",this.start_time=0,this.counting_timer&&clearInterval(this.counting_timer)},e.prototype.set_countdown_warning_text=function(t,e){this.countdown_prefix=t,this.countdown_suffix=e},e.prototype.destroy=function(){this.timer.destroy({texture:!0}),this.volume_bar.destroy({children:!0})},e}(eI),eL=function(t){function e(e){var i=t.call(this,ev,e)||this;i.graphics=new q.j,i.graphics.lineStyle(2,1161338).beginFill(2940568).drawRoundedRect(0,0,400,50,6).endFill(),i.timer.position.set((400-i.timer.width)/2,(50-i.timer.height)/2),i.timer.style.fill=0xffffff,i.volume_bar.set_central_gap(i.timer.width+40),i.volume_bar.position.set((400-i.volume_bar.width)/2,(50-i.volume_bar.height)/2);var o=i.draw_point(),n=i.draw_point();return o.position.set(i.volume_bar.position.x-8,(50-o.height)/2),n.position.set(i.volume_bar.position.x+i.volume_bar.width+8,(50-n.height)/2),i.graphics.addChild(i.volume_bar,i.timer,o,n),i.parent_graphics.addChild(i.graphics),i}return ek(e,t),e.prototype.get_graphic=function(){return this.graphics},e.prototype.set_visible=function(t){this.graphics.visible=t},e.prototype.destroy=function(){this.timer.destroy({texture:!0}),this.volume_bar.destroy({children:!0}),this.graphics.destroy({children:!0})},e.prototype.draw_point=function(){var t=new q.j;return t.beginFill(0xffffff).drawCircle(0,0,2).endFill(),t},e}(eI),eS=(d=function(t,e){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}d(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),eR=function(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&0>e.indexOf(o)&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(t);n<o.length;n++)0>e.indexOf(o[n])&&Object.prototype.propertyIsEnumerable.call(t,o[n])&&(i[o[n]]=t[o[n]])}return i},eM=function(){function t(t){var e=t.close_btn,i=t.central_btn,o=t.confirm_btn,n=t.cancel_btn,r=t.content,s=t.recorder_volume_panel,a=t.get_text_record,_=t.set_content;this.close_btn=e,this.central_btn=i,this.confirm_btn=o,this.cancel_btn=n,this.content=r,this.recorder_volume_panel=s,this.get_text_record=a,this.set_content=_}return t.prototype.mount=function(){this.close_btn.visible=!0,this.central_btn.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.content.visible=!0,this.recorder_volume_panel.set_visible(!1),this.central_btn.draw_btn("recorder_btn")},t.prototype.dismount=function(){this.recorder_volume_panel.stop_counting(),this.recorder_volume_panel.stop_animation(),this.recorder_animation_start_timer&&clearTimeout(this.recorder_animation_start_timer)},t}(),eC=function(t){function e(e){var i=e.player_volume_panel,o=eR(e,["player_volume_panel"]),n=t.call(this,o)||this;return n.type=z.RECORDING,n.player_volume_panel=i,n}return eS(e,t),e.prototype.mount=function(){t.prototype.mount.call(this),this.player_volume_panel.set_visible(!1);var e=this.get_text_record(),i=e.start_recording,o=e.recorder_confirm,n=e.recorder_cancel;this.set_content(i),this.confirm_btn.set_text(o),this.cancel_btn.set_text(n),this.central_btn.draw_btn("recorder_btn")},e.prototype.dismount=function(){t.prototype.dismount.call(this),this.player_volume_panel.set_visible(!1),this.player_volume_panel.stop_counting(),this.player_volume_panel.stop_animation()},e.prototype.set_state=function(t){var e=this;switch(this.dismount(),t){case"init":this.mount();break;case"recording":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.central_btn.visible=!0,this.central_btn.draw_btn("terminate_btn"),this.set_content(this.get_text_record().recording),this.recorder_volume_panel.set_text(""),this.recorder_volume_panel.set_visible(!0),this.recorder_volume_panel.start_animation(),this.recorder_animation_start_timer=window.setTimeout(function(){e.recorder_volume_panel.start_counting(),e.content.visible=!1},1e3);break;case"done":this.content.visible=!1,this.confirm_btn.visible=!0,this.cancel_btn.visible=!0,this.central_btn.draw_btn("play_btn"),this.recorder_volume_panel.set_visible(!1),this.player_volume_panel.set_visible(!0);break;case"playing":this.content.visible=!1,this.confirm_btn.visible=!0,this.cancel_btn.visible=!0,this.central_btn.draw_btn("stop_btn"),this.recorder_volume_panel.set_visible(!1),this.player_volume_panel.set_visible(!0),this.player_volume_panel.start_counting(),this.player_volume_panel.start_animation()}},e}(eM),eP=function(t){function e(e){var i=e.loading_icon,o=e.start_loading_animation,n=e.stop_loading_animation,r=eR(e,["loading_icon","start_loading_animation","stop_loading_animation"]),s=t.call(this,r)||this;return s.type=z.RECOGNITION,s.loading_icon=i,s.start_loading_animation=o,s.stop_loading_animation=n,s}return eS(e,t),e.prototype.mount=function(){t.prototype.mount.call(this),this.loading_icon.visible=!1;var e=this.get_text_record(),i=e.start_speaking,o=e.recognition_confirm,n=e.recognition_cancel;this.set_content(i),this.confirm_btn.set_text(o),this.cancel_btn.set_text(n)},e.prototype.dismount=function(){t.prototype.dismount.call(this),this.loading_icon.visible=!1,this.stop_loading_animation()},e.prototype.set_state=function(t){var e=this;switch(this.dismount(),t){case"init":this.mount();break;case"recording":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.loading_icon.visible=!1,this.central_btn.visible=!0,this.central_btn.draw_btn("terminate_btn"),this.set_content(this.get_text_record().recording),this.recorder_volume_panel.set_text(""),this.recorder_volume_panel.set_visible(!0),this.recorder_volume_panel.start_animation(),this.recorder_animation_start_timer=window.setTimeout(function(){e.recorder_volume_panel.start_counting(),e.content.visible=!1},1e3);break;case"recognizing":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.central_btn.visible=!0,this.central_btn.draw_btn("recognize_btn"),this.recorder_volume_panel.set_visible(!1),this.set_content(this.get_text_record().recognizing),this.loading_icon.visible=!0,this.start_loading_animation();break;case"success":this.content.visible=!0,this.confirm_btn.visible=!0,this.cancel_btn.visible=!0,this.central_btn.draw_btn("recorder_btn"),this.recorder_volume_panel.set_visible(!1),this.loading_icon.visible=!1;break;case"failure":this.content.visible=!0,this.confirm_btn.visible=!1,this.cancel_btn.visible=!1,this.central_btn.draw_btn("recorder_btn"),this.set_content(this.get_text_record().recognition_failure),this.recorder_volume_panel.set_visible(!1),this.loading_icon.visible=!1}},e}(eM),eG=function(){return(eG=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},eN=function(){function t(t,e,i,o){var n=this,r=t.url,s=t.texture_name,a=t.text_record,_=t.countdown_opt;this.graphics=new q.j,this.voice_type=z.RECOGNITION,this.dialog_width=0,this.dialog_height=0,this.set_content=function(t){n.content.text=t;var e=n.dialog_width-68;n.content.style.wordWrapWidth=e;var i=Math.ceil(10*(n.get_byte_length(n.content.text)-2*e/10)/e*26);i=i>0?i:0,n.draw_background(0,i),n.update_central_btn_position(),n.update_side_btns_position(i),n.update_content_position(),n.loading_icon.visible&&n.update_loading_icon_position()},this.start_loading_animation=function(){n.stop_loading_animation(),n.update_loading_icon_position(),n.loading_animation_timer=window.setInterval(function(){n.loading_icon.rotation+=.05},20)},this.stop_loading_animation=function(){n.loading_animation_timer&&window.clearInterval(n.loading_animation_timer)},this.get_text_record=function(){return n.text_record},this.set_parent=function(t){n.graphics.setParent(t)},this.on_stage_resize=function(t){t.target_id===n.app.get_app().stage.name&&(n.stage_width=t.data.width,n.stage_height=t.data.height,n.draw_background(),n.update_close_btn_position(),n.update_central_btn_position(),n.update_side_btns_position(),n.update_content_position(),n.update_recorder_volume_panel_position(),n.update_player_volume_panel_position(),n.update_loading_icon_position(),n.graphics.hitArea=new q.q(0,-n.stage_height+n.dialog_height,n.stage_width,n.stage_height))},this.app=e,this.events=o,this.loader=i,this.text_record=a,this.state="init";var c=this.app.get_app().view,h=c.width,l=c.height;this.stage_width=h,this.stage_height=l,this.graphics.name="voice_dialog",this.graphics.interactive=!0,this.graphics.visible=!1,this.draw_background(),this.close_btn=new ew(this.app,this.events),this.update_close_btn_position(),this.graphics.addChild(this.close_btn),this.central_btn=new eO(this.app,this.events),this.update_central_btn_position(),this.graphics.addChild(this.central_btn),this.confirm_btn=new eA(this.app,this.events,"confirm_btn",1,.7),this.confirm_btn.set_text(a.recorder_confirm),this.confirm_btn.set_text_color("0x297EFF"),this.cancel_btn=new eA(this.app,this.events,"cancel_btn",1,.7),this.cancel_btn.set_text(a.recorder_cancel),this.update_side_btns_position(),this.graphics.addChild(this.confirm_btn,this.cancel_btn),this.content=new q.v("",eg),this.content.anchor.set(.5),this.update_content_position(),this.graphics.addChild(this.content),this.recorder_volume_panel=new eE(this.graphics,_,this.get_text_record,this.events),this.update_recorder_volume_panel_position(),this.player_volume_panel=new eL(this.graphics),this.update_player_volume_panel_position(),this.player_volume_panel.set_visible(!1),this.loading_icon=new q.t,this.loading_icon.anchor.set(.5),this.loading_icon.scale.set(.15),this.loading_icon.visible=!1,this.update_loading_icon_position(),this.graphics.addChild(this.loading_icon),this.app.get_renderer_type()===q.p.WEBGL&&(this.graphics.filters=[new q.h(ed)]);var p=function(){n.update_loading_icon_position()};this.loader.add({url:r,on_success:function(t){var e=t.textures;if(e){var i=s.close_btn,o=s.recorder_btn,r=s.terminate_btn,a=s.recognize_btn,_=s.play_btn,c=s.stop_btn,h=s.loading_icon;n.close_btn.set_icon_texture(e[i]);var l={recorder_btn:e[o],terminate_btn:e[r],recognize_btn:e[a],play_btn:e[_],stop_btn:e[c]};n.central_btn.set_textures(l),n.central_btn.draw_btn("recorder_btn"),n.loading_icon.texture=e[h],n.update_side_btns_position(),n.update_recorder_volume_panel_position(),p()}},on_error:p}),this.events.add_listener("stage:resize",this.on_stage_resize)}return t.prototype.set_state=function(t){var e;null!=(e=this.painter)&&e.set_state(t),this.state=t},t.prototype.get_state=function(){return this.state},t.prototype.get_visible=function(){return this.graphics.visible},t.prototype.set_voice_record_duration=function(t){var e=t%60,i=Math.floor(t/60);this.player_volume_panel.set_text((i<10?"0"+i:""+i)+":"+(e<10?"0"+e:""+e))},t.prototype.set_recorder_countdown_warning_text=function(t,e){this.recorder_volume_panel.set_countdown_warning_text(t,e)},t.prototype.draw_background=function(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.graphics.clear(),this.graphics.beginFill(0xffffff);var i=this.stage_width/2,o=this.stage_height/2;this.dialog_width=this.stage_width-32,this.dialog_height=254+t+e,this.graphics.drawRoundedRect(0,0,this.dialog_width,this.dialog_height,6),this.graphics.endFill(),this.graphics.position.set(-i+16,o-270-t-e),this.graphics.hitArea=new q.q(0,-this.stage_height+this.dialog_height,this.stage_width,this.stage_height)},t.prototype.show=function(t){this.graphics.visible=!0,this.voice_type!==t&&this.painter&&this.painter.dismount(),this.voice_type=t,this.get_painter().mount()},t.prototype.hide=function(){this.graphics.visible=!1,this.get_painter().dismount()},t.prototype.get_byte_length=function(t){for(var e=0,i=0;i<t.length;i++)t.charCodeAt(i)>127||94===t.charCodeAt(i)?e+=2:e++;return e},t.prototype.set_text_record=function(t){this.text_record=t;var e=this.voice_type===z.RECOGNITION;switch(this.state){case"init":this.set_content(e?t.start_speaking:t.start_recording);break;case"recording":this.set_content(t.recording),this.set_recorder_countdown_warning_text(t.countdown_prefix,t.countdown_suffix);break;case"recognizing":this.set_content(t.recognizing);break;case"failure":this.set_content(t.recognition_failure)}e?(this.cancel_btn.set_text(t.recognition_cancel),this.confirm_btn.set_text(t.recognition_confirm)):(this.cancel_btn.set_text(t.recorder_cancel),this.confirm_btn.set_text(t.recorder_confirm))},t.prototype.update_content_position=function(){this.content.position.set(this.dialog_width/2,47+this.content.height/2)},t.prototype.update_close_btn_position=function(){this.close_btn.position.set(this.dialog_width-32,30)},t.prototype.update_central_btn_position=function(){this.central_btn.position.set(this.dialog_width/2,this.dialog_height-94)},t.prototype.update_side_btns_position=function(t){void 0===t&&(t=0);var e=this.central_btn,i=e.position,o=e.width/2;this.cancel_btn.position.set(i.x-o-46-this.cancel_btn.width,i.y+t),this.confirm_btn.position.set(i.x+o+46+this.confirm_btn.width,i.y+t)},t.prototype.update_recorder_volume_panel_position=function(){var t=this.recorder_volume_panel.get_volume_bar(),e=this.recorder_volume_panel.get_timer();t.set_central_gap(this.central_btn.width+40),t.position.set(this.central_btn.position.x-t.width/2,this.central_btn.position.y-t.height/2),e.position.set(this.dialog_width/2,47+e.height/2)},t.prototype.update_player_volume_panel_position=function(){var t=this.player_volume_panel.get_graphic();t.position.set(this.central_btn.position.x-t.width/2,33)},t.prototype.update_loading_icon_position=function(){this.loading_icon.position.set(this.content.position.x-this.content.width/2-10-this.loading_icon.width/2,this.content.position.y)},t.prototype.get_painter=function(){if(!this.painter||this.painter.type!==this.voice_type){var t={close_btn:this.close_btn,central_btn:this.central_btn,confirm_btn:this.confirm_btn,cancel_btn:this.cancel_btn,content:this.content,recorder_volume_panel:this.recorder_volume_panel,get_text_record:this.get_text_record,set_content:this.set_content};this.voice_type===z.RECORDING?this.painter=new eC(eG(eG({},t),{player_volume_panel:this.player_volume_panel})):this.painter=new eP(eG(eG({},t),{loading_icon:this.loading_icon,start_loading_animation:this.start_loading_animation,stop_loading_animation:this.stop_loading_animation}))}return this.painter},t.prototype.destroy=function(){this.hide(),this.events.remove_listener("stage:resize",this.on_stage_resize),this.confirm_btn.destroy({children:!0,texture:!0}),this.cancel_btn.destroy({children:!0,texture:!0}),this.content.destroy({texture:!0}),this.recorder_volume_panel.destroy(),this.player_volume_panel.destroy(),this.graphics.destroy({children:!0})},t}(),eD=function(){function t(t){var e=this;this.is_running=!1,this.tasks=[],this.on_tick=function(){if(e.cur_task)if(e.cur_task.printer.text.length>=e.cur_task.content.length)e.stop();else{var t=e.cur_task.content.substring(0,Math.min(Math.ceil(e.index),e.cur_task.content.length));e.cur_task.printer.text=t,e.index+=e.app.get_app().ticker.elapsedMS/50,e.cur_task.on_update&&e.cur_task.on_update()}},this.app=t,this.index=1}return t.prototype.add_task=function(t){this.is_running?this.tasks.push(t):(this.cur_task=t,this.execute())},t.prototype.release=function(){this.is_running=!1,this.cur_task=this.tasks.shift(),this.cur_task&&this.execute()},t.prototype.clear=function(){this.tasks=[],this.cur_task=void 0,this.is_running=!1},t.prototype.execute=function(){this.is_running=!0,this.index=1,this.cur_task&&(this.app.get_app().ticker.add(this.on_tick),this.cur_task.on_start&&this.cur_task.on_start())},t.prototype.stop=function(){this.cur_task&&(this.app.get_app().ticker.remove(this.on_tick),this.cur_task.on_complete&&this.cur_task.on_complete())},t.prototype.finish=function(){this.cur_task&&(this.cur_task.printer.text=this.cur_task.content,this.stop())},t}(),eF=(u=function(t,e){return(u=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}u(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ej={fontSize:"21px",fontFamily:"Microsoft YaHei",fill:"#498AD9"},ez={fontSize:"22px",fontFamily:"Microsoft YaHei",fill:"#333333"},eB={fontSize:"21px",fontFamily:"Microsoft YaHei",fill:"#AEAEAE"},eH=function(t){function e(e,i,o,n,r){var s=t.call(this)||this;return s.bg_line_width=0,s.actor_line_width=0,s.is_printing=!1,s.on_complete_cb=void 0,s.set_parent=function(t){s.setParent(t)},s.on_stage_resize=function(t){t.target_id===s.app.get_app().stage.name&&s.draw_dialog_basis()},s.app=e,s.data=i,s.events=r,s.loader=o,s.name="stage_dialog",s.preview=new q.t,s.target_name=new q.v("",ej),s.content=new q.v("",ez),s.next_text=new q.v("",eB),s.next_text.name="next_text",s.next_icon=new q.t,s.next_icon.name="next_icon",s.print=new eD(s.app),s.addListener("mouseup",s.on_mouse_up.bind(s)),s.addListener("touchend",s.on_mouse_up.bind(s)),s.loader.add({url:n.url,on_success:function(t){var e=t.textures;e&&(s.next_icon.texture=e[n.next_icon],s.app.render())}}),s.draw_dialog_basis(),s.interactive=!0,s.visible=!1,s.addChild(s.next_icon,s.next_text,s.preview,s.target_name,s.content),s.events.add_listener("stage:resize",s.on_stage_resize),s}return eF(e,t),e.prototype.draw_dialog_basis=function(){var t=this.app.get_app().view,e=t.width,i=t.height,o=e-24;this.clear(),this.lineStyle(2,0xd9d6ce,1),this.beginFill(0xffffff,1),this.drawRoundedRect(0,0,o,180,4),this.hitArea=new q.q(0,0,o,180),this.y=i/2-180-12,this.x=-e/2+12,this.endFill(),this.next_icon.x=o-10-20,this.next_icon.y=150,this.update_next_text_position(),this.bg_line_width=Math.floor(e-24-30-12-20),this.actor_line_width=Math.floor(e-24-20-100-12-20)},e.prototype.update_next_text_position=function(){this.next_text.x=this.next_icon.x-this.next_text.width-7,this.next_text.y=this.next_icon.y-5},e.prototype.set_component_size_and_position=function(t){var e=100;if(t===Q.d.Scene)e=30,this.preview.x=0;else{var i=this.preview.texture.width/this.preview.texture.height;this.preview.width=i>1?e:e*i,this.preview.height=i>1?e/i:e,this.preview.position.set(20,(180-this.preview.height)/2)}this.target_name.position.x=this.preview.position.x+e+12,this.target_name.position.y=20,this.content.position.x=this.target_name.position.x,this.content.position.y=this.target_name.position.y+this.target_name.height+6},e.prototype.show_stage_dialog=function(t,e,i,o,n){var r=this,s=this.data.get_target(t);if(!s)return new tp.a("Cannot find target "+t);this.visible=!0,this.preview.texture=tt.l(s)?new q.y(s.texture.baseTexture):q.y.EMPTY,this.set_component_size_and_position(s.type),this.target_name.text=e;var a=o?void 0:n;this.print.add_task({id:t,content:i,printer:this.content,on_start:function(){r.is_printing=!0},on_complete:function(){r.is_printing=!1,r.on_complete_cb=a}})},e.prototype.on_mouse_up=function(){this.is_printing?this.print.finish():(this.content.text="",this.print.release(),this.on_complete_cb&&this.on_complete_cb())},e.prototype.get_max_content_width=function(t){return t===Q.d.Actor?this.actor_line_width:this.bg_line_width},e.prototype.set_next_text=function(t){this.next_text.text=t,this.update_next_text_position()},e.prototype.hide=function(){this.visible=!1,this.content.text="",this.target_name.text="",this.print.clear()},e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0,texture:!0}),this.events.remove_listener("stage:resize",this.on_stage_resize)},e}(q.j),eV={width:2,color:0xd8d8d8,alpha:.7},eU={width:2,color:0xe6e6e6,alpha:.4},eW={width:2,color:0xe6e6e6,alpha:.15},eX={fontWeight:"bold",fontSize:"16px",fontFamily:"STHeitiSC-Medium",fill:"#000000"},eY={fontWeight:"bold",fontSize:"16px",fontFamily:"STHeitiSC-Medium",fill:"#ffffff"},eK=function(){function t(t,e){var i=this;this.grid=new q.j,this.axis_arrow=new q.j,this.x_label=new q.v("X",eX),this.y_label=new q.v("Y",eX),this.x_label_shadow=new q.v("X",eY),this.y_label_shadow=new q.v("Y",eY),this.set_parent=function(t){i.grid.setParent(t)},this.on_stage_resize=function(t){t.target_id===i.app.get_app().stage.name&&(i.stage_width=t.data.width,i.stage_height=t.data.height,i.grid.removeChildren(),i.draw_grid_lines(20,100),i.label_axis_numbers(100),i.draw_axis_arrows(),i.set_xy_label_position())},this.app=t,this.events=e;var o=this.app.get_app().view,n=o.width,r=o.height;this.stage_width=n,this.stage_height=r,this.init_grid(),this.grid.visible=!1,e.add_listener("stage:resize",this.on_stage_resize)}return t.prototype.init_grid=function(){this.draw_grid_lines(20,100),this.label_axis_numbers(100),this.draw_axis_arrows(),this.init_xy_label()},t.prototype.draw_grid_lines=function(t,e){this.grid.clear();for(var i,o=this.stage_height/2,n=this.stage_width/2,r=0,s=0,a=0;a<o;)i=0===a?eV:a%e==0?eU:eW,this.grid.lineStyle(i.width,i.color,i.alpha),this.grid.moveTo(-n,a),this.grid.lineTo(n,a),this.grid.moveTo(-n,-a),this.grid.lineTo(n,-a),a=++r*t;for(r=0;s<n;)i=0===s?eV:s%e==0?eU:eW,this.grid.lineStyle(i.width,i.color,i.alpha),this.grid.moveTo(s,-o),this.grid.lineTo(s,o),this.grid.moveTo(-s,-o),this.grid.lineTo(-s,o),s=++r*t},t.prototype.draw_axis_arrows=function(){this.axis_arrow.clear();var t=this.stage_width/2,e=this.stage_height/2;this.axis_arrow.beginFill(0xd8d8d8),this.axis_arrow.drawPolygon([t-10,5,t,0,t-10,-5]),this.axis_arrow.endFill(),this.axis_arrow.beginFill(0xd8d8d8),this.axis_arrow.drawPolygon([-5,10-e,0,-e,5,10-e]),this.axis_arrow.endFill(),this.grid.addChild(this.axis_arrow)},t.prototype.label_axis_numbers=function(t){for(var e=0,i=0;i<this.stage_height/2;){var o=i.toString(),n=(-i).toString();(s=new q.v(o,eX)).x=5,s.y=5-i,s.alpha=.8,(a=new q.v(n,eX)).x=5,a.y=i+5,a.alpha=.8,(_=new q.v(o,eY)).x=5,_.y=5-i+1,_.alpha=.8,(c=new q.v(n,eY)).x=5,c.y=i+5+1,c.alpha=.8,this.grid.addChild(s,a,_,c),i=++e*t}e=1;for(var r=t;r<this.stage_width/2;){var s,a,_,c,h=r.toString(),l=(-r).toString();(s=new q.v(h,eX)).x=r+5,s.y=5,s.alpha=.8,(a=new q.v(l,eX)).x=5-r,a.y=5,a.alpha=.8,(_=new q.v(h,eY)).x=r+5,_.y=6,_.alpha=.8,(c=new q.v(l,eY)).x=5-r,c.y=6,c.alpha=.8,this.grid.addChild(s,a,_,c),r=++e*t}},t.prototype.init_xy_label=function(){this.x_label.alpha=.8,this.y_label.alpha=.8,this.x_label_shadow.alpha=.8,this.y_label_shadow.alpha=.8,this.set_xy_label_position()},t.prototype.set_xy_label_position=function(){var t={x:this.stage_width/2-10-8,y:-26},e={x:10,y:10-this.stage_height/2};this.x_label.position.set(t.x,t.y),this.y_label.position.set(e.x,e.y),this.x_label_shadow.position.set(t.x,t.y+1),this.y_label_shadow.position.set(e.x,e.y+1),this.grid.addChild(this.x_label,this.y_label,this.x_label_shadow,this.y_label_shadow)},t.prototype.set_visible=function(t){this.grid.visible=t},t.prototype.set_z_index=function(t){var e=this.grid.parent;t=Math.max(1,t=Math.min(t,e.children.length-1)),e.setChildIndex(this.grid,t)},t.prototype.destroy=function(){this.events.remove_listener("stage:resize",this.on_stage_resize),this.grid.destroy({children:!0})},t}(),eq=(f=function(t,e){return(f=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),eJ={fontSize:22,fontFamily:"Microsoft YaHei"},eQ=function(t){function e(e,i){var o=t.call(this)||this;o.selections=[],o.is_landscape=!1,o.on_complete_cb=void 0,o.stage_height=0,o.stage_width=0,o.dialog_height=0,o.dialog_width=0,o.selection_width=0,o.selection_height=0,o.distance=0,o.MARGIN=10,o.RECT_RADIUS=9,o.pop_selection=function(){if(o.distance>0){var t=Math.ceil(o.distance/4);o.position.y-=t,o.distance-=t}else o.app.get_app().ticker.remove(o.pop_selection)},o.set_parent=function(t){o.setParent(t)},o.on_stage_resize=function(t){t.target_id===o.app.get_app().stage.name&&(o.stage_width=t.data.width,o.stage_height=t.data.height,o.is_landscape=o.stage_width>o.stage_height,o.dialog_width=o.stage_width-2*o.MARGIN,o.selection_width=o.is_landscape?o.dialog_width/2:o.dialog_width,o.selection_height=.0888*o.stage_height,o.redraw_selections())},o.app=e,o.events=i,o.visible=!1,o.selection_container=new q.j,o.selection_header=new q.j;var n=o.app.get_app().view,r=n.width,s=n.height;return o.stage_width=r,o.stage_height=s,o.dialog_width=o.stage_width-2*o.MARGIN,o.selection_width=o.dialog_width,o.selection_height=.0888*o.stage_height,o.init_selections(),o.draw_header(),o.app.get_renderer_type()===q.p.WEBGL&&(o.filters=[new q.h({rotation:45,distance:3,alpha:.15,color:0,blur:0})]),o.addChild(o.selection_container,o.selection_header),o.events.add_listener("stage:resize",o.on_stage_resize),o}return eq(e,t),e.prototype.init_selections=function(){for(var t=0;t<4;t++){var e=new q.f,i=new q.j,o=new q.j,n=new q.v("",eJ);n.anchor.set(.5),n.visible=!0,i.clear(),i.lineStyle(2,0xd8d8d8,1),i.beginFill(0xffffff,1),i.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),i.endFill(),o.clear(),o.beginFill(2719487,1),o.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),o.endFill(),e.addChild(i,o,n),e.visible=!1,e.buttonMode=!0,e.interactive=!0,e.on("touchstart",function(t){t.stopPropagation()}),e.on("mousedown",function(t){t.stopPropagation()}),e.on("touchend",this.select_item.bind(this,t)),e.on("mouseup",this.select_item.bind(this,t)),e.on("touchstart",this.on_pointer_over.bind(this,t)),e.on("mouseover",this.on_pointer_over.bind(this,t)),e.on("mouseout",this.on_pointer_out.bind(this,t)),this.selection_container.addChild(e)}},e.prototype.show_selections=function(){var t=this;this.selection_container.visible=!0,this.selections.forEach(function(e,i){var o=t.selection_container.children[i];if(o instanceof q.f){var n=o.children[0],r=o.children[1],s=o.children[2];s instanceof q.v&&(s.text=e,s.style.fill="black"),o.visible=!0,n.visible=!0,r.visible=!1,t.is_landscape?(o.position.x=i%2?t.selection_width:0,o.position.y=Math.floor(i/2)*t.selection_height):(o.position.x=0,o.position.y=i*t.selection_height),s.position.x=t.selection_width/2,s.position.y=t.selection_height/2}})},e.prototype.hide_selections=function(){this.selection_container.children.forEach(function(t){t.visible=!1})},e.prototype.select_item=function(t,e){e.stopPropagation(),this.on_complete_cb&&this.on_complete_cb(t),this.position.y=this.stage_height/2},e.prototype.on_pointer_over=function(t){var e=this.selection_container.children[t];if(e instanceof q.f){e.children[0].visible=!1,e.children[1].visible=!0;var i=e.children[2];i instanceof q.v&&(i.style.fill="white")}},e.prototype.on_pointer_out=function(t){var e=this.selection_container.children[t];if(e instanceof q.f){e.children[0].visible=!0,e.children[1].visible=!1;var i=e.children[2];i instanceof q.v&&(i.style.fill="black")}},e.prototype.draw_header=function(){this.selection_header.beginFill(0xffffff,1),this.selection_header.drawRoundedRect(0,0,this.dialog_width,this.selection_height,6),this.selection_header.endFill();var t=new q.v("",eJ);t.anchor.set(0,.5),t.position.x=16,this.selection_header.visible=!1,this.selection_header.position.x=0,this.selection_header.addChild(t)},e.prototype.show_header=function(t){var e=this.selection_header.children[0];e.text=t,e.position.y=this.selection_height/2,this.selection_header.position.y=-this.selection_height,this.selection_header.visible=!0},e.prototype.hide_header=function(){this.selection_header.visible=!1},e.prototype.show=function(t,e,i){this.visible=!0,this.selections=t,this.is_landscape?this.dialog_height=Math.ceil(t.length/2)*this.selection_height:this.dialog_height=t.length*this.selection_height,this.draw_selection_container(),this.show_selections(),this.on_complete_cb=i,""!==e&&this.show_header(e),this.position.y=this.stage_height/2,this.position.x=-this.stage_width/2+this.MARGIN,this.distance=this.dialog_height+this.MARGIN,this.app.get_app().ticker.remove(this.pop_selection),this.app.get_app().ticker.add(this.pop_selection)},e.prototype.get_width=function(){return this.dialog_width},e.prototype.hide=function(){this.visible=!1,this.hide_selections(),this.hide_header()},e.prototype.destroy=function(){this.app.get_app().ticker.remove(this.pop_selection),this.events.remove_listener("stage:resize",this.on_stage_resize),t.prototype.destroy.call(this,{children:!0})},e.prototype.draw_selection_container=function(){this.selection_container.clear(),this.selection_container.lineStyle(2,0xd8d8d8,1),this.selection_container.beginFill(0xffffff,1),this.selection_container.drawRoundedRect(0,0,this.dialog_width,this.dialog_height,this.RECT_RADIUS),this.selection_container.endFill()},e.prototype.redraw_selections=function(){for(var t=0;t<this.selection_container.children.length;t++){var e=this.selection_container.children[t];if(!(e instanceof q.f))return;var i=e.children[0],o=e.children[1];if(!(i instanceof q.j&&o instanceof q.j))return;i.clear(),i.lineStyle(2,0xd8d8d8,1),i.beginFill(0xffffff,1),i.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),i.endFill(),o.clear(),o.beginFill(2719487,1),o.drawRoundedRect(0,0,this.selection_width,this.selection_height,this.RECT_RADIUS),o.endFill()}},e}(q.j),eZ=i(94308),e$=(g=function(t,e){return(g=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}g(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),e0=function(t){function e(e,i,o,n){var r=t.call(this,e,i,o,n)||this;return r.is_resizing=!1,r.drag_start_scale_btn=function(t){t.stopPropagation(),r.is_resizing=!0},r.drag_end_scale_btn=function(){r.is_resizing&&(r.is_resizing=!1,r.resizable_part&&r.emit_resizable_event("scale_btn_drag_end",r.resizable_part.scale.x))},r.on_resizable_break=function(t){t&&t!==r.id||(r.is_resizing=!1)},r.scale_btn=new q.j,r.draw_scale_btn(),r.scale_btn.addListener("mousedown",r.drag_start_scale_btn),r.scale_btn.addListener("mouseup",r.drag_end_scale_btn),r.scale_btn.addListener("mouseupoutside",r.drag_end_scale_btn),r.scale_btn.addListener("touchstart",r.drag_start_scale_btn),r.scale_btn.addListener("touchend",r.drag_end_scale_btn),r.scale_btn.addListener("touchendoutside",r.drag_end_scale_btn),r.events.event_emitter.addListener("break",r.on_resizable_break),r}return e$(e,t),e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0}),this.events.event_emitter.removeListener("break",this.on_resizable_break)},e.prototype.get_is_resizing=function(){return this.is_resizing},e.prototype.draw_scale_btn=function(){this.scale_btn.clear(),this.scale_btn.interactive=!0,this.scale_btn.buttonMode=!0,this.scale_btn.hitArea=new q.q(0,0,18,18);var t=Math.sqrt(2)/2;this.scale_btn.beginFill(0).arcTo(12,12,10.8,12,1.2).arcTo(0,12,1.2*t,12-1.2*t,1.2).arcTo(12,0,12,1.2,1.2).endFill()},e.prototype.get_scale_btn_position=function(){if(void 0!==this.resizable_part){var t=this.resizable_part.scale.x;return{x:this.resizable_part.width-6*t,y:this.resizable_part.height-6*t}}},e.prototype.set_scale_btn_position=function(){var t=this.get_scale_btn_position();void 0!==t&&this.scale_btn.position.set(t.x,t.y)},e.prototype.set_resizable_part=function(t){this.resizable_part=t},e.prototype.is_mouse_out_of_stage=function(t){var e=t.data.getLocalPosition(this.app.get_app().stage),i=this.app.get_app().view,o=i.width/2,n=i.height/2;return e.x<-o||e.x>o||e.y<-n||e.y>n},e.prototype.emit_resizable_event=function(t,e){this.emit(t,e)},e.prototype.add_resizable_event_listener=function(t,e){this.addListener(t,e)},e}(eZ.a),e1=(y=function(t,e){return(y=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}y(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),e2=new q.x({fontFamily:["NotoSansCJKsc-Medium","NotoSansCJKsc"],fill:"#6B3C3C",fontWeight:"900"}),e5=function(t){function e(e,i,o){var n=t.call(this,"timer",e,i,o)||this;if(n.drag_move_scale_btn=function(t){var e=n.background.scale.x;if(n.is_resizing&&!n.is_mouse_out_of_stage(t)&&0!==e){var i=t.data.getLocalPosition(n),o=Math.hypot(n.background.height/e,n.background.width/e),r=Math.hypot(i.x,i.y)/o;n.background.scale.set(r),n.set_scale_btn_position(),n.app.render()}},n.time=new q.v("0.00"),n.unit=new q.v(""),n.time.style=Object.assign({},e2,{fontSize:30}),n.unit.style=Object.assign({},e2,{fontSize:18}),n.background=new q.j,n.draw_background(),n.set_resizable_part(n.background),n.set_scale_btn_position(),n.scale_btn.addListener("mousemove",tt.w(n.drag_move_scale_btn,tt.a)),n.scale_btn.addListener("touchmove",tt.w(n.drag_move_scale_btn,tt.a)),n.add_resizable_event_listener("scale_btn_drag_end",function(t){n.events.fire("timer_scale_btn:drag_end",t)}),n.add_listener("drag_end",function(){n.events.fire("timer:drag_end",{position:{x:n.get_position().x,y:n.get_position().y}})}),n.app.get_renderer_type()===q.p.WEBGL){var r=new q.h({rotation:0,distance:1,alpha:.15,color:0,blur:1});n.background.filters=[r]}return n.addChild(n.background,n.scale_btn),n.set_visible(!1),n}return e1(e,t),e.prototype.draw_background=function(){this.background.clear();var t=this.time.width+this.unit.width,e=t+16+16,i=this.time.height+26;this.time.x=16,this.time.y=13,this.unit.x=this.time.x+this.time.width+3,this.unit.y=21;var o=e+4;this.background.beginFill(0xffffff),this.background.drawRoundedRect(-2,-2,o,i+4,20);var n=e+2;this.background.beginFill(0xf9af4b),this.background.drawRoundedRect(-1,-1,n,i+2,20),this.background.beginFill(0xfbcf58),this.background.drawRoundedRect(0,0,e,i,20);var r={x:e/2-35,y:-3};this.background.beginFill(0xf9af4b),this.background.drawRoundedRect(r.x,r.y,70,2,1);var s=e/2-40,a=e/2+15,_=i+1;this.background.beginFill(5908263),this.background.drawRoundedRect(s,_,25,2,1),this.background.drawRoundedRect(a,_,25,2,1),this.background.beginFill(0xff6b5f),this.background.drawRect(0,24,e,3),this.background.drawRect(0,30,e,3),this.background.drawRect(0,36,e,3);var c={x:this.time.x-8,y:this.time.y-5},h=this.time.height+10;this.background.beginFill(0xffffff),this.background.drawRoundedRect(c.x,c.y,t+16,h,11),this.background.endFill(),this.background.addChild(this.time,this.unit)},e.prototype.redraw_background=function(){this.background.clear(),this.draw_background(),this.set_scale_btn_position()},e.prototype.set_unit=function(t){var e=this.unit.width;this.unit.text=t,this.unit.width!==e&&this.redraw_background()},e.prototype.set_time=function(t){var e=this.time.width;this.time.text=t.length>500?t.substr(0,500).concat("..."):t,this.time.width!==e&&this.redraw_background()},e.prototype.set_position_x=function(t){this.position.set(t,this.position.y)},e.prototype.set_position_y=function(t){this.position.set(this.position.x,-t)},e.prototype.get_position=function(){return{x:this.position.x,y:-this.position.y}},e.prototype.set_scale_btn_visible=function(t){this.scale_btn.visible=t},e.prototype.set_scale=function(t){this.background.scale.set(t),this.set_scale_btn_position()},e}(e0);(v=H||(H={}))[v.DEFAULT=0]="DEFAULT",v[v.DEFAULT_WITH_ICON=1]="DEFAULT_WITH_ICON",v[v.ICON=2]="ICON",v[v.PLAIN_TEXT=3]="PLAIN_TEXT",(b=B||(B={})).VARIABLE="variable",b.LIST="list";var e3={fontFamily:["NotoSansCJKsc-Medium","NotoSansCJKsc"],fontSize:"18px"},e6={PADDING:10,BORDER_RADIUS:11,ICON_MARGIN_LEFT:10,ICON_MARGIN_TOP:7,ICON_MARGIN_RIGHT:5,ICON_SIZE:20,VALUE_MARGIN:10,VALUE_MARGIN_TOP:5,VARIABLE_NAME_MARGIN_LEFT:10,VALUE_TEXT_STYLE:Object.assign({},e3,{fill:0}),NAME_TEXT_STYLE:Object.assign({},e3,{fill:0xffffff}),PREFIX_TEXT_STYLE:Object.assign({},e3,{fill:5388601}),SCALE_BTN_MARGIN:6},e4={ICON_SIZE:63,VALUE_TEXT_STYLE:Object.assign({},e3,{fill:0xffffff,stroke:0xffffff}),VALUE_MARGIN:10,SCALE_BTN_MARGIN_RIGHT:8,SCALE_BTN_MARGIN_BOTTOM:15},e8={TEXT_STYLE:{fontFamily:["NotoSansCJKsc-Black","NotoSansCJKsc"],fontSize:"45px",fill:"#000000",stroke:"#ffffff",strokeThickness:3,dropShadow:!0,dropShadowColor:"#333333",dropShadowBlur:2,dropShadowAngle:Math.PI/6,dropShadowDistance:2},SCALE_BTN_MARGIN_RIGHT:8,SCALE_BTN_MARGIN_BOTTOM:15};(x=V||(V={}))[x.BLANK=0]="BLANK",x[x.NON_BLANK=1]="NON_BLANK";var e7={fontFamily:["STHeitiSC-Medium","Microsoft YaHei"],fontSize:"16px",fontWeight:"bold",align:"center"},e9={fontFamily:["PingFangSC-Medium","PingFang SC"],fontSize:"20px",fontWeight:"500",align:"center"},it={fontFamily:["STHeitiSC-Medium","Microsoft YaHei"],fontSize:"17.5px",fontWeight:"bold",align:"center",fill:"#43372E"};(m=U||(U={})).LIGHT="list_item_light",m.DEEP="list_item_deep";var ie=(w=function(t,e){return(w=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}w(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ii=function(t){function e(e,i,o,n,r,s){var a=s.theme_opt,_=s.value,c=s.variable_name,h=s.prefix,l=s.position,p=s.scale,d=t.call(this,e,i,o,n)||this;return d.type=B.VARIABLE,d.variable_name=new q.v("",e6.NAME_TEXT_STYLE),d.value=new q.v(""),d.prefix=new q.v("",e6.PREFIX_TEXT_STYLE),d.icon=new q.t,d.background=new q.j,d.on_position_change=function(){d.events.fire("variable:drag_end",{target_id:d.id,data:{position:d.get_position()}})},d.on_scale_change=function(){d.events.fire("variable_scale_btn:drag_end",{target_id:d.id,data:{scale:{x:d.background.scale.x,y:d.background.scale.y}}})},d.drag_move_scale_btn=function(t){var e=d.background.scale.x;if(d.is_resizing&&!d.is_mouse_out_of_stage(t)&&0!==e){var i=t.data.getLocalPosition(d),o=Math.hypot(d.background.height/e,d.background.width/e),n=Math.hypot(i.x,i.y)/o;d.background.scale.set(n),d.get_painter().update_scale_btn_position(),d.app.render()}},d.data=r,d.value.text=_,d.variable_name.text=c,h&&(d.prefix.text=h),d.background.addChild(d.value,d.variable_name,d.prefix,d.icon,d.scale_btn),d.addChild(d.background,d.scale_btn),d.set_resizable_part(d.background),d.scale_btn.addListener("mousemove",tt.w(d.drag_move_scale_btn,tt.a)).addListener("touchmove",tt.w(d.drag_move_scale_btn,tt.a)),d.add_listener("drag_end",d.on_position_change),d.add_resizable_event_listener("scale_btn_drag_end",d.on_scale_change),d.position.set(l.x,-l.y),p&&d.background.scale.set(p.x,p.y),d.set_theme(a),d.theme=a.theme,d}return ie(e,t),e.prototype.get_painter=function(){if(!this.painter||this.painter.theme!==this.theme)switch(this.theme){case H.DEFAULT_WITH_ICON:this.icon.visible=!0,this.painter=new ir(this.prefix,this.variable_name,this.value,this.background,this.scale_btn,this.icon);break;case H.ICON:this.prefix.visible=!1,this.variable_name.visible=!1,this.painter=new is(this.value,this.background,this.scale_btn,this.icon);break;case H.PLAIN_TEXT:this.prefix.visible=!1,this.variable_name.visible=!1,this.icon.visible=!1,this.painter=new ia(this.value,this.background,this.scale_btn);break;default:this.icon.visible=!1,this.painter=new io(this.prefix,this.variable_name,this.value,this.background,this.scale_btn)}return this.painter},e.prototype.set_theme=function(t){t.theme!==this.theme&&(this.theme=t.theme,(t.theme===H.DEFAULT_WITH_ICON||t.theme===H.ICON)&&this.set_icon_texture(t.icon_texture_id),this.get_painter().repaint())},e.prototype.get_theme=function(){return this.theme},e.prototype.set_icon_texture=function(t){var e=this.data.get_texture(t);e&&(this.icon.texture=e)},e.prototype.set_value=function(t){if(this.value.text!==t){var e=this.value.width;this.value.text=t,this.value.width!==e&&this.get_painter().repaint()}},e.prototype.set_scale_btn_visible=function(t){this.scale_btn.visible=t},e.prototype.get_value=function(){return this.value.text},e.prototype.set_variable_name=function(t){if(this.variable_name.text!==t){var e=this.variable_name.width;this.variable_name.text=t,this.variable_name.width!==e&&this.get_painter().repaint()}},e.prototype.get_variable_name=function(){return this.variable_name.text},e.prototype.set_prefix=function(t){if(this.prefix.text!==t){var e=this.prefix.width,i=this.prefix.visible;this.prefix.visible=!!t,this.prefix.text=t,(this.prefix.visible!==i||this.prefix.width!==e)&&this.get_painter().repaint()}},e.prototype.get_prefix=function(){return this.prefix.text},e.prototype.destroy=function(){var e={children:!0,texture:!0,baseTexture:!0};this.value.destroy(e),this.prefix.destroy(e),this.variable_name.destroy(e),t.prototype.destroy.call(this)},e.prototype.get_position=function(){return{x:this.position.x,y:-this.position.y}},e.prototype.set_position=function(t,e){this.position.set(t,-e)},e.prototype.set_scale=function(t){this.background.scale.set(t),this.get_painter().update_scale_btn_position()},e}(e0),io=function(){function t(t,e,i,o,n){this.theme=H.DEFAULT;var r=e6.PADDING,s=e6.VALUE_MARGIN_TOP,a=e6.VALUE_TEXT_STYLE;this.prefix=t,this.prefix.visible=!!this.prefix.text,this.variable_name=e,this.variable_name.visible=!0,this.value=i,this.value.style=a,this.background=o,this.scale_btn=n;var _=r+s;this.prefix.position.set(r,_),this.variable_name.position.y=_,this.value.position.y=_}return t.prototype.repaint=function(){this.update_variable_name_position(),this.update_value_position(),this.draw_background(),this.update_scale_btn_position()},t.prototype.draw_background=function(){var t=e6.PADDING,e=e6.VALUE_MARGIN,i=e6.VALUE_MARGIN_TOP,o=e6.BORDER_RADIUS,n=this.value.width+2*e,r=this.value.height+2*i,s=this.value.position.x+n;this.background.clear().beginFill(0xffad48).drawRoundedRect(0,0,s,2*t+r,o).beginFill(0xffffff).drawRoundedRect(this.value.position.x-e,this.value.position.y-i,n,r,o).endFill()},t.prototype.update_scale_btn_position=function(){var t=this.background.scale,e=t.x,i=t.y;if(0!==e&&0!==i){var o=e6.SCALE_BTN_MARGIN;this.scale_btn.position.set(this.background.width-o*e,this.background.height-o*i)}},t.prototype.update_variable_name_position=function(){this.variable_name.position.x=this.prefix.visible?this.prefix.position.x+this.prefix.width:e6.VARIABLE_NAME_MARGIN_LEFT},t.prototype.update_value_position=function(){var t=this.variable_name.position.x+this.variable_name.width;this.value.position.x=t+2*e6.VALUE_MARGIN},t}(),ir=function(t){function e(e,i,o,n,r,s){var a=t.call(this,e,i,o,n,r)||this;a.theme=H.DEFAULT_WITH_ICON,a.icon_area_width=0,a.icon=s;var _=e6.PADDING,c=e6.ICON_SIZE,h=e6.ICON_MARGIN_LEFT,l=e6.ICON_MARGIN_TOP,p=e6.ICON_MARGIN_RIGHT;return a.icon.position.set(h,_+l),a.icon.width=c,a.icon.height=c,a.icon.visible=!0,a.icon_area_width=h+c+p,a}return ie(e,t),e.prototype.repaint=function(){this.update_prefix_position(),this.update_variable_name_position(),this.update_value_position(),this.draw_background(),this.update_scale_btn_position()},e.prototype.update_prefix_position=function(){this.prefix.visible&&(this.prefix.position.x=this.icon_area_width+e6.PADDING)},e.prototype.update_variable_name_position=function(){this.variable_name.position.x=this.prefix.visible?this.prefix.position.x+this.prefix.width:this.icon_area_width},e}(io),is=function(){function t(t,e,i,o){this.theme=H.ICON;var n=e4.VALUE_MARGIN,r=e4.VALUE_TEXT_STYLE,s=e4.ICON_SIZE;this.value=t,this.value.style=r,this.value.position.set(s+n,(s-this.value.height)/2),this.background=e,this.scale_btn=i,this.icon=o,this.icon.visible=!0,this.icon.width=s,this.icon.height=s}return t.prototype.repaint=function(){this.draw_background(),this.update_scale_btn_position()},t.prototype.draw_background=function(){var t=e4.ICON_SIZE,e=t/2,i=t/4,o=e+t+this.value.width,n=i+t/2,r=t/4;this.background.clear().lineStyle(2,0xffffff).beginFill(0,.3).moveTo(e+r,i).arcTo(o,i,o,i+r,r).arcTo(o,n,e+r,n,r).arcTo(e,n,e,i+r,r).arcTo(e,i,e+r,i,r).endFill()},t.prototype.update_scale_btn_position=function(){var t=this.background.scale,e=t.x,i=t.y;if(0!==e&&0!==i){var o=e4.SCALE_BTN_MARGIN_RIGHT,n=e4.SCALE_BTN_MARGIN_BOTTOM;this.scale_btn.position.set(this.background.width-o*e,this.background.height-n*i)}},t}(),ia=function(){function t(t,e,i){this.theme=H.PLAIN_TEXT,this.background=e,this.background.clear(),this.value=t,this.value.style=e8.TEXT_STYLE,this.value.position.set(0,0),this.scale_btn=i}return t.prototype.repaint=function(){this.update_scale_btn_position()},t.prototype.update_scale_btn_position=function(){var t=this.background.scale,e=t.x,i=t.y;if(0!==e&&0!==i){var o=e8.SCALE_BTN_MARGIN_RIGHT,n=e8.SCALE_BTN_MARGIN_BOTTOM;this.scale_btn.position.set(this.background.width-o*e,this.background.height-n*i)}},t}(),i_=(O=function(t,e){return(O=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}O(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ic=function(t){function e(e,i,o){var n=t.call(this,"",i)||this;return n.content_string="",n.is_wrapped=!1,n.content_string=e.toString(),n.word_wrap_width=o,n.update_wrap(),n}return i_(e,t),e.prototype.update_wrap=function(){if(this.text=this.content_string,void 0!==this.word_wrap_width)if(this.width<=this.word_wrap_width)this.is_wrapped=!1;else{this.text="...";var t=this.width,e="";this.text="";for(var i=0;i<this.content_string.length;i++){if(this.text+=this.content_string[i],this.width+t>this.word_wrap_width){this.is_wrapped=!0,this.text=e+"...";break}e=this.text}}else this.is_wrapped=!1},e.prototype.update_content=function(t){var e=t.text,i=t.wrap_width,o=!1;return void 0!==e&&e!==this.content_string&&(this.content_string=e.toString(),o=!0),void 0!==i&&i!==this.word_wrap_width&&(this.word_wrap_width=i,o=!0),o&&this.update_wrap(),o},e.prototype.get_is_wrapped=function(){return this.is_wrapped},e.prototype.get_full_text=function(){return this.content_string},e}(q.v),ih=(A=function(t,e){return(A=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}A(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),il=function(){return(il=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},ip=function(t){function e(e){var i=e.bg_texture,o=e.width,n=e.value,r=e.order,s=e.order_width,a=t.call(this)||this;a.background_width=0,a.prev_order_width=0,a.prev_width=0,a.background=new q.t(i),a.background_width=o,a.background.width=o,a.order=new q.v(r,il(il({},it),{fill:"#0000007f"})),a.order_width=void 0!==s?s:a.order.width,a.value=new ic(n,it,a.get_value_max_width(o));var _=(45-a.value.height)/2;return a.order.position.set(5,_),a.value.position.y=_,a.update_value_position(),a.addChild(a.background,a.order,a.value),a}return ih(e,t),e.prototype.update_content=function(t){var e=t.order,i=t.value,o=t.order_width,n=t.width;void 0!==e&&(this.order.text=e.toString()),void 0!==o&&(this.order_width=o),void 0!==n&&(this.background_width=n),this.repaint(i)},e.prototype.repaint=function(t){var e=!1,i=!1;this.prev_width!==this.background_width&&(e=!0,i=!0),this.prev_order_width!==this.order_width&&(i=!0,this.update_value_position()),e&&(this.background.width=this.background_width),(i||void 0!==t)&&this.value.update_content({text:t,wrap_width:this.get_value_max_width(this.background_width)}),this.prev_width=this.background_width,this.prev_order_width=this.order_width},e.prototype.set_text_visible=function(t){this.value.visible=t,this.order.visible=t},e.prototype.get_value_max_width=function(t){return t-10-45-this.order_width},e.prototype.update_value_position=function(){this.value.position.x=20+this.order_width},e.prototype.get_text_visible=function(){return this.value.visible},e.prototype.destroy=function(){var e={children:!0,texture:!0,baseTexture:!0};this.background.destroy({children:!0}),this.order.destroy(e),this.value.destroy(e),t.prototype.destroy.call(this,e)},e}(q.f);function id(t){return W||(W=new q.x(it)),q.w.measureText(t,W)}var iu=(k=function(t,e){return(k=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}k(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ig=function(){function t(t,e){this.body=t,this.scale_btn=e}return t.prototype.draw_body=function(t,e){var i;this.body.clear().beginFill(0xffffff).drawRoundedRect(0,0,t,e,10).endFill(),this.body.mask instanceof q.j?i=this.body.mask:((i=new q.j).setParent(this.body),this.body.mask=i),i.clear().beginFill(0xffffff).drawRoundedRect(0,0,t,e,10).endFill()},t}(),iy=function(t){function e(e,i,o){var n=t.call(this,e,i)||this;return n.type=V.BLANK,n.blank_text=o,n}return iu(e,t),e.prototype.repaint=function(t,e,i,o){(i||o)&&this.draw_body(t,e),i&&this.update_blank_text_position(t)},e.prototype.update_blank_text_position=function(t){this.blank_text.position.x=t/2},e.prototype.calculate_body_size=function(t,e){return{width:170+t,height:180+e}},e.prototype.mount=function(){this.blank_text.visible=!0},e.prototype.dismount=function(){this.blank_text.visible=!1},e.init_blank_text=function(){var t=new q.v("",e7);return t.anchor.set(.5,0),t.position.y=10,t},e}(ig),iv=function(t){function e(e,i,o,n,r,s,a){var _=t.call(this,i,o)||this;return _.type=V.NON_BLANK,_.available_item_num=0,_.value_idx=0,_.latest_order_width=0,_.value_length=0,_.scrollbar=new q.j,_.scroll_range=0,_.scroll_step=0,_.on_scrollbar_drag_start=function(t){_.available_item_num>=_.value_length||(t.stopPropagation(),_.scrollbar_drag_y=t.data.getLocalPosition(_.body).y)},_.on_scrollbar_drag_move=function(t){if(void 0!==_.scrollbar_drag_y){t.stopPropagation();var e=t.data.getLocalPosition(_.body).y,i=e-_.scrollbar_drag_y;_.scrollbar_drag_y=e;var o=te.a(0,_.scroll_range,_.scrollbar.position.y+i);_.scrollbar.position.y=o;var n=te.a(0,_.value_length-1,Math.round(o/_.scroll_step));_.value_idx!==n&&(_.value_idx=n,_.update_item_values(_.get_values()),_.render())}},_.on_scrollbar_drag_end=function(t){void 0!==_.scrollbar_drag_y&&(t.stopPropagation(),_.scrollbar_drag_y=void 0)},_.on_body_drag_start=function(t){_.available_item_num>=_.value_length||(t.stopPropagation(),_.body_drag_y=t.data.getLocalPosition(_.body).y)},_.on_body_drag_move=function(t){if(void 0!==_.body_drag_y){t.stopPropagation();var e=t.data.getLocalPosition(_.body).y,i=e-_.body_drag_y,o=i>0?Math.floor(i/45):Math.ceil(i/45);if(!(0>=Math.abs(o))){var n=te.a(0,_.value_length-1,_.value_idx-o);_.value_idx!==n&&(_.body_drag_y=e,_.value_idx=n,_.scrollbar.position.y=te.a(0,_.scroll_range,_.value_idx*_.scroll_step),_.update_item_values(_.get_values()),_.render())}}},_.on_body_drag_end=function(t){void 0!==_.body_drag_y&&(t.stopPropagation(),_.body_drag_y=void 0)},_.app=e,_.items_container=n,_.data=r,_.get_values=s,_.render=a,_.draw_scrollbar(),_.body.addChild(_.scrollbar),_.body.interactive=!0,_.body.addListener("mousedown",_.on_body_drag_start).addListener("touchstart",_.on_body_drag_start).addListener("mousemove",_.on_body_drag_move).addListener("touchmove",_.on_body_drag_move).addListener("mouseup",_.on_body_drag_end).addListener("touchend",_.on_body_drag_end).addListener("mouseupoutside",_.on_body_drag_end).addListener("touchendoutside",_.on_body_drag_end),_.scrollbar.interactive=!0,_.scrollbar.addListener("mousedown",_.on_scrollbar_drag_start).addListener("touchstart",_.on_scrollbar_drag_start).addListener("mousemove",_.on_scrollbar_drag_move).addListener("touchmove",_.on_scrollbar_drag_move).addListener("mouseup",_.on_scrollbar_drag_end).addListener("touchend",_.on_scrollbar_drag_end).addListener("mouseupoutside",_.on_scrollbar_drag_end).addListener("touchendoutside",_.on_scrollbar_drag_end),_}return iu(e,t),e.prototype.repaint=function(t,e,i,o,n){if((i||o)&&this.draw_body(t,e),i&&(this.update_cur_items_width(t),this.update_scrollbar_position_x(t)),o){this.scroll_range=e-112-38;var r=this.scroll_range/(this.value_length-this.available_item_num);this.scroll_step=Number.isNaN(r)?0:Math.max(0,r),this.paint_items(t,n||this.get_values())}},e.prototype.calculate_body_size=function(t,e){return this.available_item_num=4+Math.floor(e/45),{width:170+t,height:45*this.available_item_num}},e.prototype.generate_item_texture=function(t){var e=this.data.get_texture(t);if(e)return e;var i=t===U.LIGHT?0xffffff:0xf4f5f7,o=new q.j;o.beginFill(i).drawRect(0,0,170,45).endFill();var n=this.app.get_app().renderer.generateTexture(o,q.s.LINEAR,1);return q.y.addToCache(n,t),n},e.prototype.update_cur_items_width=function(t){var e=this;this.items_container.children.forEach(function(i){e.is_item(i)&&i.update_content({width:t})})},e.prototype.update_cur_items_order_width=function(t){var e=this;this.latest_order_width!==t&&(this.latest_order_width=t,this.items_container.children.forEach(function(t){e.is_item(t)&&t.update_content({order_width:e.latest_order_width})}))},e.prototype.update_item_values=function(t){var e=this,i=t.length,o=this.items_container.children.length,n=i-this.value_idx;this.value_length=t.length,this.scroll_step=this.scroll_range/(this.value_length-this.available_item_num),n<o&&(this.value_idx=Math.max(0,i-o));var r=Math.min(this.value_idx+o,i);this.latest_order_width=id(r.toString()).width,this.items_container.children.forEach(function(i,o){if(e.is_item(i)){var n=t[e.value_idx+o],r=e.value_idx+o+1;i.update_content({order:r,value:n,order_width:e.latest_order_width}),i.set_text_visible(void 0!==n)}}),this.update_scrollbar_visible()},e.prototype.paint_items=function(t,e){var i,o=this,n=this.items_container.children,r=n.length,s=this.available_item_num-r;if(0!==s){if(s>0){var a=this.value_length-this.value_idx-this.available_item_num;if(0!==this.value_idx&&a<0){this.value_idx=Math.max(0,this.value_idx+a);var _=e.slice(this.value_idx,this.value_idx+r);n.forEach(function(t,e){o.is_item(t)&&t.update_content({order:o.value_idx+e+1,value:_[e]})})}for(var c=this.value_idx+r,h=this.value_idx+this.available_item_num,l=e.slice(c,h),p=c;p<h;p++){var d=l[p-c],u=this.create_item(p,t,d);u.position.y=(p-this.value_idx)*45,this.items_container.addChild(u),void 0!==d&&(i=p+1)}}if(s<0){var f=this.items_container.removeChildren(this.available_item_num,r),g=this.value_idx+r;f.forEach(function(t,e){o.is_item(t)&&t.get_text_visible()&&(i=g-e-1),t.destroy()})}void 0!==i&&this.update_cur_items_order_width(id(i.toString()).width),this.update_scrollbar_visible(),this.scrollbar.visible&&(this.scrollbar.position.y=this.value_idx*this.scroll_step)}},e.prototype.is_item=function(t){return!!t&&t instanceof ip},e.prototype.mount=function(){this.items_container.visible=!0},e.prototype.dismount=function(){this.items_container.visible=!1,this.scrollbar.visible=!1},e.prototype.create_item=function(t,e,i){var o=t%2?U.DEEP:U.LIGHT,n=new ip({bg_texture:this.generate_item_texture(o),width:e,value:void 0===i?"":i,order:(t+1).toString(),order_width:this.latest_order_width});return n.set_text_visible(void 0!==i),n},e.destroy_background_texture=function(t){[t.get_texture(U.LIGHT),t.get_texture(U.DEEP)].forEach(function(t){t&&t.destroy(!0)})},e.prototype.update_scrollbar_visible=function(){this.scrollbar.visible=this.value_idx>0||this.value_length>this.available_item_num},e.prototype.update_scrollbar_position_x=function(t){this.scrollbar.position.x=t-10},e.prototype.draw_scrollbar=function(){this.scrollbar.beginFill(0xa3aebf,.3).drawRoundedRect(0,10,5,112,2.5).endFill()},e}(ig),ib=(T=function(t,e){return(T=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}T(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ix=function(){return(ix=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},im=function(t){function e(e){var i=e.title,o=e.prefix,n=e.text_max_width,r=e.icon_texture,s=t.call(this)||this;return s.text_offset_x=0,s.text_max_width=n,s.title=new ic(i,ix(ix({},e9),{fill:"#FFFFFF"}),s.text_max_width),s.addChild(s.title),r&&s.set_icon_texture(r),o?s.set_prefix(o):s.wrap_prefix_and_title(),s}return ib(e,t),e.prototype.set_title=function(t){return!!this.title.update_content({text:t})&&(this.wrap_prefix_and_title(),!0)},e.prototype.set_prefix=function(t){return this.prefix?!!this.prefix.update_content({text:t})&&(this.wrap_prefix_and_title(),!0):(this.prefix=new ic(t,ix(ix({},e9),{fill:"#523939"}),this.text_max_width),this.prefix.position.x=this.text_offset_x,this.addChild(this.prefix),this.wrap_prefix_and_title(),!0)},e.prototype.set_text_max_width=function(t){this.text_max_width+this.text_offset_x!==t&&(this.text_max_width=t-this.text_offset_x,this.wrap_prefix_and_title())},e.prototype.wrap_prefix_and_title=function(){var t=this.text_max_width,e=this.text_offset_x;this.prefix&&(this.prefix.get_full_text()?(this.prefix.update_content({wrap_width:t}),e=this.prefix.position.x+this.prefix.width,t=this.prefix.get_is_wrapped()?0:this.text_max_width-e,this.prefix.visible=!0):this.prefix.visible=!1),0!==t?(this.title.update_content({wrap_width:t}),this.title.position.x=e,this.title.visible=!0):this.title.visible=!1},e.prototype.destroy=function(){var e,i={children:!0,texture:!0,baseTexture:!0};this.title.destroy(i),null!=(e=this.prefix)&&e.destroy(i),t.prototype.destroy.call(this,{children:!0})},e.prototype.set_icon_texture=function(t){return this.icon?(this.icon.texture=t,!1):(this.icon=new q.t(t),this.icon.width=20,this.icon.height=20,this.icon.position.set(-2,5),this.addChild(this.icon),this.text_offset_x=25,!0)},e}(q.f),iw=(I=function(t,e){return(I=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}I(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iO=function(t){function e(e,i,o,n,r,s){var a,_=t.call(this,e,i,o,n)||this;return _.type=B.LIST,_.background=new q.j,_.body=new q.j,_.items_container=new q.f,_.blank_text=iy.init_blank_text(),_.bg_color=0xffad48,_.body_size={width:170,height:180},_.prev_size={width:0,height:0},_.offset={x:0,y:0},_.status=V.BLANK,_.on_position_change=function(){_.events.fire("list:drag_end",{target_id:_.id,data:{position:_.get_position()}})},_.on_offset_change=function(){_.events.fire("list_scale_btn:drag_end",{target_id:_.id,data:{offset:_.offset}})},_.drag_move_scale_btn=function(t){if(_.is_resizing){var e=t.data.getLocalPosition(_),i=e.x,o=e.y;_.offset.x=Math.max(0,i-163),_.offset.y=Math.max(0,o-215),_.body_size=_.get_current_painter().calculate_body_size(_.offset.x,_.offset.y),_.repaint(),_.app.render()}},_.data=r,_.get_values=s.get_values,s.title_icon_texture_id&&(a=_.data.get_texture(s.title_icon_texture_id)),_.header=new im({title:s.title,text_max_width:138,prefix:s.prefix,icon_texture:a}),_.header.position.y=12,_.body.addChild(_.items_container,_.blank_text),_.body.position.set(8,58),_.addChild(_.background,_.body,_.header,_.scale_btn),s.export_icon_texture_id&&_.set_export_icon(s.export_icon_texture_id),_.blank_painter=new iy(_.body,_.scale_btn,_.blank_text),_.non_blank_painter=new iv(_.app,_.body,_.scale_btn,_.items_container,_.data,_.get_values,function(){return _.app.render()}),s.position&&_.position.set(s.position.x,-s.position.y),s.bg_color&&(_.bg_color=s.bg_color),s.offset&&(_.offset=s.offset),_.body_size=_.get_current_painter().calculate_body_size(_.offset.x,_.offset.y),_.setParent(_.parent),_.set_resizable_part(_.background),_.scale_btn.addListener("mousemove",tt.w(_.drag_move_scale_btn,50)).addListener("touchmove",tt.w(_.drag_move_scale_btn,50)),_.add_listener("drag_end",_.on_position_change),_.add_resizable_event_listener("scale_btn_drag_end",_.on_offset_change),_.update_values(),_.status===V.BLANK&&_.repaint(),_}return iw(e,t),e.prototype.set_title=function(t){this.header.set_title(t)&&this.update_header_style()},e.prototype.set_title_prefix=function(t){this.header.set_prefix(t)&&this.update_header_style()},e.prototype.set_title_icon=function(t){var e=this.data.get_texture(t);e&&this.header.set_icon_texture(e)&&this.update_header_style()},e.prototype.update_values=function(t){var e=t||this.get_values(),i=e.length?V.NON_BLANK:V.BLANK;if(this.status!==i){if(this.status=i,this.prev_size={width:0,height:0},this.status===V.BLANK)this.blank_painter.mount(),this.non_blank_painter.dismount();else{this.blank_painter.dismount(),this.non_blank_painter.mount();var o=this.body_size,n=o.width,r=o.height;this.body_size=this.non_blank_painter.calculate_body_size(n-170,r-180),this.non_blank_painter.update_item_values(e)}this.repaint(t)}else{if(this.status===V.BLANK)return;this.non_blank_painter.update_item_values(e)}},e.prototype.set_blank_text=function(t){if(this.blank_text.text!==t){var e=this.blank_text.width;this.blank_text.text=t,this.status===V.BLANK&&this.blank_text.width!==e&&this.blank_painter.update_blank_text_position(this.body_size.width)}},e.prototype.set_bg_color=function(t){this.bg_color=t,this.draw_background()},e.prototype.set_export_icon=function(t){var e=this,i=this.data.get_texture(t);if(i)return this.export_icon?void(this.export_icon.texture=i):(this.export_icon=new q.t(i),this.export_icon.width=24,this.export_icon.height=24,this.export_icon.position.set(this.body_size.width-14,12),this.export_icon.interactive=!0,this.export_icon.buttonMode=!0,this.addChild(this.export_icon),this.export_icon.addListener("mouseup",function(){e.events.fire("list_export_icon:selected",{target_id:e.id})}),void this.export_icon.addListener("touchend",function(){e.events.fire("list_export_icon:selected",{target_id:e.id})}))},e.prototype.set_export_icon_visible=function(t){this.export_icon&&(this.export_icon.visible=t)},e.prototype.destroy=function(){this.blank_text.destroy({children:!0,texture:!0,baseTexture:!0}),t.prototype.destroy.call(this)},e.prototype.get_position=function(){return{x:this.position.x,y:-this.position.y}},e.prototype.set_position=function(t,e){this.position.set(t,-e)},e.prototype.set_offset=function(t){this.offset=t,this.body_size=this.get_current_painter().calculate_body_size(this.offset.x,this.offset.y),this.repaint()},e.prototype.repaint=function(t){var e=this.body_size,i=e.width,o=e.height,n=this.prev_size.width!==i,r=this.prev_size.height!==o;(n||r)&&(this.draw_background(),this.update_scale_btn_position()),n&&(this.update_header_style(),this.update_export_icon_position()),this.get_current_painter().repaint(i,o,n,r,t),this.prev_size={width:i,height:o}},e.prototype.draw_background=function(){this.background.clear().beginFill(this.bg_color).lineStyle(2,0xcccccc).drawRoundedRect(0,0,this.body_size.width+16,this.body_size.height+16+50,20).endFill()},e.prototype.get_current_painter=function(){switch(this.status){case V.BLANK:return this.blank_painter;case V.NON_BLANK:return this.non_blank_painter}},e.prototype.update_scale_btn_position=function(){this.offset.x=this.body_size.width-170,this.offset.y=this.body_size.height-180,this.scale_btn.position.set(163+this.offset.x,215+this.offset.y)},e.prototype.update_header_style=function(){this.header.set_text_max_width(this.body_size.width-32),this.header.position.x=(this.body_size.width+16-this.header.width)/2},e.prototype.update_export_icon_position=function(){this.export_icon&&(this.export_icon.position.x=this.body_size.width-14)},e}(e0),iA=(E=function(t,e){return(E=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}E(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),ik=function(t){var e="function"==typeof Symbol&&Symbol.iterator,i=e&&t[e],o=0;if(i)return i.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},iT=function(t){function e(e,i,o){var n=t.call(this)||this;return n.set_parent=function(t){n.setParent(t)},n.app=e,n.events=i,n.data=o,n.timer_container=new q.f,n.data_widget_container=new q.f,n.variables=new Map,n.lists=new Map,n.addChild(n.data_widget_container,n.timer_container),n}return iA(e,t),e.prototype.get_timer=function(){return this.timer||(this.timer=new e5(this.timer_container,this.app,this.events)),this.timer},e.prototype.remove_timer=function(){this.timer&&(this.timer.destroy(),this.timer=void 0)},e.prototype.set_visible=function(t){this.visible=t},e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0,texture:!0}),iv.destroy_background_texture(this.data)},e.prototype.load_variable=function(t,e){var i=this.get_variable(t);return i||(i=new ii(t,this.data_widget_container,this.app,this.events,this.data,e),this.variables.set(t,i),i)},e.prototype.get_variable=function(t){var e=this.variables.get(t);if(e)return e;var i=this.get_data_widget_child(t,B.VARIABLE);return i?(this.variables.set(t,i),i):void 0},e.prototype.destroy_variable=function(t){var e=this.get_variable(t);if(!e)return new tp.a("Cannot find variable "+t+".");e.destroy(),this.variables.delete(t)},e.prototype.is_variable=function(t){return!!t&&t.type===B.VARIABLE},e.prototype.is_list=function(t){return!!t&&t.type===B.LIST},e.prototype.set_all_widgets_draggable=function(t){var e=this;this.data_widget_container.children.forEach(function(i){(e.is_variable(i)||e.is_list(i))&&i.set_draggable(t)})},e.prototype.destroy_all_widgets=function(){var t=this;this.data_widget_container.removeChildren().forEach(function(e,i){(t.is_variable(e)||t.is_list(e))&&e.destroy()}),this.variables.clear(),this.lists.clear()},e.prototype.set_z_index=function(t){var e=this.parent;t=Math.max(1,t=Math.min(t,e.children.length-1)),e.setChildIndex(this,t)},e.prototype.load_list=function(t,e){var i=this.get_list(t);return i?new tp.a("List "+t+" already exists."):(i=new iO(t,this.data_widget_container,this.app,this.events,this.data,e),this.lists.set(t,i)),i},e.prototype.get_list=function(t){var e=this.lists.get(t);if(e)return e;var i=this.get_data_widget_child(t,B.LIST);return i?(this.lists.set(t,i),i):void 0},e.prototype.destroy_list=function(t){var e=this.lists.get(t);if(!e)return new tp.a("Cannot find list "+t+".");e.destroy(),this.lists.delete(t)},e.prototype.get_data_widget_child=function(t,e){var i,o,n=e===B.VARIABLE?this.is_variable:this.is_list;try{for(var r=ik(this.data_widget_container.children),s=r.next();!s.done;s=r.next()){var a=s.value;if(a.name===t&&n(a))return a}}catch(t){i={error:t}}finally{try{s&&!s.done&&(o=r.return)&&o.call(r)}finally{if(i)throw i.error}}},e.prototype.get_latest_data_widget=function(){var t=this.data_widget_container.children,e=t[t.length-1];if(this.is_list(e)||this.is_variable(e))return e},e}(q.f),iI=(L=function(t,e){return(L=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}L(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iE=function(t){function e(){var e=t.call(this)||this;return e.start_pos=0,e.max_size=0,e.scroll_bar_width=0,e.is_dragging=!1,e.scrollbar_y=0,e.SCROLL_BAR_MARGIN=6,e.scroll_drag_start=function(t){t.stopPropagation(),e.is_dragging=!0,e.scrollbar_y=t.data.getLocalPosition(e).y},e.scroll_drag_move=function(t){if(e.text_area&&e.is_dragging){t.stopPropagation();var i=t.data.getLocalPosition(e).y,o=i-e.scrollbar_y;e.scrollbar_y=i;var n=e.scrollbar_btn.position.y+o,r=e.max_size*(1-e.max_size/e.text_area.height);n=te.a(0,r,n),e.scrollbar_btn.position.y=n,e.text_area.position.y=-e.scrollbar_btn.y/(e.height-e.scrollbar_btn.height)*(e.text_area.height-e.max_size)+e.start_pos}},e.scroll_drag_end=function(){e.is_dragging=!1},e.name="scrollbar",e.scrollbar_btn=new q.j,e.scrollbar_btn.on("mousedown",e.scroll_drag_start).on("mousemove",e.scroll_drag_move).on("mouseup",e.scroll_drag_end).on("mouseupoutside",e.scroll_drag_end).on("touchstart",e.scroll_drag_start).on("touchmove",e.scroll_drag_move).on("touchendoutside",e.scroll_drag_end).on("touchend",e.scroll_drag_end),e.addChild(e.scrollbar_btn),e}return iI(e,t),e.prototype.draw_scroll_bar=function(t,e,i,o){this.start_pos=e,this.text_area=t,this.max_size=i,this.scroll_bar_width=o,this.is_dragging=!1,this.draw_scroll_area(),this.draw_scroll_btn(),t.parent.addChild(this)},e.prototype.draw_scroll_area=function(){this.text_area&&(this.clear(),this.beginFill(0xe0e0e0,1),this.drawRoundedRect(this.text_area.position.x+this.text_area.width+this.SCROLL_BAR_MARGIN,this.text_area.position.y,this.scroll_bar_width,this.max_size,this.scroll_bar_width/2))},e.prototype.draw_scroll_btn=function(){if(this.text_area){this.scrollbar_btn.interactive=!0;var t=this.max_size/this.text_area.height*this.max_size;this.clear(),this.scrollbar_btn.beginFill(0xcdcdcd,1),this.scrollbar_btn.drawRoundedRect(this.text_area.position.x+this.text_area.width+this.SCROLL_BAR_MARGIN,this.text_area.position.y,this.scroll_bar_width,t,this.scroll_bar_width/2),this.scrollbar_btn.endFill()}},e}(q.j),iL={fontSize:"20px",fontFamily:["PingFangSC-Regular","Microsoft YaHei"],fill:"#808080"},iS={fontSize:"28px",fontFamily:["PingFangSC-Regular","Microsoft YaHei"],wordWrap:!0,breakWords:!0,fill:"#000000"};(S=X||(X={}))[S.origin=0]="origin",S[S.translation=1]="translation";var iR=(R=function(t,e){return(R=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}R(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iM=function(t){function e(e,i,o,n){var r=t.call(this)||this;r.is_play=!1,r.TEXT_PADDING=10,r.TEXT_TITLE_PADDING=15,r.DIALOG_MARGIN=12,r.DIALOG_PADDING=20,r.BACKGROUND_PADDING=5,r.BACKGROUND_RADIUS=10,r.TITLE_TEXT_MARGIN=10,r.FROM_TO_MARGIN=130,r.SCROLLBAR_WIDTH=12,r.PLAY_ICON_MARGIN=12,r.STATIC_HEIGHT=2*(r.DIALOG_MARGIN+r.DIALOG_PADDING)+r.FROM_TO_MARGIN,r.close_dialog=function(){r.on_complete_cb&&r.on_complete_cb(),r.hide()},r.play_translation=function(){r.events.fire("translate_dialog_btn:click",{text:r.translation_text.text,is_play:r.is_play}),r.set_play_state(!r.is_play)},r.set_parent=function(t){r.setParent(t)},r.app=e,r.loader=i,r.events=o,r.origin_title=new q.v("",iL),r.origin_title.x=r.DIALOG_PADDING,r.origin_text=new q.v("",iS),r.origin_text.x=r.DIALOG_PADDING,r.origin_title_background=new q.j,r.separate_line=new q.j,r.translation_title=new q.v("",iL),r.translation_title.x=r.DIALOG_PADDING,r.translation_text=new q.v("",iS),r.translation_text.x=r.DIALOG_PADDING,r.translation_title_background=new q.j,r.translation_text_mask=new q.j,r.translation_text_mask.name="text_mask",r.scrollbar=new iE,r.close_icon=new q.t,r.close_icon.scale.set(.17),r.close_icon.interactive=!0,r.close_icon.buttonMode=!0,r.close_icon.alpha=.5,r.close_icon.on("mouseup",r.close_dialog),r.close_icon.on("touchend",r.close_dialog),r.play_idle_icon=new q.t,r.play_idle_icon.scale.set(.15),r.playing_icon=new q.t,r.playing_icon.scale.set(.15),r.set_play_state(!1),r.play_container=new q.f,r.play_container.addChild(r.play_idle_icon,r.playing_icon),r.play_container.interactive=!0,r.play_container.buttonMode=!0,r.play_container.on("mousedown",r.play_translation),r.play_container.on("touchstart",r.play_translation),r.app.get_renderer_type()===q.p.WEBGL&&(r.filters=[new q.h({rotation:45,distance:3,alpha:.15,color:0,blur:0})]),r.loader.add({url:n.url,on_success:function(t){var e=t.textures;e&&(r.close_icon.texture=e[n.texture_name.close_icon],r.playing_icon.texture=e[n.texture_name.playing_icon],r.play_idle_icon.texture=e[n.texture_name.play_idle_icon],r.app.render())}}),r.addChild(r.origin_title_background,r.origin_title,r.origin_text,r.separate_line,r.translation_title_background,r.translation_title,r.translation_text,r.close_icon,r.play_container),r.visible=!1,r.interactive=!0;var s=function(t){t.stopPropagation()};return r.on("mouseup",s),r.on("mousedown",s),r.on("touchstart",s),r.on("touchend",s),r}return iR(e,t),e.prototype.draw_background=function(t,e){var i=this.app.get_app().view,o=i.width,n=i.height;this.clear(),this.lineStyle(2,0xd9d6ce,1),this.beginFill(0xffffff,1),this.drawRoundedRect(0,0,t,e,this.BACKGROUND_RADIUS),this.position.y=n/2-e-this.DIALOG_MARGIN,this.position.x=-o/2+this.DIALOG_MARGIN,this.endFill()},e.prototype.hide_scrollbar=function(){this.removeChild(this.scrollbar),this.removeChild(this.translation_text_mask)},e.prototype.draw_content=function(t,e,i,o,n){var r=this.get_object_by_type(t),s=r.content_title,a=r.content_text,_=r.title_background,c=this.app.get_app().view.height,h=n-2*(this.DIALOG_PADDING+this.TEXT_PADDING);s.text=e,s.position.y=o,_.clear(),_.beginFill(0xe2e2e2).drawRoundedRect(s.position.x-this.BACKGROUND_PADDING,s.position.y-this.BACKGROUND_PADDING,s.width+2*this.BACKGROUND_PADDING,s.height+2*this.BACKGROUND_PADDING,1.6).endFill();var l=s.height+this.TITLE_TEXT_MARGIN,p=(c-this.STATIC_HEIGHT)/2-l;a.position.y=o+l,a.text=i,a.style.wordWrapWidth=h;var d=Math.min(a.height,p);return a.height>p&&t===X.translation&&this.draw_scroll_box(d,h),l+d},e.prototype.draw_separate_line=function(t,e){this.separate_line.clear(),this.separate_line.lineStyle(2,0,.1).moveTo(0,t).lineTo(e,t).endFill()},e.prototype.set_icon_position=function(t){var e=this.close_icon,i=this.play_container,o=this.translation_title,n=t-e.width-this.DIALOG_PADDING,r=this.DIALOG_PADDING;e.position.x=n,e.position.y=r;var s=o.position.x+o.width+this.PLAY_ICON_MARGIN,a=o.position.y+(o.height-this.play_container.height)/2;i.position.x=s,i.position.y=a},e.prototype.draw_scroll_box=function(t,e){this.translation_text.style.wordWrapWidth=e-this.SCROLLBAR_WIDTH,this.addChild(this.translation_text_mask),this.clear(),this.translation_text_mask.beginFill(0x98ff99,1),this.translation_text_mask.drawRect(this.translation_text.position.x,this.translation_text.position.y,e-this.SCROLLBAR_WIDTH,t),this.translation_text_mask.endFill(),this.translation_text.mask=this.translation_text_mask,this.scrollbar.draw_scroll_bar(this.translation_text,this.translation_text.position.y,this.translation_text_mask.height,this.SCROLLBAR_WIDTH)},e.prototype.get_object_by_type=function(t){return t===X.origin?{content_title:this.origin_title,content_text:this.origin_text,title_background:this.origin_title_background}:{content_title:this.translation_title,content_text:this.translation_text,title_background:this.translation_title_background}},e.prototype.show=function(t,e,i,o){this.hide_scrollbar(),this.on_complete_cb=o,this.visible=!0;var n=this.app.get_app().view.width-2*this.DIALOG_MARGIN,r=t.src,s=t.dst,a=this.draw_content(X.origin,e,r,this.TEXT_TITLE_PADDING,n),_=a+this.DIALOG_PADDING+this.FROM_TO_MARGIN/2;this.draw_separate_line(_,n);var c=this.draw_content(X.translation,i,s,_+this.DIALOG_PADDING,n),h=2*this.DIALOG_PADDING+a+this.FROM_TO_MARGIN+c;this.draw_background(n,h),this.set_icon_position(n)},e.prototype.set_play_state=function(t){this.is_play=t,this.playing_icon.visible=t,this.play_idle_icon.visible=!t},e.prototype.set_play_icon_visible=function(t){this.play_container.visible=t},e.prototype.hide=function(){this.visible=!1,this.set_play_state(!1)},e.prototype.destroy=function(){this.origin_title.destroy({texture:!0}),this.origin_text.destroy({texture:!0}),this.translation_title.destroy({texture:!0}),this.translation_text.destroy({texture:!0}),t.prototype.destroy.call(this,{children:!0})},e}(q.j),iC=i(9155),iP=(M=function(t,e){return(M=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}M(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iG=function(t){function e(e,i){var o=t.call(this)||this;return o.app=e,o.on_destroy=i,o.video=document.createElement("video"),o.canvas=document.createElement("canvas"),o.camera_status=es.d.TURN_OFF,o.set_parent=function(t){o.setParent(t)},o.anchor.set(.5),o.texture=q.y.from(o.video),o.visible=!1,o}return iP(e,t),e.prototype.turn_on=function(t){var e=this;return this.camera_status===es.d.IS_TURNED_ON?Promise.resolve():this.camera_status===es.d.TURNING_ON&&this.turning_on_lock?this.turning_on_lock:(this.camera_status=es.d.TURNING_ON,this.turning_on_lock=new Promise(function(i,o){navigator.mediaDevices.getUserMedia(t).then(function(t){if(e.camera_status!==es.d.TURN_OFF){e.stream=t;try{e.video.srcObject=t}catch(i){e.video.src=window.URL.createObjectURL(t)}e.video.onloadedmetadata=function(t){e.camera_status!==es.d.TURN_OFF&&(e.adjust_stage_scale(),e.camera_status=es.d.IS_TURNED_ON,e.turning_on_lock=void 0,e.visible=!0,e.video.play()),i()}}else i()}).catch(o)}))},e.prototype.adjust_stage_scale=function(){var t=this.app.get_app().view,e=t.width,i=t.height,o=this.video,n=o.videoWidth,r=o.videoHeight;if(0!==n&&0!==r){var s=Math.max(i/r,e/n);this.scale.set(-s,s)}},e.prototype.turn_off=function(){var t;this.camera_status!==es.d.TURN_OFF&&(this.camera_status=es.d.TURN_OFF,null!=(t=this.stream)&&t.getVideoTracks().forEach(function(t){return t.stop()}),this.stream=void 0,this.turning_on_lock=void 0,this.visible=!1)},e.prototype.get_image_data=function(t){var e=this.canvas.getContext("2d");if(this.camera_status===es.d.IS_TURNED_ON&&e)return t?(this.canvas.width=t.width,this.canvas.height=t.height):(this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight),e.resetTransform(),e.scale(-1,1),e.translate(-1*this.canvas.width,0),e.drawImage(this.video,0,0,this.video.videoWidth,this.video.videoHeight,0,0,this.canvas.width,this.canvas.height),e.getImageData(0,0,this.canvas.width,this.canvas.height)},e.prototype.set_alpha=function(t){this.alpha=t},e.prototype.destroy=function(){t.prototype.destroy.call(this,{children:!0,texture:!0,baseTexture:!0}),this.on_destroy()},e}(q.t),iN=i(22452),iD=(C=function(t,e){return(C=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}C(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iF=new q.x({fontFamily:["sans-serif","Microsoft YaHei"],fontSize:"24px",fill:"#ffffff"}),ij=function(t){function e(e,i,o){var n=t.call(this)||this;return n.is_cached=!1,n.loader_animation=function(t){n.loading_icon.rotation-=.1*t},n.app=e,n.loader=i,n.url=o,n.loading_icon=new q.t,n.name_text=new q.v(""),n}return iD(e,t),e.prototype.load_texture=function(){var t=this;this.loader.add({url:this.url,on_success:function(e){var i=e.textures;i&&(t.loading_icon.texture=i["wood_banner_loading.png"])},on_error:function(t){return console.error("wood texture load fail",t)}})},e.prototype.draw=function(){this.clear();var t=this.app.get_app().view,e=t.width,i=t.height;this.name_text.visible=!0,this.loading_icon.visible=!0,this.name_text.style=iF,this.name_text.anchor.set(0,.5),this.loading_icon.anchor.set(.5),this.loading_icon.x=60-e/2,this.loading_icon.y=40-i/2,this.name_text.x=100-e/2,this.name_text.y=40-i/2,this.beginFill(0,.8),this.drawRect(-e/2,-i/2,e,80),this.endFill()},e.prototype.show=function(t){t&&(this.name_text.text=t),this.is_cached||(this.load_texture(),this.addChild(this.name_text,this.loading_icon),this.draw(),this.interactive=!0,this.setParent(this.app.get_app().stage),this.is_cached=!0),this.visible=!0,this.app.get_app().ticker.add(this.loader_animation)},e.prototype.hide=function(){this.name_text.text="",this.visible=!1,this.app.get_app().ticker.remove(this.loader_animation)},e.prototype.destroy=function(){this.app.get_app().ticker.remove(this.loader_animation),t.prototype.destroy.call(this,{children:!0,texture:!0})},e}(q.j),iz=(P=function(t,e){return(P=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}P(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iB=function(t){function e(e,i){var o=t.call(this)||this;return o.LINE_WIDTH=1.5,o.LINE_COLOR=0xffffff,o.LINE_ALPHA=1,o.draw_border_box=function(t){o.update_transform(t),o.clear(),o.lineStyle(o.LINE_WIDTH,o.LINE_COLOR,o.LINE_ALPHA),o.drawRect(-t.width/2,-t.height/2,t.width,t.height),o.endFill()},o.on_target_change=function(t){o.target&&tt.l(o.target)&&(void 0!==t.visible&&(o.visible=t.visible),t.scale||t.texture?o.draw_border_box(o.target):(t.position||t.pivot||t.rotation)&&o.update_transform(o.target))},o.on_target_destroy=function(){o.hide()},o.set_parent=function(t){o.setParent(t)},o.app=e,o.data=i,o.filters=[new q.h({rotation:0,distance:0,alpha:.3,color:2171686,blur:.5})],o.visible=!1,o}return iz(e,t),e.prototype.set_target_actor=function(t){var e=this.data.get_internal_actor(t);if(!e)return new tp.a("Cannot find actor "+t);this.target!==e&&(this.target=e,this.visible=this.target.get_visible(),this.draw_border_box(this.target),this.target.add_listener("change",this.on_target_change),this.target.add_listener("destroy",this.on_target_destroy),this.app.render())},e.prototype.get_target_actor=function(){var t;return null==(t=this.target)?void 0:t.id},e.prototype.destroy=function(){tt.l(this.target)&&this.target.remove_listener("destroy",this.on_target_destroy),t.prototype.destroy.call(this,!0)},e.prototype.update_transform=function(t){this.position.set(t.position.x,t.position.y),this.pivot.set(t.pivot.x*t.scale.x,t.pivot.y*t.scale.y),this.rotation=t.rotation},e.prototype.hide=function(){this.target&&(this.target.removeListener("change",this.on_target_change),this.target.removeListener("destroy",this.on_target_destroy),this.target=void 0,this.visible=!1,this.app.render())},e}(q.j),iH=(G=function(t,e){return(G=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}G(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iV=function(t,e){var i,o,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){var _=[r,a];if(i)throw TypeError("Generator is already executing.");for(;s;)try{if(i=1,o&&(n=2&_[0]?o.return:_[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,_[1])).done)return n;switch(o=0,n&&(_=[2&_[0],n.value]),_[0]){case 0:case 1:n=_;break;case 4:return s.label++,{value:_[1],done:!1};case 5:s.label++,o=_[1],_=[0];continue;case 7:_=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===_[0]||2===_[0])){s=0;continue}if(3===_[0]&&(!n||_[1]>n[0]&&_[1]<n[3])){s.label=_[1];break}if(6===_[0]&&s.label<n[1]){s.label=n[1],n=_;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(_);break}n[2]&&s.ops.pop(),s.trys.pop();continue}_=e.call(t,s)}catch(t){_=[6,t],o=0}finally{i=n=0}if(5&_[0])throw _[1];return{value:_[0]?_[1]:void 0,done:!0}}}},iU=function(t){function e(e,i,o){var n=t.call(this)||this;return n.cache=new Map,n.set_parent=function(t){n.setParent(t)},n.theme=e,n.app=i,n.data=o,n}return iH(e,t),e.prototype.load_actor_box=function(t){var e=this.data.get_internal_actor(t);if(e)return this.load_box(e)},e.prototype.load_video_box=function(t){if(iC.b(t))return this.load_box(t)},e.prototype.load_box=function(t){var e=this.cache.get(t.get_id());if(e)return e;var i=new iW(this.app,t,this.theme,this.cache);return this.addChild(i),this.cache.set(t.get_id(),i),i},e.prototype.get_box=function(t){return this.cache.get(t)},e.prototype.set_theme=function(t){this.theme=t,this.cache.forEach(function(e){e.update_theme(t)})},e.prototype.hide_all_boxes=function(){this.cache.forEach(function(t){t.set_visible(!1)})},e.prototype.destroy_all_boxes=function(){this.cache.forEach(function(t){t.destroy()}),this.cache.clear()},e}(q.f),iW=function(t){function e(e,i,o,n){var r=t.call(this)||this;return r.app=e,r.target=i,r.theme=o,r.cache=n,r.box_visible=!0,r.LINE_WIDTH=2,r.ICON_HEIGHT=5,r.ICON_WIDTH=43,r.MIN_BOX=54,r.RADUIS=4,r.on_target_destroy=function(){return r.destroy()},r.on_actor_update=function(t){tt.l(r.target)&&(void 0!==t.visible&&(r.visible=t.visible&&r.box_visible),t.scale||t.texture?r.draw(r.target):(t.position||t.pivot||void 0!==t.rotation)&&r.update_transform(r.target))},r.on_video_update=function(t){iC.b(r.target)&&(void 0!==t.visible&&(r.visible=t.visible&&r.box_visible),t.scale?r.draw(r.target):t.position&&r.update_transform(r.target))},r.target=i,r.id=i.id,r.visible=i.visible&&r.box_visible,r.icon=new q.t,r.icon.width=r.ICON_WIDTH,r.icon.height=r.ICON_HEIGHT,r.load_texture(r.theme.icon_url).then(function(t){r.icon.texture=t,r.app.render()}).catch(function(t){return console.warn(t)}),r.addChild(r.icon),r.draw(r.target),tt.l(r.target)?r.target.add_listener("change",r.on_actor_update):r.target.add_listener("change",r.on_video_update),r.target.add_listener("destroy",r.on_target_destroy),r}return iH(e,t),e.prototype.load_texture=function(t){var e,i,o,n;return e=this,i=void 0,o=void 0,n=function(){var e;return iV(this,function(i){return t&&q.B.TextureCache[t]?[2,q.B.TextureCache[t]]:t&&q.B.BaseTextureCache[t]?[2,new q.y(q.B.BaseTextureCache[t])]:(e=t?q.y.from(t):q.y.EMPTY).valid?[2,e]:[2,new Promise(function(t,i){e.baseTexture.on("loaded",function(){t(e)}),e.baseTexture.on("update",function(){t(e)}),e.baseTexture.on("error",function(t){e.destroy(!0),i(t)})})]})},new(o||(o=Promise))(function(t,r){function s(t){try{_(n.next(t))}catch(t){r(t)}}function a(t){try{_(n.throw(t))}catch(t){r(t)}}function _(e){var i;e.done?t(e.value):((i=e.value)instanceof o?i:new o(function(t){t(i)})).then(s,a)}_((n=n.apply(e,i||[])).next())})},e.prototype.draw=function(t){this.update_transform(t);var e=Math.max(t.width,this.MIN_BOX),i=Math.max(t.height,this.MIN_BOX);this.clear(),this.lineStyle(this.LINE_WIDTH,this.theme.color),this.drawRoundedRect(-e/2,-i/2,e,i,this.RADUIS),this.endFill(),this.icon.position.set(-e/2,-i/2-this.ICON_HEIGHT)},e.prototype.update_theme=function(t){var e=this;this.theme=t,this.draw(this.target),this.load_texture(this.theme.icon_url).then(function(t){e.icon.texture=t,e.app.render()}).catch(function(t){return console.warn(t)})},e.prototype.update_transform=function(t){this.position.set(t.position.x,t.position.y),this.pivot.set(t.pivot.x*t.scale.x,t.pivot.y*t.scale.y),this.rotation=t.rotation},e.prototype.set_visible=function(t){this.box_visible=t,this.visible=this.target.visible&&this.box_visible},e.prototype.destroy=function(){tt.l(this.target)?this.target.remove_listener("change",this.on_actor_update):this.target.remove_listener("change",this.on_video_update),this.target.remove_listener("destroy",this.on_target_destroy),this.cache.delete(this.id),t.prototype.destroy.call(this,{children:!0})},e}(q.j),iX=function(){function t(t,e,i){var o=this;this.destroy_scene_children_container=function(){o.scene_children_container&&0===o.scene_children_container.children.length&&(o.remove_scene_container_parent_scene_listener(),o.scene_children_container.destroy(),o.events.remove_listener("scene:current_scene_changed",o.on_parent_scene_change),o.scene_children_container=void 0)},this.on_parent_scene_change=function(t){var e=o.data.get_internal_scene(t);e&&(o.remove_scene_container_parent_scene_listener(),o.on_parent_scene_destroy=function(){e.removeChild(o.get_scene_children_container()),o.on_parent_scene_destroy&&e.remove_listener("destroy",o.on_parent_scene_destroy)},e.addChildAt(o.get_scene_children_container(),es.h),e.add_listener("destroy",o.on_parent_scene_destroy))},this.app=t,this.data=e,this.events=i,this.loader=new er,this.components_z_index_array=[void 0],this.scene_children_container_children_z_index_array=[]}return t.prototype.init=function(t){var e,i=this;!this.editor&&t.editor&&(this.editor=new iN.a(t.editor,this.app,this.data,this.events,this.loader),this.components_z_index_array[es.c.EDITOR]=this.editor.set_parent),!this.grid&&t.grid&&(this.grid=new eK(this.app,this.events),this.components_z_index_array[es.c.GRID]=this.grid.set_parent),!this.draggable_container&&t.draggable_container&&(this.draggable_container=new iT(this.app,this.events,this.data),this.components_z_index_array[es.c.DRAGGABLE_CONTAINER]=this.draggable_container.set_parent),!this.voice_dialog&&t.voice_dialog&&(this.voice_dialog=new eN(t.voice_dialog,this.app,this.loader,this.events),this.components_z_index_array[es.c.VOICE_DIALOG]=this.voice_dialog.set_parent),!this.stage_dialog&&t.stage_dialog&&(this.stage_dialog=new eH(this.app,this.data,this.loader,t.stage_dialog,this.events),this.components_z_index_array[es.c.STAGE_DIALOG]=this.stage_dialog.set_parent),!this.selection_dialog&&t.selection_dialog&&(this.selection_dialog=new eQ(this.app,this.events),this.components_z_index_array[es.c.SELECTION_DIALOG]=this.selection_dialog.set_parent),!this.translate_dialog&&t.translate_dialog&&(this.translate_dialog=new iM(this.app,this.loader,this.events,t.translate_dialog),this.components_z_index_array[es.c.TRANSLATE_DIALOG]=this.translate_dialog.set_parent),!this.playable_manager&&t.playable_manager&&(this.playable_manager=new iC.a(this.app,this.data,this.events,this.destroy_scene_children_container),this.scene_children_container_children_z_index_array[es.g.PLAYABLE_CONTAINER]=this.playable_manager.set_video_container_parent,(e=t.playable_manager.parent_scene_id)&&this.on_parent_scene_change(e)),!this.camera&&t.camera&&(this.camera=new iG(this.app,this.destroy_scene_children_container),this.scene_children_container_children_z_index_array[es.g.CAMERA]=this.camera.set_parent,(e=t.camera.parent_scene_id)&&this.on_parent_scene_change(e)),!this.actor_dialog_manager&&t.actor_dialog_manager&&(this.actor_dialog_manager=new el(this.app,this.data)),!this.wood_loader&&t.wood_loader&&(this.wood_loader=new ij(this.app,this.loader,t.wood_loader.url)),!this.border_box&&t.border_box&&(this.border_box=new iB(this.app,this.data),this.components_z_index_array[es.c.BORDER_BOX]=this.border_box.set_parent),!this.cooperation_box_container&&t.cooperation_box_container&&(this.cooperation_box_container=new iU(t.cooperation_box_container,this.app,this.data),this.components_z_index_array[es.c.COOPERATION_CONTAINER]=this.cooperation_box_container.set_parent);var o=this.app.get_app().stage;this.components_z_index_array.forEach(function(t){t&&t(o)}),this.scene_children_container_children_z_index_array.forEach(function(t){t&&t(i.get_scene_children_container())})},t.prototype.get_scene_children_container=function(){return this.scene_children_container||(this.scene_children_container=new q.f,this.events.add_listener("scene:current_scene_changed",this.on_parent_scene_change)),this.scene_children_container},t.prototype.remove_scene_container_parent_scene_listener=function(){var t=this.get_scene_children_container().parent;tt.m(t)&&this.on_parent_scene_destroy&&(t.remove_listener("destroy",this.on_parent_scene_destroy),this.on_parent_scene_destroy=void 0)},t.prototype.destroy=function(t){this.editor&&t.editor&&(this.editor.destroy(),this.editor=void 0,this.components_z_index_array[es.c.EDITOR]=void 0),this.actor_dialog_manager&&t.actor_dialog_manager&&(this.actor_dialog_manager.destroy(),this.actor_dialog_manager=void 0),this.stage_dialog&&t.stage_dialog&&(this.stage_dialog.destroy(),this.stage_dialog=void 0,this.components_z_index_array[es.c.STAGE_DIALOG]=void 0),this.grid&&t.grid&&(this.grid.destroy(),this.grid=void 0,this.components_z_index_array[es.c.GRID]=void 0),this.selection_dialog&&t.selection_dialog&&(this.selection_dialog.destroy(),this.selection_dialog=void 0,this.components_z_index_array[es.c.SELECTION_DIALOG]=void 0),this.translate_dialog&&t.translate_dialog&&(this.translate_dialog.destroy(),this.translate_dialog=void 0,this.components_z_index_array[es.c.TRANSLATE_DIALOG]=void 0),this.draggable_container&&t.draggable_container&&(this.draggable_container.destroy(),this.draggable_container=void 0,this.components_z_index_array[es.c.DRAGGABLE_CONTAINER]=void 0),this.camera&&t.camera&&(this.camera.destroy(),this.camera=void 0,this.scene_children_container_children_z_index_array[es.g.CAMERA]=void 0),this.playable_manager&&t.playable_manager&&(this.playable_manager.destroy(),this.playable_manager=void 0,this.scene_children_container_children_z_index_array[es.g.PLAYABLE_CONTAINER]=void 0),this.wood_loader&&t.wood_loader&&(this.wood_loader.destroy(),this.wood_loader=void 0),this.voice_dialog&&t.voice_dialog&&(this.voice_dialog.destroy(),this.voice_dialog=void 0,this.components_z_index_array[es.c.VOICE_DIALOG]=void 0),this.border_box&&t.border_box&&(this.border_box.destroy(),this.border_box=void 0,this.components_z_index_array[es.c.BORDER_BOX]=void 0)},t.prototype.get_editor=function(){return this.editor},t.prototype.get_actor_dialog_manager=function(){return this.actor_dialog_manager},t.prototype.get_voice_dialog=function(){return this.voice_dialog},t.prototype.get_stage_dialog=function(){return this.stage_dialog},t.prototype.get_grid=function(){return this.grid},t.prototype.get_selection_dialog=function(){return this.selection_dialog},t.prototype.get_translate_dialog=function(){return this.translate_dialog},t.prototype.get_draggable_container=function(){return this.draggable_container},t.prototype.get_playable_manager=function(){return this.playable_manager},t.prototype.get_camera=function(){return this.camera},t.prototype.get_wood_loader=function(){return this.wood_loader},t.prototype.get_border_box=function(){return this.border_box},t.prototype.get_cooperation_container=function(){return this.cooperation_box_container},t}(),iY={Components:Symbol("Components"),KittenStage:Symbol("KittenStage")},iK=(N=function(t,e){return(N=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}N(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),iq=function(t,e,i,o){var n,r=arguments.length,s=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,o);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(r<3?n(s):r>3?n(e,i,s):n(e,i))||s);return r>3&&s&&Object.defineProperty(e,i,s),s},iJ=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},iQ=function(t,e){return function(i,o){e(i,o,t)}},iZ=function(t){function e(e,i,o,n,r,s,a,_,c){var h=t.call(this,e,o,n,r,s,a,_,i)||this;return h.events=i,h.components=c(e,h.data),h}return iK(e,t),iq([Y.injectable(),iQ(0,Y.inject(J.App)),iQ(1,Y.inject(J.Events)),iQ(2,Y.inject(J.Data)),iQ(3,Y.inject(J.Textures)),iQ(4,Y.inject(J.Scenes)),iQ(5,Y.inject(J.Actors)),iQ(6,Y.inject(J.StageAnimation)),iQ(7,Y.inject(J.Physics)),iQ(8,Y.inject(iY.Components)),iJ("design:paramtypes",[Object,Object,Function,Function,Function,Function,Function,Function,Function])],e)}(ts);function i$(){var t;return t=iY.KittenStage,en.get(t)}en.bind(iY.Components).toFactory(function(t){var e=t.container.get(J.Events);return function(t,i){return new iX(t,i,e)}}),en.bind(iY.KittenStage).to(iZ),console.log("%cWelcome to  Codemao Stage - v"+i(13098).version+"  for Kitten o(**)","\n  color: #BC2424;\n  text-shadow: 0 1px 0 #8D1B1B;")}}]);
//# sourceMappingURL=546.40b736fb0845d3fd.js.map