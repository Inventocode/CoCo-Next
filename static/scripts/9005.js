"use strict";(self.webpackChunkcoco_next=self.webpackChunkcoco_next||[]).push([[9005],{1737:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.VerticalFlyout=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(32791),_=o(15261),a=o(24042),l=o(99186),c=function(t){function e(e){var o=t.call(this,e)||this;return o.excute_after_next_reflow=[],o.content_height_=0,o.horizontalLayout_=!1,o.fixed_width=e.flyout.fixed_width,o.width_=o.fixed_width||0,o.set_auto_close(e.flyout.auto_close),o}return(0,i.__extends)(e,t),e.prototype.create_dom=function(e){var o=t.prototype.create_dom.call(this,e);return"number"==typeof this.fixed_width&&(o.addEventListener("mouseenter",function(){o.style.overflow="visible"}),o.addEventListener("mouseleave",function(){o.style.overflow="hidden"})),o},e.prototype.get_metrics=function(){if(this.is_visible()){var t,e=this.workspace_.get_canvas();if(!e)throw new Error("Flyout ws has not been inited.");try{t=e.getBBox()}catch(e){t={height:0,y:0,width:0,x:0}}var o=this.workspace_.get_scale();return{viewHeight:this.height_,viewWidth:this.width_,contentHeight:t.height*o+this.padding_top+this.padding_bottom,contentWidth:t.width*o,viewTop:-this.workspace_.scroll_xy[1],viewLeft:-this.workspace_.scroll_xy[0],contentTop:0,contentLeft:t.x,absoluteTop:2,absoluteLeft:0}}},e.prototype.layout_=function(t,e){for(var o,i=this,n=r.vec2.fromValues(this.padding_left,0),s=function(t){for(var e=t.get_descendants(),o=0;o<e.length;o++){var n=e[o];n.is_in_flyout=!0,n.render()}t.render();var r=t.get_svg_root();return i.add_block_listeners(r,t),t},_=0;_<t.length;_++){var a=t[_];if("block"==a.type&&a.block){var l=r.vec2.fromValues(n[0],n[1]);r.vec2.add(l,l,this.theme.renderer.BLOCK_LEFT_TOP),a.block.is_starting_block()&&r.vec2.add(l,l,[(null===(o=this.targetWorkspace_)||void 0===o?void 0:o.options.flyout.blocks.head_block_offset[0])||0,0]);var c=s(a.block);c.move_by(l);var h=c.get_height_width();if(a.inline){this.current_item_line={offset_left:n[0]+h.width,offset_right:this.padding_right,height:h.height};continue}n[1]+=h.height+e[_]}else"button"==a.type&&a.button&&this.button_layout(a.button,n,e[_])}this.content_height_=n[1]},e.prototype.button_layout=function(t,e,o){var i,n=this,r=e[0],s=e[1],_="absolute"!==t.position&&"fixed"!==t.position,a="center"===t.align||"right"===t.align,l=function(e){if(_&&!a)return{x:r,y:s};if("number"!=typeof e)return console.warn("Position of button "+t+" should be computed when reflow. "),{x:r,y:s};var o=0,i=e/n.workspace_.get_scale();if(void 0!==t.left?o=t.left:void 0!==t.right?o=i-t.right-t.width:"center"===t.align?o=(i-t.width)/2:"right"===t.align&&(o=i-n.padding_right-t.margin_right-t.width),_)return{x:o,y:s};var l=0;return void 0!==t.top?l=t.top:void 0!==t.bottom&&(l=("fixed"===t.position?n.height_/n.workspace_.get_scale():n.content_height_)-t.bottom-t.height),{x:o,y:l}};if(t.width_ratio)return this.excute_after_next_reflow.push(function(e){var o,i=e/n.workspace_.get_scale(),r=l(e),s=r.x,_=r.y,a=n.init_flyout_button(t,s,_,i*(t.width_ratio||1));"fixed"===t.position&&null!==(o=n.svg_group)&&void 0!==o&&o.appendChild(a)}),void(_&&(e[1]+=t.height+o));if(!_){var c=this.init_flyout_button(t);return this.excute_after_next_reflow.push(function(e){var o=l(e),i=o.x,n=o.y;t.move_to(i,n)}),void("fixed"===t.position&&(null===(i=this.svg_group)||void 0===i||i.appendChild(c)))}t.inline||this.current_item_line?function(){if(n.current_item_line||(n.current_item_line={offset_left:r,offset_right:n.padding_right,height:t.height}),"center"===t.align)n.init_flyout_button(t),n.excute_after_next_reflow.push(function(e){var o=e/n.workspace_.get_scale();t.move_to((o-t.width)/2,s)});else if("right"===t.align){n.init_flyout_button(t);var i=n.current_item_line.offset_right,_=t.width+t.margin_right;n.excute_after_next_reflow.push(function(e){var o=e/n.workspace_.get_scale();t.move_to(o-i-_,s)}),n.current_item_line.offset_right+=_}else n.init_flyout_button(t,n.current_item_line.offset_left,s),n.current_item_line.offset_left+=t.width+t.margin_right;n.current_item_line.height=Math.max(n.current_item_line.height,t.height),t.inline||(e[1]+=n.current_item_line.height+o,n.current_item_line=void 0)}():("center"===t.align||"right"===t.align?(this.init_flyout_button(t),this.excute_after_next_reflow.push(function(e){var o=l(e),i=o.x,n=o.y;t.move_to(i,n)})):this.init_flyout_button(t,r,s),e[1]+=t.height+o)},e.prototype.reflow_internal=function(t){var e=this;if(this.workspace_&&this.targetWorkspace_){var o=this.targetWorkspace_.options.flyout,i=o.max_width,n=o.min_width||0;if("number"==typeof this.fixed_width)n=this.fixed_width;else{for(var r=0;r<t.length;r++){var s=t[r],_=s.width;s.is_starting_block()&&(_+=this.targetWorkspace_.options.flyout.blocks.head_block_offset[0]),n=Math.max(n,_)}for(r=0;r<this.buttons_.length;r++){var a=this.buttons_[r];if("fixed"===a.position)break;n=Math.max(n,a.width)}var l=this.workspace_.get_scale();n+=this.padding_left+this.padding_right,n*=l,i&&(n=Math.min(n,i))}this.width_=n,this.excute_after_next_reflow.forEach(function(t){return t(e.width_)}),this.excute_after_next_reflow=[]}else console.error("Workspace has not been init.")},e.prototype.is_drag_toward_workspace=function(t){var e=t[0],o=t[1],i=Math.atan2(o,e)/Math.PI*180,n=this.drag_angle_range_;return i<n&&i>-n||i<-180+n||i>180-n},e.prototype.place_new_block=function(t,e){if(!this.targetWorkspace_)throw new Error("Trying to place block before setting target workspace. ");var o=t.get_svg_root();if(!o)throw ReferenceError("Origin block should have root svg.");var i=this.utils.get_injection_div_xy(o),n=this.xml.block_to_dom(t),s=this.xml.dom_to_block(n,this.targetWorkspace_),a=s.get_svg_root();if(null==a)throw new ReferenceError("Block should have svg root.");var l=this.utils.get_injection_div_xy(a);r.vec2.sub(l,i,l);var c=this.targetWorkspace_.get_scale();if(this.workspace_.get_scale()!==c&&e){var h=r.vec2.sub(e,e,(0,_.get_page_offset)(t.get_svg_root()));r.vec2.scale(h,h,this.workspace_.get_scale()-c),r.vec2.add(l,l,h)}return r.vec2.scale(l,l,1/c),s.move_by(l),s},e.prototype.wheel_=function(t){if(this.is_visible()){t.preventDefault(),t.stopPropagation();var e=t.deltaY;if(e&&this.scrollbar_){var o=this.get_metrics();if(o){var i=o.viewTop+e;this.scrollbar_.set(i)}else console.error("Cannot get metrics for wheel.")}}},e.prototype.set_metrics=function(t){if(null!=this.workspace_){var e=this.get_metrics();if(e){(0,a.is_number)(t.y)&&(this.workspace_.content_offset_by_view[1]=t.y,this.workspace_.scroll_xy[1]=-e.contentTop-t.y);var o=this.workspace_.scroll_xy[0],i=this.workspace_.scroll_xy[1];this.workspace_.translate(o,i)}}else console.error("Workspace not init.")},e.prototype.get_client_rect=function(){if(this.svg_group){var t=this.svg_group.getBoundingClientRect(),e=this.workspace_.get_options().delete_area_margin,o=t.left,i=t.top,n=t.width,r=t.height;return new l.Rect(o-e[3],i-e[0],n+e[1]+e[3],r+e[0]+e[2])}},e.prototype.reset_size=function(){this.width_=0},e.prototype.position=function(){if(null!=this.targetWorkspace_)if(this.svg_background_&&this.svg_group){var t=this.targetWorkspace_.get_metrics();if(t){if(this.height_=t.viewHeight,this.is_visible()){var e=this.compute_background_path(this.width_,this.height_);this.svg_background_.setAttribute("d",e)}else this.svg_group.style.overflow="hidden";var o=t.absoluteTop,i=t.absoluteLeft;this.toolboxPosition_===s.TOOLBOX_POSITION.RIGHT&&(i+=t.viewWidth,this.is_auto_close()&&this.is_visible()&&(i-=this.width_),i=Math.round(i+1)),this.toolboxPosition_===s.TOOLBOX_POSITION.LEFT&&(this.is_auto_close()&&this.is_visible()||(i-=this.width_),i=Math.round(i-1)),this.position_at(this.width_,this.height_,i,o)}}else console.error("Trying to position flyout before initialization. ");else console.error("Trying to position flyout before setting target workspace. ")},e.prototype.compute_background_path=function(t,e){var o=this.toolboxPosition_===s.TOOLBOX_POSITION.RIGHT,i=t-this.flyout_corner_radius,n=e-2*this.flyout_corner_radius,r=["M "+(o?t:0)+",0"];return r.push("h",o?""+-i:""+i),r.push("a",""+this.flyout_corner_radius,""+this.flyout_corner_radius,"0","0",o?"0":"1",o?""+-this.flyout_corner_radius:""+this.flyout_corner_radius,""+this.flyout_corner_radius),r.push("v",""+Math.max(0,n)),r.push("a",""+this.flyout_corner_radius,""+this.flyout_corner_radius,"0","0",o?"0":"1",o?""+this.flyout_corner_radius:""+-this.flyout_corner_radius,""+this.flyout_corner_radius),r.push("h",o?""+i:""+-i),r.push("z"),r.join(" ")},(0,i.__decorate)([(0,n.injectable)()],e)}(o(48183).m);e.VerticalFlyout=c},2109:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SliderController=void 0;var i=o(31635),n=o(71519),r=o(99186),s=o(58698),_=function(t){function e(){var e=t.call(this)||this;return e.base_color=new s.Color("#000000"),e.left_text="",e.right_text="",e.min=0,e.max=100,e.slider_width=140,e}return(0,i.__extends)(e,t),e.prototype.show=function(t,e){var o;if("number"==typeof t.min_&&"number"==typeof t.max_){var i=(null===(o=t.source_block)||void 0===o?void 0:o.is_shadow())?t.source_block.parent_block:t.source_block;i&&(this.slider||this.init(),this.owner=t,this.min=t.min_,this.max=t.max_,this.left_text=e.left_text,this.right_text=e.right_text,this.base_color=i.get_colour(),this.update_slider(),this.container.style.display="block",this.position())}},e.prototype.init=function(){this.slider=document.createElement("div"),this.slider.classList.add("blockly-controller","slider-controller"),this.slider.setAttribute("tabindex","-1"),this.left_text_ele=document.createElement("span"),this.left_text_ele.classList.add("slider-text"),this.left_text_ele.innerText=this.left_text,this.slider.appendChild(this.left_text_ele);var t=document.createElement("div");t.classList.add("slider-wrapper"),this.slider.appendChild(t),this.slider_rail=document.createElement("div"),this.slider_rail.classList.add("slider-rail"),this.slider_rail.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_rail),this.slider_track=document.createElement("div"),this.slider_track.classList.add("slider-track"),this.slider_track.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_track),this.slider_handle=document.createElement("div"),this.slider_handle.classList.add("slider-handle"),this.slider_handle.style.backgroundColor=this.base_color.toString(),t.appendChild(this.slider_handle),this.right_text_ele=document.createElement("span"),this.right_text_ele.classList.add("slider-text"),this.right_text_ele.innerText=this.right_text,this.slider.appendChild(this.right_text_ele),this.slider_handle.addEventListener("mousedown",this.bind_slider_event.bind(this)),t.addEventListener("mousedown",this.bind_slider_event.bind(this)),t.addEventListener("mouseup",this.set_slider_handle_position.bind(this)),this.container.appendChild(this.slider),document.body.appendChild(this.container)},e.prototype.update_slider=function(){if(this.slider_track&&this.slider_handle&&this.slider_rail&&this.left_text_ele&&this.right_text_ele&&this.owner){this.slider_handle.style.backgroundColor=this.base_color.toString();var t=new s.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.6});this.slider_track.style.backgroundColor=t.toString();var e=new s.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.2});this.slider_rail.style.backgroundColor=e.toString(),this.left_text_ele.innerText=this.left_text,this.right_text_ele.innerText=this.right_text;var o=this.field_to_slider_value(Number(this.owner.get_value()));this.set_slider_value(o)}},e.prototype.update_value=function(t){var e=this.field_to_slider_value(t);this.set_slider_value(e)},e.prototype.field_to_slider_value=function(t){var e=(0,r.clamp)(t,this.min,this.max),o=this.min<0?e-this.min:e,i=this.max-this.min;return Math.round(o/i*this.slider_width)},e.prototype.bind_slider_event=function(){var t=this;if(this.slider_rail){this.slider_rail_left=this.slider_rail.getBoundingClientRect().left;var e=this.move_slider_handle.bind(this);document.addEventListener("mousemove",e),document.addEventListener("mouseup",function o(){t.slider_rail_left=void 0,document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",o)})}},e.prototype.move_slider_handle=function(t){t.stopPropagation(),this.update_slider_and_field_value(t.clientX)},e.prototype.set_slider_handle_position=function(t){this.slider_rail&&(this.slider_rail_left=this.slider_rail.getBoundingClientRect().left,this.update_slider_and_field_value(t.clientX))},e.prototype.update_slider_and_field_value=function(t){var e,o;if(this.slider_rail_left){var i=(null===(o=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===o?void 0:o.get_workspace().get_scale())||1,n=(t-this.slider_rail_left)/i,s=(0,r.clamp)(n,0,this.slider_width),_=this.max-this.min,a=this.min+Math.round(s/this.slider_width*_);this.set_slider_value(s),this.owner&&(this.owner.set_html_input_value(a.toString()),this.owner.on_html_input_change())}},e.prototype.set_slider_value=function(t){this.slider_handle&&this.slider_track&&(this.slider_handle.style.left=t+"px",this.slider_track.style.width=t+"px")},(0,i.__decorate)([(0,n.injectable)()],e)}(o(30624).x);e.SliderController=_},3672:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.lazy_inject=e.bind_singleton=e.get_instance=void 0;var i=o(31635),n=o(71519),r=(0,i.__importDefault)(o(24033)),s=new n.Container;e.get_instance=function(){return s},e.bind_singleton=function(t,e){s.rebind(t).to(e).inSingletonScope()},e.lazy_inject=(0,r.default)(s).lazyInject},3986:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockSvg=void 0;var i=o(31635),n=o(77276),r=o(53307),s=o(32791),_=o(14289),a=o(18978),l=o(99186),c=o(15261),h=o(24042),d=o(58698),p=o(82390),u=o(14812),g=o(90185),v=o(58221),f=function(t){function e(e){var o,i=t.call(this,e.workspace)||this;i.element_type="block",i.type="",i.tooltip="",i.inputList=[],i.width=0,i.svg_path_width=0,i.first_row_width=0,i.first_row_height=0,i.event_initialized=!1,i.warning=void 0,i.output_connection=void 0,i.previous_connection=void 0,i.next_connection=void 0,i.is_shadow_=!1,i.child_blocks=[],i.collapsed_=!1,i.collapsed_dirty=!1,i._is_insertion_marker=!1,i.getInput=i.get_input,i.get_inherited_disabled=function(){for(var t=i.get_surround_parent();t;){if(t.disabled)return!0;t=t.get_surround_parent()}return!1},i.get_root_block=i.get_top_parent,i.getFieldValue=i.get_field_value,i.jsonInit=function(t){var e=(0,h.clone_deep)(t),o=e.type?'Block "'+e.type+'": ':"";(0,a.assert)(null==e.output||null==e.previousStatement,o+"Must not have both an output and a previousStatement."),null!=e.colour&&i.set_colour_from_json(e);for(var n=0,r=e["message"+n];null!=r;){var s=e["args"+n],_=e["lastDummyAlign"+n];i.interpolate_(r,s||[],_),r=e["message"+ ++n]}if(null!=e.inputsInline&&(i.inputs_inline=e.inputsInline),void 0!==e.output){var l=!0===e.output?void 0:e.output;i.set_output(!0,l,e.required_context)}if(void 0!==e.previousStatement&&i.set_previous_statement(!0),void 0!==e.nextStatement&&i.set_next_statement(!0),null!=e.enableContextMenu){var c=e.enableContextMenu;i.enable_context_menu=!!c}if(null!=e.helpUrl){c=e.helpUrl;var d=i.utils.replace_message_references(c);i.set_help_url(d)}if((0,h.is_string)(e.extensions)&&console.error('\n        JSON attribute "extensions" should be an array of strings.\n        Found raw string in JSON for "'+e.type+'" block.\n      '),null!=e.tooltip&&(c=e.tooltip,d=i.utils.replace_message_references(c),i.set_tooltip(d)),null!=e.mutator&&i.extensions.apply_mutator(e.mutator,i),Array.isArray(e.extensions))for(var p=e.extensions,u=0;u<p.length;++u)i.extensions.apply(p[u],i);null!=e.outputShape&&i.set_output_shape(e.outputShape),null!=e.category&&i.set_category(e.category),e.context_menu&&(i.context_menu_options_setting=e.context_menu)},i.appendDummyInput=i.append_dummy_input,i.context_menu_options_setting=i.workspace.options.context_menu.block,i.prevent_disable_style_change=!1,i.is_glowing_stack=!1,i.is_flashing=!1,i.removeInput=i.remove_input,i.visibility_=s.BlockVisibility.VISIBLE,i.visibility_for_undo=void 0,i.connectable_=!0,i.opacity=1,i.category_=void 0,i.output_shape=void 0,i.help_url="",i.colour_=i.theme.block_color.DEFAULT.fill,i.border_colour=i.theme.block_color.DEFAULT.border;var n=e.workspace,r=e.prototype_name;if(r&&null!==(o=i.svg_group)&&void 0!==o&&o.classList.add(r),i.id=e.id&&!n.get_block_by_id(e.id)?e.id:(0,l.gen_uid)(),i._is_insertion_marker=!!e.is_insertion_marker,i.enable_context_menu=!0,r){i.type=r;var _=i.Blink.Blocks[r];if(null==_)throw new Error("Error: Unknown block type "+r+".");Object.assign(i,_)}i.inputs_inline_default=i.inputs_inline,n.blockDB_.set(i.id,i),n.add_top_block(i);var d=void 0;return i.events.is_enabled()&&(d=i.create_event_factory({block:i})),i.svg_path=(0,c.create_svg_element)("path",{class:"blocklyPath"},i.svg_group),i.rendered=!1,i.Blink.mainWorkspace.options.tooltip&&(i.svg_path.tooltip=function(){return(0,h.is_func)(i.tooltip)?i.tooltip():i.tooltip},i.Blink.tooltip.bind_mouse_event(i.svg_path)),(0,h.is_func)(i.init)&&i.init(),(0,h.is_func)(i.onchange)&&i.set_on_change(i.onchange),d&&i.events.fire(d),i}return(0,i.__extends)(e,t),Object.defineProperty(e.prototype,"onchange",{get:function(){return this._onchange},set:function(t){this._onchange=null==t?void 0:t.bind(this)},enumerable:!1,configurable:!0}),e.prototype.render=function(t){console.warn("\n      why: opt_bubble "+t+"\n    ")},e.prototype.set_warning_text=function(t,e){console.error("Warning is deprecated "+t+" "+e)},e.prototype.get_previous_block=function(){return this.previous_connection&&this.previous_connection.targetBlock()},e.prototype.is_starting_block=function(){return null==this.output_connection&&null==this.previous_connection&&"factory_base"!==this.type},e.prototype.is_ending_block=function(){return null==this.next_connection&&null==this.output_connection&&null!=this.previous_connection},e.prototype.is_output_block=function(){return!(this.previous_connection||this.next_connection||this.is_shadow()||!this.output_connection)},e.prototype.is_include_special_input=function(){var t=this;return _.SPECIAL_CONNECTION_INPUT_NAME.some(function(e){return!!t.get_input(e)})},e.prototype.is_wrap_shape=function(){return!this.is_starting_block()&&this.inputList.some(function(t){return t.type===s.InputType.STATEMENT})},e.prototype.set_shadow=function(t){this.is_shadow_=t},e.prototype.is_shadow=function(){return this.is_shadow_},e.prototype.is_deletable=function(){return this.deletable_&&!this.is_shadow_&&!(this.workspace&&this.workspace.get_options().readOnly)},e.prototype.is_movable=function(){return this.movable_&&!this.is_shadow_},e.prototype.get_children=function(t){if(!t)return this.child_blocks;for(var e=[],o=0;o<this.inputList.length;o++){var i=this.inputList[o];if(i.connection){var n=i.connection.targetBlock();n&&e.push(n)}}var r=this.get_next_block();return r&&e.push(r),e},e.prototype.is_collapsed=function(){return this.collapsed_},e.prototype.set_collapsed=function(t,e){void 0===e&&(e=!1);var o=this.is_collapsed();if(o!=t||e)if(this.collapsed_dirty=!0,this.collapsed_=t,this.events.is_enabled()&&o!==t&&this.events.fire(this.change_event_factory("collapsed",{block:this,old_value:o,new_value:t})),e)for(var i=this.get_top_parent().get_descendants(!0,!0),n=i.length-1;n>=0;n--)i[n].update_collapsed(e);else this.rendered&&this.update_collapsed()},e.prototype.hide_into_group=function(t,e){var o,i,n=this;void 0===e&&(e={}),this.events.disable();var r=(null===(i=null===(o=this.workspace.options.block_group)||void 0===o?void 0:o.get_default_name)||void 0===i?void 0:i.bind(this,this))||this.to_string.bind(this),s=this.block_group_factory({workspace:this.workspace,origin_block:this,group_name:t||r(),id:e.id,on_release:function(){(0,a.assert)(n.parent_group),n.events.fire(n.change_event_factory("group_block",{block:n,old_value:[n.parent_group.id,n.parent_group.group_name,n.parent_group.group_stop_at||""],new_value:void 0})),n.parent_group=void 0},origin_xy:e.origin_xy,group_stop_at:e.group_stop_at});s.init_svg(),s.render(),this.parent_group=s,this.events.enable(),this.events.is_enabled()&&this.events.fire(this.change_event_factory("group_block",{block:this,old_value:void 0,new_value:[this.parent_group.id,this.parent_group.group_name,this.parent_group.group_stop_at||""]}))},e.prototype.update_collapsed=function(t){if(void 0===t&&(t=!1),this.collapsed_dirty||t){var e=this.rendered;this.rendered=!1;for(var o=0;o<this.inputList.length;o++)this.inputList[o].set_visible(!this.collapsed_);if(_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&this.next_connection){this.collapsed_?this.next_connection.hide_all():this.next_connection.unhide_all();var i=this.next_connection.targetBlock();i&&i.set_visible_as_child(!this.collapsed_)}if(this.comment&&this.set_comment_visible(!this.collapsed_),this.collapsed_){this.warning&&this.warning.set_expanded(!1),t&&this.remove_input(_.COLLAPSED_INPUT_NAME,!0);var n=this.to_string(this.theme.blink_params.COLLAPSE_CHARS);this.append_dummy_input(_.COLLAPSED_INPUT_NAME).append_field(n).init()}else this.remove_input(_.COLLAPSED_INPUT_NAME,!0);this.rendered=e,(e||t)&&this.render(),this.collapsed_dirty=!1}},e.prototype.set_comment_visible=function(t){this.comment&&(t&&!this.is_collapsed()?(this.comment.get_svg_root().style.display="block",this.comment.reposition(),this.comment.bring_to_front()):this.comment.get_svg_root().style.display="none")},e.prototype.set_visible_as_child=function(t){this.rendered=t,this.get_svg_root().style.display=t?"block":"none",this.get_descendants(!1,!0).forEach(function(e){var o=t&&!e.is_collapsed()&&!e.get_collapsed_surround_parent();e.set_comment_visible(o)})},e.prototype.get_collapsed_surround_parent=function(){var t=this.get_surround_parent();if(t)return t.is_collapsed()?t:t.get_collapsed_surround_parent();for(var e=this.get_parent();e&&(!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(e.type)||!e.is_collapsed());)e=e.get_parent();return e},e.prototype.is_insertion_marker=function(){return this._is_insertion_marker},e.prototype.set_on_change=function(t){this.onchange&&this.workspace&&this.workspace.remove_change_listener(this.onchange),this.onchange=t,this.workspace.add_change_listener(this.onchange)},e.prototype.set_on_block_change=function(t){var e=this;this.is_in_flyout||this.is_insertion_marker()||this.workspace.add_change_listener(function(o){o.type!==s.BlockEventType.CREATE&&o.type!==s.BlockEventType.CHANGE&&o.type!==s.BlockEventType.DELETE||e.id===o.get_block_id()&&t.call(e,o)})},e.prototype.append_block_input=function(t,e){var o=this.generate_block(t),i=e.connection;if(i){var n=o.output_connection||o.previous_connection;n&&n.connect(i),i.set_hidden(!0)}return o},e.prototype.generate_block=function(t){var e=this.utils.string_to_dom(t);return this.xml.dom_to_block(e,this.workspace)},e.prototype.interpolate_=function(t,e,o){for(var i=this.utils.tokenize_interpolation(t),n=[],r=0,s=[],_=0;_<i.length;_++){var a=i[_];if("number"==typeof a){if(a<=0||a>e.length)throw new Error('Block "'+this.type+'": Message index %'+a+" out of range.");if(n[a])throw new Error('Block "'+this.type+'": Message index %'+a+" duplicated.");n[a]=!0,r++,s.push(e[a-1])}else(a=a.trim())&&s.push(a)}if(r!=e.length)throw new Error('Block "'+this.type+'": Message does not reference all '+e.length+" arg(s). Massage: "+t);var l=s[s.length-1];if(s.length&&("string"==typeof l||l.type.startsWith("field_"))){var c={type:"input_dummy",name:""};o&&Object.assign(c,{align:o}),s.push(c)}var h=[];for(_=0;_<s.length;_++){var d=s[_];if("string"!=typeof d){var p=void 0,u=void 0;if("string"!=typeof d)if(d.custom)p=this.init_custom_field(d),h.push([p,d.name]);else{switch(d.type){case"input_shadow":u=this.append_shadow_input_json(d.name,d.field_type,d.default_text);break;case"input_value":u=this.append_value_input(d.name,void 0,void 0,d.default_shadow);break;case"input_statement":u=this.append_statement_input(d.name,void 0,d.provided_context);break;case"input_dummy":u=this.append_dummy_input(d.name);break;case"field_label":p=this.field_label_factory({text:this.utils.replace_message_references(d.text),opt_class:d.class});break;case"field_label_serializable":p=this.field_label_serializable_factory({text:this.utils.replace_message_references(d.text),opt_class:d.class});break;case"field_input":p=this.new_field_text_input_from_json(d);break;case"field_colour":p=this.field_colour_factory({colour:d.colour,opt_validator:d.validator});break;case"field_dropdown":p=this.field_dropdown_factory({menu_generator:d.options,opt_onchange:d.onchange,selected_index:d.selected_index,opt_validator:d.validator});break;case"field_dropdown_advanced":p=this.field_dropdown_factory({menu_generator:[],opt_onchange:d.onchange,selected_index:d.selected_index,opt_validator:d.validator,menu_generator_advanced:d.advanced_options});break;case"field_image":case"field_button":var g=this.parse_field_image_param_from_json(d),v=g.src,f=g.width,b=g.height,m=g.alt,y=g.callback,k=g.circle;p="field_image"===d.type?this.field_image_factory({src:v,width:f,height:b,opt_alt:m}):this.field_button_factory({src:v,width:f,height:b,opt_alt:m,opt_callback:y,has_circle:k});break;case"field_icon":if(!d.is_head)break;p=this.field_icon_factory({src:d.src,opt_alt:d.alt,opt_is_head:d.is_head});break;case"mutation_add_button":p=this.mutation_add_factory(void 0);break;case"mutation_remove_button":p=this.mutation_remove_factory(void 0);break;case"field_number":p=this.field_number_factory({opt_value:d.value,opt_min:d.min,opt_max:d.max,opt_precision:d.precision,opt_controller:d.controller});break;case"field_textdropdown":p=this.field_text_dropdown_factory(d.options);break;case"field_multiline_input":p=this.field_multiline_input(d);break;case"field_default_value":p=this.field_default_value(d);break;default:p=this.init_custom_field(d)}if(p)void 0!==d.margin_left&&(p.margin_left=d.margin_left),h.push([p,d.name]);else if(u){d.check&&u.set_check(d.check),void 0!==d.margin_left&&(u.margin_left=d.margin_left);for(var w=0;w<h.length;w++)u.append_field(h[w][0],h[w][1]);h.length=0}}else p=this.field_label_factory({text:d})}else h.push([d,void 0])}},e.prototype.init_custom_field=function(t){var e=this.registry.field.from_json(t);if(e)return e;var o=t.type;if(o){var i=o.split("_").map(function(t){return t[0].toUpperCase()+t.slice(1)}).join("");window.Blockly[i]&&(e=new window.Blockly[i](t))}if(!e)throw new ReferenceError("Trying to init an undefined type of field");return e},e.prototype.get_input=function(t){for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(o.name==t)return o}},e.prototype.set_disabled=function(t){var e=void 0;this.disabled!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("disabled",{block:this,old_value:this.disabled,new_value:t})),this.disabled=t),this.is_rendered()&&this.update_disabled(),e&&this.events.fire(e)},e.prototype.set_editable=function(t){this.editable_=t;for(var e=0;e<this.inputList.length;e++)for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++)o.fieldRow[i].update_editable()},e.prototype.set_connections_hidden=function(t){if(!t&&this.is_collapsed())this.output_connection&&this.output_connection.set_hidden(t),this.previous_connection&&this.previous_connection.set_hidden(t),this.next_connection&&!_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)&&(this.next_connection.set_hidden(t),(i=this.next_connection.targetBlock())&&i.set_connections_hidden(t));else for(var e=this.get_connections(!0),o=0;o<e.length;o++){var i,n=e[o];n.set_hidden(t),n.is_superior()&&(i=n.targetBlock())&&i.set_connections_hidden(t)}},e.prototype.get_surround_parent=function(){var t,e=this;do{if(t=e,!(e=e.get_parent()||e.parent_group))return}while(e.get_next_block()==t);return e},e.prototype.get_top_group=function(){for(var t=this,e=void 0;t;)t.parent_group&&(t=e=t.parent_group),t=t.get_parent();return e},e.prototype.get_top_parent=function(){for(var t=this;t.parent_block;)t=t.parent_block;return t},e.prototype.get_connections=function(t){var e=[];if((t||this.rendered)&&(this.output_connection&&e.push(this.output_connection),this.previous_connection&&e.push(this.previous_connection),this.next_connection&&e.push(this.next_connection),t||!this.is_collapsed()))for(var o=0;o<this.inputList.length;o++){var i=this.inputList[o];i.connection&&e.push(i.connection)}return e},e.prototype.get_full_next_connection=function(){if(this.next_connection)return this.next_connection;if(this.is_starting_block())for(var t=0;t<this.inputList.length;t++){var e=this.inputList[t];if(e.type===s.InputType.STATEMENT)return e.connection}},e.prototype.last_connection_in_stack=function(){for(var t=this.get_full_next_connection();t;){var e=t.targetBlock();if(!e)return t;t=e.next_connection}},e.prototype.get_input_with_connection=function(t){for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(o.connection==t)return o}},e.prototype.get_first_statement_connection=function(){for(var t=0;t<this.inputList.length;t++){var e=this.inputList[t];if(e.connection&&e.connection.type==s.CONNECTION_TYPE.NEXT_STATEMENT)return e.connection}},e.prototype.get_matching_connection=function(t,e){var o=this.get_connections(!0),i=t.get_connections(!0);if(!this.is_insertion_marker()&&o.length!=i.length)throw new Error("Connection lists did not match in length.");for(var n=0;n<i.length;n++)if(i[n]==e)return o[n]},e.prototype.unplug=function(t){if(this.output_connection)this.output_connection.is_connected()&&this.output_connection.disconnect();else if(this.previous_connection){var e=void 0;this.previous_connection.is_connected()&&(e=this.previous_connection.get_targe_connection(),this.previous_connection.disconnect());var o=this.get_next_block();if(t&&o){var i=this.next_connection;if(!i)return;var n=i.get_targe_connection();if(!n)return;n.disconnect(),e&&e.check_type(n)&&e.connect(n)}}},e.prototype.get_input_with_block=function(t){for(var e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(o.connection&&o.connection.targetBlock()==t)return o}},e.prototype.get_input_target_block=function(t){var e=this.get_input(t);return e&&e.connection&&e.connection.targetBlock()},e.prototype.get_field_value=function(t){var e=this.get_field(t);if(e)return e.get_value()},e.prototype.get_shadow_field=function(t,e){void 0===e&&(e="NUM");var o=this.get_input(t);if(o&&o.connection){var i=o.connection.target_connection;if(i)return i.source_block.get_field(e)}},e.prototype.get_shadow_field_value=function(t,e){void 0===e&&(e="NUM");var o=this.get_shadow_field(t,e);if(o)return o.get_value()},e.prototype.set_field_value=function(t,e){var o=this.get_field(e);if(!o)throw new ReferenceError("Field "+e+" not found.");o.set_value(t)},e.prototype.get_input_with_field=function(t){for(var e=0;e<this.inputList.length;e++)for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++)if(o.fieldRow[i].name===t)return o},e.prototype.set_next_statement=function(t,e){t?(null==e&&(e=void 0),this.next_connection||(this.next_connection=this.make_connection(s.CONNECTION_TYPE.NEXT_STATEMENT)),this.next_connection.set_check(e)):this.next_connection&&((0,a.assert)(!this.next_connection.is_connected(),"Must disconnect next statement before removing connection."),this.next_connection.dispose(),this.next_connection=void 0)},e.prototype.set_previous_statement=function(t,e){t?(null==e&&(e=void 0),this.previous_connection||((0,a.assert)(!this.output_connection,"Remove output connection prior to adding previous connection."),this.previous_connection=this.make_connection(s.CONNECTION_TYPE.PREVIOUS_STATEMENT)),this.previous_connection.set_check(e)):this.previous_connection&&((0,a.assert)(!this.previous_connection.is_connected(),"Must disconnect previous statement before removing connection."),this.previous_connection.dispose(),this.previous_connection=void 0)},e.prototype.set_output=function(t,e,o){if(t){if(!this.output_connection){if(null!=this.previous_connection)throw new Error("Remove previous connection prior to adding output connection.");this.output_connection=this.make_connection(s.CONNECTION_TYPE.OUTPUT_VALUE,o)}var i=(0,h.is_array)(e)&&e.indexOf("Any")>-1||"Any"===e;e&&!i&&this.output_connection.set_check(e)}else if(this.output_connection){if(this.output_connection.is_connected())throw new Error("Must disconnect output value before removing connection.");this.output_connection.dispose(),this.output_connection=void 0}},e.prototype.append_value_input=function(t,e,o,i){var n=this.append_input(s.InputType.VALUE,t,e,o);return"string"==typeof i?n.connection.set_shadow_from_string(i):n.connection.set_shadow_dom(i),n},e.prototype.respawn_all_shadows=function(){var t,e;null!==(t=this.previous_connection)&&void 0!==t&&t.respawn_shadow(),null!==(e=this.next_connection)&&void 0!==e&&e.respawn_shadow(),this.inputList.forEach(function(t){var e;null!==(e=t.connection)&&void 0!==e&&e.respawn_shadow()})},e.prototype.append_statement_input=function(t,e,o){return this.append_input(s.InputType.STATEMENT,t,e,o)},e.prototype.append_dummy_input=function(t,e){return this.append_input(s.InputType.DUMMY,t||"",e)},e.prototype.append_shadow_input=function(t,e,o){return this.append_shadow(s.InputType.VALUE,t,e,(0,l.gen_uid)(),o)},e.prototype.append_math_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.math,e)},e.prototype.append_logic_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.logic,e)},e.prototype.append_text_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.text,e)},e.prototype.append_multiline_text_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.multiline_text,e)},e.prototype.append_default_value_shadow=function(t,e){return this.append_shadow_input(t,this.Blink.Blocks.SHADOW.default_value,e)},e.prototype.append_shadow_input_json=function(t,e,o,i){var n={text:'<shadow type="text"><field name="TEXT">'+(o=null==o?"":o)+"</field></shadow>",math:'<shadow type="math_number"><field name="NUM">'+o+"</field></shadow>",bool:'<empty type="logic_empty"><field name="BOOL"></field></empty>'};return this.append_shadow(s.InputType.VALUE,t,n[e],void 0,i)},e.prototype.append_input=function(t,e,o,i){var n=t===s.InputType.DUMMY?void 0:this.make_connection(t,i),r=this.input_factory({type:t,name:e,block:this,connection:n});return void 0===o?this.inputList.push(r):(o="number"==typeof o?o:this.get_input_index(o),this.inputList.splice(o,0,r)),r},e.prototype.get_descendants=function(t,e){void 0===t&&(t=!1),void 0===e&&(e=!1);for(var o=[this],i=this.get_children(t),n=0;n<i.length;n++){var r=i[n];e&&r.is_shadow()||o.push.apply(o,r.get_descendants(t,e))}return o},e.prototype.get_descendant_ids=function(){for(var t=[this.id],e=this.get_descendants(),o=0;o<e.length;o++){var i=e[o];t[o]=i.id}return t},e.prototype.get_nested_block=function(){for(var t=[],e=0;e<this.inputList.length;e++){var o=this.inputList[e];if(!(o.name in _.SPECIAL_CONNECTION_INPUT_NAME)&&o.connection&&o.connection.type===s.CONNECTION_TYPE.INPUT_VALUE){var i=o.connection.targetBlock();i&&t.push(i)}}return t},e.prototype.get_all_nested_blocks=function(){for(var t=[this],e=this.get_nested_block(),o=0;o<e.length;o++){var i=e[o];t.push.apply(t,i.get_all_nested_blocks())}return t},e.prototype.get_next_block=function(){return this.next_connection&&this.next_connection.targetBlock()},e.prototype.get_full_next_block=function(){var t=this.get_full_next_connection();return t&&t.targetBlock()},e.prototype.get_field=function(t){for(var e=0;e<this.inputList.length;e++)for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++){var n=o.fieldRow[i];if(n.name===t)return n}},e.prototype.get_field_icon=function(){for(var t=0;t<this.inputList.length;t++)for(var e=this.inputList[t],o=0;o<e.fieldRow.length;o++){var i=e.fieldRow[o];if("FieldIcon"===i.field_type)return i}},e.prototype.set_tooltip=function(t){this.tooltip=t},e.prototype.new_field_text_input_from_json=function(t){var e=this.utils.replace_message_references(t.text||""),o=this.field_text_input_factory({text:e,opt_validator:t.validator});return"boolean"==typeof t.spellcheck&&o.set_spell_check(t.spellcheck),o},e.prototype.parse_field_image_param_from_json=function(t){return{src:this.utils.replace_message_references(t.src),width:Number(this.utils.replace_message_references(""+t.width)),height:Number(this.utils.replace_message_references(""+t.height)),alt:this.utils.replace_message_references(t.alt||""),callback:"field_button"===t.type?t.callback:void 0,circle:"field_button"===t.type?t.circle:void 0}},e.prototype.mixin=function(t,e){if(!e){var o=[];for(var i in t)null!=this[i]&&o.push(i);if(o.length)throw new Error("Mixin will overwrite block members: "+JSON.stringify(o))}Object.assign(this,t)},e.prototype.move_input_before=function(t,e){if(t!=e){for(var o=-1,i=e?-1:this.inputList.length,n=0;n<this.inputList.length;n++){var r=this.inputList[n];if(r.name==t){if(o=n,-1!=i)break}else if(e&&r.name==e&&(i=n,-1!=o))break}-1==o&&console.warn("Named input "+t+" not found."),-1==i&&console.warn("Reference input "+i+" not found."),this.move_numbered_input_before(o,i)}},e.prototype.to_string=function(t,e){void 0===e&&(e="...");var o=[],i=this.get_input(_.COLLAPSED_INPUT_NAME);if(i&&this.collapsed_)return i.fieldRow[0].get_text();for(var n=0;n<this.inputList.length;n++){for(var r,s=this.inputList[n],a=0;a<s.fieldRow.length;a++){var l=s.fieldRow[a];(0,h.is_field_dropdown)(l)&&!l.get_value()?o.push(e):o.push(l.get_text())}s.connection&&((r=s.connection.targetBlock())?o.push(r.to_string(void 0,e)):o.push(e))}"start_on_click"===this.type&&(r=this.get_next_block())&&o.push(r.to_string(void 0,e));var c=o.join(" ").trim()||" ";return t&&(c=""+c.substring(0,t-3)+e),c},Object.defineProperty(e.prototype,"use_drag_surface",{get:function(){var t=this.workspace.current_gesture_;return t&&t.is_start_from_flyout()||!this.workspace.degrade_translate?!!this.workspace.get_block_drag_surface():this.workspace.blockDB_.size<this.workspace.degrade_translate},enumerable:!1,configurable:!0}),e.prototype.move_by=function(t){var e;this.events.is_enabled()&&!this.is_shadow()&&(e=this.move_event_factory({block:this}));var o=n.vec2.create();this.is_shadow()||(o=this.get_relative_to_surface_xy()),this.translate(n.vec2.add(o,o,t)),this.move_connections(t),e&&e.record_new(),this.rendered&&this.workspace.resize_contents(),e&&this.events.fire(e)},e.prototype.append_shadow=function(t,e,o,i,n){this.rendered,this.events.disable();var r=this.make_connection(t),s=this.input_factory({type:t,name:e,block:this,connection:r}),_=this.utils.string_to_dom(o);r.set_shadow_dom(_);var l=this.xml.dom_to_block_headless(_,this.workspace,i);if(l.output_connection?r.connect(l.output_connection):l.previous_connection?r.connect(l.previous_connection):(0,a.fail)("Child block does not have output or previous statement."),void 0===n?this.inputList.push(s):(n="number"==typeof n?n:this.get_input_index(n),this.inputList.splice(n,0,s)),!this.is_insertion_marker()&&this.rendered)for(var c=this.get_descendants(),h=0;h<c.length;h++)c[h].is_insertion_marker()||(c[h].init_svg(),c[h].render(!1));return this.update_disabled(),this.workspace.resize_contents(),this.events.enable(),s},e.prototype.move_connections=function(t){for(var e=this.get_connections(!0),o=0;o<e.length;o++)e[o].move_by(t);var i=this.get_icons();for(o=0;o<i.length;o++)i[o].reposition();for(o=0;o<this.child_blocks.length;o++)this.child_blocks[o].move_connections(t)},e.prototype.dispose=function(t,e){var o,i;if(null!==(o=this.parent_group)&&void 0!==o&&o.dispose(),this.workspace){var n;this.utils.start_text_cache();var r=this.workspace;this.runtime_data.selected===this&&(this.unselect(),this.workspace.cancel_current_gesture()),this.context_menu.current_block==this&&this.context_menu.hide(),e&&this.rendered&&(this.unplug(t),this.block_animations.dispose_ui_effect(this)),this.rendered=!1,this.onchange&&this.workspace.remove_change_listener(this.onchange),this.unplug(t),this.events.is_enabled()&&(n=this.delete_event_factory({block:this})),this.events.disable();try{for(var s=this.get_icons(),_=0;_<s.length;_++)s[_].dispose()}finally{this.events.enable()}this.events.disable();try{for(this.workspace&&(this.workspace.remove_top_block(this),this.workspace.blockDB_.delete(this.id),this.workspace=void 0),this.runtime_data.selected==this&&(this.runtime_data.selected=void 0),_=this.child_blocks.length-1;_>=0;_--)this.child_blocks[_].dispose(!1);for(_=0;_<this.inputList.length;_++)this.inputList[_].dispose();this.inputList.length=0;var a=this.get_connections(!0);for(_=0;_<a.length;_++){var l=a[_];l.is_connected()&&l.disconnect(),a[_].dispose()}}finally{this.events.enable()}(null===(i=this.Blink.tooltip)||void 0===i?void 0:i.get_element())===this.svg_path&&this.Blink.tooltip.hide(),this.is_shadow()||this.is_insertion_marker()||r.resize_contents(),(0,c.remove_children)(this.svg_group),delete this.svg_path,(0,c.remove_node)(this.svg_group),this.utils.stop_text_cache(),n&&this.events.fire(n)}},e.prototype.detach=function(){if(!this.workspace)throw new Error("Trying to detach a block without workspace.");this.events.disable();try{for(var t=this.get_icons(),e=0;e<t.length;e++)t[e].dispose();for(this.onchange&&this.workspace.remove_change_listener(this.onchange),this.workspace.blockDB_.delete(this.id),this.workspace.get_top_blocks(!1).includes(this)&&(this.workspace.remove_top_block(this),this.workspace=void 0,this.svg_group&&(0,c.remove_node)(this.svg_group)),e=this.child_blocks.length-1;e>=0;e--)this.child_blocks[e].detach()}finally{this.events.enable()}},e.prototype.retach=function(t){t.add_top_block(this),this.set_workspace(t),this.init_svg();for(var e=this.get_descendants(),o=e.length-1;o>=0;o--){t.blockDB_.set(e[o].id,e[o]);var i=e[o].get_relative_to_surface_xy();e[o].move_by(n.vec2.negate(i,i))}},e.prototype.make_connection=function(t,e){return this.connection_factory({source:this,type:t,context:e})},e.prototype.show_context_menu=function(t){var e=this;if(!this.workspace.get_options().readOnly&&this.context_menu&&this.is_deletable()&&this.is_movable()&&!this.is_in_flyout){var o=[];this.context_menu_options_setting.forEach(function(t){if("number"==typeof t)switch(t){case s.BlockOptionType.COPY:return e.options_add_copy(o);case s.BlockOptionType.COPY_AND_PASTE:return e.options_add_duplicate(o);case s.BlockOptionType.ADD_COMMENT:return e.options_add_comments(o);case s.BlockOptionType.COLLAPSE:return e.options_add_collapse(o);case s.BlockOptionType.DELETE:return e.options_add_delete_blocks(o);case s.BlockOptionType.SET_GROUP:return void(e.workspace.options.block_group&&e.options_add_set_blocks_group(o));case s.BlockOptionType.VISIBILITY_CHANGE:return e.add_visibility_change_option(o);default:return console.warn("Undefined block menu option: "+t)}var i=t(e);i&&o.push(i)}),this.context_menu.current_block=this,this.context_menu.show(t,{source:"block",options:o},this.RTL)}},e.prototype.options_add_copy=function(t){var e=this,o={text:this.Msg.DUPLICATE_BLOCK,name:"copy",area:"block",enabled:!0,callback:function(){e.runtime_data.clipboard.copy(e)}};this.get_descendants().length>this.workspace.remaining_capacity()&&(o.enabled=!1),t.push(o)},e.prototype.options_add_duplicate=function(t){var e=this;t.push({text:this.Msg.COPY_AND_PASTE,name:"copy_and_paste",enabled:!0,callback:function(){e.runtime_data.clipboard.duplicate(e)}})},e.prototype.options_add_comments=function(t){var e,o=this;this.is_editable()&&!this.is_collapsed()&&this.workspace.get_options().comments&&"block_group"!==this.element_type&&(e=this.comment?{enabled:!p.is.ie(),text:this.Msg.REMOVE_COMMENT,name:"remove_comment",callback:function(){o.comment&&o.set_comment_text(void 0)}}:{enabled:!p.is.ie(),text:this.Msg.ADD_COMMENT,name:"add_comment",callback:function(){return(0,i.__awaiter)(o,void 0,void 0,function(){var t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return"simplified"!==this.workspace.get_options().comment_type?[3,2]:[4,this.workspace.show_external_comment_editor("")];case 1:return null!=(t=e.sent())&&(this.set_comment_text(t),(0,a.assert)(this.comment),this.comment.init_svg(),this.comment.set_expanded(!0)),[2];case 2:return this.set_comment_text(""),(0,a.assert)(this.comment),this.comment.init_svg(),this.comment.focus(),[2]}})})}},t.push(e))},e.prototype.options_add_collapse=function(t){var e=this;if(this.workspace.get_options().collapse)if(this.is_collapsed()){var o={text:this.Msg.EXPAND_BLOCK,name:"expand",enabled:!0,callback:function(){e.set_collapsed(!1)}};t.push(o)}else{var i={enabled:!0,text:this.Msg.COLLAPSE_BLOCK,name:"collapse",callback:function(){e.set_collapsed(!0)}};t.push(i)}},e.prototype.options_add_delete_blocks=function(t){var e=this,o={text:this.Msg.DELETE_BLOCK,name:"delete",area:"block",enabled:!0,callback:function(){var t=e.events.get_group();e.events.set_group(t||!0),e.dispose(!0,!0),e.events.set_group(t)}};t.push(o)},e.prototype.options_add_set_blocks_group=function(t){var e=this,o={text:this.utils.replace_message_references("%{BKY_BLOCK_GROUP}"),name:"block_group",area:"block",enabled:!0,callback:function(){e.hide_into_group()}};t.push(o)},e.prototype.add_visibility_change_option=function(t){var e=this,o=this.get_root_block().get_visibility()===s.BlockVisibility.VISIBLE;t.push({text:this.utils.replace_message_references("%{BKY_"+(o?"HIDE":"SHOW")+"_BLOCK_STACK}"),name:"change_visibility",enabled:!0,callback:function(){e.set_chunk_visibility(o?s.BlockVisibility.TRANSLUCENT:s.BlockVisibility.VISIBLE),e.update_chunk_visibility()}})},e.prototype.set_comment_text=function(t,e,o){(0,h.is_string)(t)&&(this.comment||(this.comment=this.workspace_comment_factory({workspace:this.workspace,type:this.workspace.options.comment_type,parent_block:this,opt_id:e,position:o})),this.comment.set_text(t)),!(0,h.is_string)(t)&&this.comment&&(this.comment.dispose(),this.comment=void 0)},e.prototype.get_comment_text=function(){if(this.comment){var t=this.comment.get_text();return(0,g.string_trim)(t)}return""},e.prototype.add_hover=function(){this.svg_group.setAttribute("filter","url(#"+v.FILTER.DRAG_SHADOW+")")},e.prototype.remove_hover=function(){this.svg_group.removeAttribute("filter")},e.prototype.unselect=function(){this.runtime_data.selected==this&&(this.runtime_data.selected=void 0,this.remove_select(),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,block_id:this.id})))},e.prototype.init_svg=function(){if(null==this.svg_group)throw new ReferenceError("Cannot init svg to block without svg group.");if(!this._is_insertion_marker){for(var t=0;t<this.inputList.length;t++)this.inputList[t].init();this.warning&&this.warning.create_icon()}this.update_colour(),this.update_movable(),this.init_events();var e=this.get_svg_root(),o=this.workspace.get_canvas();if((null==e||null==e.parentNode)&&null!=o){if(this.is_insertion_marker()&&this.output_connection)return;o.appendChild(this.svg_group)}},e.prototype.init_events=function(){var e=this;if(t.prototype.init_events.call(this),this.svg_path){this.is_in_flyout||this.is_shadow()||!this.is_output_block()||(this.svg_group.addEventListener("mouseover",function(t){var o;t.stopPropagation(),!(0,c.is_inside_shadow)(t.relatedTarget)&&(null===(o=e.output_connection)||void 0===o?void 0:o.is_connected())&&e.svg_group.classList.add("output-block-hover")}),this.svg_group.addEventListener("mouseout",function(t){t.stopPropagation(),(0,c.is_inside_shadow)(t.relatedTarget)||e.svg_group.classList.remove("output-block-hover")})),this.is_in_flyout||!this.is_wrap_shape()&&!this.is_shadow()||(this.svg_path.addEventListener("mouseover",function(t){t.stopPropagation(),o(!0)}),this.svg_path.addEventListener("mouseout",function(t){t.stopPropagation(),o(!1)}));var o=function(t){var o=e.is_shadow()?e.parent_block:e;if(o&&o.is_wrap_shape()&&o.svg_path){var i=o.get_surround_parent(),n=i&&!i.is_starting_block(),r=o.svg_group.querySelector(".blocklySurroundShadow");if(t&&!r&&!o.workspace.is_dragging()){var s=(0,c.clone_node)(o.svg_path);s.classList.add("blocklySurroundShadow"),o.svg_group.appendChild(s),n||o.svg_path.setAttribute("filter","url(#"+v.FILTER.SURROUND_SHADOW+")")}!t&&r&&(o.svg_group.removeChild(r),o.svg_path.removeAttribute("filter"))}}}},e.prototype.clear_hover_effect=function(){var t;(0,c.remove_class_if_necessary)(this.svg_group,"output-block-hover");var e=this.svg_group.querySelector(".blocklySurroundShadow");e&&(0,c.remove_node)(e),null!==(t=this.svg_path)&&void 0!==t&&t.removeAttribute("filter")},e.prototype.update_movable=function(){t.prototype.update_movable.call(this),this.is_shadow()&&"param_color"!==this.element_type&&(this.svg_group.classList.remove("blocklyDraggable"),this.svg_group.classList.add("blocklyShadow"))},e.prototype.update_disabled=function(){if(!this.svg_group||!this.svg_path)throw new ReferenceError("Cannot update disable to block without init.");if(!this.is_insertion_marker()&&!this.prevent_disable_style_change)if(this.disabled||this.get_inherited_disabled())(0,c.add_class_if_necessary)(this.svg_group,"blocklyDisabled"),this.is_shadow()||this.svg_path.setAttribute("fill","url(#"+this.workspace.get_options().disabledPatternId+")"),this.is_starting_block()&&(t=this.get_field_icon())&&t.image_element&&t.image_element.setAttribute("filter","url(#"+v.FILTER.DISABLED_HEAD_ICON+")");else if(this.svg_group.classList.contains("blocklyDisabled")){var t;this.svg_group.classList.remove("blocklyDisabled"),this.is_starting_block()&&(t=this.get_field_icon())&&t.image_element&&t.image_element.removeAttribute("filter"),this.update_colour()}for(var e=this.get_children(),o=0;o<e.length;o++)e[o].update_disabled()},e.prototype.get_output_shape=function(){return null!=this.output_connection&&this.output_connection.get_output_shape()},e.prototype.is_text_shadow=function(){if(!this.is_shadow())return!1;for(var t=0;t<this.inputList.length;t++)for(var e=this.inputList[t],o=0;o<e.fieldRow.length;o++){var i=e.fieldRow[o];if((0,h.is_field_number)(i)||(0,h.is_field_text_input)(i)||"FieldTextDropdown"===i.field_type||"FieldMultilineInput"===i.field_type||"FieldDefaultValue"===i.field_type)return!0}return!1},e.prototype.get_relative_to_surface_xy=function(){var t,e,o=this.use_drag_surface?null===(t=this.workspace.get_block_drag_surface())||void 0===t?void 0:t.get_group():void 0,i=this.get_svg_root();if(null==i)return n.vec2.create();var r=n.vec2.create();do{if(n.vec2.add(r,r,this.utils.get_relative_xy(i)),this.use_drag_surface&&(null===(e=this.workspace.get_block_drag_surface())||void 0===e?void 0:e.get_current_block())==i){var s=this.workspace.get_block_drag_surface().get_surface_translation();n.vec2.add(r,r,[s[0],s[1]])}i=i.parentNode}while(i&&i!=this.workspace.get_canvas()&&i!=o);return r},e.prototype.get_relative_to_injection_div_xy=function(){var t=this.get_svg_root();return this.utils.get_injection_div_xy(t)},e.prototype.get_icons=function(){var t=[];return this.comment&&t.push(this.comment),this.warning&&t.push(this.warning),t},e.prototype.set_dragging=function(t){if(null!=this.svg_group){var e=this.svg_group;t?(e.translate_="",e.skew_="",this.runtime_data.dragging_connections=this.runtime_data.dragging_connections.concat(this.get_connections(!0)),(0,c.add_class)(e,"blocklyDragging")):(this.runtime_data.dragging_connections=[],(0,c.remove_class)(e,"blocklyDragging"));for(var o=0;o<this.child_blocks.length;o++)this.child_blocks[o].set_dragging(t)}else console.warn("Cannot set delete style for block without init.")},e.prototype.snap_to_grid=function(){if(this.workspace&&!(this.workspace.is_dragging()||this.workspace.current_gesture_&&this.workspace.current_gesture_.has_started)&&!this.get_parent()&&!this.is_in_flyout){var t=this.workspace.get_grid();if(t&&"string"!=typeof t&&t.should_snap()){var e=t.get_spacing(),o=e/2,i=this.get_relative_to_surface_xy();n.vec2.round(i,[Math.round((i[0]-o)/e)*e+o-i[0],Math.round((i[1]-o)/e)*e+o-i[1]]),0==i[0]&&0==i[1]||this.move_by(i)}}},e.prototype.schedule_snap_and_bump=function(){var t=this,e=this,o=this.events.get_group();window.setTimeout(function(){t.events.get_group()&&t.events.get_group()!==o||(t.events.set_group(o),e.snap_to_grid(),t.events.set_group(!1))},this.theme.blink_params.BUMP_DELAY/2),window.setTimeout(function(){t.events.get_group()&&t.events.get_group()!==o||(t.events.set_group(o),e.bump_neighbours(),t.events.set_group(!1))},this.theme.blink_params.BUMP_DELAY)},e.prototype.set_insertion_marker=function(t){if(this._is_insertion_marker=t,this._is_insertion_marker){var e=this.workspace.get_options().connection_effect,o=e?e.color:this.theme.insertion_marker.COLOR;this.set_colour(o),this.set_opacity(this.theme.insertion_marker.OPACITY),null!=this.svg_group&&(0,c.add_class)(this.svg_group,"InsertionMarker")}this.update_colour()},e.prototype.highlight_for_replacement=function(t){if(null!=this.svg_path&&null!=this.svg_group){if(t){if((0,c.add_class)(this.svg_group,"blocklyReplaceable"),!this.is_shadow()||"param_color"===this.element_type)return this.svg_path.setAttribute("stroke","#ffffff"),void this.svg_path.setAttribute("stroke-width","3");if(this.get_stroke_width()!==this.theme.shadow_style.NO_BORDER){var e=this.parent_block.get_colour();return this.svg_path.setAttribute("stroke",e.toString()),this.svg_path.setAttribute("stroke-width","2"),void this.svg_path.setAttribute("filter","url(#"+v.FILTER.REPLACEMENT_GLOW+")")}return this.svg_path.setAttribute("stroke","#ffffff"),this.svg_path.setAttribute("stroke-width","3"),void(this.is_editable()&&!this.is_text_shadow()&&(this.svg_path.style.fillOpacity="0.1"))}(0,c.remove_class)(this.svg_group,"blocklyReplaceable"),this.svg_path.setAttribute("stroke",this.get_border_colour().toString()),this.svg_path.setAttribute("stroke-width",this.get_stroke_width()),this.svg_path.removeAttribute("filter"),this.svg_path.style.fillOpacity=""}else console.warn("Cannot highlight block without init.")},e.prototype.position_new_block=function(t,e,o){if(e.type==s.CONNECTION_TYPE.NEXT_STATEMENT){var i=n.vec2.create();n.vec2.sub(i,o.get_xy(),e.get_xy()),t.move_by(i)}},e.prototype.bring_to_front=function(){var t=this;if(this.workspace.svg_block_canvas_){var e=this;do{var o=e.get_svg_root();null!=o&&null!=o.parentNode&&o.parentNode.appendChild(o),e=e.get_parent()}while(e);var i=[];this.get_descendants().forEach(function(t){t.comment&&i.push(t.comment.get_svg_root())}),Array.from(this.workspace.svg_block_canvas_.children).forEach(function(e){i.includes(e)&&t.workspace.svg_block_canvas_.appendChild(e)})}},e.prototype.get_parent=function(){return this.parent_block},e.prototype.set_parent=function(t){if(this.workspace.svg_block_canvas_){var e=this.get_parent();if(t!==e){if(this.utils.start_text_cache(),this.parent_block){if((0,u.remove)(this.parent_block.child_blocks,this),this.previous_connection&&this.previous_connection.is_connected())throw new Error("Still connected to previous block.");if(this.output_connection&&this.output_connection.is_connected())throw new Error("Still connected to parent block.");this.parent_block=void 0}else this.workspace.remove_top_block(this);this.parent_block=t,t?t.child_blocks.push(this):this.workspace.add_top_block(this),this.utils.stop_text_cache();var o=this.get_svg_root();if(!this.workspace.is_clearing&&o){var i=this.get_relative_to_surface_xy();if(t){t.get_svg_root().appendChild(o);var r=this.get_relative_to_surface_xy();this.move_connections(n.vec2.subtract(r,r,i)),this.is_shadow()&&this.set_colour(this.get_colour(),this.get_border_colour())}else e&&(this.runtime_data.selected===this&&this.workspace.is_dragging()||(this.workspace.svg_block_canvas_.appendChild(o),this.translate(i)))}}}},e.prototype.select=function(){if(this.is_shadow()&&this.get_parent()){var t=this.get_parent();null!=t&&t.select()}else if(this.runtime_data.selected!=this){var e=void 0;if(this.runtime_data.selected){e=this.runtime_data.selected.id,this.events.disable();try{this.runtime_data.selected.unselect()}catch(t){console.error(t)}finally{this.events.enable()}}if(this.runtime_data.selected=this,this.events.is_enabled()){var o=this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:e,new_value:this.id});this.events.fire(o)}}},e.prototype.move_to_drag_surface=function(){this.clear_hover_effect(),"mobile"!==this.workspace.options.blockly_type&&this.svg_group.setAttribute("filter","url(#"+v.FILTER.DRAG_SHADOW+")"),t.prototype.move_to_drag_surface.call(this)},e.prototype.set_inputs_inline=function(t){var e;this.inputs_inline!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("inline",{block:this,old_value:!!this.inputs_inline,new_value:t})),this.inputs_inline=t),this.rendered&&this.render(),e&&this.events.fire(e)},e.prototype.get_inputs_inline=function(){return null==this.inputs_inline||this.inputs_inline},e.prototype.set_glow_stack=function(t){this.is_glowing_stack=t;var e=this.svg_group;if(null==e)throw new Error("Block may not been init.");this.is_glowing_stack?(0,c.add_class_if_necessary)(e,"blocklyStackGlow"):(0,c.remove_class_if_necessary)(e,"blocklyStackGlow")},e.prototype.set_flash=function(t){this.is_flashing=t,this.block_animations.block_flash_effect(this,this.is_flashing)},e.prototype.add_select=function(){this.set_glow_stack(!0)},e.prototype.remove_select=function(){this.set_glow_stack(!1)},e.prototype.bump_neighbours=function(){if(this.workspace&&!(this.workspace.is_dragging()||this.workspace.current_gesture_&&this.workspace.current_gesture_.is_dragging()&&this.workspace.current_gesture_.has_started)&&this.events.is_record_undo()&&this.workspace.is_resizes_enabled()){var t=this.get_top_parent();if(!(t.is_in_flyout||(_.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)||this.is_include_special_input())&&this.is_collapsed()))for(var e=this.get_connections(!1),o=0;o<e.length;o++){var i=e[o],n=i.targetBlock();null!=n&&i.is_connected()&&i.is_superior()&&n.bump_neighbours();for(var r=i.neighbours_(this.theme.blink_params.SNAP_RADIUS),s=0;s<r.length;s++){var a=r[s];if(!i.is_connected()||!a.is_connected()){var l=a.get_source_block().get_top_parent();"hidden"!==(null==l?void 0:l.get_visibility())&&l!=t&&(i.is_superior()?a.bump_away_from(i):i.bump_away_from(a))}}}}},e.prototype.get_height_width=function(){var t=this.height,e=this.width;this.is_wrap_shape()&&!this.is_collapsed()&&this.inputList.forEach(function(t){if(t.type===s.InputType.STATEMENT&&t.connection){var o=t.connection.targetBlock();o&&(e=Math.max(e,o.get_height_width().width))}});var o=this.get_full_next_block();if(this.is_collapsed()&&this.is_starting_block()&&(o=void 0),o){var i=o.get_height_width();t+=i.height,e=Math.max(e,i.width)}return{height:t,width:e}},e.prototype.get_blocks_svg_path_width=function(){var t=this.svg_path_width,e=this.get_next_block();return e&&(t=Math.max(t,e.get_blocks_svg_path_width())),t},e.prototype.tab=function(t,e){var o=this.create_tab_list(),i=t&&o.indexOf(t);"number"==typeof i&&-1!==i||(i=e?-1:o.length);var n=o[e?i+1:i-1];if(n)(0,h.is_func)(n.tab)?n.tab(void 0,e):(0,h.is_func)(n.show_editor)&&n.show_editor();else{var r=this.output_connection&&this.output_connection.targetBlock();if(r)r.tab(this,e);else{var s=e?this.get_next_block():this.get_previous_block();s&&s.tab(this,e)}}},e.prototype.create_tab_list=function(){for(var t=[],e=0;e<this.inputList.length;e++){for(var o=this.inputList[e],i=0;i<o.fieldRow.length;i++){var n=o.fieldRow[i];n.show_editor&&t.push(n)}if(o.connection){var r=o.connection.targetBlock();r&&t.push(r)}}return t},e.prototype.remove_input=function(t,e){for(var o=0;o<this.inputList.length;o++){var i=this.inputList[o];if(i.name==t){if(i.connection&&i.connection.is_connected()){i.connection.set_shadow_dom(void 0);var n=i.connection.targetBlock();n.is_shadow()?(this.events.disable(),n.dispose(),this.events.enable()):n.unplug()}return i.dispose(),this.inputList.splice(o,1),void(this.rendered&&this.render())}}e||console.warn("Input "+t+" not found."),this.rendered&&this.render()},e.prototype.move_numbered_input_before=function(t,e){if(t==e)throw new Error("Can't move input to itself.");if(t>=this.inputList.length)throw new Error("Input index "+t+" out of bounds.");if(e>this.inputList.length)throw new Error("Reference input "+e+" out of bounds.");var o=this.inputList[t];this.inputList.splice(t,1),t<e&&e--,this.inputList.splice(e,0,o),this.rendered&&this.render()},e.prototype.is_render_notch=function(){return this.workspace.options.notch},e.prototype.get_visibility=function(){return this.visibility_},e.prototype.set_visibility=function(t){this.visibility_=t},e.prototype.set_chunk_visibility=function(t){var e,o=this.get_top_parent();o.visibility_!==t&&(this.events.is_enabled()&&(e=this.change_event_factory("visibility",{block:o,old_value:o.visibility_,new_value:t})),o.visibility_=t,e&&this.events.fire(e))},e.prototype.update_chunk_visibility=function(){if(!this.parent_block){this.events.disable();var t=this.get_top_parent(),e=t.get_descendants();(0,c.update_visibility_class)(t.svg_group,t.get_visibility());var o="hidden"!==t.get_visibility();t.set_connectable(o),t.comment&&t.comment.update_visibility(),e.forEach(function(e){e!==t&&e.visibility_!==s.BlockVisibility.VISIBLE&&(e.visibility_=s.BlockVisibility.VISIBLE,(0,c.update_visibility_class)(e.svg_group,s.BlockVisibility.VISIBLE),e.comment&&e.comment.update_visibility())}),this.events.enable()}},e.prototype.is_connectable=function(){return this.connectable_},e.prototype.set_connectable=function(t){this.connectable_=t},e.prototype.is_stack_connectable=function(){for(var t,e=this;e;){if(!e.is_connectable())return!1;e=null===(t=e.previous_connection)||void 0===t?void 0:t.targetBlock()}return!0},e.prototype.get_input_index=function(t){var e=this.get_input(t);return e?this.inputList.indexOf(e):-1},e.prototype.mutation_to_string=function(){if(!this.mutationToDom)return"";var t=this.mutationToDom();return t?this.xml.dom_to_text(t):""},e.prototype.string_to_mutation=function(t){if(this.domToMutation)if(t)this.domToMutation(this.xml.text_to_dom(t));else try{this.domToMutation(void 0)}catch(t){}},e.prototype.set_opacity=function(t){this.opacity=t,this.rendered&&this.update_colour()},e.prototype.to_dev_string=function(){var t=this.type?'"'+this.type+'" block':"Block";return this.id&&(t+=' (id="'+this.id+'")'),t},e.prototype.is_rendered=function(){return this.rendered},e.prototype.set_rendered=function(t){this.rendered=t},e.prototype.set_category=function(t){this.category_=t},e.prototype.set_output_shape=function(t){this.output_shape=t},e.prototype.set_help_url=function(t){this.help_url=t},e.prototype.options_add_help=function(t){var e=this,o={enabled:!!((0,h.is_func)(this.help_url)?this.help_url():this.help_url),name:"help",text:this.Msg.HELP,callback:function(){e.show_help()}};t.push(o)},e.prototype.show_help=function(){this.help_url&&window.open(this.help_url)},e.prototype.sort=function(t){var e=this.get_relative_to_surface_xy();this.move_by(n.vec2.sub(e,t,e)),this.snap_to_grid(),n.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])},e.prototype.for_each_descendant_element=function(t,e){var o;if(void 0===e&&(e=!1),t(this),this.comment&&t(this.comment),e){for(n=0;n<this.inputList.length;n++)(r=null===(o=this.inputList[n].connection)||void 0===o?void 0:o.targetBlock())&&r.for_each_descendant_element(t,!0);var i=this.get_next_block();i&&i.for_each_descendant_element(t,!0)}else for(var n=0;n<this.child_blocks.length;n++){var r;(r=this.child_blocks[n]).for_each_descendant_element(t,!1)}},e.prototype.get_original_colour=function(){return this.colour_},e.prototype.get_border_colour=function(){var t;return this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type?(null===(t=this.parent_block)||void 0===t?void 0:t.get_border_colour())||this.theme.block_color.DEFAULT.border:this.border_colour},e.prototype.get_stroke_width=function(){return this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type?this.is_editable()&&this.is_text_shadow()?this.theme.shadow_style.BORDER:this.theme.shadow_style.NO_BORDER:"1px"},e.prototype.get_colour=function(){var t,e;if(this.is_shadow()&&"param"!==this.element_type&&"param_color"!==this.element_type)return this.is_editable()?this.theme.shadow_style.SHADOW_COLOR:this.theme.shadow_style.EMPTY_COLOR;if((this.disabled||this.get_inherited_disabled())&&!this.prevent_disable_style_change)return this.theme.disabled_color.fill;if(this.layer_colour&&this.is_output_block()&&(null===(t=this.parent_block)||void 0===t?void 0:t.get_colour())===this.colour_)return this.layer_colour;if(!this.is_editable()){var o=(null===(e=this.get_parent())||void 0===e?void 0:e.get_colour())||this.colour_;return(0,d.darken)(o,.1)}return this.colour_},e.prototype.set_colour_by_key=function(t){var e=t&&this.theme.get_color(t);e&&this.set_colour(e.fill,e.border,e.layer)},e.prototype.set_colour_from_json=function(t){this.set_colour_by_key(t.colour)},e.prototype.set_colour=function(t,e,o){this.colour_="string"==typeof t?new d.Color(t):t,this.border_colour=null!=e?"string"==typeof e?new d.Color(e):e:(0,d.darken)(this.colour_,.1),this.layer_colour=null!=o?"string"==typeof o?new d.Color(o):o:void 0,this.rendered&&this.update_colour()},e.prototype.update_colour=function(){if(!this.svg_path)throw new ReferenceError("Cannot update color without svg path.");this.svg_path.setAttribute("fill",this.get_colour().toString()),this.svg_path.setAttribute("stroke",this.get_border_colour().toString()),this.svg_path.setAttribute("stroke-opacity","1"),this.svg_path.setAttribute("stroke-width",this.get_stroke_width()),this.warning&&this.warning.update_colour()},e.prototype.update_layer_colour=function(){if(!this.disabled&&!this.get_inherited_disabled()&&this.is_output_block()&&this.svg_path){var t=this.get_colour().toString();this.svg_path.getAttribute("fill")!==t&&this.svg_path.setAttribute("fill",t);for(var e=0;e<this.child_blocks.length;e++)this.child_blocks[e].update_layer_colour()}},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.context_menu)],e.prototype,"context_menu",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.extensions)],e.prototype,"extensions",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.Msg)],e.prototype,"Msg",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.RenderedConnection)],e.prototype,"RenderedConnection",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.registry)],e.prototype,"registry",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldLabel)],e.prototype,"field_label_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldLabelSerializable)],e.prototype,"field_label_serializable_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldColour)],e.prototype,"field_colour_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldDropdown)],e.prototype,"field_dropdown_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldIcon)],e.prototype,"field_icon_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldButton)],e.prototype,"field_button_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.MutationAddButton)],e.prototype,"mutation_add_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.MutationRemoveButton)],e.prototype,"mutation_remove_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldNumber)],e.prototype,"field_number_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldTextDropdown)],e.prototype,"field_text_dropdown_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldTextInput)],e.prototype,"field_text_input_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldDefaultValue)],e.prototype,"field_default_value",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldImage)],e.prototype,"field_image_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldMultilineInput)],e.prototype,"field_multiline_input",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.Input)],e.prototype,"input_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.RenderedConnection)],e.prototype,"connection_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.WorkspaceComment)],e.prototype,"workspace_comment_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.BlockGroup)],e.prototype,"block_group_factory",void 0),e}(o(47187).WorkspaceElement);e.BlockSvg=f},4955:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.en=void 0,e.en={DUPLICATE_BLOCK:"Copy",COPY_ALL:"Copy %1 Blocks",ADD_COMMENT:"Add Comment",REMOVE_COMMENT:"Remove Comment",DELETE_BLOCK:"Delete Block",DELETE_X_BLOCKS:"Delete %1 Blocks",DELETE_ALL_BLOCKS:"Delete all %1 blocks?",CLEAN_UP:"Clean up Blocks",COLLAPSE_BLOCK:"Collapse Block",COLLAPSE_ALL:"Collapse All Blocks",EXPAND_BLOCK:"Expand Block",EXPAND_ALL:"Expand All Blocks",UNDO:"Undo",REDO:"Redo",PASTE:"Paste",COPY_AND_PASTE:"Copy and Paste",GLOBAL_COMMENT:"Add Workspace Comment",COMMENT:"Comment",BLUE_COMMENT:"Blue Comment",GREEN_COMMENT:"Green Comment",YELLOW_COMMENT:"Yellow Comment",RED_COMMENT:"Red Comment",DELETE_COMMENT:"Delete Comment",WHATS_THIS:"Describe this functionality...",SAY_SOMETHING:"Say something...",START_ON_CLICK:"%1 When Start clicked",START_ON_CLICK_2:"%1 When Start clicked %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 On running group activated",SELF_LISTEN:"%1 When I receive %2 %3 %4",SELF_BROADCAST:"Broadcast %1",SELF_BROADCAST_AND_WAIT:"Broadcast and wait",WHEN:"%1 when %2 %3",TERMINATE:"terminate",REPEAT_FOREVER:"Forever %1 %2",REPEAT_N_TIMES:"Repeat %1 times %2 %3",REPEAT_FOREVER_UNTIL:"Repeat forever until %1 %2 %3",BREAK:"Quit loop",WARP:"Warp %1 %2",WAIT_SECS:"Wait %1 secs",WAIT_UNTIL:"Wait until %1",DESTRUCT:"Destruct",CONTROLS_IF_MSG_IF:"If",CONTROLS_IF_MSG_ELSEIF:"Else if",CONTROLS_IF_MSG_ELSE:"Else",CONTROLS_IF_TOOLTIP_1:"If a value is true, then do some statements.",CONTROLS_IF_TOOLTIP_2:"If a value is true, then do the first block of statements. Otherwise, do the second block of statements.",CONTROLS_IF_TOOLTIP_3:"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements.",CONTROLS_IF_TOOLTIP_4:"If the first value is true, then do the first block of statements. Otherwise, if the second value is true, do the second block of statements. If none of the values are true, do the last block of statements.",TELL:"Make %1 run %2 %3",SYNC_TELL:"Make %1 run and wait %2 %3",GET_TIME:"Current %1",YEAR:"Year",MONTH:"Month",DATE:"Date",WEEK:"Week",WEEK0:"Sunday",WEEK1:"Monday",WEEK2:"Tuesday",WEEK3:"Wednesday",WEEK4:"Thursday",WEEK5:"Friday",WEEK6:"Saturday",HOUR:"Hour",MINUTE:"Minute",SECOND:"Second",TIMER:"Timer",RESET_TIMER:"Reset timer",MATH_NUMBER_TOOLTIP:"A number.",RANDOM_NUM:"Pick random %1 to %2",DIVISIBLE_BY:"%1 is divisible by %2",CALCULATE:"Math expression %1",CALCULATE_TOOLTIPS:"Enter math expression and calculate the results quickly",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"Return the sum of the two numbers.",MATH_ARITHMETIC_TOOLTIP_MINUS:"Return the difference of the two numbers.",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"Return the product of the two numbers.",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"Return the quotient of the two numbers.",MATH_ARITHMETIC_TOOLTIP_POWER:"Return the first number raised to the power of the second number.",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"Sqrt",MATH_SINGLE_TOOLTIP_ROOT:"Return the square root of a number.",MATH_SINGLE_OP_ABSOLUTE:"Abs",MATH_SINGLE_TOOLTIP_ABS:"Return the absolute value of a number.",MATH_SINGLE_TOOLTIP_NEG:"Return the negation of a number.",MATH_SINGLE_TOOLTIP_LN:"Return the natural logarithm of a number.",MATH_SINGLE_TOOLTIP_LOG10:"Return the base 10 logarithm of a number.",MATH_SINGLE_TOOLTIP_EXP:"Return e to the power of a number.",MATH_SINGLE_TOOLTIP_POW10:"Return 10 to the power of a number.",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"Round a number up or down.",MATH_ROUND_OPERATOR_ROUND:"Round",MATH_ROUND_OPERATOR_ROUNDUP:"Round up",MATH_ROUND_OPERATOR_ROUNDDOWN:"Round down",MATH_MODULO_TITLE:"Remainder of %1 ÷ %2",MATH_MODULO_TOOLTIP:"Return the remainder from dividing the two numbers.",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"even",MATH_IS_ODD:"odd",MATH_IS_PRIME:"prime",MATH_IS_WHOLE:"whole",MATH_IS_POSITIVE:"positive",MATH_IS_NEGATIVE:"negative",MATH_IS_TOOLTIP:"Check if a number is an even, odd, prime, whole, positive, negative, or if it is divisible by certain number. Returns true or false.",MATH_DEGREES:"degrees",LOGIC_NEGATE_TITLE:"%1 false",LOGIC_BOOLEAN_TRUE:"true",LOGIC_BOOLEAN_FALSE:"false",LOGIC_BOOLEAN_TOOLTIP:"Returns either true or false.",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"Return true if both inputs equal each other.",LOGIC_COMPARE_TOOLTIP_NEQ:"Return true if both inputs are not equal to each other.",LOGIC_COMPARE_TOOLTIP_LT:"Return true if the first input is smaller than the second input.",LOGIC_COMPARE_TOOLTIP_LTE:"Return true if the first input is smaller than or equal to the second input.",LOGIC_COMPARE_TOOLTIP_GT:"Return true if the first input is greater than the second input.",LOGIC_COMPARE_TOOLTIP_GTE:"Return true if the first input is greater than or equal to the second input.",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_TOOLTIP_AND:"Return true if both inputs are true.",LOGIC_OPERATION_AND:"and",LOGIC_OPERATION_TOOLTIP_OR:"Return true if at least one of the inputs is true.",LOGIC_OPERATION_OR:"or",TEXT_TEXT_TOOLTIP:"A letter, word, or line of text.",TEXT_SELECT:"Substring of %1 from %2 to %3",TEXT_LENGTH:"Length of %1",TEXT_CONTAIN:"%1 contains %2",TEXT_SPLIT:"Split %1 by %2",TEXT_JOIN_TOOLTIP:"Create a piece of text by joining together a_ny number of items.",TEXT_JOIN_TITLE_HEAD:"put",TEXT_JOIN_TITLE_TAIL:"together",VARIABLES_GET:"%1",VARIABLES_SET:"Set variable %1 to %2",CHANGE_VARIABLE:"%2 variable %1 by %3",INCREASE:"Increase",DECREASE:"Decrease",LISTS_GET:"%1",LISTS_APPEND:"Append %1 to the last of list %2",LISTS_INSERT_VALUE:"Insert %3 at %2 of %1",LISTS_COPY:"Copy lists %2 to %1",LISTS_LENGTH:"Get the length of list %1",LISTS_IS_EXIST:"If list %1 contains %2",LISTS_INDEX_OF:"Index of %1 in %2",PROCEDURES_PARAMETER:"Parameter %1",PROCEDURES_RETURN_VALUE:"Return %1 %2",PROCEDURES_DEFNORETURN_TITLE:"Define function",PROCEDURES_DEFNORETURN_PROCEDURE:"Function",PROCEDURES_DEFNORETURN_TOOLTIP:"create a function.",PROCEDURES_DEFRETURN_RETURN:"Return",COLOR_PICKER:"%1",RED:"Red",GREEN:"Green",BLUE:"Blue",HUE:"Hue",SATURATION:"Saturation",BRIGHTNESS:"Brightness",OPACITY:"Opacity",SELECT_COLOR_PARAM_TYPE:"Select color selection method",COLOR_PREVIEW:"Color preview"}},5197:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.vec2=e.I=e.BU=e.Blink=void 0;var i=o(31635),n=(0,i.__importStar)(o(31132));e.I=n;var r=o(3672),s=o(86865),_=o(74119),a=o(76525).version;console.log("%c⭐️ Codemao Blink - v"+a+" ⭐️",'\n  color: #FFDB29;\n  text-shadow: 0 1px 0 #BF7000;\n  padding: 140px 10px 20px 35px;\n  background: no-repeat left / 150px 150px url("http://kn-cdn.codemao.cn/blink/blink-main-compressed.jpeg");\n  ');var l=(0,r.get_instance)();(0,_.bind_di_modules)(l),e.Blink=l.get(s.BINDING.Blink),window.Blockly=e.Blink,e.BU=(0,i.__importStar)(o(23250));var c=o(77276);Object.defineProperty(e,"vec2",{enumerable:!0,get:function(){return c.vec2}})},5472:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AngleController=void 0;var i=o(31635),n=o(71519),r=o(12427),s=o(15261),_=o(58698),a=function(t){function e(){var e=t.call(this)||this;return e.pointer_elements=[],e.base_color=new _.Color("#000000"),e.mod=void 0,e.center_position=void 0,e.base_line_height=1,e.angle_interval=15,e.min_degree=-180,e.max_degree=180,e}return(0,i.__extends)(e,t),e.prototype.show=function(t,e){var o,i,n,r=(null===(o=t.source_block)||void 0===o?void 0:o.is_shadow())?t.source_block.parent_block:t.source_block;if(r&&(this.angle_scale||this.init(),this.owner=t,this.mod=t.mod_,this.base_color=r.get_colour(),this.update_angle_scale(),this.container.style.display="block",this.position(),this.base_line)){var s=(null===(n=null===(i=this.owner)||void 0===i?void 0:i.source_block)||void 0===n?void 0:n.get_workspace().get_scale())||1,_=this.base_line.getBoundingClientRect();this.center_position={left:_.left,top:_.top+this.base_line_height/2*s}}},e.prototype.init=function(){this.angle_scale=document.createElement("div"),this.angle_scale.classList.add("blockly-controller","angle-controller"),this.angle_scale.setAttribute("tabindex","-1");var t=(0,s.create_svg_element)("svg",{class:"blocklyIcon degree-mark-major"},this.angle_scale);this.degree_mark_major=(0,s.create_svg_element)("use",{},t),this.degree_mark_major.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+r.SYMBOL.DEGREE_MARK_MAJOR);var e=(0,s.create_svg_element)("svg",{class:"blocklyIcon degree-mark-minor"},this.angle_scale);this.degree_mark_minor=(0,s.create_svg_element)("use",{},e),this.degree_mark_minor.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+r.SYMBOL.DEGREE_MARK_MINOR);var o=document.createElement("div");o.classList.add("wrapper"),this.angle_scale.appendChild(o);var i=document.createElement("div");i.classList.add("grey-circle"),o.appendChild(i),this.mask=document.createElement("div"),this.mask.classList.add("mask-wrapper"),o.appendChild(this.mask),this.mask_top_clip=document.createElement("div"),this.mask_top_clip.classList.add("mask-clip"),this.mask.appendChild(this.mask_top_clip),this.mask_bottom_clip=document.createElement("div"),this.mask_bottom_clip.classList.add("mask-clip"),this.mask.appendChild(this.mask_bottom_clip);var n=document.createElement("div");n.classList.add("white-circle"),this.mask.appendChild(n),this.base_line=document.createElement("div"),this.base_line.classList.add("base-line"),o.appendChild(this.base_line),this.center=document.createElement("div"),this.center.classList.add("center"),o.appendChild(this.center),this.pointer=document.createElement("div"),this.pointer.classList.add("pointer"),o.appendChild(this.pointer);var _=document.createElement("div");_.classList.add("pointer-line"),this.pointer.appendChild(_),this.pointer_elements.push(_);var a=document.createElement("div");a.classList.add("pointer-arrow-wrapper"),this.pointer.appendChild(a);var l=document.createElement("div");l.classList.add("pointer-arrow-circle"),a.appendChild(l),this.pointer_elements.push(l);var c=(0,s.create_svg_element)("svg",{class:"blocklyIcon pointer-icon"},l),h=(0,s.create_svg_element)("use",{},c);h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#"+r.SYMBOL.DEGREE_POINTER),h.setAttribute("fill","#ffffff"),this.angle_scale.addEventListener("mousedown",this.bind_angle_event.bind(this)),this.angle_scale.addEventListener("mouseup",this.set_pointer_position.bind(this)),this.container.appendChild(this.angle_scale),document.body.appendChild(this.container)},e.prototype.update_angle_scale=function(){var t=this;if(this.degree_mark_major&&this.degree_mark_minor&&this.base_line&&this.center&&this.pointer&&this.mask&&this.owner){this.degree_mark_major.style.fill=this.base_color.toString(),this.base_line.style.backgroundColor=this.base_color.toString(),this.center.style.backgroundColor=this.base_color.toString(),this.pointer_elements.forEach(function(e){return e.style.backgroundColor=t.base_color.toString()});var e=new _.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.4});this.degree_mark_minor.style.fill=e.toString();var o=new _.Color({r:this.base_color.r,g:this.base_color.g,b:this.base_color.b,a:.2});this.mask.style.backgroundColor=o.toString();var i=this.field_to_angle_value(Number(this.owner.get_value()));this.set_angle_value(i)}},e.prototype.update_value=function(t){var e=this.field_to_angle_value(t);this.set_angle_value(e)},e.prototype.field_to_angle_value=function(t){var e=this.max_degree-this.min_degree,o=t%e;return!0===this.mod?o<=this.min_degree?o+=e:o>this.max_degree&&(o-=e):o<this.min_degree?o+=e:o>=this.max_degree&&(o-=e),Math.round(o)},e.prototype.bind_angle_event=function(){var t=this.move_pointer.bind(this);document.addEventListener("mousemove",t),document.addEventListener("mouseup",function e(){document.removeEventListener("mousemove",t),document.removeEventListener("mouseup",e)})},e.prototype.move_pointer=function(t){t.stopPropagation(),this.update_angle_and_field_value(t.clientX,t.clientY)},e.prototype.set_pointer_position=function(t){this.update_angle_and_field_value(t.clientX,t.clientY)},e.prototype.update_angle_and_field_value=function(t,e){if(this.center_position){var o=e,i=t-this.center_position.left,n=this.center_position.top-o,r=Math.atan2(n,i)/Math.PI*180;r=Math.round(r/this.angle_interval)*this.angle_interval,void 0!==this.mod&&(this.mod&&r===this.min_degree&&(r+=this.angle_interval),this.mod||r!==this.max_degree||(r-=this.angle_interval)),this.set_angle_value(r),this.owner&&(this.owner.set_html_input_value(r.toString()),this.owner.on_html_input_change())}},e.prototype.set_angle_value=function(t){this.pointer&&this.mask_top_clip&&this.mask_bottom_clip&&(this.pointer.style.transform="translateY(-50%) rotate("+-t+"deg)",t>0?(this.mask_top_clip.style.transform="rotate(-"+t+"deg)",this.mask_bottom_clip.style.transform="rotate(180deg)"):(this.mask_top_clip.style.transform="rotate(0deg)",this.mask_bottom_clip.style.transform="rotate("+(180-t)+"deg)"))},(0,i.__decorate)([(0,n.injectable)()],e)}(o(30624).x);e.AngleController=a},6084:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TouchManager=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(24042),_=function(){function t(){this._touch_identifier=void 0,this.TOUCH_MAP=s.BrowserFeature.TOUCH_ENABLED?{mousedown:["touchstart"],mousemove:["touchmove"],mouseup:["touchend","touchcancel"]}:{},this._long_pid=0,this.is_touch_event=function(t){return t.type.startsWith("touch")}}return t.prototype.long_start=function(t,e){this.long_stop(),1==t.changedTouches.length&&(this._long_pid=window.setTimeout(function(){var o=t;o.button=2,o.clientX=t.changedTouches[0].clientX,o.clientY=t.changedTouches[0].clientY,e&&e.handle_right_click(o)},this.theme.blink_params.LONGPRESS))},t.prototype.long_stop=function(){this._long_pid&&(clearTimeout(this._long_pid),this._long_pid=0)},t.prototype.clear_touch_identifier=function(){this._touch_identifier=void 0},t.prototype.should_handle_event=function(t){return!this.is_mouse_or_touch_event(t)||this.check_touch_identifier(t)},t.prototype.get_touch_identifier_from_event=function(t){return this.is_touch_event(t)&&t.changedTouches&&t.changedTouches[0]&&t.changedTouches[0].identifier||"mouse"},t.prototype.check_touch_identifier=function(t){var e=this.get_touch_identifier_from_event(t);return null!=this._touch_identifier?this._touch_identifier==e:("mousedown"==t.type||"touchstart"==t.type)&&(this._touch_identifier=e,!0)},t.prototype.set_client_from_touch=function(t){if(this.is_touch_event(t)){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}},t.prototype.is_mouse_or_touch_event=function(t){return t.type.startsWith("touch")||t.type.startsWith("mouse")},t.prototype.split_event_by_touches=function(t){var e=[];if(this.is_touch_event(t))for(var o=0;o<t.changedTouches.length;o++){var i=Object.assign({},t,{type:t.type,changedTouches:[t.changedTouches[o]],target:t.target,stopPropagation:function(){t.stopPropagation()},preventDefault:function(){0!=t.cancelable&&t.preventDefault()}});e[o]=i}else e.push(t);return e},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.TouchManager=_},8633:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockEvent=void 0;var i=o(31635),n=function(t){function e(e){var o=t.call(this)||this,i=e.get_workspace();return o._block_id=e.id,null==i?(console.error("Event block workspace not found."),o):(o._workspace_id=i.id,o)}return(0,i.__extends)(e,t),e.prototype.get_block_id=function(){return this._block_id},e}(o(31113).BaseEvent);e.BlockEvent=n},8676:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.HeadBlockRenderer=void 0;var i=o(31635),n=o(15261),r=function(t){function e(e){var o=t.call(this,e)||this;return o.padding_l=o.theme.renderer.ROW_PADDING_HEAD,e.is_render_notch()&&(o.padding_l=o.theme.renderer.NTOCH_START_PADDING+o.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER+o.theme.renderer.NOTCH_WIDTH-o.theme.renderer.SEP_SPACE_X),o}return(0,i.__extends)(e,t),e.prototype.get_decoration_path=function(t,e,o,i){var r=i-28*t;return(0,n.create_svg_element)("path",{d:"\n        m "+4*t+" "+(8+8*t)+",\n        h "+r+",\n        v 20, a 20 20 0 0 1 -20 20,\n        h -"+(r-22)+",\n        a 2 2 0 0 1 -2 -2, z",fill:e.toString(),stroke:o.toString(),class:"decoration_for_collapsed_blocks"})},e.prototype.render_group_decoration_blocks=function(t){t.decoration_block_paths.forEach(n.remove_node),t.decoration_block_paths.length=0;var e=Math.min(this.theme.renderer.EXECUTION_GROUP_DECORATION_WIDTH,t.width-this.theme.renderer.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN),o=t.origin_block.get_full_next_block();if(o){var i=o.get_full_next_block();if(i){var r=this.get_decoration_path(1,i.get_original_colour(),i.get_border_colour(),e);t.decoration_block_paths.unshift(r),t.svg_group.insertBefore(r,t.svg_path)}var s=this.get_decoration_path(0,o.get_original_colour(),o.get_border_colour(),e);t.decoration_block_paths.unshift(s),t.svg_group.insertBefore(s,t.svg_path)}return 0},e}(o(8845).BlockRenderer);e.HeadBlockRenderer=r},8845:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockRenderer=void 0;var i=o(31635),n=o(32791),r=o(53307),s=o(15261),_=function(){function t(t){this.edge_width=this.theme.renderer.BLOCK_EDGE_WIDTH,this.padding_l=this.theme.renderer.ROW_PADDING,this.padding_r=this.theme.renderer.ROW_PADDING,this.min_height=this.theme.renderer.MIN_HEIGHT,this.CORNER_LEFT_TOP="a "+this.theme.renderer.CORNER_RADIUS+" "+this.theme.renderer.CORNER_RADIUS+" 0 0 1 "+this.theme.renderer.CORNER_RADIUS+" -"+this.theme.renderer.CORNER_RADIUS,this.CORNER_LEFT_BOTTOM="a "+this.theme.renderer.CORNER_RADIUS+" "+this.theme.renderer.CORNER_RADIUS+" 0 0 1 -"+this.theme.renderer.CORNER_RADIUS+" -"+this.theme.renderer.CORNER_RADIUS,t.is_render_notch()&&(this.padding_l=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER+this.theme.renderer.NOTCH_WIDTH,this.padding_r=this.theme.renderer.ROW_PADDING+8)}return t.prototype.min_width=function(t){return(t&&t.is_render_notch()||t)&&this.theme.renderer.MIN_WIDTH},t.prototype.render_path_start=function(t,e){t.push("m 0,"+this.theme.renderer.CORNER_RADIUS),t.push(this.CORNER_LEFT_TOP),e.is_render_notch()&&null!=e.previous_connection&&this.render_path_notch_top(t)},t.prototype.render_path_notch_top=function(t){t.push("H",""+this.theme.renderer.NTOCH_START_PADDING),t.push(this.theme.renderer.NOTCH_PATH_LEFT)},t.prototype.render_path_notch_bottom=function(t){t.push("H",""+(this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER)),t.push(this.theme.renderer.NOTCH_PATH_RIGHT)},t.prototype.render_edge_shape_right=function(t,e,o,i,n){void 0===o&&(o=!0);var r=n?Math.min(n/2,this.edge_width):this.edge_width,s=e.height;t.push("a "+r+" "+r+" 0 0 1 "+r+" "+r),0==o?t.push("V "+(s-this.min_height/2)):(i[1]>2*r&&!n&&t.push("v "+(i[1]-2*r)),n&&t.push("v "+(n-2*r))),t.push("a "+r+" "+r+" 0 0 1 -"+r+" "+r)},t.prototype.render_edge_shape_collapsed_right=function(t,e){var o=e.height;t.push(this.theme.renderer.COLLAPSED_PATH),t.push("v "+(o-this.min_height+e.height/2))},t.prototype.render_edge_shape_group_right=function(t,e){var o=e.height-5.5-3.5;t.push("h "+this.theme.renderer.GROUP_RIGHT_EDGE_WIDTH+"\n      "+this.theme.renderer.GROUP_TOP_RIGHT_PATH+"\n      l -8.6 "+o+"\n      "+this.theme.renderer.GROUP_BOTTOM_RIGHT_PATH)},t.prototype.render_path_end=function(t,e){var o=e.is_render_notch()?this.theme.renderer.CORNER_RADIUS:this.theme.renderer.CORNER_RADIUS_END_BLOCK_WITHOUD_NOTCH;if(e.is_ending_block())return t.push("H",o.toString()),void t.push("a",o+","+o+" 0 0,1 -"+o+",-"+o);t.push("H "+this.theme.renderer.CORNER_RADIUS),t.push(this.CORNER_LEFT_BOTTOM)},t.prototype.get_decoration_path=function(t,e,o,i,n){var r=i-28*t,_=n?12:8;return(0,s.create_svg_element)("path",{d:"\n        m "+(this.theme.renderer.STATEMENT_MIN_WIDTH+4*t)+" "+(_+8*t)+",\n        h "+r+",\n        v 20, a 20 20 0 0 1 -20 20,\n        h -"+(r-22)+",\n        a 2 2 0 0 1 -2 -2, z",fill:e.toString(),stroke:o.toString(),class:"decoration_for_collapsed_blocks"})},t.prototype.render_group_decoration_blocks=function(t){if(!t.svg_path)return 0;t.decoration_block_paths.forEach(s.remove_node),t.decoration_block_paths.length=0;var e=t.origin_block,o=e.get_full_next_block(),i=Math.min(this.theme.renderer.EXECUTION_GROUP_DECORATION_WIDTH,t.width-this.theme.renderer.STATEMENT_MIN_WIDTH-this.theme.renderer.EXECUTION_GROUP_DECORATION_RIGHT_MARGIN);if(o){var n=this.get_decoration_path(1,o.get_original_colour(),o.get_border_colour(),i,!1);t.decoration_block_paths.unshift(n),t.svg_group.insertBefore(n,t.svg_path)}var r=this.get_decoration_path(0,e.get_original_colour(),e.get_border_colour(),i,!o);return t.decoration_block_paths.unshift(r),t.svg_group.insertBefore(r,t.svg_path),0},t.prototype.render_group_bottom=function(t){t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_TOP),t.push("v "+(this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT-2*this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM),t.push(this.theme.renderer.GROUP_EXTRA_ROW_RIGHT)},t.prototype.get_field_padding_y=function(){return this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_FIELD},t.prototype.get_block_padding_y=function(t){return t!==n.InputType.VALUE?this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_STATEMENT_BLOCK:this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_VALUE_BLOCK},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),t}();e.BlockRenderer=_},10268:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.block_render_svg=void 0;var i=o(31635),n=o(77276),r=o(32791),s=o(14289),_=o(24042),a=o(8676),l=o(76963),c=o(39060),h=o(8845);e.block_render_svg=function(t){return function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fixed_size_rule=[function(t,o){e.is_starting_block()||e.is_collapsed()||t!==e.inputList.length-1||!e.inputList[t-1]||e.inputList[t-1].type!==r.InputType.STATEMENT||(e.inputList[t].height=26,e.inputList[t].width=e.theme.renderer.INPUT_EXTRA_ROW_WIDTH,o.padding_l=52,o.padding_r=16)},function(t,o){(0,_.is_block_group)(e)&&e.group_type===r.BlockGroupType.OUTPUT&&(e.inputList[t].height=48,o.height=48)},function(t){e.is_starting_block()&&e.inputList[t].type===r.InputType.STATEMENT&&(e.inputList[t].render_height=0,e.inputList[t].height=0)}],e}return(0,i.__extends)(e,t),e.prototype.get_block_renderer=function(){return this.is_starting_block()?new a.HeadBlockRenderer(this):null!=this.output_connection?this.is_shadow()&&"param_color"!==this.element_type?new l.ShadowBlockRenderer(this):new c.OutputBlockRenderer(this):new h.BlockRenderer(this)},e.prototype.render=function(t){this.width=0,this.svg_path_width=0,this.block_renderer=this.get_block_renderer(),this.utils.start_text_cache(),this.rendered=!0;var e=0;this.warning&&(e=this.warning.render_icon(e,this.block_renderer));var o=this._render_compute(e);if(this.render_draw_(o),this.render_move_connections_(),this.comment&&this.comment.reposition(),!1!==t){var i=this.get_parent();i?i.render(!0):this.workspace.resize_contents()}this.utils.stop_text_cache(),this.update_chunk_visibility()},e.prototype.render_fields_=function(t,e,o){for(var i=0;i<t.length;++i)t[i].layout(e,o);return e},e.prototype.create_row_for_input_=function(t,e){return Object.assign([],{type:t.type!==r.InputType.STATEMENT?r.InputRowType.INLINE:r.InputRowType.STATEMENT,padding_l:t.type===r.InputType.STATEMENT&&this.is_starting_block()?e:this.block_renderer.padding_l+e,padding_r:this.block_renderer.padding_r,height:0})},e.prototype.compute_input_height_=function(t){return t.type===r.InputType.STATEMENT?this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT:this.block_renderer.min_height},e.prototype.compute_input_width_=function(t){var e;if(!this.is_output_block())return 0;switch(null===(e=t.connection)||void 0===e?void 0:e.get_output_shape()){case r.OutputShape.ROUND:return this.theme.renderer.INPUT_SHAPE_ROUND_WIDTH;case r.OutputShape.HEXAGONAL:return this.theme.renderer.INPUT_SHAPE_HEXAGONAL_WIDTH;default:return 0}},e.prototype._render_compute=function(t){for(var e,o=this.inputList,i=Object.assign([],{type:r.InputRowType.INLINE,right_edge:0,statement_width:0,height:0}),n=this.get_inputs_inline()&&!this.is_collapsed(),s=function(s){var a,l=o[s];if(!l.is_visible())return"continue";n&&null!=e&&e!==r.InputType.STATEMENT&&l.type!==r.InputType.STATEMENT?a=i[i.length-1]:(a=_.create_row_for_input_(l,null==e?t:0),e=l.type,i.push(a)),a.push(l),l.field_width=0,l.field_height=0;for(var c=0;c<l.fieldRow.length;c++){var h=l.fieldRow[c],d=h.get_size();h.render_sep=a.length>1||c>0||_.is_starting_block()?h.margin_left:0,l.field_width+=h.render_sep+d.width,l.field_height=Math.max(l.field_height,d.height)}if(l.render_width=0,l.render_height=0,l.connection){var p=l.connection.targetBlock();if(p){var u=p.get_height_width();p.is_shadow()&&"param_color"!==p.element_type?l.field_height=Math.max(l.field_height,u.height):l.render_height=Math.max(l.render_height,u.height),l.render_width=Math.max(l.render_width,u.width)}}l.height=Math.max(_.compute_input_height_(a),l.field_height+2*_.block_renderer.get_field_padding_y(),l.render_height+2*_.block_renderer.get_block_padding_y(l.type)),l.width=Math.max(_.compute_input_width_(l),l.field_width+l.render_width),_.fixed_size_rule.forEach(function(t){return t(s,a)}),a.height=Math.max(a.height,l.height)},_=this,a=0;a<o.length;a++)s(a);return i.forEach(function(t){t.forEach(function(e){e.height=t.height})}),i.right_edge=Math.max(i.right_edge,this.block_renderer.min_width(this)-this.block_renderer.padding_r),i},e.prototype.render_draw_=function(t){var e=[];this.render_draw_top_(e);var o=this.render_draw_right_(e,t);this.render_draw_bottom_(e,o),this.render_draw_left_(e);var i=e.join(" ");this.svg_path&&(this.svg_path.setAttribute("d",i),this.RTL&&this.svg_path.setAttribute("transform","scale(-1 1)"))},e.prototype.render_move_connections_=function(){var t=this.get_relative_to_surface_xy();null!=this.previous_connection&&this.previous_connection.move_to_offset(t),null!=this.output_connection&&this.output_connection.move_to_offset(t);for(var e=0;e<this.inputList.length;++e){var o=this.inputList[e].connection;o&&(o.move_to_offset(t),o.is_connected()&&o.tighten())}this.next_connection&&(this.next_connection.move_to_offset(t),this.next_connection.is_connected()&&this.next_connection.tighten())},e.prototype.render_draw_top_=function(t){if(this.block_renderer.render_path_start(t,this),null!=this.previous_connection){var e=0;this.is_render_notch()&&(e=this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NTOCH_START_PADDING),this.previous_connection.set_offset_in_block(e,0)}},e.prototype.render_draw_right_=function(t,e){for(var o=n.vec2.create(),i=0,a=0,l=0,c=e.length;l<c;l++){var h=e[l],d=e[l-1];o[0]=h.padding_l,h.type==r.InputRowType.INLINE?d&&d.type==r.InputRowType.STATEMENT&&l!==c-1?this.render_row_inline_(t,o,l,e,this.block_renderer.edge_width,Math.max(this.theme.renderer.MIN_WIDTH-i,i)):this.render_row_inline_(t,o,l,e,this.block_renderer.edge_width):h.type==r.InputRowType.STATEMENT&&((null!=d&&!this.is_starting_block()||0==this.inputs_inline)&&this.block_renderer.render_edge_shape_right(t,this,!0,o,a),this.render_row_statement(t,o,h,l,e)),o[1]+=h.height,i=o[0],a=h.height}if(0===e.length&&(o[0]=e.right_edge,t.push("H",""+o[0]),this.block_renderer.render_edge_shape_right(t,this,this.inputs_inline,o,a),this.width=Math.max(this.width,o[0]+this.block_renderer.padding_r),this.svg_path_width=Math.max(this.width,o[0]+this.block_renderer.padding_r),o[1]=this.block_renderer.min_height),this.height=o[1],e[e.length-1]&&e[e.length-1][0].name===s.COLLAPSED_INPUT_NAME)return this.block_renderer.render_edge_shape_collapsed_right(t,this),o;if((0,_.is_block_group)(this)){var p=this.block_renderer.render_group_decoration_blocks(this);return t.push("h "+p),o[0]+=p,this.block_renderer.render_edge_shape_group_right(t,this),this.width+=p+this.theme.renderer.GROUP_RIGHT_EXTENDED_WIDTH,this.group_type===r.BlockGroupType.EXECUTION&&(this.height+=this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT),o}return(e[e.length-1]&&e[e.length-1].type!==r.InputType.STATEMENT||this.is_starting_block())&&this.block_renderer.render_edge_shape_right(t,this,this.inputs_inline,o,a),o},e.prototype.render_row_inline_=function(t,e,o,i,n,s){for(var _=i[o],a=0;a<_.length;a++){var l=_[a];if(e=this.render_fields_(l.fieldRow,e,_.height||0),l.type==r.InputType.VALUE){e[0]+=0===l.fieldRow.length&&0===a?0:l.margin_left;var c=l.connection,h=c.targetBlock();l.connection&&l.connection.get_targe_connection()&&null!=h&&c.set_offset_in_block(e[0],e[1]+(_.height-h.height)/2),e[0]+=l.render_width}s&&(e[0]=Math.max(e[0],s))}var d=i.right_edge,p=i[o-1];null!=p&&p.type===r.InputType.STATEMENT&&(d=this.theme.renderer.STATEMENT_OTHER_ROW_MIN_WIDTH-this.theme.renderer.BLOCK_EDGE_WIDTH),i.right_edge=Math.max(e[0],d),e[0]=Math.max(e[0],i.right_edge),0===o&&(this.first_row_width=e[0]+_.padding_r,this.first_row_height=_.height),this.width=Math.max(this.width,e[0]+_.padding_r),this.svg_path_width=Math.max(this.width,e[0]+_.padding_r);var u=Math.min(_.height/2,n);t.push("H",""+(e[0]+_.padding_r-u))},e.prototype.draw_statement_input_=function(t,e,o){this.is_render_notch()&&(t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NOTCH_OFFSET_BETWEEN_PADDING_AND_ROUND_CORNER)),t.push(this.theme.renderer.NOTCH_PATH_RIGHT)),1==o.length&&0==o[0].fieldRow.length?t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)):t.push("H "+(e+this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)),t.push(this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_TOP+" v "+(o.height-2*this.theme.renderer.C_BLOCK_INNER_CORNOR_RADIUS)+" "+this.theme.renderer.C_BLOCK_INNER_CORNOR_LEFT_BOTTOM),this.is_render_notch()&&(t.push("H "+(this.theme.renderer.STATEMENT_MIN_WIDTH+this.theme.renderer.NTOCH_START_PADDING)),t.push(this.theme.renderer.NOTCH_PATH_LEFT))},e.prototype.render_row_statement=function(t,e,o,i,n){var _=o[0];this.render_fields_(_.fieldRow,e,o.height||0),this.is_starting_block()&&0!=this.inputs_inline||(this.draw_statement_input_(t,e[0],o),1==o.length&&0==o[0].fieldRow.length||(e[0]+=this.theme.renderer.STATEMENT_MIN_WIDTH));var a=e[0];if(this.is_render_notch()&&(this.is_starting_block()?s.SPECIAL_CONNECTION_INPUT_NAME.includes(_.name)&&(a=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH):a=this.theme.renderer.NTOCH_START_PADDING+this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.STATEMENT_MIN_WIDTH),!_.connection)throw new Error("Statement connection should be renderable.");if(_.connection.set_offset_in_block(a,e[1]),i==n.length-1||n[i+1].type==r.InputType.STATEMENT){if(this.is_starting_block())return;var l=this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT/2,c=Math.max(this.theme.renderer.INPUT_EXTRA_ROW_WIDTH-l,e[0]+this.theme.renderer.ROW_PADDING);t.push("H "+c),t.push("a "+l+" "+l+" 0,0,1 0, "+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT),e[1]+=this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT}},e.prototype.render_draw_bottom_=function(t,e){if(!s.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(this.type)||!this.is_collapsed()){(0,_.is_block_group)(this)&&this.group_type===r.BlockGroupType.EXECUTION&&(this.block_renderer.render_group_bottom(t),e[0]=this.theme.renderer.STATEMENT_MIN_WIDTH,e[1]+=this.theme.renderer.INPUT_MIN_HEIGHT_STATEMENT+this.theme.renderer.INPUT_EXTRA_ROW_HEIGHT);var o=this.next_connection||this.is_include_special_input()&&!this.is_collapsed(),i=0;this.is_render_notch()&&o&&(this.block_renderer.render_path_notch_bottom(t),i=this.theme.renderer.NOTCH_WIDTH+this.theme.renderer.NTOCH_START_PADDING),this.next_connection&&this.next_connection.set_offset_in_block(i,e[1])}},e.prototype.render_draw_left_=function(t){null!=this.output_connection&&this.output_connection.set_offset_in_block(0,0),this.block_renderer.render_path_end(t,this),t.push("z")},e}(t)}},10576:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FieldMultilineInput=void 0;var i=o(31635),n=o(71519),r=o(15261),s=function(t){function e(e){var o=t.call(this,e)||this;return o.padding_y=3,o.line_height=22,o.padding_x=0,o.field_type="FieldMultilineInput",o.max_length=e.max_length,o.max_width=e.max_width,o}return(0,i.__extends)(e,t),e.prototype.get_display_text=function(){return this.text_?this.text_:" "},e.prototype.render_=function(){var t,e,o=this;if(this.visible_&&this.text_element&&this.source_block){(0,r.remove_children)(this.text_element),this.text_element.setAttribute("text-anchor","start"),this.text_element.setAttribute("dominant-baseline","central");var i=this.get_display_text();this.utils.start_text_cache();var n=0,s=(0,r.create_svg_element)("tspan");this.text_element.appendChild(s);for(var _=0,a=Array.from(i),l=0;l<a.length;l++){s.textContent=a.slice(_,l+1).join("").replace(/\n/g,"").replace(/\s/g," ");var c=this.utils.get_cached_width(s);n=Math.max(n,c);var h=a[l],d=a[l+1],p=void 0!==this.max_width&&c>=this.max_width&&void 0!==a[l+1];("\n"===h||p)&&(s=(0,r.create_svg_element)("tspan"),this.text_element.appendChild(s),p&&"\n"===d&&l++,_=l+1)}this.utils.stop_text_cache(),this.padding_x=0,this.source_block.is_shadow()||(this.padding_x=n>=this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?this.theme.renderer.TEXT_PADDING_IN_FIELD:(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD+2*this.theme.renderer.TEXT_PADDING_IN_FIELD-n)/2);var u=this.padding_y;Array.from(this.text_element.children).forEach(function(t){t.setAttribute("x",""+o.padding_x),t.setAttribute("y",""+(u+o.line_height/2)),u+=o.line_height}),u+=this.padding_y,this.size_.height=u,this.size_.width=n+2*this.padding_x,null!==(t=this.border_rect)&&void 0!==t&&t.setAttribute("width",String(this.size_.width)),null!==(e=this.border_rect)&&void 0!==e&&e.setAttribute("height",String(this.size_.height))}else this.size_.width=0},e.prototype.widget_create=function(){if(!this.source_block)throw new Error("[FieldMultilineInput] Trying to create widget before init on a block. ");return this.html_input=t.prototype.widget_create.call(this,"textarea","blocklyHtmlTextarea"),this.html_input.style.lineHeight=this.line_height+"px",this.html_input.style.paddingTop=this.source_block.is_shadow()&&this.source_block.height<=this.theme.renderer.MIN_HEIGHT_SHADOW?(this.source_block.height-this.line_height)/2+"px":this.padding_y+"px",this.source_block.is_shadow()?(this.html_input.style.paddingLeft="23px",this.html_input.style.paddingRight=23*.8+"px"):(this.html_input.style.paddingLeft=this.padding_x+"px",this.html_input.style.paddingRight=.8*this.padding_x+"px"),this.html_input},e.prototype.on_html_input_keydown=function(e){"Enter"!==e.key&&t.prototype.on_html_input_keydown.call(this,e)},e.prototype.on_html_input_change=function(){this.html_input&&this.source_block&&(!this.is_composition_inputting&&this.max_length&&this.html_input.value.length>this.max_length&&(this.html_input.value=this.html_input.value.substr(0,this.max_length)),t.prototype.on_html_input_change.call(this),this.html_input.style.paddingTop=this.source_block.is_shadow()&&this.source_block.height<=this.theme.renderer.MIN_HEIGHT_SHADOW?(this.source_block.height-this.line_height)/2+"px":this.padding_y+"px",this.source_block.is_shadow()||(this.html_input.style.paddingLeft=this.padding_x+"px",this.html_input.style.paddingRight=this.padding_x+"px"))},(0,i.__decorate)([(0,n.injectable)()],e)}(o(14435).FieldTextInput);e.FieldMultilineInput=s},11384:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Css=void 0;var i=o(31635),n=o(71519),r=o(53307),s=function(){function t(){this.style_sheet=void 0,this.current_cursor="",this.media_path="",this.Cursor={OPEN:"handopen",CLOSED:"handclosed",DELETE:"handdelete"}}return t.prototype.inject=function(t,e){if(!this.style_sheet){var o=".blocklyDraggable {}\n";t&&(o+=this.CONTENT),this.media_path=e.replace(/[\\\/]$/,""),o=o.replace(/<<<PATH>>>/g,this.media_path);var i=document.createElement("style");if(document.head)document.head.insertBefore(i,document.head.firstChild);else{var n=document.createElement("head");n.insertBefore(i,n.firstChild),document.appendChild(n)}var r=document.createTextNode(o);i.appendChild(r),this.style_sheet=i.sheet}},t.prototype.set_cursor=function(t){if(this.current_cursor!=t){this.current_cursor=t;for(var e="url('"+this.media_path+"/"+t+".cur), auto",o=document.getElementsByClassName("blocklyToolboxDiv"),i=0;i<o.length;i++){var n=o[i];t==this.Cursor.DELETE?n.style.cursor=e:n.style.cursor=""}}},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.css_content)],t.prototype,"CONTENT",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Css=s},12427:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.inject_icon_symbols=e.SYMBOL=void 0;var i=(0,o(31635).__importStar)(o(23250));e.SYMBOL={DEGREE_MARK_MAJOR:"blocklyDegreeMarkMajor",DEGREE_MARK_MINOR:"blocklyDegreeMarkMinor",DEGREE_POINTER:"blocklyDegreePointer"},e.inject_icon_symbols=function(t){var o;(o={})[e.SYMBOL.DEGREE_MARK_MAJOR]='\n      <symbol id="'+e.SYMBOL.DEGREE_MARK_MAJOR+'" viewBox="0 0 1024 1024">\n        <path d="M512 156.734694a5.22449 5.22449 0 0 1 5.22449 5.22449v20.897959a5.22449 5.22449 0 0 1-10.44898 0v-20.897959a5.22449 5.22449 0 0 1 5.22449-5.22449z m355.265306 355.265306a5.22449 5.22449 0 0 1-5.22449 5.22449h-20.897959a5.22449 5.22449 0 1 1 0-10.44898h20.897959a5.22449 5.22449 0 0 1 5.22449 5.22449z m-355.265306 355.265306a5.22449 5.22449 0 0 1-5.22449-5.22449v-20.897959a5.22449 5.22449 0 1 1 10.44898 0v20.897959a5.22449 5.22449 0 0 1-5.22449 5.22449zM156.734694 512a5.22449 5.22449 0 0 1 5.22449-5.22449h20.897959a5.22449 5.22449 0 0 1 0 10.44898h-20.897959a5.22449 5.22449 0 0 1-5.22449-5.22449z m333.76653-397.270204c-5.632 0-8.704-3.949714-8.704-10.825143 0-7.021714 3.657143-11.190857 8.270368-11.190857 5.851429 0 9.874286 4.827429 10.673632 15.433143-3.213061 4.681143-6.948571 6.582857-10.24 6.582857z m-15.652571 21.577143c3.150367 3.218286 7.538939 5.705143 13.756082 5.705143 10.381061 0 20.035918-8.484571 20.035918-29.696 0-17.773714-8.338286-26.112-18.651429-26.112-8.704 0-16.018286 7.021714-16.018285 17.700571 0 11.264 6.070857 16.896 15.072653 16.896 4.096 0 8.704-2.413714 11.849143-6.290286-0.517224 15.36-6.144 20.626286-12.653715 20.626286a12.000653 12.000653 0 0 1-8.85551-4.022857l-4.534857 5.193143z m55.771429 5.705143c10.537796 0 17.413224-9.362286 17.413224-28.086858 0-18.578286-6.880653-27.721143-17.413224-27.721142-10.605714 0-17.402776 9.069714-17.402776 27.721142 0 18.724571 6.797061 28.086857 17.402776 28.086858z m0-6.656c-5.485714 0-9.357061-5.851429-9.357062-21.430858 0-15.433143 3.876571-21.065143 9.357062-21.065142 5.485714 0 9.36751 5.632 9.36751 21.065142 0 15.579429-3.876571 21.430857-9.36751 21.430858z m32.15151-28.818286c5.919347 0 10.825143-4.388571 10.825143-10.898286s-4.905796-10.898286-10.830368-10.898286c-5.773061 0-10.752 4.388571-10.752 10.898286s4.978939 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.929796-2.706286-5.929796-6.509714 0-3.876571 2.418939-6.582857 5.929796-6.582857 3.578776 0 5.99249 2.706286 5.99249 6.582857 0 3.803429-2.413714 6.509714-5.99249 6.509714zM462.576327 928.078367h19.309714v-6.217143h-19.309714v6.217143z m39.606857-8.777143c-5.632 0-8.704-3.949714-8.704-10.825142 0-7.021714 3.657143-11.190857 8.265143-11.190858 5.851429 0 9.874286 4.827429 10.678857 15.433143-3.218286 4.681143-6.948571 6.582857-10.24 6.582857z m-15.652572 21.577143c3.145143 3.218286 7.533714 5.705143 13.750857 5.705143 10.386286 0 20.041143-8.484571 20.041143-29.696 0-17.773714-8.338286-26.112-18.651428-26.112-8.704 0-16.018286 7.021714-16.018286 17.700572 0 11.264 6.070857 16.896 15.067429 16.896 4.096 0 8.704-2.413714 11.849142-6.290286-0.512 15.36-6.144 20.626286-12.653714 20.626286a12.000653 12.000653 0 0 1-8.850286-4.022858l-4.534857 5.193143z m55.771429 5.705143c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362286 21.065143c0 15.579429-3.876571 21.430857-9.362286 21.430857z m32.146286-28.818286c5.924571 0 10.825143-4.388571 10.825142-10.898285s-4.900571-10.898286-10.825142-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898285z m0-4.388571c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714zM23.750531 532.897959h30.72v-6.948571H43.937959v-46.884572H37.574531c-3.072 1.901714-6.656 3.145143-11.702858 4.096v5.339429H35.526531v37.449143H23.750531V532.897959z m51.09551 0.950857c10.386286 0 17.408-6.144 17.408-14.116571 0-7.314286-4.242286-11.483429-9.069714-14.262857v-0.365715c3.364571-2.486857 7.094857-7.168 7.094857-12.653714 0-8.411429-5.851429-14.262857-15.213715-14.262857-8.850286 0-15.36 5.485714-15.36 13.897143 0 5.705143 3.218286 9.728 7.241143 12.580571v0.365715c-4.973714 2.633143-9.654857 7.387429-9.654857 14.482285 0 8.338286 7.460571 14.336 17.554286 14.336z m3.510857-30.866285c-5.997714-2.340571-11.117714-5.046857-11.117714-10.898286 0-4.827429 3.291429-7.826286 7.68-7.826286 5.266286 0 8.265143 3.730286 8.265143 8.704 0 3.584-1.609143 7.021714-4.827429 10.020572z m-3.364571 24.795428c-5.778286 0-10.24-3.730286-10.24-9.069714 0-4.681143 2.56-8.704 6.290285-11.264 7.314286 2.998857 13.238857 5.485714 13.238857 12.068571 0 5.046857-3.803429 8.265143-9.289142 8.265143z m36.24751 6.070857c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362285 21.065143c0 15.579429-3.876571 21.430857-9.362285 21.430857z m29.664653-28.818285c5.924571 0 10.825143-4.388571 10.825143-10.898286s-4.900571-10.898286-10.825143-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714z m785.460245 39.862857c10.532571 0 17.408-9.362286 17.408-28.086857 0-18.578286-6.875429-27.721143-17.408-27.721143-10.605714 0-17.408 9.069714-17.408 27.721143 0 18.724571 6.802286 28.086857 17.408 28.086857z m0-6.656c-5.485714 0-9.362286-5.851429-9.362286-21.430857 0-15.433143 3.876571-21.065143 9.362286-21.065143s9.362286 5.632 9.362285 21.065143c0 15.579429-3.876571 21.430857-9.362285 21.430857z m29.664653-28.818285c5.924571 0 10.825143-4.388571 10.825143-10.898286s-4.900571-10.898286-10.825143-10.898286c-5.778286 0-10.752 4.388571-10.752 10.898286s4.973714 10.898286 10.752 10.898286z m0-4.388572c-3.510857 0-5.924571-2.706286-5.924572-6.509714 0-3.876571 2.413714-6.582857 5.924572-6.582857 3.584 0 5.997714 2.706286 5.997714 6.582857 0 3.803429-2.413714 6.509714-5.997714 6.509714z" p-id="16942"></path>\n      </symbol>\n    ',o[e.SYMBOL.DEGREE_MARK_MINOR]='\n      <symbol id="'+e.SYMBOL.DEGREE_MARK_MINOR+'" viewBox="0 0 1024 1024">\n       <path d="M644.514909 17.446788a7.757576 7.757576 0 0 1 5.484606 9.50303l-4.010667 14.979879a7.757576 7.757576 0 0 1-14.987636-4.010667l4.010667-14.987636a7.757576 7.757576 0 0 1 9.50303-5.484606zM768 68.592485a7.757576 7.757576 0 0 1 2.839273 10.596848l-7.757576 13.436122a7.757576 7.757576 0 0 1-13.436121-7.757576l7.757576-13.436121A7.757576 7.757576 0 0 1 768 68.592485z m106.038303 81.369212a7.757576 7.757576 0 0 1 0 10.969212l-10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212-10.969212l10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212 0zM955.407515 256a7.757576 7.757576 0 0 1-2.839273 10.596848l-13.436121 7.757576a7.757576 7.757576 0 1 1-7.757576-13.436121l13.436122-7.757576a7.757576 7.757576 0 0 1 10.596848 2.839273z m51.145697 123.485091a7.757576 7.757576 0 0 1-5.484606 9.50303l-14.987636 4.010667a7.757576 7.757576 0 0 1-4.010667-14.987636l14.979879-4.010667a7.757576 7.757576 0 0 1 9.50303 5.484606z m0 265.029818a7.757576 7.757576 0 0 1-9.50303 5.484606l-14.979879-4.010667a7.757576 7.757576 0 1 1 4.010667-14.987636l14.987636 4.010667a7.757576 7.757576 0 0 1 5.484606 9.50303zM955.407515 768a7.757576 7.757576 0 0 1-10.596848 2.839273l-13.436122-7.757576a7.757576 7.757576 0 0 1 7.757576-13.436121l13.436121 7.757576a7.757576 7.757576 0 0 1 2.839273 10.596848z m-81.369212 106.038303a7.757576 7.757576 0 0 1-10.969212 0l-10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212-10.969212l10.969212 10.969212a7.757576 7.757576 0 0 1 0 10.969212zM768 955.407515a7.757576 7.757576 0 0 1-10.596848-2.839273l-7.757576-13.436121a7.757576 7.757576 0 1 1 13.436121-7.757576l7.757576 13.436122a7.757576 7.757576 0 0 1-2.839273 10.596848z m-123.485091 51.145697a7.757576 7.757576 0 0 1-9.50303-5.484606l-4.010667-14.987636a7.757576 7.757576 0 0 1 14.987636-4.010667l4.010667 14.979879a7.757576 7.757576 0 0 1-5.484606 9.50303z m-265.029818 0a7.757576 7.757576 0 0 1-5.484606-9.50303l4.010667-14.979879a7.757576 7.757576 0 1 1 14.987636 4.010667l-4.010667 14.987636a7.757576 7.757576 0 0 1-9.50303 5.484606zM256 955.407515a7.757576 7.757576 0 0 1-2.839273-10.596848l7.757576-13.436122a7.757576 7.757576 0 0 1 13.436121 7.757576l-7.757576 13.436121a7.757576 7.757576 0 0 1-10.596848 2.839273z m-106.038303-81.369212a7.757576 7.757576 0 0 1 0-10.969212l10.969212-10.969212a7.757576 7.757576 0 0 1 10.969212 10.969212l-10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212 0zM68.592485 768a7.757576 7.757576 0 0 1 2.839273-10.596848l13.436121-7.757576a7.757576 7.757576 0 0 1 7.757576 13.436121l-13.436122 7.757576A7.757576 7.757576 0 0 1 68.592485 768zM17.454545 644.514909a7.757576 7.757576 0 0 1 5.484607-9.50303l14.987636-4.010667a7.757576 7.757576 0 0 1 4.010667 14.987636l-14.979879 4.010667a7.757576 7.757576 0 0 1-9.503031-5.484606z m0-265.029818a7.757576 7.757576 0 0 1 9.503031-5.484606l14.979879 4.010667a7.757576 7.757576 0 0 1-4.010667 14.987636l-14.987636-4.010667a7.757576 7.757576 0 0 1-5.484607-9.50303zM68.592485 256a7.757576 7.757576 0 0 1 10.596848-2.839273l13.436122 7.757576a7.757576 7.757576 0 0 1-7.757576 13.436121l-13.436121-7.757576A7.757576 7.757576 0 0 1 68.592485 256z m81.369212-106.038303a7.757576 7.757576 0 0 1 10.969212 0l10.969212 10.969212a7.757576 7.757576 0 0 1-10.969212 10.969212l-10.969212-10.969212a7.757576 7.757576 0 0 1 0-10.969212zM256 68.592485a7.757576 7.757576 0 0 1 10.596848 2.839273l7.757576 13.436121a7.757576 7.757576 0 0 1-13.436121 7.757576l-7.757576-13.436122A7.757576 7.757576 0 0 1 256 68.592485zM379.485091 17.454545a7.757576 7.757576 0 0 1 9.50303 5.484607l4.010667 14.987636a7.757576 7.757576 0 0 1-14.987636 4.010667l-4.010667-14.979879a7.757576 7.757576 0 0 1 5.484606-9.503031z" p-id="8468"></path>\n      </symbol>\n    ',o[e.SYMBOL.DEGREE_POINTER]='\n      <symbol id="'+e.SYMBOL.DEGREE_POINTER+'" viewBox="0 0 1024 1024">\n        <path d="M544.64 71.424c14.08 6.784 25.6 17.792 32.64 31.36l247.04 474.88c11.264 21.76 10.048 47.552-3.2 68.224-13.312 20.672-36.8 33.28-62.08 33.28H621.44l0.128 210.624C621.568 928.64 588.8 960 548.48 960H475.456c-40.32 0-72.96-31.424-72.96-70.208l-0.128-210.56H265.024c-25.344 0-48.832-12.672-62.08-33.28a67.84 67.84 0 0 1-3.2-68.352L446.72 102.784c18.048-34.624 61.888-48.64 97.92-31.36z" p-id="16814"></path> \n      </symbol>\n    ';var n=o;Object.keys(n).map(function(t){return i.dom.parse_to_SVG(n[t])}).forEach(function(e){t.appendChild(e)})}},12642:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ColorController=void 0;var i=o(31635),n=o(71519),r=o(99186),s=o(58698),_=o(32791),a=o(53307),l=function(t){function e(){var e=t.call(this)||this;return e.color_handle_element=null,e.current_color_panel_element=null,e.color_review_element=null,e.color_strip_width=182,e.min=0,e.max=100,e}return(0,i.__extends)(e,t),e.prototype.show=function(t,e){var o,i=(null===(o=t.source_block)||void 0===o?void 0:o.is_shadow())?t.source_block.parent_block:t.source_block;i&&(this.owner=t,this.color_format=e.color_format,this.line=e.line,this.color=i.color_,this.color_format&&this.line&&this.color&&(this.init(),this.update_color(),this.container.style.display="block",this.position()))},e.prototype.hide=function(){var t;this.container.style.display="none",null!==(t=this.color_element)&&void 0!==t&&t.remove()},e.prototype.init=function(){var t=this;this.color_element=document.createElement("div"),this.color_element.classList.add("blockly-controller","color-controller"),this.color_element.setAttribute("tabindex","-1");var e=document.createElement("div"),o="",i=this.Blink.Msg;this.color_format===_.EColorControllerFormat.HSVA?o=this.create_color_panel([["h","H "+i.HUE],["s","S "+i.SATURATION],["v","V "+i.BRIGHTNESS],["a","A "+i.OPACITY]]):this.color_format===_.EColorControllerFormat.RGBA&&(o=this.create_color_panel([["r","R "+i.RED],["g","G "+i.GREEN],["b","B "+i.BLUE],["a","A "+i.OPACITY]])),e.innerHTML=o,e.classList.add("color-panel"),this.color_element.appendChild(e),e.childNodes.forEach(function(e){var o,i,n,r=e;t.set_color_panel_item_left(r),r.addEventListener("mousedown",t.bind_color_strip_event.bind(t,r)),null!==(o=r.querySelector(".color-handle"))&&void 0!==o&&o.addEventListener("mousedown",t.bind_color_event.bind(t)),null!==(i=r.querySelector(".color-strip-panel"))&&void 0!==i&&i.addEventListener("mousedown",t.bind_color_event.bind(t)),r.querySelector(".color-strip-panel").addEventListener("mouseup",t.set_color_handle_position.bind(t)),(null===(n=t.line)||void 0===n?void 0:n.toLowerCase())===r.getAttribute("data")&&(t.color_handle_element=r.querySelector(".color-handle"),t.current_color_panel_element=r.querySelector(".color-strip-panel"))});var n="\n      <div>\n        "+i.COLOR_PREVIEW+'\n      </div>\n      <div class="color-preview">\n      </div>\n    ',r=document.createElement("div");r.classList.add("preview-panel"),r.innerHTML=n,this.color_review_element=r.querySelector(".color-preview"),this.color_element.appendChild(r),this.container.appendChild(this.color_element),document.body.appendChild(this.container)},e.prototype.update_color=function(){if(this.color&&this.color_element&&this.color_format&&this.line&&this.owner&&"number"==typeof this.owner.min_&&"number"==typeof this.owner.max_){this.min=this.owner.min_,this.max=this.owner.max_;var t=this.field_to_color_value(Number(this.owner.get_value()),this.min,this.max);this.set_color_value(t),this.update_dropdown_color()}},e.prototype.set_color_panel_item_left=function(t){var e,o,i,n,r,s,_=null===(o=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===o?void 0:o.parent_block,a=t.getAttribute("data"),l=t.querySelector(".color-handle");if(_&&a&&l){var c=this.get_field_value(_,a.toUpperCase()),h=(null===(s=null===(r=null===(n=null===(i=_.get_input_target_block(a.toUpperCase()))||void 0===i?void 0:i.output_connection)||void 0===n?void 0:n.target_connection)||void 0===r?void 0:r.get_shadow_dom())||void 0===s?void 0:s.firstChild).getAttribute("constraints");if(h){var d=h.split(","),p=d[0],u=d[1],g=this.field_to_color_value(c,p,u);l.style.left=g+"px"}}},e.prototype.create_color_panel=function(t){return t.map(function(t){return'<div data="'+t[0]+'" id="'+t[0]+'_panel" class="color-panel-item">\n    <div class="color-label">'+t[1]+'</div>\n    <div class="color-strip-panel">\n      <div id="'+t[0]+'_panel_strip" class="color-strip"></div>\n      <div class="color-handle"></div>\n    </div>\n  </div>'}).join("")},e.prototype.get_linear_gradient_rgba=function(t,e,o){var n=(0,i.__assign)({},t),r=(0,i.__assign)({},t);return n[e]=0,r[e]=o,"linear-gradient(90deg, "+(0,s.rgba_to_hex)(n)+", "+(0,s.rgba_to_hex)(r)+")"},e.prototype.get_linear_gradient_hsva=function(t,e,o){var n,r,_=null===(r=null===(n=this.owner)||void 0===n?void 0:n.source_block)||void 0===r?void 0:r.parent_block;if(!_)return"";var a={h:this.get_field_value(_,"H"),s:this.get_field_value(_,"S"),v:this.get_field_value(_,"V")};if("h"===e)return"linear-gradient(90deg, \n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:0})))+",\n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:60})))+",\n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:120})))+",\n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:180})))+",\n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:240})))+",\n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:300})))+",\n        "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)((0,i.__assign)((0,i.__assign)({},a),{a:t.a,h:360})))+")";var l=(0,i.__assign)((0,i.__assign)({},a),{a:t.a}),c=(0,i.__assign)((0,i.__assign)({},a),{a:t.a});return l[e]=0,c[e]=o,"linear-gradient(90deg, "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)(l))+", "+(0,s.rgba_to_hex)((0,s.hsva_to_rgba)(c))+")"},e.prototype.update_dropdown_color=function(){var t=this,e=this.color;if(e){this.color_review_element&&(this.color_review_element.style.background=e.toString());var o="rgba",i=[["r",255],["g",255],["b",255],["a",1]];this.color_format===_.EColorControllerFormat.HSVA&&(o="hsva",i=[["h",360],["s",100],["v",100],["a",1]]),i.forEach(function(i){var n,r,s,_,a,l=document.getElementById(i[0]+"_panel_strip");if(l){if(!(null===(_=null===(s=null===(r=null===(n=t.owner)||void 0===n?void 0:n.source_block)||void 0===r?void 0:r.parent_block)||void 0===s?void 0:s.get_input_target_block(i[0].toString().toUpperCase()))||void 0===_?void 0:_.get_field_value("NUM"))){var c=document.getElementById(i[0]+"_panel");c.style.opacity="0.2",null!==(a=null==c?void 0:c.querySelector(".color-handle"))&&void 0!==a&&a.remove(),l.style.cursor="not-allowed"}l.style.background="rgba"===o?t.get_linear_gradient_rgba(e,i[0],i[1]):t.get_linear_gradient_hsva(e,i[0],i[1])}})}},e.prototype.update_value=function(t){var e,o;if(this.color&&this.line){if("A"===this.line)this.color.a=t/100;else if(this.color_format===_.EColorControllerFormat.RGBA)this.color[this.line.toLowerCase()]=t;else if(this.color_format===_.EColorControllerFormat.HSVA){var i=null===(o=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===o?void 0:o.parent_block;if(!i)return;var n=this.get_field_value(i,"H"),r=this.get_field_value(i,"S"),a=this.get_field_value(i,"V");if(!n||!r||!a)return;var l={h:n,s:r,v:a};l[this.line.toLowerCase()]=t;var c=(0,s.hsv_to_rgb)(l),h=c[0],d=c[1],p=c[2];this.color.r=h,this.color.g=d,this.color.b=p}var u=this.field_to_color_value(t,this.min,this.max);this.set_color_value(u),this.update_dropdown_color()}},e.prototype.get_field_value=function(t,e){var o,i,n,r,s;return(null===(o=t.get_input_target_block(e))||void 0===o?void 0:o.get_field_value("NUM"))||(null===(s=null===(r=null===(n=null===(i=t.get_input_target_block(e))||void 0===i?void 0:i.output_connection)||void 0===n?void 0:n.target_connection)||void 0===r?void 0:r.get_shadow_dom())||void 0===s?void 0:s.textContent)},e.prototype.field_to_color_value=function(t,e,o){var i=(0,r.clamp)(t,e,o),n=e<0?i-e:i,s=o-e;return Math.round(n/s*this.color_strip_width)},e.prototype.bind_color_strip_event=function(t){var e,o,i,n,r=t.getAttribute("data");if(r){var s=null===(n=null===(i=null===(o=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===o?void 0:o.parent_block)||void 0===i?void 0:i.get_input_target_block(r.toUpperCase()))||void 0===n?void 0:n.get_field("NUM");s?(this.owner=s,this.line=r.toUpperCase(),this.color_handle_element=t.querySelector(".color-handle"),this.current_color_panel_element=t.querySelector(".color-strip-panel"),this.update_color()):this.color_handle_element=null}},e.prototype.bind_color_event=function(t){var e=this;if(t.preventDefault(),this.current_color_panel_element){this.current_color_panel_item_left=this.current_color_panel_element.getBoundingClientRect().left;var o=this.move_color_handle.bind(this);document.addEventListener("mousemove",o),document.addEventListener("mouseup",function t(){e.current_color_panel_item_left=void 0,document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t)})}},e.prototype.move_color_handle=function(t){t.stopPropagation(),this.update_color_and_field_value(t.clientX)},e.prototype.set_color_handle_position=function(t){this.current_color_panel_element&&(this.current_color_panel_item_left=this.current_color_panel_element.getBoundingClientRect().left,this.update_color_and_field_value(t.clientX))},e.prototype.update_color_and_field_value=function(t){var e,o;if(this.current_color_panel_item_left&&this.color_handle_element){var i=(null===(o=null===(e=this.owner)||void 0===e?void 0:e.source_block)||void 0===o?void 0:o.get_workspace().get_scale())||1,n=(t-this.current_color_panel_item_left)/i,s=(0,r.clamp)(n,0,this.color_strip_width),_=this.max-this.min,a=Math.round(s/this.color_strip_width*_),l=this.min<0?a+this.min:a;this.set_color_value(s),this.owner&&(this.owner.set_html_input_value(l.toString()),this.owner.on_html_input_change(),this.owner.get_value()!==l.toString()&&this.owner.set_value(l.toString()))}},e.prototype.set_color_value=function(t){this.color_handle_element&&(this.color_handle_element.style.left=t+"px")},(0,i.__decorate)([(0,a.lazy_inject)(a.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(30624).x);e.ColorController=l},14812:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.shortest_string_length=e.equals=e.remove=void 0;var i=o(24042);e.remove=function(t,e){var o=t.indexOf(e),i=o>=0;return i&&t.splice(o,1),i},e.equals=function(t,e){if(!(0,i.is_array)(t)||!(0,i.is_array)(e)||t.length!=e.length)return!1;for(var o=0;o<t.length;o++)if(t[o]!==e[o])return!1;return!0},e.shortest_string_length=function(t){return t.length?t.reduce(function(t,e){return t.length<e.length?t:e}).length:0}},14860:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.EndDragEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=function(t){function e(e){var o=t.call(this,e.block)||this;return o._record_undo=!1,o.type=r.BlockEventType.END_DRAG,o.block=e.block,o._is_outside=e.is_outside,o.mouse_position=e.mouse_position,o._is_from_flyout=e.is_from_flyout,o.redo_stack_before_drag=e.redo_stack_before_drag,o}return(0,i.__extends)(e,t),e.prototype.get_block_xml=function(){return this.xml.workspace_element_to_dom(this.block,!0)},e.prototype.delete_current=function(){this.block.dispose()},e.prototype.cancel_move=function(){var t=this._get_event_workspace();t.undo(),t.set_redo_stack(this.redo_stack_before_drag)},(0,i.__decorate)([(0,n.injectable)()],e)}(o(8633).BlockEvent);e.EndDragEvent=s},15810:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEvent=void 0;var i=o(31635),n=o(71519),r=o(3684),s=o(53307),_=o(32791),a=o(28688),l=function(t){function e(e){var o=t.call(this)||this;o._workspace_id=o.Blink.mainWorkspace.id||"",o._record_undo=!1;var i=e.type,n=e.group;if(o.type=i,o._group=n,i===_.GroupEventType.GroupEnd)for(var r=o._get_event_workspace().get_undo_stack().filter(function(t){return t._group===o._group}),s=r.length-1;s>=0;s--){var a=r[s];(a.type===_.BlockEventType.MOVE||a.type===_.BlockEventType.CREATE&&"other"===a.source||a.type===_.BlockEventType.CHANGE&&"change_procedure_param"===a.element)&&o.process_context_blocks(a)}return o}return(0,i.__extends)(e,t),e.prototype.process_context_blocks=function(t){var e=this,o=this._get_event_workspace().get_block_by_id(t.get_block_id());if(o){var i=new Set,n=new Set;o.get_descendants(!1,!0).forEach(function(t){if(t.type!==r.PROCEDURE_BLOCK_TYPES.CALL_NORETURN&&t.type!==r.PROCEDURE_BLOCK_TYPES.CALL_RETURN&&(0,a.has_context)(t)){var e=(0,a.is_valid_context)(t);e||t.disabled||i.add(t),e&&t.disabled&&n.add(t)}});var s=function(t,o){var i=e.events.is_record_undo();e.events.set_record_undo(!0),e.events.disable();var n=e.events.get_group();e.events.set_group(e._group),e.events.enable(),t.set_disabled(o),e.events.disable(),e.events.set_group(n),e.events.enable(),e.events.set_record_undo(i)};i.forEach(function(t){s(t,!0)}),n.forEach(function(t){s(t,!1)})}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(31113).BaseEvent);e.GroupEvent=l},15970:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockAnimations=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(15261),a=o(58698),l=o(58221),c=function(){function t(){this.disconnectUiEffectTimeoutId=0}return t.prototype.dispose_ui_effect=function(t){var e=t.get_workspace(),o=t.get_svg_root(),i=e.get_injection_div();if(e.get_audio_manager().play("delete"),o&&i){var n=this.utils.get_injection_div_xy(o),r=e.get_scale(),s=(0,_.create_svg_element)("svg",{class:"blocklyBlockDisposeWrapper"});s.style.transformOrigin="left top",s.style.overflow="visible",this.utils.set_transform_style(s,n[0],n[1],r);var a=(0,_.clone_node)(o,!0);a.setAttribute("transform",""),s.appendChild(a),i.appendChild(s);var l=function t(){(0,_.remove_node)(s),a.removeEventListener("webkitAnimationEnd",t),a.removeEventListener("animationend",t),clearTimeout(c)};a.addEventListener("webkitAnimationEnd",l),a.addEventListener("animationend",l);var c=window.setTimeout(l,500),h=t.get_height_width();return a.setAttribute("transform-origin",(h.width/2-this.theme.renderer.BLOCK_LEFT_TOP[0])*r+"px "+(h.height/2-this.theme.renderer.BLOCK_LEFT_TOP[1])*r+"px"),a.classList.add("blocklyBlockDispose"),a}console.warn("UI effects cannot be played without svg group or injection div.")},t.prototype.connection_ui_effect=function(t){var e=t.get_svg_root();if(null==e)throw new ReferenceError("Cannot connect ui effect to block without svg root.");var o=t.get_workspace();if(o.get_audio_manager().play("click"),!(o.get_scale()<1)){var i=o.get_svg_xy(e);t.output_connection?r.vec2.add(i,i,[-3*o.get_scale(),13*o.get_scale()]):t.previous_connection&&r.vec2.add(i,i,[0*o.get_scale(),3*o.get_scale()]);var n=t.workspace.options.notch?t.workspace.get_scale()*(this.theme.renderer.NOTCH_WIDTH/2+this.theme.renderer.NTOCH_START_PADDING):0,s=(0,_.create_svg_element)("circle",{cx:i[0]+n,cy:i[1],r:0,fill:"#fff"},o.get_parent_svg());this.connection_ui_step(s,Date.now(),o.get_scale())}},t.prototype.connection_ui_step=function(t,e,o){var i=this,n=(Date.now()-e)/150;n>1?(0,_.remove_node)(t):(t.setAttribute("r",String(15*n*o)),t.style.opacity=String(1-n),window.setTimeout(function(){i.connection_ui_step(t,e,o)},10))},t.prototype.disconnect_ui_effect=function(t){t.workspace.get_audio_manager().play("disconnect"),t.workspace.get_scale()<1||t.svg_group&&t.use_drag_surface&&(t.svg_group.classList.add("dd"),this.disconnectUiEffectTimeoutId=window.setTimeout(function(){t.svg_group.classList.remove("dd");var e=t.svg_group.getAttribute("transform");t.svg_group.setAttribute("transform",(null==e?"":e)+"skewX(0)")},100))},t.prototype.disconnect_ui_effect_stop=function(t){clearTimeout(this.disconnectUiEffectTimeoutId),t.svg_group.classList.remove("dd");var e=t.svg_group.getAttribute("transform");t.svg_group.setAttribute("transform",null==e?"":e)},t.prototype.toolbox_click_effect=function(){},t.prototype.block_flash_effect=function(t,e){var o,i,n,r,s,c,h;if(e){var d=t.get_colour(),p=(0,a.rgb_to_hsv)(d.r,d.g,d.b),u=(0,a.hsv_to_rgb)({h:p.h,s:p.s+20,v:p.v-15}),g=new a.Color({r:u[0],g:u[1],b:u[2],a:d.a}),v=d.toString(),f=g.toString(),b=(0,_.create_svg_element)("animate",{id:"BlockFlashAnimation",attributeName:"fill",attributeType:"XML",values:v+" ; "+f+" ; "+v,dur:"1s",repeatCount:"indefinite",keyTimes:"0 ; 0.5; 1",calcMode:"spline",keySplines:"0.25,0.1,0.25,1;0.25,0.1,0.25,1"});return null!==(o=t.svg_path)&&void 0!==o&&o.removeAttribute("fill"),t.is_starting_block()&&(m=t.get_svg_root().querySelector(".blockly_head_icon_wrapper"))&&m.removeAttribute("fill"),t.is_output_block()&&t.parent_block?(null!==(i=t.svg_path)&&void 0!==i&&i.setAttribute("stroke","#FFFFFF"),null!==(n=t.svg_path)&&void 0!==n&&n.setAttribute("stroke-width","2px")):t.get_svg_root().setAttribute("filter","url(#"+l.FILTER.FOCUSED+")"),void t.get_svg_root().appendChild(b)}var m,y=t.svg_group.querySelector("#BlockFlashAnimation");y&&t.svg_group.removeChild(y),null!==(r=t.svg_path)&&void 0!==r&&r.removeAttribute("filter");var k=t.get_colour().toString();null!==(s=t.svg_path)&&void 0!==s&&s.setAttribute("fill",k),t.is_starting_block()&&(m=t.get_svg_root().querySelector(".blockly_head_icon_wrapper"))&&(m.setAttribute("fill",k),m.removeAttribute("filter")),null!==(c=t.svg_path)&&void 0!==c&&c.setAttribute("stroke",t.get_border_colour().toString()),null!==(h=t.svg_path)&&void 0!==h&&h.setAttribute("stroke-width",t.get_stroke_width())},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.BlockAnimations=c},16991:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MutationRemoveButton=e.MutationAddButton=void 0;var i=o(31635),n=o(71519),r=o(15261),s=function(t){function e(e,o,i){void 0===i&&(i=20);var n=t.call(this,{src:"",width:i,height:i})||this;return n.is_add=e,n.index_=o,n.field_type="FieldMutation",n}return(0,i.__extends)(e,t),e.prototype.init=function(){var t,e=this;if(!this.field_group){this.field_group=(0,r.create_svg_element)("g",{},void 0),this.visible_||(this.field_group.style.display="none"),this.image_element=(0,r.create_svg_element)("g",{width:this.width_,height:this.height_,class:"fieldButton"},this.field_group),this.rect_element=(0,r.create_svg_element)("rect",{width:this.width_,height:this.height_,rx:this.width_/2,ry:this.width_/2,stroke:"rgba(0, 0, 0, .15)",fill:"rgba(255, 255, 255, .15)"},this.image_element),(0,r.create_svg_element)("line",{stroke:"#fff","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10,x1:this.width_/3,y1:this.height_/2,x2:2*this.width_/3,y2:this.height_/2},this.image_element),this.is_add&&(0,r.create_svg_element)("line",{stroke:"#fff","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10,x1:this.width_/2,y1:this.height_/3,x2:this.width_/2,y2:2*this.height_/3},this.image_element),this.events.bind_event_with_checks(this.field_group,"mousedown",this,function(){e.rect_element&&(e.rect_element.style.fill="rgba(0, 0, 0, .15)")});var o=null===(t=this.source_block)||void 0===t?void 0:t.get_svg_root();if(null==o)throw new ReferenceError("Field should have svg root when init.");o.appendChild(this.field_group),this.events.bind_event_with_checks(this.field_group,"mouseup",this,this.on_click),this.mouse_down_wrapper=this.events.bind_event_with_checks(this.field_group,"mousedown",this,this.on_mouse_down)}},e.prototype.get_img_scale=function(){return 1},e.prototype.on_click=function(t){var e,o;if(this.source_block){this.rect_element&&(this.rect_element.style.fill="rgba(255, 255, 255, .15)");var i=this.source_block.get_workspace().get_gesture(t);if(i&&i.is_dragging_block)i.handle_up(t);else if(!this.source_block.is_in_flyout&&!this.utils.is_right_button(t)){if(i&&(i.update_is_mutation_click(!0),i.handle_up(t)),!this.events.is_enabled())return;var n=this.events.get_group();this.events.set_group(n||!0);var r=this.source_block;this.is_add?null!==(e=r.addMutation)&&void 0!==e&&e.call(r,this.index_,this.name):null!==(o=r.removeMutation)&&void 0!==o&&o.call(r,this.index_,this.name),r.bump_neighbours(),this.events.set_group(n)}}},e.prototype.set_index=function(t){this.index_=t},e}(o(1265).FieldImage),_=function(t){function e(){return t.call(this,!0)||this}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,n.injectable)()],e)}(s);e.MutationAddButton=_;var a=function(t){function e(e){return void 0===e&&(e=void 0),t.call(this,!1,e)||this}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,n.injectable)()],e)}(s);e.MutationRemoveButton=a},17419:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockGroup=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(32791),_=o(18978),a=o(24042),l=o(28688),c=function(t){function e(e){var o=t.call(this,{workspace:e.workspace,id:e.id})||this;return o.element_type="block_group",o.group_type=0,o.nested_blocks_with_comment=[],o.decoration_block_paths=[],o.show_name_editor=function(t,e){return(0,i.__awaiter)(o,void 0,void 0,function(){var o,n,r;return(0,i.__generator)(this,function(i){switch(i.label){case 0:return(o=null===(r=this.workspace.options.block_group)||void 0===r?void 0:r.show_name_editor)?[4,o(t.get_text())]:(e.call(t),[2]);case 1:return null!=(n=i.sent())&&t.set_value(n),[2]}})})},o.init=function(){var t,e,i,n;o.events.disable();var r=o.origin_xy||o.origin_block.get_relative_to_surface_xy();o.move_by(r),o.set_chunk_visibility(o.origin_block.get_visibility());try{if(o.origin_block.is_starting_block())return o.group_type=s.BlockGroupType.START,void o.init_start_group();if(o.origin_block.output_connection)return o.group_type=s.BlockGroupType.OUTPUT,void o.init_output_group();o.group_type=s.BlockGroupType.EXECUTION,o.init_execution_group()}finally{if(o.origin_block.get_svg_root().style.display="none",o.origin_block.get_descendants(!1,!0).forEach(function(t){return t.set_comment_visible(!1)}),"simplified"===o.workspace.get_options().comment_type){if((0,l.get_nested_blocks_with_comment)(o.origin_block).forEach(function(t){var e;(0,a.is_block_group)(t)?(e=o.nested_blocks_with_comment).push.apply(e,t.nested_blocks_with_comment):o.nested_blocks_with_comment.push(t)}),o.nested_blocks_with_comment.length){var _=null===(t=o.nested_blocks_with_comment[0].comment)||void 0===t?void 0:t.get_text();o.set_comment_text(_),null!==(e=o.comment)&&void 0!==e&&e.init_svg(!0)}}else o.set_comment_text(null===(i=o.origin_block.comment)||void 0===i?void 0:i.get_text()),null!==(n=o.comment)&&void 0!==n&&n.init_svg(!0);o.origin_block.set_connectable(!1),o.events.enable()}},o.origin_block=e.origin_block,o.group_name=e.group_name,o.on_release=e.on_release,o.origin_block_display=o.origin_block.get_svg_root().style.display,o.origin_xy=e.origin_xy,o.group_stop_at=e.group_stop_at,o.init(),o}return(0,i.__extends)(e,t),e.prototype.init_start_group=function(){this.set_colour(this.theme.block_group_color.START_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.START_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t=this.origin_block.inputList[0].fieldRow[0],e=this.field_icon_factory({src:t.src_||"",opt_is_head:!0}),o=this.field_text_input_factory({text:this.group_name});o.show_editor=this.show_name_editor.bind(this,o,o.show_editor),this.append_dummy_input("START_GROUP").append_field(e).append_field(this.Msg.START_GROUP_TAG,s.BLOCK_GROUP_TAG_FIELD_NAME).append_field(o,s.BLOCK_GROUP_NAME_FIELD_NAME),this.set_previous_statement(!1),this.set_next_statement(!1)},e.prototype.init_output_group=function(){var t;this.set_colour(this.theme.block_group_color.OUTPUT_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.OUTPUT_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var e=this.field_text_input_factory({text:this.group_name});e.margin_left=this.theme.renderer.SEP_SPACE_X+this.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT,e.show_editor=this.show_name_editor.bind(this,e,e.show_editor),this.append_dummy_input("OUTPUT_GROUP").append_field(this.Msg.OUTPUT_GROUP_TAG,s.BLOCK_GROUP_TAG_FIELD_NAME).append_field(e,s.BLOCK_GROUP_NAME_FIELD_NAME),(0,_.assert)(this.origin_block.output_connection),this.set_output(!0,null===(t=this.origin_block.output_connection)||void 0===t?void 0:t.check_),(0,_.assert)(this.output_connection);var o=this.origin_block.output_connection.target_connection;null!=o&&o.connect(this.output_connection)},e.prototype.init_execution_group=function(){this.set_colour(this.theme.block_group_color.EXECUTION_GROUP_FILL_COLOUR||this.origin_block.get_original_colour(),this.theme.block_group_color.EXECUTION_GROUP_STROKE_COLOUR||this.origin_block.get_border_colour());var t=this.field_text_input_factory({text:this.group_name});t.show_editor=this.show_name_editor.bind(this,t,t.show_editor),this.append_dummy_input("EXECUTION_GROUP").append_field(this.Msg.EXECUTION_GROUP_TAG,s.BLOCK_GROUP_TAG_FIELD_NAME).append_field(t,s.BLOCK_GROUP_NAME_FIELD_NAME),(0,_.assert)(this.origin_block.previous_connection),this.set_previous_statement(!0),(0,_.assert)(this.previous_connection);var e=this.origin_block.previous_connection.target_connection,o=void 0;if(this.group_stop_at){this.set_next_statement(!0);var i=this.workspace.get_block_by_id(this.group_stop_at);o=i&&i.previous_connection,(0,_.assert)(o),o.disconnect(),this.next_connection.connect(o)}else this.origin_block.last_connection_in_stack()&&this.set_next_statement(!0);null!=e&&e.disconnect(),null!=e&&e.connect(this.previous_connection)},e.prototype.options_add_set_blocks_group=function(t){var e=this;t.push({text:this.utils.replace_message_references("%{BKY_RELEASE_GROUP}"),name:"release_group",area:"block",enabled:!0,callback:function(){e.release()}})},e.prototype.dispose=function(t,e){var o;if(this.workspace){var i=this.events.get_group();if(this.events.set_group(i||!0),e&&this.rendered&&this.block_animations.dispose_ui_effect(this),this.release(),null===(o=this.origin_block)||void 0===o?void 0:o.workspace){var n=this.origin_block.get_descendants(!0,!0);if(n)for(var r=0;r<n.length;r++){var s=n[r];(0,a.is_block_group)(s)&&s.release()}this.origin_block.dispose(t,!1)}this.events.set_group(i)}},e.prototype.release=function(){var e,o,i,n,a,l,c,h;switch(this.events.disable(),this.group_name=this.get_field_value(s.BLOCK_GROUP_NAME_FIELD_NAME),this.origin_block.move_by(r.vec2.sub(r.vec2.create(),this.get_relative_to_surface_xy(),this.origin_block.get_relative_to_surface_xy())),this.origin_block.get_svg_root().style.display=this.origin_block_display,this.origin_block.set_connectable(!0),this.origin_block.set_chunk_visibility(this.get_visibility()),this.origin_block.update_chunk_visibility(),this.group_type){case s.BlockGroupType.EXECUTION:(0,_.assert)(this.origin_block.previous_connection,"Statement block must have prev conn. ");var d=null===(e=this.previous_connection)||void 0===e?void 0:e.target_connection;null!==(o=this.previous_connection)&&void 0!==o&&o.disconnect();var p=null===(i=this.next_connection)||void 0===i?void 0:i.target_connection;if(this.group_stop_at=null==p?void 0:p.source_block.id,null===(n=this.next_connection)||void 0===n||n.disconnect(),p){var u=this.origin_block.last_connection_in_stack();(0,_.assert)(u),u.connect(p)}(null==d?void 0:d.source_block.workspace)===this.origin_block.workspace&&null!=d&&d.connect(this.origin_block.previous_connection);break;case s.BlockGroupType.OUTPUT:(0,_.assert)(this.origin_block.output_connection,"Output block must have output conn. ");var g=null===(a=this.output_connection)||void 0===a?void 0:a.target_connection;null!==(l=this.output_connection)&&void 0!==l&&l.disconnect(),null!=g&&g.connect(this.origin_block.output_connection)}this.origin_block.get_descendants(!1,!0).forEach(function(t){return t.set_comment_visible(!0)}),null!==(c=this.origin_block.comment)&&void 0!==c&&c.init_svg(!0),t.prototype.dispose.call(this,!1,!1),this.events.enable(),null!==(h=this.on_release)&&void 0!==h&&h.call(this)},(0,i.__decorate)([(0,n.injectable)()],e)}(o(3986).BlockSvg);e.BlockGroup=c},18721:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.no_event=e.is_target_input=e.is_right_button=void 0,e.is_right_button=function(t){return 2==t.button},e.is_target_input=function(t){return t.target instanceof HTMLInputElement&&("textarea"==t.target.type||"text"==t.target.type||"number"==t.target.type||"email"==t.target.type||"password"==t.target.type||"search"==t.target.type||"tel"==t.target.type||"url"==t.target.type||t.target.isContentEditable)},e.no_event=function(t){t.preventDefault(),t.stopPropagation()}},18916:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Extensions=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(32791),_=o(90185),a=o(24042),l=function(){function t(){this.extensions={},this.mutators={},this.MUTATOR_PROPERTIES_=["domToMutation","mutationToDom"]}return t.prototype.register=function(t,e){if((0,_.string_is_empty_or_whitespace)(t))throw new Error('Error when registering extension "'+t+'": invalid extension name. ');this.extensions[t]?console.error('Error when registering extension "'+t+'": extension existed.'):this.extensions[t]=e},t.prototype.register_mixin=function(t,e){var o=this.check_existed_mutator_property(e);if(o)throw Error('Error when registering extension "'+t+'": Trying to register mixin with mutator property: '+o+". ");this.register(t,function(){this.mixin(e)})},t.prototype.unregister=function(t){t in this.extensions&&delete this.extensions[t]},t.prototype.register_mutator=function(t,e,o){for(var i=0;i<this.MUTATOR_PROPERTIES_.length;i++){var n=this.MUTATOR_PROPERTIES_[i];if(!e.hasOwnProperty(n))throw new Error('Error when registering mutator "'+t+'": missing required property "'+n+'". ');if(!(0,a.is_func)(e[n]))throw new Error('Error when registering mutator "'+t+'": required property "'+n+'" must be a function. ')}this.mutators[t]=function(){this.mixin(e),o&&o.apply(this)}},t.prototype.unregister_mutator=function(t){t in this.mutators&&delete this.mutators[t]},t.prototype.apply=function(t,e){var o='Error when applying extension "'+t+'": ',i=this.extensions[t];if(!(0,a.is_func)(i))throw new Error(o+"extension not found.");var n=this.get_mutator_properties(e);if(i.apply(e),!this.mutator_properties_match(n,e))throw new Error(o+"mutation properties changed when applying a non-mutator extension.")},t.prototype.apply_mutator=function(t,e){var o='Error when applying mutator "'+t+'": ',i=this.mutators[t];if(!(0,a.is_func)(i))throw new Error(o+"mutator not found.");var n=this.check_existed_mutator_property(e);if(n)throw Error(o+"mutation property "+n+" already existed on block "+e);i.apply(e);var r=this.check_absent_mutator_property(e);if(r)throw new Error(o+"applied a mutator didn't add \""+r+'"')},t.prototype.check_existed_mutator_property=function(t){for(var e=0;e<this.MUTATOR_PROPERTIES_.length;e++){var o=this.MUTATOR_PROPERTIES_[e];if(t.hasOwnProperty(o))return o}},t.prototype.check_absent_mutator_property=function(t){for(var e=0;e<this.MUTATOR_PROPERTIES_.length;e++){var o=this.MUTATOR_PROPERTIES_[e];if(!t.hasOwnProperty(o))return o}},t.prototype.get_mutator_properties=function(t){for(var e=[],o=0;o<this.MUTATOR_PROPERTIES_.length;o++)e.push(t[this.MUTATOR_PROPERTIES_[o]]);return e},t.prototype.mutator_properties_match=function(t,e){var o=this.get_mutator_properties(e);if(o.length!=t.length)return!1;for(var i=0;i<o.length;i++)if(t[i]!=o[i])return!1;return!0},t.prototype.build_tooltip_for_dropdown=function(t,e){var o=this,i=[];document&&this.utils.run_after_page_load(function(){for(var t in e)o.utils.check_message_references(e[t])});var n=this;return function(){var o=this;this.type&&-1===i.indexOf(this.type)&&(n.check_dropdown_options_in_table(this,t,e),i.push(this.type)),this.set_tooltip(function(){var r=o.get_field_value(t),s=r?e[r]:void 0;if(null==s){if(-1===i.indexOf(o.type)){var _="No tooltip mapping for value "+r+" of field "+t;null!=o.type&&(_+=" of block type "+o.type),console.warn(_+".")}}else s=n.utils.replace_message_references(s);return s||""})}},t.prototype.check_dropdown_options_in_table=function(t,e,o){var i=t.get_field(e);if(i&&(0,a.is_func)(i.is_dynamic)&&!i.is_dynamic())for(var n=i.get_options(),r=0;r<n.length;++r){var _=n[r][s.OptionTypes.VALUE];null!=_&&null!=o[_]||console.warn("No tooltip mapping for value "+_+" of field "+e+" of block type "+t.type)}},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Extensions=l},18978:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fail=e.assert=void 0,e.assert=function(t,e){if(!t)throw new Error(e)},e.fail=function(t){console.error(t)}},20014:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RuntimeData=void 0;var i=o(31635),n=o(71519),r=(0,i.__importStar)(o(47168)),s=o(53307),_=o(15261),a=function(){function t(){var t=this;this.selected=void 0,this.editing=void 0,this.pasting_count=0,this.dragging_connections=[],this.hide_chaff_effects=[],this.document_events_bound=!1,this.before_scale=1,this.pinch_listener=function(e){var o=t.workspace_db.current;o.current_gesture_&&o.current_gesture_.cancel();var i=e.scale;i-t.before_scale>.08?(o.mark_focused(),o.zoom_center(.5),t.before_scale=i):i-t.before_scale<-.08&&(o.mark_focused(),o.zoom_center(-.5),t.before_scale=i)},this.pinchend_listener=function(){t.before_scale=1},this.clipboard=new l}return t.prototype.set_pasting=function(t){t?this.pasting_count++:this.pasting_count--},t.prototype.is_pasting=function(){return this.pasting_count},t.prototype.register_finger_events=function(){if(!this.hammer_manager){var t=document.querySelector(".blocklySvg");this.hammer_manager=new r.Manager(t)}this.pinch_recognizer||(this.pinch_recognizer=new r.Pinch),this.hammer_manager.add(this.pinch_recognizer),this.hammer_manager.on("pinch",this.pinch_listener),this.hammer_manager.on("pinchend",this.pinchend_listener)},t.prototype.unregister_finger_events=function(){var t,e,o;this.pinch_recognizer&&null!==(t=this.hammer_manager)&&void 0!==t&&t.remove(this.pinch_recognizer),null!==(e=this.hammer_manager)&&void 0!==e&&e.off("pinch",this.pinch_listener),null!==(o=this.hammer_manager)&&void 0!==o&&o.off("pinchend",this.pinchend_listener)},t.prototype.cancel_gesture_when_multi_touch=function(){var t,e=this;null!==(t=this.workspace_db.current)&&void 0!==t&&t.get_parent_svg().addEventListener("touchmove",function(t){var o=e.workspace_db.current;t.touches.length>1&&o.current_gesture_&&o.current_gesture_.cancel()})},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.RuntimeData=a;var l=function(){function t(){}return t.prototype.get_content=function(){if(this.content)return Array.isArray(this.content)?this.content.map(function(t){return(0,_.clone_node)(t,!0)}):(0,_.clone_node)(this.content,!0)},t.prototype.copy=function(t){var e=this.xml.workspace_element_to_dom_with_xy(t);return this.content=e,e},t.prototype.copy_all=function(t){var e=this,o=t.map(function(t){return e.xml.workspace_element_to_dom_with_xy(t)});return this.content=o,o},t.prototype.duplicate=function(t){var e=this.copy(t);return t.get_workspace().paste((0,_.clone_node)(e,!0)),e},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],t.prototype,"xml",void 0),t}()},20137:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Toolbox=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(32791),_=o(18978),a=o(15261),l=o(24042),c=o(99186),h=o(27554),d=o(65129),p=function(t){function e(e){var o=t.call(this)||this;o.get_node_from_event_=function(t){for(var e=t.target;null!=e;){var i=o.find_node_by_name(e.id);if(null!=i)return i;if(e==o.children_container_)break;e=e.parentNode}};var i=e.options;o.workspace_=e,o.toolbox_position=e.get_options().toolboxPosition;var n=Object.assign({},o.workspace_.options,{disabledPatternId:i.disabledPatternId,parentWorkspace:e,RTL:e.RTL,toolboxPosition:i.toolboxPosition,blockly_type:i.blockly_type,id:void 0});return o.flyout=o.vertical_flyout_factory(n),o}return(0,i.__extends)(e,t),e.prototype.get_flyout=function(){return this.flyout},e.prototype.get_width=function(){return this.html_div?this.html_div.offsetWidth:0},e.prototype.get_height=function(){return this.html_div?this.html_div.offsetHeight:0},e.prototype.get_workspace_id=function(){if(this.workspace_)return this.workspace_.id},e.prototype.init=function(){var t=this;if(this.workspace_){var e=this.workspace_,o=e.get_options(),i=this.workspace_.get_workspace_drag_surface(),n=i&&i.get_svg();if(null!=n){this.html_div=(0,a.create_dom)("div","blocklyToolboxDiv"),this.html_div.setAttribute("dir",e.RTL?"RTL":"LTR"),void 0!==o.toolbox_background_class?this.html_div.classList.add(o.toolbox_background_class):this.html_div.style.background=this.theme.flyout.BACKGROUND_COLOR.toString(),this.children_container_=document.createElement("div"),this.children_container_.className="blocklyTreeRoot",(0,_.assert)(o.toolbox_config,"Toolbox is not defined."),this.populate(o.toolbox_config),this.html_div.appendChild(this.children_container_),(0,a.insert_after)(this.html_div,n),(0,a.insert_before)(this.flyout.create_dom("svg"),this.html_div),this.flyout.init(e),this.position(),this.events.bind_event(this.html_div,"mousedown",this,function(){t.mousedown_time=Date.now()}),this.events.bind_event(this.html_div,"touchmove",this,function(){t.mousedown_time=void 0});var r=(0,l.throttle)(function(e){return t.handle_mousedown(e)},200);this.events.bind_event(this.html_div,"mouseup",this,function(e){t.mousedown_time&&Date.now()-t.mousedown_time<200&&r(e),t.mousedown_time=void 0})}else console.warn("Ref SVG not Found.")}},e.prototype.handle_mousedown=function(t){if(this.utils.is_right_button(t)||t.target==this.html_div)return this.utils.hide_chaff(!1),void this.touch_manager.clear_touch_identifier();this.utils.hide_chaff(!0);var e=this.get_node_from_event_(t);e&&!e.is_disabled()&&(e.is_selected()?this.clear_selection():e.is_selectable()&&this.set_selected_item(e),e.set_expanded(!e.is_expanded()),this.block_animations.toolbox_click_effect()),this.touch_manager.clear_touch_identifier()},e.prototype.populate=function(t){this.remove_children(),this.workspace_&&(Array.isArray(t)?this.build_by_config(t):this.sync_trees_(t),this.workspace_.resize_contents())},e.prototype.build_by_config=function(t){var e=this;t.forEach(function(t){var o=new d.TreeNode(t);e.add(o)})},e.prototype.sync_nodes_=function(t,e){for(var o,i=0,n=void 0;i<t.childNodes.length;i++)if((n=t.childNodes[i])instanceof Element)switch(n.tagName.toUpperCase()){case"SEP":if(null==o)break;var r=n.getAttribute("gap");null!=r&&o.setAttribute("gap",r);break;case"BLOCK":case"SHADOW":case"LABEL":case"BUTTON":e.push_block(n),o=n}},e.prototype.sync_trees_=function(t){for(var e,o,i=0,n=void 0;i<t.childNodes.length;i++)if((n=t.childNodes[i])instanceof Element)switch(n.tagName.toUpperCase()){case"CATEGORY":var r=n.getAttribute("name");if(null==r)throw new ReferenceError("Child node does not have name.");var s=n.getAttribute("text")||void 0,_=n.getAttribute("color"),a=_&&(null===(e=this.theme.get_color(_))||void 0===e?void 0:e.fill.toString())||_||void 0,l=n.getAttribute("flyout_background")||void 0,c=n.getAttribute("element_classname")||void 0,h=n.getAttribute("element_disabled_classname")||void 0,p=n.getAttribute("element_classname_selected")||void 0,u=n.getAttribute("element_style")||void 0,g=n.getAttribute("element_selected_style")||void 0,v=n.getAttribute("icon")||void 0,f=n.getAttribute("selected_icon")||void 0,b=n.getAttribute("icon_html")||void 0,m=n.getAttribute("icon_selected_html")||void 0,y=new d.TreeNode({text:s,name:r,color:a,secondary_color:l,element:{unselected_classname:c,disabled_classname:h,selected_classname:p,style:u,selected_style:g},icon:{style:v,selected_style:f,html:b,selected_html:m}}),k=n.getAttribute("custom");k&&0===n.childElementCount?(y.set_blocks(k),y.get_element().dataset.custom=k):(this.sync_nodes_(n,y),0===y.get_blocks().length&&y.set_disabled(!0)),o=n,this.add(y);break;case"SEP":if(console.error("TreeSeparator is not implemented currently. "),null==o)break}},e.prototype.position=function(){null!=this.html_div&&this.workspace_&&(null!=this.workspace_.get_parent_svg()?(this.toolbox_position==s.TOOLBOX_POSITION.RIGHT?(this.html_div.style.top="0",this.html_div.style.right="0"):(this.html_div.style.top="0",this.html_div.style.left="0"),this.flyout.position()):console.warn("Parent SVG not Found."))},e.prototype.get_client_rect=function(){if(null!=this.html_div){var t=this.html_div.getBoundingClientRect(),e=this.workspace_.get_options().delete_area_margin,o=t.left,i=t.top,n=t.width,r=t.height;return new c.Rect(o-e[3],i-e[0],n+e[1]+e[3],r+e[0]+e[2])}},e.prototype.add_delete_style=function(){(0,a.add_class)(this.html_div,"blocklyToolboxDelete")},e.prototype.remove_delete_style=function(){(0,a.remove_class)(this.html_div,"blocklyToolboxDelete")},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.flyout.dispose(),(0,a.remove_node)(this.html_div),this.workspace_=void 0},e.prototype.get_selected=function(){return this.selected_node},e.prototype.get_last_selected=function(){return this.last_selected_node},e.prototype.set_selected_item=function(t){var e,o,i=this.selected_node;if(t!==i){this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CATEGORY_WILL_CHANGE,workspace_id:(null===(e=this.workspace_)||void 0===e?void 0:e.id)||"",old_value:i,new_value:t})),i&&i.unselect();var n=[];if(t&&(t.select(),n=t.get_blocks(!0)),t&&n&&n.length>0){var r=t.get_flyout_background_color();if(r){var _=this.flyout.get_background();_&&(_.style.fill=r)}this.flyout.show(n),this.last_selected_node!==t&&this.flyout.scroll_to_start()}else this.flyout.hide();t&&(this.last_selected_node=t),this.selected_node=t,this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CATEGORY,workspace_id:(null===(o=this.workspace_)||void 0===o?void 0:o.id)||"",old_value:i,new_value:t}))}},e.prototype.clear_selection=function(){this.set_selected_item()},e.prototype.refresh_selection=function(){if(null!=this.selected_node){var t=this.selected_node.get_blocks();null!=t&&this.flyout.show(t)}},e.prototype.find_node_by_name=function(t){if(t)for(var e=0;e<this.children_.length;e++){var o=this.children_[e];if(o.get_name()===t)return o;var i=o.find_node_by_name(t);if(i)return i}},e.prototype.new_node=function(t){return new d.TreeNode(t)},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.utils)],e.prototype,"utils",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.block_animations)],e.prototype,"block_animations",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],e.prototype,"theme",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.VerticalFlyout)],e.prototype,"vertical_flyout_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.UIEvent)],e.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(h.BaseNode);e.Toolbox=p},23250:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.json=e.block=e.string=e.color=e.asserts=e.array=e.maths=e.math=e.base=e.event=e.dom=e.style=e.is=void 0;var i=o(31635),n=(0,i.__importStar)(o(72137));e.style=n;var r=(0,i.__importStar)(o(15261));e.dom=r;var s=(0,i.__importStar)(o(18721));e.event=s;var _=(0,i.__importStar)(o(24042));e.base=_;var a=(0,i.__importStar)(o(99186));e.math=a,e.maths=a;var l=(0,i.__importStar)(o(14812));e.array=l;var c=(0,i.__importStar)(o(18978));e.asserts=c;var h=(0,i.__importStar)(o(58698));e.color=h;var d=(0,i.__importStar)(o(90185));e.string=d;var p=o(82390);Object.defineProperty(e,"is",{enumerable:!0,get:function(){return p.is}});var u=(0,i.__importStar)(o(28688));e.block=u;var g=(0,i.__importStar)(o(46538));e.json=g},24392:(t,e,o)=>{o.r(e),o.d(e,{a:()=>p,default:()=>u});const i=o(7452);var n,r,s=(r=(n=i)&&n.__esModule?function(){return n.default}:function(){return n},Object.defineProperty(r,"a",{enumerable:!0,get:r}),r);const _=o(21009),a=o(66905),l=o(99666);var c=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"appCraft";a.a(this,t),this._dbs=void 0,this._databaseName=void 0,this._tableName="grid",this._version=1,this._dbs={},this._databaseName=e,this.open(this._databaseName,this._version)}return l.a(t,[{key:"open",value:function(t,e){var o=this;return new Promise(function(i,n){if(o._dbs[t+e])i(o._dbs[t+e]);else{var r=indexedDB.open(t,e);r.onupgradeneeded=function(t){var e=t.target.result;if(!1===e.objectStoreNames.contains(o._tableName)){var n=e.createObjectStore(o._tableName,{keyPath:"id"});n.createIndex("id","id",{unique:!0}),n.createIndex("name","name"),n.createIndex("header","header"),n.createIndex("data","data")}i(e)},r.onsuccess=function(n){var r=n.target.result;o._dbs[t+e]=r,i(r)},r.onerror=function(t){n(t),console.error("IndexedDB",t)}}})}},{key:"_getTransaction",value:function(){var t=_.a(s.a.mark(function t(e){var o;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this._dbs[this._databaseName+e]){t.next=4;break}o=this._dbs[this._databaseName+e],t.next=7;break;case 4:return t.next=6,this.open(this._databaseName,e);case 6:o=t.sent;case 7:return t.abrupt("return",o.transaction([this._tableName],"readwrite"));case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"_getObjectStore",value:function(){var t=_.a(s.a.mark(function t(){var e;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._getTransaction(this._version);case 2:return e=t.sent,t.abrupt("return",e.objectStore(this._tableName));case 4:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"get",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var n=e.get(t);n.onsuccess=function(t){o(t.target.result)},n.onerror=function(t){i(t)}})})}},{key:"getAll",value:function(){var t=this;return new Promise(function(e,o){t._getObjectStore().then(function(t){try{var i=t.getAll();i.onsuccess=function(t){e(t.target.result)},i.onerror=function(t){o(t)}}catch(t){o(t)}})})}},{key:"add",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var n=e.add(t);n.onsuccess=function(t){o(t.target.result)},n.onerror=function(t){i(t)}})})}},{key:"delete",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var n=e.delete(t);n.onsuccess=function(t){o(t.target.result)},n.onerror=function(t){i(t)}})})}},{key:"put",value:function(t){var e=this;return new Promise(function(o,i){e._getObjectStore().then(function(e){var n=e.put(t);n.onsuccess=function(t){o(t.target.result)},n.onerror=function(t){i(t)}})})}},{key:"clear",value:function(){var t=this;return new Promise(function(e,o){t._getObjectStore().then(function(i){var n=i.clear(t._tableName);n.onsuccess=function(t){e(t.target.result)},n.onerror=function(t){o(t)}})})}}]),t}(),h=window.location.search.split("?")[1],d=new URLSearchParams(h).get("archiveId"),p=d?new c(d):new c;const u=p},27554:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseNode=void 0;var i=o(15261),n=function(){function t(t){this.children_=[],this.selectable_=!0,this.selected_=!1,this.disabled_=!1,this.expanded_=!0,this.name_=t||""}return t.prototype.get_name=function(){return this.name_},t.prototype.set_tree=function(t){this.parent_=t},t.prototype.get_tree=function(){return this.parent_},t.prototype.get_element=function(){return this.element_},t.prototype.get_children_container=function(){return this.children_container_},t.prototype.dispose=function(){this.children_=[]},t.prototype.has_children=function(){return this.children_.length>0},t.prototype.get_children=function(){return this.children_},t.prototype.remove_child_at=function(t){return this.remove_child(this.children_[t])},t.prototype.remove_child=function(t){if(!t||t.get_tree()!==this)throw new Error("Not our child.");return t.dispose(),t},t.prototype.remove_children=function(){for(var t=[];this.has_children();)t.push(this.remove_child_at(0));return t},t.prototype.add_child_at=function(t,e){var o=t.get_tree();if(o!==this){null!=o&&o.remove_child(t);var n=this.children_[e];return this.children_.splice(e,0,t),n?(0,i.insert_before)(t.html_div,n.html_div):this.children_container_.appendChild(t.html_div),t.set_tree(this),t}},t.prototype.add=function(t){return this.add_child_at(t,this.children_.length)},t.prototype.is_selectable=function(){return this.selectable_},t.prototype.is_selected=function(){return this.selected_},t.prototype.select=function(){this.selected_=!0},t.prototype.unselect=function(){this.selected_=!1},t.prototype.set_disabled=function(t){t!==this.disabled_&&(this.disabled_=t)},t.prototype.is_disabled=function(){return this.disabled_},t.prototype.set_expanded=function(t){if(t!==this.expanded_){this.expanded_=t;var e="blocklyTreeExpanded";!this.expanded_&&this.html_div.classList.contains(e)?this.html_div.classList.remove(e):this.expanded_&&!this.html_div.classList.contains(e)&&this.html_div.classList.add(e),this.children_container_.style.display=this.expanded_?"":"none"}},t.prototype.is_expanded=function(){return this.expanded_},t}();e.BaseNode=n},28175:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Options=void 0;var i=o(31635),n=o(71519),r=o(24042),s=o(82390),_=o(3672),a=o(86865),l=o(32791),c=function(){function t(t){var e,o,i,n,r;this.disabledPatternId="",this.embossFilterId="",this.pinch=void 0,this.notch=void 0,this.degrade_translate=void 0,this.tooltip=void 0,this.timer=void 0,this.toolbox_background_class=void 0,this.in_flyout=!1;var s,c,h,d,p,u=!!t.readOnly,g=!1;u?(g=!1,e=!1,o=!1,i=!1,n=!1):(t.toolbox&&(g=(r="string"==typeof t.toolbox?(0,_.get_instance)().get(a.BINDING.xml).text_to_dom(t.toolbox):t.toolbox)instanceof Element?!(!r||!r.getElementsByTagName("category").length):r.length>0),null==(e=t.collapse)&&(e=g),null==(o=t.comments)&&(o=g),null==(i=t.disable)&&(i=g),n=null==t.sounds||t.sounds);var v=!!t.rtl,f=t.horizontalLayout;if(null==f&&(f=!1),"number"==typeof t.toolboxPosition)s=t.toolboxPosition;else{var b="end"!==t.toolboxPosition;s=f?b?l.TOOLBOX_POSITION.TOP:l.TOOLBOX_POSITION.BOTTOM:b===v?l.TOOLBOX_POSITION.RIGHT:l.TOOLBOX_POSITION.LEFT}void 0!==t.scrollbars?(c=t.scrollbars,h=t.scrollbars,d=t.scrollbars,p=t.scrollbars):(null==(c=t.scrollable?t.scrollable.workspace:void 0)&&(c=g),null==(h=t.scrollable?t.scrollable.flyout:void 0)&&(h=g),null==(d=t.show_scrollbars?t.show_scrollbars.workspace:void 0)&&(d=g),null==(p=t.show_scrollbars?t.show_scrollbars.flyout:void 0)&&(p=g));var m,y,k=t.css;null==k&&(k=!0);var w="https://static.codemao.cn/blockly/media/";t.media&&(w=t.media),m=null==t.oneBasedIndex||!!t.oneBasedIndex,y=null!=t.blockly_type?t.blockly_type:"default",this.RTL=v,this.oneBasedIndex=m,this.collapse=e,this.comments=o,this.comment_type=t.comment_type||"normal",this.disable=i,this.readOnly=u,this.maxBlocks=t.maxBlocks||1/0,this.pathToMedia=w,this.has_categories=g,this.ws_scrollable=c,this.ws_show_scrollbars=d,this.flyout_scrollable=h,this.flyout_show_scrollbars=p,this.hasSounds=n,this.hasCss=k,this.horizontalLayout=f,this.toolbox_config=r,this.gridOptions=this.parse_grid_options(t),this.zoomOptions=this.parse_zoom_options(t),this.toolboxPosition=s,this.blockly_type=y,this.connection_effect=this.parse_connection_effect_options(t),this.field_max_length=t.field_max_length,this.pinch=t.pinch,this.notch=t.notch,this.degrade_translate=t.degrade_translate,this.tooltip=t.tooltip,this.timer=t.timer,this.toolbox_background_class=t.toolbox_background_class,this.id=t.id,this.flyout=this.parse_flyout_options(t.flyout),this.custom_svg_defs=t.custom_svg_defs,this.delete_area_margin=this.parse_delete_area_margin(t,s),this.workspace={content_margin:t.workspace&&t.workspace.content_margin||"50%"},this.theme="string"==typeof t.theme?t.theme:"light",this.dropdown=this.parse_dropdown_options(t),this.delete_area=t.delete_area||"default",this.block_group=this.parse_block_group_options(t),this.auto_resize=this.parse_auto_resize_options(t),this.context_menu=this.parse_context_menu_options(t)}return t.prototype.parse_zoom_options=function(t){var e=t.zoom||{};return{controls:null!=e.controls&&e.controls,wheel:null!=e.wheel&&e.wheel,startScale:null==e.startScale?1:e.startScale,maxScale:null==e.maxScale?3:e.maxScale,minScale:null==e.minScale?.3:e.minScale,scaleSpeed:null==e.scaleSpeed?1.2:e.scaleSpeed}},t.prototype.parse_grid_options=function(t){var e=t.grid||{};return{spacing:e.spacing||35,step:void 0===e.step?4:e.step,snap:!!e.spacing&&!!e.snap}},t.prototype.parse_connection_effect_options=function(t){if(t.connection_effect){var e=t.connection_effect||{};return{type:e.type,color:e.color}}},t.prototype.parse_dropdown_options=function(t){var e=t.dropdown&&t.dropdown.menu||{},o=t.dropdown||{};return{padding:"number"==typeof o.padding?o.padding:6,arrow_type:o.arrow_type||"line",menu:{align:e.align||(s.is.mobile()||s.is.ipad()?"center":"first"),scalable:"boolean"!=typeof e.scalable||e.scalable}}},t.prototype.parse_delete_area_margin=function(t,e){var o=t.delete_area_margin;return Array.isArray(o)?o:(void 0===o&&(o=1e7),e===l.TOOLBOX_POSITION.LEFT?[o,0,o,o]:e===l.TOOLBOX_POSITION.TOP?[o,o,0,o]:e===l.TOOLBOX_POSITION.RIGHT?[o,o,o,0]:[0,o,o,o])},t.prototype.parse_flyout_options=function(t){return(0,r.parse_attr_deep)({auto_close:!0,fixed_width:void 0,min_width:void 0,max_width:void 0,corner_radius:0,padding:{top:15,bottom:20,left:30,right:30},blocks:{default_gap:16,head_block_offset:[0,0]}},t)},t.prototype.parse_block_group_options=function(t){if(t.block_group)return!0===t.block_group?{}:t.block_group},t.prototype.parse_auto_resize_options=function(t){if(t.auto_resize)return!0===t.auto_resize?{delay:0}:t.auto_resize},t.prototype.parse_context_menu_options=function(t){var e,o,i=[l.WorkspaceOptionType.PASTE,l.WorkspaceOptionType.CLEAN_UP,l.WorkspaceOptionType.DELETE_ALL,l.WorkspaceOptionType.COPY_ALL,l.WorkspaceOptionType.GLOBAL_COMMENT],n=[l.BlockOptionType.COPY_AND_PASTE,l.BlockOptionType.COPY,l.BlockOptionType.ADD_COMMENT,l.BlockOptionType.COLLAPSE,l.BlockOptionType.DELETE,l.BlockOptionType.SET_GROUP];return{workspace:(null===(e=t.context_menu)||void 0===e?void 0:e.workspace)||i,block:(null===(o=t.context_menu)||void 0===o?void 0:o.block)||n}},(0,i.__decorate)([(0,n.injectable)()],t)}();e.Options=c},28688:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.get_nested_blocks_with_comment=e.get_outer_block=e.has_context=e.is_valid_context=e.cal_num_blocks=e.fire_block_onchange=e.update_disable_status=void 0;var i=o(3684),n=o(32791),r=o(18978),s=o(24042);function _(t){var e=t.previous_connection||t.output_connection;return!(!e||!e.context||e.source_block.is_shadow())}e.update_disable_status=function(t){if(!t.is_in_flyout){for(var e=["repeat_forever","repeat_n_times","repeat_forever_until"],o=!0,i=t.get_surround_parent();i;){if(e.includes(i.type)){o=!1;break}i=i.get_surround_parent()}if(o){if(!t.disabled)return;t.disabled=!1,t.update_disabled()}else{if(t.disabled)return;t.disabled=!0,t.update_disabled()}}},e.fire_block_onchange=function(t){for(var e={},o=0,i=t.get_descendants();o<i.length;o++){var n=i[o];n.onchange&&n.onchange(e)}},e.cal_num_blocks=function(t){return t.filter(function(t){return(0,s.is_block_svg)(t)&&!t.is_shadow()&&!(t.type.includes("parameter")&&t.parent_block&&t.parent_block.type.includes("procedures_2_def"))||(0,s.is_workspace_comment)(t)}).length},e.is_valid_context=function(t){var e,o,s=t.previous_connection||t.output_connection;if(!s||!s.target_connection||!_(t))return!0;for(var a=s.target_connection,l=function(){if((0,r.assert)(a.is_superior()),a.context===s.context){if(t.type===i.PROCEDURE_BLOCK_TYPES.PARAM){var _=!1,l=t.get_field_value("param_name")||"";return a.get_source_block().inputList.forEach(function(t){var e;if(t.type===n.InputType.VALUE){var o=null===(e=t.connection)||void 0===e?void 0:e.targetBlock();o&&o.get_field_value("param_name")===l&&(_=!0)}}),{value:_}}return{value:!0}}a=(null===(e=a.source_block.previous_connection)||void 0===e?void 0:e.target_connection)||(null===(o=a.source_block.output_connection)||void 0===o?void 0:o.target_connection)};a;){var c=l();if("object"==typeof c)return c.value}return!1},e.has_context=_,e.get_outer_block=function(t){var e=t;if(!e.is_output_block())return e;for(;e.parent_block&&e.parent_block.is_output_block();)e=e.parent_block;return e.parent_block&&!e.parent_block.is_output_block()&&(e=e.parent_block),e},e.get_nested_blocks_with_comment=function(t){return t.get_all_nested_blocks().filter(function(t){return t.comment})}},29158:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Xml=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(32791),_=o(53307),a=o(24042),l=o(18978),c=o(99186),h=(0,i.__importStar)(o(15261)),d=function(){function t(){this.grouped_blocks=[],this.scoped_connections=[]}return t.prototype.workspace_to_dom=function(t,e){for(var o=h.create_dom("xml"),i=t.get_top_blocks(!0),n=0;n<i.length;n++){var r=i[n];r.is_insertion_marker()||r.parent_group||o.appendChild(this.block_to_dom_with_xy(r,e))}var s=t.get_top_comments(!0);for(n=0;n<s.length;n++){var _=s[n];o.appendChild(this.comment_to_dom_with_xy(_,e))}return o},t.prototype.dom_to_workspace=function(t,e){var o=[];this.utils.start_text_cache();var i=t.childNodes.length,n=this.events.get_group();n||this.events.set_group(!0);var s=e.is_resizes_enabled();s&&e.set_resizes_enabled(!1);try{for(var _=0;_<i;_++){var l=t.childNodes[_],c=l.nodeName.toLowerCase(),h=void 0;if("block"==c||"shadow"==c&&!this.events.is_record_undo()||"empty"==c&&!this.events.is_record_undo()?h=this.dom_to_block(l,e):"shadow"===c||"empty"===c?console.error("Shadow block cannot be a top-level block."):"comment"===c&&(h=this.dom_to_workspace_comment(l,e)),h){o.push(h.id);var d=parseInt(l.getAttribute("x")||"0",10),p=parseInt(l.getAttribute("y")||"0",10);isNaN(d)||isNaN(p)||(d=e.RTL?0-d:d,(0,a.is_block_svg)(h)&&h.parent_group?h.parent_group.move_by(r.vec2.fromValues(d,p)):h.move_by(r.vec2.fromValues(d,p)))}}}finally{n||this.events.set_group(!1),this.utils.stop_text_cache()}return s&&e.set_resizes_enabled(!0),o},t.prototype.block_to_dom=function(t,e){var o,i,n,r;if((0,a.is_block_group)(t)){n=this.block_to_dom(t.origin_block,e);var _=t.get_field_value(s.BLOCK_GROUP_NAME_FIELD_NAME);if((0,l.assert)("string"==typeof _),n.setAttribute(s.BLOCK_GROUP_NAME_XML_TAG,_),n.setAttribute(s.BLOCK_GROUP_ID_XML_TAG,t.id),t.group_type!==s.BlockGroupType.EXECUTION)return n;var c=null===(o=t.next_connection)||void 0===o?void 0:o.targetBlock(),d=c&&this.block_to_dom(c,e);if(d){d.setAttribute(s.BLOCK_GROUP_STOPPED_XML_TAG,"true");var p=n.querySelector("next["+s.LAST_NEXT_XML_TAG+'="true"]');null!=p&&p.removeAttribute(s.LAST_NEXT_XML_TAG),null!=p&&p.appendChild(d)}return n}if((n=t.is_shadow()?t.is_editable()?h.create_dom("shadow"):h.create_dom("empty"):h.create_dom("block")).setAttribute("type",t.type),e||n.setAttribute("id",t.id),t.mutationToDom){var u=t.mutationToDom();u&&(u.hasChildNodes()||u.hasAttributes())&&n.appendChild(u)}for(var g=0;g<t.inputList.length;g++)for(var v=t.inputList[g],f=0;f<v.fieldRow.length;f++){var b=v.fieldRow[f];this.field_to_dom(b,n)}if(t.parent_group?(t.parent_group.comment&&n.appendChild(this.comment_to_dom(t.parent_group.comment)),n.setAttribute("visible",t.parent_group.visibility_)):(t.comment&&n.appendChild(this.comment_to_dom(t.comment)),n.setAttribute("visible",t.visibility_)),t.data){var m=h.create_dom("data",void 0,t.data);n.appendChild(m)}for(g=0;g<t.inputList.length;g++){var y=!0;if((v=t.inputList[g]).type!=s.InputType.DUMMY&&v.connection){var k=v.connection.targetBlock();v.type==s.InputType.VALUE?r=h.create_dom("value"):v.type==s.InputType.STATEMENT&&(r=h.create_dom("statement"));var w=v.connection.get_shadow_dom();!w||k&&k.is_shadow()||r&&r.appendChild(this.clone_shadow(w)),k&&(r&&r.appendChild(this.block_to_dom(k,e)),y=!1),r&&r.setAttribute("name",v.name),y||n.appendChild(r)}}t.inputs_inline_default!=t.inputs_inline&&n.setAttribute("inline",String(t.inputs_inline)),t.is_collapsed()&&n.setAttribute("collapsed",String(!0)),t.disabled&&n.setAttribute("disabled",String(!0)),t.deletable_||n.setAttribute("deletable",String(!1)),t.movable_||n.setAttribute("movable",String(!1)),t.editable_||n.setAttribute("editable",String(!1));var E=null===(i=t.next_connection)||void 0===i?void 0:i.targetBlock();if(E){var T=h.create_dom("next",void 0,this.block_to_dom(E,e));n.appendChild(T)}else if(t.next_connection){var x=t.get_root_block();t.next_connection===x.last_connection_in_stack()&&((T=h.create_dom("next")).setAttribute(""+s.LAST_NEXT_XML_TAG,"true"),n.appendChild(T))}var I=t.next_connection&&t.next_connection.get_shadow_dom();return!I||E&&E.is_shadow()||r&&r.appendChild(this.clone_shadow(I)),n},t.prototype.field_to_dom=function(t,e){if(t.name&&t.editable){var o=h.create_dom("field",void 0,String(t.get_value())),i=t.name;(0,a.is_field_number)(t)&&(i=this.field_number_to_dom(t,o)),(0,a.is_field_default_value)(t)&&this.field_default_value_to_dom(t,o),o.setAttribute("name",i),e.appendChild(o)}},t.prototype.field_number_to_dom=function(t,e){var o=[t.min_,t.max_,t.precision_,t.mod_].join(",");if(e.setAttribute("constraints",o),null!=t.exceptions){var i=t.exceptions.join(",");e.setAttribute("exceptions",i)}var n,r=t.get_controller_option();r&&(n=r.type===s.ControllerType.SLIDER?[r.type,r.left_text,r.right_text].join(","):r.type===s.ControllerType.COLOR_PICKER?[r.type,r.color_format,r.line].join(","):r.type,e.setAttribute("controller",n));var _=t.name;return t.allow_text&&(e.setAttribute("allow_text","true"),(0,c.is_valid_number)(t.get_value())||(_="TEXT")),_},t.prototype.field_default_value_to_dom=function(t,e){var o=t.get_has_been_edited();e.setAttribute("has_been_edited",String(o))},t.prototype.clone_shadow=function(t){for(var e,o=t=h.clone_node(t,!0);o;)if(o.firstChild)o=o.firstChild;else{for(;o&&!o.nextSibling;)e=o,o=o.parentNode,e.nodeType==s.NodeType.TEXT&&""==e.data.trim()&&o.firstChild!=e&&h.remove_node(e);o&&(e=o,o=o.nextSibling,e.nodeType==s.NodeType.TEXT&&""==e.data.trim()&&h.remove_node(e))}return t},t.prototype.dom_to_block=function(t,e){var o;this.events.disable();try{o=this.dom_to_block_headless(t,e);var i=this.scoped_connections.slice();this.scoped_connections.length=0;for(var n=0;n<i.length;n++){var r=i[n],s=r[0],_=r[1];_.connect(s,!0)||this.handle_unconnectable_child_block(s.source_block,_)}if(e.rendered){o.set_connections_hidden(!0);var a=o.get_descendants(!1);for(n=a.length-1;n>=0;n--)a[n].respawn_all_shadows();for(n=(a=o.get_descendants(!1)).length-1;n>=0;n--)a[n].init_svg();for(n=a.length-1;n>=0;n--)a[n].update_collapsed(),a[n].render(!1);for(n=a.length-1;n>=0;n--)(h=a[n]).comment&&h.comment.init_svg();var l=this.grouped_blocks.slice();for(this.grouped_blocks.length=0,n=l.length-1;n>=0;n--){var c=l[n],h=c.block,d=c.id,p=c.name,u=c.group_stop_at;h.hide_into_group(p,{id:d,group_stop_at:u})}window.setTimeout(function(){if(null!=o&&null!=o.get_workspace()){o.set_connections_hidden(!1);for(var t=0,e=l;t<e.length;t++)e[t].block.set_connections_hidden(!1)}},1),o.update_disabled()}}finally{this.events.enable()}return this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:o})),o},t.prototype.dom_to_block_headless=function(t,e,o){var i=t.getAttribute("type");if(null==i)throw new ReferenceError("Block type unspecified.");var n=t.getAttribute("id")||o||void 0,r=t.nodeName.toLowerCase(),_=e.new_block(i,n),a=t.getAttribute(s.BLOCK_GROUP_ID_XML_TAG);a&&e.get_block_by_id(a)&&(a=(0,c.gen_uid)());var l=t.getAttribute(s.BLOCK_GROUP_NAME_XML_TAG);if("true"===t.getAttribute(s.BLOCK_GROUP_STOPPED_XML_TAG))for(var h=this.grouped_blocks.length-1;h>=0;h--){var d=this.grouped_blocks[h];d.block.is_starting_block()||d.block.is_output_block()||void 0!==d.group_stop_at||(d.group_stop_at=a||_.id)}for(a&&l&&this.grouped_blocks.push({block:_,id:a,name:l}),h=0;h<t.childNodes.length;h++){var p=t.childNodes[h];if(p.nodeType!=s.NodeType.TEXT){for(var u=void 0,g=void 0,v=0;v<p.childNodes.length;v++){var f=p.childNodes[v];if(f.nodeType==s.NodeType.ELEMENT){var b=f.nodeName.toLowerCase();"block"==b?g=f:"shadow"!=b&&"empty"!==b||(u=f)}}switch(p.nodeName.toLowerCase()){case"mutation":_.domToMutation&&(_.domToMutation(p),null!=_.init_svg&&_.init_svg());break;case"comment":_.set_comment_text("",p.getAttribute("id")||void 0),this.parse_comment_attributes(p,_.comment);break;case"data":_.data=p.textContent;break;case"title":case"field":this.parse_child_field(p,_);break;case"value":case"statement":var m=p.getAttribute("name"),y=_.get_input(m);if(!y||!y.connection){console.warn("Ignoring non-existent input "+m+" in block "+i);break}this.parse_connection(e,y.connection,u,g);break;case"next":if(!_.next_connection){console.error("Trying to connect to invalid next connect: "+_);break}this.parse_connection(e,_.next_connection,u,g);break;default:console.warn("Ignoring unknown tag: "+p.nodeName)}}}var k=t.getAttribute("inline");k&&_.set_inputs_inline("true"==k);var w=t.getAttribute("disabled");w&&_.set_disabled("true"==w);var E=t.getAttribute("deletable");E&&_.set_deletable("true"==E);var T=t.getAttribute("movable");T&&_.set_movable("true"==T);var x=t.getAttribute("editable");x&&_.set_editable("true"==x);var I,O=t.getAttribute("visible");O&&(I="false"===O||O===s.BlockVisibility.TRANSLUCENT?s.BlockVisibility.TRANSLUCENT:"hidden"===O?s.BlockVisibility.HIDDEN:s.BlockVisibility.VISIBLE,_.set_chunk_visibility(I));if("shadow"===r||"empty"===r){var N=_.get_children();for(h=0;h<N.length;h++)N[h].is_shadow()||console.error("Shadow block not allowed non-shadow child.");_.set_shadow(!0),"empty"===r&&_.set_editable(!1)}var A=t.getAttribute("collapsed");return A&&_.set_collapsed("true"==A),_},t.prototype.parse_fields=function(t,e){for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];i.nodeType!==s.NodeType.TEXT&&"field"===i.nodeName.toLowerCase()&&this.parse_child_field(i,e)}},t.prototype.parse_connection=function(t,e,o,i){var n;if(o&&((null===(n=e.targetBlock())||void 0===n?void 0:n.is_shadow())&&e.remove_shadow(),e.set_shadow_dom(o)),i){var r=this.dom_to_block_headless(i,t,void 0),s=r.output_connection||r.previous_connection;s?s.context?this.scoped_connections.push([s,e]):e.connect(s,!0)||this.handle_unconnectable_child_block(r,e):console.error("Child block does not have output or previous statement.")}},t.prototype.handle_unconnectable_child_block=function(t,e){if(this.runtime_data.is_pasting())t.dispose(!1,!1);else for(var o=t.get_descendants(!1),i=o.length-1;i>=0;i--)o[i].init_svg(),o[i].update_collapsed(),o[i].render(!1);e.respawn_shadow()},t.prototype.parse_child_field=function(t,e){var o=t.getAttribute("name");if(null!=o){"true"===t.getAttribute("allow_text")&&"NUM"!==o&&(o="NUM");var i=e.get_field(o);if(i){var n=t.textContent;if((0,a.is_field_number)(i)){var r=t.getAttribute("constraints");if(r){var _=r.split(",");i.set_constraints(_[0],_[1],_[2]),_[3]&&i.set_mod(_[3])}var l=t.getAttribute("exceptions");if(l){var c=[];c=l.split(",").map(function(t){return+t}),i.set_exceptions(c)}var h=t.getAttribute("allow_text"),d=void 0;h&&(d="true"===h),i.set_allow_text&&i.set_allow_text(d);var p,u=t.getAttribute("controller");if(u)p="SLIDER"===(c=u.split(","))[0]?{type:s.ControllerType.SLIDER,left_text:c[1],right_text:c[2]}:"COLOR_PICKER"===c[0]?{type:s.ControllerType.COLOR_PICKER,color_format:c[1],line:c[2]}:{type:s.ControllerType.ANGLE_SCALE},i.set_controller_option(p)}if((0,a.is_field_default_value)(i)){var g=t.getAttribute("has_been_edited");g&&i.set_has_been_edited("true"===g)}var v=i.call_validator(n);null!=v&&"FieldImage"!==i.field_type&&i.set_value(v)}}},t.prototype.dom_to_text=function(t){return this.utils.dom_to_string(t)},t.prototype.text_to_dom=function(t){return this.utils.string_to_dom(t)},t.prototype.block_to_dom_with_xy=function(t,e){var o,i=this.block_to_dom(t,e),n=(null===(o=t.parent_group)||void 0===o?void 0:o.get_relative_to_surface_xy())||t.get_relative_to_surface_xy();return i.setAttribute("x",String(Math.round(n[0]))),i.setAttribute("y",String(Math.round(n[1]))),i},t.prototype.filter_undefined_blocks=function(t,e){void 0===e&&(e=!1);for(var o=!1,i=t.querySelectorAll("block"),n=0;n<i.length;n++){var r=i[n],s=r.getAttribute("type");if(!this.Blink.Blocks[s]){o||(o=!0);var _=r.parentElement;"NEXT"===_.nodeName?_.parentElement.removeChild(_):_.removeChild(r)}}return e?{xml:t,deleted:o}:t},t.prototype.comment_to_dom_with_xy=function(t,e){var o=this.comment_to_dom(t,e),i=t.get_relative_to_surface_xy();return o.setAttribute("x",String(Math.round(i[0]))),o.setAttribute("y",String(Math.round(i[1]))),o},t.prototype.dom_to_workspace_comment=function(t,e){var o=t.getAttribute("id")||void 0,i=e.new_workspace_comment(void 0,o);return this.parse_comment_attributes(t,i),i.init_svg(),i},t.prototype.comment_to_dom=function(t,e){var o=t.get_text(),i=h.create_dom("comment",void 0,o);i.setAttribute("pinned",String(t.is_expanded()));var n=t.get_bubble_size();i.setAttribute("h",String(n.height)),i.setAttribute("w",String(n.width));var r=t.get_relative_position();return i.setAttribute("relativeleft_",""+r[0]),i.setAttribute("relativetop_",""+r[1]),i.setAttribute("auto_layout",String(t.is_auto_layout())),i.setAttribute("color_theme",String(t.get_color_theme())),e||i.setAttribute("id",t.id),i},t.prototype.parse_comment_attributes=function(t,e){if(e){e.set_text(t.textContent||"");var o=t.getAttribute("pinned");o&&e.set_expanded("true"==o);var i=parseInt(t.getAttribute("w")||"",10),n=parseInt(t.getAttribute("h")||"",10);isNaN(i)||isNaN(n)||e.set_bubble_size(i,n);var s=parseFloat(t.getAttribute("relativeleft_")||""),_=parseFloat(t.getAttribute("relativetop_")||"");isNaN(s)||isNaN(_)||e.set_relative_position(r.vec2.fromValues(s,_));var l=t.getAttribute("auto_layout");l&&e.set_auto_layout("true"===l);var c=t.getAttribute("color_theme");(0,a.is_comment_theme)(c)&&e.set_color_theme(c,!0)}},t.prototype.dom_to_workspace_element=function(t,e){var o=t.tagName.toLowerCase();return"block"===o?this.dom_to_block(t,e):"comment"===o?this.dom_to_workspace_comment(t,e):void console.error("Undefined workspace element: "+t)},t.prototype.workspace_element_to_dom=function(t,e){return(0,a.is_block_svg)(t)?this.block_to_dom(t,e):(0,a.is_workspace_comment)(t)?this.comment_to_dom(t,e):(console.error("Undefined workspace element: "+t),h.create_dom("element"))},t.prototype.workspace_element_to_dom_with_xy=function(t,e){return(0,a.is_block_svg)(t)?this.block_to_dom_with_xy(t,e):(0,a.is_workspace_comment)(t)?this.comment_to_dom_with_xy(t,e):(console.error("Undefined workspace element: "+t),h.create_dom("element"))},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.Blink)],t.prototype,"Blink",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Xml=d},29566:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Gesture=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(32791),_=o(53307),a=o(24042),l=o(18721),c=o(90185),h=o(82390),d=function(){function t(t){this.mouse_down_xy=r.vec2.create(),this.current_drag_delta_xy=r.vec2.create(),this.start_field=void 0,this.start_block=void 0,this.target_block=void 0,this.start_workspace=void 0,this.has_exceeded_drag_radius=!1,this.is_dragging_workspace=!1,this.is_dragging_block=!1,this.is_mutation_click=!1,this.on_move_wrapper=void 0,this.on_up_wrapper=void 0,this.bubble_dragger=void 0,this.block_dragger=void 0,this.workspace_dragger=void 0,this.flyout_=void 0,this.called_update_is_dragging=!1,this.has_started_=!1,this.is_ending=!1,this.should_duplicate_on_drag=!1,this.body_width=document.body.clientWidth,this.body_height=document.body.clientHeight,this.PADDING=20,this.creator_workspace_=t.workspace,this.most_recent_event=t.event}return t.prototype.dispose=function(){this.touch_manager.clear_touch_identifier(),this.creator_workspace_.clear_gesture(),this.on_move_wrapper&&this.events.unbind_event(this.on_move_wrapper),this.on_up_wrapper&&this.events.unbind_event(this.on_up_wrapper),this.start_field=void 0,this.start_block=void 0,this.target_block=void 0,this.start_workspace=void 0,this.flyout_=void 0,this.block_dragger=void 0,this.workspace_dragger=void 0},t.prototype.update_from_event=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY);this.update_drag_delta(e)&&(this.update_is_dragging(),this.touch_manager.long_stop()),this.most_recent_event=t},t.prototype.update_drag_delta=function(t){if(r.vec2.sub(this.current_drag_delta_xy,t,this.mouse_down_xy),!this.has_exceeded_drag_radius){var e=r.vec2.sqrLen(this.current_drag_delta_xy),o=this.flyout_?this.theme.blink_params.FLYOUT_DRAG_RADIUS:this.theme.blink_params.DRAG_RADIUS;return this.has_exceeded_drag_radius=e>o,this.has_exceeded_drag_radius}return!1},t.prototype.update_is_dragging_from_flyout=function(){return!(!this.target_block||this.target_block.disabled||!(0,a.is_block_svg)(this.target_block)||!(this.flyout_&&!this.flyout_.is_scrollable()||this.flyout_&&this.flyout_.is_drag_toward_workspace(this.current_drag_delta_xy))||(this.start_workspace=this.flyout_.targetWorkspace_,null!=this.start_workspace&&this.start_workspace.update_screen_calculations_if_scrolled(),this.events.get_group()||this.events.set_group(!0),this.start_block=void 0,this.target_block=this.flyout_.create_block(this.target_block,!1,r.vec2.fromValues(this.mouse_down_xy[0],this.mouse_down_xy[1])),null!=this.target_block&&(this.target_block.select(),(0,a.is_block_svg)(this.target_block)&&this.target_block.set_connections_hidden(!1)),0))},t.prototype.update_is_dragging_block=function(){return!!this.target_block&&(this.flyout_?this.is_dragging_block=this.update_is_dragging_from_flyout():(this.target_block.is_movable()||this.should_duplicate_on_drag)&&(this.is_dragging_block=!0),!!this.is_dragging_block&&(this.start_dragging_block(),!0))},t.prototype.update_is_dragging_workspace=function(){if(this.flyout_?this.flyout_.is_scrollable():this.start_workspace&&this.start_workspace.is_draggable()){if(this.flyout_)this.workspace_dragger=this.workspace_dragger_factory(this.flyout_);else{if(null==this.start_workspace)return;this.workspace_dragger=this.workspace_dragger_factory(this.start_workspace)}this.is_dragging_workspace=!0,this.workspace_dragger.start_drag()}},t.prototype.update_is_dragging=function(){this.called_update_is_dragging||(this.called_update_is_dragging=!0,this.update_is_dragging_block()||this.update_is_dragging_workspace())},t.prototype.update_is_mutation_click=function(t){this.is_mutation_click=t},t.prototype.start_dragging_block=function(){var t=this.events.get_group();this.events.set_group(t||!0),this.should_duplicate_on_drag&&this.duplicate_on_drag(),null!=this.target_block&&null!=this.start_workspace&&(this.block_dragger=this.element_dragger_factory({target:this.target_block,workspace:this.start_workspace}),this.block_dragger.start_block_drag(this.current_drag_delta_xy),this.block_dragger.drag_block(this.most_recent_event,this.current_drag_delta_xy))},t.prototype.do_start=function(t){(0,l.is_target_input)(t)?this.cancel():null!=this.start_workspace&&(this.start_workspace.is_gestures_enabled()||this.start_block?(this.has_started_=!0,this.start_workspace.update_screen_calculations_if_scrolled(),this.start_workspace.mark_focused(),this.most_recent_event=t,this.utils.hide_chaff(!!this.flyout_),this.target_block&&!this.is_mutation_click&&this.target_block.select(),(0,l.is_right_button)(t)?this.handle_right_click(t):((0,c.case_insensitive_equals)(t.type,"touchstart")&&this.touch_manager.long_start(t,this),this.mouse_down_xy=r.vec2.fromValues(t.clientX,t.clientY),this.bind_mouse_events(t))):this.touch_manager.clear_touch_identifier())},t.prototype.bind_mouse_events=function(t){this.on_move_wrapper=this.events.bind_event_with_checks(document,"mousemove",void 0,this.handle_move.bind(this)),this.on_up_wrapper=this.events.bind_event_with_checks(document,"mouseup",void 0,this.handle_up.bind(this)),t.preventDefault(),t.stopPropagation()},t.prototype.handle_move=function(t){if(h.is.mobile()){var e=t.clientX,o=t.clientY;if(e<=this.PADDING||e>=this.body_width-this.PADDING||o<=this.PADDING||o>=this.body_height-this.PADDING)return void this.handle_up(t)}if(this.update_from_event(t),this.is_dragging_workspace){if(null==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.workspace_dragger.drag(this.current_drag_delta_xy)}else if(this.is_dragging_block){if(null==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.block_dragger.drag_block(this.most_recent_event,this.current_drag_delta_xy)}t.preventDefault(),t.stopPropagation()},t.prototype.handle_up=function(t){if(!this.is_ending){this.is_ending=!0;try{if(this.update_from_event(t),this.touch_manager.long_stop(),this.is_dragging_block){if(null==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.is_dragging_block=!1,this.block_dragger.end_block_drag(t,this.current_drag_delta_xy)}else if(this.is_dragging_workspace){if(null==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.is_dragging_workspace=!1,this.workspace_dragger.end_drag(this.current_drag_delta_xy)}else this.is_field_click()?this.do_field_click(t):this.is_block_click()&&!this.is_mutation_click?this.do_block_click():this.is_workspace_click()&&this.do_workspace_click()}catch(t){console.error("Occurs error when handle mouseup: ",t)}finally{t.preventDefault(),t.stopPropagation(),this.dispose()}}},t.prototype.cancel=function(){if(!this.is_ending){this.is_ending=!0;try{if(this.touch_manager.long_stop(),this.is_dragging_block){if(null==this.block_dragger)return void console.error("Trying to drag block without dragger.");this.block_dragger.end_block_drag(this.most_recent_event,this.current_drag_delta_xy)}else if(this.is_dragging_workspace){if(null==this.workspace_dragger)return void console.error("Trying to drag workspace without dragger.");this.workspace_dragger.end_drag(this.current_drag_delta_xy)}}catch(t){console.error("Occurs error when cancel gesture: ",t)}finally{this.dispose()}}},t.prototype.handle_right_click=function(t){this.target_block?(this.bring_block_to_front(),this.utils.hide_chaff(!!this.flyout_),this.target_block.show_context_menu(t)):this.start_workspace&&!this.flyout_&&(this.utils.hide_chaff(),this.start_workspace.show_context_menu(t)),t.preventDefault(),t.stopPropagation(),this.dispose()},t.prototype.handle_ws_start=function(t,e){this.has_started_||(this.set_start_workspace(e),this.most_recent_event=t,this.do_start(t))},t.prototype.handle_flyout_start=function(t,e){if(!this.has_started_){var o=e.get_workspace();null!=o&&(this.set_start_flyout(e),this.handle_ws_start(t,o))}},t.prototype.handle_block_start=function(t,e){this.has_started_||(this.set_start_block(e),this.most_recent_event=t)},t.prototype.do_field_click=function(t){null!=this.start_field?(this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CLICK,workspace_id:this.start_field.source_block.workspace.id})),this.start_field.focus(!0),this.start_field.show_editor(t),this.bring_block_to_front()):console.error("Click event without start field.")},t.prototype.do_block_click=function(){if((0,a.is_block_svg)(this.start_block)&&(0,a.is_block_svg)(this.target_block)){var t=this.events.get_group();if(this.flyout_&&this.flyout_.is_auto_close()){if(null!=this.target_block&&!this.target_block.disabled){this.events.set_group(t||!0);var e=this.flyout_.create_block(this.target_block,!0,r.vec2.fromValues(this.mouse_down_xy[0],this.mouse_down_xy[1]));e.select(),e.schedule_snap_and_bump(),e.workspace.set_resizes_enabled(!0)}}else if(!this.widget_div.is_visible()&&this.events.is_enabled()){var o=this.start_block.id,i=this.start_block.workspace.id,n=this.start_block.get_root_block().id;this.events.fire(this.ui_event_factory({type:s.UIEventType.CLICK,workspace_id:i,block_id:o})),this.events.fire(this.ui_event_factory({type:s.UIEventType.STACK_CLICK,workspace_id:i,block_id:n}))}this.bring_block_to_front(),this.events.set_group(t)}},t.prototype.do_workspace_click=function(){this.start_workspace&&(this.runtime_data.selected&&this.runtime_data.selected.unselect(),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.STACK_CLICK,workspace_id:this.start_workspace.id})))},t.prototype.bring_block_to_front=function(){this.target_block&&this.target_block.workspace&&!this.flyout_&&this.target_block.bring_to_front()},t.prototype.set_start_field=function(t){this.start_field||(this.start_field=t)},t.prototype.set_start_block=function(t){var e;this.start_block||((0,a.is_block_svg)(t)&&"param_color"===(null===(e=t.parent_block)||void 0===e?void 0:e.element_type)&&t.is_shadow()&&(t=t.parent_block),this.start_block=t,(0,a.is_block_svg)(t)&&t.is_in_flyout&&t!=t.get_root_block()?(this.should_duplicate_on_drag=!1,this.set_target_block(t.get_root_block())):((0,a.is_block_svg)(t)&&t.is_shadow()&&("param"===t.element_type||"param_color"===t.element_type)&&(this.should_duplicate_on_drag=!0),this.set_target_block(t)))},t.prototype.set_target_block=function(t){(0,a.is_block_svg)(t)&&t.is_shadow()&&!this.should_duplicate_on_drag?this.set_target_block(t.get_parent()):this.target_block=t},t.prototype.set_start_workspace=function(t){this.start_workspace||(this.start_workspace=t)},t.prototype.set_start_flyout=function(t){this.flyout_||(this.flyout_=t)},t.prototype.is_start_from_flyout=function(){return!!this.flyout_},t.prototype.is_block_click=function(){return!!this.start_block&&!this.has_exceeded_drag_radius&&!this.is_field_click()},t.prototype.is_field_click=function(){return!!this.start_field&&this.start_field.is_currently_editable()&&!this.has_exceeded_drag_radius},t.prototype.is_workspace_click=function(){return!this.start_block&&!this.start_field&&!this.has_exceeded_drag_radius},t.prototype.is_dragging=function(){return this.is_dragging_workspace||this.is_dragging_block},t.prototype.has_started=function(){return this.has_started_},t.prototype.force_start_block_drag=function(t,e){this.handle_block_start(t,e),this.handle_ws_start(t,e.get_workspace()),this.is_dragging_block=!0,this.has_exceeded_drag_radius=!0,this.start_dragging_block()},t.prototype.duplicate_on_drag=function(){var t=void 0;if(null!=this.start_workspace)if((0,a.is_block_svg)(this.target_block)){this.events.disable();try{this.start_workspace.set_resizes_enabled(!1);var e=this.xml.block_to_dom(this.target_block);"color_picker"===e.getAttribute("type")?(t=this.xml.dom_to_block(e,this.start_workspace)).set_connections_hidden(!1):t=this.xml.dom_to_block_headless(e,this.start_workspace),t.init_svg(),t.render();var o=this.target_block.get_relative_to_surface_xy();t.move_by(o),t.set_shadow(!1)}finally{this.events.enable()}t?(this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:t})),t.select(),this.target_block=t):console.error("Something went wrong while duplicating a block.")}else console.error("Try to drag without target block.");else console.error("Try to drag without start workspace.")},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.WorkspaceElementDragger)],t.prototype,"element_dragger_factory",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.WorkspaceDragger)],t.prototype,"workspace_dragger_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Gesture=d},30624:(t,e,o)=>{e.x=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(15261),_=function(){function t(){this.container=(0,s.create_dom)("div",{style:"position: fixed",class:"blocklyWidgetDiv"}),this.container.style.display="none"}return t.prototype.show=function(t,e){},t.prototype.hide=function(){this.container.style.display="none"},t.prototype.update_value=function(t){},t.prototype.position=function(){if(this.owner&&this.container){var t=this.owner.source_block;if(t){var e=t.get_workspace().get_scale()||1;this.container.style.transformOrigin="top left",this.container.style.transform="scale("+e+")";var o=(this.theme.renderer.STATEMENT_ROW_PADDING_Y_TO_FIELD+1)*e,i=this.container.getBoundingClientRect().width;if(!t.is_shadow()){var n=this.owner.get_absolute_xy(),r=this.owner.get_size(),_=r.width*e,a=r.height*e,l=n[0]+_/2-i/2,c=n[1]+a+o;return this.container.style.left=l+"px",void(this.container.style.top=c+"px")}var h=t.svg_group,d=(0,s.get_page_offset)(h),p=t.width*e,u=t.height*e,g=d[0]+p/2-i/2,v=d[1]+u+o;this.container.style.left=g+"px",this.container.style.top=v+"px"}}},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.x=_},31113:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BaseEvent=void 0;var i=o(31635),n=o(53307),r=function(){function t(){this._workspace_id="",this._group=this.events.get_group(),this._record_undo=this.events.is_record_undo()}return t.prototype.is_null=function(){return!1},t.prototype._get_event_workspace=function(){var t=this.workspace_db.get(this._workspace_id);if(null==t)throw Error("Workspace is undefined. Event must have been generated from real Blockly events.");return t},t.prototype.is_record_undo=function(){return this._record_undo},t.prototype.set_record_undo=function(t){this._record_undo=t},t.prototype.get_workspace_id=function(){return this._workspace_id},t.prototype.set_workspace_id=function(t){this._workspace_id=t},t.prototype.get_block_id=function(){return this._block_id},t.prototype.serialize=function(){},(0,i.__decorate)([(0,n.lazy_inject)(n.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,n.lazy_inject)(n.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,n.lazy_inject)(n.BINDING.json)],t.prototype,"json",void 0),(0,i.__decorate)([(0,n.lazy_inject)(n.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),t}();e.BaseEvent=r},31132:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0});var i=o(31635);(0,i.__exportStar)(o(32791),e),(0,i.__exportStar)(o(14289),e)},32776:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SimplifiedCommentBubble=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(28688),_=o(24042),a=o(32791),l=o(15261),c=function(){function t(){this.is_showing=!1,this.selected_comment="",this.comments=new Map}return t.prototype.popup=function(t){var e,o=this;if(!this.is_showing){this.is_showing=!0,this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:a.UIEventType.COMMENT_OPEN,workspace_id:t.workspace.id,old_value:!1,new_value:!0,block_id:t.id}));var i=null===(e=t.get_icon())||void 0===e?void 0:e.children;if(i)for(var n=0;n<i.length;n++)i[n].setAttribute("data-showing","true");this.update_bubble("reset",t),this.bubble_&&(document.body.appendChild(this.bubble_),this.animate_once(this.bubble_,"showBubbleAnimation"));var r=function e(n){if(n.type!==a.UIEventType.H_SCROLLBAR_SET&&n.type!==a.UIEventType.V_SCROLLBAR_SET&&(n.type!==a.BlockEventType.CHANGE||"comment"!==n.element||n.get_new_value()||0===o.comments.size)){if(n.type===a.BlockEventType.CHANGE&&"comment_text"===n.element){var r=n.get_block_id();if(r&&o.comments.get(r))return}if(n.type!==a.UIEventType.SIMPLIFIED_COMMENT_EDIT&&n.type!==a.UIEventType.SIMPLIFIED_COMMENT_DELETE&&n.type!==a.UIEventType.SIMPLIFIED_COMMENT_SELECT){if(i)for(var s=0;s<i.length;s++)i[s].removeAttribute("data-showing");o.bubble_&&(o.animate_once(o.bubble_,"hideBubbleAnimation",function(){o.bubble_&&(0,l.remove_node)(o.bubble_)}),t.workspace.remove_change_listener(e),o.is_showing=!1,o.comments.clear(),o.selected_comment="",o.events.is_enabled()&&o.events.fire(o.ui_event_factory({type:a.UIEventType.COMMENT_OPEN,workspace_id:t.workspace.id,old_value:!0,new_value:!1,block_id:t.id})))}}};window.setTimeout(function(){return t.workspace.add_change_listener(r)})}},t.prototype.update_bubble=function(t,e){var o,i=this,n=e.get_parent_block();if(n&&(this.bubble_||(this.bubble_=document.createElement("div"),this.bubble_.classList.add("blocklySimplifiedCommentBubble","blocklySimplifiedCommentBubbleCover"),this.bubble_content_=document.createElement("div"),this.bubble_content_.classList.add("blocklySimplifiedCommentBubbleContent")),this.bubble_content_))if("reset"!==t){if("remove"===t){var r=null===(o=null===(a=this.comments.get(e.id))||void 0===a?void 0:a.parentElement)||void 0===o?void 0:o.parentElement;return r&&this.bubble_content_.removeChild(r),this.comments.delete(e.id),void(this.selected_comment="")}var a;"edit"!==t||(a=this.comments.get(e.id))&&(a.innerText=e.get_text())}else{for(;this.bubble_content_.firstChild;)this.bubble_content_.removeChild(this.bubble_content_.firstChild);for(var l=(0,s.get_outer_block)(n),c=(0,s.get_nested_blocks_with_comment)(l),h=0;h<c.length;h++){var d=c[h];(0,_.is_block_group)(d)?d.nested_blocks_with_comment.forEach(function(t){i.create_comment_bubble_text(t)}):this.create_comment_bubble_text(c[h])}}},t.prototype.create_comment_bubble_text=function(t){var e=this,o=t.comment;if(o){var i=document.createElement("div");i.classList.add("blocklySimplifiedCommentTextWrapper");var n=document.createElement("div");n.classList.add("blocklySimplifiedCommentTextDecorator"),n.style.backgroundColor=t.get_colour().toString();var r=document.createElement("div");r.classList.add("blocklySimplifiedCommentTextBg");var s=document.createElement("div");s.classList.add("blocklySimplifiedCommentText");var _=function(){return 1!==e.comments.size||t.is_output_block()};this.events.bind_event_with_checks(r,"click",o,function(){var t,i,n;if(_()){var r=e.selected_comment;if(r){e.selected_comment="";var s=e.comments.get(r);if(null!==(t=null==s?void 0:s.parentElement)&&void 0!==t&&t.classList.remove("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!0,new_value:!1,block_id:r})),r!==o.id){e.selected_comment=o.id;var l=e.comments.get(o.id);null!==(i=null==l?void 0:l.parentElement)&&void 0!==i&&i.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!1,new_value:!0,block_id:o.id}))}}else{e.selected_comment=o.id;var c=e.comments.get(o.id);null!==(n=null==c?void 0:c.parentElement)&&void 0!==n&&n.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!1,new_value:!0,block_id:o.id}))}}});var l=document.createElement("div");l.classList.add("blocklySimplifiedCommentTextSeparator");var c=new Image;c.src=this.Msg.ICON_COMMENT_EDIT,c.alt="Edit",c.classList.add("blocklySimplifiedCommentEditButton"),this.events.bind_event_with_checks(c,"click",o,function(){e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_EDIT,workspace_id:o.workspace.id,old_value:void 0,new_value:void 0,block_id:o.id})),o.focus()});var h=new Image;h.src=this.Msg.ICON_COMMENT_REMOVE,h.classList.add("blocklySimplifiedCommentRemoveButton"),this.events.bind_event_with_checks(h,"click",o,function(){e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_DELETE,workspace_id:o.workspace.id,old_value:void 0,new_value:void 0,block_id:o.id})),t.set_comment_text(void 0)});var d=new Image;d.src=this.Msg.ICON_COMMENT_MORE,d.classList.add("blocklySimplifiedCommentMoreButton"),d.setAttribute("tabindex","-1");var p=!1,u=!1;this.events.bind_event_with_checks(d,"focus",o,function(){var t,i,l,g;u||(u=!0,_()&&(l=e.selected_comment,e.selected_comment=o.id),l&&l!==o.id&&e.events.is_enabled()&&(null!==(t=null===(g=e.comments.get(l))||void 0===g?void 0:g.parentElement)&&void 0!==t&&t.classList.remove("blocklySimplifiedCommentTextActive"),e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!0,new_value:!1,block_id:l}))),e.selected_comment&&l!==o.id&&(null!==(i=null===(g=e.comments.get(o.id))||void 0===g?void 0:g.parentElement)&&void 0!==i&&i.classList.add("blocklySimplifiedCommentTextActive"),e.events.is_enabled()&&e.events.fire(e.ui_event_factory({type:a.UIEventType.SIMPLIFIED_COMMENT_SELECT,workspace_id:o.workspace.id,old_value:!1,new_value:!0,block_id:o.id}))),c.style.display="block",e.animate_once(c,"showEditButtonAnimation"),h.style.display="block",e.animate_once(h,"showRemoveButtonAnimation"),e.animate_once(d,"expandMoreButtonAnimation",function(){d.style.transform="rotate(90deg)",p=!0,u=!1}),n.style.opacity="0.4",n.style.left="26px",s.style.opacity="0.4",r.style.marginLeft="26px")}),this.events.bind_event_with_checks(d,"blur",o,function(){u||(u=!0,e.animate_once(c,"hideEditButtonAnimation",function(){return c.style.display=""}),e.animate_once(h,"hideRemoveButtonAnimation",function(){return h.style.display=""}),e.animate_once(d,"collapseMoreButtonAnimation",function(){d.style.transform="",p=!1,u=!1}),s.style.opacity="",r.style.marginLeft="",n.style.opacity="",n.style.left="")}),this.events.bind_event_with_checks(d,"click",o,function(){p?d.blur():d.focus()}),s.innerText=o.get_text(),this.comments.set(o.id,s),this.bubble_&&this.bubble_content_&&(i.appendChild(n),i.appendChild(r),r.appendChild(s),l&&i.appendChild(l),i.appendChild(c),i.appendChild(h),i.appendChild(d),this.bubble_content_.appendChild(i),this.bubble_.appendChild(this.bubble_content_))}},t.prototype.animate_once=function(t,e,o){var i=function i(){t&&(t.removeEventListener("webkitAnimationEnd",i),t.removeEventListener("animationend",i),t.classList.remove(e),o&&o())};t.addEventListener("webkitAnimationEnd",i),t.addEventListener("animationend",i),t.classList.add(e)},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.SimplifiedCommentBubble=c},32846:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.InsertionMarkerManager=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(32791),_=function(){function t(){this.top_block=void 0,this._workspace=void 0,this.last_on_stack=void 0,this.last_marker=void 0,this.closest_connection=void 0,this.first_marker=void 0,this.local_connection=void 0,this.would_delete_block_=!1,this.marker_connection=void 0,this.highlighting_block=!1,this.highlighted_block=void 0,this._available_connections=[]}return t.prototype.init=function(t){this.runtime_data.selected=t,this.top_block=t,this._workspace=t.get_workspace(),this.top_block.output_connection||(this.first_marker=this.create_marker_block(this.top_block)),this._available_connections=this._init_available_connections(t)},t.prototype.create_marker_block=function(t){var e,o=t.type;this.events.disable();try{if(null==this._workspace)throw new ReferenceError("Trying to create marker before init the insertion marker manager.");(e=this.block_factory({prototype_name:o,workspace:this._workspace,is_insertion_marker:!0})).set_insertion_marker(!0),0===e.inputList.length&&e.appendDummyInput(),e.init_svg()}finally{this.events.enable()}return e},t.prototype.would_delete_block=function(){return this.would_delete_block_},t.prototype._init_available_connections=function(t){var e=t.get_connections(!1),o=t.last_connection_in_stack();return o&&(e.push(o),this.last_on_stack=o,this.last_marker=this.create_marker_block(o.get_source_block())),e.filter(function(t){return t.in_db})},t.prototype.get_start_radius=function(){return this.closest_connection&&this.local_connection?this.theme.blink_params.CONNECTING_SNAP_RADIUS:this.theme.blink_params.SNAP_RADIUS},t.prototype._get_candidate=function(t){for(var e=this.get_start_radius(),o=void 0,i=void 0,n=0;n<this._available_connections.length;n++){var r=this._available_connections[n],s=r.closest(e,t);s.connection&&(o=s.connection,i=r,e=s.radius)}return{closest:o,local:i,radius:e}},t.prototype.should_delete=function(t,e){if(null==this.top_block)throw new ReferenceError("Deleting block not found.");var o=t&&!!t.closest&&e!==s.DeleteArea.DELETE_AREA_TOOLBOX;return!!e&&!this.top_block.get_parent()&&this.top_block.is_deletable()&&!o},t.prototype.should_update_previews=function(t,e){var o=t.local,i=t.closest,n=t.radius;if(!o||!i)return!(!this.local_connection||!this.closest_connection);if(o.type===s.CONNECTION_TYPE.OUTPUT_VALUE)return!0;if(this.local_connection&&this.closest_connection){if(this.closest_connection==i)return!1;var r=this.local_connection.get_xy()[0]+e[0]-this.closest_connection.get_xy()[0],_=this.local_connection.get_xy()[1]+e[1]-this.closest_connection.get_xy()[1],a=Math.sqrt(r*r+_*_);return!(i&&n>a-this.theme.blink_params.CURRENT_CONNECTION_PREFERENCE)}return!this.local_connection&&!this.closest_connection||(console.error("Only one of localConnection_ and closestConnection_ was set."),console.error("Returning true from shouldUpdatePreviews, but it's not clear why."),!0)},t.prototype.unhighlight_block=function(){var t=this.closest_connection,e=this.highlighted_block;if(null==t||null==e)throw new ReferenceError("Connection not found for unhighlight.");e.highlight_for_replacement(!1),this.highlighted_block=void 0,this.highlighting_block=!1},t.prototype.disconnect_marker=function(){if(this.marker_connection){var t=this.marker_connection,e=t.get_source_block(),o=e.next_connection,i=e.previous_connection;if(t!=o||i&&i.get_targe_connection())if(t.type==s.CONNECTION_TYPE.NEXT_STATEMENT&&t!=o){var n=t.get_targe_connection();if(null==n)throw new ReferenceError("Connection not found when disconnect marker.");n.get_source_block().unplug(!1);var r=i?i.get_targe_connection():void 0;e.unplug(!0),r&&r.connect(n)}else e.unplug(!0);else{var _=t.targetBlock();if(null==_)throw new ReferenceError("Target block not found when disconnect marger.");_.unplug(!1)}if(t.get_targe_connection())throw new Error("markerConnection_ still connected at the end of disconnectInsertionMarker");this.marker_connection=void 0;var a=e.get_svg_root();null!=a&&a.setAttribute("visibility","hidden")}},t.prototype.hide_preview=function(){this.highlighting_block?this.unhighlight_block():this.marker_connection&&this.disconnect_marker()},t.prototype.maybe_hide_preview=function(t){t.closest||this.hide_preview();var e=this.closest_connection&&this.local_connection,o=this.closest_connection!=t.closest,i=this.local_connection!=t.local;e&&(o||i||this.would_delete_block_)&&this.hide_preview(),this.marker_connection=void 0,this.closest_connection=void 0,this.local_connection=void 0},t.prototype.should_replace=function(){var t=this.closest_connection,e=this.local_connection;if(null==e)throw new ReferenceError("Local connection not found when trying replace/insert block.");if(null==this.top_block)throw new ReferenceError("Block not found when trying replace/insert block.");return e.type==s.CONNECTION_TYPE.OUTPUT_VALUE||e!=e.get_source_block().get_first_statement_connection()&&!(this.top_block.next_connection||e.type!=s.CONNECTION_TYPE.PREVIOUS_STATEMENT||null==t||!t.is_connected())},t.prototype.highlight_block=function(){var t=this.closest_connection,e=this.local_connection;if(null!=t&&null!=e){var o=t.targetBlock();o&&(this.highlighted_block=o,o.highlight_for_replacement(!0)),this.highlighting_block=!0}},t.prototype.connect_marker=function(){var t=this.local_connection,e=this.closest_connection;if(null!=e){var o=this.last_on_stack&&t==this.last_on_stack?this.last_marker:this.first_marker;if(null!=o&&null!=t){var i=o.get_matching_connection(t.get_source_block(),t);if(null!=i){if(i==this.marker_connection)throw new Error("Made it to connect_marker even though the marker isn't changing");o.render();var n=o.get_svg_root();null!=n&&n.setAttribute("visibility","visible"),o.position_new_block(o,i,e),i.connect(e),this.marker_connection=i}}}},t.prototype.show_preview=function(){this.should_replace()?this.highlight_block():this.connect_marker()},t.prototype.maybe_show_preview=function(t){if(!this.would_delete_block_){var e=t.closest,o=t.local;e&&(e==this.closest_connection||e.source_block.is_insertion_marker()||(this.closest_connection=e,this.local_connection=o,this.show_preview()))}},t.prototype.update=function(t,e){var o=this._get_candidate(t);this.would_delete_block_=this.should_delete(o,e),(this.would_delete_block_||this.should_update_previews(o,t))&&(this.events.disable(),this.maybe_hide_preview(o),this.maybe_show_preview(o),this.events.enable())},t.prototype.apply_connections=function(){var t,e;if(null==this.top_block)throw new ReferenceError("Top block not found when applying connections.");if(this.highlighting_block&&this.highlighted_block?this.closest_connection=(null===(t=this.highlighted_block.output_connection)||void 0===t?void 0:t.target_connection)||(null===(e=this.highlighted_block.previous_connection)||void 0===e?void 0:e.target_connection):this.marker_connection&&(this.closest_connection=this.marker_connection.target_connection),this.closest_connection){if(this.events.disable(),this.hide_preview(),this.events.enable(),this.local_connection&&this.local_connection.connect(this.closest_connection),this.top_block.is_rendered()){if(this.local_connection){var o=this.local_connection.is_superior()?this.closest_connection:this.local_connection;this.block_animations.connection_ui_effect(o.get_source_block())}this.top_block.get_root_block().bring_to_front()}return!0}return!1},t.prototype.dispose=function(){this.top_block=void 0,this._workspace=void 0,this._available_connections.length=0,this.closest_connection=void 0,this.local_connection=void 0,this.events.disable();try{this.first_marker&&(this.first_marker.dispose(),this.first_marker=void 0),this.last_marker&&(this.last_marker.dispose(),this.last_marker=void 0)}finally{this.events.enable()}this.highlighted_block=void 0},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.BlockSvg)],t.prototype,"block_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.InsertionMarkerManager=_},35239:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDB=void 0;var i=o(31635),n=o(71519),r=function(){function t(){this.db=new Map}return t.prototype.add=function(t){this.db.set(t.id,t)},t.prototype.remove=function(t){return this.db.delete(t.id)},t.prototype.get=function(t){return this.db.get(t)},(0,i.__decorate)([(0,n.injectable)()],t)}();e.WorkspaceDB=r},35425:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FieldDefaultValue=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(15261),_=function(t){function e(e){var o=t.call(this,{text:e.enable_empty?e.default_value:e.default_value||"0",opt_validator:e.opt_validator})||this;return o.has_been_edited=!1,o.enable_empty=!1,o.field_type="FieldDefaultValue",void 0!==e.enable_empty&&(o.enable_empty=e.enable_empty),o}return(0,i.__extends)(e,t),e.prototype.get_has_been_edited=function(){return this.has_been_edited},e.prototype.set_has_been_edited=function(t){if(t!==this.has_been_edited){if(this.source_block&&this.events.is_enabled()){var e=this.events.get_group();this.events.set_group(e||!0),this.events.fire(this.change_event_factory("field_default_value",{block:this.source_block,old_value:this.has_been_edited,new_value:t,name:this.name}))}this.has_been_edited=t,this.rerender()}},e.prototype.rerender=function(){this.text_element&&(this.has_been_edited?(0,s.remove_class_if_necessary)(this.text_element,"blocklyTextDefault"):(0,s.add_class)(this.text_element,"blocklyTextDefault"))},e.prototype.on_html_input_change=function(){this.set_has_been_edited(!0),t.prototype.on_html_input_change.call(this)},e.prototype.get_validated_value=function(t,e){return this.enable_empty||t?t:e},e.prototype.widget_dispose=function(){var e=this;return function(){if(e.html_input){var o=e.get_validated_value(e.html_input.value,e.html_input.defaultValue);t.prototype.widget_dispose.call(e,o)()}}},e.prototype.init=function(){t.prototype.init.call(this),this.text_element&&(this.has_been_edited||(0,s.add_class)(this.text_element,"blocklyTextDefault"))},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.widget_div)],e.prototype,"widget_div",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(14435).FieldTextInput);e.FieldDefaultValue=_},37024:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.onKeyDown_=e.Inject=void 0;var i=o(31635),n=o(77276),r=o(53307),s=o(32791),_=o(58221),a=o(12427),l=o(24042),c=(0,i.__importStar)(o(15261)),h=o(47668),d=o(23250),p=o(28688);e.Inject=function(t,e){if((0,l.is_string)(t)&&(t=document.getElementById(t)||document.querySelector(t)||void 0),(0,l.is_nil)(t)||!c.contains(document,t))throw new ReferenceError("Error: container is not in current document.");var o=(0,r.get_instance)(),i=o.get(r.BINDING.Options)(e||{}),_=c.create_dom("div","injectionDiv");_.classList.add(i.theme),t.appendChild(_);var a=g.call(this,_,i),d=function(t,e,o,i,_){e.parentWorkspace=void 0;var a=(0,r.get_instance)(),l=a.get(r.BINDING.WorkspaceSvg)(e,o,i,_);if(null!=e.zoomOptions.startScale&&l.set_scale(e.zoomOptions.startScale),t.appendChild(l.create_dom("blocklyMainBackground")),!e.has_categories&&e.toolbox_config){var d=l.add_flyout("svg");if(null==d)throw new Error("Add flyout failed.");c.insert_after(d,t)}var u=a.get(r.BINDING.Blink);return l.translate(0,0),u.mainWorkspace=l,e.readOnly||e.ws_scrollable||l.add_change_listener(function(t){var o=t.type===s.BlockEventType.MOVE||t.type===s.BlockEventType.CREATE&&"flyout:drag"!==t.source||t.type===s.UIEventType.FLYOUT_SHOW;if(!l.is_dragging()&&o){var i=l.get_metrics(),r=i.viewLeft+i.absoluteLeft-l.offset[0],_=i.viewTop+i.absoluteTop-l.offset[1],a=i.contentTop<_,c=i.contentLeft<(e.RTL?i.viewLeft:r),h=i.contentTop+i.contentHeight>i.viewHeight+_,d=i.contentLeft+i.contentWidth>(e.RTL?i.viewWidth:i.viewWidth+r);if(a||c||h||d)for(var p=l.get_top_elements(!1),u=0;u<p.length;u++){var g=p[u],v=g.get_relative_to_surface_xy(),f=g.get_height_width(),b=_-v[1];b>0&&g.move_by(n.vec2.fromValues(0,b+25));var m=_+i.viewHeight-v[1]-f.height;m<0&&g.move_by(n.vec2.fromValues(0,m));var y=r-v[0]-(e.RTL?f.width:0);y>0&&g.move_by(n.vec2.fromValues(y+25,0));var k=r+i.viewWidth-v[0]-(e.RTL?0:f.width);k<0&&g.move_by(n.vec2.fromValues(k,0))}}}),"simplified"===e.comment_type&&l.add_change_listener(function(t){if(t.type===s.BlockEventType.MOVE){var e=l.get_block_by_id(t.get_block_id());if(!e)return;var o,i=t.get_old_loc(),n=t.get_new_loc();if(i.parent_id){var r=(0,p.get_nested_blocks_with_comment)(e)[0];r&&r.comment&&r.rendered&&r.comment.init_svg(!0);var _=l.get_block_by_id(i.parent_id);if(!_)return;var a=(0,p.get_outer_block)(_);(o=(0,p.get_nested_blocks_with_comment)(a)[0])&&o.comment&&o.rendered&&o.comment.init_svg(!0)}n.parent_id&&(a=(0,p.get_outer_block)(e),(o=(0,p.get_nested_blocks_with_comment)(a)[0])&&o.comment&&o.rendered&&o.comment.init_svg(!0))}}),u.utils.svg_resize(l),u.widget_div.create_dom(),e.tooltip&&u.tooltip.create_dom(),e.pinch?u.runtime_data.register_finger_events():u.runtime_data.cancel_gesture_when_multi_touch(),e.degrade_translate&&(l.degrade_translate=e.degrade_translate),e.timer&&(u.timer=new h.TimerHandler),l}(a,i,o.get(r.BINDING.BlockDragSurfaceSvg)(_),o.get(r.BINDING.WorkspaceDragSurfaceSvg)(_,a),_);v.call(this,d),this.mainWorkspace=d;var f=o.get(r.BINDING.utils);return f.svg_resize(d),i.auto_resize&&u((0,l.debounce)(function(){return f.svg_resize(d)},i.auto_resize.delay),t),d};var u=function(t,e){return(0,i.__awaiter)(void 0,void 0,void 0,function(){return(0,i.__generator)(this,function(n){switch(n.label){case 0:return[4,Promise.resolve().then(function(){return(0,i.__importStar)(o(43591))})];case 1:return[4,n.sent().default];case 2:return new(n.sent())(t).observe(e),[2]}})})};function g(t,e){var o=(0,r.get_instance)();t.setAttribute("dir","LTR"),o.get(r.BINDING.css).inject(e.hasCss,e.pathToMedia);var i=c.create_svg_element("svg",{class:"blocklySvg"},t),n=c.create_svg_element("defs",{},i),s=String(Math.random()).substring(2);e.readOnly||(0,_.inject_extra_filters)(n),(0,_.inject_comment_filters)(n),(0,a.inject_icon_symbols)(n);var h=c.create_svg_element("filter",{id:"blur-1px"},n);c.create_svg_element("feGaussianBlur",{in:"SourceGraphic",stdDeviation:"1"},h);var d=c.create_svg_element("filter",{id:"hiblur","color-interpolation-filters":"sRGB"},n);c.create_svg_element("feColorMatrix",{type:"luminanceToAlpha",in:"SourceGraphic",result:"lumMap"},d);var p=c.create_svg_element("feComponentTransfer",{in:"lumMap",result:"highlightMask"},d);c.create_svg_element("feFuncA",{type:"discrete",tableValues:"0 0 0 0 0 0 0 1"},p),c.create_svg_element("feComposite",{operator:"in",in:"SourceGraphic",in2:"highlightMask",result:"highlights"},d),c.create_svg_element("feGaussianBlur",{in:"highlights",stdDeviation:"3",result:"highBlur"},d),c.create_svg_element("feComposite",{operator:"over",in:"highBlur",in2:"SourceGraphic",result:"final"},d);var u=c.create_svg_element("pattern",{id:"transparentPattern",x:0,y:0,width:12,height:12,patternUnits:"userSpaceOnUse"},n);c.create_svg_element("rect",{x:0,y:0,width:7,height:7,style:"fill:#FFFFFF"},u),c.create_svg_element("rect",{x:6,y:0,width:7,height:7,style:"fill:#EFEFEF"},u),c.create_svg_element("rect",{x:0,y:6,width:7,height:7,style:"fill:#EFEFEF"},u),c.create_svg_element("rect",{x:6,y:6,width:7,height:7,style:"fill:#FFFFFF"},u);var g=c.create_svg_element("filter",{id:"blocklyEmbossFilter"+s},n);c.create_svg_element("feGaussianBlur",{in:"SourceAlpha",stdDeviation:1,result:"blur"},g);var v=c.create_svg_element("feSpecularLighting",{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},g);c.create_svg_element("fePointLight",{x:-5e3,y:-1e4,z:2e4},v),c.create_svg_element("feComposite",{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},g),c.create_svg_element("feComposite",{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},g),e.embossFilterId=g.id;var f=c.create_svg_element("pattern",{id:"blocklyDisabledPattern"+s,patternUnits:"userSpaceOnUse",width:12,height:12},n);return c.create_svg_element("rect",{width:12,height:12,fill:this.theme.disabled_color.fill},f),e.disabledPatternId=f.id,e.svg_defs=n,e.svg_rnd=s,e.custom_svg_defs&&e.custom_svg_defs.forEach(function(t){n.appendChild((0,l.is_string)(t)?c.parse_to_SVG(t):t)}),i}function v(t){var e=(0,r.get_instance)(),o=e.get(r.BINDING.events),i=e.get(r.BINDING.utils),n=t.get_parent_svg();null!=n&&n.parentNode&&o.bind_event_with_checks(n.parentNode,"contextmenu",void 0,function(t){i.is_target_input(t)||t.preventDefault()});var _=o.bind_event_with_checks(window,"resize",void 0,function(){i.hide_chaff(!0),i.svg_resize(t)});t.set_resize_handler_wrapper(_),f.call(this);var a=t.get_options();if(null!=a.toolbox_config){var c=t.get_toolbox(),h=t.get_flyout();(0,l.is_nil)(c)?a.toolbox_config instanceof Element&&!(0,l.is_nil)(h)&&(h.init(t),h.show(a.toolbox_config.children),h.scroll_to_start(),t.scroll_xy[0]=h.get_width(),a.toolboxPosition==s.TOOLBOX_POSITION.RIGHT&&(t.scroll_xy[0]*=-1),t.translate(t.scroll_xy[0],0)):c.init()}if(a.ws_scrollable){var d=e.get(r.BINDING.ScrollbarPair)(t,a.ws_show_scrollbars);t.set_scrollbar(d),d.resize()}a.hasSounds&&function(t,e){var o=(0,r.get_instance)().get(r.BINDING.events),i=e.get_audio_manager();if(!i)throw new ReferenceError("audioMgr is undefined");["click","disconnect","delete"].forEach(function(e){i.load([""+t+e+".mp3",""+t+e+".wav",""+t+e+".ogg"],e)});var n=[],s=function(){for(var t=n.pop();t;)o.unbind_event(t),t=n.pop();i.preload()};n.push(o.bind_event_with_checks(document,"mousemove",void 0,s,!0)),n.push(o.bind_event_with_checks(document,"touchstart",void 0,s,!0))}(a.pathToMedia,t)}function f(){var t=this;if(!this.runtime_data.document_events_bound){var e=(0,r.get_instance)(),o=e.get(r.BINDING.events),i=e.get(r.BINDING.touch_manager);o.bind_event_with_checks(document,"keydown",void 0,b.bind(this)),o.bind_event_with_checks(document,"touchend",void 0,i.long_stop.bind(i)),o.bind_event_with_checks(document,"touchcancel",void 0,i.long_stop.bind(i)),d.is.ipad()&&o.bind_event_with_checks(window,"orientationchange",document,function(){t.utils.svg_resize(t.mainWorkspace)})}this.runtime_data.document_events_bound=!0}function b(t){if(!this.mainWorkspace.get_options().readOnly&&!this.utils.is_target_input(t)&&this.mainWorkspace.get_hotkey_enable()){var e=!1;if(27==t.keyCode)this.utils.hide_chaff();else if(8==t.keyCode||46==t.keyCode){if(t.preventDefault(),this.mainWorkspace.is_dragging())return;this.runtime_data.selected&&this.runtime_data.selected.is_deletable()&&(e=!0)}else if(t.altKey||t.ctrlKey||t.metaKey){if(this.mainWorkspace.is_dragging())return;if(this.runtime_data.selected&&this.runtime_data.selected.is_deletable()&&this.runtime_data.selected.is_movable()&&(67==t.keyCode?(this.utils.hide_chaff(),this.runtime_data.clipboard.copy(this.runtime_data.selected)):88==t.keyCode&&(this.runtime_data.clipboard.copy(this.runtime_data.selected),e=!0)),86==t.keyCode){var o=this.runtime_data.clipboard.get_content();if(o){var i=this.events.get_group();this.events.set_group(i||!0),Array.isArray(o)?this.mainWorkspace.paste_extend(o,void 0,!0):this.mainWorkspace.paste(o,void 0,!0),this.events.set_group(i)}}else 90==t.keyCode&&(this.utils.hide_chaff(),this.mainWorkspace.undo(t.shiftKey))}e&&(i=this.events.get_group(),this.events.set_group(i||!0),this.utils.hide_chaff(),this.runtime_data.selected&&this.runtime_data.selected.dispose(!1,!0),this.events.set_group(i))}}e.onKeyDown_=b},37738:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DeleteEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=o(53307),_=(0,i.__importStar)(o(23250)),a=function(t){function e(e){var o=t.call(this,e.block)||this;o.type=r.BlockEventType.DELETE,o.ids=[],o.is_shadow=!1;var i=e.block;if(_.base.is_block_svg(i)&&i.get_parent())return console.error("Connected blocks cannot be deleted."),o;var n=i.get_workspace();return null!=n&&n.rendered?o.old_xml=o.xml.workspace_element_to_dom_with_xy(i):o.old_xml=o.xml.workspace_element_to_dom(i),o.ids=[i.id],_.base.is_block_svg(i)&&(o.ids=i.get_descendant_ids(),o.is_shadow=i.is_shadow()),o}return(0,i.__extends)(e,t),e.prototype.run=function(t){var e=this._get_event_workspace();if(t)for(var o=0;o<this.ids.length;o++){var i=this.ids[o];(r=e.get_element_from_db(i))?r.dispose(!1,!1):i!==this._block_id||this.is_shadow||console.warn("Can't delete non-existent block: "+i)}else{var n=this.old_xml.getAttribute("id");if(n){var r;null!=(r=e.get_element_from_db(n))&&r.dispose(!1,!1);var s=_.dom.create_dom("xml");s.appendChild(this.old_xml),this.xml.dom_to_workspace(s,e)}}},e.prototype.serialize=function(){return{id:this._block_id,all_ids:this.ids,group:this._group}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Blink)],e.prototype,"Blink",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(8633).BlockEvent);e.DeleteEvent=a},39060:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.OutputBlockRenderer=void 0;var i=o(31635),n=o(32791),r=o(15261),s=function(t){function e(e){var o=t.call(this,e)||this;return o.padding_l=o.theme.renderer.ROW_PADDING_OUTPUT,o.padding_r=o.theme.renderer.ROW_PADDING_OUTPUT,o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT,o.min_height=o.theme.renderer.MIN_HEIGHT_OUTPUT,e.get_output_shape()===n.OutputShape.HEXAGONAL&&(o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT_HEXAGONAL),o}return(0,i.__extends)(e,t),e.prototype.min_width=function(t){return t&&this.theme.renderer.MIN_WIDTH_OUTPUT},e.prototype.render_path_start=function(t,e){e&&t.push("m "+this.edge_width+",0")},e.prototype.render_edge_shape_right=function(t,e){if(e.get_output_shape()===n.OutputShape.HEXAGONAL)t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+", "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          "+this.theme.renderer.CORNER_OFFSET_X+", "+this.theme.renderer.CORNER_OFFSET_Y),t.push("l "+this.edge_width+" "+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+", "+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+" 0 0,1 \n          0, "+this.theme.renderer.CENTER_CORNER_OFFSET),t.push("l -"+this.edge_width+" "+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+","+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          -"+this.theme.renderer.CORNER_OFFSET_X+", "+this.theme.renderer.CORNER_OFFSET_Y);else{t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 "+this.edge_width+" "+this.edge_width);var o=e.height-2*this.edge_width;o>0&&t.push("v "+o),t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 -"+this.edge_width+" "+this.edge_width)}},e.prototype.render_path_end=function(t,e){if(e.get_output_shape()===n.OutputShape.HEXAGONAL)t.push("H "+this.edge_width),t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+","+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          -"+this.theme.renderer.CORNER_OFFSET_X+", -"+this.theme.renderer.CORNER_OFFSET_Y),t.push("l -"+this.edge_width+" -"+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+","+this.theme.renderer.HEX_CENTER_CORNER_RADIUS+" 0 0,1 \n            0, -"+this.theme.renderer.CENTER_CORNER_OFFSET),t.push("l "+this.edge_width+" -"+(e.height/2-this.theme.renderer.CORNER_OFFSET_X)),t.push("a "+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+","+this.theme.renderer.HEX_TOP_BOTTOM_CORNER_RADIUS+" 0 0,1 \n          "+this.theme.renderer.CORNER_OFFSET_X+", -"+this.theme.renderer.CORNER_OFFSET_Y);else{t.push("H "+this.edge_width),t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 -"+this.edge_width+" -"+this.edge_width);var o=e.height-2*this.edge_width;o>0&&t.push("v -"+o),t.push("a "+this.edge_width+" "+this.edge_width+" 0 0 1 "+this.edge_width+" -"+this.edge_width)}},e.prototype.render_edge_shape_collapsed_right=function(t,e){var o=e.height;t.push(this.theme.renderer.COLLAPSED_PATH),t.push("v "+(o-this.min_height+e.height/2-this.theme.renderer.CORNER_OFFSET_X))},e.prototype.get_layered_value_descendants=function(t,e){var o;if(void 0===e&&(e=!0),!t.output_connection)return[];for(var i=[],r=0;r<t.inputList.length;r++){var s=t.inputList[r];if(s.type===n.InputType.VALUE){var _=null===(o=s.connection)||void 0===o?void 0:o.targetBlock();if(!(!_||e&&_.is_shadow()))for(var a=this.get_layered_value_descendants(_,e),l=0;l<a.length;l++)i[l]=i[l]||[],i[l]=i[l].concat(a[l])}}return i.unshift([t]),i},e.prototype.select_output_group_children=function(t){for(var e,o,i=t.origin_block,n=this.get_layered_value_descendants(i,!0),r=[],s=1;s<n.length;s++)r=r.concat(n[s]);var _=function(t){return t.get_original_colour()===i.get_original_colour()};for(s=0;s<r.length;s++){var a=r[s];if(e)if(o){if(!_(e)&&!_(o))break;_(o)||(e=o),o=a}else o=a;else e=a}return[e,o]},e.prototype.render_decoration_block=function(t,e,o,i,s){var _=o;return s===n.OutputShape.HEXAGONAL?(0,r.create_svg_element)("path",{d:"\n            m "+(e+t*this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET-5)+" 6,\n            h "+(_+10)+",\n            a 3,3 0 0,1 2,1\n            l "+this.edge_width+" "+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+",\n            a 2,2 0 0,1 0,2\n            l -"+this.edge_width+" "+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+"\n            a 3,3 0 0,1 -2,1\n            h -"+(_+10)+",\n            a 3,3 0 0,1 -2,-1\n            l -"+this.edge_width+" -"+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+"\n            a 2,2 0 0,1 0,-2\n            l "+this.edge_width+" -"+(this.min_height/2-this.theme.renderer.CORNER_OFFSET_X)+"\n            a 3,3 0 0,1 2,-1\n          ",fill:i.get_original_colour(),stroke:i.get_border_colour(),class:"decoration_for_collapsed_blocks"}):(0,r.create_svg_element)("path",{d:"\n            m "+(e+t*this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET)+" 6,\n            h "+_+",\n            a "+this.edge_width+" "+this.edge_width+" 0 0 1 0 "+2*this.edge_width+",\n            h -"+_+",\n            a "+this.edge_width+" "+this.edge_width+" 0 0 1 0 -"+2*this.edge_width,fill:i.get_original_colour(),stroke:i.get_border_colour(),class:"decoration_for_collapsed_blocks"})},e.prototype.render_group_decoration_blocks=function(t){t.decoration_block_paths.forEach(r.remove_node),t.decoration_block_paths.length=0;var e=this.select_output_group_children(t),o=e[0],i=e[1],s=0,_=t.get_field(n.BLOCK_GROUP_TAG_FIELD_NAME),a=this.theme.renderer.BLOCK_EDGE_WIDTH_OUTPUT+this.theme.renderer.SEP_SPACE_X+_.get_size().width+this.theme.renderer.SEP_SPACE_X+this.theme.renderer.OUTPUT_GROUP_DECORATION_PADDING,l=t.get_field(n.BLOCK_GROUP_NAME_FIELD_NAME).get_size().width,c=t.origin_block.get_output_shape()||n.OutputShape.ROUND,h=this.render_decoration_block(0,a,l,t.origin_block,c);if(i){var d=this.render_decoration_block(2,a,l,i,c);t.decoration_block_paths.unshift(d),t.svg_group.insertBefore(d,t.svg_group.lastChild),s+=this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET}if(o){var p=this.render_decoration_block(1,a,l,o,c);t.decoration_block_paths.unshift(p),t.svg_group.insertBefore(p,t.svg_group.lastChild),s+=this.theme.renderer.OUTPUT_GROUP_DECORATION_OFFSET}return t.decoration_block_paths.unshift(h),t.svg_group.insertBefore(h,t.svg_group.lastChild),s+this.theme.renderer.OUTPUT_GROUP_DECORATION_PADDING},e.prototype.get_field_padding_y=function(){return this.theme.renderer.OUTPUT_ROW_PADDING_Y_TO_FIELD},e.prototype.get_block_padding_y=function(){return this.theme.renderer.OUTPUT_ROW_PADDING_Y_TO_VALUE_BLOCK},e}(o(8845).BlockRenderer);e.OutputBlockRenderer=s},40310:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StartDragEvent=e.MoveEvent=e.EndDragEvent=e.DragAreaChangeEvent=e.DeleteEvent=e.ChangeEvent=e.CreateEvent=e.BlockEvent=void 0;var i=o(8633);Object.defineProperty(e,"BlockEvent",{enumerable:!0,get:function(){return i.BlockEvent}});var n=o(97275);Object.defineProperty(e,"CreateEvent",{enumerable:!0,get:function(){return n.CreateEvent}});var r=o(62671);Object.defineProperty(e,"ChangeEvent",{enumerable:!0,get:function(){return r.ChangeEvent}});var s=o(37738);Object.defineProperty(e,"DeleteEvent",{enumerable:!0,get:function(){return s.DeleteEvent}});var _=o(80049);Object.defineProperty(e,"DragAreaChangeEvent",{enumerable:!0,get:function(){return _.DragAreaChangeEvent}});var a=o(14860);Object.defineProperty(e,"EndDragEvent",{enumerable:!0,get:function(){return a.EndDragEvent}});var l=o(86603);Object.defineProperty(e,"MoveEvent",{enumerable:!0,get:function(){return l.MoveEvent}});var c=o(61462);Object.defineProperty(e,"StartDragEvent",{enumerable:!0,get:function(){return c.StartDragEvent}})},41221:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Tooltip=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(15261),_=o(24042),a=o(90185),l=function(){function t(){this.visible=!1,this.blocked_=!1,this.LIMIT=50,this.mouse_out_pid_=0,this.show_pid_=0,this.last_x_=0,this.last_y_=0,this.poisoned_element_=void 0,this.OFFSET_X=0,this.OFFSET_Y=10,this.RADIUS_OK=20,this.HOVER_MS=750,this.MARGINS=5,this.DIV=void 0}return t.prototype.create_dom=function(){return this.DIV||(this.DIV=(0,s.create_dom)("div","blocklyTooltipDiv"),document.body.appendChild(this.DIV)),this.DIV},t.prototype.bind_mouse_event=function(t){this.events.bind_event(t,"mouseover",void 0,this.on_mouse_over.bind(this)),this.events.bind_event(t,"mouseout",void 0,this.on_mouse_out.bind(this)),t.addEventListener("mousemove",this.on_mouse_move.bind(this),!1)},t.prototype.on_mouse_over=function(t){if(!this.blocked_){var e=t.target;e&&e.tooltip&&(this.element_!==t.target&&(this.hide(),this.poisoned_element_=void 0,this.element_=e),clearTimeout(this.mouse_out_pid_))}},t.prototype.on_mouse_out=function(t){var e=this;this.blocked_||(0,s.is_in_same_shadow)(t.target,t.relatedTarget)||(this.mouse_out_pid_=window.setTimeout(function(){e.element_=void 0,e.poisoned_element_=void 0,e.hide()},1),clearTimeout(this.show_pid_))},t.prototype.on_mouse_move=function(t){if(this.element_&&!this.blocked_)if(this.visible){var e=this.last_x_-t.pageX,o=this.last_y_-t.pageY;Math.sqrt(e*e+o*o)>this.RADIUS_OK&&this.hide()}else this.poisoned_element_!=this.element_&&(clearTimeout(this.show_pid_),this.last_x_=t.pageX,this.last_y_=t.pageY,this.show_pid_=window.setTimeout(this.show_.bind(this),this.HOVER_MS))},t.prototype.hide=function(){this.visible&&(this.visible=!1,this.DIV&&(this.DIV.style.display="none")),this.show_pid_&&clearTimeout(this.show_pid_)},t.prototype.block=function(){this.hide(),this.blocked_=!0},t.prototype.unblock=function(){this.blocked_=!1},t.prototype.show_=function(){var t;if(!this.blocked_){this.poisoned_element_=this.element_;var e=this.DIV||this.create_dom();(0,s.remove_children)(e);for(var o=null===(t=this.element_)||void 0===t?void 0:t.tooltip;(0,_.is_func)(o);)o=o();if(o){for(var i=(o=(0,a.wrap)(o,this.LIMIT)).split("\n"),n=0;n<i.length;n++){var r=document.createElement("div");r.appendChild(document.createTextNode(i[n])),e.appendChild(r)}var l=(0,s.get_viewport_size)();e.style.display="block",this.visible=!0;var c=this.last_x_;c+=this.OFFSET_X;var h=this.last_y_+this.OFFSET_Y;h+e.offsetHeight>l.height+window.scrollY&&(h-=e.offsetHeight+2*this.OFFSET_Y),c+e.offsetWidth>l.width+window.scrollX-2*this.MARGINS&&(c=l.width-e.offsetWidth-2*this.MARGINS),e.style.top=h+"px",e.style.left=c+"px"}}},t.prototype.get_element=function(){return this.element_},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Tooltip=l},42483:(t,e,o)=>{function i(t,e,o,i,n,r,s){try{var _=t[r](s),a=_.value}catch(t){return void o(t)}_.done?e(a):Promise.resolve(a).then(i,n)}function n(t){return function(){var e=this,o=arguments;return new Promise(function(n,r){var s=t.apply(e,o);function _(t){i(s,n,r,_,a,"next",t)}function a(t){i(s,n,r,_,a,"throw",t)}_(void 0)})}}o.r(e),o.d(e,{a:()=>n,default:()=>r});const r=n},43028:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockDragger=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=function(t){function e(e){var o=t.call(this,e.target,e.workspace)||this;o.type="block_dragger";var i=e.target,n=e.workspace.get_options().connection_effect;return o._dragged_connection_manager=n&&"default"===n.type?o.dragged_connection_manager:o.insertion_marker_manager,o._dragged_connection_manager.init(i),o._drag_icon_data=o.generate_icon_data(i),o}return(0,i.__extends)(e,t),e.prototype.generate_icon_data=function(t){for(var e=[],o=t.get_descendants(),i=0;i<o.length;i++)for(var n=o[i].get_icons(),r=0;r<n.length;r++){var s={location:n[r].get_location(),icon:n[r]};e.push(s)}return e},e.prototype.update_cursor_during_block_drag=function(t){null!=this._workspace&&null!=this._dragging_block?this._dragging_block.is_deletable()&&(this._would_delete_block=this._dragged_connection_manager.would_delete_block(),this._dragging_block.set_delete_style(this._would_delete_block),this._dragging_block.set_mouse_through_style(t)):console.error("Block dragger has been disposed.")},e.prototype.start_block_drag=function(e){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");this.redo_stack_before_drag=this._workspace.get_redo_stack().slice(),this.undo_stack_before_drag=this._workspace.get_undo_stack().slice(),this.events.get_group()||this.events.set_group(!0),this.parent_before_drag=this._dragging_block.get_parent(),this.parent_before_drag&&(this._dragging_block.get_root_block().svg_group.removeAttribute("filter"),this._dragging_block.unplug(),this.block_animations.disconnect_ui_effect(this._dragging_block)),t.prototype.start_block_drag.call(this,e)},e.prototype.drag_block=function(e,o){var i=t.prototype.drag_block.call(this,e,o);return this._dragged_connection_manager.update(i,this._delete_area),i},e.prototype.end_block_drag=function(t,e){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");this.drag_block(t,e),this._drag_icon_data=[],this.block_animations.disconnect_ui_effect_stop(this._dragging_block),this._dragging_block.set_mouse_through_style(!1);var o=this._workspace.get_toolbox();null!=o&&o.remove_delete_style();var i=void 0;if(this.events.is_enabled()){var n=this._workspace.current_gesture_;i=this.end_drag_event_factory({block:this._dragging_block,is_outside:this._was_outside,mouse_position:r.vec2.fromValues(t.clientX,t.clientY),is_from_flyout:(null==n?void 0:n.is_start_from_flyout())||!1,redo_stack_before_drag:this.redo_stack_before_drag})}var s=this.pixels_to_workspace_units(e),_=r.vec2.add(r.vec2.create(),this._start_xy,s);if(this._dragging_block.move_off_drag_surface(_),this._dragging_block.bring_to_front(),!this.maybe_delete_block()){if(this._dragging_block.move_connections(s),this._dragging_block.set_dragging(!1),this.events.is_enabled()){var a=this.move_event_factory({block:this._dragging_block});a.set_old_coord(this._start_xy),a.record_new(),this.events.fire(a)}this._dragged_connection_manager.apply_connections(),this._dragging_block.render(),this._dragging_block.schedule_snap_and_bump()}this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this.parent_before_drag=void 0;var l=this._workspace;this.dispose(),null!=l&&l.set_resizes_enabled(!0),this.events.fire(i),this.events.set_group(!1)},e.prototype.drag_related=function(){for(var t=0;t<this._drag_icon_data.length;t++)this._drag_icon_data[t].icon.reposition()},e.prototype.dispose=function(){t.prototype.dispose.call(this),this._drag_icon_data.length=0,this._dragged_connection_manager&&this._dragged_connection_manager.dispose()},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.insertion_marker_manager)],e.prototype,"insertion_marker_manager",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.dragged_connection_manager)],e.prototype,"dragged_connection_manager",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(58852).Z);e.BlockDragger=_},44665:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.GroupEvent=e.ContextMenuOptionEvent=e.BaseEvent=e.UIEvent=void 0;var i=o(80409);Object.defineProperty(e,"UIEvent",{enumerable:!0,get:function(){return i.UIEvent}});var n=o(31113);Object.defineProperty(e,"BaseEvent",{enumerable:!0,get:function(){return n.BaseEvent}});var r=o(77938);Object.defineProperty(e,"ContextMenuOptionEvent",{enumerable:!0,get:function(){return r.ContextMenuOptionEvent}});var s=o(15810);Object.defineProperty(e,"GroupEvent",{enumerable:!0,get:function(){return s.GroupEvent}})},45276:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Utils=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(4955),_=o(79656),a=o(59132),l=o(53307),c=o(32791),h=o(14812),d=o(99186),p=o(24042),u=o(23250),g=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*\))?/,v=/transform:\s*translate\(\s*([-+\d.e]+)px(([ ,]\s*([-+\d.e]+)\s*)px)*\)?/,f=/transform:\s*translate3d\(\s*([-+\d.e]+)px([ ,]\s*([-+\d.e]+)\s*)px([ ,]\s*([-+\d.e]+)\s*)px\)?/,b=/scale\(\s*([-+\d.e]+)\s*\)/,m=function(){function t(){var t=this;this.is_3d_supported_cached_=void 0,this.string_to_dom=function(t){if(window.ActiveXObject){var e=new window.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}var o=(new DOMParser).parseFromString(t,"text/xml");return o&&o.firstChild&&o.firstChild===o.lastChild||console.error("string_to_dom did not obtain a valid XML tree."),o.firstChild},this.cached_shadow_dom=new Map,this.shadow_type_map={text:'<shadow type="text"><field name="TEXT"></field></shadow>',math_number:'<shadow type="math_number"><field name="NUM"></field></shadow>',logic_empty:'<empty type="logic_empty"><field name="BOOL"></field></empty>',lists_get:'<shadow type="lists_get"><field name="VAR"></field></shadow>'},this.get_shadow_dom=function(e,o,i,n){var r,s=null===(r=t.cached_shadow_dom.get(t.shadow_type_map[e]))||void 0===r?void 0:r.cloneNode(!0);return s||(s=t.string_to_dom(t.shadow_type_map[e]),t.cached_shadow_dom.set(t.shadow_type_map[e],s)),i&&Object.keys(i).forEach(function(t){s.setAttribute(t,i[t])}),s.firstElementChild&&(null!=o&&(s.firstElementChild.textContent=o),n&&Object.keys(n).forEach(function(t){s.firstElementChild.setAttribute(t,n[t])})),s},this.try_parse_shadow=function(e){var o=e.match(/^<shadow[^<]+type="([^"]+)"[^>]*>[^<]*<field[^>]*>(.*)<\/field>[^<]*<\/shadow>$/)||e.match(/^<empty[^<]+type="([^"]+)"/)||[],i=o[1],n=o[2];if(i&&t.shadow_type_map[i])return t.get_shadow_dom(i,n,t.parse_attrs((e.match(/^<shadow ([^>]*)>/)||e.match(/^<empty ([^>]*)>/)||[])[1]),t.parse_attrs((e.match(/<field ([^>]*)>/)||[])[1]))},this.string_to_dom_with_shadow_cache=function(e){var o=t.try_parse_shadow(e);if(o)return o;if(!(o=t.string_to_dom(e)))throw Error("Cannot convert string to xml. "+e);return o},this.cache_reference=0,this.cached_widths=new Map,this.cached_style=""}return t.prototype.hide_chaff=function(t,e){for(var o=0,i=this.runtime_data.hide_chaff_effects;o<i.length;o++)(0,i[o])();if(this.widget_div.hide(e),!t){var n=this.workspace_db.current,r=n&&n.get_toolbox();r&&r.flyout&&r.flyout.is_auto_close()&&r.clear_selection()}},t.prototype.gen_uid=function(){return(0,d.gen_uid)()},t.prototype.is_3d_supported=function(){if(null!=this.is_3d_supported_cached_)return this.is_3d_supported_cached_;if(!window.getComputedStyle)return!1;var t=document.createElement("p"),e="none",o={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var i in document.body.insertBefore(t,null),o)if(null!=t.style.getPropertyValue(o[i])){t.style.setProperty(o[i],"translate3d(1px,1px,1px)");var n=window.getComputedStyle(t);if(!n)return document.body.removeChild(t),!1;e=n.getPropertyValue(o[i])}return document.body.removeChild(t),this.is_3d_supported_cached_="none"!==e,this.is_3d_supported_cached_},t.prototype.run_after_page_load=function(t){if(!document)throw new Error("Blockly.utils.run_after_page_load() requires browser document.");if("complete"===document.readyState)t();else var e=setInterval(function(){"complete"===document.readyState&&(clearInterval(e),t())},10)},t.prototype.svg_resize=function(t){for(var e=t,o=e.get_options().parentWorkspace;o;)o=(e=o).get_options().parentWorkspace;var i=e.get_parent_svg(),n=e.get_injection_div();if(n){var r=e.get_toolbox(),s=(null==r?void 0:r.get_width())||0,_=(null==r?void 0:r.get_height())||0,a=e.get_flyout();a&&a.is_visible()&&!a.is_auto_close()&&(s+=a.get_width());var l=n.offsetWidth,h=n.offsetHeight;if(!(l<s||h<_)){var d=l;e.options.toolboxPosition===c.TOOLBOX_POSITION.LEFT&&(d-=s,e.offset[0]=s),e.options.toolboxPosition===c.TOOLBOX_POSITION.RIGHT&&(d-=s);var p=h;e.options.toolboxPosition===c.TOOLBOX_POSITION.TOP&&(p-=_,e.offset[1]=_),e.options.toolboxPosition===c.TOOLBOX_POSITION.BOTTOM&&(p-=_),i.cachedWidth_!=d&&(i.setAttribute("width",d+"px"),i.cachedWidth_=d),i.cachedHeight_!=p&&(i.setAttribute("height",p+"px"),i.cachedHeight_=p),e.resize(),this.set_transform_style(i,t.offset[0],t.offset[1])}}},t.prototype.set_language=function(t){switch(void 0===t&&(t="zh"),t){case"en":Object.assign(this.Msg,s.en);break;case"zh":Object.assign(this.Msg,_.zh_hans);break;case"tw":Object.assign(this.Msg,a.zh_hant)}},t.prototype.get_scale=function(t){var e=1,o=t.getAttribute("transform");if(null!=o){var i=o.match(b);i&&i[1]&&(e=parseFloat(i[1]))}return e},t.prototype.get_relative_xy=function(t){var e=r.vec2.create(),o=t.getAttribute("x"),i=t.getAttribute("y");o&&(e[0]=parseInt(o,10)),i&&(e[1]=parseInt(i,10));var n=t.getAttribute("transform"),s=null!=n&&n.match(g);s&&(e[0]+=parseFloat(s[1]),s[3]&&(e[1]+=parseFloat(s[3])));var _=t.getAttribute("style");if(_&&_.indexOf("translate")>-1){var a=_.match(v);a?(e[0]+=parseFloat(a[1]),a[4]&&(e[1]+=parseFloat(a[4]))):(a=_.match(f))&&(e[0]+=parseFloat(a[1]),a[3]&&(e[1]+=parseFloat(a[3])))}return e},t.prototype.get_injection_div_xy=function(t){for(var e=r.vec2.create(),o=t;o instanceof Element;){var i=this.get_relative_xy(o),n=this.get_scale(o);if(r.vec2.scaleAndAdd(e,i,e,n),-1!=(" "+(o.getAttribute("class")||"")+" ").indexOf(" injectionDiv "))break;o=o.parentNode}return e},t.prototype.common_word_suffix=function(t){if(!t.length)return 0;if(1==t.length)return t[0].length;for(var e=0,o=0,i=(0,h.shortest_string_length)(t);o<i;o++){for(var n=t[0].substr(-o-1,1),r=1;r<t.length;r++)if(n!=t[r].substr(-o-1,1))return e;" "==n&&(e=o+1)}for(r=1;r<t.length;r++)if((n=t[r].charAt(t[r].length-o-1))&&" "!=n)return e;return i},t.prototype.common_word_prefix=function(t){if(!t.length)return 0;if(1==t.length)return t[0].length;for(var e=0,o=0,i=(0,h.shortest_string_length)(t);o<i;o++){for(var n=t[0][o],r=1;r<t.length;r++)if(n!=t[r][o])return e;" "==n&&(e=o+1)}for(r=1;r<t.length;r++)if((n=t[r][o])&&" "!=n)return e;return i},t.prototype.is_target_input=function(t){var e=t.target;return"textarea"==e.type||"text"==e.type||"number"==e.type||"email"==e.type||"password"==e.type||"search"==e.type||"tel"==e.type||"url"==e.type||e.isContentEditable},t.prototype.check_message_references=function(t){for(var e=!0,o=/%{BKY_([a-zA-Z][a-zA-Z0-9_]*)}/g,i=o.exec(t);i;){var n=i[1];null==this.Msg[n]&&(console.warn("WARNING: No message string for %{BKY_"+n+"}."),e=!1),t=t.substring(i.index+n.length+1),i=o.exec(t)}return e},t.prototype.mouse_to_svg=function(t,e,o){var i=e.createSVGPoint();return i.x=t.clientX,i.y=t.clientY,o||(o=e.getScreenCTM().inverse()),i.matrixTransform(o)},t.prototype.is_right_button=function(t){return!(!t.ctrlKey||!u.is.mac())||2==t.button},t.prototype.confirm=function(t,e){e(window.confirm(t))},t.prototype.replace_message_references=function(t){return this.tokenize_interpolation(t).reduce(function(t,e){return"number"==typeof e?t+"%"+e:""+t+e},"")},t.prototype.tokenize_interpolation=function(t){var e=[],o=t.split("");o.push("");for(var i=c.TokenizationState.BaseCase,n=[],r="",s="",_=0;_<o.length;_++){var a=o[_];switch(i){case c.TokenizationState.BaseCase:if("%"===a){(s=n.join(""))&&e.push(s),n.length=0,i=c.TokenizationState.PercentFound;break}n.push(a);break;case c.TokenizationState.PercentFound:if("%"===a){n.push(a),i=c.TokenizationState.BaseCase;break}if("0"<=a&&a<="9"){i=c.TokenizationState.DigitFound,r=a,(s=n.join(""))&&e.push(s),n.length=0;break}if("{"==a){i=c.TokenizationState.MsgRefFound;break}n.push("%",a),i=c.TokenizationState.BaseCase;break;case c.TokenizationState.DigitFound:if("0"<=a&&a<="9"){r+=a;break}e.push(parseInt(r,10)),_--,i=c.TokenizationState.BaseCase;break;case c.TokenizationState.MsgRefFound:if(""===a){n.splice(0,0,"%{"),_--,i=c.TokenizationState.BaseCase;break}if("}"!==a){n.push(a);break}var l=n.join("");if(/[A-Z]\w*/i.test(l)){var h=l.toUpperCase(),d=h.startsWith("BKY_")?h.substring(4):void 0,u=d&&d in this.Msg?this.Msg[d]:void 0;void 0!==u?(0,p.is_string)(u)?Array.prototype.push.apply(e,this.tokenize_interpolation(u)):e.push(String(u)):e.push("%{"+l+"}"),n.length=0,i=c.TokenizationState.BaseCase}else e.push("%{"+l+"}"),n.length=0,i=c.TokenizationState.BaseCase}}(s=n.join(""))&&e.push(s);var g=[];n.length=0;for(var v=0;v<e.length;++v)"string"==typeof e[v]?n.push(e[v]):((s=n.join(""))&&g.push(s),n.length=0,g.push(e[v]));return(s=n.join(""))&&g.push(s),n.length=0,g},t.prototype.get_svg_size=function(t){return{width:t.cachedWidth_,height:t.cachedHeight_}},t.prototype.set_transform_style=function(t,e,o,i){if("number"==typeof e||"number"==typeof o||"number"==typeof i){var n=t.style.transform||t.style.webkitTransform||"translate(0px, 0px) scale(1)",s=n;if("number"==typeof e||"number"==typeof o){var _=r.vec2.fromValues(0,0),a=null!=s&&s.match(g);a&&(_[0]=parseFloat(a[1]),_[1]=parseFloat(a[3]));var l="number"==typeof e?e:_[0],c="number"==typeof o?o:_[1];if(l!==_[0]||c!==_[1]){var h="translate("+l+"px, "+c+"px)";s=s.replace(/translate\([^)]+\)/,h)}}"number"==typeof i&&(s=s.replace(/scale\([^)]+\)/,"scale("+i+")")),s!==n&&(t.style.transform=s,t.style.webkitTransform=s)}},t.prototype.parse_attrs=function(t){var e={};if(!t)return e;try{t.split(/\s/).forEach(function(t){if(!(t.length<2)){var o=t.split("="),i=o[0],n=o[1];e[i]=n.slice(1,n.length-1)}})}catch(t){console.error("Parsing shadow attribute error: "+t)}return e},t.prototype.dom_to_string=function(t){return(new XMLSerializer).serializeToString(t)},t.prototype.start_text_cache=function(){this.cache_reference++},t.prototype.stop_text_cache=function(){this.cache_reference--,this.cache_reference||(this.cached_widths.clear(),this.cached_style="")},t.prototype.measure_text=function(t,e){if(!this.canvas_context){var o=document.createElement("canvas");o.style.display="none",document.body.appendChild(o),this.canvas_context=o.getContext("2d")}return this.canvas_context.font=e,this.canvas_context.measureText(t).width},t.prototype.get_cached_width=function(t){var e=this,o=t.textContent+"\n"+t.className.baseVal,i=this.cached_widths.get(o)||0;if(i)return i;try{if(!this.cached_style){var n=function(t){var o=window.getComputedStyle(t);e.cached_style=o.fontWeight+" "+o.fontSize+" "+o.fontFamily};if(document.body.contains(t))n(t);else{for(var r=t;r.parentNode&&"text"!==r.tagName.toLowerCase();)r=r.parentNode;var s=r.cloneNode(!0);document.body.appendChild(s),n(s),document.body.removeChild(s)}}i=this.measure_text(t.textContent||"",this.cached_style)}catch(e){console.warn(e);var _=t.textContent;return null==_?0:8*_.length}return this.cached_widths.set(o,i),i},(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Utils=m},46538:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.parse_visibility=e.parse_constraints=void 0;var i=o(32791);e.parse_constraints=function(t){var e=t.split(","),o=parseFloat(e[0]),i=parseFloat(e[1]),n=parseFloat(e[2]),r="true"===e[3]||null;return{min:isNaN(o)?-1/0:o,max:isNaN(i)?1/0:i,precision:isNaN(n)?0:n,mod:r}},e.parse_visibility=function(t){var e;switch(t){case"visible":e=i.BlockVisibility.VISIBLE;break;case"hidden":e=i.BlockVisibility.HIDDEN;break;case"translucent":e=i.BlockVisibility.TRANSLUCENT;break;default:return}return e}},47187:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceElement=void 0;var i=o(31635),n=o(77276),r=o(53307),s=o(32791),_=o(15261),a=o(58221),l=function(){function t(t){this.id="",this.width=0,this.height=0,this.rendered=!1,this.deletable_=!0,this.movable_=!0,this.editable_=!0,this.disabled=!1,this.location_=n.vec2.create(),this.visibility_=s.BlockVisibility.VISIBLE,this.event_initialized=!1,this.svg_group=(0,_.create_svg_element)("g",{}),this.svg_group.translate_="",this.workspace=t,this.is_in_flyout=t.is_flyout,this.RTL=t.RTL}return t.prototype.get_svg_root=function(){return this.svg_group},t.prototype.set_workspace=function(t){this.workspace=t},t.prototype.get_workspace=function(){return this.workspace},t.prototype.set_deletable=function(t){this.deletable_=t},t.prototype.is_deletable=function(){return this.deletable_&&!(this.workspace&&this.workspace.get_options().readOnly)},t.prototype.set_delete_style=function(t){null!=this.svg_group?t?(0,_.add_class_if_necessary)(this.svg_group,"blocklyDraggingDelete"):(0,_.remove_class_if_necessary)(this.svg_group,"blocklyDraggingDelete"):console.warn("Cannot set delete style for block without init.")},t.prototype.set_movable=function(t){this.movable_=t},t.prototype.is_movable=function(){return this.movable_},t.prototype.update_movable=function(){if(null==this.svg_group)throw new ReferenceError("Cannot update movable to block without svg group.");var t=this.svg_group.classList;this.is_movable()?t.add("blocklyDraggable"):t.remove("blocklyDraggable")},t.prototype.set_editable=function(t){this.editable_=t},t.prototype.is_editable=function(){return this.editable_},t.prototype.set_disabled=function(t){this.disabled=t},t.prototype.get_location=function(){return this.location_},t.prototype.move_by=function(t){var e;this.events.is_enabled()&&(e=this.move_event_factory({block:this}));var o=this.get_relative_to_surface_xy();this.translate(n.vec2.add(this.location_,o,t)),e&&e.record_new(),this.workspace.resize_contents(),e&&this.events.fire(e)},t.prototype.dispose=function(t,e){if(this.workspace){var o=this.workspace;this.runtime_data.selected===this&&(this.unselect(),o.cancel_current_gesture()),this.context_menu.current_block==this&&this.context_menu.hide(),e&&this.rendered&&this.block_animations.dispose_ui_effect(this),this.rendered=!1,(0,_.remove_node)(this.svg_group),(0,_.remove_children)(this.svg_group),o.resize_contents()}},t.prototype.on_mouse_down=function(t){if(this.workspace){var e=this.workspace.get_gesture(t);e&&e.handle_block_start(t,this)}},Object.defineProperty(t.prototype,"use_drag_surface",{get:function(){return!!this.workspace.get_block_drag_surface()},enumerable:!1,configurable:!0}),t.prototype.get_relative_to_surface_xy=function(){var t,e,o=this.use_drag_surface?null===(t=this.workspace.get_block_drag_surface())||void 0===t?void 0:t.get_group():void 0,i=this.svg_group;if(null==i)return n.vec2.create();var r=n.vec2.create();do{if(n.vec2.add(r,r,this.utils.get_relative_xy(i)),this.use_drag_surface&&(null===(e=this.workspace.get_block_drag_surface())||void 0===e?void 0:e.get_current_block())==i){var s=this.workspace.get_block_drag_surface().get_surface_translation();n.vec2.add(r,r,[s[0],s[1]])}i=i.parentNode}while(i&&i!=this.workspace.get_canvas()&&i!=o);return r},t.prototype.translate=function(t){var e=this.svg_group;if(null==e)throw new ReferenceError("Block should have svg root when translating.");e.setAttribute("transform","translate("+t[0]+", "+t[1]+")"),this.location_=t},t.prototype.move_off_drag_surface=function(t){var e;if(this.svg_group&&this.workspace.svg_block_canvas_){var o=this.svg_group.getAttribute("filter");o&&o.includes(a.FILTER.DRAG_SHADOW)&&this.svg_group.removeAttribute("filter"),this.use_drag_surface?(this.translate(t),null!==(e=this.workspace.get_block_drag_surface())&&void 0!==e&&e.clear_and_hide(this.workspace.svg_block_canvas_)):this.location_=t}},t.prototype.set_mouse_through_style=function(t){null!=this.svg_group?t?(0,_.add_class_if_necessary)(this.svg_group,"blocklyDraggingMouseThrough"):(0,_.remove_class_if_necessary)(this.svg_group,"blocklyDraggingMouseThrough"):console.warn("Cannot set the style for block without init.")},t.prototype.set_dragging=function(t){if(null!=this.svg_group){var e=this.svg_group;t?(e.translate_="",e.skew_="",(0,_.add_class_if_necessary)(e,"blocklyDragging")):(0,_.remove_class_if_necessary)(e,"blocklyDragging")}else console.warn("Cannot set delete style for block without init.")},t.prototype.move_during_drag=function(t){var e;this.svg_group&&(this.use_drag_surface?null!==(e=this.workspace.get_block_drag_surface())&&void 0!==e&&e.translate_surface(t[0],t[1]):(this.svg_group.translate_="translate("+t[0]+", "+t[1]+")",this.svg_group.setAttribute("transform",this.svg_group.translate_+this.svg_group.skew_)))},t.prototype.bring_to_front=function(){var t=this.svg_group;null!=t&&null!=t.parentNode&&t.parentNode.appendChild(t)},t.prototype.select=function(){if(this.runtime_data.selected!=this){var t=void 0;if(this.runtime_data.selected){t=this.runtime_data.selected.id,this.events.disable();try{this.runtime_data.selected.unselect()}catch(t){console.error(t)}finally{this.events.enable()}}var e=this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:t,new_value:this.id});this.runtime_data.selected=this,this.events.fire(e)}},t.prototype.unselect=function(){if(this.runtime_data.selected==this){var t=this.ui_event_factory({type:s.UIEventType.SELECTED,workspace_id:this.workspace.id,old_value:this.id,new_value:void 0});this.runtime_data.selected=void 0,this.events.fire(t)}},t.prototype.move_to_drag_surface=function(){var t;if(this.svg_group)if(this.use_drag_surface){var e=this.get_relative_to_surface_xy();this.clear_transform_attributes();var o=this.workspace.get_block_drag_surface();null!=o&&o.translate_surface(e[0],e[1]),null!=o&&o.set_blocks_and_show(this.svg_group)}else null!==(t=this.workspace.svg_block_canvas_)&&void 0!==t&&t.appendChild(this.svg_group)},t.prototype.clear_transform_attributes=function(){this.svg_group&&(0,_.remove_attribute)(this.svg_group,"transform")},t.prototype.get_bounding_rectangle=function(){var t=this.get_relative_to_surface_xy(),e=this.get_height_width();return{topLeft:t,bottomRight:n.vec2.fromValues(t[0]+e.width,t[1]+e.height)}},t.prototype.get_height_width=function(){return{height:this.height,width:this.width}},t.prototype.get_visibility=function(){return this.visibility_},t.prototype.init_events=function(){if(!this.workspace.get_options().readOnly&&!this.event_initialized){var t=this.get_svg_root();null!=t&&(this.events.bind_event_with_checks(t,"mousedown",this,this.on_mouse_down),this.event_initialized=!0)}},t.prototype.get_top_parent=function(){return this},t.prototype.for_each_descendant_element=function(t){t(this)},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.context_menu)],t.prototype,"context_menu",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.DeleteEvent)],t.prototype,"delete_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),t}();e.WorkspaceElement=l},47668:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TimerHandler=void 0;var o=function(){function t(){this.timers=[],this.override_timer()}return t.prototype.push=function(t){this.timers.push(t)},t.prototype.pop=function(t){var e=this.timers.findIndex(function(e){return e===t});e>=0&&this.timers.splice(e,1)},t.prototype.is_empty=function(){return 0===this.timers.length},t.prototype.override_timer=function(){var t=this,e=window.setTimeout.bind(window);window.setTimeout=function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];var n=e.apply(window,o),r=o[1];return o[2]||t.push(n),e(function(){t.pop(n)},r,!0),n};var o=window.clearTimeout.bind(window);window.clearTimeout=function(e){o(e),"number"==typeof e&&t.pop(e)}},t.prototype.show=function(){console.log(this.timers)},t}();e.TimerHandler=o},48071:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenu=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(32791),_=o(15261),a=o(72137),l=o(18721),c=function(){function t(){this.current_block=void 0,this.disabled=!1}return t.prototype.set_disabled=function(t){this.disabled=t},t.prototype.show=function(t,e,o){var i,n,r;if(!this.disabled)if(this.widget_div.show(this,void 0),null!==(i=this.tooltip)&&void 0!==i&&i.hide(),Array.isArray(e)&&(e={source:"",options:e}),e.options.length){var _=this.populate_(e);this.position_(_,t,o),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CONTEXT_MENU_OPEN,workspace_id:(null===(n=this.workspace_db.current)||void 0===n?void 0:n.id)||"",old_value:!1,new_value:!0,block_id:null===(r=this.current_block)||void 0===r?void 0:r.id})),window.setTimeout(function(){_.focus()},0)}else this.hide()},t.prototype.populate_=function(t){var e=this,o=document.createElement("div");o.setAttribute("tabindex","-1"),o.classList.add("menu-wrapper");for(var i=t.options,n=function(n){var r=i[n],s=document.createElement("div");if(s.classList.add("menu-item"),s.setAttribute("name",r.name),r.enabled||s.classList.add("menu_item_disable"),r.enabled&&s.classList.add("menu_item_enable"),r.icon){var a=void 0;if("string"==typeof r.icon)(a=new Image).src=r.icon,a.alt=r.text,a.style.verticalAlign="middle",a.draggable=!1;else{a=(0,_.create_svg_element)("svg",{width:16,height:16});var l=(0,_.clone_node)(r.icon,!0);a.appendChild(l)}a.style.marginRight="8px",s.appendChild(a)}var c=document.createElement("span");c.innerText=r.text,s.appendChild(c),r.selected&&s.classList.add("menu_item_selected"),r.attr&&r.attr.forEach(function(t){var e=t[0],o=t[1];"class"!==e?s.setAttribute(e,o):s.classList.add(o)}),o.appendChild(s),s.addEventListener("click",function(){var o;r.enabled&&(e.hide(),r.callback(),e.events.is_enabled()&&e.events.fire(e.contextmenu_option_event_factory({workspace_id:(null===(o=e.workspace_db.current)||void 0===o?void 0:o.id)||"",option_name:r.name,source:t.source})))})},r=0;r<i.length;r++)n(r);return o},t.prototype.position_=function(t,e,o){var i=(0,_.get_viewport_bbox)(),n={top:e.clientY,bottom:e.clientY,left:e.clientX,right:e.clientX};this.create_widget(t);var r=(0,a.get_size)(t);r.height=t.scrollHeight,o&&(0,a.adjust_bboxes_for_rtl)(i,n,r),this.widget_div.position_with_anchor(i,n,r,o),t.focus()},t.prototype.create_widget=function(t){this.widget_div.DIV.appendChild(t),t.classList.add("blocklyContextMenu"),this.events.bind_event_with_checks(t,"contextmenu",void 0,l.no_event)},t.prototype.hide=function(){var t,e;this.widget_div.hide_if_owner(this),this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:s.UIEventType.CONTEXT_MENU_OPEN,workspace_id:(null===(t=this.workspace_db.current)||void 0===t?void 0:t.id)||"",old_value:!0,new_value:!1,block_id:null===(e=this.current_block)||void 0===e?void 0:e.id})),this.current_block=void 0},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.tooltip)],t.prototype,"tooltip",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.ContextMenuOptionEvent)],t.prototype,"contextmenu_option_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.ContextMenu=c},48183:(t,e,o)=>{e.m=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(32791),a=o(15261),l=function(){function t(t){var e=this;this.listeners_=[],this.containerVisible_=!0,this.permanently_disabled_=[],this.reflow_wrapper=void 0,this.buttons_=[],this.cached_blocks=new Map,this.cached_buttons=new Map,this.default_button_gap=12,this.horizontalLayout_=!1,this.is_visible_=!1,this.width_=0,this.height_=0,this.event_wrappers_=[],this.drag_angle_range_=50,this.auto_close=!0,this.bind_transition_end_event=function(){e.svg_group&&e.targetWorkspace_&&(e.transition_end_wrapper=e.events.bind_event_with_checks(e.svg_group,"transitionend",e,function(t){if(e.targetWorkspace_&&"transform"===t.propertyName&&e.events.is_enabled()){var o=e.ui_event_factory({type:_.UIEventType.FLYOUT_SHOW,workspace_id:e.targetWorkspace_.id,old_value:!e.is_visible_,new_value:e.is_visible_});e.events.fire(o)}}))},t.get_metrics=this.get_metrics.bind(this),t.set_metrics=this.set_metrics.bind(this),t.has_categories=!1,t.in_flyout=!0,this.workspace_=this.workspace_factory(t),this.workspace_.set_scale(t.zoomOptions.startScale),this.RTL=!!t.RTL,this.toolboxPosition_=t.toolboxPosition,this.flyout_corner_radius=t.flyout.corner_radius||this.theme.renderer.FLYOUT_CORNER_RADIUS,this.padding_top=t.flyout.padding.top,this.padding_bottom=t.flyout.padding.bottom,this.padding_left=t.flyout.padding.left,this.padding_right=t.flyout.padding.right}return t.prototype.get_workspace=function(){return this.workspace_},t.prototype.get_buttons_=function(){return this.buttons_},t.prototype.set_corner_radius=function(t){this.flyout_corner_radius=t},t.prototype.filter_for_capacity=function(){if(this.targetWorkspace_)for(var t=this.targetWorkspace_.remaining_capacity(),e=this.workspace_.get_top_blocks(!1),o=0;o<e.length;o++){var i=e[o];if(-1==this.permanently_disabled_.indexOf(i)){var n=i.get_descendants();i.set_disabled(n.length>t)}}},t.prototype.reflow=function(){this.reflow_wrapper&&this.workspace_.remove_change_listener(this.reflow_wrapper);var t=this.workspace_.get_top_blocks(!1);this.reflow_internal(t),this.reflow_wrapper&&this.workspace_.add_change_listener(this.reflow_wrapper)},t.prototype.set_visible=function(t){var e=t!=this.is_visible_;this.is_visible_=t,e&&this.update_display()},t.prototype.update_display=function(){var t=this.is_visible();return this.scrollbar_&&this.scrollbar_.set_container_visible(t),t},t.prototype.block_mouse_down=function(t){var e=this,o=this;return function(i){if(e.targetWorkspace_){var n=e.targetWorkspace_.get_gesture(i);n&&(n.set_start_block(t),n.handle_flyout_start(i,o))}}},t.prototype.get_svg_root=function(){return this.svg_group},t.prototype.get_background=function(){return this.svg_background_},t.prototype.get_scrollbar=function(){return this.scrollbar_},t.prototype.is_scrollable=function(){return!!this.scrollbar_&&this.scrollbar_.is_visible()},t.prototype.is_horizontal=function(){return this.horizontalLayout_},t.prototype.is_visible=function(){return this.is_visible_&&this.containerVisible_},t.prototype.get_width=function(){return this.width_},t.prototype.get_height=function(){return this.height_},t.prototype.set_auto_close=function(t){t!==this.auto_close&&(this.auto_close=t,this.targetWorkspace_&&this.utils.svg_resize(this.targetWorkspace_),this.svg_group&&(t?((0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutAutoClose"),(0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutPinned")):((0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutAutoClose"),(0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutPinned"))))},t.prototype.is_auto_close=function(){return this.auto_close},t.prototype.create_dom=function(t){return this.svg_group=(0,a.create_svg_element)(t,{class:this.auto_close?"blocklyFlyout blocklyFlyoutHidden blocklyFlyoutAutoClose":"blocklyFlyout blocklyFlyoutHidden blocklyFlyoutPinned",width:0,height:0}),this.svg_background_=(0,a.create_svg_element)("path",{class:"blocklyFlyoutBackground"},this.svg_group),this.svg_background_.style.fill=this.theme.flyout.BACKGROUND_COLOR.toString(),this.svg_group.appendChild(this.create_workspace_with_padding_top(this.padding_top)),this.svg_group},t.prototype.create_workspace_with_padding_top=function(t){var e=this.workspace_.create_dom();return this.set_padding_top(t),e},t.prototype.set_padding_top=function(t){this.workspace_&&this.workspace_.svg_group&&("number"==typeof t?(this.workspace_.svg_group.style.transform="",this.workspace_.svg_group.setAttribute("transform","translate(0, "+t+")")):(this.workspace_.svg_group.removeAttribute("transform"),this.workspace_.svg_group.style.transform="translate(0, "+t+")"))},t.prototype.dispose=function(){this.hide(),this.unbind_scroll_events(),this.transition_end_wrapper&&(this.events.unbind_event(this.transition_end_wrapper),delete this.transition_end_wrapper),this.scrollbar_&&(this.scrollbar_.dispose(),delete this.scrollbar_),this.workspace_&&(this.workspace_.set_target_workspace(void 0),this.workspace_.dispose()),this.svg_group&&((0,a.remove_node)(this.svg_group),delete this.svg_group),delete this.svg_background_,delete this.targetWorkspace_,this.cached_blocks.forEach(function(t){return t.dispose()}),this.cached_blocks.clear(),this.cached_buttons.forEach(function(t){return t.dispose()}),this.cached_buttons.clear()},t.prototype.add_block_listeners=function(t,e){this.listeners_.push(this.events.bind_event_with_checks(t,"mousedown",void 0,this.block_mouse_down(e)))},t.prototype.xml_to_flyout_dom=function(t,e,o,i){if(void 0===i&&(i=this.workspace_),!this.targetWorkspace_)throw new Error("Trying to construct flyout dom before setting target workspace. ");var n=t.tagName.toUpperCase();if(n)switch(n){case"BLOCK":var r=this.xml.dom_to_text(t),s=this.cached_blocks.get(r);s?s.retach(i):(s=this.xml.dom_to_block(t,i),this.check_if_cache_block(t)&&this.cached_blocks.set(r,s)),s.disabled&&this.permanently_disabled_.push(s),e.push({type:"block",block:s,inline:"true"===t.getAttribute("layout_inline")});var _=this.targetWorkspace_.options.flyout.blocks.default_gap;if(s.is_starting_block()&&o.length>0&&o[o.length-1]===_){var a=this.targetWorkspace_.options.flyout.blocks.head_block_offset[1];o[o.length-1]+=a}var l=t.getAttribute("gap");return void o.push(l?parseInt(l)<=10?_:parseInt(l):_);case"SEP":var c=t.getAttribute("gap");return void(c&&o.length>0&&(o[o.length-1]=parseInt(c,10)));case"BUTTON":case"LABEL":var h=(new XMLSerializer).serializeToString(t),d=this.cached_buttons.get(h);return d?d.retach(i):(d=this.flyout_button_factory({workspace:i,target_workspace:this.targetWorkspace_,xml:t,is_label:"LABEL"===n,flyout_padding_left:this.padding_left,flyout_padding_right:this.padding_right}),this.cached_buttons.set(h,d)),e.push({type:"button",button:d}),void o.push(this.default_button_gap)}},t.prototype.show=function(t){var e=this;if(this.workspace_&&this.svg_group){var o;if(this.events.disable(),this.workspace_.set_resizes_enabled(!1),this.hide(),this.clear_old_blocks(),"string"==typeof t){var i=this.workspace_.get_target_workspace();if(!i)return void console.error("Workspace has no target workspace.");var n=i.get_toolbox_category_callback(t);o=n?n(this.workspace_.get_target_workspace()):[]}else o=t;this.set_visible(!0),this.permanently_disabled_.length=0;for(var r=[],s=[],_=0;_<o.length;_++){var l=o[_];this.xml_to_flyout_dom(l,r,s)}this.layout_(r,s),this.svg_background_?this.listeners_.push(this.events.bind_event_with_checks(this.svg_background_,"mouseover",this,function(){for(var t=e.workspace_.get_top_blocks(!1),o=0;o<t.length;o++)t[o].remove_select()})):console.warn("Flyout background svg not found."),this.reset_size(),this.workspace_.set_resizes_enabled(!0),this.reflow(),this.filter_for_capacity(),this.position(),this.reflow_wrapper=this.reflow.bind(this),this.reflow_wrapper&&this.workspace_.add_change_listener(this.reflow_wrapper),!this.auto_close&&this.targetWorkspace_&&this.utils.svg_resize(this.targetWorkspace_),this.events.enable(),(0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutVisible"),(0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutHidden")}else console.error("Workspace has not been init.")},t.prototype.check_if_cache_block=function(t){return"true"!==t.getAttribute("uncache")},t.prototype.hide=function(){var t=this;this.is_visible()&&this.targetWorkspace_&&this.svg_group&&(this.set_visible(!1),this.listeners_.forEach(function(e){return t.events.unbind_event(e)}),this.listeners_.length=0,this.position(),this.reflow_wrapper&&(this.workspace_.remove_change_listener(this.reflow_wrapper),this.reflow_wrapper=void 0),this.auto_close||this.utils.svg_resize(this.targetWorkspace_),(0,a.add_class_if_necessary)(this.svg_group,"blocklyFlyoutHidden"),(0,a.remove_class_if_necessary)(this.svg_group,"blocklyFlyoutVisible"))},t.prototype.clear_old_blocks=function(){if(this.workspace_){!function(t){for(var e=t.get_top_blocks(!1),o=0;o<e.length;o++){var i=e[o];i.get_workspace()==t&&i.detach()}}(this.workspace_);for(var t=0;t<this.buttons_.length;t++)this.buttons_[t].detach();this.buttons_.length=0}else console.error("Workspace has not been init.")},t.prototype.position_at=function(t,e,o,i){if(this.svg_group&&(this.svg_group.setAttribute("width",t.toString()),this.svg_group.setAttribute("height",e.toString()),this.utils.set_transform_style(this.svg_group,o,i)),this.scrollbar_){var n=r.vec2.fromValues(o,i);this.scrollbar_.set_origin(n),this.scrollbar_.resize()}},t.prototype.set_container_visible=function(t){if(this.svg_group){var e=t!=this.containerVisible_;if(this.containerVisible_=t,e){var o=this.update_display();this.svg_group.style.display=o?"block":"none"}}},t.prototype.scroll_to_start=function(){this.targetWorkspace_&&this.targetWorkspace_.options.flyout_scrollable&&(this.scrollbar_?this.scrollbar_.set(0):console.error("Cannot scroll flyout before scrollbar is initialized. ","Make sure Flyout.init() is called before trying to scroll. "))},t.prototype.create_block=function(t,e,o){if(!this.targetWorkspace_)throw new Error("Trying to create block from flyout before target workspace set. ");var i;this.events.disable(),this.targetWorkspace_.set_resizes_enabled(!1);try{t.remove_hover(),i=this.place_new_block(t,o)}finally{this.events.enable(),this.utils.hide_chaff()}return this.events.is_enabled()&&(this.events.get_group()||this.events.set_group(!0),null!=i&&this.events.is_enabled()&&this.events.fire(this.create_event_factory({block:i,source:e?"flyout:click":"flyout:drag"}))),this.auto_close&&this.hide(),i},t.prototype.init=function(t){if(this.targetWorkspace_=t,!this.workspace_)throw new Error("this.workspace_ can not be undefined");this.workspace_.set_target_workspace(t),t.options.flyout_scrollable&&(this.scrollbar_=this.scrollbar_factory(this.workspace_,this.horizontalLayout_,!1,"blocklyFlyoutScrollbar",t.options.flyout_show_scrollbars),this.bind_scroll_events()),this.bind_transition_end_event(),this.hide(),this.auto_close||this.targetWorkspace_.add_change_listener(this.filter_for_capacity.bind(this)),this.workspace_.get_gesture=this.targetWorkspace_.get_gesture.bind(this.targetWorkspace_)},t.prototype.unbind_scroll_events=function(){var t=this;this.event_wrappers_.forEach(function(e){return t.events.unbind_event(e)}),this.event_wrappers_=[]},t.prototype.bind_scroll_events=function(){if(!this.svg_group||!this.svg_background_)throw new Error("Trying to bind scroll event for flyout before svg init. ");this.event_wrappers_.push(this.events.bind_event_with_checks(this.svg_group,"wheel",this,this.wheel_)),this.event_wrappers_.push(this.events.bind_event_with_checks(this.svg_background_,"mousedown",this,this.on_mouse_down))},t.prototype.init_flyout_button=function(t,e,o,i){var n=t.get_svg_group()||t.create_dom(i);return"number"==typeof e&&"number"==typeof o&&t.move_to(e,o),t.show("none"!==t.default_display),this.listeners_.push(this.events.bind_event_with_checks(n,"mousedown",this,"fixed"!==t.position?this.on_mouse_down:function(){})),this.buttons_.push(t),n},t.prototype.on_mouse_down=function(t){if(this.is_visible()&&this.targetWorkspace_){var e=this.targetWorkspace_.get_gesture(t);e&&e.handle_flyout_start(t,this)}},t.prototype.clear_cached_blocks=function(){this.cached_blocks.clear()},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.FlyoutButton)],t.prototype,"flyout_button_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.WorkspaceSvg)],t.prototype,"workspace_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Scrollbar)],t.prototype,"scrollbar_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.m=l},52638:(t,e,o)=>{o.r(e),o.d(e,{a:()=>h,b:()=>s,c:()=>p,d:()=>u,default:()=>g,e:()=>r,f:()=>d,g:()=>n,h:()=>c,i:()=>l,j:()=>a,k:()=>_});const i=o(3631);var n="icon-widget-list-viewer",r=360,s=500,_=200,a=100,l=428,c=926,h="#F7F7F7",d="#CCC",p="tiled",u=i.o.IMAGE_AND_TITLE_DESC;i.H,i.H,i.H,i.H,i.H,i.v,i.H,i.H,i.v,i.H,i.H,i.v,i.H,i.v,i.H,i.H,i.v,i.H,i.H,i.H,i.v,i.v;const g=h},54053:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DraggedConnectionManager=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(32791),_=function(){function t(){this.top_block=void 0,this._workspace=void 0,this.local_connection=void 0,this.would_delete_block_=!1,this._available_connections=[],this.closest_connection=void 0,this.radius_connection=0}return t.prototype.would_delete_block=function(){return this.would_delete_block_},t.prototype.init=function(t){this.runtime_data.selected=t,this.top_block=t,this._workspace=t.get_workspace(),this._available_connections=this._init_available_connections(t)},t.prototype.dispose=function(){this.top_block=void 0,this._workspace=void 0,this._available_connections.length=0,this.closest_connection=void 0,this.local_connection=void 0},t.prototype.apply_connections=function(){if(this.closest_connection&&this.local_connection){if(this.local_connection.connect(this.closest_connection),this.top_block&&this.top_block.rendered){var t=this.local_connection.is_superior()?this.closest_connection:this.local_connection;this.block_animations.connection_ui_effect(t.get_source_block()),this.connection_effect()}this.remove_highlighting()}},t.prototype.connection_effect=function(){},t.prototype.disconnection_effect=function(){},t.prototype.update=function(t,e){var o=this.closest_connection,i=this.update_closest(t);i&&o&&o.unhighlight();var n=!!this.closest_connection&&e!=s.DeleteArea.DELETE_AREA_TOOLBOX;if(this.top_block){var r=!!e&&!this.top_block.get_parent()&&this.top_block.is_deletable();this.would_delete_block_=r&&!n}!this.would_delete_block_&&i&&this.closest_connection&&this.add_highlighting()},t.prototype.remove_highlighting=function(){this.closest_connection&&this.closest_connection.unhighlight()},t.prototype.add_highlighting=function(){this.closest_connection&&this.closest_connection.highlight()},t.prototype._init_available_connections=function(t){var e=t.get_connections(!1),o=t.last_connection_in_stack();return o&&o!=t.next_connection&&e.push(o),e.filter(function(t){return t.in_db})},t.prototype.update_closest=function(t){var e=this.closest_connection;this.closest_connection=void 0,this.local_connection=void 0,this.radius_connection=this.theme.blink_params.SNAP_RADIUS;for(var o=0;o<this._available_connections.length;o++){var i=this._available_connections[o],n=i.closest(this.radius_connection,t);n.connection&&(this.closest_connection=n.connection,this.local_connection=i,this.radius_connection=n.radius)}return e!=this.closest_connection},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.DraggedConnectionManager=_},56206:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceCommentDragger=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(24042),_=function(t){function e(e){var o=t.call(this,e.target,e.workspace)||this;return o.type="comment_dragger",o.start_relative_position=e.target.get_relative_position(),o}return(0,i.__extends)(e,t),e.prototype.drag_related=function(t){if((0,s.is_workspace_comment)(this._dragging_block)){var e=r.vec2.add(r.vec2.create(),this.start_relative_position,t);this._dragging_block.set_relative_position(e),this._dragging_block.draw_line()}},e.prototype.end_block_drag=function(t,e){if(null==this._workspace||null==this._dragging_block)throw new Error("Comment dragger has been disposed.");this.drag_block(t,e),this.block_animations.disconnect_ui_effect_stop(this._dragging_block);var o=void 0;if(this.events.is_enabled()){var i=this._workspace.current_gesture_;o=this.end_drag_event_factory({block:this._dragging_block,is_outside:this._was_outside,mouse_position:r.vec2.fromValues(t.clientX,t.clientY),is_from_flyout:(null==i?void 0:i.is_start_from_flyout())||!1,redo_stack_before_drag:this.redo_stack_before_drag})}this._dragging_block.set_mouse_through_style(!1);var n=this.pixels_to_workspace_units(e),s=r.vec2.add(r.vec2.create(),this._start_xy,n);if(this._dragging_block.move_off_drag_surface(s),this._dragging_block.bring_to_front(),!this.maybe_delete_block()&&(this._dragging_block.set_dragging(!1),this.events.is_enabled())){var _=this.move_event_factory({block:this._dragging_block});_.set_old_coord(this.start_relative_position),_.record_new(),this.events.fire(_)}if(this._workspace.set_resizes_enabled(!0),this._dragging_block.is_deletable()){var a=this._workspace.get_toolbox();null!=a&&a.remove_delete_style()}this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this.dispose(),o&&this.events.fire(o),this.events.set_group(!1)},(0,i.__decorate)([(0,n.injectable)()],e)}(o(58852).Z);e.WorkspaceCommentDragger=_},57647:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceAudio=void 0;var i=o(31635),n=o(71519),r=o(15261),s=o(82390),_=o(53307),a=function(){function t(t){this.last_sound_=void 0,this.SOUNDS_={},this.parent_workspace_=t}return t.prototype.load=function(t,e){if(t.length){var o,i;try{o=new window.Audio}catch(t){return}for(var n=0;n<t.length;n++){var r=t[n],s=r.match(/\.(\w+)$/);if(s&&o.canPlayType("audio/"+s[1])){i=new window.Audio(r);break}}i&&i.play&&(this.SOUNDS_[e]=i)}},t.prototype.play=function(t,e){var o=this.SOUNDS_[t];if(o){var i=Date.now();if(null!=this.last_sound_&&i-this.last_sound_<this.theme.blink_params.SOUND_LIMIT)return;this.last_sound_=i;var n=void 0;(n=s.is.ie(9)||s.is.ipad()||s.is.android()?o:(0,r.clone_node)(o)).volume=null==e?1:e;var _=n.play();_&&_.catch(function(t){console.log(t)})}else if(this.parent_workspace_){var a=this.parent_workspace_.get_audio_manager();a&&a.play(t,e)}},t.prototype.preload=function(){for(var t in this.SOUNDS_)if(this.SOUNDS_[t].volume=.01,s.is.ipad()||s.is.iphone())break},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.WorkspaceAudio=a},58221:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.inject_comment_filters=e.inject_extra_filters=e.FILTER=void 0;var i=(0,o(31635).__importStar)(o(23250));e.FILTER={REPLACEMENT_GLOW:"blocklyReplacementGlowFilter",DRAG_SHADOW:"blocklyDragFilter",SURROUND_SHADOW:"blocklySurroundShadowFilter",SELECTED:"blocklySelectedFilter",BOXSHADOW:"blocklyBoxShadowFilter",SURROUND_SHADOW_DARK:"blocklySurroundShadowDarkFilter",DISABLED_HEAD_ICON:"blocklyDisabledHeadIconFilter",FOCUSED:"blocklyFocusedFilter"},e.inject_extra_filters=function(t){var o;(o={})[e.FILTER.REPLACEMENT_GLOW]='\n      <filter id="'+e.FILTER.REPLACEMENT_GLOW+'" height="160%" width="180%" y="-30%" x="-40%">\n        <feGaussianBlur in="SourceGraphic" stdDeviation="1.5"></feGaussianBlur>\n        <feComponentTransfer result="outBlur">\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feFlood flood-color="#FFFFFF" flood-opacity="1" result="outColor"></feFlood>\n        <feComposite in="outColor" in2="outBlur" operator="in" result="outGlow"></feComposite>\n        <feComposite in="SourceGraphic" in2="outGlow" operator="over"></feComposite>\n      </filter>\n    ',o[e.FILTER.DRAG_SHADOW]='\n      <filter id="'+e.FILTER.DRAG_SHADOW+'" height="180%" width="160%" y="-40%" x="-30%">\n\n        <feGaussianBlur stdDeviation="1"></feGaussianBlur>\n        <feComponentTransfer result="outBlur">\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feFlood flood-color="#FFFFFF" flood-opacity="1" result="outColor"></feFlood>\n        <feComposite in="outColor" in2="outBlur" operator="in" result="outGlow"></feComposite>\n\n        <feGaussianBlur in="SourceAlpha" stdDeviation="6"></feGaussianBlur>\n        <feOffset dx="0" dy="2" />\n        <feComponentTransfer result="outShadow" >\n          <feFuncA type="linear" slope="0.4" />\n        </feComponentTransfer>\n\n        <feMerge>\n          <feMergeNode in="outShadow" />\n          <feMergeNode in="outGlow" />\n          <feMergeNode in="SourceGraphic" />\n        </feMerge>\n\n      </filter>\n    ',o[e.FILTER.SURROUND_SHADOW]='\n      <filter id="'+e.FILTER.SURROUND_SHADOW+'" height="180%" width="160%" y="-40%" x="-30%">\n        <feFlood flood-color="#000" flood-opacity="0.2" result="shadowColor"></feFlood>\n        <feComposite in="shadowColor" in2="SourceAlpha" operator="in" result="floodShape"/>\n        <feGaussianBlur in="floodShape" stdDeviation="6" result="outShadow"></feGaussianBlur>\n        <feOffset dx="0" dy="0" />\n\n        <feMerge>\n          <feMergeNode in="outShadow" />\n          <feMergeNode in="SourceGraphic" />\n        </feMerge>\n      </filter>\n    ',o[e.FILTER.SELECTED]='\n      <filter id="'+e.FILTER.SELECTED+'" height="160%" width="180%" y="-30%" x="-40%">\n        <feGaussianBlur stdDeviation="1" />\n        <feComponentTransfer result="outColor">\n          <feFuncR type="table" tableValues="1 1"></feFuncR>\n          <feFuncG type="table" tableValues="0.67 0.67"></feFuncG>\n          <feFuncB type="table" tableValues="0.21 0.21"></feFuncB>\n          <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n        </feComponentTransfer>\n        <feGaussianBlur result="outShadow" in="outColor" stdDeviation="4" />\n        <feComposite in="SourceGraphic" in2="outShadow" operator="over" />\n      </filter>\n      ',o[e.FILTER.BOXSHADOW]='\n      <filter x="-47.9%" y="-43.8%" width="195.8%" height="195.8%" filterUnits="objectBoundingBox" id="'+e.FILTER.BOXSHADOW+'">\n        <feOffset dx="0" dy="1" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n        <feGaussianBlur stdDeviation="3" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n        <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.25 0" type="matrix" in="shadowBlurOuter1" result="outGlow"></feColorMatrix>\n        <feComposite in="SourceGraphic" in2="outGlow" operator="over"></feComposite>\n      </filter>\n      ',o[e.FILTER.SURROUND_SHADOW_DARK]='\n    <filter x="-21.1%" y="-23.1%" width="140.1%" height="142.5%" filterUnits="objectBoundingBox" id="'+e.FILTER.SURROUND_SHADOW_DARK+'">\n      <feOffset dx="0" dy="0" in="SourceAlpha" result="shadowOffsetOuter1"></feOffset>\n      <feGaussianBlur stdDeviation="2" in="shadowOffsetOuter1" result="shadowBlurOuter1"></feGaussianBlur>\n      <feColorMatrix values="0 0 0 0 0   0 0 0 0 0   0 0 0 0 0  0 0 0 0.4 0" type="matrix" in="shadowBlurOuter1" result="outShadow"></feColorMatrix>\n      <feComposite in="SourceGraphic" in2="outShadow" operator="over"></feComposite>\n    </filter>\n    ',o[e.FILTER.DISABLED_HEAD_ICON]='\n      <filter id="'+e.FILTER.DISABLED_HEAD_ICON+'">\n        <feColorMatrix in="SourceGraphic" type="saturate" values="0" />\n      </filter>\n    ',o[e.FILTER.FOCUSED]="\n    <filter id="+e.FILTER.FOCUSED+' height="180%" width="160%" y="-40%" x="-30%">\n      <feGaussianBlur stdDeviation="1"></feGaussianBlur>\n      <feComponentTransfer result="outColor">\n        <feFuncA type="table" tableValues="0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"></feFuncA>\n      </feComponentTransfer>\n      <feGaussianBlur result="outShadow" in="outColor" stdDeviation="4"></feGaussianBlur>\n      <feComposite in="SourceGraphic" in2="outShadow" operator="over"></feComposite>\n    </filter>\n    ';var n=o,r=Array.prototype.map.call(t.children,function(t){return t.id});Object.keys(n).filter(function(t){return r.indexOf(t)<0}).map(function(t){return i.dom.parse_to_SVG(n[t])}).forEach(function(e){t.appendChild(e)})},e.inject_comment_filters=function(t){var e={RED:["#FF838D","#F04E39"],BLUE:["#70C3FF","#3882FF"],GREEN:["#A1FF5C","#26E32D"],YELLOW:["#FFE06B","#FFB93A"]};Object.keys(e).forEach(function(o){if(i.base.is_comment_theme(o)){var n=i.dom.create_svg_element("linearGradient",{id:"CommentLinearGradient-"+o,x1:"50%",y1:"0%",x2:"50%",y2:"85.4676513%"},t);i.dom.create_svg_element("stop",{offset:"0%","stop-color":e[o][0]},n),i.dom.create_svg_element("stop",{offset:"100%","stop-color":e[o][1]},n)}})}},58852:(t,e,o)=>{e.Z=void 0;var i=o(31635),n=o(77276),r=o(53307),s=o(32791),_=function(){function t(t,e){this.parent_before_drag=void 0,this._delete_area=s.DeleteArea.DELETE_AREA_NONE,this._would_delete_block=!1,this._was_outside=!1,this._was_workspace=!0,this.redo_stack_before_drag=[],this.undo_stack_before_drag=[],this._dragging_block=t,this._workspace=e,this._start_xy=t.get_relative_to_surface_xy()}return t.prototype.update_cursor_during_block_drag=function(t){null!=this._workspace&&null!=this._dragging_block?this._dragging_block.is_deletable()&&(this._would_delete_block=this._delete_area===s.DeleteArea.DELETE_AREA_TOOLBOX,this._dragging_block.set_delete_style(this._would_delete_block),this._dragging_block.set_mouse_through_style(t)):console.error("Block dragger has been disposed.")},t.prototype.start_block_drag=function(t){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");this.redo_stack_before_drag||this.undo_stack_before_drag||(this.redo_stack_before_drag=this._workspace.get_redo_stack().slice(),this.undo_stack_before_drag=this._workspace.get_undo_stack().slice()),this.events.get_group()||this.events.set_group(!0),this._workspace.set_resizes_enabled(!1),this.tooltip.hide();var e=this.pixels_to_workspace_units(t),o=n.vec2.create();if(n.vec2.add(o,this._start_xy,e),this._dragging_block.translate(o),this._dragging_block.set_dragging(!0),this._dragging_block.bring_to_front(),this._dragging_block.move_to_drag_surface(),this._dragging_block.is_deletable()){var i=this._workspace.get_toolbox();null!=i&&i.add_delete_style()}if(this.events.is_enabled()){var r=this._workspace.current_gesture_;this.events.fire(this.start_drag_event_factory({block:this._dragging_block,is_from_flyout:(null==r?void 0:r.is_start_from_flyout())||!1}))}},t.prototype.drag_block=function(t,e){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");var o=this.pixels_to_workspace_units(e),i=n.vec2.create();return n.vec2.add(i,this._start_xy,o),this._dragging_block.move_during_drag(i),this.drag_related(o),this.handle_dragging_around_delete_area(t),this.handle_dragging_around_blocks_area(t),this.handle_dragging_around_workspace(t),o},t.prototype.handle_dragging_around_delete_area=function(t){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");var e,o=this._workspace.is_delete_area(t);!!o!=!!this._delete_area&&this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:s.DragArea.DELETE_AREA,is_in:!!o})),this._delete_area=o,this.events.fire(e)},t.prototype.handle_dragging_around_blocks_area=function(t){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");var e,o=!this._workspace.is_inside_blocks_area(t);o!==this._was_outside&&(this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:s.DragArea.INJECTION_DIV,is_in:!o})),this._was_outside=o),this.update_cursor_during_block_drag(o),this.events.fire(e)},t.prototype.handle_dragging_around_workspace=function(t){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");var e,o=this._workspace.is_inside_workspace_area(t);o!==this._was_workspace&&(this.events.is_enabled()&&(e=this.drag_area_change_event_factory({block:this._dragging_block,area:s.DragArea.WORKSPACE,is_in:o})),this._was_workspace=o),this.events.fire(e)},t.prototype.maybe_delete_block=function(){if(null==this._workspace||null==this._dragging_block)throw new Error("Block dragger has been disposed.");if(!this._dragging_block.is_deletable())return!1;if(this._would_delete_block){if(this.events.is_enabled()){var t=this.move_event_factory({block:this._dragging_block});t.set_old_coord(this._start_xy),t.record_new(),this.events.fire(t)}this._dragging_block.dispose(!1,!0)}return this._would_delete_block},t.prototype.pixels_to_workspace_units=function(t){var e=n.vec2.create();if(null==this._workspace)return console.error("Block dragger has been disposed."),n.vec2.create();var o=this._workspace.get_scale();return n.vec2.scale(e,t,1/o),e},t.prototype.dispose=function(){this._dragging_block=void 0,this._workspace=void 0},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.block_animations)],t.prototype,"block_animations",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.tooltip)],t.prototype,"tooltip",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.DragAreaChangeEvent)],t.prototype,"drag_area_change_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.EndDragEvent)],t.prototype,"end_drag_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.StartDragEvent)],t.prototype,"start_drag_event_factory",void 0),t}();e.Z=_},59132:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.zh_hant=void 0,e.zh_hant={DUPLICATE_BLOCK:"複製",COPY_ALL:"複製所有積木（ %1 個)",ADD_COMMENT:"加入註解",REMOVE_COMMENT:"移除註解",DELETE_BLOCK:"刪除積木",DELETE_X_BLOCKS:"刪除所有積木（ %1 個）",DELETE_ALL_BLOCKS:"刪除共 %1 個積木？",CLEAN_UP:"整理積木",COLLAPSE_BLOCK:"收合積木",COLLAPSE_ALL:"收合積木",EXPAND_BLOCK:"展開積木",EXPAND_ALL:"展開所有積木",UNDO:"撤销",REDO:"重試",PASTE:"粘貼",COPY_AND_PASTE:"複製並粘貼",GLOBAL_COMMENT:"添加全局註釋",COMMENT:"註釋",BLUE_COMMENT:"藍色註釋",GREEN_COMMENT:"綠色註釋",YELLOW_COMMENT:"黃色註釋",RED_COMMENT:"紅色註釋",DELETE_COMMENT:"刪除註釋",WHATS_THIS:"這是什麼功能…",SAY_SOMETHING:"說些什麼…",START_ON_CLICK:"%1 當 開始 被點擊",start_on_click_2:"%1 當 開始 被點擊 %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 當 切換到 當前屏幕",SELF_LISTEN:"%1 當 收到 廣播 %2 %3 %4",SELF_BROADCAST:"發送廣播 %1",SELF_BROADCAST_AND_WAIT:"發送廣播 %1 並等待",WHEN:"%1 當 %2 %3",TERMINATE:"停止",REPEAT_FOREVER:"重複執行 %1 %2",REPEAT_N_TIMES:"重複執行 %1 次 %2 %3",REPEAT_FOREVER_UNTIL:"重複執行直到 %1 %2 %3",BREAK:"退出循環",WARP:"一步執行 %1 %2",WAIT_SECS:"等待 %1 秒",WAIT_UNTIL:"保持等待直到 %1",DESTRUCT:"銷毀自身",CONTROLS_IF_MSG_IF:"如果",CONTROLS_IF_MSG_ELSEIF:"否則如果",CONTROLS_IF_MSG_ELSE:"否則",CONTROLS_IF_TOOLTIP_1:"當值為 true 時，執行一些陳述式。",CONTROLS_IF_TOOLTIP_2:"當值為 true 時，執行第一個陳述式，否則，執行第二個陳述式。",CONTROLS_IF_TOOLTIP_3:"如果第一個值為 true，則執行第一個陳述式。否則，當第二個值為 true 時，則執行第二個陳述式。",CONTROLS_IF_TOOLTIP_4:"如果第一個值為 true，則執行第一個陳述式。否則當第二個值為 true 時，則執行第二個陳述式。如果前幾個敘述都不為 ture，則執行最後一個陳述式。",TELL:"告訴 %1 執行 %2 %3",SYNC_TELL:"告訴 %1 執行並等待 %2 %3",GET_TIME:"當前 %1",YEAR:"年",MONTH:"月",DATE:"日",WEEK:"星期",WEEK0:"星期日",WEEK1:"星期一",WEEK2:"星期二",WEEK3:"星期三",WEEK4:"星期四",WEEK5:"星期五",WEEK6:"星期六",HOUR:"小時",MINUTE:"分鐘",SECOND:"秒",TIMER:"計時器",RESET_TIMER:"重置 計時器",MATH_NUMBER_TOOLTIP:"一個數字。",RANDOM_NUM:"在 %1 到 %2 間隨機整數",DIVISIBLE_BY:"%1 能被 %2 整除",CALCULATE:"數學運算 %1",CALCULATE_TOOLTIPS:"輸入數學等式進行運算",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"返回兩個數字的總和。",MATH_ARITHMETIC_TOOLTIP_MINUS:"返回兩個數字的差。",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"返回兩個數字的乘積。",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"返回兩個數字的商。",MATH_ARITHMETIC_TOOLTIP_POWER:"返回第二個數字的指數的第一個數字。",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"算數平方根",MATH_SINGLE_TOOLTIP_ROOT:"返回指定數字的平方根。",MATH_SINGLE_OP_ABSOLUTE:"絕對值",MATH_SINGLE_TOOLTIP_ABS:"返回指定數字的絕對值。",MATH_SINGLE_TOOLTIP_NEG:"返回指定數字的逻辑非",MATH_SINGLE_TOOLTIP_LN:"返回指定數字的自然對數。",MATH_SINGLE_TOOLTIP_LOG10:"返回指定數字的對數。",MATH_SINGLE_TOOLTIP_EXP:"返回指定數字指數的 e",MATH_SINGLE_TOOLTIP_POW10:"返回指定數字指數的10的冪次。",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"將數字無條件進位或無條件捨去。.",MATH_ROUND_OPERATOR_ROUND:"四捨五入",MATH_ROUND_OPERATOR_ROUNDUP:"向上舍入",MATH_ROUND_OPERATOR_ROUNDDOWN:"向下舍入",MATH_MODULO_TITLE:"%1 ÷ %2 的餘數",MATH_MODULO_TOOLTIP:"回傳兩個數字相除的餘數。",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"是偶数",MATH_IS_ODD:"是奇数",MATH_IS_PRIME:"是质数",MATH_IS_WHOLE:"是整数",MATH_IS_POSITIVE:"是正数",MATH_IS_NEGATIVE:"是负数",MATH_IS_TOOLTIP:"如果数字是偶数、奇数、非负整数、正数、负数或如果它可被某数字整除，则返回真或假。",MATH_DEGREES:"度",LOGIC_NEGATE_TITLE:"%1 不成立",LOGIC_BOOLEAN_TRUE:"成立",LOGIC_BOOLEAN_FALSE:"不成立",LOGIC_BOOLEAN_TOOLTIP:"返回真或假。",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"如果這兩個輸入區塊的結果相等，返回 true。",LOGIC_COMPARE_TOOLTIP_NEQ:"如果這兩個輸入區塊的結果不相等，返回 true。",LOGIC_COMPARE_TOOLTIP_LT:"如果第一個輸入結果比第二個小，返回 true。",LOGIC_COMPARE_TOOLTIP_LTE:"如果第一個輸入結果小於或等於第二個，返回 true。",LOGIC_COMPARE_TOOLTIP_GT:"如果第一個輸入結果大於第二個，返回 true。",LOGIC_COMPARE_TOOLTIP_GTE:"如果第一個輸入結果大於或等於第二個，返回 true。",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_AND:"且",LOGIC_OPERATION_OR:"或",LOGIC_OPERATION_TOOLTIP_AND:"如果兩個輸入結果都為 true，則返回 true。",LOGIC_OPERATION_TOOLTIP_OR:"如果至少一個輸入結果為 true，返回 true。",TEXT_TEXT_TOOLTIP:"一個字元、一個單詞，或一串文字。",TEXT_SELECT:"%1 的第 %2 到第 %3 個字元",TEXT_LENGTH:"%1 的長度",TEXT_CONTAIN:"%1 包含 %2",TEXT_SPLIT:"把 %1 按 %2 分開成列表",TEXT_JOIN_TOOLTIP:"通過連接任意數量的項目來建立一串文字。",TEXT_JOIN_TITLE_HEAD:"把",TEXT_JOIN_TITLE_TAIL:"放在一起",VARIABLES_GET:"%1",VARIABLES_SET:"設置變量 %1 的值为 %2",CHANGE_VARIABLE:"將變量 %1 %2 %3",INCREASE:"增加",DECREASE:"減少",LISTS_GET:"%1",LISTS_APPEND:"添加 %1 到 %2 末尾",LISTS_INSERT_VALUE:"插入 %3 到 %1 的第 %2 項",LISTS_COPY:"複製 %2 到 %1",LISTS_LENGTH:"%1 的長度",LISTS_IS_EXIST:"%1 中包含 %2",LISTS_INDEX_OF:"%2 中第一個 %1 的位置",PROCEDURES_PARAMETER:"參數%1",PROCEDURES_RETURN_VALUE:"返回 %1 %2",PROCEDURES_DEFNORETURN_TITLE:"定義函數",PROCEDURES_DEFNORETURN_PROCEDURE:"函數",PROCEDURES_DEFNORETURN_TOOLTIP:"創建一個函數。",PROCEDURES_DEFRETURN_RETURN:"返回",COLOR_PICKER:"%1",RED:"紅色",GREEN:"綠色",BLUE:"藍色",HUE:"色相",SATURATION:"飽和度",BRIGHTNESS:"亮度",OPACITY:"不透明度",SELECT_COLOR_PARAM_TYPE:"選參方式",COLOR_PREVIEW:"顏色預覽"}},61462:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.StartDragEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=function(t){function e(e){var o=t.call(this,e.block)||this;return o.type=r.BlockEventType.START_DRAG,o._record_undo=!1,o.block=e.block,o._is_from_flyout=e.is_from_flyout,o}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,n.injectable)()],e)}(o(8633).BlockEvent);e.StartDragEvent=s},62671:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=o(24042),_=function(t){function e(e,o){var i=t.call(this,o.block)||this;if(i.type=r.BlockEventType.CHANGE,i.element=e,i._data={block:o.block,name:o.name,old_value:o.old_value,new_value:o.new_value},(0,s.is_block_svg)(o.block)){if(i.is("mutation",i._data)||i.is("change_procedure_param",i._data))return i._new_json=i.json.block_to_json(o.block),i;if(i.is("comment",i._data)&&"string"==typeof i._data.new_value){var n=i._get_event_workspace().workspace_comment_db.get(i._data.new_value);n&&(i._comment_json=i.json.comment_to_json(n))}}return i}return(0,i.__extends)(e,t),e.prototype.is=function(t,e){return this.element===t&&!!e},e.prototype.is_null=function(){return this._data.old_value==this._data.new_value},e.prototype.run=function(t){var e,o,i,n,r,_,a=this._get_event_workspace(),l=a.get_element_from_db(this._block_id);if(l)if((0,s.is_workspace_comment)(l))if(this.is("comment_text",this._data))l.set_text(t?this._data.new_value:this._data.old_value);else if(this.is("comment_color",this._data))l.set_color_theme(t?this._data.new_value:this._data.old_value);else if(this.is("comment_expand",this._data))l.set_expanded(t?this._data.new_value:this._data.old_value);else if(this.is("comment_resize",this._data)){var c=t?this._data.new_value:this._data.old_value;l.set_bubble_size(c[0],c[1])}else console.warn("Unknown change type: "+this.element);else if((0,s.is_block_svg)(l))if(this.is("field",this._data)){var h=this._data,d=h.name,p=h.new_value,u=h.old_value;c=t?p:u,null!=d&&(_=l.get_field(String(d)))&&(_.call_validator(c),_.set_value(c,!0))}else if(this.is("field_default_value",this._data)){var g=this._data,v=g.name;p=g.new_value,u=g.old_value,c=t?p:u,null!=v&&(_=l.get_field(String(v)))&&(0,s.is_field_default_value)(_)&&_.set_has_been_edited(c)}else if(this.is("comment",this._data)){var f=this._data;switch(p=f.new_value,u=f.old_value,typeof(c=t?p:u)){case"string":l.set_comment_text("",c),l.comment&&(l.comment.set_expanded(!0),l.comment.init_svg());break;case"undefined":l.set_comment_text(void 0);break;default:var b=void 0,m=parseFloat(c.getAttribute("relativeleft_")||""),y=parseFloat(c.getAttribute("relativetop_")||"");isNaN(m)||isNaN(y)||(b={x:m,y}),l.set_comment_text("",c.getAttribute("id")||void 0,b),this.xml.parse_comment_attributes(c,l.comment),l.comment&&l.comment.init_svg()}}else if(this.is("collapsed",this._data))l.set_collapsed(t?this._data.new_value:this._data.old_value,!0);else if(this.is("disabled",this._data))l.set_disabled(t?this._data.new_value:this._data.old_value);else if(this.is("inline",this._data))l.set_inputs_inline(t?this._data.new_value:this._data.old_value);else if(this.is("mutation",this._data))u=t?this._data.old_value:this._data.new_value,void 0!==(p=t?this._data.new_value:this._data.old_value)?null!==(e=l.addMutation)&&void 0!==e&&e.call(l,p,null===(o=this._data.name)||void 0===o?void 0:o.toString()):void 0!==u&&null!==(i=l.removeMutation)&&void 0!==i&&i.call(l,u,null===(n=this._data.name)||void 0===n?void 0:n.toString());else if(this.is("visibility",this._data))l.set_chunk_visibility(t?this._data.new_value:this._data.old_value),l.update_chunk_visibility();else if(this.is("group_block",this._data)){var k=this._data;if(p=k.new_value,u=k.old_value,c=t?p:u){var w=c[0],E=c[1],T=c[2];l.hide_into_group(E,{id:w,group_stop_at:T})}else null!==(r=l.parent_group)&&void 0!==r&&r.release()}else{var x=a.get_change_event(this.element);x?x.call(this,t):console.warn("Unknown change type: "+this.element)}},e.prototype.get_name=function(){return this._data.name},e.prototype.get_new_value=function(){return this._data.new_value},e.prototype.get_old_value=function(){return this._data.old_value},e.prototype.update_new_value=function(t){this._data.new_value=t},e.prototype.serialize=function(){return{id:this._block_id,group:this._group,element:this.element,old_value:this._data.old_value,new_value:this._data.new_value,name:this._data.name}},e.prototype.get_new_comment=function(){return this._comment_json},e.prototype.get_new_json=function(){return this._new_json},(0,i.__decorate)([(0,n.injectable)()],e)}(o(8633).BlockEvent);e.ChangeEvent=_},63614:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Msg=void 0,e.Msg={MATH_ADDITION_SYMBOL:"+",MATH_SUBTRACTION_SYMBOL:"-",MATH_DIVISION_SYMBOL:"÷",MATH_MULTIPLICATION_SYMBOL:"×",MATH_POWER_SYMBOL:"^",MATH_TRIG_SIN:"sin",MATH_TRIG_COS:"cos",MATH_TRIG_TAN:"tan",MATH_TRIG_ASIN:"asin",MATH_TRIG_ACOS:"acos",MATH_TRIG_ATAN:"atan",START_GROUP_TAG:"事件",OUTPUT_GROUP_TAG:"输出",EXECUTION_GROUP_TAG:"执行",BLOCK_GROUP:"积木分组",RELEASE_GROUP:"解除分组",HIDE_BLOCK_STACK:"隐藏积木块",SHOW_BLOCK_STACK:"取消隐藏积木块"}},65129:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TreeNode=void 0;var i=o(31635),n=o(53307),r=o(24042),s=o(15261),_=function(t){function e(o){var i=t.call(this)||this;i.DEFAULT_CLASSNAMES={NORMAL:"blocklyTreeRow",SELECTED:"blocklyTreeSelected",DISABLED:"blockly_toolbox_disabled"},i.blocks=[];var n={text:void 0,name:"",color:"",secondary_color:i.theme.flyout.BACKGROUND_COLOR.toString(),element:{unselected_classname:"",disabled_classname:"",selected_classname:"",style:"",selected_style:""},icon:{style:void 0,selected_style:void 0,html:void 0,selected_html:void 0,font_id:void 0,selected_font_id:void 0},children:[],blocks:[],selectable:!0};return o.text&&(o.text=i.utils.replace_message_references(o.text)),i.config_=(0,r.parse_attr_deep)(n,o),i.init(),i.name_=i.config_.name||(0,r.unique_id)("treenode_"),i.selectable_=i.config_.selectable,i.blocks="string"==typeof i.config_.blocks?i.config_.blocks:Array.from(i.config_.blocks),Array.from(i.config_.children).forEach(function(t){var o=new e(t);i.add(o)}),i}return(0,i.__extends)(e,t),e.prototype.get_element=function(){return this.element_},e.prototype.get_color=function(){return this.config_.color},e.prototype.get_flyout_background_color=function(){return this.config_.secondary_color},e.prototype.init=function(){if(this.html_div=document.createElement("div"),this.html_div.className="blocklyTreeNode",this.element_=document.createElement("div"),this.element_.id=this.config_.name,this.element_.setAttribute("role","treeitem"),this.element_.setAttribute("name",this.config_.name),this.icon_el=document.createElement("div"),this.icon_el.className="blocklyTreeIcon",this.config_.icon.font_id?(0,s.create_font_icon)(this.config_.icon.font_id,this.icon_el):this.config_.icon.html&&(this.icon_el.innerHTML=this.config_.icon.html),this.config_.icon.style&&this.icon_el.setAttribute("style",this.config_.icon.style),this.element_.appendChild(this.icon_el),this.config_.color&&(this.element_.style.color=this.config_.color,this.element_.dataset.color=this.config_.color),this.config_.element.style&&this.element_.setAttribute("style",this.config_.element.style),null!=this.config_.text){var t=document.createElement("div");t.classList.add("blocklyTreeLabel"),t.textContent=this.config_.text,this.element_.appendChild(t)}this.children_container_=document.createElement("div"),this.children_container_.className="blocklyTreeChildren",this.html_div.appendChild(this.element_),this.html_div.appendChild(this.children_container_),this.element_.className=this.get_node_classname(),this.set_expanded(!1)},e.prototype.get_blocks=function(t){return this.blocks},e.prototype.set_blocks=function(t){"string"==typeof t||Array.isArray(t)?this.blocks=t:this.blocks=Array.from(t)},e.prototype.push_block=function(t){if("string"==typeof this.blocks)throw Error("Trying to add block to a node with custom key");this.blocks.push(t)},e.prototype.select=function(){this.disabled_||(this.selected_=!0,this.update_node())},e.prototype.unselect=function(){this.selected_=!1,this.update_node()},e.prototype.set_disabled=function(t){t!==this.disabled_&&(this.disabled_=t,this.update_node())},e.prototype.get_node_classname=function(){return this.disabled_?"\n        "+this.DEFAULT_CLASSNAMES.NORMAL+"\n        "+this.DEFAULT_CLASSNAMES.DISABLED+"\n        "+this.config_.element.disabled_classname+"\n      ":this.is_selected()?"\n        "+this.DEFAULT_CLASSNAMES.NORMAL+"\n        "+this.DEFAULT_CLASSNAMES.SELECTED+"\n        "+this.config_.element.selected_classname+"\n      ":"\n      "+this.DEFAULT_CLASSNAMES.NORMAL+"\n      "+this.config_.element.unselected_classname+"\n    "},e.prototype.update_node=function(){if(this.element_.className=this.get_node_classname(),this.is_selected())return this.element_.style.backgroundColor=this.get_color(),this.config_.element.selected_style&&this.element_.setAttribute("style",this.config_.element.selected_style),null!=this.config_.icon.selected_style&&this.icon_el.setAttribute("style",this.config_.icon.selected_style),null!=this.config_.icon.selected_font_id?((0,s.remove_children)(this.icon_el),(0,s.create_font_icon)(this.config_.icon.selected_font_id,this.icon_el)):null!=this.config_.icon.selected_html&&(this.icon_el.innerHTML=this.config_.icon.selected_html),void this.element_.setAttribute("aria-selected","true");this.element_.style.backgroundColor="",this.config_.element.style&&this.config_.element.selected_style&&this.element_.setAttribute("style",this.config_.element.style),this.config_.icon.style&&this.config_.icon.selected_style&&this.icon_el.setAttribute("style",this.config_.icon.style),this.config_.icon.font_id&&this.config_.icon.selected_font_id?((0,s.remove_children)(this.icon_el),(0,s.create_font_icon)(this.config_.icon.font_id,this.icon_el)):this.config_.icon.html&&this.config_.icon.selected_html&&(this.icon_el.innerHTML=this.config_.icon.html),this.element_.setAttribute("aria-selected","false")},e.prototype.dispose=function(){if(this.parent_){var t=this.parent_.get_children(),e=t.indexOf(this);t.splice(e,1)}this.html_div.remove(),this.set_tree(void 0)},e.prototype.find_node_by_name=function(t){if(this.name_===t)return this;for(var e=0;e<this.children_.length;e++){var o=this.children_[e];if(o.get_name()===t)return o;var i=o.find_node_by_name(t);if(i)return i}},(0,i.__decorate)([(0,n.lazy_inject)(n.BINDING.theme)],e.prototype,"theme",void 0),(0,i.__decorate)([(0,n.lazy_inject)(n.BINDING.utils)],e.prototype,"utils",void 0),e}(o(27554).BaseNode);e.TreeNode=_},65428:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BlockDragSurfaceSvg=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(15261),a=o(14289),l=function(){function t(t){this.SVG_=void 0,this.drag_group_=void 0,this.container_=void 0,this.scale_=1,this.surface_xy_=void 0,this.container_=t,this.create_dom()}return t.prototype.create_dom=function(){this.SVG_||(this.SVG_=(0,_.create_svg_element)("svg",{xmlns:a.SVG_NS,"xmlns:html":a.HTML_NS,"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",class:"blocklyBlockDragSurface"},this.container_),this.drag_group_=(0,_.create_svg_element)("g",{},this.SVG_))},t.prototype.set_blocks_and_show=function(t){this.clear_additions(),null!=this.drag_group_&&0!==this.drag_group_.childNodes.length&&console.error("Already dragging a block."),this.drag_group_&&this.SVG_&&(this.drag_group_.appendChild(t),this.SVG_.style.display="block",this.surface_xy_=r.vec2.fromValues(0,0))},t.prototype.translate_and_scale_group=function(t,e,o){this.scale_=o;var i=t.toFixed(0),n=e.toFixed(0);this.drag_group_&&this.drag_group_.setAttribute("transform","translate("+i+", "+n+") scale("+o+")")},t.prototype.set_scale=function(t){if(this.scale_=t,this.drag_group_){var e=this.drag_group_.getAttribute("transform"),o="scale("+t+")";this.drag_group_.setAttribute("transform",e?e.replace(/scale\([0-9\.]+\)/,o):o)}},t.prototype.translate_surface_internal=function(){if(null==this.surface_xy_)throw new Error("surfaceXY_ can not be undefined");if(null==this.SVG_)throw new Error("SVG_ can not be undefined");var t=this.surface_xy_[0],e=this.surface_xy_[1],o=t.toFixed(0),i=e.toFixed(0);this.SVG_.style.display="block",(0,_.set_css_transform)(this.SVG_,"translate3d("+o+"px, "+i+"px, 0px)")},t.prototype.translate_surface=function(t,e){this.surface_xy_=r.vec2.fromValues(t*this.scale_,e*this.scale_),this.translate_surface_internal()},t.prototype.get_surface_translation=function(){var t=this.utils.get_relative_xy(this.SVG_);return r.vec2.fromValues(t[0]/this.scale_,t[1]/this.scale_)},t.prototype.get_group=function(){return this.drag_group_},t.prototype.get_current_block=function(){if(this.drag_group_)return this.drag_group_.firstChild},t.prototype.clear_and_hide=function(t){var e=this.get_current_block();t?null!=e&&t.appendChild(e):this.drag_group_&&null!=e&&this.drag_group_.removeChild(e),this.SVG_&&(this.SVG_.style.display="none"),this.drag_group_&&(this.clear_additions(),0!==this.drag_group_.childNodes.length&&console.error("Drag group was not cleared.")),this.surface_xy_=void 0},t.prototype.clear_additions=function(){if(this.drag_group_)for(var t=this.drag_group_.childElementCount-1;t>=0;t--){var e=this.drag_group_.children[t];e.classList.contains("blocklyDraggable")||(0,_.remove_node)(e)}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.BlockDragSurfaceSvg=l},66148:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Input=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(24042),_=function(){function t(t){this.field_width=0,this.field_height=0,this.margin_left=this.theme.renderer.SEP_SPACE_X,this.render_width=0,this.render_height=0,this.width=0,this.height=0,this.visible_=!0,this.setCheck=this.set_check,this.appendField=this.append_field,this.type=t.type,this.name=t.name,this.source_block=t.block,this.connection=t.connection,this.fieldRow=[]}return t.prototype.is_visible=function(){return this.visible_},t.prototype.init=function(){if(null!=this.source_block){var t=this.source_block.get_workspace();if(null!=t&&t.rendered)for(var e=0;e<this.fieldRow.length;e++)this.fieldRow[e].init()}else console.warn("Trying to init an input without its source block.")},t.prototype.dispose=function(){for(var t=0;t<this.fieldRow.length;t++)this.fieldRow[t].dispose();this.connection&&this.connection.dispose(),delete this.source_block},t.prototype.set_visible=function(t){var e=[];if(this.visible_==t)return e;this.visible_=t;for(var o=0;o<this.fieldRow.length;o++){var i=this.fieldRow[o];i.opt_is_head_||i.set_visible(t)}if(this.connection){t?e=this.connection.unhide_all():this.connection.hide_all();var n=this.connection.targetBlock();n&&n.set_visible_as_child(t)}return e},t.prototype.set_check=function(t){if(!this.connection)throw new Error("This input does not have a connection.");return this.connection.set_check(t),this},t.prototype.append_field=function(t,e){return this.insert_field_at(this.fieldRow.length,t,e),this},t.prototype.insert_field_at=function(t,e,o){if(t<0||t>this.fieldRow.length)throw new Error("index "+t+" out of bounds.");return e||o?((0,s.is_string)(e)&&(e=this.field_label_factory({text:this.utils.replace_message_references(e)})),e.source_block=this.source_block,null!=o&&(e.name=o),null!=this.source_block&&this.source_block.rendered&&e.init(),(0,s.is_field_dropdown)(e)&&e.prefix_field&&(t=this.insert_field_at(t,e.prefix_field)),this.fieldRow.splice(t,0,e),++t,(0,s.is_field_dropdown)(e)&&e.suffix_field&&(t=this.insert_field_at(t,e.suffix_field)),null!=this.source_block&&this.source_block.rendered&&this.source_block.render(),t):0},t.prototype.remove_field=function(t){for(var e,o,i=0,n=this.fieldRow.length;i<n;i++){var r=this.fieldRow[i];if(r.name===t)return r.dispose(),this.fieldRow.splice(i,1),(null===(e=this.source_block)||void 0===e?void 0:e.rendered)&&null!==(o=this.source_block)&&void 0!==o&&o.render(),!0}return!1},t.prototype.get_field=function(t){for(var e=0,o=this.fieldRow.length;e<o;e++){var i=this.fieldRow[e];if(i.name===t)return i}},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.FieldLabel)],t.prototype,"field_label_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Input=_},68607:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Blink=void 0;var i=o(31635),n=o(71519),r=o(2413),s=o(79656),_=o(37024),a=o(3672),l=o(53307),c=function(){function t(){this.Blocks=Object.create(null),this.blocks_xml={},this.version=o(76525).version,this.inject=_.Inject.bind(this),Object.assign(this.Msg,s.zh_hans),(0,r.init_shadows)(this)}return Object.defineProperty(t.prototype,"mainWorkspace",{get:function(){return this.workspace_db.current},set:function(t){this.workspace_db.current=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"di_container",{get:function(){return(0,a.get_instance)()},enumerable:!1,configurable:!0}),t.prototype.define_blocks_with_json_array=function(t){for(var e=0;e<t.length;e++){var o=t[e];if(o){var i=o.type;i?(this.Blocks[i]&&console.warn("Block definition #"+e+' in JSON array overwrites prior definition of "'+i+'".'),this.Blocks[i]={init:function(t){return function(){this.jsonInit(t)}}(o)}):console.warn("Block definition #"+e+" in JSON array is missing a type attribute. Skipping.")}else console.warn("Block definition #"+e+" in JSON array not exist. Skipping.")}},t.prototype.define_block_with_object=function(t,e){this.Blocks[t]&&console.warn('Block definition overwrites prior definition of "'+t+'".'),this.Blocks[t]=e},(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.context_menu)],t.prototype,"context_menu",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.extensions)],t.prototype,"extensions",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.registry)],t.prototype,"registry",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.tooltip)],t.prototype,"tooltip",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.json)],t.prototype,"json",void 0),(0,i.__decorate)([(0,l.lazy_inject)(l.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Blink=c},69180:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceSvg=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(32791),a=o(28688),l=o(99186),c=o(15261),h=o(14812),d=o(24042),p=o(82390),u=function(){function t(t,e,o,i){this.connectionDBList=[],this.degrade_translate=void 0,this.MAX_UNDO=1024,this.SCAN_ANGLE=3,this.listeners_=[],this.blockDB_=new Map,this.workspace_comment_db=new Map,this.undo_stack_=[],this.redo_stack_=[],this.top_blocks_=[],this.top_comments=[],this.is_clearing=!1,this.is_drag_surface_active_=!1,this.cached_parent_svg_=void 0,this.flyout_=void 0,this.toolbox_=void 0,this.inverse_screen_CTM_=void 0,this.inverse_screen_CTM_dirty_=!0,this.blocks_area_=void 0,this.workspace_area_=void 0,this.workspace_area_dirty_=!0,this.delete_area_flyout=void 0,this.is_flyout_rect_dirty_=!0,this.toolbox_category_callbacks_={},this.last_recorded_page_scroll_=void 0,this.resize_handler_wrapper_=void 0,this.rendered=!0,this.is_flyout=!1,this.resizes_enabled_=!0,this.toolbox_refresh_enabled_=!0,this.scroll_xy=r.vec2.create(),this.content_offset_by_view=r.vec2.create(),this.drag_delta_xy_=r.vec2.create(),this.scale=1,this.current_gesture_=void 0,this.workspace_drag_surface_=void 0,this.injection_div_=void 0,this.flyout_button_callbacks_={},this.custom_flyout_buttons=new Map,this.svg_group=void 0,this.svg_bubble_canvas_=void 0,this.target_workspace=void 0,this.event_dict=new Map,this.custom_change_events_=new Map,this.pre_paste=[],this.pre_paste_extend=[],this.gestures_enabled=!0,this.offset=r.vec2.fromValues(0,0),this.is_hotkey_enable=!0,this.id=t.id||(0,l.gen_uid)(),this.workspace_db.add(this),this.options=t,this.RTL=!!this.options.RTL,this.toolbox_position=this.options.toolboxPosition,this.is_flyout=t.in_flyout,this.top_blocks_=[],this.top_comments=[],this.listeners_=[],this.undo_stack_=[],this.redo_stack_=[],this.get_metrics=t.get_metrics||this.get_metrics,this.set_metrics=t.set_metrics||this.set_metrics,this.init_connection_db(),e&&(this.block_drag_surface_=e),o&&(this.workspace_drag_surface_=o),i&&(this.injection_div_=i),this.audio_manager_=this.workspace_audio_factory(t.parentWorkspace),!t.in_flyout&&t.svg_defs&&t.svg_rnd&&(this.grid_=this.grid_factory(t))}var e;return e=t,t.prototype.get_element_from_db=function(t){return this.blockDB_.get(t)||this.workspace_comment_db.get(t)},t.prototype.get_options=function(){return this.options},t.prototype.get_undo_stack=function(){return this.undo_stack_},t.prototype.set_undo_stack=function(t){this.undo_stack_=t},t.prototype.get_redo_stack=function(){return this.redo_stack_},t.prototype.set_redo_stack=function(t){this.redo_stack_=t},t.prototype.get_toolbox=function(){return this.toolbox_},t.prototype.get_flyout=function(){return this.flyout_?this.flyout_:this.toolbox_?this.toolbox_.flyout:void 0},t.prototype.get_workspace_area=function(){var t=this.get_parent_svg();return this.workspace_area_dirty_&&null!=t&&(this.workspace_area_=t.getBoundingClientRect(),this.workspace_area_dirty_=!1),this.workspace_area_},t.prototype.get_delete_area_flyout=function(){if(!this.is_flyout_rect_dirty_)return this.delete_area_flyout;var t=this.flyout_||this.toolbox_&&this.toolbox_.flyout;return t&&t.is_visible()&&"none"!==this.get_options().delete_area?this.delete_area_flyout=t.get_client_rect():this.delete_area_flyout=void 0,this.is_flyout_rect_dirty_=!1,this.delete_area_flyout},t.prototype.get_block_drag_surface=function(){return this.block_drag_surface_},t.prototype.is_resizes_enabled=function(){return this.resizes_enabled_},t.prototype.get_scale=function(){return this.scale},t.prototype.get_delete_area_toolbox=function(){return this.delete_area_toolbox_},t.prototype.get_scrollbar=function(){return this._scrollbar},t.prototype.set_scrollbar=function(t){this._scrollbar=t},t.prototype.get_workspace_drag_surface=function(){return this.workspace_drag_surface_},Object.defineProperty(t.prototype,"use_workspace_drag_surface_",{get:function(){return this.degrade_translate?this.blockDB_.size<this.degrade_translate:!!this.workspace_drag_surface_},enumerable:!1,configurable:!0}),t.prototype.get_target_workspace=function(){return this.target_workspace},t.prototype.set_target_workspace=function(t){this.target_workspace=t},t.prototype.init_connection_db=function(){this.connectionDBList[_.CONNECTION_TYPE.INPUT_VALUE]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.OUTPUT_VALUE]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.NEXT_STATEMENT]=this.connection_db_factory(),this.connectionDBList[_.CONNECTION_TYPE.PREVIOUS_STATEMENT]=this.connection_db_factory()},t.prototype.remaining_capacity=function(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.get_all_blocks().length},t.prototype.undo=function(t){var e=t?this.redo_stack_:this.undo_stack_,o=t?this.undo_stack_:this.redo_stack_,i=e.pop();if(i){for(var n=[i],r=i._group;e.length&&r&&r==e[e.length-1]._group;){var s=e.pop();s&&n.push(s)}for(var _=0;_<n.length;_++){var a=n[_];o.push(a)}var l=this.events.filter(n,!!t);this.events.set_record_undo(!1),this.events.set_undoing(!0),this.set_resizes_enabled(!1);try{for(r&&this.events.set_group(r),_=0;_<l.length;_++){var c=l[_];c.run&&c.run(!!t)}r&&this.events.set_group(!1)}catch(t){console.error(t)}finally{this.set_resizes_enabled(!0),this.events.set_undoing(!1),this.events.set_record_undo(!0)}}},t.prototype.clear_undo=function(){this.undo_stack_.length=0,this.redo_stack_.length=0,this.events.clear_pending_undo()},t.prototype.get_all_blocks=function(){for(var t=this.get_top_blocks(!1),e=0;e<t.length;e++)t.push.apply(t,t[e].get_children());return t},t.prototype.add_top_block=function(t){this.top_blocks_.push(t)},t.prototype.add_top_comment=function(t){this.top_comments.push(t)},t.prototype.get_top_blocks=function(t,e){void 0===e&&(e=!1);var o=this.top_blocks_.filter(function(t){return!t.parent_group});if(e&&(o=o.filter(function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE})),t&&o.length>1){var i=Math.sin((0,l.to_radians)(this.SCAN_ANGLE));this.RTL&&(i*=-1),o.sort(function(t,e){var o=t.get_relative_to_surface_xy(),n=e.get_relative_to_surface_xy();return o[1]+i*o[0]-(n[1]+i*n[0])})}return o},t.prototype.get_last_block=function(){var t=this.get_top_blocks(!0),e=t[t.length-1];if(e){for(var o=e.get_full_next_block();o;)o=(e=o).get_full_next_block();return e}},t.prototype.get_top_comments=function(t,e){void 0===e&&(e=!1);var o=this.top_comments.slice();if(e&&(o=o.filter(function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE})),t&&o.length>1){var i=Math.sin((0,l.to_radians)(this.SCAN_ANGLE));this.RTL&&(i*=-1),o.sort(function(t,e){var o=t.get_relative_to_surface_xy(),n=e.get_relative_to_surface_xy();return o[1]+i*o[0]-(n[1]+i*n[0])})}return o},t.prototype.get_top_elements=function(t,e){void 0===e&&(e=!1);var o=this.top_comments.slice();if(o=o.concat(this.top_blocks_.filter(function(t){return!t.parent_group})),e&&(o=o.filter(function(t){return t.get_visibility()===_.BlockVisibility.VISIBLE})),t&&o.length>1){var i=Math.sin((0,l.to_radians)(this.SCAN_ANGLE));this.RTL&&(i*=-1),o.sort(function(t,e){var o=t.get_relative_to_surface_xy(),n=e.get_relative_to_surface_xy();return o[1]+i*o[0]-(n[1]+i*n[0])})}return o},t.prototype.remove_change_listener=function(t){(0,h.remove)(this.listeners_,t)},t.prototype.remove_top_block=function(t){if(!(0,h.remove)(this.top_blocks_,t))throw new Error("Block "+t.type+" ["+t.id+"] not present in workspace's list of top-most blocks.")},t.prototype.remove_top_comment=function(t){if(!(0,h.remove)(this.top_comments,t))throw new Error("Comment "+t.get_text()+" ["+t.id+"] not present in workspace's list of top-most comments.")},t.prototype.fire_change_listener=function(t){if(t.is_record_undo()&&this.events.is_record_undo())for(this.undo_stack_.push(t),this.redo_stack_.length=0;this.undo_stack_.length>this.MAX_UNDO&&this.MAX_UNDO>=0;)this.undo_stack_.shift();for(var e=this.listeners_.slice(),o=0;o<e.length;o++)(0,e[o])(t);var i=this.event_dict.get("common");i&&i(t);var n=this.event_dict.get(t.type);if(n&&n(t),_.AllUIEvents.includes(t.type)){var r=this.event_dict.get(_.BlockEventType.UI);r&&r(t)}},t.prototype.get_block_by_id=function(t){var e=this.blockDB_.get(t),o=this.get_flyout();if(!e&&null!=o){var i=o.get_workspace();null!=i&&(e=i.blockDB_.get(t))}return e||void 0},t.prototype.add_change_listener=function(t,e){return void 0===e&&(e=!0),e?this.listeners_.push(t):this.listeners_.unshift(t),t},t.prototype.add_event_listener=function(t,e){this.event_dict.set(t,e)},t.prototype.add_custom_change_event=function(t,e){this.custom_change_events_.set(t,e)},t.prototype.get_change_event=function(t){return this.custom_change_events_.get(t)},t.prototype.create_dom=function(t){return this.svg_group=(0,c.create_svg_element)("g",{class:"blocklyWorkspace"}),t&&(this.svg_background_=(0,c.create_svg_element)("rect",{height:"100%",width:"100%",class:t},this.svg_group)),"blocklyMainBackground"==t&&this.grid_&&this.svg_background_&&(this.svg_background_.style.fill="url(#"+this.grid_.get_pattern_id()+")"),this.svg_block_canvas_=(0,c.create_svg_element)("g",{class:"blocklyBlockCanvas"},this.svg_group),this.svg_bubble_canvas_=(0,c.create_svg_element)("g",{class:"blocklyBubbleCanvas"},this.svg_group),this.is_flyout||(this.events.bind_event_with_checks(this.svg_group,"mousedown",this,this.on_mouse_down),this.options.ws_scrollable&&this.events.bind_event_with_checks(this.svg_group,"wheel",this,this.on_wheel_scroll)),this.options.has_categories&&(this.toolbox_=this.toolbox_factory(this)),this.record_delete_areas(),this.svg_group},t.prototype.paste=function(t,e,o){void 0===o&&(o=!1),t&&(0,c.reset_all_block_id)(t),this._paste(t,e,o,!1)},t.prototype._paste=function(t,e,o,i){var n;void 0===o&&(o=!1),void 0===i&&(i=!0),this.runtime_data.set_pasting(!0);try{for(var s=0;s<this.pre_paste.length;s++)t&&(t=(n=this.pre_paste[s].call(this,t,e,o||!1,i)).xml_block,e=n.mouse_position,o=n.is_move_to_default);if(!t)return;if(!this.rendered||t.getElementsByTagName("block").length>=this.remaining_capacity())return;this.current_gesture_&&this.current_gesture_.cancel(),this.events.disable();var _=this.resizes_enabled_;_&&this.set_resizes_enabled(!1);var l=void 0,c=e||{x:0,y:0};try{if(l=this.xml.dom_to_workspace_element(t,this),(0,d.is_block_svg)(l)&&(l=l.parent_group||l),!l)return;var h=void 0,p=void 0;if(e)c=e,l.move_by(r.vec2.fromValues(e.x,e.y));else{if(o){var u=this.get_origin_offset_in_pixels(),g=this.get_paste_offset();h=(g.left-u[0])/this.scale,p=(g.top-u[1])/this.scale}else{var v=t.getAttribute("x"),f=t.getAttribute("y");if(!v||!f)return;h=parseInt(v,10),p=parseInt(f,10)}if(isNaN(h)||isNaN(p))throw Error();this.RTL&&(h=-h);var b=void 0;do{b=!1;var m=this.get_all_blocks().slice();for(m=m.concat(this.top_comments.slice()),s=0;s<m.length;s++){var y=m[s].get_relative_to_surface_xy();if(Math.abs(h-y[0])<=1&&Math.abs(p-y[1])<=1){b=!0;break}}if(!b){var k=(0,d.is_block_svg)(l)?l.get_connections(!1):[];for(s=0;s<k.length;s++)if(k[s].closest(this.theme.blink_params.SNAP_RADIUS,r.vec2.fromValues(h,p)).connection){b=!0;break}}b&&(h+=this.theme.blink_params.SNAP_RADIUS,p+=2*this.theme.blink_params.SNAP_RADIUS)}while(b);c={x:h,y:p},l.move_by(r.vec2.fromValues(h,p))}}finally{this.events.enable(),_&&this.set_resizes_enabled(!0)}l.select();var w=this.events.get_group();return this.events.set_group(w||!0),!this.events.is_enabled()||(0,d.is_block_svg)(l)&&l.is_shadow()||this.events.fire(this.create_event_factory({block:l})),(0,d.is_block_svg)(l)&&((0,a.fire_block_onchange)(l),l.parent_group&&this.events.fire(this.change_event_factory("group_block",{block:l,old_value:void 0,new_value:[l.parent_group.id,l.parent_group.group_name,l.parent_group.group_stop_at||""]}))),this.events.set_group(w||!1),l.bring_to_front(),c}finally{this.runtime_data.set_pasting(!1)}},t.prototype.set_pre_paste=function(t){this.pre_paste.push(t)},t.prototype.set_pre_paste_extend=function(t){this.pre_paste_extend.push(t)},t.prototype.paste_extend=function(t,e,o){var i;void 0===o&&(o=!1);var n=this.events.get_group();this.events.set_group(n||!0),this.runtime_data.set_pasting(!0),(0,c.reset_all_block_id)(t);for(var r=0;r<this.pre_paste_extend.length;r++)t=(i=this.pre_paste_extend[r].call(this,t,e,o||!1)).xml_blocks,e=i.mouse_position,o=i.is_move_to_default;if(t.length<=1)return t[0]&&this._paste(t[0],e,o,!0),void this.events.set_group(n);var s=function(t){var e=t.getAttribute("x"),o=t.getAttribute("y");return{x:parseInt(e||"0",10),y:parseInt(o||"0",10)}},_=this.resizes_enabled_;for(_&&this.set_resizes_enabled(!1),e?this._paste(t[0],e,o):e=this._paste(t[0],void 0,o)||{x:0,y:0},r=1,a=s(t[0]),l=e.x-a.x,h=e.y-a.y,d=t.length;r<d;r++){var a,l,h,d,p=t[r],u=s(t[r]),g={x:u.x+l,y:u.y+h};this._paste(p,g,!1)}this.runtime_data.set_pasting(!1),this.events.set_group(n),_&&this.set_resizes_enabled(!0)},t.prototype.get_paste_offset=function(){var t={left:40,top:30},e=(0,c.get_translate)(this.get_parent_svg());return t.left+=e.x,t},t.prototype.record_delete_areas=function(){if(this.is_flyout_rect_dirty_=!0,"none"===this.get_options().delete_area)return this.delete_area_toolbox_=void 0,void(this.delete_area_flyout=void 0);this.flyout_?this.delete_area_toolbox_=this.flyout_.get_client_rect():this.toolbox_?this.delete_area_toolbox_=this.toolbox_.get_client_rect():this.delete_area_toolbox_=void 0},t.prototype.is_delete_area=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY),o=this.get_delete_area_flyout();return this.delete_area_toolbox_&&this.delete_area_toolbox_.contains(e)||o&&o.contains(e)?_.DeleteArea.DELETE_AREA_TOOLBOX:_.DeleteArea.DELETE_AREA_NONE},t.prototype.set_gestures_enabled=function(t){this.gestures_enabled!==t&&(this.options.pinch&&(t?this.runtime_data.register_finger_events():this.runtime_data.unregister_finger_events()),this.gestures_enabled=t)},t.prototype.is_gestures_enabled=function(){return this.gestures_enabled},t.prototype.on_wheel_scroll=function(t){if(this.current_gesture_&&this.current_gesture_.cancel(),this.gestures_enabled){var e=1===t.deltaMode?15:1;if(t.ctrlKey){var o=p.is.mac()?50:100,i=-t.deltaY/o*e,n=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());this.zoom(n.x,n.y,i)}else{this.widget_div.hide(!0);var r=this.scroll_xy[0]-t.deltaX*e,s=this.scroll_xy[1]-t.deltaY*e;t.shiftKey&&0===t.deltaX&&(r=this.scroll_xy[0]-t.deltaY*e,s=this.scroll_xy[1]),this.start_drag_metrics=this.get_metrics(),this.scroll(r,s)}t.preventDefault()}},t.prototype.show_context_menu=function(t){var e=this;if(!this.options.readOnly&&!this.is_flyout){var o=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm()),i=this.get_origin_offset_in_pixels(),n=(0,c.get_translate)(this.get_parent_svg()),r={x:(o.x+n.x-i[0])/this.scale,y:(o.y+n.y-i[1])/this.scale},s=[];this.options.context_menu.workspace.forEach(function(t){if("number"==typeof t)switch(t){case _.WorkspaceOptionType.CLEAN_UP:return e.add_clean_up_option(s);case _.WorkspaceOptionType.PASTE:return e.add_paste_option(s,r);case _.WorkspaceOptionType.DELETE_ALL:return e.add_delete_all_blocks_option(s);case _.WorkspaceOptionType.COPY_ALL:return e.add_copy_all_blocks_option(s);case _.WorkspaceOptionType.GLOBAL_COMMENT:return e.add_global_comment_option(s,r);default:return console.warn("Undefined workspace menu option: "+t)}var o=t(e);o&&s.push(o)});var a={source:"workspace",options:s};this.context_menu.show(t,a,this.RTL)}},t.prototype.add_paste_option=function(t,e){var o=this,i=this.runtime_data.clipboard.get_content();t.push({text:this.Msg.PASTE,name:"paste",enabled:null!=i,callback:function(){i&&(Array.isArray(i)?o.paste_extend(i,e):o.paste(i,e))}})},t.prototype.add_clean_up_option=function(t){if(this._scrollbar){var e=this.get_top_elements(!0),o={text:this.Msg.CLEAN_UP,name:"clean_up",enabled:e.length>1,callback:this.clean_up.bind(this)};t.push(o)}},t.prototype.add_delete_all_blocks_option=function(t,e,o){var i=this;void 0===e&&(e=!0);var n=this.get_top_elements(!0,e),r=[];function s(t){if((0,d.is_block_svg)(t))if(t.is_deletable())r=r.concat(t.get_descendants());else for(var e=t.get_children(),o=0;o<e.length;o++)s(e[o]);else t.is_deletable()&&(r=r.concat([t]))}for(var _=0;_<n.length;_++)s(n[_]);var l=this.events.get_group(),c=function t(){""===l?(i.events.set_group(!0),l=i.events.get_group()):i.events.set_group(l);var e=r.shift();e&&(e.workspace?(e.dispose(!1,!0),window.setTimeout(t,10)):t()),i.events.set_group(!1)},h=(0,a.cal_num_blocks)(r),p={text:this.Msg.DELETE_X_BLOCKS.replace("%1",String(h)),name:"delete_all",enabled:h>0,callback:function(){i.current_gesture_&&i.current_gesture_.cancel(),!o||h<2?c():o(c)}};t.push(p)},t.prototype.add_copy_all_blocks_option=function(t,e){var o=this;void 0===e&&(e=!0);var i=this.get_top_elements(!0,e),n=0;i.forEach(function(t){(0,d.is_block_svg)(t)?n+=(0,a.cal_num_blocks)(t.get_descendants()):n++}),t.push({text:this.Msg.COPY_ALL.replace("%1",String(n)),name:"copy_all",enabled:n>0,callback:function(){o.runtime_data.clipboard.copy_all(i)}})},t.prototype.add_global_comment_option=function(t,e){var o=this;if("simplified"!==this.options.comment_type){var i={text:this.Msg.GLOBAL_COMMENT,name:"global_comment",enabled:!0,callback:function(){var t=o.events.get_group();o.events.set_group(t||!0);var i=o.new_workspace_comment(e);i.init_svg(),i.set_expanded(!0),i.focus(),o.events.set_group(t)}};t.push(i)}else console.warn("Trying to create global comment when using simplified comment. Ignoring this command. ")},t.prototype.new_workspace_comment=function(t,e){return this.workspace_comment_factory({workspace:this,type:this.options.comment_type,position:t,opt_id:e})},t.prototype.update_toolbox=function(t){var e="string"==typeof t?this.xml.text_to_dom(t):t;if(null!=e){if(!this.options.toolbox_config)throw new Error("Existing toolbox is undefined.  Can't create new toolbox.");if(e.getElementsByTagName("category").length){if(!this.toolbox_)throw new Error("Existing toolbox has no categories.  Can't change mode.");this.options.toolbox_config=e,this.toolbox_.populate(e)}else{if(!this.flyout_)throw new Error("Existing toolbox has categories.  Can't change mode.");this.options.toolbox_config=e,this.flyout_.show(e.childNodes)}}else if(this.options.toolbox_config)throw new Error("Can't nullify an existing toolbox.")},t.prototype.translate=function(t,e){if(this.use_workspace_drag_surface_&&this.is_drag_surface_active_&&this.workspace_drag_surface_)this.workspace_drag_surface_.translate_surface(t+this.offset[0],e+this.offset[1]);else{var o="translate("+t+", "+e+") scale("+this.scale+")";null!=this.svg_block_canvas_&&this.svg_block_canvas_.setAttribute("transform",o),null!=this.svg_bubble_canvas_&&this.svg_bubble_canvas_.setAttribute("transform",o)}this.block_drag_surface_&&this.block_drag_surface_.translate_and_scale_group(t+this.offset[0],e+this.offset[1],this.scale)},t.prototype.new_block=function(t,e){return this.block_factory({workspace:this,id:e,prototype_name:t})},t.prototype.get_svg_xy=function(t){var e=r.vec2.create(),o=t,i=1,n=this.get_canvas(),s=this.get_bubble_canvas();(null!=n&&n.contains(o)||null!=s&&s.contains(o))&&(i=this.scale);do{var _=this.utils.get_relative_xy(o);o!=this.get_canvas()&&o!=this.get_bubble_canvas()||(i=1),r.vec2.scaleAndAdd(e,e,_,i),o=o.parentNode}while(o&&o!=this.get_parent_svg());return e},t.prototype.resize=function(){this.toolbox_&&this.toolbox_.position(),this.flyout_&&this.flyout_.position(),this._scrollbar?this._scrollbar.resize():this.translate(this.scroll_xy[0],this.scroll_xy[1]),this.update_screen_calculations()},t.prototype.update_screen_calculations=function(){this.inverse_screen_CTM_dirty_=!0,this.workspace_area_dirty_=!0,this.record_cached_areas()},t.prototype.record_cached_areas=function(){this.record_blocks_area_(),this.record_delete_areas()},t.prototype.record_blocks_area_=function(){var t=this.get_injection_div();this.blocks_area_=t?t.getBoundingClientRect():void 0},t.prototype.get_canvas=function(){return this.svg_block_canvas_},t.prototype.is_dragging=function(){return this.current_gesture_&&this.current_gesture_.is_dragging()},t.prototype.set_resizes_enabled=function(t){var e=!this.resizes_enabled_&&t;this.resizes_enabled_=t,e&&this.resize_contents()},t.prototype.cancel_current_gesture=function(){this.current_gesture_&&this.current_gesture_.cancel()},t.prototype.get_audio_manager=function(){return this.audio_manager_},t.prototype.get_gesture=function(t){var e="mousedown"==t.type||"touchstart"==t.type,o=this.current_gesture_;return o?e&&o.has_started()?void o.cancel():o:e?(this.current_gesture_=this.gesture_factory({event:t,workspace:this}),this.current_gesture_):void 0},t.prototype.get_grid=function(){return this.grid_},t.prototype.is_inside_workspace_area=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY),o=this.get_workspace_area();return!!o&&(0,l.contains)(o,e)},t.prototype.is_inside_blocks_area=function(t){var e=r.vec2.fromValues(t.clientX,t.clientY);return!!(this.is_delete_area(t)||this.blocks_area_&&(0,l.contains)(this.blocks_area_,e))},t.prototype.setup_drag_surface=function(){if(this.use_workspace_drag_surface_&&this.workspace_drag_surface_&&!this.is_drag_surface_active_){if(null==this.svg_block_canvas_)throw new ReferenceError("Block Canvas not found when draging.");this.is_drag_surface_active_=!0;var t=this.svg_block_canvas_.previousSibling||void 0;if(null!=this.get_parent_svg()){var e=this.utils.get_relative_xy(this.svg_block_canvas_);this.workspace_drag_surface_&&(this.workspace_drag_surface_.set_contents_and_show(this.svg_block_canvas_,this.svg_bubble_canvas_,t,this.scale),this.workspace_drag_surface_.translate_surface(e[0]+this.offset[0],e[1]+this.offset[1]))}}},t.prototype.reset_drag_surface=function(){if(this.use_workspace_drag_surface_&&this.workspace_drag_surface_){this.is_drag_surface_active_=!1;var t=this.workspace_drag_surface_.get_surface_translation();this.workspace_drag_surface_.clear_and_hide(this.svg_group);var e="translate("+(t[0]-this.offset[0])+", "+(t[1]-this.offset[1])+") scale("+this.scale+")";null!=this.svg_block_canvas_&&this.svg_block_canvas_.setAttribute("transform",e),null!=this.svg_bubble_canvas_&&this.svg_bubble_canvas_.setAttribute("transform",e)}},t.prototype.refresh_toolbox_selection=function(){if(this.toolbox_)this.toolbox_.flyout&&!this.current_gesture_&&this.toolbox_refresh_enabled_&&this.toolbox_.refresh_selection();else{var t=this.target_workspace,e=null==t?void 0:t.get_toolbox();t&&e&&e.flyout&&!t.current_gesture_&&t.get_toolbox_refresh_enabled&&e.refresh_selection()}},t.prototype.register_toolbox_category_callback=function(t,e){this.toolbox_category_callbacks_&&(this.toolbox_category_callbacks_[t]=e)},t.prototype.get_parent_svg=function(){if(this.cached_parent_svg_)return this.cached_parent_svg_;for(var t=this.svg_group;t;){if("svg"==t.tagName)return this.cached_parent_svg_=t,t;t=t.parentNode}throw new Error("Workspace may not been init.")},t.prototype.get_blocks_bounding_box=function(){var t=this.get_top_blocks(!1);if(this.workspace_comment_db.forEach(function(e){t.push(e)}),!t.length)return{x:0,y:0,width:0,height:0};for(var e=t[0].get_bounding_rectangle(),o=1;o<t.length;o++){var i=t[o].get_bounding_rectangle();i.topLeft[0]<e.topLeft[0]&&(e.topLeft[0]=i.topLeft[0]),i.bottomRight[0]>e.bottomRight[0]&&(e.bottomRight[0]=i.bottomRight[0]),i.topLeft[1]<e.topLeft[1]&&(e.topLeft[1]=i.topLeft[1]),i.bottomRight[1]>e.bottomRight[1]&&(e.bottomRight[1]=i.bottomRight[1])}return{x:e.topLeft[0],y:e.topLeft[1],width:e.bottomRight[0]-e.topLeft[0],height:e.bottomRight[1]-e.topLeft[1]}},t.prototype.set_resize_handler_wrapper=function(t){this.resize_handler_wrapper_=t},t.prototype.resize_contents=function(){this.resizes_enabled_&&this.rendered&&(this._scrollbar&&this._scrollbar.resize(),this.inverse_screen_CTM_dirty_=!0)},t.prototype.get_bubble_canvas=function(){return this.svg_bubble_canvas_},t.prototype.add_flyout=function(t){var e=Object.assign({},this.options,{parentWorkspace:this});return this.flyout_=this.flyout_factory(e),this.flyout_.create_dom(t)},t.prototype.get_toolbox_category_callback=function(t){return this.toolbox_category_callbacks_?this.toolbox_category_callbacks_[t]:void 0},t.prototype.update_screen_calculations_if_scrolled=function(){var t=(0,c.get_document_scroll)();null!=this.last_recorded_page_scroll_&&r.vec2.equals(this.last_recorded_page_scroll_,t)||(this.last_recorded_page_scroll_=t,this.update_screen_calculations())},t.prototype.mark_focused=function(){this.options.parentWorkspace instanceof e?this.options.parentWorkspace.mark_focused():(this.Blink.mainWorkspace=this,this.set_browser_focus())},t.prototype.set_browser_focus=function(){document.activeElement&&document.activeElement.blur();try{this.get_parent_svg().focus()}catch(e){try{(t=this.get_parent_svg())&&t.setActive()}catch(e){var t;(t=this.get_parent_svg())&&t.focus()}}},t.prototype.get_inverse_screen_ctm=function(){var t=this.get_parent_svg();if(this.inverse_screen_CTM_dirty_&&null!=t){var e=t.getScreenCTM();e&&(this.inverse_screen_CTM_=e.inverse(),this.inverse_screen_CTM_dirty_=!1)}return this.inverse_screen_CTM_},t.prototype.get_origin_offset_in_pixels=function(){if(null==this.svg_block_canvas_)throw new ReferenceError("Block Canvas not found when get origin offset.");return this.utils.get_injection_div_xy(this.svg_block_canvas_)},t.prototype.get_injection_div=function(){return this.injection_div_},t.prototype.dispose=function(){var t;if(this.rendered=!1,this.current_gesture_&&this.current_gesture_.cancel(),this.listeners_.length=0,this.clear(),this.workspace_db.remove(this),this.svg_group&&((0,c.remove_node)(this.svg_group),this.svg_group=void 0),this.svg_block_canvas_=void 0,this.svg_bubble_canvas_=void 0,this.toolbox_&&(this.toolbox_.dispose(),this.toolbox_=void 0),this.flyout_&&(this.flyout_.dispose(),this.flyout_=void 0),this._scrollbar&&(this._scrollbar.dispose(),delete this._scrollbar),null!==(t=this.grid_)&&void 0!==t&&t.dispose(),this.grid_=void 0,this.toolbox_category_callbacks_={},this.flyout_button_callbacks_={},this.custom_flyout_buttons.clear(),!this.options.parentWorkspace){var e=this.get_parent_svg();if(null==e)throw new ReferenceError;var o=e.parentNode;null!=o&&(0,c.remove_node)(o)}this.resize_handler_wrapper_&&(this.events.unbind_event(this.resize_handler_wrapper_),this.resize_handler_wrapper_=void 0)},t.prototype.set_visible=function(t){this._scrollbar&&this._scrollbar.set_container_visible(t);var e=this.get_flyout();null!=e&&e.set_container_visible(t);var o=this.get_parent_svg();if(null==o)throw new ReferenceError("Workspace may not been init.");if(o.style.display=t?"block":"none",this.toolbox_&&(this.toolbox_.html_div.style.display=t?"block":"none"),t){for(var i=this.get_all_blocks(),n=i.length-1;n>=0;n--)i[n].render(!1);this.resize()}else this.utils.hide_chaff(!0)},t.prototype.glow_stack=function(t,e){var o=this.get_block_by_id(t);if(!o)throw new Error("Tried to glow stack on block that does not exist.");o.set_glow_stack(e)},t.prototype.on_mouse_down=function(t){var e=this.get_gesture(t);e&&e.handle_ws_start(t,this)},t.prototype.start_drag=function(t,e){var o=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());o.x/=this.scale,o.y/=this.scale;var i=r.vec2.fromValues(o.x,o.y);this.drag_delta_xy_=r.vec2.sub(e,e,i)},t.prototype.move_drag=function(t){var e=this.utils.mouse_to_svg(t,this.get_parent_svg(),this.get_inverse_screen_ctm());e.x/=this.scale,e.y/=this.scale;var o=r.vec2.fromValues(e.x,e.y);return r.vec2.fromValues(this.drag_delta_xy_[0]+o[0],this.drag_delta_xy_[1]+o[1])},t.prototype.is_draggable=function(){return!!this._scrollbar},t.prototype.clean_up=function(t){this.set_resizes_enabled(!1);var e=this.events.get_group();this.events.set_group(e||!0);for(var o=this.get_top_elements(!0),i=r.vec2.fromValues(0,0),n=0;n<o.length;n++)o[n].sort(i);if(t&&this._scrollbar){var s=this.get_metrics(),_=-s.contentLeft-t[0],a=-s.contentTop-t[1];this._scrollbar.set(_,a)}this.events.set_group(e),this.set_resizes_enabled(!0)},t.prototype.zoom=function(t,e,o){var i=this.options.zoomOptions.scaleSpeed,n=Math.pow(i,o),s=Math.max(this.options.zoomOptions.minScale,Math.min(this.scale*n,this.options.zoomOptions.maxScale));if(n=s/this.scale,this.scale!=s){if(this._scrollbar&&this.svg_block_canvas_){var _=this.svg_block_canvas_.getCTM();if(!_)return void console.error("Get Canvas CTM failed.");var a=this.get_parent_svg().createSVGPoint();a.x=t,a.y=e,t=(a=a.matrixTransform(_.inverse())).x,e=a.y;var l=_.translate(t*(1-n),e*(1-n)).scale(n);r.vec2.set(this.scroll_xy,l.e,l.f)}this.set_scale(s)}},t.prototype.zoom_center=function(t){var e=this.get_metrics(),o=e.viewWidth/2,i=e.viewHeight/2;this.zoom(o,i,t)},t.prototype.zoom_to_fit=function(){var t=this.get_metrics(),e=this.get_blocks_bounding_box(),o=e.width,i=e.height;if(o){var n=t.viewWidth,r=t.viewHeight;this.flyout_&&(n-=this.flyout_.get_width()),this._scrollbar||(o+=t.contentLeft,i+=t.contentTop);var s=n/o,_=r/i;this.set_scale(Math.min(s,_)),this.scroll_center()}},t.prototype.scroll_center=function(){if(this._scrollbar){this.widget_div.hide(!0),this.utils.hide_chaff(!1);var t=this.get_metrics(),e=(t.contentWidth-t.viewWidth)/2;this.flyout_&&(e-=this.flyout_.get_width()/2);var o=(t.contentHeight-t.viewHeight)/2;this._scrollbar.set(e,o)}},t.prototype.center_on_block=function(t){if(this._scrollbar){var e=this.get_block_by_id(t);if(e){var o=e.get_relative_to_surface_xy(),i=e.get_height_width(),n=o[1]+i.height/2,r=this.RTL?-1:1,s=o[0]+r*i.width/2,_=this.scale,a=s*_,l=n*_,c=this.get_metrics(),h=a-c.contentLeft,d=l-c.contentTop,p=h-c.viewWidth/2,u=d-c.viewHeight/2;this.utils.hide_chaff(),this._scrollbar.set(p,u)}}},t.prototype.set_scale=function(t){var e,o;t=Math.max(this.options.zoomOptions.minScale,Math.min(t,this.options.zoomOptions.maxScale)),this.rendered||(this.scale=t),this.events.is_enabled()&&(o=this.ui_event_factory({type:_.UIEventType.SCALE,workspace_id:this.id,old_value:this.scale,new_value:t})),this.scale=t,this.events.fire(o),null!==(e=this.grid_)&&void 0!==e&&e.set_scale(this.scale),this._scrollbar?this._scrollbar.resize():this.translate(this.scroll_xy[0],this.scroll_xy[1]),this.utils.hide_chaff(!1,!0);var i=function(e){var o=e.getAttribute("transform"),i="scale("+t+")";e.setAttribute("transform",o?o.replace(/scale\([0-9\.]+\)/,i):i)};this.svg_block_canvas_&&i(this.svg_block_canvas_),this.svg_bubble_canvas_&&i(this.svg_bubble_canvas_),this.block_drag_surface_&&this.block_drag_surface_.set_scale(t),this.flyout_&&this.flyout_.reflow()},t.prototype.scroll=function(t,e){if(this._scrollbar&&this.start_drag_metrics){var o=this.start_drag_metrics;t=Math.min(t,-o.contentLeft),e=Math.min(e,-o.contentTop),t=Math.max(t,o.viewWidth-o.contentLeft-o.contentWidth),e=Math.max(e,o.viewHeight-o.contentTop-o.contentHeight),this.widget_div.hide(!0),this._scrollbar.set(-t-o.contentLeft,-e-o.contentTop)}},t.getDimensionsPx_=function(t){var e=0,o=0;return t&&(e=t.get_width(),o=t.get_height()),{width:e,height:o}},t.getContentDimensions_=function(t,e){return t._scrollbar?this.getContentDimensionsBounded_(t,e):this.getContentDimensionsExact_(t)},t.getContentDimensionsExact_=function(t){var e=t.get_blocks_bounding_box(),o=t.get_scale(),i=e.width*o,n=e.height*o,r=e.x*o,s=e.y*o;return{left:r,top:s,right:r+i,bottom:s+n,width:i,height:n}},t.getContentDimensionsBounded_=function(t,e){var o=this.getContentDimensionsExact_(t),i=e.width||0,n=e.height||0,r=i,s=n,_=t.options.workspace.content_margin;if("number"==typeof _)r=_,s=_;else{var a=_.match(/[0-9]+%/),l=a&&a[0]&&parseFloat(a[0])/100;("number"!=typeof l||isNaN(l))&&(console.error("option workspace.content_margin is not a valid percentage. Using default value (50%)."),l=.5),r=i*l,s=n*l}var c=Math.min(o.left-r,o.right-i),h=Math.max(o.right+r,o.left+i),d=Math.min(o.top-s,o.bottom-n);return{left:c,top:d,height:Math.max(o.bottom+s,o.top+n)-d,width:h-c}},t.prototype.get_metrics=function(){var t=e.getDimensionsPx_(this.toolbox_),o=this.flyout_||this.toolbox_&&this.toolbox_.flyout,i=o&&!o.is_auto_close()&&o.is_visible()?e.getDimensionsPx_(o):{width:0,height:0},n=this.utils.get_svg_size(this.get_parent_svg()),r=e.getContentDimensions_(this,n),s=0;this.toolbox_&&this.toolbox_position==_.TOOLBOX_POSITION.LEFT&&(s+=t.width,s+=i.width);var a=0;return this.toolbox_&&this.toolbox_position==_.TOOLBOX_POSITION.TOP&&(a=t.height,a+=i.height),{absoluteTop:a,absoluteLeft:s,contentHeight:r.height,contentWidth:r.width,contentTop:r.top,contentLeft:r.left,viewHeight:n.height||0,viewWidth:n.width||0,viewTop:-this.scroll_xy[1],viewLeft:-this.scroll_xy[0],flyoutWidth:i.width,flyoutHeight:i.height,toolboxWidth:t.width,toolboxHeight:t.height,toolboxPosition:this.toolbox_position}},t.prototype.set_metrics=function(t){var e;if(!this.get_scrollbar())throw new Error("Attempt to set top level workspace scroll without scrollbars.");var o=this.get_metrics();(0,d.is_number)(t.x)&&(this.content_offset_by_view[0]=t.x,this.scroll_xy[0]=-o.contentLeft-t.x),(0,d.is_number)(t.y)&&(this.content_offset_by_view[1]=t.y,this.scroll_xy[1]=-o.contentTop-t.y);var i=this.scroll_xy[0],n=this.scroll_xy[1];this.translate(i,n),null!==(e=this.grid_)&&void 0!==e&&e.move_to(i,n)},t.prototype.set_toolbox_refresh_enabled=function(t){var e=!this.toolbox_refresh_enabled_&&t;this.toolbox_refresh_enabled_=t,e&&this.refresh_toolbox_selection()},t.prototype.get_toolbox_refresh_enabled=function(){return this.toolbox_refresh_enabled_},t.prototype.clear=function(t){void 0===t&&(t=!0),this.set_resizes_enabled(!1),this.is_clearing=!0;var e=this.events.get_group();for(e||this.events.set_group(!0),t&&this.widget_div&&this.widget_div.hide(!0),t&&this.Blink.tooltip&&this.Blink.tooltip.hide();this.top_blocks_.length;)this.top_blocks_[0].dispose();for(;this.top_comments.length;)this.top_comments[0].dispose();e||this.events.set_group(!1),this.is_clearing=!1,this.set_resizes_enabled(!0)},t.prototype.register_button_callback=function(t,e){(0,d.is_func)(e)||console.error("Button callbacks must be functions."),this.flyout_button_callbacks_&&(this.flyout_button_callbacks_[t]=e)},t.prototype.get_button_callback=function(t){return this.flyout_button_callbacks_?this.flyout_button_callbacks_[t]:void 0},t.prototype.remove_button_callback=function(t){this.flyout_button_callbacks_&&(this.flyout_button_callbacks_[t]=void 0)},t.prototype.remove_toolbox_category_callback=function(t){this.toolbox_category_callbacks_&&(this.toolbox_category_callbacks_[t]=void 0)},t.prototype.clear_gesture=function(){this.current_gesture_=void 0},t.prototype.register_flyout_button=function(t,e){this.custom_flyout_buttons.set(t,e)},t.prototype.get_custom_flyout_button=function(t){return this.custom_flyout_buttons.get(t)},t.prototype.set_read_only=function(t){this.options.readOnly=t},t.prototype.set_hotkey_enable=function(t){this.is_hotkey_enable=t},t.prototype.get_hotkey_enable=function(){return this.is_hotkey_enable},t.prototype.show_external_comment_editor=function(t){return(0,i.__awaiter)(this,void 0,void 0,function(){return(0,i.__generator)(this,function(e){return[2,window.prompt("Enter comment text",t)||""]})})},t.prototype.register_comment_editor=function(t){this.show_external_comment_editor=t},t.prototype.for_each_element_in_stack=function(t,e,o){var i;void 0===o&&(o=!1);var n=this.Blink.mainWorkspace.get_element_from_db(t);null!==(i=null==n?void 0:n.get_top_parent())&&void 0!==i&&i.for_each_descendant_element(e,o)},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Blink)],t.prototype,"Blink",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Msg)],t.prototype,"Msg",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.context_menu)],t.prototype,"context_menu",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.widget_div)],t.prototype,"widget_div",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],t.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.WorkspaceComment)],t.prototype,"workspace_comment_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.BlockSvg)],t.prototype,"block_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Toolbox)],t.prototype,"toolbox_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.VerticalFlyout)],t.prototype,"flyout_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Gesture)],t.prototype,"gesture_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.ConnectionDB)],t.prototype,"connection_db_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.WorkspaceAudio)],t.prototype,"workspace_audio_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Grid)],t.prototype,"grid_factory",void 0),e=(0,i.__decorate)([(0,n.injectable)()],t)}();e.WorkspaceSvg=u},69920:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ScrollbarPair=e.Scrollbar=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(32791),a=o(15261),l=function(){function t(t,o,i,n,s){void 0===i&&(i=!1),void 0===n&&(n=""),void 0===s&&(s=!0),this.origin_=r.vec2.create(),this.size_ratio_=0,this.start_drag_handle=0,this.handle_position_=0,this.start_drag_mouse=0,this.handle_length_=0,this.scroll_view_size_=0,this.scroll_content_size_=0,this.container_visible_=!0,this.is_visible_=!0,this.workspace_=t,this.pair_=i||!1,this.horizontal_=o,this.old_host_metrics_=void 0;var _="blocklyScrollbar"+(this.horizontal_?"Horizontal":"Vertical");n&&(_+=" "+n),this.outer_svg_=(0,a.create_svg_element)("svg",{class:_}),this.svg_group=(0,a.create_svg_element)("g",{},this.outer_svg_),this.svg_background_=(0,a.create_svg_element)("rect",{class:"blocklyScrollbarBackground"},this.svg_group);var l=Math.floor((e.scrollbar_thickness-5)/2);this.svg_handle_=(0,a.create_svg_element)("rect",{class:"blocklyScrollbarHandle",rx:l,ry:l},this.svg_group),o?(this.svg_background_.setAttribute("height",e.scrollbar_thickness.toString()),this.outer_svg_.setAttribute("height",e.scrollbar_thickness.toString()),this.svg_handle_.setAttribute("height",(e.scrollbar_thickness-9).toString()),this.svg_handle_.setAttribute("y","5"),this.length_attribute_="width",this.position_attribute_="x"):(this.svg_background_.setAttribute("width",e.scrollbar_thickness.toString()),this.outer_svg_.setAttribute("width",e.scrollbar_thickness.toString()),this.svg_handle_.setAttribute("width",(e.scrollbar_thickness-9).toString()),this.svg_handle_.setAttribute("x","5"),this.length_attribute_="height",this.position_attribute_="y"),(0,a.insert_after)(this.outer_svg_,this.workspace_.get_parent_svg()),this.on_mouse_down_bar_wrapper_=this.events.bind_event_with_checks(this.svg_background_,"mousedown",this,this.on_mouse_down_bar),this.on_mouse_down_handle_wrapper_=this.events.bind_event_with_checks(this.svg_handle_,"mousedown",this,this.on_mousedown_handle),this.position_=r.vec2.fromValues(0,0),this.opt_visible=s,s||this.update_display()}var e;return e=t,t.prototype.resize_view=function(t){var o=this.horizontal_?t.viewWidth-1:t.viewHeight-1;this.pair_&&(o-=e.scrollbar_thickness),this.set_scroll_view_size(Math.max(0,o));var i=t.absoluteLeft+.5,n=t.absoluteTop+.5;this.horizontal_?n+=t.viewHeight-e.scrollbar_thickness-1:i+=t.viewWidth-e.scrollbar_thickness-1,this.set_position(i,n),this.resize_content(t)},t.prototype.resize_content=function(t){var e;this.scroll_content_size_=this.horizontal_?t.contentWidth:t.contentHeight,this.pair_||this.set_visible(this.scroll_view_size_<this.scroll_content_size_),this.size_ratio_=this.scroll_view_size_/this.scroll_content_size_,(this.size_ratio_==-1/0||this.size_ratio_==1/0||isNaN(this.size_ratio_))&&(this.size_ratio_=0);var o=this.scroll_view_size_*this.size_ratio_;this.set_handle_length(Math.max(0,o));var i={};this.horizontal_?(i.x=this.constrain_target_pos(t.viewLeft-t.contentLeft),this.set_handle_position(i.x*this.size_ratio_)):(i.y=this.constrain_target_pos(t.viewTop-t.contentTop),this.set_handle_position(i.y*this.size_ratio_)),null!==(e=this.workspace_)&&void 0!==e&&e.set_metrics(i)},t.prototype.set_handle_length=function(t){var e;this.handle_length_=t,null!==(e=this.svg_handle_)&&void 0!==e&&e.setAttribute(this.length_attribute_,String(this.handle_length_))},t.prototype.set_visible=function(t){var e=t!=this.is_visible();if(this.pair_)throw new Error("Unable to toggle visibility of paired scrollbars.");this.is_visible_=t,e&&this.update_display()},t.prototype.set_position=function(t,e){if(this.outer_svg_){this.position_[0]=t,this.position_[1]=e;var o="translate("+(this.position_[0]+this.origin_[0])+"px, "+(this.position_[1]+this.origin_[1])+"px)";(0,a.set_css_transform)(this.outer_svg_,o)}},t.prototype.set_scroll_view_size=function(t){var e,o;this.scroll_view_size_=t,null!==(e=this.outer_svg_)&&void 0!==e&&e.setAttribute(this.length_attribute_,String(this.scroll_view_size_)),null!==(o=this.svg_background_)&&void 0!==o&&o.setAttribute(this.length_attribute_,String(this.scroll_view_size_))},t.prototype.dispose=function(){this.clean_up(),this.on_mouse_down_bar_wrapper_&&(this.events.unbind_event(this.on_mouse_down_bar_wrapper_),this.on_mouse_down_bar_wrapper_=void 0),this.on_mouse_down_handle_wrapper_&&(this.events.unbind_event(this.on_mouse_down_handle_wrapper_),this.on_mouse_down_handle_wrapper_=void 0),this.outer_svg_&&(0,a.remove_node)(this.outer_svg_),delete this.outer_svg_,delete this.svg_group,delete this.svg_background_,delete this.svg_handle_,delete this.workspace_},t.prototype.metrics_are_equivalent=function(t,e){return!(!t||!e)&&t.viewWidth==e.viewWidth&&t.viewHeight==e.viewHeight&&t.viewLeft==e.viewLeft&&t.viewTop==e.viewTop&&t.absoluteTop==e.absoluteTop&&t.absoluteLeft==e.absoluteLeft&&t.contentWidth==e.contentWidth&&t.contentHeight==e.contentHeight&&t.contentLeft==e.contentLeft&&t.contentTop==e.contentTop},t.prototype.set_origin=function(t){this.origin_=t},t.prototype.is_visible=function(){return this.is_visible_},t.prototype.set_container_visible=function(t){var e=t!=this.container_visible_;this.container_visible_=t,e&&this.update_display()},t.prototype.update_display=function(){if(null==this.outer_svg_)throw new Error("outerSvg_ is undefined");this.opt_visible&&this.is_visible()&&this.container_visible_?this.outer_svg_.setAttribute("display","block"):this.outer_svg_.setAttribute("display","none")},t.prototype.on_mouse_move_handle=function(t){var e=(this.horizontal_?t.clientX:t.clientY)-this.start_drag_mouse,o=(this.start_drag_handle+e)/this.size_ratio_;this.set(o)},t.prototype.on_mouse_up_handle=function(){var t;null!==(t=this.workspace_)&&void 0!==t&&t.reset_drag_surface(),this.touch_manager.clear_touch_identifier(),this.clean_up()},t.prototype.on_mousedown_handle=function(t){var o,i;null!==(o=this.workspace_)&&void 0!==o&&o.mark_focused(),this.clean_up(),this.utils.is_right_button(t)?t.stopPropagation():(this.start_drag_handle=this.handle_position_,null!==(i=this.workspace_)&&void 0!==i&&i.setup_drag_surface(),this.start_drag_mouse=this.horizontal_?t.clientX:t.clientY,e.on_mouse_up_wrapper_=this.events.bind_event_with_checks(document,"mouseup",this,this.on_mouse_up_handle),e.on_mouse_move_wrapper_=this.events.bind_event_with_checks(document,"mousemove",this,this.on_mouse_move_handle),t.stopPropagation(),t.preventDefault())},t.prototype.clean_up=function(){this.utils.hide_chaff(!0),e.on_mouse_up_wrapper_&&(this.events.unbind_event(e.on_mouse_up_wrapper_),e.on_mouse_up_wrapper_=void 0),e.on_mouse_move_wrapper_&&(this.events.unbind_event(e.on_mouse_move_wrapper_),e.on_mouse_move_wrapper_=void 0)},t.prototype.on_mouse_down_bar=function(t){if(!this.workspace_||!this.svg_handle_)throw new Error("this.workspace_ is undefined");if(this.workspace_.mark_focused(),this.touch_manager.clear_touch_identifier(),this.clean_up(),this.utils.is_right_button(t))t.stopPropagation();else{var e=this.utils.mouse_to_svg(t,this.workspace_.get_parent_svg(),this.workspace_.get_inverse_screen_ctm()),o=this.horizontal_?e.x:e.y,i=this.utils.get_injection_div_xy(this.svg_handle_),n=this.horizontal_?i[0]:i[1],r=this.handle_position_,s=.95*this.handle_length_;o<=n?r-=s:o>=n+this.handle_length_&&(r+=s);var _=r/this.size_ratio_;this.set(_),t.stopPropagation(),t.preventDefault()}},t.prototype.set_handle_position=function(t){this.svg_handle_&&(this.handle_position_=t,"y"==this.position_attribute_?(0,a.set_css_transform)(this.svg_handle_,"translate3d(0px, "+this.handle_position_+"px, 0px)"):"x"==this.position_attribute_&&(0,a.set_css_transform)(this.svg_handle_,"translate3d("+this.handle_position_+"px, 0px, 0px)"))},t.prototype.constrain_target_pos=function(t){return Math.max(0,Math.min(t,this.scroll_content_size_-this.scroll_view_size_))},t.prototype.set=function(t){if(this.workspace_){var e=this.workspace_.content_offset_by_view[this.horizontal_?0:1];if((t=this.constrain_target_pos(t))!==e){this.set_handle_position(t*this.size_ratio_);var o={};this.horizontal_?o.x=t:o.y=t,this.workspace_.set_metrics(o);var i=this.horizontal_?_.UIEventType.H_SCROLLBAR_SET:_.UIEventType.V_SCROLLBAR_SET;this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:i,workspace_id:this.workspace_.id,old_value:e,new_value:t}))}}},t.prototype.set_block_offset_by_view=function(t){if(this.workspace_){var e=this.workspace_.content_offset_by_view[this.horizontal_?0:1],o={},i=this.workspace_.get_metrics();if(this.horizontal_?(t=this.constrain_target_pos(-i.contentLeft-t),o.x=t):(t=this.constrain_target_pos(-i.contentTop-t),o.y=t),t!==e){this.workspace_.set_metrics(o);var n=this.workspace_.content_offset_by_view;this.horizontal_?this.set_handle_position(n[0]*this.size_ratio_):this.set_handle_position(n[1]*this.size_ratio_);var r=this.horizontal_?_.UIEventType.H_SCROLLBAR_SET:_.UIEventType.V_SCROLLBAR_SET;this.events.is_enabled()&&this.events.fire(this.ui_event_factory({type:r,workspace_id:this.workspace_.id,old_value:e,new_value:t}))}}},t.prototype.resize=function(t){if(this.workspace_){var e=t||this.workspace_.get_metrics();e&&e.viewWidth&&e.viewHeight&&(this.old_host_metrics_&&this.metrics_are_equivalent(e,this.old_host_metrics_)||(this.old_host_metrics_=e,this.resize_view(e)))}},t.scrollbar_thickness=15,(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),e=(0,i.__decorate)([(0,n.injectable)()],t)}();e.Scrollbar=l;var c=function(){function t(t,e){void 0===e&&(e=!0),this.old_host_metrics_=void 0,this.workspace_=t,this.h_scroll=new l(t,!0,!0,"blocklyMainWorkspaceScrollbar",e),this.v_scroll=new l(t,!1,!0,"blocklyMainWorkspaceScrollbar",e)}return t.prototype.set_container_visible=function(t){var e,o;null!==(e=this.h_scroll)&&void 0!==e&&e.set_container_visible(t),null!==(o=this.v_scroll)&&void 0!==o&&o.set_container_visible(t)},t.prototype.dispose=function(){var t,e;delete this.workspace_,this.old_host_metrics_=void 0,null!==(t=this.h_scroll)&&void 0!==t&&t.dispose(),delete this.h_scroll,null!==(e=this.v_scroll)&&void 0!==e&&e.dispose(),delete this.v_scroll},t.prototype.resize=function(){var t,e;if(this.workspace_){var o=this.workspace_.get_metrics();if(o){var i=!1,n=!1;this.old_host_metrics_&&this.old_host_metrics_.viewWidth==o.viewWidth&&this.old_host_metrics_.viewHeight==o.viewHeight&&this.old_host_metrics_.absoluteTop==o.absoluteTop&&this.old_host_metrics_.absoluteLeft==o.absoluteLeft?(this.old_host_metrics_&&this.old_host_metrics_.contentWidth==o.contentWidth&&this.old_host_metrics_.viewLeft==o.viewLeft&&this.old_host_metrics_.contentLeft==o.contentLeft||(i=!0),this.old_host_metrics_&&this.old_host_metrics_.contentHeight==o.contentHeight&&this.old_host_metrics_.viewTop==o.viewTop&&this.old_host_metrics_.contentTop==o.contentTop||(n=!0)):(i=!0,n=!0),i&&null!==(t=this.h_scroll)&&void 0!==t&&t.resize(o),n&&null!==(e=this.v_scroll)&&void 0!==e&&e.resize(o),this.old_host_metrics_=o}}},t.prototype.set=function(t,e){if(this.h_scroll&&this.v_scroll&&this.workspace_){var o=this.workspace_.content_offset_by_view,i={x:this.h_scroll.constrain_target_pos(t),y:this.v_scroll.constrain_target_pos(e)};i.x===o[0]&&i.y===o[1]||(this.workspace_.set_metrics(i),this.h_scroll.set_handle_position(i.x*this.h_scroll.size_ratio_),this.v_scroll.set_handle_position(i.y*this.v_scroll.size_ratio_),this.events.is_enabled()&&(this.events.fire(this.ui_event_factory({type:_.UIEventType.H_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[0],new_value:i.x})),this.events.fire(this.ui_event_factory({type:_.UIEventType.V_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[1],new_value:i.y}))))}},t.prototype.set_block_offset_by_view=function(t,e){if(this.h_scroll&&this.v_scroll&&this.workspace_){var o=this.workspace_.content_offset_by_view,i=this.workspace_.get_metrics(),n={x:this.h_scroll.constrain_target_pos(-i.contentLeft-t),y:this.v_scroll.constrain_target_pos(-i.contentTop-e)};n.x===o[0]&&n.y===o[1]||(this.workspace_.set_metrics(n),this.h_scroll.set_handle_position(n.x*this.h_scroll.size_ratio_),this.v_scroll.set_handle_position(n.y*this.v_scroll.size_ratio_),this.events.is_enabled()&&(this.events.fire(this.ui_event_factory({type:_.UIEventType.H_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[0],new_value:n.x})),this.events.fire(this.ui_event_factory({type:_.UIEventType.V_SCROLLBAR_SET,workspace_id:this.workspace_.id,old_value:o[1],new_value:n.y}))))}},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.UIEvent)],t.prototype,"ui_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.ScrollbarPair=c},74119:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.bind_di_modules=void 0;var i=o(40310),n=o(44665),r=o(96375),s=o(1737),_=o(43028),a=o(93235),l=o(29566),c=o(56206),h=o(97694),d=o(68607),p=o(15970),u=o(48071),g=o(11384),v=o(54053),f=o(32846),b=o(87203),m=o(18916),y=o(94081),k=o(86202),w=o(20014),E=o(55631),T=o(41221),x=o(6084),I=o(45276),O=o(98552),N=o(35239),A=o(29158),C=o(2109),S=o(5472),L=o(32776),D=o(12642),R=o(20137),B=o(65428),M=o(94421),P=o(79358),G=o(57647),z=o(76608),U=o(69180),j=o(47187),F=o(92251),H=o(46656),W=o(48635),V=o(99686),X=o(1265),Y=o(78525),K=o(84124),q=o(10576),Q=o(16991),J=o(34156),Z=o(92314),$=o(14435),tt=o(35425),et=o(66148),ot=o(10268),it=o(17419),nt=o(3986),rt=o(77740),st=o(81818),_t=o(74954),at=o(28175),lt=o(69920),ct=o(94133),ht=o(63614),dt=o(24042),pt=o(86865);e.bind_di_modules=function(t){t.bind(pt.BINDING.ChangeEvent).toFunction(function(t,e){if(!function(t){return t.block instanceof j.WorkspaceElement}(e)||"string"!=typeof t)throw new Error("\n        Trying to create invalid change event with event "+t+" and param "+e+".\n        It may caused by wrong custom change event subtype registry.\n        Note that options of any change event should include [block], [old_value] and [new_value].\n        Check https://codemao.yuque.com/milktea/blink/zy9tlg for more information.\n      ");return new i.ChangeEvent(t,e)}),t.bind(pt.BINDING.CreateEvent).toFunction(function(t){return new i.CreateEvent(t)}),t.bind(pt.BINDING.DeleteEvent).toFunction(function(t){return new i.DeleteEvent(t)}),t.bind(pt.BINDING.DragAreaChangeEvent).toFunction(function(t){return new i.DragAreaChangeEvent(t)}),t.bind(pt.BINDING.EndDragEvent).toFunction(function(t){return new i.EndDragEvent(t)}),t.bind(pt.BINDING.MoveEvent).toFunction(function(t){return new i.MoveEvent(t)}),t.bind(pt.BINDING.StartDragEvent).toFunction(function(t){return new i.StartDragEvent(t)}),t.bind(pt.BINDING.ContextMenuOptionEvent).toFunction(function(t){return new n.ContextMenuOptionEvent(t)}),t.bind(pt.BINDING.GroupEvent).toFunction(function(t){return new n.GroupEvent(t)}),t.bind(pt.BINDING.UIEvent).toFunction(function(t){return new n.UIEvent(t)}),t.bind(pt.BINDING.FlyoutButton).toFunction(function(t){return new r.FlyoutButton(t)}),t.bind(pt.BINDING.VerticalFlyout).toFunction(function(t){return new s.VerticalFlyout(t)}),t.bind(pt.BINDING.WorkspaceElementDragger).toFunction(function(t){if((0,dt.is_block_svg)(t.target))return new _.BlockDragger({target:t.target,workspace:t.workspace});if((0,dt.is_workspace_comment)(t.target))return new c.WorkspaceCommentDragger({target:t.target,workspace:t.workspace});throw Error("Trying to drag invalid element")}),t.bind(pt.BINDING.WorkspaceDragger).toFunction(function(t){return(0,dt.is_workspace)(t)?new h.WorkspaceDragger(t):new a.FlyoutDragger(t)}),t.bind(pt.BINDING.Gesture).toFunction(function(t){return new l.Gesture(t)}),t.bind(pt.BINDING.Blink).to(d.Blink).inSingletonScope(),t.bind(pt.BINDING.block_animations).to(p.BlockAnimations).inSingletonScope(),t.bind(pt.BINDING.context_menu).to(u.ContextMenu).inSingletonScope(),t.bind(pt.BINDING.css).to(g.Css).inSingletonScope(),t.bind(pt.BINDING.dragged_connection_manager).to(v.DraggedConnectionManager).inSingletonScope(),t.bind(pt.BINDING.insertion_marker_manager).to(f.InsertionMarkerManager).inSingletonScope(),t.bind(pt.BINDING.events).to(b.Events).inSingletonScope(),t.bind(pt.BINDING.extensions).to(m.Extensions).inSingletonScope(),t.bind(pt.BINDING.json).to(y.Json).inSingletonScope(),t.bind(pt.BINDING.registry).to(k.Registry).inSingletonScope(),t.bind(pt.BINDING.runtime_data).to(w.RuntimeData).inSingletonScope(),t.bind(pt.BINDING.theme).to(E.Theme).inSingletonScope(),t.bind(pt.BINDING.tooltip).to(T.Tooltip).inSingletonScope(),t.bind(pt.BINDING.touch_manager).to(x.TouchManager).inSingletonScope(),t.bind(pt.BINDING.utils).to(I.Utils).inSingletonScope(),t.bind(pt.BINDING.widget_div).to(O.WidgetDiv).inSingletonScope(),t.bind(pt.BINDING.workspace_db).to(N.WorkspaceDB).inSingletonScope(),t.bind(pt.BINDING.xml).to(A.Xml).inSingletonScope(),t.bind(pt.BINDING.slider_controller).to(C.SliderController).inSingletonScope(),t.bind(pt.BINDING.angle_controller).to(S.AngleController).inSingletonScope(),t.bind(pt.BINDING.color_controller).to(D.ColorController).inSingletonScope(),t.bind(pt.BINDING.Toolbox).toFunction(function(t){return new R.Toolbox(t)}),t.bind(pt.BINDING.BlockDragSurfaceSvg).toFunction(function(t){return new B.BlockDragSurfaceSvg(t)}),t.bind(pt.BINDING.ConnectionDB).toFunction(function(){return new M.ConnectionDB}),t.bind(pt.BINDING.Grid).toFunction(function(t){return new P.Grid(t)}),t.bind(pt.BINDING.WorkspaceAudio).toFunction(function(t){return new G.WorkspaceAudio(t)}),t.bind(pt.BINDING.WorkspaceDragSurfaceSvg).toFunction(function(t,e){return new z.WorkspaceDragSurfaceSvg(t,e)}),t.bind(pt.BINDING.WorkspaceSvg).toFunction(function(t,e,o,i){return new U.WorkspaceSvg(t,e,o,i)}),t.bind(pt.BINDING.FieldButton).toFunction(function(t){return new F.FieldButton(t)}),t.bind(pt.BINDING.FieldColour).toFunction(function(t){return new H.FieldColour(t)}),t.bind(pt.BINDING.FieldDropdown).toFunction(function(t){return new W.FieldDropdown(t)}),t.bind(pt.BINDING.FieldIcon).toFunction(function(t){return new V.FieldIcon(t)}),t.bind(pt.BINDING.FieldImage).toFunction(function(t){return new X.FieldImage(t)}),t.bind(pt.BINDING.FieldLabel).toFunction(function(t){return new K.FieldLabel(t)}),t.bind(pt.BINDING.FieldLabelSerializable).toFunction(function(t){return new Y.FieldLabelSerializable(t)}),t.bind(pt.BINDING.FieldMultilineInput).toFunction(function(t){return new q.FieldMultilineInput(t)}),t.bind(pt.BINDING.MutationAddButton).toFunction(function(){return new Q.MutationAddButton}),t.bind(pt.BINDING.MutationRemoveButton).toFunction(function(t){return new Q.MutationRemoveButton(t)}),t.bind(pt.BINDING.FieldNumber).toFunction(function(t){return new J.FieldNumber(t)}),t.bind(pt.BINDING.FieldTextDropdown).toFunction(function(t){return new Z.FieldTextDropdown(t)}),t.bind(pt.BINDING.FieldTextInput).toFunction(function(t){return new $.FieldTextInput(t)}),t.bind(pt.BINDING.FieldDefaultValue).toFunction(function(t){return new tt.FieldDefaultValue(t)}),t.bind(pt.BINDING.Input).toFunction(function(t){return new et.Input(t)}),t.bind(pt.BINDING.RenderedConnection).toFunction(function(t){return new rt.RenderedConnection(t)}),t.bind(pt.BINDING.BlockSvg).toFunction(function(t){return new((0,ot.block_render_svg)(nt.BlockSvg))(t)}),t.bind(pt.BINDING.BlockGroup).toFunction(function(t){return new((0,ot.block_render_svg)(it.BlockGroup))(t)}),t.bind(pt.BINDING.SimplifiedCommentBubble).to(L.SimplifiedCommentBubble).inSingletonScope(),t.bind(pt.BINDING.WorkspaceComment).toFunction(function(t){return"simplified"===t.type?new _t.SimplifiedWorkspaceComment(t.workspace,t.parent_block,t.position,t.opt_id):new st.WorkspaceComment(t.workspace,t.parent_block,t.position,t.opt_id)}),t.bind(pt.BINDING.Options).toFunction(function(t){return new at.Options(t)}),t.bind(pt.BINDING.Scrollbar).toFunction(function(t,e,o,i,n){return new lt.Scrollbar(t,e,o,i,n)}),t.bind(pt.BINDING.ScrollbarPair).toFunction(function(t,e){return new lt.ScrollbarPair(t,e)}),t.bind(pt.BINDING.Msg).toConstantValue(ht.Msg),t.bind(pt.BINDING.css_content).toConstantValue(ct.BLINK_CSS_CONTENT)}},74954:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.SimplifiedWorkspaceComment=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(32791),a=o(15261),l=o(24042),c=o(99186),h=o(28688),d=o(58221),p=function(t){function e(e,o,i,n){var s=t.call(this,e)||this;s.element_type="comment",s.icon_size=32,s.h_distance=-6,s.icon_offset=4,s.icon_limit=3,s.text_="",s.width=s.icon_size,s.height=s.icon_size,s.left_top_offset=[-s.icon_size/2,-s.icon_size/2],s.bubble_width_=214,s.bubble_height_=126,s.auto_layout_=!0,s.relative_position_=r.vec2.create(),s.expanded_=!1,s.color_theme="BLUE",s.is_textarea_focused=!1,s.parent_block_=o,s.base_block=o;var _=s.workspace.is_resizes_enabled();return s.workspace.set_resizes_enabled(!1),s.events.disable(),s.id=null!=n?n:(0,c.gen_uid)(),s.svg_group.classList.add("blocklyWorkspaceComment"),s.update_movable(),o&&(s.deletable_=!1),i&&s.translate(r.vec2.fromValues(i.x,i.y)),e.workspace_comment_db.set(s.id,s),o||e.add_top_comment(s),s.init_events(),s.events.enable(),s.events.is_enabled()&&(s.parent_block_?s.events.fire(s.change_event_factory("comment",{block:s.parent_block_,old_value:void 0,new_value:s.id})):s.events.fire(s.create_event_factory({block:s}))),s.workspace.set_resizes_enabled(_),s}return(0,i.__extends)(e,t),e.prototype.get_icon=function(){return this.svg_icon},e.prototype.get_text=function(){return this.text_},e.prototype.set_text=function(t){var e;this.text_!=t&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_text",{block:this,old_value:this.text_,new_value:t})),this.text_=t),e&&this.events.fire(e),this.comment_bubble.update_bubble("edit",this)},e.prototype.init_svg=function(t){var e,o,i=this;if(this.parent_block_){var n=(0,h.get_outer_block)(this.parent_block_);this.base_block=n;var r=(0,h.get_nested_blocks_with_comment)(n),s=r[0];if(s!==this.parent_block_)return null!==(e=null==s?void 0:s.comment)&&void 0!==e&&e.init_svg(!0),void(this.svg_icon||(this.svg_icon=(0,a.create_svg_element)("g",{},this.svg_group),this.reposition()));r.forEach(function(t){var e;t!==i.parent_block_&&t.comment&&t.comment.rendered&&(t.comment.rendered=!1,null!==(e=i.workspace.get_canvas())&&void 0!==e&&e.removeChild(t.comment.svg_group))}),this.svg_icon&&this.svg_group.removeChild(this.svg_icon),this.svg_icon=(0,a.create_svg_element)("g",{},this.svg_group);for(var _=r.length>this.icon_limit?this.icon_limit-1:r.length-1,l=_;l>=0;l--){var c=r[l],d=(0,a.create_svg_element)("g",{class:"blocklySimplifiedCommentIcon"},this.svg_icon);this.draw_icon(d,c.get_colour().toString());var p=this.icon_offset*(_-l);d.setAttribute("transform","translate("+(this.left_top_offset[0]-p)+", "+this.left_top_offset[1]+")")}if(this.events.bind_event_with_checks(this.svg_icon,"mouseup",this,this.on_icon_click),this.reposition(),this.rendered=!0,null!==(o=this.workspace.get_canvas())&&void 0!==o&&o.appendChild(this.svg_group),this.update_visibility(),this.events.is_record_undo()&&this.events.is_enabled()&&!t&&1===this.svg_icon.childElementCount){var u=this.svg_icon.firstElementChild;u.style.opacity="0",setTimeout(this.comment_bubble.animate_once.bind(this,u,"createCommentAnimation",function(){u.style.opacity=""}))}}},e.prototype.draw_icon=function(t,e){e=e||"#608FEE",(0,a.create_svg_element)("rect",{width:this.icon_size,height:this.icon_size,fill:"none",stroke:"none"},t),(0,a.create_svg_element)("path",{d:"M10,4 L20,4 C24.418278,4 28,7.581722 28,12 L28,21 L28,21 L30.2365586,27.7096759 C30.4112064,28.2336192 30.1280464,28.7999392 29.6041031,28.974587 C29.3524967,29.0584558 29.0778786,29.0389393 28.8406617,28.9203309 L19,24 L19,24 L10,24 C5.581722,24 2,20.418278 2,16 L2,12 C2,7.581722 5.581722,4 10,4 Z",fill:e},t),(0,a.create_svg_element)("circle",{fill:"#fff",cx:8,cy:14,r:2},t),(0,a.create_svg_element)("circle",{fill:"#fff",cx:15,cy:14,r:2},t),(0,a.create_svg_element)("circle",{fill:"#fff",cx:22,cy:14,r:2},t),t.setAttribute("filter","url(#"+d.FILTER.SURROUND_SHADOW_DARK+")"),t.setAttribute("transform-origin",this.icon_size+" "+this.icon_size)},e.prototype.reposition=function(){var t=this.base_block||this.parent_block_;if(t&&t.rendered){var e=this.h_distance-this.icon_size/2;t.is_starting_block()&&(e-=22),this.relative_position_=r.vec2.fromValues(e,t.first_row_height/2);var o=t.get_relative_to_surface_xy();this.translate(r.vec2.add(o,o,this.relative_position_))}},e.prototype.show_editor=function(){return(0,i.__awaiter)(this,void 0,void 0,function(){var t;return(0,i.__generator)(this,function(e){switch(e.label){case 0:return[4,this.workspace.show_external_comment_editor(this.text_)];case 1:return null!=(t=e.sent())&&this.set_text(t),[2]}})})},e.prototype.focus=function(){this.show_editor()},e.prototype.on_icon_click=function(t){this.workspace.is_dragging()||this.utils.is_right_button(t)||this.comment_bubble.popup(this)},e.prototype.get_bounding_rectangle=function(){var e=t.prototype.get_bounding_rectangle.call(this),o=e.topLeft,i=e.bottomRight;return{topLeft:r.vec2.add(r.vec2.create(),o,this.left_top_offset),bottomRight:r.vec2.add(r.vec2.create(),i,this.left_top_offset)}},e.prototype.get_parent_block=function(){return this.parent_block_},e.prototype.get_top_parent=function(){return this.get_root_block()||this},e.prototype.get_root_block=function(){for(var t=this.parent_block_;null==t?void 0:t.parent_block;)t=t.parent_block;return t},e.prototype.dispose=function(){var e,o=this;this.comment_bubble.update_bubble("remove",this),this.events.is_enabled()&&(e=this.parent_block_?this.change_event_factory("comment",{block:this.parent_block_,old_value:this.xml.comment_to_dom_with_xy(this),new_value:void 0}):this.delete_event_factory({block:this})),this.workspace.workspace_comment_db.delete(this.id),this.parent_block_||this.workspace.remove_top_comment(this),t.prototype.dispose.call(this),this.events.fire(e),setTimeout(function(){if(o.parent_block_){var t=(0,h.get_outer_block)(o.parent_block_),e=(0,h.get_nested_blocks_with_comment)(t)[0];e&&e.comment&&e.rendered&&e.comment.init_svg(!0)}})},e.prototype.show_context_menu=function(t){},e.prototype.on_mouse_down=function(e){this.parent_block_||t.prototype.on_mouse_down.call(this,e)},e.prototype.sort=function(t){if(this.rendered){var e=this.get_relative_to_surface_xy(),o=r.vec2.fromValues(t[0]+this.icon_size/2,t[1]+this.icon_size/2);this.move_by(r.vec2.sub(e,o,e)),r.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])}},e.prototype.get_bubble_size=function(){return{width:this.bubble_width_,height:this.bubble_height_}},e.prototype.set_bubble_size=function(t,e){this.bubble_width_=t,this.bubble_height_=e},e.prototype.is_auto_layout=function(){return this.auto_layout_},e.prototype.set_auto_layout=function(t){this.auto_layout_=t},e.prototype.get_relative_position=function(){return this.parent_block_?this.relative_position_:this.location_},e.prototype.set_relative_position=function(t){this.relative_position_=t},e.prototype.set_expanded=function(t){this.expanded_=t},e.prototype.is_expanded=function(){return this.expanded_},e.prototype.update_visibility=function(){if(this.parent_block_){var t=this.parent_block_;(0,l.is_block_svg)(t)&&(t=t.get_root_block());var e=t.get_visibility();(0,a.update_visibility_class)(this.svg_group,e)}},e.prototype.get_color_theme=function(){return this.color_theme},e.prototype.set_color_theme=function(t){t!==this.color_theme&&(this.color_theme=t)},e.prototype.get_colour=function(){return _.THEME_COLOR_MAP[this.color_theme]},e.prototype.draw_line=function(){},e.prototype.cancel_operation=function(){},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.SimplifiedCommentBubble)],e.prototype,"comment_bubble",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(47187).WorkspaceElement);e.SimplifiedWorkspaceComment=p},76525:t=>{t.exports=JSON.parse('{"name":"@crc/blink","version":"0.28.16","description":"Blink for Codemao","publishConfig":{"@crc:registry":"https://gitlab.codemao.cn/api/v4/projects/1/packages/npm/"},"main":"dist/index.js","types":"dist/index.d.ts","scripts":{"test":"npm run build && jest","test_debug":"node --inspect-brk node_modules/.bin/jest --runInBand","lint":"eslint \'**/*.ts\'","build":"gulp -f ./scripts/gulp/ && tsc","watch":"concurrently \\"gulp -f ./scripts/gulp/watch.js\\" \\"tsc --watch\\"","changelog":"standard-version --skip.commit --skip.tag","changelog:publish":"node ./scripts/changelog_publish.js","docs_api":"typedoc --module commonjs --out ./docs_api ./src/index.ts","dev_tools":"parcel ./dev_tools/index.html -d ./dev_tools/dist --open","prepare":"husky install"},"repository":{"type":"git","url":"ssh://git@gitlab.codemao.cn:crc/creation/platform/blink.git"},"author":"Codemao","license":"UNLICENSED","devDependencies":{"@commitlint/cli":"^14.1.0","@commitlint/config-conventional":"^14.1.0","@types/jest":"^27.0.2","@types/socket.io":"2.1.4","@types/w3c-xmlserializer":"^2.0.2","@typescript-eslint/eslint-plugin":"^5.3.1","@typescript-eslint/parser":"^5.3.1","ace-builds":"^1.4.13","concurrently":"^6.3.0","eslint":"^8.2.0","eslint-plugin-import":"^2.25.3","gulp":"^4.0.2","gulp-autoprefixer":"^8.0.0","gulp-clean-css":"^4.3.0","gulp-less":"^5.0.0","gulp-rename":"^2.0.0","husky":"^7.0.4","jest":"^27.3.1","lint-staged":"^11.2.6","ot-json1":"^1.0.2","parcel":"^1.12.3","rimraf":"^3.0.2","serve-handler":"^6.1.3","socket.io-client":"2.3.0","standard-version":"^9.3.2","typedoc":"^0.15.3","typescript":"^4.4.4","w3c-xmlserializer":"^3.0.0"},"dependencies":{"@kitten-team/gl-matrix":"^2.8.5","@types/animejs":"^3.1.0","@types/hammerjs":"^2.0.35","@types/socket.io-client":"1.4.32","animejs":"^3.1.0","hammerjs":"^2.0.8","inversify":"^5.0.1","inversify-inject-decorators":"^3.0.2","lodash.clonedeep":"^4.5.0","reflect-metadata":"^0.1.13","resize-observer-polyfill":"1.5.1","tslib":"2.3.1"},"peerDependencies":{"ot-json1":"^1.0.1","socket.io-client":"2.3.0"},"_resolved":"https://gitlab.codemao.cn/api/v4/projects/1/packages/npm/@crc/blink/-/@crc/blink-0.28.16.tgz","_integrity":"sha1-dkzbfSh8wak98iumnZ0O/8KRP6g=","_from":"@crc/blink@0.28.16"}')},76608:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDragSurfaceSvg=void 0;var i=o(31635),n=o(71519),r=o(53307),s=o(15261),_=o(14289),a=function(){function t(t,e){this.previous_sibling_=void 0,this.container_=t,this.SVG_=(0,s.create_svg_element)("svg",{xmlns:_.SVG_NS,"xmlns:html":_.HTML_NS,"xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",class:"blocklyWsDragSurface"}),e?(0,s.insert_after)(this.SVG_,e):this.container_.appendChild(this.SVG_)}return t.prototype.get_svg=function(){return this.SVG_},t.prototype.translate_surface=function(t,e){t=Number(t.toFixed(0)),e=Number(e.toFixed(0)),this.SVG_.style.display="block",(0,s.set_css_transform)(this.SVG_,"translate3d("+t+"px, "+e+"px, 0px)")},t.prototype.set_contents_and_show=function(t,e,o,i){if(!this.SVG_)throw new Error("No Svg Element");0!==this.SVG_.childNodes.length&&console.error("Already dragging a block."),this.previous_sibling_=o,this.SVG_.style.display="none";var n=document.createDocumentFragment();n.appendChild(t),e&&n.appendChild(e),n.firstElementChild&&n.firstElementChild.setAttribute("transform","translate(0, 0) scale("+i+")"),n.lastElementChild&&n.lastElementChild.setAttribute("transform","translate(0, 0) scale("+i+")"),this.SVG_.appendChild(n),this.SVG_.style.display="block"},t.prototype.get_surface_translation=function(){return this.utils.get_relative_xy(this.SVG_)},t.prototype.clear_and_hide=function(t){if(!this.SVG_)throw new Error("No Svg_");var e=this.SVG_.childNodes[0],o=this.SVG_.childNodes[1];if(!(e&&o&&(0,s.has_class)(e,"blocklyBlockCanvas")&&(0,s.has_class)(o,"blocklyBubbleCanvas")))throw new Error("Couldn't clear and hide the drag surface.  A node was missing.");null!=this.previous_sibling_?(0,s.insert_after)(e,this.previous_sibling_):t.insertBefore(e,t.firstChild),(0,s.insert_after)(o,e),this.SVG_.style.display="none",0!=this.SVG_.childNodes.length&&console.error("Drag surface was not cleared."),(0,s.set_css_transform)(this.SVG_,""),this.previous_sibling_=void 0},(0,i.__decorate)([(0,r.lazy_inject)(r.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.WorkspaceDragSurfaceSvg=a},76963:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ShadowBlockRenderer=void 0;var i=o(31635),n=o(32791),r=o(24042),s=function(t){function e(e){var o=t.call(this,e)||this;if("param"===e.element_type||"param_color"===e.element_type)return o;switch(o.padding_l=o.theme.renderer.ROW_PADDING_SHADOW,o.padding_r=o.theme.renderer.ROW_PADDING_SHADOW,o.min_height=o.theme.renderer.MIN_HEIGHT_SHADOW,e.get_output_shape()){case n.OutputShape.HEXAGONAL:o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW_HEXAGONAL;break;case n.OutputShape.ROUND:o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW_ROUND;break;default:o.edge_width=o.theme.renderer.BLOCK_EDGE_WIDTH_SHADOW}return 1!==e.inputList.length||1!==e.inputList[0].fieldRow.length||(0,r.is_field_number)(e.inputList[0].fieldRow[0])||(0,r.is_field_text_input)(e.inputList[0].fieldRow[0])||(0,r.is_field_default_value)(e.inputList[0].fieldRow[0])||(o.padding_l=o.theme.renderer.ROW_PADDING_OUTPUT_NON_TEXT,o.padding_r=o.theme.renderer.ROW_PADDING_OUTPUT_NON_TEXT),o}return(0,i.__extends)(e,t),e.prototype.min_width=function(e){return"param"===e.element_type||"param_color"===e.element_type?t.prototype.min_width.call(this,e):e.get_output_shape()===n.OutputShape.HEXAGONAL?this.theme.renderer.MIN_WIDTH_SHADOW_HEXAGONAL-(this.theme.renderer.CORNER_OFFSET_X+this.theme.renderer.CORNER_OFFSET_X+.54):this.theme.renderer.MIN_WIDTH_SHADOW},e.prototype.get_field_padding_y=function(){return this.theme.renderer.SHADOW_ROW_PADDING_Y_TO_FIELD},e.prototype.get_block_padding_y=function(){return 0},e}(o(39060).OutputBlockRenderer);e.ShadowBlockRenderer=s},77740:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RenderedConnection=void 0;var i=o(31635),n=o(71519),r=(0,i.__importDefault)(o(22776)),s=o(77276),_=o(53307),a=o(32791),l=o(24042),c=o(15261),h=o(14289),d=function(){function t(t){var e=this;this.x_=0,this.y_=0,this.hidden_=!1,this.in_db=!1,this.shadow_dom=void 0,this.can_connect_to_previous=function(t){if(e.target_connection)return!1;if(-1!=e.runtime_data.dragging_connections.indexOf(t))return!1;var o=e.source_block.get_first_statement_connection(),i=null!=o,n=e==o,r=e==e.source_block.next_connection;if(i&&!n&&!r)return!1;var s=null!=e.source_block.previous_connection;if(n&&s)return!0;if(r||n&&!s){if(!t.target_connection)return!0;var _=t.targetBlock();return!!_&&!!_.is_insertion_marker()&&!_.get_previous_block()}return!1},this.source_block=t.source,this.type=t.type,this.context=t.context;var o=t.source.get_workspace();o&&o.connectionDBList&&(this.db_=o.connectionDBList[t.type],this.db_opposite=o.connectionDBList[a.OPPOSITE_TYPE[t.type]],this.hidden_=!this.db_),this.offset_in_block=s.vec2.create()}var e;return e=t,t.connect_reciprocally=function(t,e){t&&e||console.error("Cannot connect undefined connections."),t.target_connection=e,e.target_connection=t},t.prototype.get_targe_connection=function(){return this.target_connection},t.prototype.move_to=function(t){var e,o;this.in_db&&null!==(e=this.db_)&&void 0!==e&&e.remove_connection(this),this.x_=t[0],this.y_=t[1],this.hidden_||null===(o=this.db_)||void 0===o||o.add_connection(this)},t.prototype.move_by=function(t){this.move_to(s.vec2.fromValues(t[0]+this.x_,t[1]+this.y_))},t.prototype.highlight=function(){var t,e=null===(t=this.workspace_db.current)||void 0===t?void 0:t.get_options().connection_effect,o=e?e.color:"#fff";this.type==a.CONNECTION_TYPE.INPUT_VALUE||this.type===a.CONNECTION_TYPE.OUTPUT_VALUE?this.highlight_input(o):this.type===a.CONNECTION_TYPE.NEXT_STATEMENT?this.highlight_statement(o,!0):this.type===a.CONNECTION_TYPE.PREVIOUS_STATEMENT&&this.highlight_statement(o,!1)},t.prototype.highlight_input=function(t){var o=this.source_block.get_relative_to_surface_xy(),i=this.x_-o[0],n=this.y_-o[1],r="";if(this.target_connection){var s=this.target_connection.source_block.svg_path,_=void 0;null!=s&&(_=s.getAttribute("d")),"string"==typeof _&&(r=_)}e.highlighted_path=(0,c.create_svg_element)("path",{filter:"url(#blur-1px)",class:"blocklyHighlightedConnectionCover",transform:"translate("+i+", "+n+")",fill:t,d:r},this.source_block.get_svg_root())},t.prototype.highlight_statement=function(t,o){var i=this.source_block,n=this.offset_in_block[0],s=o?this.offset_in_block[1]-1:-3;e.highlighted_path=(0,c.create_svg_element)("g",{class:"g_blockly_next_statement_underline",transform:"translate(0, "+s+")"},this.source_block.get_svg_root()),(0,c.create_svg_element)("circle",{r:"4",cx:n,cy:"2",fill:t},e.highlighted_path),(0,c.create_svg_element)("circle",{r:"8",cx:n,cy:"2",fill:t,"fill-opacity":"0.3",filter:"url(#blur-1px)"},e.highlighted_path);var _=(0,c.create_svg_element)("rect",{x:n,y:"0",rx:"2",width:"0",height:"3",fill:t},e.highlighted_path),a=this.get_path_top_length(i)-n||i.width-i.block_renderer.padding_r-n;this.offset_in_block[1]>=80&&(a=75),"controls_if"===this.source_block.type&&(this.offset_in_block[1]>=100&&(a=55),this.offset_in_block[1]>=140&&(a=75)),(0,r.default)({targets:_,width:{value:a,duration:200,easing:"easeOutQuad"}})},t.prototype.get_path_top_length=function(t){var e=t.get_svg_root().querySelector("path");if(e){var o=e.getAttribute("d").match(/H\s.*?\s/gi);if(null==o)return 0;var i=o.map(function(t){return t.match(/\d+(.\d+)?/g)});return Math.max.apply(Math,i)}return 0},t.prototype.unhighlight=function(){e.highlighted_path&&((0,c.remove_node)(e.highlighted_path),delete e.highlighted_path)},t.prototype.set_offset_in_block=function(t,e){this.offset_in_block[0]=t,this.offset_in_block[1]=e},t.prototype.move_to_offset=function(t){this.move_to(s.vec2.fromValues(t[0]+this.offset_in_block[0],t[1]+this.offset_in_block[1]))},t.prototype.tighten=function(){if(null==this.target_connection)throw new ReferenceError("Target connection not found.");var t=this.target_connection.get_xy();if(s.vec2.sub(t,t,[this.x_,this.y_]),0!==t[0]||0!==t[1]){var e=this.targetBlock(),o=e.get_svg_root(),i=this.utils.get_relative_xy(o);s.vec2.sub(i,i,t),o.setAttribute("transform","translate("+i[0]+", "+i[1]+")"),e.move_connections(s.vec2.negate(t,t))}},t.prototype.targetBlock=function(){if(this.is_connected()&&null!=this.target_connection)return this.target_connection.get_source_block()},t.prototype.closest=function(t,e){return this.db_opposite?this.db_opposite.search_for_closest(this,t,e):{connection:void 0,radius:t}},t.prototype.connect_to_inferior=function(t){(function(t){var o,i,n=this,r=this,s=r.get_source_block(),_=t.get_source_block(),l=!1;if(r==s.get_first_statement_connection()&&(l=!0),t.is_connected()&&(l&&(o=t.target_connection),t.disconnect()),r.is_connected()){var c=r.targetBlock(),h=r.get_shadow_dom();if(r.set_shadow_dom(void 0),c&&c.is_shadow())this.events.disable(),h=_.is_shadow()?this.xml.block_to_dom(_):this.xml.block_to_dom(c),c.dispose(),c=void 0,this.events.enable();else if(r.type==a.CONNECTION_TYPE.NEXT_STATEMENT){if(c&&!c.previous_connection)throw new Error("Orphan block does not have a previous connection.");for(var d=_;d.next_connection;){var p=d.get_next_block();if(!p||p.is_shadow()){c&&c.previous_connection&&c.previous_connection.check_type(d.next_connection)&&(d.next_connection.connect(c.previous_connection),c=void 0);break}d=p}}if(c&&(r.disconnect(),this.events.is_record_undo())){var u=this.events.get_group();window.setTimeout(function(){n.events.get_group()&&n.events.get_group()!==u?console.error("current group "+n.events.get_group()+", blocking scheduled bump"):c&&c.get_workspace()&&!c.get_parent()&&(n.events.set_group(u),c.output_connection?c.output_connection.bump_away_from(r):c.previous_connection&&c.previous_connection.bump_away_from(r),n.events.set_group(!1))},this.theme.blink_params.BUMP_DELAY)}h&&r.set_shadow_dom(h)}l&&o&&s.previous_connection&&o.connect(s.previous_connection),_.visibility_for_undo=_.get_visibility(),this.events.is_enabled()&&(i=this.move_event_factory({block:_})),e.connect_reciprocally(r,t),_.set_parent(s),i&&(i.record_new(),this.events.fire(i))}).call(this,t);var o=this.get_source_block(),i=t.get_source_block();o.rendered&&(o.update_disabled(),o.update_collapsed()),i.rendered&&i.update_disabled(),o.rendered&&i.rendered&&(this.type==a.CONNECTION_TYPE.NEXT_STATEMENT||this.type==a.CONNECTION_TYPE.PREVIOUS_STATEMENT?i.render():o.render())},t.prototype.disconnect_internal=function(t,e){var o;this.events.is_enabled()&&(o=this.move_event_factory({block:e}));var i=this.target_connection;i&&(i.target_connection=void 0,this.target_connection=void 0,e.set_parent(void 0),o&&(o.record_new(),this.events.fire(o)),e.visibility_for_undo&&this.events.is_undoing()&&(e.set_chunk_visibility(e.visibility_for_undo),e.update_chunk_visibility(),e.visibility_for_undo=void 0),t.is_rendered()&&t.render(),e.is_rendered()&&(e.update_disabled(),e.render()))},t.prototype.respawn_shadow=function(){var t,e=this.get_source_block(),o=this.get_shadow_dom();if(e.get_workspace()&&!this.is_connected()&&o){this.events.disable();var i="color_picker"===o.getAttribute("type")?this.xml.dom_to_block(o,e.get_workspace()):this.xml.dom_to_block_headless(o,e.get_workspace());if(o.setAttribute("id",i.id),this.set_shadow_dom(o),i.output_connection)this.connect(i.output_connection);else{if(!i.previous_connection)throw new Error("Child block does not have output or previous statement.");this.connect(i.previous_connection)}this.xml.parse_fields(o,i),e.rendered&&(i.init_svg(),i.render()),this.type===a.CONNECTION_TYPE.INPUT_VALUE&&this.source_block.is_collapsed()&&(null!==(t=this.target_connection)&&void 0!==t&&t.hide_all(),i.set_visible_as_child(!1)),this.events.enable()}},t.prototype.neighbours_=function(t){var e;return(null===(e=this.db_opposite)||void 0===e?void 0:e.get_neighbours(this,t))||[]},t.prototype.bump_away_from=function(t){if(this.source_block.is_stack_connectable()&&t.get_source_block().is_stack_connectable()){var e=this.source_block.get_workspace();if(!e||!e.is_dragging()){var o=this.source_block.get_root_block();if(!o.is_in_flyout){var i=!1;if(!o.is_movable()){if(!(o=t.get_source_block().get_root_block()).is_movable())return;t=this,i=!0}var n=this.runtime_data.selected==o;n||o.add_select();var r=t.x_+this.theme.blink_params.SNAP_RADIUS-this.x_,_=t.y_+this.theme.blink_params.SNAP_RADIUS-this.y_;i&&(_=-_),o.RTL&&(r=-r),o.move_by(s.vec2.fromValues(r,_)),n||o.remove_select()}}}},t.prototype.unhide_all=function(){this.set_hidden(!1);var t=[];if(this.type!=a.CONNECTION_TYPE.INPUT_VALUE&&this.type!=a.CONNECTION_TYPE.NEXT_STATEMENT)return t;var e=this.targetBlock();if(e){var o=void 0;e.is_collapsed()?(o=[],e.output_connection&&o.push(e.output_connection),e.next_connection&&o.push(e.next_connection),e.previous_connection&&o.push(e.previous_connection)):o=e.get_connections(!0);for(var i=0;i<o.length;i++)t.push.apply(t,o[i].unhide_all());t.length||(t[0]=e)}return t},t.prototype.hide_all=function(){var t;if(this.set_hidden(!0),this.target_connection){var e=this.targetBlock();if(null==e)throw new Error("target_block should not be undefined");for(var o=e.get_descendants(),i=0;i<o.length;i++){for(var n=o[i],r=n.get_connections(!0),s=0;s<r.length;s++)r[s].set_hidden(!0);null!==(t=n.warning)&&void 0!==t&&t.set_expanded(!1)}}},t.prototype.is_connection_allowed=function(t,e){return!!t.source_block.is_stack_connectable()&&!(this.distance_from(t)>e)&&function(t){if(t.get_source_block().is_insertion_marker())return!1;if(!t.get_source_block().is_rendered())return!1;if(h.NEED_COLLAPSE_CHILDREN_BLOCKS.includes(t.get_source_block().type)&&t.get_source_block().is_collapsed())return!1;if(t.get_source_block().get_collapsed_surround_parent())return!1;if("procedures_2_defnoreturn"==t.source_block.type&&t.target_connection&&"procedures_2_stable_parameter"==t.target_connection.source_block.type)return!1;if(t.target_connection&&t.target_connection.source_block.is_shadow()&&"param"===t.target_connection.source_block.element_type)return!1;if(this.can_connect_with_reason(t)!=a.CONNECTABLE_TYPE.CAN_CONNECT)return!1;switch(t.type){case a.CONNECTION_TYPE.PREVIOUS_STATEMENT:return this.can_connect_to_previous(t);case a.CONNECTION_TYPE.OUTPUT_VALUE:return!1;case a.CONNECTION_TYPE.INPUT_VALUE:if((e=t.targetBlock())&&t.target_connection&&!e.is_movable()&&!e.is_shadow())return!1;break;case a.CONNECTION_TYPE.NEXT_STATEMENT:var e;if((e=t.targetBlock())&&t.is_connected_to_non_insertion_marker()&&!this.source_block.next_connection&&!e.is_shadow()&&e.next_connection)return!1;break;default:throw new Error("Unknown connection type in is_connection_allowed")}return-1==this.runtime_data.dragging_connections.indexOf(t)}.call(this,t)},t.prototype.distance_from=function(t){var e=this.x_-t.x_,o=this.y_-t.y_;return Math.sqrt(e*e+o*o)},t.prototype.get_shadow_dom=function(){if(this.shadow_dom)return"string"==typeof this.shadow_dom&&(this.shadow_dom=this.utils.string_to_dom(this.shadow_dom)),this.shadow_dom},t.prototype.get_shadow_string=function(){return this.shadow_dom&&"string"!=typeof this.shadow_dom?this.xml.dom_to_text(this.shadow_dom):this.shadow_dom},t.prototype.set_shadow_dom=function(t){this.shadow_dom=t},t.prototype.set_shadow_from_string=function(t){this.shadow_dom=t},t.prototype.connect=function(t,e){if(void 0===e&&(e=!1),this.target_connection==t)return!1;var o=!0;try{this.check_connection(t)}catch(t){e||console.error(t),o=!1}if(!o)return!1;var i=this.is_superior()?this:t,n=this.is_superior()?t:this;return i.connect_to_inferior(n),n.source_block.update_layer_colour(),!0},t.prototype.on_check_changed=function(){if(this.is_connected()&&this.target_connection&&!this.check_type(this.target_connection)){var t=this.is_superior()?this.targetBlock():this.source_block;if(null==t)throw new ReferenceError("Connection source block not found.");t.unplug(),this.source_block.bump_neighbours()}},t.prototype.get_output_shape=function(){return this.check_&&1==this.check_.length&&"Boolean"==this.check_[0]?a.OutputShape.HEXAGONAL:a.OutputShape.ROUND},t.prototype.get_xy=function(){return s.vec2.fromValues(this.x_,this.y_)},t.prototype.set_hidden=function(t){this.hidden_=t,this.db_&&(t&&this.in_db?this.db_.remove_connection(this):t||this.in_db||this.db_.add_connection(this))},t.prototype.get_source_block=function(){return this.source_block},t.prototype.dispose=function(){if(this.is_connected())throw new Error("Disconnect connection before disposing of it.");this.in_db&&this.db_&&this.db_.remove_connection(this),delete this.db_,delete this.db_opposite},t.prototype.is_connected_to_non_insertion_marker=function(){var t=this.targetBlock();return!!t&&!t.is_insertion_marker()},t.prototype.disconnect=function(){var t,e,o,i=this.target_connection;i&&(i.target_connection!==this&&console.error("Target connection not connected to source connection."),this.is_superior()?(t=this.source_block,e=i.get_source_block(),o=this):(t=i.get_source_block(),e=this.source_block,o=i),this.disconnect_internal(t,e),o.respawn_shadow(),e.update_layer_colour())},t.prototype.set_check=function(t){return t?(this.check_=(0,l.is_array)(t)?t:[t],this.on_check_changed()):this.check_=void 0,this},t.prototype.is_connected=function(){return!!this.target_connection},t.prototype.check_type=function(t){if(!this.check_||!t.check_)return!0;for(var e=0;e<this.check_.length;e++)if(-1!=t.check_.indexOf(this.check_[e]))return!0;return!1},t.prototype.check_connection=function(t){switch(this.can_connect_with_reason(t)){case a.CONNECTABLE_TYPE.CAN_CONNECT:break;case a.CONNECTABLE_TYPE.REASON_SELF_CONNECTION:throw new Error("Attempted to connect a block to itself.");case a.CONNECTABLE_TYPE.REASON_DIFFERENT_WORKSPACES:throw new Error("Blocks not on same workspace.");case a.CONNECTABLE_TYPE.REASON_WRONG_TYPE:throw new Error("Attempt to connect incompatible types.");case a.CONNECTABLE_TYPE.REASON_TARGET_NULL:throw new Error("Target connection is undefined.");case a.CONNECTABLE_TYPE.REASON_CHECKS_FAILED:throw"Connection checks failed. "+this+" expected "+this.check_+", found "+t.check_;case a.CONNECTABLE_TYPE.REASON_SHADOW_PARENT:throw new Error("Connecting non-shadow to shadow block.");default:throw new Error("Unknown connection failure: this should never happen!")}},t.prototype.can_connect_with_reason=function(t){return t?(this.is_superior()?(e=this.source_block,o=t.get_source_block()):(o=this.source_block,e=t.get_source_block()),e&&e===o?a.CONNECTABLE_TYPE.REASON_SELF_CONNECTION:t.type!==a.OPPOSITE_TYPE[this.type]?a.CONNECTABLE_TYPE.REASON_WRONG_TYPE:e&&o&&e.get_workspace()!==o.get_workspace()?a.CONNECTABLE_TYPE.REASON_DIFFERENT_WORKSPACES:this.check_type(t)?e.is_shadow()&&!o.is_shadow()&&"param_color"!==e.element_type?a.CONNECTABLE_TYPE.REASON_SHADOW_PARENT:a.CONNECTABLE_TYPE.CAN_CONNECT:a.CONNECTABLE_TYPE.REASON_CHECKS_FAILED):a.CONNECTABLE_TYPE.REASON_TARGET_NULL;var e,o},t.prototype.is_superior=function(){return this.type==a.CONNECTION_TYPE.INPUT_VALUE||this.type==a.CONNECTION_TYPE.NEXT_STATEMENT},t.prototype.remove_shadow=function(){if(this.is_superior()){this.set_shadow_dom(void 0);var t=this.targetBlock();t&&t.is_shadow()&&(this.events.disable(),this.disconnect_internal(this.source_block,t),t.dispose(),this.events.enable())}},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.xml)],t.prototype,"xml",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.theme)],t.prototype,"theme",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.MoveEvent)],t.prototype,"move_event_factory",void 0),e=(0,i.__decorate)([(0,n.injectable)()],t)}();e.RenderedConnection=d},77938:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ContextMenuOptionEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=function(t){function e(e){var o=t.call(this)||this;return o.type=r.BlockEventType.CONTEXT_MENU_OPTION,o._record_undo=!1,o._workspace_id=e.workspace_id,o._option_name=e.option_name,o._source=e.source,o}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,n.injectable)()],e)}(o(31113).BaseEvent);e.ContextMenuOptionEvent=s},78525:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FieldLabelSerializable=void 0;var i=o(31635),n=o(71519),r=function(t){function e(e){var o=t.call(this,e)||this;return o.editable=!0,o.field_type="FieldLabelSerializable",o}return(0,i.__extends)(e,t),e.prototype.get_display_text=function(){var t=this.text_;return t.length>this.max_display_length&&(t=t.substring(0,this.max_display_length-2)+"…"),t.replace(/\s/g," ")},(0,i.__decorate)([(0,n.injectable)()],e)}(o(84124).FieldLabel);e.FieldLabelSerializable=r},79358:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Grid=void 0;var i=o(31635),n=o(71519),r=o(15261),s=o(82390),_=function(){function t(t){this.scale=1;var e=t.svg_defs,o=t.svg_rnd,i=t.gridOptions;this.spacing=i.spacing,this.step=i.step,this.snap_to_grid=i.snap,this.grid_pattern=(0,r.create_svg_element)("pattern",{id:"blocklyGridPattern"+o,patternUnits:"userSpaceOnUse",fill:"transparent"},e),this.bg_rect=(0,r.create_svg_element)("rect",{class:"blinkGridPatternBg",fill:"transparent"},this.grid_pattern),this.outer_rect=(0,r.create_svg_element)("path",{class:"blinkGridPatternOuter",stroke:"rgb(136, 136, 136)"},this.grid_pattern),this.inner_lines=(0,r.create_svg_element)("path",{class:"blinkGridPatternInner",stroke:"rgb(136, 136, 136)"},this.grid_pattern),this.update()}return t.prototype.should_snap=function(){return this.snap_to_grid},t.prototype.move_to=function(t,e){this.grid_pattern.setAttribute("x",String(t)),this.grid_pattern.setAttribute("y",String(e)),(s.is.ie()||s.is.edge())&&this.set_scale(this.scale)},t.prototype.get_spacing=function(){return this.spacing},t.prototype.get_pattern_id=function(){return this.grid_pattern.id},t.prototype.dispose=function(){(0,r.remove_node)(this.grid_pattern)},t.prototype.update=function(){var t=this.spacing*this.scale||10,e=t*this.step;this.grid_pattern.setAttribute("width",e.toString()),this.grid_pattern.setAttribute("height",e.toString()),this.bg_rect.setAttribute("width",e.toString()),this.bg_rect.setAttribute("height",e.toString()),this.outer_rect.setAttribute("d","M "+e+" 0 L 0 0 0 "+e);for(var o=[],i=[],n=1;n<this.step;n++)o.push("M 0 "+n*t+" L "+e+" "+n*t),i.push("M "+n*t+" 0 L "+n*t+" "+e);this.inner_lines.setAttribute("d",o.join(" ")+i.join(" "))},t.prototype.set_scale=function(t){this.scale=t,this.update()},t.prototype.set_color=function(t,e){this.bg_rect.setAttribute("fill",t),this.outer_rect.setAttribute("stroke",e),this.inner_lines.setAttribute("stroke",e)},(0,i.__decorate)([(0,n.injectable)()],t)}();e.Grid=_},79656:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.zh_hans=void 0,e.zh_hans={DUPLICATE_BLOCK:"复制",COPY_ALL:"复制所有积木（ %1 块）",ADD_COMMENT:"添加注释",REMOVE_COMMENT:"删除注释",DELETE_BLOCK:"删除积木块",DELETE_X_BLOCKS:"删除所有积木（ %1 块）",DELETE_ALL_BLOCKS:"删除所有 %1 块吗?",CLEAN_UP:"整理积木",COLLAPSE_BLOCK:"折叠积木块",COLLAPSE_ALL:"折叠所有积木",EXPAND_BLOCK:"展开积木块",EXPAND_ALL:"展开所有积木",UNDO:"撤销",REDO:"重做",PASTE:"粘贴",COPY_AND_PASTE:"复制并粘贴",GLOBAL_COMMENT:"添加全局注释",COMMENT:"注释",BLUE_COMMENT:"蓝色注释",GREEN_COMMENT:"绿色注释",YELLOW_COMMENT:"黄色注释",RED_COMMENT:"红色注释",DELETE_COMMENT:"删除注释",WHATS_THIS:"这是什么功能…",SAY_SOMETHING:"说些什么…",START_ON_CLICK:"%1 当 开始 被点击",START_ON_CLICK_2:"%1 当 开始 被点击 %2 %3",ON_RUNNING_GROUP_ACTIVATED:"%1 当 切换到 当前屏幕",SELF_LISTEN:"%1 当 收到 广播 %2 %3 %4",SELF_BROADCAST:"发送广播 %1",SELF_BROADCAST_AND_WAIT:"发送广播 %1 并等待",WHEN:"%1 当 %2 %3",TERMINATE:"停止",REPEAT_FOREVER:"重复执行 %1 %2",REPEAT_N_TIMES:"重复执行 %1 次 %2 %3",REPEAT_FOREVER_UNTIL:"重复执行直到 %1 %2 %3",BREAK:"退出循环",WARP:"一步执行 %1 %2",WAIT_SECS:"等待 %1 秒",WAIT_UNTIL:"保持等待直到 %1",DESTRUCT:"销毁自身",CONTROLS_IF_MSG_IF:"如果",CONTROLS_IF_MSG_ELSEIF:"否则如果",CONTROLS_IF_MSG_ELSE:"否则",CONTROLS_IF_TOOLTIP_1:"如果值为真，执行一些语句。",CONTROLS_IF_TOOLTIP_2:"如果值为真，则执行第一块语句。否则，则执行第二块语句。",CONTROLS_IF_TOOLTIP_3:"如果第一个值为真，则执行第一块的语句。否则，如果第二个值为真，则执行第二块的语句。",CONTROLS_IF_TOOLTIP_4:"如果第一个值为真，则执行第一块对语句。否则，如果第二个值为真，则执行语句的第二块。如果没有值为真，则执行最后一块的语句。",TELL:"告诉 %1 执行 %2 %3",SYNC_TELL:"告诉 %1 执行并等待 %2 %3",GET_TIME:"当前 %1",YEAR:"年",MONTH:"月",DATE:"日",WEEK:"星期",WEEK0:"星期日",WEEK1:"星期一",WEEK2:"星期二",WEEK3:"星期三",WEEK4:"星期四",WEEK5:"星期五",WEEK6:"星期六",HOUR:"小时",MINUTE:"分钟",SECOND:"秒",TIMER:"计时器",RESET_TIMER:"重置 计时器",MATH_NUMBER_TOOLTIP:"一个数字。",RANDOM_NUM:"在 %1 到 %2 间随机整数",DIVISIBLE_BY:"%1 能被 %2 整除",CALCULATE:"数学运算 %1",CALCULATE_TOOLTIPS:"直接输入数学式子进行运算",MATH_ARITHMETIC:"%1 %2 %3",MATH_ARITHMETIC_TOOLTIP_ADD:"返回两个数值的和。",MATH_ARITHMETIC_TOOLTIP_MINUS:"返回两个数值的差值。",MATH_ARITHMETIC_TOOLTIP_MULTIPLY:"返回两个数值的乘积。",MATH_ARITHMETIC_TOOLTIP_DIVIDE:"返回两个数值的商。",MATH_ARITHMETIC_TOOLTIP_POWER:"返回以第一个数值为底数，以第二个数值为幂的结果。",MATH_SINGLE:"%1 %2",MATH_SINGLE_OP_ROOT:"算术平方根",MATH_SINGLE_TOOLTIP_ROOT:"返回一个数的平方根。",MATH_SINGLE_OP_ABSOLUTE:"绝对值",MATH_SINGLE_TOOLTIP_ABS:"返回一个数的绝对值。",MATH_SINGLE_TOOLTIP_NEG:"返回指定數字的逻辑非",MATH_SINGLE_TOOLTIP_LN:"返回一个数的自然对数。",MATH_SINGLE_TOOLTIP_LOG10:"返回一个数的对数。",MATH_SINGLE_TOOLTIP_EXP:"返回指定數字指數的 e",MATH_SINGLE_TOOLTIP_POW10:"返回一个数的10次幂。",MATH_ROUND:"%1 %2",MATH_ROUND_TOOLTIP:"数字向上或向下舍入。",MATH_ROUND_OPERATOR_ROUND:"四舍五入",MATH_ROUND_OPERATOR_ROUNDUP:"向上舍入",MATH_ROUND_OPERATOR_ROUNDDOWN:"向下舍入",MATH_MODULO_TITLE:"%1 ÷ %2 的余数",MATH_MODULO_TOOLTIP:"返回这两个数字相除后的余数。",MATH_NUMBER_PROPERTY:"%1 %2",MATH_IS_EVEN:"是偶数",MATH_IS_ODD:"是奇数",MATH_IS_PRIME:"是质数",MATH_IS_WHOLE:"是整数",MATH_IS_POSITIVE:"是正数",MATH_IS_NEGATIVE:"是负数",MATH_IS_TOOLTIP:"如果数字是偶数、奇数、非负整数、正数、负数或如果它可被某数字整除，则返回真或假。",MATH_DEGREES:"度",LOGIC_NEGATE_TITLE:"%1 不成立",LOGIC_BOOLEAN_TRUE:"成立",LOGIC_BOOLEAN_FALSE:"不成立",LOGIC_BOOLEAN_TOOLTIP:"返回真或假。",LOGIC_COMPARE:"%1 %2 %3",LOGIC_COMPARE_TOOLTIP_EQ:"如果两个输入结果相等，则返回真。",LOGIC_COMPARE_TOOLTIP_NEQ:"如果两个输入结果不相等，则返回真。",LOGIC_COMPARE_TOOLTIP_LT:"如果第一个输入结果比第二个小，则返回真。",LOGIC_COMPARE_TOOLTIP_LTE:"如果第一个输入结果小于或等于第二个输入结果，则返回真。",LOGIC_COMPARE_TOOLTIP_GT:"如果第一个输入结果比第二个大，则返回真。",LOGIC_COMPARE_TOOLTIP_GTE:"如果第一个输入结果大于或等于第二个输入结果，则返回真。",LOGIC_OPERATION:"%1 %2 %3",LOGIC_OPERATION_AND:"且",LOGIC_OPERATION_OR:"或",LOGIC_OPERATION_TOOLTIP_AND:"如果两个输入结果都为真，则返回真。",LOGIC_OPERATION_TOOLTIP_OR:"如果至少有一个输入结果为真，则返回真。",TEXT_TEXT_TOOLTIP:"一个字母、单词或一行文本。",TEXT_SELECT:"%1 的第 %2 到第 %3 个字符",TEXT_LENGTH:"%1 的长度",TEXT_CONTAIN:"%1 包含 %2",TEXT_SPLIT:"把 %1 按 %2 分开成列表",TEXT_JOIN_TOOLTIP:"通过串起任意数量的项以建立一段文字。",TEXT_JOIN_TITLE_HEAD:"把",TEXT_JOIN_TITLE_TAIL:"放在一起",VARIABLES_GET:"%1",VARIABLES_SET:"设置变量 %1 的值为 %2",CHANGE_VARIABLE:"将变量 %1 %2 %3",INCREASE:"增加",DECREASE:"减少",LISTS_GET:"%1",LISTS_APPEND:"添加 %1 到 %2 末尾",LISTS_INSERT_VALUE:"插入 %3 到 %1 的第 %2 项",LISTS_COPY:"复制 %2 到 %1",LISTS_LENGTH:"%1 的长度",LISTS_IS_EXIST:"%1 中包含 %2",LISTS_INDEX_OF:"%2 中第一个 %1 的位置",PROCEDURES_PARAMETER:"参数%1",PROCEDURES_RETURN_VALUE:"返回 %1 %2",PROCEDURES_DEFNORETURN_TITLE:"定义函数",PROCEDURES_DEFNORETURN_PROCEDURE:"函数",PROCEDURES_DEFNORETURN_TOOLTIP:"创建一个函数。",PROCEDURES_DEFRETURN_RETURN:"返回",COLOR_PICKER:"%1",RED:"红色",GREEN:"绿色",BLUE:"蓝色",HUE:"色相",SATURATION:"饱和度",BRIGHTNESS:"明度",OPACITY:"不透明度",SELECT_COLOR_PARAM_TYPE:"选参方式",COLOR_PREVIEW:"颜色预览"}},80049:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DragAreaChangeEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=function(t){function e(e){var o=t.call(this,e.block)||this;return o.type=r.BlockEventType.DRAG_AREA_CHANGE,o._record_undo=!1,o.block=e.block,o.area=e.area,o.is_in=e.is_in,o}return(0,i.__extends)(e,t),(0,i.__decorate)([(0,n.injectable)()],e)}(o(8633).BlockEvent);e.DragAreaChangeEvent=s},80409:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.UIEvent=void 0;var i=o(31635),n=o(71519),r=function(t){function e(e){var o=t.call(this)||this;return o._record_undo=!1,o.type=e.type,o._workspace_id=e.workspace_id,o._old_value=e.old_value,o._new_value=e.new_value,o._block_id=e.block_id,o}return(0,i.__extends)(e,t),e.prototype.get_new_value=function(){return this._new_value},e.prototype.get_old_value=function(){return this._old_value},(0,i.__decorate)([(0,n.injectable)()],e)}(o(31113).BaseEvent);e.UIEvent=r},81818:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceComment=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(32791),a=o(58221),l=o(14289),c=o(15261),h=o(99186),d=o(24042),p=o(47187),u=[214,126],g=[140,68],v=[40,40],f=function(t){function e(e,o,i,n){var s=t.call(this,e)||this;s.element_type="comment",s.SIZE=24,s.width=v[0],s.height=v[1],s.left_top_offset=[-12,-12],s.color_theme="BLUE",s.text_="",s.bubble_width_=u[0],s.bubble_height_=u[1],s.parent_width_=0,s.relative_position_=r.vec2.create(),s.expanded_=!1,s.prev_text_l=0,s.is_textarea_focused=!1,s.auto_layout_=!0,s.parent_block_=o;var _=s.workspace.is_resizes_enabled();s.workspace.set_resizes_enabled(!1),s.events.disable(),s.id=null!=n?n:(0,h.gen_uid)(),s.svg_group.classList.add("blocklyWorkspaceComment"),s.update_movable(),o&&(o.is_rendered()&&(s.parent_width_=o.first_row_width,s.relative_position_=r.vec2.fromValues(s.parent_width_+60,o.first_row_height/2)),s.deletable_=!1);var a=void 0;if(i)if(s.parent_block_){a=(0,d.clone_deep)(s.get_relative_position()),s.set_relative_position(r.vec2.fromValues(i.x,i.y));var l=s.parent_block_.get_relative_to_surface_xy();s.translate(r.vec2.add(l,l,s.relative_position_))}else s.translate(r.vec2.fromValues(i.x,i.y));if(e.workspace_comment_db.set(s.id,s),o||e.add_top_comment(s),s.init_events(),s.events.enable(),s.events.is_enabled()){if(s.parent_block_){var c=s.change_event_factory("comment",{block:s.parent_block_,old_value:void 0,new_value:s.id});s.events.fire(c)}else s.events.fire(s.create_event_factory({block:s}));if(i&&s.parent_block_){var p=s.move_event_factory({block:s});p.set_record_undo(!1),a&&p.set_old_coord(a),p.record_new(),s.events.fire(p)}}return s.workspace.set_resizes_enabled(_),s}return(0,i.__extends)(e,t),e.prototype.init_svg=function(){var t;this.parent_block_&&!this.svg_line_&&(this.svg_line_=(0,c.create_svg_element)("line",{class:"blocklyCommentLine",x1:0,y1:0},this.svg_group),this.svg_line_.style.stroke=_.THEME_COLOR_MAP[this.color_theme].toString()),this.svg_icon||(this.svg_icon=(0,c.create_svg_element)("g",{class:"blocklyCommentGroup",filter:"url(#"+a.FILTER.BOXSHADOW+")"}),this.draw_icon(this.svg_icon),this.events.bind_event_with_checks(this.svg_icon,"mouseup",this,this.on_icon_click)),this.reposition(),this.expanded_?this.show_editor():this.update_icon(),this.rendered=!0,null!==(t=this.workspace.get_canvas())&&void 0!==t&&t.appendChild(this.svg_group)},e.prototype.update_icon=function(){this.svg_icon&&(this.svg_icon.setAttribute("transform","translate("+this.left_top_offset[0]+", "+this.left_top_offset[1]+")"),this.expanded_||this.svg_group.appendChild(this.svg_icon))},e.prototype.get_icon=function(){return this.svg_icon},e.prototype.draw_line=function(){if(this.parent_block_&&this.svg_group&&this.svg_line_){var t=this.compute_line_connect_position();t[0]!==Number(this.svg_line_.getAttribute("x2"))&&this.svg_line_.setAttribute("x2",""+t[0]),t[1]!==Number(this.svg_line_.getAttribute("y2"))&&this.svg_line_.setAttribute("y2",""+t[1])}},e.prototype.draw_icon=function(t,e,o){e=e||this.SIZE,o=o||"url(#CommentLinearGradient-"+this.color_theme+")",(0,c.create_svg_element)("circle",{class:"blocklyCommentShape",r:e/2,cx:e/2,cy:e/2,fill:o},t),(0,c.create_svg_element)("path",{class:"blocklyCommentSymbol",transform:"scale("+e/24+") translate(4,4)",d:"M6.98347343,1.49411736 C7.33446274,1.16471383 7.86095956,1 8.38745638,1 C8.91395321,1 9.44045003,1.16471383 9.79146505,1.49411736 C10.2301953,1.82354502 10.4057028,2.23529341 10.4057028,2.72941077 C10.4057028,3.22352813 10.2301953,3.63530065 9.79146505,3.96470418 C9.35270913,4.29413184 8.91395321,4.45882154 8.38745638,4.45882154 C7.86095956,4.45882154 7.33446274,4.29413184 6.89573253,3.96470418 C6.54471751,3.63530065 6.28146909,3.22352813 6.28146909,2.72941077 C6.3692357,2.23529341 6.54471751,1.82354502 6.98347343,1.49411736 L6.98347343,1.49411736 Z M10.3500141,14.3956806 C9.75084061,14.5982168 9.33065616,14.744752 9.08946072,14.8352862 C8.6507048,15 8.21197458,15 7.68547776,15 C6.89573253,15 6.19372819,14.8352862 5.75497227,14.4235378 C5.31624206,14.0117653 5.05299365,13.5999928 5.05299365,13.0235305 C5.05299365,12.7764719 5.05299365,12.611758 5.14073455,12.3646994 C5.14073455,12.1176407 5.22847545,11.870582 5.31624206,11.6235233 L6.19372819,8.90587781 C6.28146909,8.65881913 6.3692357,8.41176045 6.3692357,8.16470177 C6.4569766,7.91764308 6.4569766,7.75295338 6.4569766,7.5058947 C6.4569766,7.17646704 6.3692357,6.92940836 6.19372819,6.76471866 C6.01822068,6.60000483 5.75497227,6.60000483 5.31624206,6.60000483 C5.05299365,6.60000483 4.87748614,6.60000483 4.61423772,6.68234968 C4.52669943,6.70973993 4.43188454,6.73712818 4.32979305,6.76451443 C4.19006969,6.80197087 4.04642345,6.71909078 4.00894402,6.57937358 C4.00300701,6.55724137 4,6.53442576 4,6.51151108 C4,6.30823881 4.12437054,6.12566505 4.31352762,6.05123915 C5.07451793,5.75187496 5.58425502,5.57793699 5.84273888,5.52942525 C6.3692357,5.36471142 6.80796592,5.28236657 7.33446274,5.28236657 C8.12420797,5.28236657 8.82621231,5.44705627 9.26496823,5.85882878 C9.70369844,6.18823231 9.96694685,6.68234968 9.96694685,7.25883602 L9.96694685,7.91764308 C9.96694685,8.24707075 9.87920595,8.49412943 9.79146505,8.74118811 L8.91395321,11.4588336 C8.82621231,11.7058923 8.73847141,11.952951 8.73847141,12.2000097 C8.6507048,12.4470683 8.6507048,12.694127 8.6507048,12.8588167 C8.6507048,13.1882444 8.73847141,13.4353031 8.91395321,13.5999928 C9.08946072,13.7647066 9.35270913,13.7647066 9.87920595,13.7647066 C10.0547135,13.7647066 10.3179619,13.7647066 10.5812103,13.6823617 C10.6420133,13.6633368 10.7063269,13.6443129 10.7741511,13.6252899 C10.8691243,13.5986609 10.967707,13.6540565 10.9943439,13.7490274 C11.0075127,13.7959791 11.0009105,13.8462737 10.97607,13.8882359 C10.8348216,14.1268423 10.6126922,14.3068868 10.3500141,14.3956806 Z"},t)},e.prototype.on_icon_click=function(t){this.workspace.is_dragging()||this.utils.is_right_button(t)||this.set_expanded(!0)},e.prototype.get_bounding_rectangle=function(){var e=t.prototype.get_bounding_rectangle.call(this),o=e.topLeft,i=e.bottomRight;return{topLeft:r.vec2.add(r.vec2.create(),o,this.left_top_offset),bottomRight:r.vec2.add(r.vec2.create(),i,this.left_top_offset)}},e.prototype.get_parent_block=function(){return this.parent_block_},e.prototype.get_top_parent=function(){return this.get_root_block()||this},e.prototype.get_root_block=function(){for(var t=this.parent_block_;null==t?void 0:t.parent_block;)t=t.parent_block;return t},e.prototype.dispose=function(e,o){var i;this.events.is_enabled()&&(i=this.parent_block_?this.change_event_factory("comment",{block:this.parent_block_,old_value:this.xml.comment_to_dom_with_xy(this),new_value:void 0}):this.delete_event_factory({block:this})),this.workspace.workspace_comment_db.delete(this.id),this.parent_block_||this.workspace.remove_top_comment(this),t.prototype.dispose.call(this,e,o&&!this.parent_block_),this.events.fire(i)},e.prototype.show_context_menu=function(t){var e=this;if(!this.workspace.get_options().readOnly&&this.context_menu&&!this.is_in_flyout){var o=function(t){var o=(0,c.create_svg_element)("g",{width:16,height:16});return e.draw_icon(o,16,_.THEME_COLOR_MAP[t].toString()),o},i=function(t){var o=e.color_theme;o!==t&&(e.set_color_theme(t),e.events.is_enabled()&&e.events.fire(e.change_event_factory("comment_color",{block:e,old_value:o,new_value:t})))},n=[{text:this.Msg.BLUE_COMMENT,name:"comment_set_color_blue",enabled:!0,callback:i.bind(this,"BLUE"),icon:o("BLUE"),selected:"BLUE"===this.color_theme},{text:this.Msg.GREEN_COMMENT,name:"comment_set_color_green",enabled:!0,callback:i.bind(this,"GREEN"),icon:o("GREEN"),selected:"GREEN"===this.color_theme},{text:this.Msg.YELLOW_COMMENT,name:"comment_set_color_yellow",enabled:!0,callback:i.bind(this,"YELLOW"),icon:o("YELLOW"),selected:"YELLOW"===this.color_theme},{text:this.Msg.RED_COMMENT,name:"comment_set_color_red",enabled:!0,callback:i.bind(this,"RED"),icon:o("RED"),selected:"RED"===this.color_theme},{text:this.Msg.DELETE_COMMENT,name:"comment_delete",enabled:!0,callback:function(){e.parent_block_?e.parent_block_.set_comment_text(void 0):e.dispose(void 0,!0)}}];this.context_menu.current_block=this,this.context_menu.show(t,{source:"block",options:n},this.RTL)}},e.prototype.get_color_theme=function(){return this.color_theme},e.prototype.get_colour=function(){return _.THEME_COLOR_MAP[this.color_theme]},e.prototype.set_color_theme=function(t,e){var o=this;if(t!==this.color_theme)if((0,d.is_comment_theme)(t)){var i,n=_.THEME_COLOR_MAP[this.color_theme];this.color_theme=t;var r=_.THEME_COLOR_MAP[this.color_theme];this.svg_line_&&(this.svg_line_.style.stroke=r.toString()),this.bubble_&&(this.bubble_.style.background="linear-gradient(to bottom, "+r+" 4px, #fff 4px)",this.expanded_&&!e&&this.empty_border&&(this.empty_border.classList.add("blocklyCommentBorder"),this.empty_border.style.backgroundColor=n.toString(),this.empty_border.addEventListener("animationend",function(){o.empty_border&&(o.empty_border.classList.remove("blocklyCommentBorder"),o.empty_border.style.backgroundColor="transparent")}))),this.svg_icon&&(i=this.svg_icon.querySelector("circle"))&&i.setAttribute("fill","url(#CommentLinearGradient-"+this.color_theme+")"),this.sub_icon&&(i=this.sub_icon.querySelector("circle"))&&i.setAttribute("fill",r.toString())}else console.warn("Trying to set invalid color theme: "+t)},e.prototype.move_by=function(t){var e;this.events.is_enabled()&&(e=this.move_event_factory({block:this}));var o=this.get_relative_to_surface_xy();this.translate(r.vec2.add(this.location_,o,t)),this.parent_block_&&(r.vec2.add(this.relative_position_,this.relative_position_,t),this.draw_line()),e&&e.record_new(),this.rendered&&this.workspace.resize_contents(),e&&this.events.fire(e)},e.prototype.sort=function(t){var e=this.get_relative_to_surface_xy(),o=r.vec2.fromValues(t[0]+20,t[1]+20);this.move_by(r.vec2.sub(e,o,e)),r.vec2.add(t,t,[0,this.get_height_width().height+this.theme.renderer.MIN_HEIGHT])},e.prototype.get_text=function(){return this.text_},e.prototype.set_text=function(t){var e;this.text_!=t&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_text",{block:this,old_value:this.text_,new_value:t})),this.text_=t),this.textarea_&&(this.textarea_.value=t),this.text_layout(),e&&this.events.fire(e)},e.prototype.get_bubble_size=function(){return{width:this.bubble_width_,height:this.bubble_height_}},e.prototype.set_bubble_size=function(t,e){(t=Math.max(g[0],t))!==this.bubble_width_&&(this.bubble_width_=t,this.bubble_&&this.bubble_.setAttribute("width",""+t),this.bubble_shadow_&&this.bubble_shadow_.setAttribute("width",""+t),this.expanded_&&(this.width=t)),(e=Math.max(g[1],e))!==this.bubble_height_&&(this.bubble_height_=e,this.bubble_&&this.bubble_.setAttribute("height",""+e),this.bubble_shadow_&&this.bubble_shadow_.setAttribute("height",""+e),this.expanded_&&(this.height=e))},e.prototype.get_relative_position=function(){return this.parent_block_?this.relative_position_:this.location_},e.prototype.set_relative_position=function(t){this.relative_position_=t},e.prototype.set_expanded=function(t){var e;t!=this.expanded_&&(this.expanded_=t,this.rendered&&(this.events.is_enabled()&&(e=this.change_event_factory("comment_expand",{block:this,old_value:!t,new_value:t})),t?this.show_editor():this.hide_editor(),this.update_visibility(),this.events.fire(e),this.workspace.resize_contents()))},e.prototype.is_expanded=function(){return this.expanded_},e.prototype.update_visibility=function(){if(this.parent_block_){var t=this.parent_block_;(0,d.is_block_svg)(t)&&(t=t.get_root_block());var e=t.get_visibility();(0,c.update_visibility_class)(this.svg_group,e)}},e.prototype.reposition=function(){if(this.parent_block_&&this.parent_block_.is_rendered()){var t=this.parent_block_.get_relative_to_surface_xy();this.parent_width_&&this.parent_width_!==this.parent_block_.first_row_width&&this.relative_position_[0]>this.parent_width_/2&&(this.relative_position_[0]-=this.parent_width_,this.relative_position_[0]+=this.parent_block_.first_row_width),this.parent_width_=this.parent_block_.first_row_width,this.translate(r.vec2.add(t,t,this.relative_position_)),this.draw_line()}},e.prototype.show_editor=function(){var t=this;if(this.svg_icon&&(0,c.remove_node)(this.svg_icon),this.left_top_offset=[-20,-20],!this.bubble_||!this.bubble_shadow_){this.bubble_=(0,c.create_svg_element)("foreignObject",{width:this.bubble_width_,height:this.bubble_height_,class:"blocklyCommentBubble",transform:"translate("+this.left_top_offset[0]+", "+this.left_top_offset[1]+")"}),this.bubble_.style.background="linear-gradient(to bottom, "+_.THEME_COLOR_MAP[this.color_theme]+" 4px, #fff 4px)",this.empty_border=document.createElement("div"),this.empty_border.classList.add("blockCommentEmptyBorder"),this.bubble_.appendChild(this.empty_border);var e=document.createElement("div");e.classList.add("blocklyCommentBubbleLabel");var o=document.createElement("div");this.sub_icon=(0,c.create_svg_element)("svg",{width:14,height:14,class:"blocklyCommentBubbleIcon"},o),this.draw_icon(this.sub_icon,14,_.THEME_COLOR_MAP[this.color_theme].toString());var i=document.createElement("div");i.textContent=this.Msg.COMMENT,o.appendChild(i),e.appendChild(o);var n=(0,c.create_svg_element)("svg",{width:12,height:12,class:"blocklyCommentBubbleClose"},e);(0,c.create_svg_element)("path",{d:"m8,4 l3.834 3.834 c0.352,0.352 0.352,0.92 0,1.278 l-0.32,0.32 c-0.352,0.352 -0.92,0.352 -1.278,0 l-2.926,-2.926 l-2.926,2.926 c-0.352,0.352 -0.92,0.352 -1.278,0 l-0.32,-0.32 c-0.352,-0.352 -0.352,-0.92 0,-1.278 l3.834,-3.834 q 0.6892,-0.8 1.3784,0 z"},n),e.appendChild(n),this.textarea_=document.createElementNS(l.HTML_NS,"textarea"),this.textarea_.classList.add("blocklyCommentTextarea"),this.textarea_.placeholder=this.parent_block_?this.Msg.WHATS_THIS:this.Msg.SAY_SOMETHING,this.events.bind_event_with_checks(this.textarea_,"mousedown",this,this.textarea_mouse_down),this.events.bind_event_with_checks(this.textarea_,"blur",this,function(e){e.stopPropagation(),e.preventDefault(),t.textarea_&&t.set_text(t.textarea_.value||""),t.is_textarea_focused=!1}),this.events.bind_event_with_checks(this.textarea_,"input",this,function(e){e.stopPropagation(),e.preventDefault(),t.text_layout()}),this.events.bind_event_with_checks(n,"mousedown",this,function(t){t.stopPropagation(),t.preventDefault(),this.set_expanded(!1)});var r=document.createElement("div");r.classList.add("blocklyCommentTopContainer");var s=document.createElement("div");s.classList.add("blocklyCommentMainContainer"),s.appendChild(e),s.appendChild(this.textarea_),this.bubble_.appendChild(r),r.appendChild(s);var h=document.createElement("div");h.classList.add("blocklyCommentBottomContainer"),this.bubble_.appendChild(h);var d=this.create_resize_controllers();d&&(r.appendChild(d.ew_resize),h.appendChild(d.ns_resize),h.appendChild(d.nwse_resize)),this.bubble_shadow_=(0,c.create_svg_element)("rect",{width:this.bubble_width_,height:this.bubble_height_,filter:"url(#"+a.FILTER.BOXSHADOW+")",transform:"translate("+this.left_top_offset[0]+", "+this.left_top_offset[1]+")"})}this.textarea_&&(this.textarea_.value=this.text_),this.svg_group.appendChild(this.bubble_shadow_),this.svg_group.appendChild(this.bubble_),this.height=this.bubble_height_,this.width=this.bubble_width_,this.bring_to_front()},e.prototype.text_layout=function(){if(this.textarea_&&this.auto_layout_){if(this.textarea_.value.length>=this.prev_text_l){var t=this.textarea_.scrollHeight+52;return this.set_bubble_size(this.bubble_width_,Math.max(t,u[1])),void(this.prev_text_l=this.textarea_.value.length)}this.set_bubble_size(this.bubble_width_,u[1]),this.prev_text_l=0,this.text_layout()}},e.prototype.hide_editor=function(){this.bubble_shadow_&&(0,c.remove_node)(this.bubble_shadow_),this.bubble_&&(0,c.remove_node)(this.bubble_),this.width=v[0],this.height=v[1],this.left_top_offset=[-12,-12],this.update_icon()},e.prototype.textarea_mouse_down=function(t){var e=this;if(this.textarea_)if(this.is_textarea_focused)t.stopPropagation();else{this.bring_to_front();var o=this.events.bind_event_with_checks(this.textarea_,"mouseup",this,function(){e.textarea_&&e.textarea_.focus(),e.is_textarea_focused=!0,e.select(),e.events.unbind_event(o),e.workspace.cancel_current_gesture(),e.touch_manager.clear_touch_identifier()})}},e.prototype.create_resize_controllers=function(){if(this.bubble_){var t={ew_resize:document.createElement("div"),ns_resize:document.createElement("div"),nwse_resize:document.createElement("div")};return t.ew_resize.classList.add("blocklyCommentEWResize"),this.events.bind_event_with_checks(t.ew_resize,"mousedown",this,this.resize_mouse_down.bind(this,"ew")),t.ns_resize.classList.add("blocklyCommentNSResize"),this.events.bind_event_with_checks(t.ns_resize,"mousedown",this,this.resize_mouse_down.bind(this,"ns")),t.nwse_resize.classList.add("blocklyCommentNWSEResize"),this.events.bind_event_with_checks(t.nwse_resize,"mousedown",this,this.resize_mouse_down.bind(this,"nwse")),t}},e.prototype.unbind_resize_events=function(){this.on_mouseup_wrapper&&(this.events.unbind_event(this.on_mouseup_wrapper),this.on_mouseup_wrapper=void 0),this.on_mousemove_wrapper&&(this.events.unbind_event(this.on_mousemove_wrapper),this.on_mousemove_wrapper=void 0)},e.prototype.resize_mouse_down=function(t,e){this.bring_to_front(),this.select(),e.stopPropagation(),e.preventDefault(),this.utils.is_right_button(e)||(this.workspace.start_drag(e,r.vec2.fromValues(this.bubble_width_,this.bubble_height_)),this.select(),this.size_before_resize=[this.bubble_width_,this.bubble_height_],this.on_mouseup_wrapper=this.events.bind_event_with_checks(document,"mouseup",this,this.bubble_mouse_up),this.on_mousemove_wrapper=this.events.bind_event_with_checks(document,"mousemove",this,this.resize_mouse_move.bind(this,t)))},e.prototype.resize_mouse_move=function(t,e){this.auto_layout_=!1;var o=this.workspace.move_drag(e);t.indexOf("e")>-1&&t.indexOf("w")>-1&&this.set_bubble_size(o[0],this.bubble_height_),t.indexOf("n")>-1&&t.indexOf("s")>-1&&this.set_bubble_size(this.bubble_width_,o[1])},e.prototype.bubble_mouse_up=function(){this.touch_manager.clear_touch_identifier(),this.unbind_resize_events(),this.size_before_resize&&(this.size_before_resize[0]!==this.bubble_width_||this.size_before_resize[1]!==this.bubble_height_)&&this.events.is_enabled()&&this.events.fire(this.change_event_factory("comment_resize",{block:this,old_value:this.size_before_resize,new_value:[this.bubble_width_,this.bubble_height_]})),this.size_before_resize=void 0},e.prototype.is_auto_layout=function(){return this.auto_layout_},e.prototype.set_auto_layout=function(t){this.auto_layout_=t},e.prototype.focus=function(){var t,e;if(this.set_expanded(!0),this.textarea_){var o=(0,c.get_viewport_size)();if(this.textarea_.getBoundingClientRect().left>=o.width){var i=this.get_relative_to_surface_xy()[0]+this.left_top_offset[0],n=this.workspace.get_metrics(),r=this.workspace.get_scale();i=i*r-n.contentLeft,i-=n.viewWidth,i+=this.bubble_width_*r,null!==(e=null===(t=this.workspace.get_scrollbar())||void 0===t?void 0:t.h_scroll)&&void 0!==e&&e.set(i),this.textarea_.focus()}else this.textarea_.focus()}},Object.defineProperty(e.prototype,"use_drag_surface",{get:function(){return!!this.workspace.get_block_drag_surface()&&!this.parent_block_},enumerable:!1,configurable:!0}),e.prototype.compute_line_connect_position=function(){var t=r.vec2.scale(r.vec2.create(),this.relative_position_,-1);if(!this.parent_block_||!this.parent_block_.rendered)return t;var e=r.vec2.create();e[1]=this.parent_block_.first_row_height/2;var o=this.parent_block_.first_row_width,i=this.relative_position_[0]>o/2;return i&&(e[0]+=o),this.parent_block_.is_starting_block()&&!i&&(e[0]-=22),r.vec2.add(t,t,e)},e.prototype.cancel_operation=function(){this.is_textarea_focused&&(this.textarea_.value=this.text_,this.textarea_.blur()),this.size_before_resize&&(this.set_bubble_size(this.size_before_resize[0],this.size_before_resize[1]),this.bubble_mouse_up()),this.unselect()},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.touch_manager)],e.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.Msg)],e.prototype,"Msg",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.json)],e.prototype,"json",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.ChangeEvent)],e.prototype,"change_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(p.WorkspaceElement);e.WorkspaceComment=f},86202:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Registry=void 0;var i=o(31635),n=o(71519),r=function(){function t(){this.field_map={}}return t.prototype.register=function(t,e){if(!t)throw new Error('Invalid field type "'+t+'"');this.field_map[t]=e},t.prototype.from_json=function(t){var e=t.type;if(!e||!this.field_map[e])throw new Error('Custom field type "'+e+'" not found');return new this.field_map[e](t)},t}(),s=(0,i.__decorate)([(0,n.injectable)()],function(){this.field=new r});e.Registry=s},86603:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MoveEvent=void 0;var i=o(31635),n=o(77276),r=o(71519),s=o(32791),_=o(24042),a=function(t){function e(e){var o=t.call(this,e.block)||this;o.type=s.BlockEventType.MOVE;var i=o._current_location();return o.old_parent_id=i.parent_id,o.old_input_name=i.input_name,o.old_coordinate=i.coordinate,o}return(0,i.__extends)(e,t),e.prototype.get_new_loc=function(){return{parent_id:this.new_parent_id,input_name:this.new_input_name,coordinate:this.new_coordinate}},e.prototype._current_location=function(){var t=this.workspace_db.get(this._workspace_id);if(null==t)return console.error("Event has no workspace."),{};var e=t.get_element_from_db(this._block_id);if(null==e)return console.error("Event has no block."),{};var o={};if((0,_.is_block_svg)(e)){var i=e.get_parent();if(i){o.parent_id=i.id;var n=i.get_input_with_block(e);n&&(o.input_name=n.name)}else o.coordinate=e.get_relative_to_surface_xy()}else(0,_.is_workspace_comment)(e)&&(o.coordinate=(0,_.clone_deep)(e.get_relative_position()));return o},e.prototype.record_new=function(){var t=this._current_location();this.new_parent_id=t.parent_id,this.new_input_name=t.input_name,this.new_coordinate=t.coordinate},e.prototype.is_null=function(){return this.old_parent_id===this.new_parent_id&&this.old_input_name===this.new_input_name&&(null==this.old_coordinate&&null==this.new_coordinate||null!=this.old_coordinate&&null!=this.new_coordinate&&n.vec2.equals(this.old_coordinate,this.new_coordinate))},e.prototype.run=function(t){var e=this,o=this._get_event_workspace(),i=o.get_element_from_db(this._block_id);null!=i?(function(){if((0,_.is_block_svg)(i)){var n=t?e.new_parent_id:e.old_parent_id;if(n){var r,a=o.get_block_by_id(n);if(!a)throw Error("Trying to re-connect to non-existent block. Event: "+e);var l=i.output_connection||i.previous_connection;if(!l)throw Error("没有对外连接记录个🔨的连接事件");var c=t?e.new_input_name:e.old_input_name;if(c){var h=a.get_input(c);r=h&&h.connection}else l.type===s.CONNECTION_TYPE.PREVIOUS_STATEMENT&&(r=a.next_connection);if(null!=r)return i.unplug(),void l.connect(r,!0);console.warn("Can't connect to non-existent input: "+c+", so dispose this blockConnection"),l&&(e.events.disable(),l.source_block.dispose(),e.events.enable())}else i.unplug()}}(),function(){var o,r=t?(0,_.clone_deep)(e.new_coordinate):(0,_.clone_deep)(e.old_coordinate);if(r){var s=i.get_relative_to_surface_xy();if((0,_.is_workspace_comment)(i)){var a=null===(o=i.get_parent_block())||void 0===o?void 0:o.get_relative_to_surface_xy();a&&n.vec2.add(r,a,r)}i.move_by(n.vec2.sub(s,r,s))}}()):t||console.warn("Can't move non-existent block: "+this._block_id)},e.prototype.set_old_coord=function(t){this.old_coordinate=t},e.prototype.get_old_loc=function(){return{parent_id:this.old_parent_id,input_name:this.old_input_name,coordinate:this.old_coordinate}},e.prototype.serialize=function(){var t=this.old_coordinate?[this.old_coordinate[0],this.old_coordinate[1]]:void 0,e=this.new_coordinate?[this.new_coordinate[0],this.new_coordinate[1]]:void 0;return{id:this._block_id,group:this._group,old_parent_id:this.old_parent_id,old_input_name:this.old_input_name,old_coordinate:t,new_parent_id:this.new_parent_id,new_input_name:this.new_input_name,new_coordinate:e}},e.prototype.deserialize=function(t){this._block_id=t.id,this.old_parent_id=t.old_parent_id,this.old_input_name=t.old_input_name,this.old_coordinate=t.old_coordinate&&n.vec2.fromValues(t.old_coordinate[0],t.old_coordinate[1]),this.new_parent_id=t.new_parent_id,this.new_input_name=t.new_input_name,this.new_coordinate=t.new_coordinate&&n.vec2.fromValues(t.new_coordinate[0],t.new_coordinate[1])},e.prototype.update_new_loc=function(t){this.new_parent_id=t.parent_id,this.new_input_name=t.input_name,this.new_coordinate=t.coordinate},(0,i.__decorate)([(0,r.injectable)()],e)}(o(8633).BlockEvent);e.MoveEvent=a},86865:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BINDING=void 0,e.BINDING={Blink:Symbol("Blink"),block_animations:Symbol("block_animations"),touch_manager:Symbol("touch_manager"),dragged_connection_manager:Symbol("dragged_connection_manager"),insertion_marker_manager:Symbol("insertion_marker_manager"),utils:Symbol("utils"),xml:Symbol("xml"),registry:Symbol("registry"),json:Symbol("json"),css_content:Symbol("css_content"),css:Symbol("css"),widget_div:Symbol("widget_div"),runtime_data:Symbol("runtime_data"),context_menu:Symbol("context_menu"),events:Symbol("events"),extensions:Symbol("extensions"),slider_controller:Symbol("slider_controller"),angle_controller:Symbol("angle_controller"),color_controller:Symbol("color_controller"),WorkspaceElementDragger:Symbol("WorkspaceElementDragger"),FlyoutDragger:Symbol("FlyoutDragger"),WorkspaceDragger:Symbol("WorkspaceDragger"),Inject:Symbol("Inject"),Msg:Symbol("Msg"),WorkspaceDragSurfaceSvg:Symbol("WorkspaceDragSurfaceSvg"),BlockSvg:Symbol("BlockSvg"),BlockDragSurfaceSvg:Symbol("BlockDragSurfaceSvg"),ConnectionDB:Symbol("connection_db"),WorkspaceSvg:Symbol("WorkspaceSvg"),WorkspaceAudio:Symbol("WorkspaceAudio"),EndDragEvent:Symbol("EndDragEvent"),StartDragEvent:Symbol("StartDragEvent"),MoveEvent:Symbol("MoveEvent"),ChangeEvent:Symbol("ChangeEvent"),UIEvent:Symbol("UIEvent"),CreateEvent:Symbol("CreateEvent"),DeleteEvent:Symbol("DeleteEvent"),DragAreaChangeEvent:Symbol("DragAreaChangeEvent"),ContextMenuOptionEvent:Symbol("ContextMenuOptionEvent"),GroupEvent:Symbol("GroupEvent"),FlyoutButton:Symbol("FlyoutButton"),VerticalFlyout:Symbol("VerticalFlyout"),Field:Symbol("Field"),FieldImage:Symbol("Image"),FieldIcon:Symbol("Icon"),FieldLabel:Symbol("Label"),FieldLabelSerializable:Symbol("LabelSerializable"),FieldDropdown:Symbol("Dropdown"),FieldButton:Symbol("FieldButton"),FieldColour:Symbol("FieldColour"),FieldTextInput:Symbol("FieldTextInput"),FieldTextDropdown:Symbol("FieldTextDropdown"),FieldNumber:Symbol("FieldNumber"),FieldMultilineInput:Symbol("FieldMultilineInput"),FieldDefaultValue:Symbol("FieldDefaultValue"),Toolbox:Symbol("Toolbox"),MutationAddButton:Symbol("MutationAddButton"),MutationRemoveButton:Symbol("MutationRemoveButton"),Scrollbar:Symbol("Scrollbar"),ScrollbarPair:Symbol("ScrollbarPair"),Grid:Symbol("Grid"),Comment:Symbol("Comment"),Bubble:Symbol("Bubble"),Gesture:Symbol("Gesture"),RenderedConnection:Symbol("RenderedConnection"),Input:Symbol("Input"),Options:Symbol("Options"),Warning:Symbol("Warning"),tooltip:Symbol("tooltip"),theme:Symbol("theme"),WorkspaceComment:Symbol("WorkspaceComment"),BlockGroup:Symbol("BlockGroup"),SimplifiedCommentBubble:Symbol("SimplifiedCommentBubble"),workspace_db:Symbol("workspace_db")}},87203:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Events=void 0;var i=o(31635),n=o(71519),r=o(86865),s=o(3672),_=o(32791),a=o(99186),l=function(){function t(){this.FIRE_QUEUE_=[],this.disabled_=0,this.group_="",this._record_undo=!0,this._is_undoing=!1,this.enable_filter=!1,this.listener_disabled=0}return t.prototype.set_disabled=function(t){this.disabled_=t},t.prototype.is_record_undo=function(){return this._record_undo},t.prototype.set_record_undo=function(t){this._record_undo=t},t.prototype.is_undoing=function(){return this._is_undoing},t.prototype.set_undoing=function(t){this._is_undoing=t},t.prototype.fire=function(t){var e=this;if(t&&this.is_enabled())if(t.is_record_undo()&&this.enable_filter)this.FIRE_QUEUE_.length||window.setTimeout(function(){e.fire_now()},0),this.FIRE_QUEUE_.push(t);else{var o=this.workspace_db.get(t.get_workspace_id());o&&o.fire_change_listener(t)}},t.prototype.fire_now=function(){var t=this.filter(this.FIRE_QUEUE_,!0);this.FIRE_QUEUE_.length=0;for(var e=0;e<t.length;e++){var o=t[e],i=this.workspace_db.get(o.get_workspace_id());i&&i.fire_change_listener(o)}},t.prototype.filter=function(t,e){var o=t.slice();e||o.reverse();for(var i=[],n=new Map,r=0;r<o.length;r++){var s=o[r];if(!s.is_null()){var a="",l="";s.type===_.BlockEventType.CHANGE&&(a=s.element||"",l=s.get_name()||"");var c=s.type+"&&"+s.get_block_id()+"&&"+s.get_workspace_id()+"&&"+a+"&&"+l,h=n.get(c);if(h)switch(s.type){case _.BlockEventType.MOVE:if(h.index===r-1){var d=s.get_new_loc();h.event.update_new_loc(d),h.index=r}else n.set(c,{index:r,event:s}),i.push(s);break;case _.BlockEventType.CHANGE:var p=s;h.event.update_new_value(p.get_new_value());break;default:n.set(c,{index:r,event:s}),i.push(s)}else n.set(c,{index:r,event:s}),i.push(s)}}return o=i.filter(function(t){return!t.is_null()}),e||o.reverse(),o},t.prototype.clear_pending_undo=function(){for(var t=0;t<this.FIRE_QUEUE_.length;t++)this.FIRE_QUEUE_[t].set_record_undo(!1)},t.prototype.disable=function(){this.disabled_++},t.prototype.enable=function(){this.disabled_--},t.prototype.is_enabled=function(){return 0==this.disabled_},t.prototype.get_group=function(){return this.group_},t.prototype.set_group=function(t){var e=this.group_;if(this.group_="boolean"==typeof t?t?(0,a.gen_uid)():"":t,e&&e!==this.group_&&this.is_enabled()){var o=this.group_event_factory({type:_.GroupEventType.GroupEnd,group:e});this.fire(o)}if(this.group_&&e!==this.group_&&this.is_enabled()){var i=this.group_event_factory({type:_.GroupEventType.GroupStart,group:this.group_});this.fire(i)}},t.prototype.disable_orphans=function(t){if(t.type==_.BlockEventType.MOVE||t.type==_.BlockEventType.CREATE){this.disable();var e=this.workspace_db.get(t.get_workspace_id());if(null==e)return console.error("Trying to enable/disable a block when the workspace disposed."),void this.enable();var o=e.get_block_by_id(t.get_block_id());if(null!=o){var i=o.get_parent();if(i&&!i.disabled)for(var n=o.get_descendants(),r=0;r<n.length;r++)n[r].set_disabled(!1);else if((o.output_connection||o.previous_connection)&&!e.is_dragging())do{o.set_disabled(!0),o=o.get_next_block()}while(o)}this.enable()}},t.prototype.bind_event=function(t,e,o,i){var n=this,r=function(t){o?i.call(o,t):i(t)};t.addEventListener(e,r,!1);var s={original:{target:t,name:e,listener:r},additional:[]};if(e in this.touch_manager.TOUCH_MAP)for(var _=function(t){if(1==t.changedTouches.length){var e=t.changedTouches[0];t.clientX=e.clientX,t.clientY=e.clientY}r(t),s.original&&n.unbind_original(s)},a=0;a<this.touch_manager.TOUCH_MAP[e].length;a++){var l=this.touch_manager.TOUCH_MAP[e][a];t.addEventListener(l,_,!1),s.additional.push({target:t,name:l,listener:_})}return s},t.prototype.unbind_event_by_data=function(t){var e=t.target,o=t.name,i=t.listener;return e.removeEventListener(o,i,!1),i},t.prototype.unbind_original=function(t){var e;return t.original&&(e=this.unbind_event_by_data(t.original),t.original=void 0),e},t.prototype.unbind_event=function(t){for(var e=this.unbind_original(t);t.additional.length>0;){var o=t.additional.pop();e=this.unbind_event_by_data(o)}return e},t.prototype.bind_event_with_checks=function(t,e,o,i,n,r){var s=this,_=function(t){if(t.target instanceof Element)for(var e=!n,r=s.touch_manager.split_event_by_touches(t),_=0;_<r.length;_++){var a=r[_];if(2===r.length)return;e&&!s.touch_manager.should_handle_event(a)||(s.touch_manager.set_client_from_touch(a),o?i.call(o,a):i(a))}};t.addEventListener(e,_,!1);var a={original:{target:t,name:e,listener:_},additional:[]};if(e in this.touch_manager.TOUCH_MAP)for(var l=function(t){if(_(t),a.original&&s.unbind_original(a),!r){if(0==t.cancelable)return;t.preventDefault()}},c=0;c<this.touch_manager.TOUCH_MAP[e].length;c++){var h=this.touch_manager.TOUCH_MAP[e][c];t.addEventListener(h,l,!1),a.additional.push({target:t,name:h,listener:l})}return a},t.prototype.enable_listener=function(){this.listener_disabled++},t.prototype.disable_listener=function(){this.listener_disabled--},t.prototype.is_listener_enabled=function(){return 0===this.listener_disabled},(0,i.__decorate)([(0,s.lazy_inject)(r.BINDING.touch_manager)],t.prototype,"touch_manager",void 0),(0,i.__decorate)([(0,s.lazy_inject)(r.BINDING.workspace_db)],t.prototype,"workspace_db",void 0),(0,i.__decorate)([(0,s.lazy_inject)(r.BINDING.GroupEvent)],t.prototype,"group_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Events=l},90185:(t,e)=>{function o(t,e){if(t.length<=e)return t;for(var o,s=t.trim().split(/\s+/),_=0;_<s.length;_++)s[_].length>e&&(e=s[_].length);var a,l=-1/0,c=1;do{o=l,a=t;var h=[],d=s.length/c,p=1;for(_=0;_<s.length-1;_++)p<(_+1.5)/d?(p++,h[_]=!0):h[_]=!1;l=n(s,h=i(s,h,e),e),t=r(s,h),c++}while(l>o);return a}function i(t,e,o){for(var r,s=n(t,e,o),_=0;_<e.length-1;_++)if(e[_]!=e[_+1]){var a=e.slice();a[_]=!a[_],a[_+1]=!a[_+1];var l=n(t,a,o);l>s&&(s=l,r=a)}return r?i(t,r,o):e}function n(t,e,o){for(var i=[0],n=[],r=0;r<t.length;r++)i[i.length-1]+=t[r].length,!0===e[r]?(i.push(0),n.push(t[r].charAt(t[r].length-1))):!1===e[r]&&i[i.length-1]++;var s=Math.max.apply(Math,i),_=0;for(r=0;r<i.length;r++)_-=2*Math.pow(Math.abs(o-i[r]),1.5),_-=Math.pow(s-i[r],1.5),-1!=".?!".indexOf(n[r])?_+=o/3:-1!=",;)]}".indexOf(n[r])&&(_+=o/4);return i.length>1&&i[i.length-1]<=i[i.length-2]&&(_+=.5),_}function r(t,e){for(var o=[],i=0;i<t.length;i++)o.push(t[i]),null!=e[i]&&o.push(e[i]?"\n":" ");return o.join("")}Object.defineProperty(e,"__esModule",{value:!0}),e.wrap=e.string_trim=e.string_is_empty_or_whitespace=e.case_insensitive_equals=e.case_insensitive_compare=void 0,e.case_insensitive_compare=function(t,e){var o=String(t).toLowerCase(),i=String(e).toLowerCase();return o<i?-1:o==i?0:1},e.case_insensitive_equals=function(t,e){return"string"==typeof t&&"string"==typeof e&&t.toLowerCase()==e.toLowerCase()},e.string_is_empty_or_whitespace=function(t){return/^[\s\xa0]*$/.test(t)},e.string_trim=function(t){return t.replace(/\s+$/,"").replace(/ +\n/g,"\n")},e.wrap=function(t,e){for(var i=t.split("\n"),n=0;n<i.length;n++)i[n]=o(i[n],e);return i.join("\n")}},92251:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FieldButton=void 0;var i=o(31635),n=o(71519),r=o(24042),s=o(15261),_=o(23250),a=function(t){function e(e){var o=t.call(this,e)||this;return o.field_type="FieldButton",o.image_width=o.width_,o.image_height=o.height_,o.has_circle=e.has_circle,o.click_handler_=e.opt_callback,o.has_circle&&(o.image_width=.6*o.width_,o.image_height=.6*o.height_),o}return(0,i.__extends)(e,t),e.prototype.update_height=function(){this.size_.height=this.height_},e.prototype.init=function(){var t=this;if(!this.field_group){if(this.field_group=(0,s.create_svg_element)("g",{class:"fieldButton",cursor:"default"},void 0),this.visible_||(this.field_group.style.display="none"),this.has_circle&&(this.circle_element=(0,s.create_svg_element)("rect",{width:this.width_,height:this.height_,rx:this.width_/2,ry:this.width_/2,stroke:"rgba(0, 0, 0, .15)",fill:"rgba(255, 255, 255, .15)"},this.field_group),this.events.bind_event_with_checks(this.field_group,"mousedown",this,function(){t.circle_element&&(t.circle_element.style.fill="rgba(0, 0, 0, .15)")})),"string"==typeof this.src_?(this.image_element=(0,s.create_svg_element)("image",{height:this.image_height+"px",width:this.image_width+"px"},this.field_group),this.set_value(this.src_)):(this.image_element=(0,s.create_svg_element)("g",{height:this.height_+"px",width:this.width_+"px"},this.field_group),this.image_element.appendChild(this.src_)),_.is.firefox()&&(this.rect_element=(0,s.create_svg_element)("rect",{height:this.height_+"px",width:this.width_+"px","fill-opacity":0},this.field_group)),null==this.source_block)throw new ReferenceError("Field should have source block when init.");this.source_block.get_svg_root().appendChild(this.field_group),this.events.bind_event_with_checks(this.field_group,"mouseup",this,this.on_click),this.mouse_down_wrapper=this.events.bind_event_with_checks(this.field_group,"mousedown",this,this.on_mouse_down)}},e.prototype.on_click=function(t){if(this.source_block){this.circle_element&&(this.circle_element.style.fill="rgba(255, 255, 255, .15)");var e=this.source_block.get_workspace().get_gesture(t);e&&e.is_dragging_block?e.handle_up(t):this.source_block.is_in_flyout||this.utils.is_right_button(t)||(e&&(e.update_is_mutation_click(!0),e.handle_up(t)),this.click_handler_&&this.click_handler_(this))}},e.prototype.get_img_scale=function(){return 1},e.prototype.layout=function(t,e){if(this.source_block&&(t[0]+=this.render_sep,!(0,r.is_nil)(this.image_element))){var o=this.get_img_scale(),i=Number(((1-o)*this.size_.width/2).toFixed(2)),n=this.source_block.previous_connection?4*i:3*i,s=1.5*i,_=(this.width_-this.image_width)/2,a=(this.height_-this.image_height)/2;this.circle_element&&this.circle_element.setAttribute("transform","scale("+o+") translate("+(t[0]+n)+", "+(t[1]+e/2-this.height_/2+s)+")"),this.image_element.setAttribute("transform","scale("+o+") translate("+(t[0]+n+_)+", "+(t[1]+e/2-this.height_/2+s+a)+")"),t[0]+=this.size_.width}},(0,i.__decorate)([(0,n.injectable)()],e)}(o(1265).FieldImage);e.FieldButton=a},92314:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FieldTextDropdown=void 0;var i=o(31635),n=o(71519),r=o(15261),s=o(14435),_=o(32533),a=function(t){function e(e){var o,i=t.call(this,{text:(null===(o=e()[0])||void 0===o?void 0:o.value)||""})||this;return i.get_options=e,i.field_type="FieldTextDropdown",i.menu_items=[],i.padding_x=10,i.text_margin=0,i}return(0,i.__extends)(e,t),e.prototype.render_=function(){var t,e;this.size_.width=0,this.visible_&&this.field_group&&this.source_block&&(this.size_.width=this.padding_x,this.update_height(),this.render_text_element(),this.render_arrow(),null!==(t=this.border_rect)&&void 0!==t&&t.setAttribute("width",String(this.size_.width)),null!==(e=this.border_rect)&&void 0!==e&&e.setAttribute("height",String(this.size_.height)))},e.prototype.render_text_element=function(){if(this.text_element&&this.field_group){(0,r.remove_children)(this.text_element),this.text_element.appendChild(document.createTextNode(this.get_display_text()));var t=this.utils.get_cached_width(this.text_element);this.text_margin=t<this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD?(this.theme.renderer.TEXT_MIN_WIDTH_IN_FIELD-t)/2:0,this.size_.width+=this.text_margin,this.text_element.setAttribute("y",String(this.size_.height/2)),this.text_element.setAttribute("x",String(this.size_.width)),this.size_.width+=t+this.text_margin}},e.prototype.render_arrow=function(){var t=this;if(this.field_group&&this.source_block)if(this.arrow||(this.arrow=(0,_.draw_arrow)(this.source_block.workspace.options.dropdown.arrow_type),this.field_group.appendChild(this.arrow)),this.size_.width+=this.source_block.workspace.options.dropdown.padding,this.arrow.setAttribute("transform","translate("+this.size_.width+", "+(this.size_.height/2-7)+")"),this.size_.width+=12+this.source_block.workspace.options.dropdown.padding,this.source_block.is_shadow()){var e=function(){var e,o=null===(e=t.source_block)||void 0===e?void 0:e.get_parent();o&&t.arrow&&(t.arrow.style.fill=o.get_colour().toString())};this.events.is_record_undo()?e():window.setTimeout(e)}else this.arrow.style.fill=this.source_block.get_colour().toString()},e.prototype.widget_dispose=function(){var e=this;return function(){t.prototype.widget_dispose.call(e)(),e.menu&&(0,r.remove_node)(e.menu),e.menu_items=[],e.menu=void 0}},e.prototype.show_editor=function(){var e=t.prototype.show_editor.call(this);if(!this.source_block)return e;var o=this.source_block.workspace.get_scale();return e.style.paddingLeft=(this.padding_x+this.text_margin)*o+"px",e.style.textAlign="start",this.menu=this.create_dropdown_element(),e},e.prototype.create_dropdown_element=function(){var t=this;this.menu_items=[];var e=document.createElement("div");e.classList.add("menu-wrapper");for(var o=this.get_options(),i=function(i){var r=o[i],s=document.createElement("div");s.classList.add("menu-item"),s.dataset.value=r.value,s.innerText=r.value,s.setAttribute("tabindex","-1"),s.style.outline="none",r.value===n.get_value()&&s.classList.add("menu_item_selected"),e.appendChild(s),s.style.minWidth="172px",s.addEventListener("click",function(){t.set_html_input_value(r.value),t.widget_div.hide()}),n.menu_items.push(s)},n=this,s=0;s<o.length;s++)i(s);e.classList.add("blocklyDropdownMenu");var a=(0,r.create_dom)("div",{style:"position: fixed",class:"blocklyWidgetDiv"});a.appendChild(e),document.body.appendChild(a),a.style.display="block";var l=(0,_.position_dropdown)(e,this);return a.style.left=l[0]+"px",a.style.top=l[1]+"px",a},e.prototype.highlight_matched=function(){var t=this;if(this.menu)for(var e=function(e,i){var n=o.menu_items[e];if(o.get_value()===n.dataset.value){n.classList.add("menu-item-hover");var r=n.getBoundingClientRect(),s=o.menu.getBoundingClientRect(),_=r.top<s.top,a=r.bottom>s.bottom;(_||a)&&requestAnimationFrame(function(){t.menu&&(n.scrollIntoView(_),t.menu.classList.contains("scroll-smooth")||t.menu.classList.add("scroll-smooth"))})}else n.classList.remove("menu-item-hover")},o=this,i=0,n=this.menu_items.length;i<n;i++)e(i)},e.prototype.dispose=function(){t.prototype.dispose.call(this),this.menu&&(0,r.remove_node)(this.menu),this.widget_div.hide_if_owner(this)},e.prototype.on_html_input_change=function(){t.prototype.on_html_input_change.call(this),this.html_input.style.paddingLeft=(this.padding_x+this.text_margin)*this.workspace_.get_scale()+"px",this.highlight_matched()},(0,i.__decorate)([(0,n.injectable)()],e)}(s.FieldTextInput);e.FieldTextDropdown=a},93235:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FlyoutDragger=void 0;var i=o(31635),n=o(71519),r=function(t){function e(e){var o=t.call(this,e.get_workspace())||this;return o.horizontal_layout=!1,o.scrollbar_=e.get_scrollbar(),o.horizontal_layout=e.is_horizontal(),o}return(0,i.__extends)(e,t),e.prototype.update_scroll=function(t){this.horizontal_layout?this.scrollbar_.set(t[0]):this.scrollbar_.set(t[1])},(0,i.__decorate)([(0,n.injectable)()],e)}(o(97694).WorkspaceDragger);e.FlyoutDragger=r},94081:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Json=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(32791),a=o(18978),l=o(99186),c=o(24042),h=o(15261),d=o(46538),p=function(){function t(){}return t.prototype.comment_to_json=function(t){var e=t.get_parent_block(),o=t.get_bubble_size(),i=t.get_relative_position();return{id:t.id,parent_id:void 0===e?null:e.id,text:t.get_text(),pinned:t.is_expanded(),size:[o.width,o.height],location:[i[0],i[1]],auto_layout:t.is_auto_layout(),color_theme:t.get_color_theme()}},t.prototype.comment_dom_to_json=function(t,e,o){if("comment"!==t.tagName.toLowerCase())throw Error("Trying to convert a non-comment dom into comment json.");var i={id:e||t.getAttribute("id")||(0,l.gen_uid)(),parent_id:o||null,text:t.textContent||"",pinned:"true"===t.getAttribute("pinned"),auto_layout:"true"===t.getAttribute("auto_layout"),size:null,location:null,color_theme:null},n=parseInt(t.getAttribute("w")||"",10),r=parseInt(t.getAttribute("h")||"",10);isNaN(n)||isNaN(r)||(i.size=[n,r]);var s=parseFloat(t.getAttribute("relativeleft_")||""),_=parseFloat(t.getAttribute("relativetop_")||"");isNaN(s)||isNaN(_)||(i.location=[s,_]);var a=t.getAttribute("color_theme");return(0,c.is_comment_theme)(a)&&(i.color_theme=a),i},t.prototype.merge_workspace_data=function(t,e){function o(t,e){Object.keys(e).forEach(function(o){t[o]=e[o]})}o(t.blocks,e.blocks),o(t.connections,e.connections),o(t.comments,e.comments)},t.prototype.block_to_json=function(t){var e=this,o={blocks:{},connections:{},comments:{}};o.connections[t.id]={};var i={},n={},r={},s={};t.inputList.map(function(a){var h,d;if(a.fieldRow.forEach(function(t){if(t.editable&&"string"==typeof t.name)if((0,c.is_field_number)(t)){var e;e=t.allow_text&&!(0,l.is_valid_number)(t.get_value())?"TEXT":t.name,i[e]=t.get_value(),n[e]={min:t.min_,max:t.max_,precision:t.precision_,mod:t.mod_||null};var o=t.get_controller_option();o&&(void 0===r[t.name]&&(r[t.name]={}),r[e].controller_type=o.type,o.type===_.ControllerType.SLIDER?(r[e].left_text=o.left_text,r[e].right_text=o.right_text):o.type===_.ControllerType.COLOR_PICKER&&(r[e].color_format=o.color_format,r[e].line=o.line))}else(0,c.is_field_default_value)(t)?(i[t.name]=t.get_value(),void 0===r[t.name]&&(r[t.name]={}),r[t.name].has_been_edited=t.get_has_been_edited()):i[t.name]=t.get_value()}),a.name){var p=null===(h=a.connection)||void 0===h?void 0:h.get_shadow_string();s[a.name]=p||""}var u=null===(d=a.connection)||void 0===d?void 0:d.targetBlock();if(u){var g=e.block_to_json(u);e.merge_workspace_data(o,g),o.connections[t.id][u.id]={type:"input",input_type:a.type===_.InputType.VALUE?"value":"statement",input_name:a.name}}}),t.comment&&(o.comments[t.comment.id]=this.comment_to_json(t.comment));var a=t.get_location(),h=t.mutation_to_string();o.blocks[t.id]={type:t.type,id:t.id,comment:void 0===t.comment?null:t.comment.id,is_shadow:t.is_shadow(),collapsed:t.is_collapsed(),disabled:t.disabled,deletable:t.deletable_,movable:t.movable_,editable:t.editable_,visible:t.visibility_,location:[a[0],a[1]],shadows:s,fields:i,field_constraints:n,field_extra_attr:r,mutation:h,is_output:!!t.output_connection,parent_id:void 0===t.parent_block?null:t.parent_block.id};var d=t.get_next_block();if(d){var p=this.block_to_json(d);this.merge_workspace_data(o,p),o.connections[t.id][d.id]={type:"next"}}return o},t.prototype.workspace_to_json=function(t){var e=this,o={blocks:{},connections:{},comments:{}};return t.get_top_blocks(!1).forEach(function(t){var i=e.block_to_json(t);e.merge_workspace_data(o,i)}),t.get_top_comments(!1).forEach(function(t){o.comments[t.id]=e.comment_to_json(t)}),o},t.prototype.json_to_block_headless=function(t,e,o){void 0===o&&(o=!0);var i=e.new_block(t.type,t.id);return this.parse_block_data(t,i,o)},t.prototype.parse_block_data=function(t,e,o){void 0===o&&(o=!0),null!==t.is_shadow&&e.set_shadow(t.is_shadow),null!==t.collapsed&&e.set_collapsed(t.collapsed),null!==t.disabled&&e.set_disabled(t.disabled),e.set_deletable(t.deletable),e.set_movable(t.movable),e.set_editable(t.editable);var i=(0,d.parse_visibility)(t.visible);return i&&e.set_visibility(i),t.type!==e.type&&console.warn("Trying to set invalid block data to block: ",e),e.string_to_mutation(t.mutation),e.inputList.forEach(function(e){var o;e.fieldRow.forEach(function(e){if(e.editable&&void 0!==e.name){var o=e.name;if((0,c.is_field_number)(e)){var i;void 0===t.fields.NUM&&void 0!==t.fields.TEXT&&(o="TEXT",e.set_allow_text(!0));var n=t.field_constraints[o];void 0!==n&&(e.set_constraints(n.min,n.max,n.precision),null!==n.mod&&(e.mod_=n.mod)),void 0!==(i=t.field_extra_attr&&t.field_extra_attr[o])&&void 0!==i.controller_type&&("SLIDER"===i.controller_type?e.set_controller_option({type:_.ControllerType.SLIDER,left_text:i.left_text||"",right_text:i.right_text||""}):i.controller_type===_.ControllerType.COLOR_PICKER?e.set_controller_option({type:_.ControllerType.COLOR_PICKER,color_format:i.color_format,line:i.line}):e.set_controller_option({type:_.ControllerType.ANGLE_SCALE}))}if((0,c.is_field_default_value)(e)&&void 0!==(i=t.field_extra_attr&&t.field_extra_attr[o])&&void 0!==i.has_been_edited){var r=i.has_been_edited;e.set_has_been_edited(r)}var s=t.fields[o];void 0!==s&&void 0!==e.call_validator(s)&&"FieldImage"!==e.field_type&&e.set_value(s)}}),e.connection&&t.shadows[e.name]&&((null===(o=e.connection.targetBlock())||void 0===o?void 0:o.is_shadow())&&e.connection.remove_shadow(),e.connection.set_shadow_from_string(t.shadows[e.name]))}),t.location&&o&&e.move_by(r.vec2.fromValues(t.location[0],t.location[1])),e},t.prototype.comment_json_to_dom=function(t){var e=(0,h.create_dom)("comment",void 0,t.text);return null!==t.color_theme&&e.setAttribute("pinned",""+(t.pinned||!1)),t.size&&(e.setAttribute("h",""+t.size[1]),e.setAttribute("w",""+t.size[0])),t.location&&(e.setAttribute("relativeleft_",""+t.location[0]),e.setAttribute("relativetop_",""+t.location[1])),null!==t.auto_layout&&e.setAttribute("auto_layout",""+t.auto_layout),t.color_theme&&e.setAttribute("color_theme",""+t.color_theme),e.setAttribute("id",t.id),e},t.prototype.json_to_comment_headless=function(t,e){var o;if(t.parent_id){var i=e.get_block_by_id(t.parent_id);if(!i)throw Error("Comment parent block not found");i.set_comment_text("",t.id),(0,a.assert)(i.comment,"Create block comment failed."),o=i.comment}else o=e.new_workspace_comment(void 0,t.id);null!==t.text&&o.set_text(t.text),null!==t.pinned&&o.set_expanded(t.pinned),t.size&&o.set_bubble_size(t.size[0],t.size[1]),t.location&&(o.set_relative_position(r.vec2.fromValues(t.location[0],t.location[1])),o.get_parent_block()||o.move_by(r.vec2.fromValues(t.location[0],t.location[1]))),null!==t.auto_layout&&o.set_auto_layout(t.auto_layout);var n=t.color_theme;return(0,c.is_comment_theme)(n)&&o.set_color_theme(n,!0),o},t.prototype.json_to_workspace_headless=function(t,e){var o=this,i=t.blocks,n=t.connections,r=t.comments,s=[];if(i&&Object.keys(i).forEach(function(t){o.json_to_block_headless(i[t],e,!1),s.push(t)}),n){var _=[];Object.keys(n).forEach(function(t){Object.keys(n[t]).forEach(function(r){var s=n[t][r],a=e.get_block_by_id(t),l=e.get_block_by_id(r);if(a&&l){var c,h;if("next"===s.type)c=a.next_connection,h=l.previous_connection;else{var d=a.get_input(s.input_name);c=d&&d.connection,h=l.output_connection||l.previous_connection}if(!c||!h)return l.is_shadow()?(l.dispose(),void console.error("Connected connection not found. Shadow block disposed.")):void console.error("Connected connection not found.");h.context?_.push({inferior:h,superior:c}):o.try_connect(h,c,i)}else console.error("Connected block not found. ")})}),_.forEach(function(t){o.try_connect(t.inferior,t.superior,i)}),s.forEach(function(t){var o;null!==(o=e.get_block_by_id(t))&&void 0!==o&&o.respawn_all_shadows()})}return r&&Object.keys(r).forEach(function(t){o.json_to_comment_headless(r[t],e),s.push(t)}),s},t.prototype.try_connect=function(t,e,o){if(e.connect(t,!0))o&&t.source_block.is_shadow()&&this.parse_block_data(o[t.source_block.id],t.source_block,!1);else{if(this.runtime_data.is_pasting())t.source_block.dispose(!1,!1);else for(var i=t.source_block.get_descendants(!1),n=i.length-1;n>=0;n--)i[n].init_svg(),i[n].update_collapsed(),i[n].render(!1);e.respawn_shadow()}},t.prototype.json_to_workspace=function(t,e){var o=this.events.get_group();o||this.events.set_group(!0);var i=e.is_resizes_enabled();i&&e.set_resizes_enabled(!1),this.utils.start_text_cache();var n=[];try{this.events.disable(),n=this.json_to_workspace_headless(t,e),e.rendered&&this.render_blocks_and_comments(e,n,t.blocks||{})}catch(t){throw new Error("Something wrong with json data. Unable to convert it to workspace.")}finally{this.events.enable(),o||this.events.set_group(!1),i&&e.set_resizes_enabled(!0),this.utils.stop_text_cache()}return n},t.prototype.render_blocks_and_comments=function(t,e,o){var i=this;t.get_top_blocks(!1).forEach(function(t){if(!(e.indexOf(t.id)<0)){i.events.disable();try{t.set_connections_hidden(!0);for(var n=t.get_descendants(!1),s=n.length-1;s>=0;s--)n[s].init_svg();for(s=n.length-1;s>=0;s--)n[s].update_collapsed(),n[s].render(!1);for(s=n.length-1;s>=0;s--){var _=n[s];_.comment&&_.comment.init_svg()}var a=o[t.id];a.location&&t.move_by(r.vec2.fromValues(a.location[0],a.location[1])),window.setTimeout(function(){null!=t&&null!=t.get_workspace()&&t.set_connections_hidden(!1)},1)}finally{t.update_disabled(),i.events.enable()}i.events.is_enabled()&&i.events.fire(i.create_event_factory({block:t}))}}),t.get_top_comments(!1).forEach(function(t){e.indexOf(t.id)<0||t.init_svg()})},t.prototype.reset_element_ids=function(t){var e=JSON.stringify(t);function o(t,e,o){return t.replace(new RegExp(function(t){return t.replace(/[.*+\-?^${}()|[\]\\]/g,"\\$&")}(e),"g"),o)}return Object.keys(t.blocks).forEach(function(t){e=o(e,t,(0,l.gen_uid)())}),Object.keys(t.comments).forEach(function(t){e=o(e,t,(0,l.gen_uid)())}),JSON.parse(e)},t.prototype.get_block_data_by_id=function(t,e){var o=function(t,e){i.blocks[e]=t.blocks[e],i.connections[e]=t.connections[e];var o=t.blocks[e].comment;o&&(i.comments[o]=t.comments[o])},i={blocks:{},connections:{},comments:{}},n=[];if(function t(e,o){var i=o[e];if(void 0!==i&&(n.push(e),Object.keys(i).length))for(var r in i)t(r,o)}(e,t.connections),n.length){for(var r=0,s=n;r<s.length;r++)o(t,s[r]);return i}},t.prototype.workspace_dom_to_json=function(t){var e,o={blocks:{},connections:{},comments:{}},i=new Set;Array.from(t.querySelectorAll("block")).forEach(function(t){var e=t.getAttribute("id");e&&i.add(e)});for(var n=t.childNodes.length,r=0;r<n;r++)if(t.childNodes[r].nodeType!==_.NodeType.TEXT){var s=t.childNodes[r],a=s.tagName.toLowerCase();if("block"===a){var c=this.block_dom_to_json(s,void 0,i);this.merge_workspace_data(o,c)}else if("comment"===a){var h=s.getAttribute("id")||(0,l.gen_uid)(),d=this.comment_dom_to_json(s,h);c={blocks:{},connections:{},comments:(e={},e[h]=d,e)},this.merge_workspace_data(o,c)}else console.error(a+" cannot be a top-level element.")}return o},t.prototype.block_dom_to_json=function(t,e,o){void 0===o&&(o=new Set);var i={blocks:{},connections:{},comments:{}},n=t.nodeName.toLowerCase(),r=t.getAttribute("id")||"";i.connections[r]={};for(var s=t.getAttribute("x")||"0",a=t.getAttribute("y")||"0",c=null,h="",p={},u={},g={},v={},f=t.childNodes.length,b=0;b<f;b++)if(t.childNodes[b].nodeType!==_.NodeType.TEXT){var m=t.childNodes[b],y=m.tagName.toLowerCase();if("field"!==y)if("comment"!==y)if("mutation"!==y)if("value"!==y){if("statement"!==y)if("next"!==y);else{if("true"===m.getAttribute("last_next_in_stack"))continue;for(k=0;k<m.childNodes.length;k++)m.childNodes[k].nodeType!==_.NodeType.TEXT&&"block"===(O=(I=m.childNodes[k]).tagName.toLowerCase())&&(w=I.getAttribute("id")||"",i.connections[r][w]={type:"next"},C=this.block_dom_to_json(I,r,o),this.merge_workspace_data(i,C))}else for(var k=0;k<m.childNodes.length;k++)if(m.childNodes[k].nodeType!==_.NodeType.TEXT&&(p[E=m.getAttribute("name")||""]="","block"===(O=(I=m.childNodes[k]).tagName.toLowerCase()))){var w=I.getAttribute("id")||"";i.connections[r][w]={type:"input",input_type:"statement",input_name:E},C=this.block_dom_to_json(I,r,o),this.merge_workspace_data(i,C)}}else{var E=m.getAttribute("name")||"",T=void 0,x=void 0;for(k=0;k<m.childNodes.length;k++)if(m.childNodes[k].nodeType!==_.NodeType.TEXT){var I,O;if("shadow"===(O=(I=m.childNodes[k]).tagName.toLowerCase())||"empty"===O){var N=I.getAttribute("id");N&&o.has(N)&&I.setAttribute("id",this.utils.gen_uid()),p[E]=this.utils.dom_to_string(I),T=I}"block"===O&&(x=I)}if(x){var A=x.getAttribute("id")||"";i.connections[r][A]={type:"input",input_type:"value",input_name:E};var C=this.block_dom_to_json(x,r,o);this.merge_workspace_data(i,C)}else T&&(A=T.getAttribute("id")||"",i.connections[r][A]={type:"input",input_type:"value",input_name:E},C=this.block_dom_to_json(T,r,o),this.merge_workspace_data(i,C))}else h=this.utils.dom_to_string(m);else{c=m.getAttribute("id")||(0,l.gen_uid)();var S=this.comment_dom_to_json(m,c,r);i.comments[c]=S}else{var L=m.getAttribute("name")||"";u[L]=m.textContent||"";var D=m.getAttribute("constraints");null!==D&&(g[L]=(0,d.parse_constraints)(D));var R=m.getAttribute("has_been_edited");null!==R&&(v[L]={has_been_edited:"true"===R})}}return i.blocks[r]={type:t.getAttribute("type")||"",id:r,is_shadow:"block"!==n,collapsed:"true"===t.getAttribute("collapsed"),disabled:"true"===t.getAttribute("disabled"),deletable:"false"!==t.getAttribute("deletable"),movable:"false"!==t.getAttribute("movable"),editable:"false"!==t.getAttribute("editable")&&"empty"!==n,visible:t.getAttribute("visible")||"",location:[parseInt(s),parseInt(a)],shadows:p,fields:u,field_constraints:g,field_extra_attr:v,comment:c,mutation:h,parent_id:e||null,is_output:null},i},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"events",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.utils)],t.prototype,"utils",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.CreateEvent)],t.prototype,"create_event_factory",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.Json=p},94133:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.BLINK_CSS_CONTENT=void 0,e.BLINK_CSS_CONTENT='.blocklyText{cursor:default;fill:#fff;pointer-events:none}.blocklyEditable .blocklyText{fill:#333}.blocklyEditable .blocklyTextDefault{fill:rgba(51,51,51,.4)}.dark .blocklyEditable .blocklyText{fill:#fff}.blockly_head_icon_wrapper{stroke-dasharray:97;stroke-dashoffset:158;stroke-linecap:round;stroke-width:1px}.blocklyDisabled .blocklyFieldDropdownNonShadow>g,.blocklyDisabled>.blocklyEditableTextBlack>g:not(.b-text-group){fill:#abafb6!important}.blocklyDisabled>.blocklyEditableTextBlack>rect,.blocklyDisabled>.blocklyFieldDropdownNonShadow>rect,.blocklyDisabled>path{stroke:#9399a4}.blocklyDisabled .blocklyDropdownArrow,.blocklyDisabled>.blocklyEditableTextBlack>.dropdown_element>path{fill:#686d76!important}.blocklyDisabled .blockly_head_icon_wrapper{fill:#abafb6!important;stroke:#9399a4!important}.InsertionMarker>.blocklyPath{stroke:none}.blocklyDraggable .output-block-hover:hover>path{stroke:#fff;stroke-width:2px}.blocklySurroundShadow{fill:transparent;stroke:#fff;stroke-width:2px;pointer-events:none}.blocklyBlockDisposeWrapper{position:absolute}.blocklyBlockDisposeWrapper .blocklyBlockDispose{-webkit-animation:dispose 150ms linear forwards;animation:dispose 150ms linear forwards}@-webkit-keyframes dispose{from{transform:scale(1)}to{transform:scale(0)}}@keyframes dispose{from{transform:scale(1)}to{transform:scale(0)}}.blocklyBlockTranslucent{opacity:.5}.blocklyBlockHidden{opacity:0;pointer-events:none}.blocklyBlockUnOperable{pointer-events:none}.blocklyStackGlow{-webkit-filter:url(#blocklySelectedFilter);filter:url(#blocklySelectedFilter)}.procedures_2_defnoreturn>.blocklyEditable text,.procedures_2_parameter>.blocklyEditable .blocklyText,.procedures_2_stable_parameter>.blocklyEditable .blocklyText{fill:#fff}.procedures_2_stable_parameter>.blocklyText:nth-child(3){fill:rgba(255,255,255,.5)}.procedures_2_defnoreturn>.blocklyEditable>rect{stroke:rgba(194,106,81,.5)}.procedures_2_parameter>.blocklyEditable>rect,.procedures_2_stable_parameter>.blocklyEditable>rect{display:none}.decoration_for_collapsed_blocks{pointer-events:none}.blocklyDraggable>.blocklyFieldTextInput>rect{fill:rgba(0,0,0,.1);cursor:default}.blocklyDraggable>.blocklyFieldTextInput .blocklyText{fill:#fff}.blocklyDraggable>.blocklyFieldTextInput .blocklyTextDefault{fill:rgba(255,255,255,.4)}.color_selector{width:112px}.color_selector_item{float:left;width:16px;height:16px;box-shadow:inset 0 0 0 1px #666}.color_selector_item:hover{box-shadow:inset 0 0 0 1px #fff}.blocklyFieldDropdown>rect,.blocklyShadowDropdown>path{cursor:pointer;fill:#fff;fill-opacity:.6}.blocklyFieldDropdown>rect:hover,.blocklyShadowDropdown>path:hover{fill-opacity:.8}.blocklyFieldDropdown[data-showing=true]>rect,.blocklyShadowDropdown[data-showing=true]>path{cursor:pointer;fill:#000;fill-opacity:.1}.blocklyShadow .blocklyFieldDropdown>rect{opacity:0;pointer-events:none}.dark .blocklyFieldDropdown>rect,.dark .blocklyShadowDropdown>path{cursor:pointer;fill:#fff;fill-opacity:.15;stroke:rgba(0,0,0,.15)}.dark .blocklyFieldDropdown>rect:hover,.dark .blocklyShadowDropdown>path:hover{fill-opacity:.3}.dark .blocklyShadowDropdown>path{fill:#000;fill-opacity:.1}.dark .blocklyFieldDropdown[data-showing=true]>rect,.dark .blocklyShadowDropdown[data-showing=true]>path{cursor:pointer;fill:#fff;fill-opacity:1;-webkit-filter:url(#blur-1px);filter:url(#blur-1px)}.dark :not(.blocklyShadowDropdown)>.blocklyFieldDropdown>.blocklyDropdownArrow{fill:#000!important;fill-opacity:.15}.dark .blocklyFieldDropdown[data-showing=true] .blocklyDropdownArrow,.dark .blocklyShadowDropdown[data-showing=true] .blocklyDropdownArrow{opacity:0}.dark .blocklyFieldDropdown[data-showing=true] .blocklyText,.dark .blocklyShadowDropdown[data-showing=true] .blocklyText{fill:#333}.blocklyQuote{fill:#333;opacity:.5}.dark .blocklyShadow>path{fill:#000;fill-opacity:.1;stroke:none}.dark .blocklyQuote{fill:#fff;opacity:1}.fieldButton{cursor:pointer}.fieldButton:hover>rect{fill:rgba(255,255,255,.4)}.dropdown_element{cursor:pointer}.blocklyPlusSign{background:center/contain no-repeat url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTJweCIgaGVpZ2h0PSIxMnB4IiB2aWV3Qm94PSIwIDAgMTIgMTIiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDU1LjEgKDc4MTM2KSAtIGh0dHBzOi8vc2tldGNoYXBwLmNvbSAtLT4KICAgIDx0aXRsZT5pY24vYWRkX2JsYWNrPC90aXRsZT4KICAgIDxkZXNjPkNyZWF0ZWQgd2l0aCBTa2V0Y2guPC9kZXNjPgogICAgPGcgaWQ9Imljbi9hZGRfYmxhY2siIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJpY25fYWRkX2JsYWNrIj4KICAgICAgICAgICAgPHJlY3QgaWQ9IuefqeW9oiIgeD0iMCIgeT0iMCIgd2lkdGg9IjEyIiBoZWlnaHQ9IjEyIj48L3JlY3Q+CiAgICAgICAgICAgIDxwYXRoIGQ9Ik01LDUgTDUsMiBDNSwxLjQ0NzcxNTI1IDUuNDQ3NzE1MjUsMSA2LDEgQzYuNTUyMjg0NzUsMSA3LDEuNDQ3NzE1MjUgNywyIEw3LDUgTDEwLDUgQzEwLjU1MjI4NDcsNSAxMSw1LjQ0NzcxNTI1IDExLDYgQzExLDYuNTUyMjg0NzUgMTAuNTUyMjg0Nyw3IDEwLDcgTDcsNyBMNywxMCBDNywxMC41NTIyODQ3IDYuNTUyMjg0NzUsMTEgNiwxMSBDNS40NDc3MTUyNSwxMSA1LDEwLjU1MjI4NDcgNSwxMCBMNSw3IEwyLDcgQzEuNDQ3NzE1MjUsNyAxLDYuNTUyMjg0NzUgMSw2IEMxLDUuNDQ3NzE1MjUgMS40NDc3MTUyNSw1IDIsNSBMNSw1IFoiIGlkPSJDb21iaW5lZC1TaGFwZSIgZmlsbD0iIzAwMDAwMCI+PC9wYXRoPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+);opacity:.15}.blocklyCommentGroup .blocklyCommentShape{stroke:#fff;stroke-width:2px}.blocklyCommentSymbol{fill:#fff}.blocklyCommentLine{stroke-width:2px;stroke-linecap:round;stroke-dasharray:4 6}.blocklyCommentBubble{border-radius:2px;position:relative;box-sizing:border-box}.blocklyCommentBubble .blocklyCommentTopContainer{width:100%;height:calc(100% - 8px);display:flex}.blocklyCommentBubble .blocklyCommentTopContainer .blocklyCommentMainContainer{width:calc(100% - 4px);height:100%}.blocklyCommentBubble .blocklyCommentBottomContainer{width:100%;height:4px;display:flex}@-webkit-keyframes borderEaseOut{from{margin-left:0}to{margin-left:100%}}@keyframes borderEaseOut{from{margin-left:0}to{margin-left:100%}}.blocklyCommentBorder{-webkit-animation:borderEaseOut .2s forwards ease-out;animation:borderEaseOut .2s forwards ease-out}.blockCommentEmptyBorder{height:4px;width:100%;background-color:transparent}.blocklyCommentBubbleLabel{height:32px;width:100%;display:flex;align-items:center;justify-content:space-between;padding:0 7px 0 12px}.blocklyCommentBubbleLabel .blocklyCommentBubbleIcon{margin-right:8px}.blocklyCommentBubbleLabel div{display:flex;align-items:center;font-size:12px;font-weight:400;color:#8c8c8c;line-height:12px}.blocklyCommentBubbleLabel .blocklyCommentBubbleClose{justify-self:end;fill:rgba(0,0,0,.2);cursor:pointer}.blocklyCommentTextarea{background-color:transparent;border:0;padding:0;resize:none;outline:0;font-size:14px;font-weight:400;color:#333;cursor:text;overflow:hidden;margin:8px 16px 0 12px;height:calc(100% - 44px);width:calc(100% - 28px)}.blocklyCommentTextarea::-webkit-input-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea::-moz-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea:-ms-input-placeholder{color:rgba(0,0,0,.3)}.blocklyCommentTextarea::placeholder{color:rgba(0,0,0,.3)}.blocklyCommentEWResize{cursor:ew-resize;width:4px;height:100%}.blocklyCommentNSResize{cursor:ns-resize;height:100%;width:calc(100% - 4px)}.blocklyCommentNWSEResize{cursor:nwse-resize;width:4px;height:4px}.createCommentAnimation{-webkit-animation:createComment .3s cubic-bezier(.34,1.56,.64,1);animation:createComment .3s cubic-bezier(.34,1.56,.64,1)}@-webkit-keyframes createComment{from{opacity:0;transform:scale(.4) rotate(-60deg) translate(-16px,-16px)}to{opacity:.4;transform:scale(1) rotate(0) translate(-16px,-16px)}}@keyframes createComment{from{opacity:0;transform:scale(.4) rotate(-60deg) translate(-16px,-16px)}to{opacity:.4;transform:scale(1) rotate(0) translate(-16px,-16px)}}.blocklySimplifiedCommentIcon[data-showing=true]>path{stroke:#fff;stroke-width:2px}.blocklySimplifiedCommentBubble{position:fixed;bottom:16px;left:0;right:0;margin:0 78px 0 24px;min-height:64px;max-height:148px;background-color:rgba(15,11,48,.95);border-radius:32px;display:flex;flex-direction:column;justify-content:center}.blocklySimplifiedCommentBubbleCover{overflow:hidden}.blocklySimplifiedCommentBubbleCover::before{content:"";position:absolute;z-index:1;width:100%;height:8px;left:0;top:0;background-image:linear-gradient(rgba(11,8,42,.8),rgba(11,8,42,.52),rgba(11,8,42,0))}.blocklySimplifiedCommentBubbleCover::after{content:"";position:absolute;width:100%;height:8px;left:0;bottom:0;background-image:linear-gradient(rgba(11,8,42,0),rgba(11,8,42,.52),rgba(11,8,42,.8))}.blocklySimplifiedCommentBubbleContent{width:100%;background:0 0;display:flex;flex-direction:column;padding:8px 0;overflow:scroll}.blocklySimplifiedCommentBubbleContent ::-webkit-scrollbar{width:0}.blocklySimplifiedCommentBubbleContent ::-webkit-scrollbar-thumb{background:0 0}.blocklySimplifiedCommentBubbleContent :last-child .blocklySimplifiedCommentTextSeparator{display:none}.showBubbleAnimation{-webkit-animation:showBubble .2s ease-out;animation:showBubble .2s ease-out}.hideBubbleAnimation{animation:showBubble .2s ease-out reverse}@-webkit-keyframes showBubble{from{bottom:-100%}to{bottom:16px}}@keyframes showBubble{from{bottom:-100%}to{bottom:16px}}.disposeBubbleContentAnimation{-webkit-animation:disposeBubbleContent 120ms ease-out;animation:disposeBubbleContent 120ms ease-out}@-webkit-keyframes disposeBubbleContent{to{opacity:0;scale:0}}@keyframes disposeBubbleContent{to{opacity:0;scale:0}}.disposeBubbleAnimation{-webkit-animation:disposeBubble .2s ease-out;animation:disposeBubble .2s ease-out}@-webkit-keyframes disposeBubble{to{bottom:48px;height:0;margin:0 128px 0 74px}}@keyframes disposeBubble{to{bottom:48px;height:0;margin:0 128px 0 74px}}.blocklySimplifiedCommentTextWrapper{position:relative}.blocklySimplifiedCommentTextDecorator{width:2px;height:14px;border-radius:2px;position:absolute;top:11px;left:42px;opacity:1;transition:opacity 120ms ease-out,left 120ms ease-out}.blocklySimplifiedCommentTextSeparator{position:absolute;bottom:0;left:42px;right:48px;height:1px;background:#c7b7ff;opacity:.2}.blocklySimplifiedCommentTextBg{margin-left:42px;margin-right:48px;opacity:1;transition:margin-left 120ms ease-out}.blocklySimplifiedCommentTextActive{background:rgba(199,183,255,.2)}.blocklySimplifiedCommentText{color:#c7b7ff;line-height:21px;min-height:37px;padding:8px 0 8px 6px;font-size:14px;word-break:break-all;width:308px;box-sizing:border-box;opacity:1;transition:opacity 120ms ease-out}.blocklySimplifiedCommentEditButton{position:absolute;top:0;right:116px;margin:auto;width:32px;height:32px;display:none}.showEditButtonAnimation{-webkit-animation:showEditButton 120ms ease-out;animation:showEditButton 120ms ease-out}.hideEditButtonAnimation{animation:showEditButton 120ms ease-out reverse}@-webkit-keyframes showEditButton{from{right:96px;opacity:0}to{right:116px;opacity:1}}@keyframes showEditButton{from{right:96px;opacity:0}to{right:116px;opacity:1}}.blocklySimplifiedCommentRemoveButton{position:absolute;top:0;right:64px;margin:auto;width:32px;height:32px;display:none}.showRemoveButtonAnimation{-webkit-animation:showRemoveButton 120ms ease-out;animation:showRemoveButton 120ms ease-out}.hideRemoveButtonAnimation{animation:showRemoveButton 120ms ease-out reverse}@-webkit-keyframes showRemoveButton{from{right:44px;opacity:0}to{right:64px;opacity:1}}@keyframes showRemoveButton{from{right:44px;opacity:0}to{right:64px;opacity:1}}.blocklySimplifiedCommentMoreButton{position:absolute;top:0;right:12px;margin:auto;width:32px;height:32px;outline:0}.expandMoreButtonAnimation{-webkit-animation:expandMoreButton 120ms ease-out;animation:expandMoreButton 120ms ease-out}.collapseMoreButtonAnimation{animation:expandMoreButton 120ms ease-out reverse}@-webkit-keyframes expandMoreButton{from{transform:rotate(0)}to{transform:rotate(90deg)}}@keyframes expandMoreButton{from{transform:rotate(0)}to{transform:rotate(90deg)}}.injectionDiv{height:100%;width:100%;position:relative;background:#fff}.injectionDiv>*{position:absolute;left:0;top:0}.injectionDiv *{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.injectionDiv ::-webkit-scrollbar{width:0;display:none}.injectionDiv ::-webkit-scrollbar-thumb{background:0 0}.blocklySvg{overflow:hidden;position:absolute}.blocklyScrollbarHorizontal,.blocklyScrollbarVertical{position:absolute;outline:0;opacity:.3}.blocklyScrollbarHorizontal .blocklyScrollbarBackground,.blocklyScrollbarVertical .blocklyScrollbarBackground{opacity:0;position:absolute}.blocklyScrollbarHorizontal .blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarHandle{stroke:#bbb;fill:#bbb}.blocklyScrollbarHorizontal .blocklyScrollbarBackground:active+.blocklyScrollbarHandle,.blocklyScrollbarHorizontal .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,.blocklyScrollbarHorizontal .blocklyScrollbarHandle:active,.blocklyScrollbarHorizontal .blocklyScrollbarHandle:hover,.blocklyScrollbarVertical .blocklyScrollbarBackground:active+.blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,.blocklyScrollbarVertical .blocklyScrollbarHandle:active,.blocklyScrollbarVertical .blocklyScrollbarHandle:hover{stroke-width:4}.blocklyWsDragSurface{display:none;position:absolute;overflow:visible}.blocklyFlyout{box-shadow:rgba(191,173,163,.3) 2px 0 4px 0;background:#fbfbfb;position:absolute}.blocklyFlyout .blocklyDraggable *{cursor:-webkit-grab!important;cursor:grab!important}.blocklyFlyout .blocklyDraggable .blocklyEditable *,.blocklyFlyout .blocklyDraggable .blocklyEditableTextBlack *,.blocklyFlyout .blocklyDraggable .blocklyShadow,.blocklyFlyout .blocklyDraggable .fieldButton,.blocklyFlyout .blocklyFlyoutHidden{pointer-events:none}.blocklyFlyout .blocklyFlyoutClickable,.blocklyFlyout .blocklyFlyoutClickable *{cursor:pointer}.blocklyFlyout .blocklyLine{fill:#cacaca;cursor:default}.blocklyFlyout .blocklyButtonTip{stroke:none;font-size:12px;cursor:default}.blocklyToolboxDiv{display:flex;flex-direction:column;align-items:center;overflow-x:hidden;overflow-y:auto;position:absolute;min-width:54px;background:#fbfbfb;transform:translateZ(0);height:100%;border-right:1px solid #f0f0f0}.blocklyToolboxDiv .blocklyTreeRoot{padding:0}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow{border-radius:6px;min-width:64px;min-height:50px;white-space:nowrap;cursor:pointer;display:flex;flex-direction:column;align-items:center;justify-content:center}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow.blocklyTreeSelected{color:#fff;background-color:#ffb388}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow *{pointer-events:none}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow .blocklyTreeIcon{max-width:36px;max-height:28px}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeRow .blocklyTreeLabel{line-height:14px}.blocklyToolboxDiv .blocklyTreeRoot .blocklyTreeNode .blocklyTreeChildren{display:block;flex-direction:column;align-items:center}.blocklyBlockDragSurface{display:none;position:absolute;top:0;left:0;right:0;bottom:0;overflow:visible;-webkit-backface-visibility:hidden;backface-visibility:hidden}.blinkGridPatternOuter{stroke-opacity:.8;stroke-width:2px}.blinkGridPatternInner{stroke-opacity:.4;stroke-width:1px}.blocklyWidgetDiv{display:none;position:fixed;z-index:99999;outline:0;box-sizing:border-box}.blocklyWidgetDiv *{box-sizing:border-box}.menu-wrapper{background:#fff;box-shadow:0 1px 6px 0 rgba(0,0,0,.15);border-radius:4px;padding:4px 0;overflow-y:auto;overflow-x:hidden;margin:0;outline:0}.menu-wrapper .menu-item{position:relative;height:32px;line-height:32px;padding:0 16px;font-size:14px;font-weight:400;color:#333;cursor:pointer;white-space:nowrap;display:flex;align-items:center;justify-content:start}.menu-wrapper .menu-item.menu-item-hover:not(.menu_item_disable):not(.menu_button),.menu-wrapper .menu-item:hover:not(.menu_item_disable):not(.menu_button){background-color:#fff7cf}.menu-wrapper .menu-item *{pointer-events:none}.menu-wrapper .menu_item_enable{cursor:default}.menu-wrapper .menu_item_disable{color:#000;opacity:.3;cursor:default}.menu-wrapper .dropdown_divider{border-top:1px solid #bbb;margin:4px 0}.menu-wrapper .menu_button{padding-right:20px;color:#fb5}.menu-wrapper .menu_button:hover{color:#c99342}.menu-wrapper .menu_group{position:relative;min-width:120px;padding-right:48px}.menu-wrapper .menu_group *{pointer-events:none}.menu-wrapper .menu_group.menu_group_expanded{background-color:#fff7cf}.menu-wrapper .menu_group::after{content:"";position:absolute;border:solid;border-width:4px 6px;border-color:transparent transparent transparent #979797;top:12px;right:4px}.menu-wrapper .menu_item_image_plus{height:56px;min-width:200px;padding-left:36px;padding-right:56px}.menu-wrapper .menu_item_image_plus>:first-child:not(.image_plus){fill:#fb5;position:absolute;left:12px}.menu-wrapper .menu_item_image_plus .image_plus{width:40px;height:40px;background:#fafafa;border:1px solid #f0f0f0;border-radius:4px;margin-right:8px;display:flex;align-items:center;justify-content:center}.menu-wrapper.scroll-smooth{scroll-behavior:smooth}.blocklyDropdownMenu{min-width:172px;max-height:314px}.menu_group_children{position:fixed;z-index:999999;outline:0;box-sizing:border-box}.menu_group_children *{box-sizing:border-box}.dropdown-triangle{position:absolute;left:50%;transform:translateX(-50%);width:0;height:0}.lower-menu .dropdown-triangle{top:0}.blocklyContextMenu{border-radius:4px;color:#fff;cursor:pointer;position:absolute}.blocklyContextMenu .italic{font-style:italic}.color-menu{width:300px;height:306px;background:#fff;box-shadow:0 1px 6px 0 rgba(76,81,89,.2);border-radius:4px;display:flex;flex-direction:column;align-items:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-menu .color-menu-title{width:300px;height:46px;font-size:14px;font-weight:500;color:#333;padding:16px}.color-menu .color-menu-item{width:268px;height:54px;background:#f5f9ff;border-radius:6px;margin-bottom:8px;display:flex;justify-content:center;align-items:center;cursor:pointer}.color-menu .color-menu-item:hover{background:#e8f1ff}.color-menu .color-menu-item .color-menu-item-content{padding:0 13px;height:31px;background:#e76cea;border-radius:16px;border:1px solid #b353b5;display:flex;justify-content:center;align-items:center;font-size:13px}.color-menu .color-menu-item .color-menu-item-content .color-palette{width:32px;height:24px;border-radius:12px;position:relative}.color-menu .color-menu-item .color-menu-item-content .color-palette div{width:100%;height:100%;border-radius:12px;border:1px solid #fff;position:absolute;z-index:3}.color-menu .color-menu-item .color-menu-item-content .color-palette::after,.color-menu .color-menu-item .color-menu-item-content .color-palette::before{content:"";position:absolute;width:100%;height:100%;border-radius:inherit;top:0;left:0}.color-menu .color-menu-item .color-menu-item-content .color-palette::after{display:block;background-color:inherit;z-index:2;background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAClJREFUKFNj/P///38GLODDhw/YhBkYR6SG9+/fYw0lAQEB7KE0EjUAAPijQL2LySF6AAAAAElFTkSuQmCC) left center}.color-menu .color-menu-item .color-menu-item-content .color-palette::before{display:block;z-index:1;background-color:#fff}.color-menu .color-menu-item .color-menu-item-content .color-string{height:23px;line-height:23px;background:#fff;border-radius:13px;border:1px solid #b353b5;font-weight:500;color:#333;padding:0 2px}.color-menu .color-menu-item .color-menu-item-content .color-hsva,.color-menu .color-menu-item .color-menu-item-content .color-rgba{height:23px;line-height:23px;font-weight:500;color:#fff;display:flex;align-items:center}.color-menu .color-menu-item .color-menu-item-content .color-hsva div,.color-menu .color-menu-item .color-menu-item-content .color-rgba div{max-width:42px;min-width:36px;background:#fff;border-radius:13px;border:1px solid #b353b5;color:#333;margin:0 6px;text-align:center}.color-menu .color-menu-item .color-menu-item-content .color-hsva div:last-child,.color-menu .color-menu-item .color-menu-item-content .color-rgba div:last-child{margin-right:0}.color-menu .color-menu-item-selected{border:2px solid #297eff}.color-menu .injectionDiv{background:0 0}.color-menu .injectionDiv .blocklyMainBackground{display:none}.blocklyHtmlInput{border:none;position:absolute;top:0;left:0;height:100%;margin:0;outline:0;width:100%;text-align:center;border-radius:12px}.blocklyInvalidInput{background:#faa}.blocklyHtmlTextarea{line-break:anywhere;white-space:break-spaces;border:none;position:absolute;top:0;left:0;height:100%;width:100%;text-align:left;box-sizing:border-box;cursor:text;overflow:hidden;outline:0;resize:none}.blocklyDragging,.blocklyDragging *{cursor:-webkit-grabbing!important;cursor:grabbing!important}.blocklyTooltipDiv{background-color:#ffffc7;border:1px solid #ddc;box-shadow:4px 4px 20px 1px rgba(0,0,0,.15);color:#000;display:none;font-size:9pt;opacity:.9;padding:2px;position:absolute;z-index:100000;pointer-events:none}::-moz-selection{background-color:rgba(77,151,255,.25)}::selection{background-color:rgba(77,151,255,.25)}.slider-controller{height:44px;display:flex;background:#fff;box-shadow:0 0 6px 0 rgba(76,81,89,.2);border-radius:4px;padding:0 8px}.slider-controller .slider-text{font-size:12px;line-height:12px;color:#77808c;margin:auto 4px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.slider-controller .slider-wrapper{position:relative;display:flex;align-items:center;justify-content:space-around;height:14px;width:156px;margin:auto}.slider-controller .slider-wrapper .slider-rail{height:6px;width:140px;border-radius:4px;margin:auto}.slider-controller .slider-wrapper .slider-rail:hover{cursor:pointer}.slider-controller .slider-wrapper .slider-handle{height:14px;width:14px;border-radius:50%;position:absolute;left:0}.slider-controller .slider-wrapper .slider-handle:hover{cursor:pointer}.slider-controller .slider-wrapper .slider-track{height:6px;width:0;border-radius:4px;position:absolute;left:8px;top:4px}.slider-controller .slider-wrapper .slider-track:hover{cursor:pointer}.angle-controller{width:204px;height:204px;background-color:#fff;box-shadow:0 0 6px 0 rgba(76,81,89,.2);border-radius:4px;position:relative;display:flex;align-items:center;justify-content:space-around}.angle-controller .degree-mark-major{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:196px}.angle-controller .degree-mark-minor{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:132px}.angle-controller .wrapper{position:relative;width:120px;height:120px;cursor:pointer}.angle-controller .wrapper .grey-circle{width:120px;height:120px;border-radius:50%;background-color:#f2f2f2}.angle-controller .wrapper .mask-wrapper{position:absolute;top:0;left:0;width:120px;height:120px;border-radius:50%;background-color:rgba(255,179,184,.4)}.angle-controller .wrapper .mask-wrapper .mask-clip{position:absolute;left:0;top:0;width:120px;height:120px;border-radius:50%;clip:rect(0,120px,60px,0);background-color:#f2f2f2}.angle-controller .wrapper .mask-wrapper .white-circle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:64px;height:64px;border-radius:50%;background-color:#fff}.angle-controller .wrapper .base-line{position:absolute;top:50%;left:50%;transform:translateY(-50%);height:1px;width:60px;background-color:#f46767}.angle-controller .wrapper .center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:50%;background-color:#f46767;z-index:1}.angle-controller .wrapper .pointer{position:absolute;top:50%;left:50%;height:28px;width:60px;transform-origin:left center;transform:translateY(-50%) rotate(-90deg)}.angle-controller .wrapper .pointer .pointer-line{position:absolute;top:50%;left:0;transform:translateY(-50%);height:1px;width:60px;background-color:#f46767}.angle-controller .wrapper .pointer .pointer-arrow-wrapper{position:absolute;top:0;right:0;transform:rotate(90deg)}.angle-controller .wrapper .pointer .pointer-arrow-wrapper .pointer-arrow-circle{width:28px;height:28px;border-radius:50%;background-color:#f46767;display:flex;align-items:center;justify-content:space-around}.angle-controller .wrapper .pointer .pointer-arrow-wrapper .pointer-arrow-circle .pointer-icon{font-size:16px}.color-controller{width:222px;height:277px;background:#fff;box-shadow:0 1px 6px 0 rgba(76,81,89,.4);border-radius:4px}.color-controller .color-panel{padding:16px;height:228px}.color-controller .color-panel .color-panel-item{font-size:14px;font-weight:500;color:#1a1a1a;margin-bottom:14px}.color-controller .color-panel .color-panel-item .color-label{line-height:16px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-controller .color-panel .color-panel-item .color-strip-panel{background:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAYAAABWdVznAAAAAXNSR0IArs4c6QAAAClJREFUKFNj/P///38GLODDhw/YhBkYR6SG9+/fYw0lAQEB7KE0EjUAAPijQL2LySF6AAAAAElFTkSuQmCC) left center}.color-controller .color-panel .color-panel-item .color-strip-panel{position:relative;margin-top:8px;cursor:pointer}.color-controller .color-panel .color-panel-item .color-strip-panel .color-handle{position:absolute;top:-1px;width:8px;height:14px;background:#fff;box-shadow:0 0 2px 0 rgba(0,0,0,.1);border-radius:2px;border:2px solid rgba(0,0,0,.1)}.color-controller .color-panel .color-panel-item .color-strip-panel-selected{cursor:pointer}.color-controller .color-panel .color-panel-item .color-strip{width:100%;height:12px;border-radius:4px;border:1px solid #e6e6e6}.color-controller .preview-panel{display:flex;justify-content:space-between;align-items:center;width:222px;height:49px;border-top:1px solid rgba(11,24,38,.1);padding:0 16px;font-size:14px;font-weight:500;color:#1a1a1a;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.color-controller .preview-panel .color-preview{width:24px;height:24px;border-radius:4px;border:1px solid rgba(0,0,0,.08)}.blocklyIcon{width:1em;height:1em}'},94421:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ConnectionDB=void 0;var i=o(31635),n=o(71519),r=function(){function t(){this.connections=[],this.connections=new Array}return t.prototype.add_connection=function(t){if(t.in_db)throw new Error("Connection already in database.");if(!t.get_source_block().is_in_flyout){var e=this.find_position_for_connection(t);this.connections.splice(e,0,t),t.in_db=!0}},t.prototype.find_connection=function(t){if(!this.connections.length)return-1;var e=this.find_position_for_connection(t);if(e>=this.connections.length)return-1;for(var o=t.y_,i=e,n=e;i>=0&&this.connections[i].y_==o;){if(this.connections[i]==t)return i;i--}for(;n<this.connections.length&&this.connections[n].y_==o;){if(this.connections[n]==t)return n;n++}return-1},t.prototype.find_position_for_connection=function(t){if(!this.connections.length)return 0;for(var e=0,o=this.connections.length;e<o;){var i=Math.floor((e+o)/2);if(this.connections[i].y_<t.y_)e=i+1;else{if(!(this.connections[i].y_>t.y_)){e=i;break}o=i}}return e},t.prototype.remove_connection=function(t){if(!t.in_db)throw new Error("Connection not in database.");var e=this.find_connection(t);if(-1==e)throw new Error("Unable to find connection in connectionDB.");t.in_db=!1,this.connections.splice(e,1)},t.prototype.get_neighbours=function(t,e){for(var o=t.x_,i=t.y_,n=this.connections,r=0,s=n.length-2,_=s;r<_;)n[_].y_<i?r=_:s=_,_=Math.floor((r+s)/2);var a=[];function l(t){var r=o-n[t].x_,s=i-n[t].y_;return Math.sqrt(r*r+s*s)<=e&&a.push(n[t]),s<e}if(r=_,s=_,n.length){for(;r>=0&&l(r);)r--;do{s++}while(s<n.length&&l(s))}return a},t.prototype.is_in_y_range=function(t,e,o){return Math.abs(this.connections[t].y_-e)<=o},t.prototype.search_for_closest=function(t,e,o){if(!t.source_block.is_stack_connectable()||!this.connections.length)return{connection:void 0,radius:e};var i=t.y_,n=t.x_;t.x_=n+o[0],t.y_=i+o[1];for(var r,s=this.find_position_for_connection(t),_=void 0,a=e,l=s-1;l>=0&&this.is_in_y_range(l,t.y_,e);)r=this.connections[l],t.is_connection_allowed(r,a)&&(_=r,a=r.distance_from(t)),l--;for(var c=s;c<this.connections.length&&this.is_in_y_range(c,t.y_,e);)r=this.connections[c],t.is_connection_allowed(r,a)&&(_=r,a=r.distance_from(t)),c++;return t.x_=n,t.y_=i,{connection:_,radius:a}},(0,i.__decorate)([(0,n.injectable)()],t)}();e.ConnectionDB=r},96375:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FlyoutButton=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=o(15261),a=function(){function t(t){var e=this;this.position_=r.vec2.fromValues(0,0),this.svg_group=void 0,this.width=0,this.width_ratio=void 0,this.height=0,this.margin_right=0,this.on_mouse_up=function(t){var o,i=null===(o=e.target_workspace)||void 0===o?void 0:o.get_gesture(t);i&&i.cancel(),e.callback_&&e.callback_(e,t)},this.workspace_=t.workspace,this.target_workspace=t.target_workspace,this.text_=t.xml.getAttribute("text")||"",this.position_=r.vec2.fromValues(0,0),this.is_label=t.is_label,this.flyout_padding_left=t.flyout_padding_left,this.flyout_padding_right=t.flyout_padding_right,this.callback_=void 0;var o=t.xml,i=t.target_workspace,n=o.getAttribute("callbackkey");this.is_label&&n&&console.warn("Labels should not have callbacks. Label text: "+this.text_),this.is_label||(n&&i.get_button_callback(n)?this.callback_=i.get_button_callback(n):console.warn("Buttons should have callbacks. Button text: "+this.text_)),this.relation=o.getAttribute("relation")||void 0,this.css_class=o.getAttribute("web-class")||void 0,this.default_display=o.getAttribute("display")||void 0,this.type=o.getAttribute("type")||void 0,this.height=parseInt(o.getAttribute("height")||"0")||this.height;var s=o.getAttribute("width");if(s){var _=s.match(/[0-9]+%/);_&&_[0]?this.width_ratio=parseInt(_[0])/100:this.width=parseInt(s)||0}"line"===this.type&&(this.width_ratio=this.width_ratio||1,this.height=this.height||11);var a=function(t){if("string"==typeof t){var e=parseFloat(t);return isNaN(e)?void 0:e}};this.position=o.getAttribute("position")||"relative",this.left=a(o.getAttribute("left")),this.top=a(o.getAttribute("top")),this.right=a(o.getAttribute("right")),this.bottom=a(o.getAttribute("bottom")),this.align=o.getAttribute("align")||void 0,this.inline=o.getAttribute("inline")||void 0,this.margin_right=a(o.getAttribute("margin_right"))||0,this.img_url=o.getAttribute("img_url")||void 0,this.img_width=a(o.getAttribute("img_width"))||0,this.img_height=a(o.getAttribute("img_height"))||0,this.img_margin_right=a(o.getAttribute("img_margin_right"))||0,this.vertical_padding=a(o.getAttribute("vertical_padding"))||0,this.option=o.getAttribute("option")||void 0,this.title=o.getAttribute("title")||void 0}return t.prototype.get_svg_group=function(){return this.svg_group},t.prototype.get_target_workspace=function(){return this.target_workspace},t.prototype.show=function(t){void 0===t&&(t=!0),this.svg_group&&(this.svg_group.setAttribute("display",t?"block":"none"),t&&this.update_callback&&this.update_callback(this))},t.prototype.move_to=function(t,e){if(this.workspace_){var o="fixed"===this.position?this.workspace_.get_scale():1;this.position_=r.vec2.fromValues(t*o,e*o),this.update_transform()}},t.prototype.update_transform=function(){if(this.svg_group&&this.workspace_){var t="fixed"===this.position?", scale("+this.workspace_.get_scale()+")":"";this.svg_group.setAttribute("transform","translate("+this.position_[0]+", "+this.position_[1]+")"+t)}},t.prototype.detach=function(){this.svg_group&&(0,_.remove_node)(this.svg_group),this.workspace_=void 0},t.prototype.retach=function(t){this.workspace_=t,this.svg_group&&this.workspace_.svg_block_canvas_&&this.workspace_.svg_block_canvas_.appendChild(this.svg_group)},t.prototype.dispose=function(){this.on_mouse_up_wrapper&&this.event.unbind_event(this.on_mouse_up_wrapper),this.svg_group&&((0,_.remove_node)(this.svg_group),this.svg_group=void 0),delete this.workspace_,delete this.target_workspace},t.prototype.create_dom=function(t){var e,o,i,n,r,s,a,l=this,c=function(){l.svg_group&&(l.is_label||l.svg_group.classList.add("blocklyFlyoutClickable"),l.update_transform(),l.on_mouse_up_wrapper=l.event.bind_event_with_checks(l.svg_group,"mouseup",l,l.on_mouse_up),(l.width<=0&&!l.width_ratio||l.height<=0)&&console.warn("[FlyoutButton] A button without width or height declaration may cause layout error. ","Please indicate both width and height in the xml of button type: ["+l.type+"]."))},h=null===(e=this.target_workspace)||void 0===e?void 0:e.get_custom_flyout_button(this.type||"");if(h){var d=h(t);if(d instanceof Element)this.svg_group=d;else{var p=d.svg_group,u=d.update_callback;this.svg_group=p,this.update_callback=u}return null!==(i=null===(o=this.workspace_)||void 0===o?void 0:o.svg_block_canvas_)&&void 0!==i&&i.appendChild(this.svg_group),this.svg_group.cachedWidth_&&(this.width=this.svg_group.cachedWidth_),this.svg_group.cachedHeight_&&(this.height=this.svg_group.cachedHeight_),c(),this.svg_group}if("line"===this.type){if("number"!=typeof t)throw Error("Flyout line should be draw when reflow. ");this.svg_group=(0,_.create_svg_element)("g",{class:"blocklyLine"}),null!==(r=null===(n=this.workspace_)||void 0===n?void 0:n.svg_block_canvas_)&&void 0!==r&&r.appendChild(this.svg_group);var g=(0,_.create_svg_element)("rect",{rx:0,ry:0,height:0,width:0},this.svg_group);this.width=t-this.flyout_padding_left-this.flyout_padding_right,g.setAttribute("y","5"),g.setAttribute("width",""+this.width),g.setAttribute("height","1")}else{"normal"!==this.type&&console.warn("Flyout button type ["+this.type+"] is not defined. ","Rendering "+this+" as a normal button. ");var v=this.height||32,f=this.vertical_padding;this.svg_group=(0,_.create_svg_element)("g",{class:this.css_class}),null!==(a=null===(s=this.workspace_)||void 0===s?void 0:s.svg_block_canvas_)&&void 0!==a&&a.appendChild(this.svg_group);var b=(0,_.create_svg_element)("rect",{class:"flyoutButtonNormalRect",rx:4,ry:4},this.svg_group);if(this.img_url&&((0,_.create_svg_element)("image",{class:"flyoutButtonNormalIcon",height:this.img_height,width:this.img_width,x:f,y:(v-this.img_height)/2},this.svg_group).setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",this.img_url),f+=this.img_width+this.img_margin_right),this.text_){var m;(m=(0,_.create_svg_element)("text",{class:"blocklyText","dominant-baseline":"middle",x:f,y:v/2+1},this.svg_group)).textContent=this.text_;var y=0;try{y=m.getComputedTextLength()}catch(t){y=8*this.text_.length}f+=y}f+=this.vertical_padding,b.setAttribute("width",""+f),b.setAttribute("height",""+v),this.width=f,this.height=v,this.option&&((m=(0,_.create_svg_element)("text",{class:"blocklyButtonTip","dominant-baseline":"middle",x:f+3,y:v/2+1},this.svg_group)).textContent="* "+this.option),this.title&&((0,_.create_svg_element)("title",{},this.svg_group).textContent=this.title)}return c(),this.svg_group},t.MARGIN=5,(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.events)],t.prototype,"event",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.FlyoutButton=a},97275:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CreateEvent=void 0;var i=o(31635),n=o(71519),r=o(32791),s=(0,i.__importStar)(o(23250)),_=o(53307),a=function(t){function e(e){var o=t.call(this,e.block)||this;o.type=r.BlockEventType.CREATE,o.ids=[],o.is_shadow=!1,o.source=e.source||"other";var i=e.block,n=i.get_workspace();if(null!=n&&n.rendered?o._xml=o.xml.workspace_element_to_dom_with_xy(i):o._xml=o.xml.workspace_element_to_dom(i),s.base.is_block_svg(i))o.ids=i.get_descendant_ids(),o.is_shadow=i.is_shadow(),o._element_json=o.json.block_to_json(i);else{if(!s.base.is_workspace_comment(i))throw new Error("Trying to fire create event for unsupported workspace element.");o.ids=[i.id],o._element_json={blocks:{},comments:{},connections:{}},o._element_json.comments[i.id]=o.json.comment_to_json(i)}return o}return(0,i.__extends)(e,t),e.prototype.run=function(t){var e=this._get_event_workspace();if(t){var o=s.dom.create_dom("xml");return o.appendChild(this._xml),void this.xml.dom_to_workspace(o,e)}for(var i=0;i<this.ids.length;i++){var n=this.ids[i],r=e.get_element_from_db(n);r?r.dispose(!1,!1):n==this._block_id&&this.is_shadow}},e.prototype.get_element_json=function(){return this._element_json},e.prototype.serialize=function(){if(this._element_json)return{group:this._group,blocks:this._element_json.blocks,comments:this._element_json.comments,connections:this._element_json.connections}},(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.events)],e.prototype,"events",void 0),(0,i.__decorate)([(0,_.lazy_inject)(_.BINDING.xml)],e.prototype,"xml",void 0),(0,i.__decorate)([(0,n.injectable)()],e)}(o(8633).BlockEvent);e.CreateEvent=a},97694:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceDragger=void 0;var i=o(31635),n=o(71519),r=o(77276),s=o(53307),_=function(){function t(t){this.start_scroll_xy_=r.vec2.create(),this.workspace_=t,this.start_drag_metrics_=t.get_metrics(),r.vec2.copy(this.start_scroll_xy_,t.scroll_xy)}return t.prototype.dispose=function(){this.workspace_=void 0},t.prototype.start_drag=function(){this.runtime_data&&this.runtime_data.selected&&this.runtime_data.selected.unselect(),null!=this.workspace_&&this.workspace_.setup_drag_surface()},t.prototype.end_drag=function(t){this.drag(t),null!=this.workspace_&&this.workspace_.reset_drag_surface(),this.dispose()},t.prototype.drag=function(t){var e=this.start_drag_metrics_,o=r.vec2.add(r.vec2.create(),this.start_scroll_xy_,t);r.vec2.min(o,o,[-e.contentLeft,-e.contentTop]),r.vec2.max(o,o,[e.viewWidth-e.contentLeft-e.contentWidth,e.viewHeight-e.contentTop-e.contentHeight]),r.vec2.scaleAndAdd(o,[-e.contentLeft,-e.contentTop],o,-1),this.update_scroll(o)},t.prototype.update_scroll=function(t){null!=this.workspace_&&this.workspace_.get_scrollbar().set(t[0],t[1])},(0,i.__decorate)([(0,s.lazy_inject)(s.BINDING.runtime_data)],t.prototype,"runtime_data",void 0),(0,i.__decorate)([(0,n.injectable)()],t)}();e.WorkspaceDragger=_},98552:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WidgetDiv=void 0;var i=o(31635),n=o(71519),r=o(15261),s=o(72137),_=function(){function t(){this.dispose_=void 0}return t.prototype.create_dom=function(){null==this.DIV&&(this.DIV=(0,r.create_dom)("div","blocklyWidgetDiv"),document.body.appendChild(this.DIV))},t.prototype.show=function(t,e){if(this.hide(),this.owner_=t,this.dispose_=e,null!=this.DIV){var o=(0,s.get_viewport_page_offset)(document);this.DIV.style.top=o[1]+"px",this.DIV.style.direction="ltr",this.DIV.style.display="block"}},t.prototype.hide=function(){this.is_visible()&&(this.owner_=void 0,this.dispose_&&this.dispose_(),this.dispose_=void 0,this.hide_and_clear_dom())},t.prototype.hide_and_clear_dom=function(){null!=this.DIV&&(this.DIV.setAttribute("style","display: none;"),(0,r.remove_children)(this.DIV))},t.prototype.is_visible=function(){return!!this.owner_},t.prototype.hide_if_owner=function(t){this.owner_==t&&this.hide()},t.prototype.position=function(t,e,o,i,n){e<(i=i||(0,s.get_viewport_page_offset)(document))[1]&&(e=i[1]),n?t>(o=o||(0,r.get_viewport_size)()).width+i[0]&&(t=o.width+i[0]):t<i[0]&&(t=i[0]),null!=this.DIV&&(this.DIV.style.left=t+"px",this.DIV.style.top=e+"px",this.DIV.style.height="0px",this.DIV.setAttribute("tabindex","-1"),this.DIV.style.outline="none",this.DIV.focus())},t.prototype.position_with_anchor=function(t,e,o,i){var n=this.calculate_y(t,e,o),r=this.calculate_x(t,e,o,i);this.position_internal(r,n,o.height)},t.prototype.calculate_y=function(t,e,o){return e.bottom+o.height>=t.bottom?e.top-o.height:e.bottom},t.prototype.calculate_x=function(t,e,o,i){if(i){var n=e.right-o.width,r=Math.max(n,t.left);return Math.min(r,t.right-o.width)}return r=Math.min(e.left,t.right-o.width),Math.max(r,t.left)},t.prototype.position_internal=function(t,e,o){null!=this.DIV&&(this.DIV.style.left=t+"px",this.DIV.style.top=e+"px",this.DIV.style.height=o+"px")},(0,i.__decorate)([(0,n.injectable)()],t)}();e.WidgetDiv=_},99686:(t,e,o)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.FieldIcon=void 0;var i=o(31635),n=o(71519),r=o(15261),s=o(23250),_=o(99186),a=function(t){function e(e){var o=t.call(this,e)||this;return o.field_type="FieldIcon",o.width_=o.theme.renderer.HEAD_ICON_WIDTH,o.height_=o.theme.renderer.HEAD_ICON_WIDTH,o.size_=new _.Size(0,0),o.opt_is_head_=e.opt_is_head||!1,o.set_value(o.utils.replace_message_references(e.src)),o}return(0,i.__extends)(e,t),e.prototype.is_head=function(){return this.opt_is_head_},e.prototype.init=function(){if(!this.field_group){if(!1===this.opt_is_head_&&null!=this.source_block){if("*"===this.text_||""===this.text_)return;this.size_=new _.Size(this.width_,this.height_)}this.field_group=(0,r.create_svg_element)("g",{transform:"translate(-"+this.theme.renderer.HEAD_ICON_WRAP_WIDTH/2+", -"+(this.theme.renderer.HEAD_ICON_WRAP_WIDTH-this.theme.renderer.MIN_HEIGHT)+")"}),this.visible_||(this.field_group.style.display="none");var t=this.theme.renderer.HEAD_ICON_WRAP_WIDTH/2;if((0,r.create_svg_element)("circle",{cx:t,cy:t,r:t,fill:null!=this.source_block?this.source_block.get_colour():"",stroke:null!=this.source_block?this.source_block.get_border_colour():this.theme.block_color.DEFAULT.border,class:"blockly_head_icon_wrapper"},this.field_group),this.image_element=(0,r.create_svg_element)("image",{height:this.height_+"px",width:this.width_+"px",x:t-this.width_/2,y:t-this.height_/2,class:"blockly_head_icon"},this.field_group),this.set_value(this.src_),s.is.Gecko()&&(0,r.create_svg_element)("rect",{height:this.height_+"px",width:this.width_+"px","fill-opacity":0},this.field_group),null==this.source_block)throw new ReferenceError("Field should have source block when init.");var e=this.source_block.get_svg_root();if(null==e)throw new ReferenceError("Field should have svg root when init.");e.appendChild(this.field_group)}},e.prototype.layout=function(t){return t},(0,i.__decorate)([(0,n.injectable)()],e)}(o(1265).FieldImage);e.FieldIcon=a}}]);